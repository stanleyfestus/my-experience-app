/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.31/esri/copyright.txt for details.
 * v4.31.0-next.58
 */
import{p as t,A as s,a as i,w as e,t as h}from"./p-5bfa67be.js";import{a as o}from"./p-cf4815f5.js";const n=t=>(s,i)=>r(s,t,i),r=t(class extends s{constructor(t,s,e){super(t,s,e),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:i.makeGetterProxy(t,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.loadedCalled&&o(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),i.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"widget"),this.onLifecycle((()=>this.reactiveUtils.watch((()=>this._instance.viewModel),(t=>{this.component.viewModel=t}),{initial:!0})));const t=this._instance.viewModel;"object"==typeof t&&(i.reEmitAccessorEvents(this,t,this.reactiveUtils,"viewModel"),i.watchComponentUpdates(this,t,this._watchedViewModelProperties),i.watchAccessorUpdates(this,t,this._watchedViewModelProperties));const s=Object.entries(this._watchedVisibleElementsProperties);s.length>0&&this.onLifecycle((()=>s.map((([t,s])=>{let i,h=this._instance.visibleElements??{};for(const t of s.slice(0,-1)){if("object"!=typeof h[t]||null===h[t]){i=Boolean(h[t]);break}h=h[t]}void 0===i&&(i=Boolean(h[s.slice(-1)[0]]??!0)),t.startsWith("hide");const o=t.startsWith("hide")||t.startsWith("show")?t.startsWith("hide"):i,n=this.component;return"boolean"==typeof n[t]?this._updateWidgetVisibleElement(s,n[t],o):n[t]=!1,e(this.component,t,(t=>this._updateWidgetVisibleElement(s,t,o)))}))))}_updateWidgetVisibleElement(t,s,i){let e=this._instance.visibleElements??{};for(const s of t.slice(0,-1))"object"==typeof e[s]&&null!==e[s]||(e[s]={}),e=e[s];const h=Boolean(i?!s:s);e[t.at(-1)]=h}hostLoaded(){const{el:t}=this.component;t.childElem??(t.childElem=document.createElement("div")),this._instance.container=t.childElem;let s=!1;const i=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view??this._instance.viewModel?.view,set:t=>{"view"in this._instance||"object"!=typeof this._instance.viewModel?this._instance.view=t:this._instance.viewModel.view=t,"map"in this._instance||"object"!=typeof this._instance.viewModel?this._instance.map=t.map:this._instance.viewModel.map=t.map,this._watchViewDestroy(),t&&!s&&(s=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),i&&(this._instance.view=i),this.component.el.isConnected&&(o(this.component),this._watchViewDestroy())}hostDisconnected(){"object"==typeof this.component.el.childElem&&this.component.el.view?.ui?.remove(this.component.el.childElem)}hostDestroy(){super.hostDestroy(),this._watchViewDestroyHandle?.remove()}_watchMetaProperties(){e(this.component,"position",(t=>{null!=this.component.el.childElem&&"string"==typeof t&&o(this.component)})),e(this.component,"referenceElement",(()=>o(this.component)))}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,s)=>"string"==typeof s||Reflect.has(t,s),get:(t,s)=>{if("symbol"==typeof s||s in Promise.prototype)return Reflect.get(t,s);const i=[s],e=this._makeRecursiveProxy(i);return h(this.component,(t=>{const s=t;this.component[s]=!1,this._watchedVisibleElementsProperties[s]=i}),e)}})}_makeRecursiveProxy(t){const s=new Proxy({},{get:(i,e)=>{const h=Reflect.get(i,e);return"symbol"==typeof e||e in Promise.prototype?h:(t.push(e),s)}});return s}_watchViewDestroy(){this._watchViewDestroyHandle?.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when((()=>!0===this.component.el.view?.destroyed),(()=>{this.component.destroy().catch(console.error)}),{sync:!0})}});export{n as m}