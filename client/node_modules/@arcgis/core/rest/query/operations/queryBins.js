/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import t from"../../../request.js";import{urlToObject as e,join as r}from"../../../core/urlUtils.js";import{getJsonType as o}from"../../../geometry/support/jsonUtils.js";import{normalizeCentralMeridian as i}from"../../../geometry/support/normalizeUtils.js";import{srToRESTValue as n,equals as s}from"../../../geometry/support/spatialReferenceUtils.js";import{mapParameters as u}from"../../operations/urlUtils.js";function a(t){const e=t.geometry,r=t.toJSON(),i=r;let u,a,l;return null!=e&&(a=e.spatialReference,l=n(a),i.geometryType=o(e),i.geometry=JSON.stringify(e),i.inSR=l),r.outSR?(i.outSR=n(r.outSR),u=t.outSpatialReference):e&&(i.outSR=i.inSR,u=a),i.bin&&=JSON.stringify(i.bin),i.quantizationParameters&&=JSON.stringify(i.quantizationParameters),i.outStatistics&&=JSON.stringify(i.outStatistics),i.outTimeReference&&=JSON.stringify(i.outTimeReference),t.defaultSpatialReference&&s(a,u)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}async function l(t,e,r){return m(t,e,r)}async function m(o,n,s={}){const l="string"==typeof o?e(o):o,m=n.geometry?[n.geometry]:[],f=await i(m,null,{signal:s.signal}),y=f?.[0];null!=y&&((n=n.clone()).geometry=y);const p=u({...l.query,f:"json",...a(n)});return t(r(l.path,"queryBins"),{...s,query:{...p,...s.query}})}export{l as executeBinsQuery,a as queryToQueryStringParameters};
