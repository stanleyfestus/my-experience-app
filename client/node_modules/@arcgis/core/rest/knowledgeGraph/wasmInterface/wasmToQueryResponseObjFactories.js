/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../../../geometry.js";import e from"../../../core/Logger.js";import t from"../Entity.js";import r from"../GraphObject.js";import n from"../GraphQueryResultHeader.js";import o from"../ObjectValue.js";import s from"../Path.js";import a from"../Relationship.js";import{WasmGeometryTypeCodes as u}from"./KnowledgeWasmInterface.js";import{WasmGraphQueryResponseTypeCodes as i}from"./WasmQueryWrapperInterfaces.js";import{wasmToPolygonGeometry as c,wasmToPolylineGeometry as p,wasmToMultipointGeometry as l,wasmToPointGeometry as _}from"./wasmToGeometryFactories.js";import d from"../../../geometry/SpatialReference.js";const m=()=>e.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),f={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case u.ESRI_GEOMETRY_POINT:return _(e,r);case u.ESRI_GEOMETRY_MULTIPOINT:return l(e,r);case u.ESRI_GEOMETRY_POLYLINE:return p(e,r);case u.ESRI_GEOMETRY_POLYGON:return c(e,r);case u.ESRI_GEOMETRY_ENVELOPE:case u.ESRI_GEOMETRY_MULTI_PATCH:return m().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case u.ESRI_GEOMETRY_NULL:case u.ESRI_GEOMETRY_ANY:default:return m().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return m().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case i.OBJECT:return j(e,t,r);case i.ENTITY:return E(e,t,r);case i.RELATIONSHIP:return h(e,t,r);case i.PATH:return T(e,t,r);case i.ARRAY:return y(e,t,r);default:return m().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function y(e,t,r){const n=[],o=e.count();for(let s=0;s<o;s++){const o=e.get_value_at(s);n.push(g(o,t,r))}return n}function g(e,t,r){return f.decodedWasmObjToQueryResponseObj(e,t,r)}function E(e,r,n){const o=e.type_name,s=O(e,r,n),a=e.get_id();return new t(Object.assign({typeName:o,id:a},s))}function R(e,t,n){return new r(O(e,t,n))}function O(e,t,r){const n={},o=e.key_count();for(let s=0;s<o;s++)n[e.get_key_at(s)]=g(e.get_value_at(s),t,r);return{properties:n}}function j(e,t,r){return new o(O(e,t,r))}function T(e,t,r){const n=e.entity_count(),o=e.relationship_count(),a=[];for(let s=0;s<n;s++)a.push(E(e.get_entity_at(s),t,r)),s<o&&a.push(h(e.get_relationship_at(s),t,r));return new s({path:a})}function h(e,t,r){const n=e.type_name,o=O(e,t,r);return new a(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},o))}function w(e){const t=[];for(let n=0;n<e.get_header_keys().size();n++)t.push(e.get_header_keys().get(n));const r=new d(e.get_out_sr());return new n({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}export{f as decodeWasmObjectTest,g as decodedWasmObjToQueryResponseObj,y as wasmArrayToArray,E as wasmToEntity,R as wasmToGraphObject,w as wasmToGraphQueryResponseHeader,j as wasmToObjectValue,T as wasmToPath,h as wasmToRelationship};
