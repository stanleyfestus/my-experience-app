/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{ComponentRangeRunLengthEncoded as t}from"./IndexRange/ComponentRangeRunLengthEncoded.js";class e{constructor(e,h){this.offsets=h,this.pickability=null,this.highlightCounts=null,this.highlightGroups=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let t=0;t<i;t++)this.materialDataIndices[t]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return null==this.highlightCounts?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get defaultShadowMapRanges(){return null==this.highlightCounts?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRangesMap||null==this.cachedDefaultRanges)&&null!=this.highlightCounts&&null!=this.highlightGroups){const{highlightRangesMap:t,defaultRanges:e}=h(this.highlightCounts,this.highlightGroups,this.visibility,this.offsets);this.cachedHighlightRangesMap=t,this.cachedDefaultRanges=e}}}function h(t,e,h,i){const s=new Map,a=[];let n=i.length;return h.forEachComponent((h=>{if(t[h]>0){const t=e[h];let a=s.get(t);void 0===a&&(a=[],s.set(t,a));const n=i[h],l=i[h+1];a.push(n),a.push(l-n)}else n!==h-1&&(a.length&&a.push(i[n+1]-a[a.length-1]),a.push(i[h])),n=h;return!0})),a.length&&a.push(i[n+1]-a[a.length-1]),{highlightRangesMap:s,defaultRanges:a}}export{e as default};
