/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{ShaderOutput as e}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as t}from"../core/shaderTechnique/ShaderTechnique.js";import{blending as r,oitDepthTest as l,depthWrite as n,getDrawBuffers as s}from"../lib/OrderIndependentTransparency.js";import{RenderSlot as o}from"../lib/RenderSlot.js";import{stencilWriteMaskOn as p,stencilToolMaskBaseParams as c,stencilBaseAllZerosParams as u,depthCompareAlways as a,stencilToolTransparentOccluderParams as d,stencilWriteMaskOff as T,stencilToolMaskOccluderParams as h,depthCompareLess as m}from"../lib/StencilUtils.js";import{VertexAttribute as P}from"../lib/VertexAttribute.js";import{L as f}from"../../../../chunks/LineMarker.glsl.js";import{LineMarkerSpace as O}from"./LineMarkerTechniqueConfiguration.js";import{SpecialDrawBuffers as E}from"../../../webgl/enums.js";import{makePipelineState as R,defaultColorWrite as _,premultipliedAlphaToPremultipliedAlpha as S}from"../../../webgl/renderState.js";class A extends t{constructor(e,t,r){super(e,t,new i(f,(()=>import("./LineMarker.glsl.js"))),r,W)}_makePipelineState(i,t){const{output:o,oitPass:a,space:d,hasOccludees:T}=i;return R({blending:o===e.Color?r(a):null,depthTest:d===O.Draped?null:{func:l(a)},depthWrite:n(i),drawBuffers:o===e.Depth?{buffers:[E.NONE]}:s(a,o),colorWrite:_,stencilWrite:T?p:null,stencilTest:T?t?c:u:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(e){return e.occluder?(this._occluderPipelineTransparent=R({blending:S,depthTest:a,depthWrite:null,colorWrite:_,stencilWrite:null,stencilTest:d}),this._occluderPipelineOpaque=R({blending:S,depthTest:a,depthWrite:null,colorWrite:_,stencilWrite:T,stencilTest:h}),this._occluderPipelineMaskWrite=R({blending:null,depthTest:m,depthWrite:null,colorWrite:null,stencilWrite:p,stencilTest:c})):this._occluderPipelineTransparent=this._occluderPipelineOpaque=this._occluderPipelineMaskWrite=null,this._occludeePipelineState=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){return e?this._occludeePipelineState:i===o.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent??super.getPipeline():i===o.OCCLUDER_MATERIAL?this._occluderPipelineOpaque??super.getPipeline():this._occluderPipelineMaskWrite??super.getPipeline()}}const W=new Map([[P.POSITION,0],[P.PREVPOSITION,1],[P.UV0,2],[P.NORMAL,3],[P.COLOR,4],[P.COLORFEATUREATTRIBUTE,4],[P.SIZE,5],[P.SIZEFEATUREATTRIBUTE,5],[P.OPACITYFEATUREATTRIBUTE,6]]);export{A as LineMarkerTechnique,W as vertexAttributeLocations};
