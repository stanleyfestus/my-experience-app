/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{disposeMaybe as r}from"../../../core/maybe.js";import{watch as s,initial as i}from"../../../core/reactiveUtils.js";import"../../../core/Logger.js";import"../../../core/has.js";import"../../../core/RandomLCG.js";import"../../../core/Error.js";import{subclass as t}from"../../../core/accessorSupport/decorators/subclass.js";import{getReferenceEllipsoid as o}from"../../../geometry/ellipsoidUtils.js";import{InternalRenderCategory as n}from"../webgl.js";import{CloudsCompositionTechnique as a}from"./CloudsCompositionTechnique.js";import{NoParameters as m}from"../webgl-engine/core/shaderModules/interfaces.js";import{OpaqueEnvironment as c}from"../webgl-engine/effects/OpaqueEnvironment.js";import{RenderRequestType as l}from"../webgl-engine/lib/basicInterfaces.js";import{createQuadVAO as d}from"../webgl-engine/lib/glUtil3D.js";import{PrimitiveType as p}from"../../webgl/enums.js";let h=class extends c{constructor(e){super(e),e.techniques.precompile(a),this._planetRadius=o(e.view.spatialReference).radius}initialize(){this.addHandles([s((()=>null!=this.view.environment.weather&&this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),i)])}destroy(){this._vao=r(this._vao)}render(e){const r=e.find((({name:e})=>e===n.OPAQUE_ENVIRONMENT)),s=this.bindParameters.clouds;if(!s.data)return r;const i=this.techniques.acquire(a);if(!i.compiled)return this.requestRender(l.UPDATE),i.release(),r;const t=this.renderingContext;this._vao??=d(t);const o=t.bindTechnique(i,this.bindParameters,u);return t.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(p.TRIANGLE_STRIP,0,4),i.release(),s.isFading&&this.requestRender(l.UPDATE),r}};h=e([t("esri.views.3d.environment.CloudsComposition")],h);const u=new m;export{h as CloudsComposition};
