/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import r from"../../../../../../core/Accessor.js";import"../../../../../../core/Logger.js";import"../../../../../../core/has.js";import"../../../../../../core/RandomLCG.js";import"../../../../../../core/Error.js";import{subclass as t}from"../../../../../../core/accessorSupport/decorators/subclass.js";import{identity as o,scale as s}from"../../../../../../core/libs/gl-matrix-2/math/mat4.js";import{create as i}from"../../../../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{fromArray as a,create as n}from"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{computeTranslationToOriginAndRotation as c}from"../../../../../../geometry/projection/computeTranslationToOriginAndRotation.js";import{create as l,size as d}from"../../../../../../geometry/support/aaBoundingBox.js";import{objectSymbolLayerPrimitiveBoundingBox as m,objectSymbolLayerSizeWithResourceSize as p}from"../../../../../../symbols/support/symbolLayerUtils3D.js";import{computeObjectScale as f}from"../../graphicUtils.js";import{FeatureDataItem as u}from"../featureData/interfaces.js";import{createPrimitiveGeometry as h}from"./primitiveObjectUtils.js";let j=class extends r{constructor(e){super(),this._context=e,this.lodRendererId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){const r=e.createMaterial("default"),t=h("cone",r);this.lodRendererId=e.createLodRenderer(t),this._loaded=!0}async add(e,r){if(null==this.lodRendererId)throw new Error("expected lod renderer id to not be null");await this._provisionFeatureData(e);const t=e.numFeatures,o=!0,s=l(m("cone")),i=a(d(s)),n=a(p(i,{isPrimitive:o,width:100,depth:null,height:null})),c=new Float64Array(16*t),f=new Float64Array(16*t),u=e.mapCoordinates;for(let a=0;a<t;++a){const e=a,r=u[3*a+0],t=u[3*a+1],o=u[3*a+2],s=this._computeGlobalTransform(r,t,o,this._context.viewSpatialReference,b),l=this._computeLocalTransform(n,i,y);this._writeMatrixToTypedBuffer(c,e,l),this._writeMatrixToTypedBuffer(f,e,s)}const h={featureIds:new Uint32Array(e.objectIds),localTransforms:c,globalTransforms:f};r.addLodInstances(this.lodRendererId,h)}async remove(e,r){if(null==this.lodRendererId)return;const t=new Uint32Array(e.objectIds);r.removeLodInstances(this.lodRendererId,t)}async _provisionFeatureData(e){await e.provision([u.GEOMETRY_MAP_COORDINATES,u.OBJECT_ID],this._context)}_writeMatrixToTypedBuffer(e,r,t){let o=16*r;for(let s=0;s<16;s++)e[o++]=t[s]}_computeGlobalTransform(e,r,t,o,s){return _[0]=e,_[1]=r,_[2]=t,c(o,_,s,this._context.renderSpatialReference),s}_computeLocalTransform(e,r,t){return o(t),this._applyObjectScale(e,r,t),t}_applyObjectScale(e,r,t){const o=f(e,e,r,this._context.renderCoordsHelper.unitInMeters);1===o[0]&&1===o[1]&&1===o[2]||s(t,t,o)}};j=e([t("esri.views.3d.layers.graphics.pipeline.symbolization.TestObjectSymbol")],j);const _=n(),y=i(),b=i();export{j as TestObjectSymbol};
