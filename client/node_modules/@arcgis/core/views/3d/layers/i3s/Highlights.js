/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{removeUnordered as t}from"../../../../core/arrayUtils.js";import{makeHandle as e}from"../../../../core/handleUtils.js";import{ForAllFeaturesReturnType as i}from"../II3SMeshView3D.js";class s{constructor(){this.ids=new Set}}class h{constructor({collection:t,forAllFeatures:e,forAllFeaturesOfNode:i}){this._highlights=new Map,this._collection=t,this._forAllFeatures=e,this._forAllFeaturesOfNode=i}destroy(){this._highlights.forEach((t=>t.forEach((t=>this._releaseSet(t))))),this._highlights=null}acquireSet(i){const h=new s;let l=this._highlights.get(i);l||(l=[],this._highlights.set(i,l)),l.push(h);const o=e((()=>{if(!this._highlights)return;const e=this._highlights.get(i);e&&(this._releaseSet(h),t(e,h))}));return{set:h,handle:o}}setFeatureIds(t,e,i){e.forEach((e=>t.ids.add(e))),this._initializeSet(t,i)}_initializeSet(t,e){this._forAllFeatures(((s,h,l)=>(t.ids.has(s)&&this._collection.addComponentHighlight(l.objectHandle,h,e),i.CONTINUE)))}_releaseSet(t){this._forAllFeatures(((e,s,h)=>(t.ids.has(e)&&this._collection.removeComponentHighlight(h.objectHandle,s),i.CONTINUE)))}objectCreated(t){this._highlights.forEach(((e,s)=>{e.forEach((e=>{this._forAllFeaturesOfNode(t,((h,l)=>(e.ids.has(h)&&this._collection.addComponentHighlight(t.objectHandle,l,s),i.CONTINUE)))}))}))}objectDeleted(t){this._collection.clearHighlights(t.objectHandle)}}export{h as default};
