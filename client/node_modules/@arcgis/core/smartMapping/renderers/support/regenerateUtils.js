/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../../../core/Error.js";async function n(n,r){const{layer:i,view:t,forBinning:s,filter:a}=n;if(!i||!t)throw new e(`${r}:missing-parameters`,"'layer' and 'view' parameters are required");await i.load();const o="featureReduction"in i?i.featureReduction:null;if(s){if("binning"!==o?.type)throw new e(`${r}:invalid-parameters`,"'layer' must have 'featureReduction' property defined with 'binning' type when 'forBinning' parameter is true");if(a)throw new e(`${r}:invalid-parameters`,"'filter' parameter is not supported when 'forBinning' parameter is true")}return n}async function r(n){const{layer:r,forBinning:i,renderer:t}=n;await r.load();const s="featureReduction"in r?r.featureReduction:null,a=t?.clone()??(i&&"binning"===s?.type?s?.renderer?.clone():"renderer"in r?r.renderer?.clone():null);if(!a)throw new e("get-renderer-to-update:invalid-parameters","renderer not available");return a}function i(e,n,r){const i=e?.authoringInfo?.visualVariables;return i?.find((e=>"reference-size"===r?"size"===e.type&&"reference-size"===e.theme:e.type===n))}function t(e){if(!e)return null;const n=e.type,r="visualVariables"in e?e.visualVariables:null,t=r?.some(f),s=r?.some(p),a=e.authoringInfo,o=a?.visualVariables,u=i(e,"size"),l=i(e,"size","reference-size");if("class-breaks"===n){if(e.classBreakInfos.length>1)return"class-breaks-color"===a?.type?"color-class-breaks":"class-breaks-size"===a?.type?"size-class-breaks":null;if(o?.some((e=>"color"===e.type&&null!==e.units&&null!==e.startTime&&null!==e.endTime)))return"color-age";if(o?.some((e=>"size"===e.type&&null!==e.units&&null!==e.startTime&&null!==e.endTime)))return"size-age";if(o?.some((e=>"size"===e.type&&"reference-size"===e.theme)))return"size-continuous";if(t&&!s)return"color-continuous";if(s&&!t)return"size-continuous"}if("unique-value"===n){const n=e.authoringInfo;return e.valueExpression?"predominance"===n?.type?s?"predominance-size":"predominance":"relationship"===n?.type?s||l?"relationship-size":"relationship":s||l?"type-size":"type":s?u?.units?"type-size-age":"type-size":l?"type-size":"type"}return"pie-chart"===n?s?"chart-size":"chart":null}function s(e){return!!e.visualVariables?.some(d)}function a(e){return!!e.visualVariables?.some(y)}function o(e){return e?.findIndex(d)??-1}function u(e){return e?.findIndex(p)??-1}function l(e){return e?.findIndex(f)??-1}function c(e){return e?.findIndex(y)??-1}function f(e){return"color"===e.type}function p(e){return"size"===e.type&&"outline"!==e.target&&"$view.scale"!==e.valueExpression}function d(e){return"size"===e.type&&"outline"===e.target}function y(e){return"size"===e.type&&"$view.scale"===e.valueExpression&&Array.isArray(e.stops)}function m(e,n,r){const i=e.visualVariables,t=r(i);if(!n||Array.isArray(n)&&!n.length)return;Array.isArray(n)||(n=[n]);const s=n.map((e=>e.clone()));i?t>-1?i.splice(t,1,...s):i.push(...s):e.visualVariables=s}export{l as findColorVVIndex,o as findOutlineVVIndex,c as findScaleDependentSizeVVIndex,u as findSizeVVIndex,i as getAuthoringInfoVisualVariable,r as getRendererToUpdate,t as getStyleType,s as hasOutlineVV,a as hasScaleDependentSizeVV,f as isColorVV,d as isOutlineVV,y as isScaleDependentSizeVV,p as isSizeVV,n as processRegenerateParams,m as spliceVisualVariables};
