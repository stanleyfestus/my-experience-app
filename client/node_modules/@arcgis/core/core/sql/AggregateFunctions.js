/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{DateOnly as n}from"./DateOnly.js";import{SqlError as l,SqlErrorCodes as t}from"./errorSupport.js";import{SqlTimeStampOffset as a}from"./SqlTimestampOffset.js";import{TimeOnly as r}from"./TimeOnly.js";import{DateTime as e}from"luxon";function u(n,a){const r=m[n.toLowerCase()];if(null==r)throw new l(t.FunctionNotRecognized);if(a.length<r.minParams||a.length>r.maxParams)throw new l(t.InvalidParameterCount,{name:n.toUpperCase()});return r.evaluate(a)}function o(n,l){const t=m[n.toLowerCase()];return null!=t&&l>=t.minParams&&l<=t.maxParams}const m={min:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"min")},max:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"max")},avg:{minParams:1,maxParams:1,evaluate:n=>i(n[0])},sum:{minParams:1,maxParams:1,evaluate:n=>c(n[0])},stddev:{minParams:1,maxParams:1,evaluate:n=>g(n[0])},count:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].length},var:{minParams:1,maxParams:1,evaluate:n=>P(n[0])}};function i(n){if(null===n)return null;let a=0,r=0;for(let e=0;e<n.length;e++){const u=n[e];if(null!==u){if(!s(u))throw new l(t.InvalidValueForAggregateFunction);r++,a+=u}}return 0===r?null:a/n.length}function s(n){return"number"==typeof n}function f(l,t){if(null===l)return null;let u=null,o=null;for(const m of l){let l=m;l=m instanceof n||m instanceof r?m.toNumber():m instanceof e?m.toMillis():m instanceof a?m.toMilliseconds():m,(null===u||"max"===t&&null!==o&&null!==l&&o<=l||"min"===t&&null!==o&&null!==l&&o>=l)&&(u=m,o=l)}return u}function c(n){if(null===n)return null;let a=0;for(let r=0;r<n.length;r++){const e=n[r];if(null!==e){if(!s(e))throw new l(t.InvalidValueForAggregateFunction);a+=e}}return a}function g(n){if(null===n)return null;const l=P(n);return null===l?null:Math.sqrt(l)}function P(n){if(null===n)return null;if(0===(n=n.filter((n=>null!==n))).length)return null;const a=i(n);if(null===a)return null;let r=0;for(const e of n){if(!s(e))throw new l(t.InvalidValueForAggregateFunction);r+=(a-e)**2}return r/(n.length-1)}export{u as aggregateFunction,o as isAggregate};
