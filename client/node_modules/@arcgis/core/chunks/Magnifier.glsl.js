/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{screenPointObjectToArray as e,createScreenPointArray as r,createRenderScreenPointArray as a}from"../core/screenUtils.js";import{s as t}from"./vec42.js";import{create as o}from"../core/libs/gl-matrix-2/factories/vec4f64.js";import{BooleanPassUniform as n}from"../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform.js";import{Float4PassUniform as i}from"../views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js";import{NoParameters as s,glsl as l}from"../views/3d/webgl-engine/core/shaderModules/interfaces.js";import{ShaderBuilder as d}from"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js";import{Texture2DPassUniform as m}from"../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js";import{VertexAttribute as u}from"../views/3d/webgl-engine/lib/VertexAttribute.js";class f extends s{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}}function v(){const e=new d;return e.attributes.add(u.POSITION,"vec2"),e.vertex.uniforms.add(new i("drawPosition",((e,r)=>c(e,r)))),e.varyings.add("vUV","vec2"),e.vertex.main.add(l`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),e.fragment.uniforms.add(new m("textureInput",(e=>e.input))),e.fragment.uniforms.add(new m("textureMask",(e=>e.mask))),e.fragment.uniforms.add(new m("textureOverlay",(e=>e.overlay))),e.fragment.uniforms.add(new n("maskEnabled",(e=>e.magnifier.maskEnabled))),e.fragment.uniforms.add(new n("overlayEnabled",(e=>e.magnifier.overlayEnabled))),e.fragment.code.add(l`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),e.fragment.main.add(l`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),e}function c(r,a){const o=a.camera.pixelRatio,n=r.magnifier.offset.x*o,i=r.magnifier.offset.y*o;e(r.magnifier.position,g);const s=a.camera.screenToRender(g,b),l=Math.ceil(o*r.magnifier.size),{fullWidth:d,fullHeight:m}=a.camera;return t(p,(s[0]+n)/d*2-1,(s[1]-i)/m*2-1,l/d*2,l/m*2)}const g=r(),b=a(),p=o(),w=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:f,build:v},Symbol.toStringTag,{value:"Module"}));export{f as M,w as a,v as b};
