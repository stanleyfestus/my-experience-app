/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{G as t}from"./SimpleGeometryCursor.js";import{G as e,e as s,g as n}from"./Geometry.js";import{b as r,g as o,h as m,a as i,j as u,T as c,s as h,k as l,l as a,m as d,n as y,C as p}from"./QuadraticBezier.js";var _=p;function g(t,e){return{m_geometry:t,m_side:e}}function C(t,e,s,n,r,o){if(e.isEmpty()){const t=g(e,0);return void r.push(t)}if(s.isEmpty()){const t=g(e,0);return void r.push(t)}const m=[],i=new u;{const u=i.createGeometryUserIndex(),y=i.addGeometry(e),p=i.addGeometry(s),C=new c(o);let f=0,E=null;if(i.hasCurves()){E=new _;const t=i.getEnvelope2D(o);f=h(n.total());const e=l(n.total(),t);a(i,e,n.total(),12e3,E,null,o)}i.dbgVerifyCurves(),C.setEditShapeCrackAndCluster(i,n),C.cut(t,u,y,p,m);for(const t of m){null!==E&&E.stitchCurves(i,t,f,!1);const e=g(i.getGeometry(t),d(i.getGeometryUserIndex(t,u)));r.push(e)}null!==E&&E.clearStitcher(i)}}function f(t,e,s,n,r,o){if(e.isEmpty()){const t=g(e,0);return void r.push(t)}if(s.isEmpty()){const t=g(e,0);return void r.push(t)}const m=[],d=new u;{const t=d.createGeometryUserIndex(),p=d.addGeometry(e),C=d.addGeometry(s),f=new c(o);let E=0,G=null;if(d.hasCurves()){G=new _;const t=d.getEnvelope2D(o);E=h(n.total());const e=l(n.total(),t);a(d,e,n.total(),12e3,G,null,o)}d.dbgVerifyCurves(),f.setEditShapeCrackAndCluster(d,n),f.cut(!1,t,p,C,m),null!==G&&G.stitchCurves(d,y,E,!0);let v=d.getGeometry(p);const w=new i,x=new i,k=[];for(let e=0;e<m.length;e++){let s=null;{const r=new u,i=r.addGeometry(v),c=r.addGeometry(d.getGeometry(m[e]));if(r.hasCurves()){const t=r.getEnvelope2D(o);E=h(n.total());const e=l(n.total(),t);a(r,e,n.total(),12e3,G,null,o)}f.setEditShapeCrackAndCluster(r,n);const p=f.intersection(i,c);if(null!==G&&G.stitchCurves(r,y,E,!0),s=r.getGeometry(p),s.isEmpty())continue;const _=d.getGeometryUserIndex(m[e],t);2===_?w.add(s,!1):1===_?x.add(s,!1):k.push(s)}{const t=new u,s=t.addGeometry(v),r=t.addGeometry(d.getGeometry(m[e]));if(t.hasCurves()){const e=t.getEnvelope2D(o);E=h(n.total());const s=l(n.total(),e);a(t,s,n.total(),12e3,G,null,o)}f.setEditShapeCrackAndCluster(t,n);const i=f.difference(s,r);null!==G&&G.stitchCurves(t,y,E,!0);v=t.getGeometry(i)}}if(!v.isEmpty()&&m.length>0&&k.push(v),w.isEmpty()&&x.isEmpty())return;if(!w.isEmpty()){const t=g(w,1);r.push(t)}if(!x.isEmpty()){const t=g(x,2);r.push(t)}for(let e=0,s=k.length;e<s;++e){const t=g(k[e],3);r.push(t)}}}class E{getOperatorType(){return 10005}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}execute(t,e,s,n,r){return new G(t,e,s,n,r)}}class G extends t{constructor(t,e,s,n,i){super(),this.m_cutIndex=-1,this.m_cuts=[],this.m_progressTracker=i,this.m_cuttee=e.clone(),this.m_cutter=new r({copy:s}),this.m_bConsiderTouch=t;const u=o(e,s);this.m_tolerance=m(n,u,!0)}next(){return-1===this.m_cutIndex&&this.generateCuts(),++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return 0}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case e.enumPolyline:this.generatePolylineCuts();break;case e.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){const t=new r,e=new r,n=new r;this.m_cuts.length=0,this.m_cuts.push(t),this.m_cuts.push(e);const o=[];C(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,o,this.m_progressTracker);for(let r=0;r<o.length;r++){const m=o[r];1===m.m_side?t.add(m.m_geometry,!1):2===m.m_side||4===m.m_side?e.add(m.m_geometry,!1):3===m.m_side?this.m_cuts.push(m.m_geometry):0===m.m_side?n.add(m.m_geometry,!1):s("")}n.isEmpty()||t.isEmpty()&&e.isEmpty()&&!(this.m_cuts.length>=3)||this.m_cuts.push(n),t.isEmpty()&&e.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}generatePolygonCuts(){const t=new i,e=new i,r=new i;this.m_cuts.length=0,this.m_cuts.push(t),this.m_cuts.push(e);const o=[];f(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,o,this.m_progressTracker);for(let n=0;n<o.length;n++){const m=o[n];1===m.m_side?t.add(m.m_geometry,!1):2===m.m_side?e.add(m.m_geometry,!1):3===m.m_side?this.m_cuts.push(m.m_geometry):0===m.m_side?r.add(m.m_geometry,!1):s("")}n(r.isEmpty()||1===o.length),t.isEmpty()&&e.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}}export{E as O};
