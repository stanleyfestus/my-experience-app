/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{getNamedColor as t,hex2rgba as n}from"../../../../colorUtils.js";import{colormapName as r}from"../../rasterFunctionConstants.js";import{createRasterFunction as a}from"./utils.js";import{colorRampDict as e}from"../../../../renderers/support/colorRampUtils.js";function o(t){return"colormap"in t?s(t):"colorRamp"in t?i(t):u(t)}function s(r){const e=r.colormap.map((r=>{if("value"in r){const a="string"==typeof r.color?t(r.color)??n(r.color):r.color;(r=[r.value,...a])[4]&&r[4]<=1&&(r[4]=Math.round(255*r[4]))}return r})),{raster:o,outputPixelType:s}=r;return a("Colormap",{colormap:e,raster:o},s)}function i(t){const{raster:n,colorRamp:r,outputPixelType:e}=t,o={colorRamp:"toJSON"in r?r.toJSON():r,raster:n};return a("Colormap",o,e)}function u(t){const{colorRampName:n}=t,o=Object.values(r).find((t=>t.toLowerCase()===n?.toLowerCase())),s=e.toJSON(n),{raster:i,outputPixelType:u="unknown"}=t;return a("Colormap",o?{colormapName:o,raster:i}:{colorRampName:s,raster:i},u)}function l(t){const{raster:n,outputPixelType:r="u8"}=t;return a("ColormapToRGB",{raster:n},r)}function p(t){const{raster:n,histograms:r,outputPixelType:e}=t,o=t.statistics?.map((t=>({min:t.min,max:t.max,mean:t.avg,standardDeviation:t.stddev})));return a("StatisticsHistograms",{raster:n,statistics:o,histograms:r},e)}function c(t){const{raster:n,attributeTable:r,outputPixelType:e="unknown"}=t,o="toJSON"in r?r.toJSON():r;return a("Table",{raster:n,attributeTableAsRecordSet:o},e)}function m(t){const{raster:n,outputPixelType:r="unknown"}=t,e={raster:n,missingBandAction:"fail"===t.missingBandAction?1:0};return"bandIds"in t?e.bandIds=t.bandIds:"bandNames"in t?e.bandNames=t.bandNames:"bandWavelengths"in t&&(e.bandWavelengths=t.bandWavelengths),a("ExtractBand",e,r)}function d(t){const{rasters:n,outputPixelType:r}=t;return a("CompositeBand",{rasters:n},r)}function f(t){const{allowUnmatched:n,raster:r,rangeMaps:e,outputPixelType:o}=t,s=e?.filter((({output:t})=>null!=t)),i=s?.flatMap((({range:t})=>t)),u=s?.map((({output:t})=>t)),l=e?.filter((t=>null==t.output))?.flatMap((({range:t})=>t));return a("Remap",{allowUnmatched:n,raster:r,inputRanges:i,outputValues:u,noDataRanges:l},o)}function g(t){const{raster:n,outputPixelType:r="unknown"}=t,e=t.includedRanges?.flatMap((t=>t)),o=t.noDataValues?.map((t=>t.join(" "))),s="match-all"===t.noDataInterpretation?1:0;return a("Mask",{raster:n,includedRanges:e,noDataInterpretation:s,noDataValues:o},r)}function y(t){const{geometry:n,keepOutside:r,outputPixelType:e="unknown",raster:o}=t,s="declaredClass"in n?n.toJSON():n;return a("Clip",{clippingGeometry:s,clippingType:r?2:1,raster:o},e)}function T(t){const{weights:n,outputPixelType:r="unknown",raster:e}=t;return a("Grayscale",{conversionParameters:n,raster:e},r)}export{y as clip,o as colormap,l as colormapToRGB,d as compositeBands,m as extractBand,T as grayscale,g as mask,f as remap,p as statisticsHistogram,c as table};
