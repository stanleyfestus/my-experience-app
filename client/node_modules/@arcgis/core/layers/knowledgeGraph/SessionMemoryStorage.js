/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../../geometry.js";import{convertFromGeometry as e}from"../graphics/featureConversionUtils.js";import{OptimizedFeature as t}from"../graphics/OptimizedFeature.js";import{systemOriginIdFieldName as r,systemDestinationIdFieldName as i}from"./layerUtils.js";import{fromJSON as s}from"../../geometry/support/jsonUtils.js";class o{constructor(){this._featureLookup=new Map}static getInstance(){return o.instance||(o.instance=new o),o.instance}static resetInstance(){o.instance&&(o.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(o,p,n){const a=[];return o.forEach((o=>{if(!o?.id)return;o.properties||(o.properties=[]);let u,l=null;if(n&&o.properties[n]&&(l=e(o.properties[n])),"originId"in o&&"destinationId"in o&&(o.properties[r]=o.originId,o.properties[i]=o.destinationId),o.properties[p]=o.id,o.id&&this._featureLookup.has(o.id)&&this._featureLookup.get(o.id).attributes){const e=this._featureLookup.get(o.id),r=JSON.parse(JSON.stringify(Object.assign(e.attributes,o.properties)));n&&o.properties[n]&&(r[n]=s(o.properties[n])),u=new t(l?JSON.parse(JSON.stringify(l)):e?.geometry?JSON.parse(JSON.stringify(e.geometry)):null,r,null,o.properties[p])}else u=new t(l?JSON.parse(JSON.stringify(l)):null,o.properties,null,o.properties[p]);this._featureLookup.set(`${o.typeName?`${o.typeName}__${o.id}`:o.id}`,u),a.push(u)})),a}}export{o as default};
