/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import"../../geometry.js";import{throwIfNotAbortError as e}from"../../core/promiseUtils.js";import{geographicToWebMercator as r}from"../../geometry/support/webMercatorUtils.js";import t from"../OrientedImageryLayer.js";import o from"./core/ExposurePoint.js";import a from"../../rest/support/Query.js";import n from"../../geometry/Extent.js";const s={},i=1e3;async function c(o,n){const{point:c,queryParams:l}=o;if(null==c)return null;const y={};let p=o.layerInstanceOrURL;const f=c.spatialReference.isGeographic?r(c.clone()):c.clone();if(y.outSpatialReference=f.spatialReference,l&&(y.maxRecordCountFactor=l.maxRecordCountFactor??5,y.outFields=l.outFields??["*"],y.where=l.where??"1=1",y.returnGeometry=l.returnGeometry??!0,y.outSpatialReference=l.outSpatialReference),"string"==typeof p&&(s.layer&&s.layer.url===p?p=s.layer:(s.layer?.destroy(),p=s.layer=new t({url:p}))),p)try{await p.load();const e=p,r=u(f,l?.maximumDistance??e.maximumDistance??i);y.returnZ=e.hasZ;const t=new a({geometry:r,...y}),o=await e.queryFeatures(t,n);return m(e)(o)}catch(x){e(x)}return null}function m(e){return r=>{const{features:t,spatialReference:a}=r;return t.forEach((r=>{r.geometry&&(r.geometry.spatialReference=a);const t=o.fromJSON({...r.toJSON(),layer:e});t&&(r.attributes=t),r.layer=e,r.spatialReference=a})),r}}function u(e,r){const t=e.x-r,o=e.x+r,a=e.y-r,s=e.y+r;return new n({xmin:t,xmax:o,ymin:a,ymax:s,spatialReference:e.spatialReference})}export{u as createExtentFromPointAtDistance,c as searchImages};
