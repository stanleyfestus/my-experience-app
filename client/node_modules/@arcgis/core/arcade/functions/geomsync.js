/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import n from"../Dictionary.js";import{ArcadeExecutionError as e,ExecutionErrorCodes as t}from"../executionError.js";import{cloneGeometry as r,convertSquareUnitsToCode as i,convertLinearUnitsToCode as a}from"../kernel.js";import{H as l,G as o,k as f,n as u,m as s,j as c,o as h,q as d,x as m,J as w,K as p,L as g,M as v,g as P,h as I,b as y,N as R}from"../../chunks/languageUtils.js";import{centroidPolyline as j,centroidMultiPoint as N,getMetersPerVerticalUnitForSR as x,segmentLength3d as b}from"./centroid.js";import{measureToCoordinate as L,pointToCoordinate as A,distanceToCoordinate as O}from"./measures.js";import{getMetersPerUnitForSR as D}from"../../core/unitUtils.js";import M from"../../geometry/Extent.js";import k from"../../geometry/Geometry.js";import E from"../../geometry/Multipoint.js";import Z from"../../geometry/Point.js";import S from"../../geometry/Polygon.js";import T from"../../geometry/Polyline.js";import{fromJSON as q}from"../../geometry/support/jsonUtils.js";let z=null;function C(n){z=n}function J(n,e){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return 0;let t=1;if(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid){t=x(n.spatialReference)/D(n.spatialReference)}let r=0;if("polyline"===n.type)for(const a of n.paths)for(let n=1;n<a.length;n++)r+=b(a[n],a[n-1],t);else if("polygon"===n.type)for(const a of n.rings){for(let n=1;n<a.length;n++)r+=b(a[n],a[n-1],t);(a[0][0]!==a[a.length-1][0]||a[0][1]!==a[a.length-1][1]||void 0!==a[0][2]&&a[0][2]!==a[a.length-1][2])&&(r+=b(a[0],a[a.length-1],t))}else"extent"===n.type&&(r+=2*b([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],t),r+=2*b([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],t),r*=2,r+=4*Math.abs(p(n.zmax,0)*t-p(n.zmin,0)*t));const i=new T({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[[0,0],[0,r]]]});return z.planarLength(i,e)}function U(x,b){function D(n,r,i){if(o(i,2,2,n,r),i[0]instanceof k&&i[1]instanceof k);else if(i[0]instanceof k&&null===i[1]);else if(i[1]instanceof k&&null===i[0]);else if(null!==i[0]||null!==i[1])throw new e(n,t.InvalidParameter,r)}x.disjoint=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null===i[0]||null===i[1]||z.disjoint(i[0],i[1]))))},x.intersects=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.intersects(i[0],i[1]))))},x.touches=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.touches(i[0],i[1]))))},x.crosses=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.crosses(i[0],i[1]))))},x.within=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.within(i[0],i[1]))))},x.contains=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.contains(i[0],i[1]))))},x.overlaps=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null!==i[0]&&null!==i[1]&&z.overlaps(i[0],i[1]))))},x.equals=function(n,e){return b(n,e,((t,r,i)=>(o(i,2,2,n,e),i[0]===i[1]||(i[0]instanceof k&&i[1]instanceof k?z.equals(i[0],i[1]):(f(i[0])&&f(i[1])||u(i[0])&&u(i[1])||!(!s(i[0])||!s(i[1])))&&i[0].equals(i[1])))))},x.relate=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,3,3,n,r),f[0]instanceof k&&f[1]instanceof k)return z.relate(f[0],f[1],c(f[2]));if(f[0]instanceof k&&null===f[1])return!1;if(f[1]instanceof k&&null===f[0])return!1;if(null===f[0]&&null===f[1])return!1;throw new e(n,t.InvalidParameter,r)}))},x.intersection=function(n,e){return b(n,e,((t,r,i)=>(i=l(i),D(n,e,i),null===i[0]||null===i[1]?null:z.intersect(i[0],i[1]))))},x.union=function(n,i){return b(n,i,((a,o,f)=>{const u=[];if(0===(f=l(f)).length)throw new e(n,t.WrongNumberOfParameters,i);if(1===f.length)if(h(f[0])){const r=l(f[0]);for(let a=0;a<r.length;a++)if(null!==r[a]){if(!(r[a]instanceof k))throw new e(n,t.InvalidParameter,i);u.push(r[a])}}else{if(!d(f[0])){if(f[0]instanceof k)return m(r(f[0]),n.spatialReference);if(null===f[0])return null;throw new e(n,t.InvalidParameter,i)}{const r=l(f[0].toArray());for(let a=0;a<r.length;a++)if(null!==r[a]){if(!(r[a]instanceof k))throw new e(n,t.InvalidParameter,i);u.push(r[a])}}}else for(let r=0;r<f.length;r++)if(null!==f[r]){if(!(f[r]instanceof k))throw new e(n,t.InvalidParameter,i);u.push(f[r])}return 0===u.length?null:z.union(u)}))},x.difference=function(n,e){return b(n,e,((t,i,a)=>(a=l(a),D(n,e,a),null===a[0]?null:null===a[1]?r(a[0]):z.difference(a[0],a[1]))))},x.symmetricdifference=function(n,e){return b(n,e,((t,i,a)=>(a=l(a),D(n,e,a),null===a[0]&&null===a[1]?null:null===a[0]?r(a[1]):null===a[1]?r(a[0]):z.symmetricDifference(a[0],a[1]))))},x.clip=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,2,2,n,r),!(f[1]instanceof M)&&null!==f[1])throw new e(n,t.InvalidParameter,r);if(null===f[0])return null;if(!(f[0]instanceof k))throw new e(n,t.InvalidParameter,r);return null===f[1]?null:z.clip(f[0],f[1])}))},x.cut=function(n,i){return b(n,i,((a,f,u)=>{if(u=l(u),o(u,2,2,n,i),!(u[1]instanceof T)&&null!==u[1])throw new e(n,t.InvalidParameter,i);if(null===u[0])return[];if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,i);return null===u[1]?[r(u[0])]:z.cut(u[0],u[1])}))},x.area=function(n,r){return b(n,r,((a,f,u)=>{if(o(u,1,2,n,r),null===(u=l(u))[0])return 0;if(h(u[0])||d(u[0])){const e=w(u[0],n.spatialReference);return null===e?0:z.planarArea(e,i(p(u[1],-1)))}if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.planarArea(u[0],i(p(u[1],-1)))}))},x.areageodetic=function(n,r){return b(n,r,((a,f,u)=>{if(o(u,1,2,n,r),null===(u=l(u))[0])return 0;if(h(u[0])||d(u[0])){const e=w(u[0],n.spatialReference);return null===e?0:z.geodesicArea(e,i(p(u[1],-1)))}if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.geodesicArea(u[0],i(p(u[1],-1)))}))},x.length=function(n,r){return b(n,r,((i,f,u)=>{if(o(u,1,2,n,r),null===(u=l(u))[0])return 0;if(h(u[0])||d(u[0])){const e=g(u[0],n.spatialReference);return null===e?0:z.planarLength(e,a(p(u[1],-1)))}if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.planarLength(u[0],a(p(u[1],-1)))}))},x.length3d=function(n,r){return b(n,r,((i,f,u)=>{if(o(u,1,2,n,r),null===(u=l(u))[0])return 0;if(h(u[0])||d(u[0])){const e=g(u[0],n.spatialReference);return null===e?0:!0===e.hasZ?J(e,a(p(u[1],-1))):z.planarLength(e,a(p(u[1],-1)))}if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);return!0===u[0].hasZ?J(u[0],a(p(u[1],-1))):z.planarLength(u[0],a(p(u[1],-1)))}))},x.lengthgeodetic=function(n,r){return b(n,r,((i,f,u)=>{if(o(u,1,2,n,r),null===(u=l(u))[0])return 0;if(h(u[0])||d(u[0])){const e=g(u[0],n.spatialReference);return null===e?0:z.geodesicLength(e,a(p(u[1],-1)))}if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.geodesicLength(u[0],a(p(u[1],-1)))}))},x.distance=function(n,r){return b(n,r,((i,f,u)=>{u=l(u),o(u,2,3,n,r);let s=u[0];(h(u[0])||d(u[0]))&&(s=v(u[0],n.spatialReference));let c=u[1];if((h(u[1])||d(u[1]))&&(c=v(u[1],n.spatialReference)),!(s instanceof k))throw new e(n,t.InvalidParameter,r);if(!(c instanceof k))throw new e(n,t.InvalidParameter,r);return z.distance(s,c,a(p(u[2],-1)))}))},x.distancegeodetic=function(n,r){return b(n,r,((i,f,u)=>{u=l(u),o(u,2,3,n,r);const s=u[0],c=u[1];if(!(s instanceof Z))throw new e(n,t.InvalidParameter,r);if(!(c instanceof Z))throw new e(n,t.InvalidParameter,r);const h=new T({paths:[],spatialReference:s.spatialReference});return h.addPath([s,c]),z.geodesicLength(h,a(p(u[2],-1)))}))},x.densify=function(n,r){return b(n,r,((i,f,u)=>{if(u=l(u),o(u,2,3,n,r),null===u[0])return null;if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);const s=P(u[1]);if(isNaN(s))throw new e(n,t.InvalidParameter,r);if(s<=0)throw new e(n,t.InvalidParameter,r);return u[0]instanceof S||u[0]instanceof T?z.densify(u[0],s,a(p(u[2],-1))):u[0]instanceof M?z.densify(S.fromExtent(u[0]),s,a(p(u[2],-1))):u[0]}))},x.densifygeodetic=function(n,r){return b(n,r,((i,f,u)=>{if(u=l(u),o(u,2,3,n,r),null===u[0])return null;if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);const s=P(u[1]);if(isNaN(s))throw new e(n,t.InvalidParameter,r);if(s<=0)throw new e(n,t.InvalidParameter,r);return u[0]instanceof S||u[0]instanceof T?z.geodesicDensify(u[0],s,a(p(u[2],-1))):u[0]instanceof M?z.geodesicDensify(S.fromExtent(u[0]),s,a(p(u[2],-1))):u[0]}))},x.generalize=function(n,r){return b(n,r,((i,f,u)=>{if(u=l(u),o(u,2,4,n,r),null===u[0])return null;if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,r);const s=P(u[1]);if(isNaN(s))throw new e(n,t.InvalidParameter,r);return z.generalize(u[0],s,I(p(u[2],!0)),a(p(u[3],-1)))}))},x.buffer=function(n,i){return b(n,i,((f,u,s)=>{if(s=l(s),o(s,2,3,n,i),null===s[0])return null;if(!(s[0]instanceof k))throw new e(n,t.InvalidParameter,i);const c=P(s[1]);if(isNaN(c))throw new e(n,t.InvalidParameter,i);return 0===c?r(s[0]):z.buffer(s[0],c,a(p(s[2],-1)))}))},x.buffergeodetic=function(n,i){return b(n,i,((f,u,s)=>{if(s=l(s),o(s,2,3,n,i),null===s[0])return null;if(!(s[0]instanceof k))throw new e(n,t.InvalidParameter,i);const c=P(s[1]);if(isNaN(c))throw new e(n,t.InvalidParameter,i);return 0===c?r(s[0]):z.geodesicBuffer(s[0],c,a(p(s[2],-1)))}))},x.offset=function(n,r){return b(n,r,((i,f,u)=>{if(u=l(u),o(u,2,6,n,r),null===u[0])return null;if(!(u[0]instanceof S||u[0]instanceof T))throw new e(n,t.InvalidParameter,r);const s=P(u[1]);if(isNaN(s))throw new e(n,t.InvalidParameter,r);const h=P(p(u[4],10));if(isNaN(h))throw new e(n,t.InvalidParameter,r);const d=P(p(u[5],0));if(isNaN(d))throw new e(n,t.InvalidParameter,r);return z.offset(u[0],s,a(p(u[2],-1)),c(p(u[3],"round")).toLowerCase(),h,d)}))},x.rotate=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,2,3,n,r),null===f[0])return null;if(!(f[0]instanceof k))throw new e(n,t.InvalidParameter,r);const u=f[0]instanceof M?S.fromExtent(f[0]):f[0],s=P(f[1]);if(isNaN(s))throw new e(n,t.InvalidParameter,r);const c=p(f[2],null);if(null===c)return z.rotate(u,s);if(c instanceof Z)return z.rotate(u,s,c);throw new e(n,t.InvalidParameter,r)}))},x.centroid=function(n,i){return b(n,i,((a,f,u)=>{if(u=l(u),o(u,1,1,n,i),null===u[0])return null;let s=u[0];if((h(u[0])||d(u[0]))&&(s=v(u[0],n.spatialReference)),null===s)return null;if(!(s instanceof k))throw new e(n,t.InvalidParameter,i);return s instanceof Z?m(r(s),n.spatialReference):s instanceof S?s.centroid:s instanceof T?j(s):s instanceof E?N(s):s instanceof M?s.center:null}))},x.measuretocoordinate=function(r,i){return b(r,i,((a,f,u)=>{if(u=l(u),o(u,2,2,r,i),null===u[0])return null;let s=u[0];if((h(u[0])||d(u[0]))&&(s=g(u[0],r.spatialReference)),null===s)return null;if(!(s instanceof k))throw new e(r,t.InvalidParameter,i);if(!(s instanceof T))throw new e(r,t.InvalidParameter,i);if(y(!1===u[1]))throw new e(r,t.InvalidParameter,i);const c=L(s,u[1]);return c?n.convertObjectToArcadeDictionary(c,R(r),!1,!0):null}))},x.pointtocoordinate=function(r,i){return b(r,i,((a,f,u)=>{if(u=l(u),o(u,2,2,r,i),null===u[0])return null;let s=u[0];if((h(u[0])||d(u[0]))&&(s=g(u[0],r.spatialReference)),null===s)return null;if(!(s instanceof k))throw new e(r,t.InvalidParameter,i);if(!(s instanceof T))throw new e(r,t.InvalidParameter,i);const c=u[1];if(null===c)return null;if(!(c instanceof Z))throw new e(r,t.InvalidParameter,i);if(y(!1===u[1]))throw new e(r,t.InvalidParameter,i);const m=A(s,c);return m?n.convertObjectToArcadeDictionary(m,R(r),!1,!0):null}))},x.distancetocoordinate=function(r,i){return b(r,i,((a,f,u)=>{if(u=l(u),o(u,2,2,r,i),null===u[0])return null;let s=u[0];if((h(u[0])||d(u[0]))&&(s=g(u[0],r.spatialReference)),null===s)return null;if(!(s instanceof k))throw new e(r,t.InvalidParameter,i);if(!(s instanceof T))throw new e(r,t.InvalidParameter,i);if(y(!1===u[1]))throw new e(r,t.InvalidParameter,i);const c=O(s,u[1]);return c?n.convertObjectToArcadeDictionary(c,R(r),!1,!0):null}))},x.multiparttosinglepart=function(n,i){return b(n,i,((a,f,u)=>{if(u=l(u),o(u,1,1,n,i),null===u[0])return null;if(!(u[0]instanceof k))throw new e(n,t.InvalidParameter,i);if(u[0]instanceof Z)return[m(r(u[0]),n.spatialReference)];if(u[0]instanceof M)return[m(r(u[0]),n.spatialReference)];const s=z.simplify(u[0]);if(s instanceof S){const n=[],e=[];for(let t=0;t<s.rings.length;t++)if(s.isClockwise(s.rings[t])){const e=q({rings:[s.rings[t]],hasZ:!0===s.hasZ,hasM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});n.push(e)}else e.push({ring:s.rings[t],pt:s.getPoint(t,0)});for(let t=0;t<e.length;t++)for(let r=0;r<n.length;r++)if(n[r].contains(e[t].pt)){n[r].addRing(e[t].ring);break}return n}if(s instanceof T){const n=[];for(let e=0;e<s.paths.length;e++){const t=q({paths:[s.paths[e]],hasZ:!0===s.hasZ,hasM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});n.push(t)}return n}if(u[0]instanceof E){const e=[],t=m(r(u[0]),n.spatialReference);for(let n=0;n<t.points.length;n++)e.push(t.getPoint(n));return e}return null}))},x.issimple=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,1,1,n,r),null===f[0])return!0;if(!(f[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.isSimple(f[0])}))},x.simplify=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,1,1,n,r),null===f[0])return null;if(!(f[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.simplify(f[0])}))},x.convexhull=function(n,r){return b(n,r,((i,a,f)=>{if(f=l(f),o(f,1,1,n,r),null===f[0])return null;if(!(f[0]instanceof k))throw new e(n,t.InvalidParameter,r);return z.convexHull(f[0])}))},x.nearestcoordinate=function(r,i){return b(r,i,((a,f,u)=>{if(u=l(u),o(u,2,2,r,i),!(u[0]instanceof k||null===u[0]))throw new e(r,t.InvalidParameter,i);if(!(u[1]instanceof Z||null===u[1]))throw new e(r,t.InvalidParameter,i);if(null===u[0]||null===u[1])return null;const s=z.nearestCoordinate(u[0],u[1]);return null===s||s.isEmpty?null:n.convertObjectToArcadeDictionary({coordinate:s.coordinate,distance:s.distance,sideOfLine:0===s.distance?"straddle":s.isRightSide?"right":"left"},R(r),!1,!0)}))},x.nearestvertex=function(r,i){return b(r,i,((a,f,u)=>{if(u=l(u),o(u,2,2,r,i),!(u[0]instanceof k||null===u[0]))throw new e(r,t.InvalidParameter,i);if(!(u[1]instanceof Z||null===u[1]))throw new e(r,t.InvalidParameter,i);if(null===u[0]||null===u[1])return null;const s=z.nearestVertex(u[0],u[1]);return null===s||s.isEmpty?null:n.convertObjectToArcadeDictionary({coordinate:s.coordinate,distance:s.distance,sideOfLine:0===s.distance?"straddle":s.isRightSide?"right":"left"},R(r),!1,!0)}))}}export{U as registerFunctions,C as setGeometryEngine};
