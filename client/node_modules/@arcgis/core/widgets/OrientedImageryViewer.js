/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{prefersReducedMotion as t}from"../core/a11yUtils.js";import{deprecatedProperty as i}from"../core/deprecate.js";import a from"../core/Logger.js";import{deg2rad as s}from"../core/mathUtils.js";import{watch as o,initial as r,syncAndInitial as n,whenOnce as l,once as c}from"../core/reactiveUtils.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/RandomLCG.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import{rotatePixel as g}from"../layers/orientedImagery/transformations/utils.js";import m from"../layers/support/rasterDatasets/RasterFactory.js";import v from"./Widget.js";import{getAllArcPath as p}from"./OrientedImageryViewer/arcUtils.js";import{segmentArcs as u,sectorsRadii as y,featureCircleRadius as b,navigationToolDimensionLength as w}from"./OrientedImageryViewer/constants.js";import{css as _,navigation as C,navigationToolRotationFrom as M,navigationToolRotationTo as f,root as I}from"./OrientedImageryViewer/css.js";import O from"./OrientedImageryViewer/OrientedImageryViewerViewModel.js";import A from"./OrientedImageryViewer/OrientedImageryViewerVisibleElements.js";import T from"./OrientedImageryViewer/components/ImageOverlays.js";import{loadCalciteComponents as E}from"./support/componentsUtils.js";import{globalCss as V}from"./support/globalCss.js";import"./support/widgetUtils.js";import{messageBundle as x}from"./support/decorators/messageBundle.js";import{tsx as F}from"./support/jsxFactory.js";import{substitute as k}from"../intl/substitute.js";const L={overlayMapFeatures:"overlay-map-features",overlayed:"overlayed"};let P=class extends v{constructor(e,t){super(e,t),this.galleryOpened=!1,this.imageEnhancementToolActive=!1,this.imageOverlaysOpened=!1,this.navigationToolActive=!1,this.viewModel=new O,this.messagesCommon=null,this.visibleElements=new A,this._navigationToolExpanded=!1,this._navigationTool=null,this._imageOverlays=new T,this._warningTitleElement=null,this._actionItems=new Map,this._galleryController=new AbortController,this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this)),this._createAndAddOverlayLayerVisibilityHandle=e=>{this.addHandles(o((()=>e.visible),(()=>{this.viewModel.toggleOverlayMapFeatures(e.id,e.visible)})),`${L.overlayed}-${e.id}`)},this._createHandlesForOverlayMapFeatures=()=>{this.viewModel.removeAllOverlayMapFeatures();const{selectedItems:e}=this._imageOverlays.layerList;e.forEach(this._handleOverlayLayerSelect)},this._createOverlayLayersListChangeHandle=()=>{this.addHandles(this._imageOverlays.layerList.selectedItems.on("change",(({added:e,removed:t})=>{e.forEach(this._handleOverlayLayerSelect),t.forEach(this._handleOverlayLayerDeselect)})))},this._handleOverlayLayerDeselect=e=>{const t=e.layer;this.viewModel.removeOverlayedGraphicsOnImage(`${t.id}`),this.removeHandles(`${L.overlayed}-${t.id}`)},this._handleOverlayLayerSelect=e=>{const t=e.layer;this.viewModel.overlayMapFeatures(t,this._imageOverlays.showMapFeatures),this._createAndAddOverlayLayerVisibilityHandle(t)},this._highlight=e=>{const t=e.target?.dataset.objectid;t&&this.viewModel.highlight(t)},this._removeHighlight=()=>this.viewModel.removeHighlight(),this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded},this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()},this._loadImageFromGallery=this._loadImageFromGallery.bind(this),this._registerGalleryItem=this._registerGalleryItem.bind(this),this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this),this._renderViewerContainer=this._renderViewerContainer.bind(this),this.loadImageFromSource=this.loadImageFromSource.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this)}initialize(){this._createOverlayLayersListChangeHandle(),this.addHandles([o((()=>[this.viewModel?.bestFeatureAngle,this._navigationTool]),(([e,t])=>{t&&this._updateNavigationTool(t)}),r),o((()=>this.currentCoverageVisible),(e=>this._onCurrentCoverageVisibilityChange(e))),o((()=>this.isAdditionalCoverageVisible),(e=>this._onAdditionalCoverageVisibilityChange(e))),o((()=>this.isAdditionalPointSourcesVisible),(e=>this._onAdditionalCameraLocationsVisibility(e))),o((()=>this.viewModel),(()=>this._imageOverlays.viewModel=this.viewModel),n),o((()=>this.messages),(()=>this._imageOverlays.messages=this.messages),n),o((()=>[this.currentBestFeature,this._imageOverlays.showCameraLocations,this.viewModel.state]),(([e,t,i])=>{"image-loaded"===i&&this.viewModel.overlayCameraLocations(t)}),n),o((()=>[this.currentBestFeature,this._imageOverlays.showMapFeatures,this.viewModel.state]),((e,t)=>{t?.[1]!==e[1]&&this.viewModel.toggleAllOverlayMapFeatures(e[1]),e[0]&&e[0]!==t?.[0]&&l((()=>"image-loaded"===this.viewModel.state)).then(this._createHandlesForOverlayMapFeatures)}),r)])}loadDependencies(){return E({"action-bar":()=>import("@esri/calcite-components/dist/components/calcite-action-bar.js"),"action-group":()=>import("@esri/calcite-components/dist/components/calcite-action-group.js"),action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),label:()=>import("@esri/calcite-components/dist/components/calcite-label.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js"),panel:()=>import("@esri/calcite-components/dist/components/calcite-panel.js"),slider:()=>import("@esri/calcite-components/dist/components/calcite-slider.js"),tooltip:()=>import("@esri/calcite-components/dist/components/calcite-tooltip.js")})}destroy(){this._galleryController.abort(),this._galleryObserver.disconnect()}get activeLayer(){return i(a.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){i(a.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(e){this.viewModel.currentBestFeature=e}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(e){this.viewModel.currentCoverageVisible=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get displayMessage(){return this.viewModel.displayMessage}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(e){this._overrideIfSome("icon",e)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(e){this.viewModel.isAdditionalCoverageVisible=e}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(e){this.viewModel.isAdditionalPointSourcesVisible=e}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(e){this.viewModel.mapImageConversionToolState=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get popupEnabled(){const{popupEnabled:e,state:t}=this.viewModel;return"image-loaded"===t&&e}get referencePoint(){return this.viewModel.referencePoint??null}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set determineWorkflowForFeature(e){this.viewModel.determineWorkflowForFeature=e}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(e){this.viewModel.updateFootprint=e}get updateFootprint(){return this.viewModel.updateFootprint}async _getThumbnailPixelBlockInternal(e,t){const{level:i,offset:s,size:o}=this._getMaxLevelRasterParameters(e);try{const{pixelBlock:a}=await e.fetchRawPixels(i,s,o,t);return a}catch(r){a.getLogger(this).warn("failed to create canvas with pixel data",r)}return null}_getMaxLevelRasterParameters(e){const{storageInfo:t,width:i,height:a}=e.rasterInfo,{maximumPyramidLevel:s,pyramidScalingFactor:o}=t,r=o??2;return{level:s,offset:{x:0,y:0},size:{width:Math.ceil(i/r**s),height:Math.ceil(a/r**s)}}}async _getThumbnailPixelBlock(e){const{signal:t}=this._galleryController;try{const{origin:i,pathname:a,searchParams:s}=new URL(e),o=await m.open({ioConfig:{customFetchParameters:Object.fromEntries(s),skipMapInfo:!0},url:`${i}${a}`,signal:t});return o?await this._getThumbnailPixelBlockInternal(o,{signal:t}):null}catch(i){a.getLogger(this).error("failed to create thumbnail",i)}return null}_handleBrightnessChange(e){this.viewModel.brightness=e.target.value??0}_handleContrastChange(e){this.viewModel.contrast=e.target.value??0}_handleSharpnessChange(e){this.viewModel.sharpness=e.target.value??0}_lazyLoadImage(e,t){e.forEach((async e=>{if(e.isIntersecting){const i=e.target,o=i.getAttribute("data-src"),r=i.getAttribute("data-rotation"),n=r?parseFloat(r)%360:null;if(!o)return;const l=await this._getThumbnailPixelBlock(o);if(!l)return;i.width=l.width,i.height=l.height;const c=i.getContext("2d");if(!c)return;const d=c.createImageData(i.width,i.height);if(d.data.set(l.getAsRGBA()),"number"==typeof n&&0!==n){const e=s(n),o=document.createElement("canvas"),r=o.getContext("2d");if(r){o.width=d.width,o.height=d.height,r.putImageData(d,0,0);const a=g(0,0,e),s=g(d.width,0,e),n=g(d.width,d.height,e),l=g(0,d.height,e),h=Math.max(a[0],s[0],n[0],l[0])-Math.min(a[0],s[0],n[0],l[0]),m=Math.max(a[1],s[1],n[1],l[1])-Math.min(a[1],s[1],n[1],l[1]),v=Math.min(i.width/h,i.height/m);return c.save(),c.clearRect(0,0,i.width,i.height),c.translate(i.width/2,i.height/2),c.rotate(e),c.scale(v,v),c.drawImage(o,-d.width/2,-d.height/2,d.width,d.height),c.restore(),t.unobserve(i)}a.getLogger(this).warn("oriented-imagery-viewer:image-gallery","failed to apply rotation on thumbnail")}c.putImageData(d,0,0),t.unobserve(i)}}))}_loadImageFromGallery(e){const{target:t}=e;if(!t)return;const i=t.getAttribute("data-objectid");i&&this.viewModel.currentBestFeature?.attributes.objectId!==Number(i)&&this.viewModel.selectBestFeature(i)}_onAdditionalCoverageVisibilityChange(e){this.viewModel.setAdditionalCoverageVisibility(e)}_onAdditionalCameraLocationsVisibility(e){this.viewModel.setAdditionalCameraLocationsVisibility(e)}_onCurrentCoverageVisibilityChange(e){this.viewModel.setCurrentCoverageVisibility(e)}_registerGalleryItem(e){this._galleryObserver.observe(e)}_renderActionTooltips(){return[...this._actionItems].map((([e,t])=>F("calcite-tooltip",{key:e,label:e,referenceElement:t},F("span",null,e))))}_renderBody(){return F("div",{class:_.body},this._renderViewerContainer(),this.invalidCameraHeading?[this._renderWarning(this.messages.invalidCameraHeadingWarningTitle),this._renderWarningTooltip(this.messages.invalidCameraHeadingWarningDescription)]:[this._renderImageGallery(),this._renderNavigation(),this._renderImageOverlays()],this._renderImageEnhancementTools())}_renderImageEnhancementAction(){const{state:e,mode:t}=this.viewModel;return F("calcite-action",{active:this.imageEnhancementToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"default"!==t||"image-loaded"!==e,icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement})}_renderImageEnhancementTools(){const{imageEnhancementToolActive:e,viewModel:{brightness:t,contrast:i,sharpness:a,state:s}}=this;return e&&"image-loaded"===s?F("calcite-panel",{bind:this,class:_.imageEnhancementWrapper,closable:!0,closed:!e,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},F("div",{class:_.imageEnhancementTools},F("div",{class:_.imageEnhancementToolContainer},F("calcite-label",null,this.messages.brightness,F("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:t,onCalciteSliderInput:this._handleBrightnessChange}))),F("div",{class:_.imageEnhancementToolContainer},F("calcite-label",null,this.messages.contrast,F("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:i,onCalciteSliderInput:this._handleContrastChange}))),F("div",{class:_.imageEnhancementToolContainer},F("calcite-label",null,this.messages.sharpness,F("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:a,onCalciteSliderInput:this._handleSharpnessChange})))),F("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset})):null}_renderImageGallery(){const{container:e,galleryOpened:t,imageGalleryEnabled:i,viewModel:{thumbnails:a},invalidCameraHeading:s}=this;return i&&t&&(e&&a)?F("calcite-panel",{bind:this,class:_.carousel,closable:!0,closed:!t,disabled:s,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},F("div",{class:_.carouselContainer},this._renderThumbnails(a))):null}_renderImageOverlaysAction(){const{viewModel:{state:e},imageOverlaysOpened:t,invalidCameraHeading:i}=this;return F("calcite-action",{active:t,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==e||i,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays})}_renderImageOverlays(){const{imageOverlaysOpened:e,viewModel:{state:t}}=this;if(e&&"image-loaded"===t)return this._imageOverlays.closed&&(this._imageOverlays.closed=!1),c((()=>this._imageOverlays.closed)).then((()=>this.imageOverlaysOpened=!1)),F("div",{class:_.imageOverlaysContainer,key:this.messages.imageOverlays},this._imageOverlays.render())}_renderWarning(e){const{invalidCameraHeading:t,viewModel:{state:i}}=this;return t&&"image-loaded"===i?[F("calcite-notice",{class:_.alert,closable:!0,icon:"exclamation-mark-triangle-f",iconFlipRtl:!0,kind:"warning",open:!0,scale:"s"},F("div",{afterCreate:e=>this._storeWarningTitleElement(e),slot:"title"},e))]:null}_renderWarningTooltip(e){const{_warningTitleElement:t}=this;if(e?.length&&t)return F("calcite-tooltip",{closeOnClick:!0,referenceElement:t},e)}_renderMapImageConversionTool(){const{mapImageConversionToolState:e,viewModel:{state:t},invalidCameraHeading:i}=this;return F("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==t||i,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool})}_renderNavigation(){const{viewModel:{sectorData:e,navigatorCurrentBestFeature:i,currentBestFeature:a,state:s}}=this;if(!this.container||!a)return null;let o,r,n,l,c;if(i){const{x:e,y:t,direction:a}=i,[s,d,h,g]=u[a];o=`M ${e} ${t} L ${s} ${d} A ${y[2]} ${y[2]} 0 0 1 ${h} ${g} Z`,r=e,l=t,n=u[a][4],c=u[a][5]}const d=e=>{const t=e.target.dataset?.sector;t&&this.viewModel.handleSectorClick(+t)},h=e=>{const t=e.target.dataset;if(!t)return;const{featureIndexInSector:i,sector:a}=t;i&&a&&this.viewModel.handleFeatureClick({sector:a,featureIndexInSector:+i})},g=e=>{e.removeEventListener("click",h)},m=a.attributes.objectId,v=e?.map((e=>e?.items)).filter(Boolean).flatMap((e=>e?.map((({x:e,y:t,objectID:i,featureIndexInSector:a,sector:s})=>F("circle",{afterRemoved:g,class:this.classes(_.feature,{selected:m===i}),cx:e,cy:t,"data-feature-index-in-sector":a,"data-sector":s,key:`${_.feature}-${i}`,onclick:h,r:b}))))),M=e=>{e.removeEventListener("click",d)},f=this.classes({[_.navigationWrapper]:!0,[_.navigationZoomed]:this._navigationToolExpanded});return this.navigationToolActive&&"image-loaded"===s?F("div",{bind:this,class:f,key:this.messages.navigationTool},F("svg",{afterCreate:e=>this._storeNavigationToolReference(e),class:t()?C:_.rotateWithAnimation,focusable:"false",height:w,role:"img",width:w,xmlns:"http://www.w3.org/2000/svg"},F("defs",null,F("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:r,x2:n,y1:l,y2:c},F("stop",{class:_.navigationPathOffset0,offset:0}),F("stop",{class:_.navigationPathOffset1,offset:1}))),F("g",null,F("circle",{class:this.classes(_.sector,_.outerSector),cx:y[3],cy:y[3],onclick:this._scaleNavigationTool,r:y[3]}),F("circle",{class:_.sector,cx:y[3],cy:y[3],r:y[2]}),F("circle",{class:_.sector,cx:y[3],cy:y[3],r:y[1]}),F("circle",{class:_.sector,cx:y[3],cy:y[3],r:y[0]}),F("path",{class:_.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${_.pointer}-west`}),F("path",{class:this.classes(_.pointer,_.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${_.pointer}-north`}),F("path",{class:_.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${_.pointer}-east`}),F("path",{class:_.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${_.pointer}-south`}),F("path",{class:this.classes(_.sector,_.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:_.sectorSeparator}),p([y[2],y[1],y[0]],y[3],y[3]).map(((t,i)=>F("path",{afterRemoved:M,class:this.classes(_.sector,e?.[i]?.length?_.sectorEnabled:_.sectorDisabled),d:t,"data-sector":`${i}`,key:`${_.sector}-${i}`,onclick:d}))),F("path",{class:this.classes(_.sector,_.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:_.sectorCross}),v,a.attributes.cameraPitch>=5&&o?F("path",{class:_.selectedFeaturePath,d:o,fill:`url(#${this.id}-coverage-fill)`,key:_.selectedFeaturePath}):null))):null}_renderNavigationToolAction(){const{state:e}=this.viewModel;return F("calcite-action",{active:this.navigationToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==e||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool})}_renderMenuBarContainer(){const{currentCoverageVisible:e,isAdditionalCoverageVisible:t,isAdditionalPointSourcesVisible:i,imageGalleryEnabled:a,invalidCameraHeading:s}=this;return F("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},F("calcite-action-group",{expanded:!0},F("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,class:_.currentCoverage,disabled:s,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}),F("calcite-action",{active:t,afterCreate:this._storeActionElement,bind:this,class:_.addCoverage,disabled:s,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}),F("calcite-action",{active:i,afterCreate:this._storeActionElement,bind:this,class:_.addExpPoints,disabled:s,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations})),F("calcite-action-group",{layout:"horizontal"},this.visibleElements.mapImageConversionTool?this._renderMapImageConversionTool():null,this.visibleElements.navigationTool?this._renderNavigationToolAction():null,this.visibleElements.imageEnhancement?this._renderImageEnhancementAction():null),F("calcite-action-group",null,F("calcite-action",{active:this.galleryOpened,afterCreate:this._storeActionElement,bind:this,disabled:!a||s,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery,textEnabled:!0}),this.visibleElements.imageOverlays?this._renderImageOverlaysAction():null,this.visibleElements.showPopupsAction?this._renderPopupAction():null),this._renderActionTooltips())}_renderMessageBox(){const{messages:e,viewModel:{displayMessage:t}}=this;if(!t)return null;const{data:i,key:a,map:s}=t,o=`${s?k(e[a],s):e[a]}`;return F("span",{class:_.messageBox},i?`${o} ${i}`:o)}_renderPopupAction(){return F("calcite-action",{afterCreate:this._storeActionElement,bind:this,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups,textEnabled:!0})}_renderThumbnails(e){const{currentBestFeature:t}=this.viewModel;return t?F("div",{class:_.carouselContent},e.items.map((({url:e,objectId:i,rotation:a},s)=>F("div",{class:`${_.carouselItemWrapper}${t.attributes.objectId===i?"--selected":""}`,key:`${_.carouselItemWrapper}-${s}`},F("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${i}`,class:_.carouselItem,"data-objectid":`${i}`,"data-rotation":`${a}`,"data-src":e,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight}))))):null}_renderViewerContainer(){return F("div",{class:_.viewerContainer},this._renderImageViewer(),this._renderPanoramicViewer(),this._renderMessageBox())}_renderImageViewer(){const{displayMessage:e,loadImageViewer:t,mode:i}=this.viewModel,a=null!=e||"default"!==i,s=this.classes({[_.viewer]:!a,[_.viewerHidden]:a});return F("calcite-panel",{afterCreate:t,bind:this,class:s})}_renderPanoramicViewer(){const{displayMessage:e,loadPanoramicViewer:t,mode:i}=this.viewModel,a=null!=e||"panoramic"!==i,s=this.classes({[_.viewer]:!a,[_.viewerHidden]:a});return F("calcite-panel",{afterCreate:t,bind:this,class:s})}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}_storeActionElement(e){this._actionItems.set(e.text,e)}_storeNavigationToolReference(e){this._navigationTool=e}_storeWarningTitleElement(e){this._warningTitleElement=e}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleImageEnhancementToolState(e){e.stopPropagation(),this.imageEnhancementToolActive=!this.imageEnhancementToolActive,this.imageEnhancementToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleImageOverlays(e){e.stopPropagation(),this.imageOverlaysOpened=!this.imageOverlaysOpened,this.imageOverlaysOpened&&(this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1))}_toggleImageGallery(e){e.stopPropagation(),this.galleryOpened=!!this.imageGalleryEnabled&&!this.galleryOpened,this.galleryOpened&&(this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleNavigationTool(){this.navigationToolActive=!this.navigationToolActive,this.navigationToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1))}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=!this.mapImageConversionToolState}_unregisterGalleryItem(e){this._galleryObserver.unobserve(e)}_updateNavigationTool(e){const{previousFeatureAngle:t,bestFeatureAngle:i}=this.viewModel,a=(i-t+540)%360-180;e.style.setProperty(M,`${t}deg`),e.style.setProperty(f,`${t+a}deg`)}async loadBestImage(e){return this.viewModel.loadBestImage(e)}loadImageFromSource(e,t){return this.viewModel.loadImageFromSource(e,t)}async plotMapPoint(e){return this.viewModel.plotMapPoint(e)}plotReferencePointOnGround(e){this.viewModel.plotReferencePointOnGround(e)}plotReferencePointOnImage(e){this.viewModel.plotReferencePointOnImage(e)}resetImage(){this.viewModel.resetImage()}render(){const{viewModel:{state:e}}=this;return F("div",{class:this.classes(V.widget,I)},F("calcite-panel",{bind:this,heading:this.visibleElements.title?this.messages.title:void 0,loading:"image-loading"===e},this.visibleElements.coverageMenu?this._renderMenuBarContainer():null,this._renderBody()))}updateSuitabilities(e){this.viewModel.updateSuitabilities(e)}};e([d()],P.prototype,"activeLayer",null),e([d()],P.prototype,"currentBestFeature",null),e([d()],P.prototype,"currentCoverageVisible",null),e([d()],P.prototype,"disabled",null),e([d()],P.prototype,"features",null),e([d()],P.prototype,"imagePointsInView",null),e([d()],P.prototype,"galleryOpened",void 0),e([d()],P.prototype,"icon",null),e([d()],P.prototype,"imageEnhancementToolActive",void 0),e([d({readOnly:!0})],P.prototype,"imageGalleryEnabled",null),e([d()],P.prototype,"imageOverlaysOpened",void 0),e([d({readOnly:!0})],P.prototype,"invalidCameraHeading",null),e([d()],P.prototype,"isAdditionalCoverageVisible",null),e([d()],P.prototype,"isAdditionalPointSourcesVisible",null),e([d()],P.prototype,"mapImageConversionToolState",null),e([d()],P.prototype,"layer",null),e([d()],P.prototype,"navigationToolActive",void 0),e([d({type:O})],P.prototype,"viewModel",void 0),e([d(),x("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],P.prototype,"messages",void 0),e([d(),x("esri/t9n/common")],P.prototype,"messagesCommon",void 0),e([d({readOnly:!0})],P.prototype,"popupEnabled",null),e([d()],P.prototype,"referencePoint",null),e([d()],P.prototype,"view",null),e([d({type:A,nonNullable:!0})],P.prototype,"visibleElements",void 0),e([d()],P.prototype,"determineWorkflowForFeature",null),e([d()],P.prototype,"updateFootprint",null),e([d()],P.prototype,"_navigationToolExpanded",void 0),e([d()],P.prototype,"_navigationTool",void 0),e([d()],P.prototype,"_imageOverlays",void 0),e([d()],P.prototype,"_warningTitleElement",void 0),P=e([h("esri.widgets.OrientedImageryViewer")],P);const S=P;export{S as default};
