/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{id as o}from"../../kernel.js";import e from"../../core/Error.js";import{JSONSupport as r}from"../../core/JSONSupport.js";import{createMD5Hash as s}from"../../core/MD5.js";import{isAbortError as a}from"../../core/promiseUtils.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/RandomLCG.js";import{enumeration as l}from"../../core/accessorSupport/decorators/enumeration.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import p from"../../portal/PortalItem.js";import{formatJsonMap as u}from"../../rest/support/fileFormat.js";import{fromJSON as m}from"../../rest/support/layoutTemplate.js";import{fetchLayoutTemplateInfos as c}from"./utils.js";let d=class extends r{constructor(t){super(t),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){return this.layoutItem?.id??`${this.layout}-${s(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){const t=this.layoutTemplateInfo?.layoutOptions?.mapSurroundInfos;if(!t)return null;const o={northArrow:[],scaleBar:[],legend:[]};for(const e of t)switch(e.type){case"CIMMarkerNorthArrow":o.northArrow.push(e);break;case"CIMScaleLine":o.scaleBar.push(e);break;case"CIMGroupElement":e.elements?.some((t=>"CIMScaleLine"===t.type))&&o.scaleBar.push(e);break;case"CIMLegend":o.legend.push(e)}return o}async fetchLayoutItemTemplateInfo(t){const{layoutItem:r}=this;if(r?.id&&!this.layoutTemplateInfo&&"loaded"!==this.state)try{this._set("state","loading");const s=this.layoutInfoTaskUrl;if(!s)throw new e("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:s});"public"!==r.access&&o&&await o.getCredential(s);const a={Layout_Item_ID:JSON.stringify({id:r.id})},i=(await c(s,a,t))[0];this._set("layoutTemplateInfo",i);const{hasLegend:l}=i.layoutOptions,n=this.mapSurroundInfoOptions?.northArrow.some((({visible:t})=>t))??!1,p=this.mapSurroundInfoOptions?.scaleBar.some((({visible:t})=>t))??!1;this._set("layoutOptions",{legend:l,northArrow:n,scaleBar:p}),this._set("state","loaded")}catch(s){this._set("state",a(s)?"not-loaded":"error")}}setLayoutTemplateInfo(t){this._set("layoutTemplateInfo",t),this._set("state","loaded")}};t([i({json:{write:!0}})],d.prototype,"description",void 0),t([l(u)],d.prototype,"format",void 0),t([i({readOnly:!0})],d.prototype,"id",null),t([i({readOnly:!0})],d.prototype,"state",void 0),t([i({json:{write:!0}})],d.prototype,"label",void 0),t([i()],d.prototype,"layoutInfoTaskUrl",void 0),t([i({json:{read:m,write:!0}})],d.prototype,"layout",void 0),t([i({type:p,json:{write:!0}})],d.prototype,"layoutItem",void 0),t([i({readOnly:!0,json:{write:!0}})],d.prototype,"layoutOptions",void 0),t([i({readOnly:!0})],d.prototype,"layoutTemplateInfo",void 0),t([i({readOnly:!0})],d.prototype,"mapSurroundInfoOptions",null),t([i()],d.prototype,"type",void 0),d=t([n("esri.widgets.Print.CustomTemplate")],d);const y=d;export{y as default};
