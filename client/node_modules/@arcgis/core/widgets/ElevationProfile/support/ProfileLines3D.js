/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../Color.js";import s from"../../../core/Accessor.js";import{watch as o,syncAndInitial as r}from"../../../core/reactiveUtils.js";import{throttle as i}from"../../../core/throttle.js";import{property as l}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import{fromArray as n}from"../../../core/libs/gl-matrix-2/factories/vec4f64.js";import c from"../../../geometry/Polyline.js";import{OutlineVisualElement as h}from"../../../views/3d/interactive/visualElements/OutlineVisualElement.js";import{getConfig as p}from"./constants.js";let m=class extends s{constructor(e){super(e),this._chartData=null,this._visualElements=[],this._update=e=>{const{chartData:s}=e;if(null==s)return this.remove();if(!s.refined)return;const o=this._visualElements,r=s.lines.filter((e=>e.viewVisualizationEnabled)),i=r.length;for(;o.length>i;)o.pop().destroy();const l=p().profileLinesStyle3D;for(;o.length<i;){const e=new h({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:l.innerWidth,innerColor:l.innerColor,width:l.width,falloff:l.falloff,renderOccluded:l.renderOccluded,isDecoration:!0});o.push(e)}const a=e.spatialReference;for(let c=0;c<i;++c){const e=o[c],s=r[i-1-c];e.geometry=this._createLineGeometry(s,a),e.color=n(t.toUnitRGBA(s.color))}}}initialize(){const e=p().profileLines3DUpdateThrottleMillis;let t=this._update;if(e>0){const s=i(this._update,e);this.addHandles(s),t=s}this.addHandles([o((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),t,r)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(e){this._chartData=e}_createLineGeometry(e,t){const s=e.samples??[],o=s.length-1,r=[];let i=[];for(let l=0;l<=o;l++){const{x:e,y:t,z:a}=s[l];null!=a&&i.push([e,t,a]),l!==o&&null!=a||!i.length||(r.push(i),i=[])}return new c({paths:r,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0}};e([l()],m.prototype,"view",void 0),e([l()],m.prototype,"_chartData",void 0),m=e([a("esri.widgets.ElevationProfile.support.ProfileLines3D")],m);export{m as ProfileLines3D};
