/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import e from"../../Graphic.js";import{makeHandle as r,handlesGroup as t}from"../../core/handleUtils.js";import{throwIfAborted as o,ignoreAbortErrors as a}from"../../core/promiseUtils.js";import{watch as c}from"../../core/reactiveUtils.js";import{getCreationAttributes as n,showProgressCursor as s}from"./workflowUtils.js";async function i({view:i,data:m,signal:u,next:p,cancel:f}){const{creationInfo:y}=m;if(!y)return r();if(!l(y))return r();const{layer:d}=y,g=null!=y.geometryToPlace;if(y.geometryToPlace=null,g)return f(),r();const{Upload:h}=await import("./Upload.js");o(u);const j=new h;m.upload=j;let w=null;const T=()=>w?.remove(),U=t([c((()=>j.state),(r=>{switch(r){case"default":case"error":T();break;case"pending":T(),w=s(i);break;case"success":{y.maxFeatures=1;const{result:r}=j;"georeferenced"===r?.type||"georeferenced-reprojected"===r?.type?(y.geometryToPlace=r.mesh,y.initialFeature=new e({attributes:n(y),geometry:r.mesh,sourceLayer:d}),i.goTo(y.initialFeature,{animate:!1}).catch(a)):y.geometryToPlace=r?.mesh,T(),p();break}}})),r((()=>{j.cancel(),T()}))]);return j.uploadTo(d),U}function l(e){const r=e?.layer;return"scene"===r?.type}export{i as handleModelUpload,l as isModelUpload};
