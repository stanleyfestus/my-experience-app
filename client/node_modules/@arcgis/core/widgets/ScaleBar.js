/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{watch as t}from"../core/reactiveUtils.js";import{createScreenPoint as r}from"../core/screenUtils.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/Logger.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{formatNumber as o}from"../intl/number.js";import{defaultUnitPropertyMetadata as l}from"../properties/defaultUnit.js";import a from"./Widget.js";import{css as n}from"./ScaleBar/css.js";import d from"./ScaleBar/ScaleBarViewModel.js";import{globalCss as c}from"./support/globalCss.js";import"./support/widgetUtils.js";import{messageBundle as p}from"./support/decorators/messageBundle.js";import{tsx as u}from"./support/jsxFactory.js";function m(e,t){return o(e,{style:"unit",unit:t,unitDisplay:"short"})}let h=class extends a{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new d}initialize(){this.addHandles(t((()=>{const{view:e}=this;return[e?.stationary,e?.center,e?.scale,e?.zoom]}),(([e])=>{e&&this.scheduleRender()})))}get icon(){return"actual-size"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel.state,t={[c.disabled]:e};let r,s;if(!e){const{unit:e,style:t}=this,i="metric"===e||"dual"===e,o=100,l="dual"===e?"line":t;if("imperial"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(o,"imperial");e&&(s="ruler"===l?this._renderRuler(e):this._renderLine(e,"bottom"))}if(i){const e=this.viewModel.getScaleBarProperties(o,"metric");e&&(r="ruler"===l?this._renderRuler(e):this._renderLine(e,"top"))}}return u("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(n.base,c.widget,t)},r,s)}_renderRuler(e){const{length:t,unit:r,value:s}=e,i=Math.round(t),o=m(s,r);return u("div",{class:this.classes(n.barContainer,n.rulerBarContainer),key:n.rulerBarContainer},u("div",{class:n.ruler,styles:{width:`${i}px`}},u("div",{class:n.rulerBlock}),u("div",{class:n.rulerBlock}),u("div",{class:n.rulerBlock}),u("div",{class:n.rulerBlock})),u("div",{class:this.classes(n.labelContainer,n.rulerLabelContainer)},u("div",{class:n.label},"0"),u("div",{class:n.label},o)))}_renderLine(e,t){const{length:r,unit:s,value:i}=e,o=Math.round(r),l=m(i,s),a={[n.topLabelContainer]:"top"===t,[n.bottomLabelContainer]:"bottom"===t},d=u("div",{class:this.classes(n.labelContainer,n.lineLabelContainer,a),key:n.labelContainer},u("div",{class:n.label},l)),c={[n.topLine]:"top"===t,[n.bottomLine]:"bottom"===t},p=u("div",{class:this.classes(n.line,c),key:n.line,styles:{width:`${o}px`}});return u("div",{class:this.classes(n.barContainer,n.lineBarContainer),key:n.lineBarContainer},[p,d])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,s=e.getBoundingClientRect(),i=s.left+window.pageXOffset,o=s.top+window.pageYOffset,l=r(i,o);(l.x!==t.x||l.y!==t.y)&&(this.viewModel.scaleComputedFrom=l)}};e([s(l)],h.prototype,"_defaultUnit",void 0),e([s()],h.prototype,"icon",null),e([s()],h.prototype,"label",null),e([s(),p("esri/widgets/ScaleBar/t9n/ScaleBar")],h.prototype,"messages",void 0),e([s({type:["ruler","line"]})],h.prototype,"style",void 0),e([s({type:["metric","imperial","dual"]})],h.prototype,"unit",null),e([s()],h.prototype,"view",null),e([s()],h.prototype,"viewModel",void 0),h=e([i("esri.widgets.ScaleBar")],h);const v=h;export{v as default};
