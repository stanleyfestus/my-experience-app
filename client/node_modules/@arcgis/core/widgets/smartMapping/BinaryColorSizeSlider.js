/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../Color.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{cast as t}from"../../core/accessorSupport/decorators/cast.js";import"../../core/RandomLCG.js";import"../../core/has.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import{authoringInfoFirstVariableSliderMinMax as i}from"../../renderers/support/authoringInfoUtils.js";import a from"../../renderers/visualVariables/support/SizeStop.js";import{getCIMSymbolColor as l}from"../../symbols/support/cimSymbolUtils.js";import{SmartMappingSliderBase as n}from"./SmartMappingSliderBase.js";import p from"./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel.js";import{getSizesFromVariable as d,getFillFromColor as m,getDynamicPathForSizeStops as c}from"./support/utils.js";import{globalCss as u}from"../support/globalCss.js";import{storeNode as h}from"../support/widgetUtils.js";import{messageBundle as v}from"../support/decorators/messageBundle.js";import{tsx as y}from"../support/jsxFactory.js";var g;const b="esri-binary-color-size-slider",f={base:b,rampElement:`${b}__ramp`,sliderContainer:`${b}__slider-container`,histogramContainer:`${b}__histogram-container`,zoomCapTop:`${b}__zoom-cap-top`,zoomCapBottom:`${b}__zoom-cap-bottom`,zoomCapLine:`${b}__zoom-cap-line`,zoomCapMask:`${b}__zoom-cap-mask`,zoomCapUnderline:`${b}__zoom-cap-underline`,primaryHandle:`${b}--primary-handle`,track:`${b}--interactive-track`},S={trackBackgroundColor:new r([224,224,224]),trackAboveFillColor:new r([149,149,149]),trackBelowFillColor:new r([149,149,149])};let w=g=class extends n{constructor(e,r){super(e,r),this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...S},this.viewModel=new p,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...S,...e}}static fromRendererResult(e,r){const{size:{visualVariables:s},statistics:t}=e,{avg:o,stddev:a}=t,l=s[0].stops,[n,p]=i(e.renderer.authoringInfo),d=z(e.renderer.classBreakInfos);return new g({max:p,min:n,stops:l??void 0,histogramConfig:{average:o??void 0,standardDeviation:a??void 0,bins:r?r.bins:[]},style:d,handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateFromRendererResult(e,r){const{size:{visualVariables:s},statistics:t}=e,{avg:o,stddev:a}=t,l=s[0].stops,[n,p]=i(e.renderer.authoringInfo),d=z(e.renderer.classBreakInfos);this.set({max:p,min:n,stops:l,histogramConfig:{average:o,standardDeviation:a,bins:r?r.bins:[]},style:d,handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateRenderer(e){if("univariate-color-size"!==e.authoringInfo?.type||"above-and-below"!==e.authoringInfo?.univariateTheme)return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const r=e.clone(),s=r.visualVariables?.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:t}=this;if(!r.visualVariables||!s||!t)return console.error("No size stops available."),null;const o=r.visualVariables.indexOf(s);r.visualVariables.splice(o,1),s.stops=t,r.visualVariables.push(s);const i=t[5===t.length?2:1].value;return r.classBreakInfos[0].maxValue=i,r.classBreakInfos[1].minValue=i,r}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:r,minDataValue:s,stops:t}=e;if(t)this.stops=t;else{const[t,o]=d(e);this.stops=[new a({value:s??void 0,size:o}),new a({value:r??void 0,size:t})]}}render(){const{label:e,state:r,viewModel:{primaryHandleEnabled:s},visibleElements:t}=this,o="disabled"===r,i=this.classes(f.base,u.widget,u.panel,{[u.disabled]:o,[f.primaryHandle]:s,[f.track]:!!t.interactiveTrack});return y("div",{"aria-label":e,class:i},o?null:this.renderContent(this._renderRamp(),f.sliderContainer,f.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return y("div",{afterCreate:h,bind:this,class:f.rampElement,"data-node-ref":"_rampNode"},y("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},y("rect",{fill:m(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPrimaryRamp(),this._renderPath()),r?this.renderZoomCaps():null)}_renderPrimaryRamp(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:s},viewModel:t}=this;return[y("defs",null,this.renderRampFillDefinition(e,t.getGradientStopInfo(r,s)))]}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(null==e||null==r)return;const{stops:s,viewModel:{max:t,min:o},_rampFillId:i,_minRampFillWidth:a}=this,l=c({max:t,min:o,pathHeight:e,pathWidth:r,stops:s,padding:a});return y("path",{d:l,fill:`url(#${i})`})}};e([s()],w.prototype,"handlesSyncedToPrimary",null),e([s()],w.prototype,"label",null),e([s(),v("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],w.prototype,"messages",void 0),e([s()],w.prototype,"persistSizeRangeEnabled",null),e([s()],w.prototype,"stops",null),e([s()],w.prototype,"style",void 0),e([t("style")],w.prototype,"castStyle",null),e([s()],w.prototype,"viewModel",void 0),w=g=e([o("esri.widgets.smartMapping.BinaryColorSizeSlider")],w);const _=w;function z(e){if(e.length<=1)return{};const r=e=>{if("cim"===e.type)return l(e);if(e.symbolLayers){const r=e.symbolLayers?.at(0);return r.material?.color}return e.color};return{trackBelowFillColor:r(e[0].symbol)??void 0,trackAboveFillColor:r(e[1].symbol)??void 0}}export{_ as default};
