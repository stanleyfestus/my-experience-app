/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{property as s}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as t}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../../Widget.js";import{css as r,legend as l}from"./ClassicCSS.js";import{renderRelationshipRamp as i}from"./support/relationshipUtils.js";import{getUnivariateAboveAndBelowRampElements as o,getUnivariateColorRampSize as n,getUnivariateColorRampPreview as p,getUnivariateColorRampMargin as d,getUnivariateColorSizeRampElements as c}from"./support/univariateUtils.js";import{getTitle as m,isRendererTitle as y,attachToNode as v,getStretchStopLabel as h,isImageryStretchedLegend as g}from"../support/styleUtils.js";import{globalCss as b}from"../../support/globalCss.js";import{Heading as f}from"../../support/Heading.js";import"../../support/widgetUtils.js";import{messageBundle as u}from"../../support/decorators/messageBundle.js";import{tsx as L}from"../../support/jsxFactory.js";const $=`${l}__`,w=24,C={display:"flex",alignItems:"flex-start"},R={marginLeft:"3px"},A={display:"table-cell",verticalAlign:"middle"};let _=class extends a{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e?.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return L("div",null,s?.length?s:L("div",{class:r.message},this.messages.noLegend))}_renderLegendForLayer(e,s){if(!e.ready)return null;const t=!!e.children.length,a=`${e.layer.uid}-version-${e.version}`,l=`${$}${s?`${s}-`:""}${a}`,i=e.title?f({level:this.headingLevel,class:this.classes(b.heading,r.label)},e.title):null;if(t){const s=e.children.map((e=>this._renderLegendForLayer(e,a))).toArray();return L("div",{class:this.classes(r.service,r.groupLayer),key:l},i,s)}{const s=e.legendElements;if(s&&!s.length)return null;const t=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList,l))).filter((e=>!!e));if(!t.length)return null;const a={[r.groupLayerChild]:!!e.parent};return L("div",{class:this.classes(r.service,a),key:l},i,L("div",{class:r.layer},t))}}_renderLegendForElement(e,s,t,a,l){const o="color-ramp"===e.type,n="opacity-ramp"===e.type,p="size-ramp"===e.type;let d=null;const c=`${a}-${e.type}`;if("symbol-table"===e.type||p){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,s,t,p,e.legendType,c))).filter((e=>!!e));a.length&&(d=L("div",{class:r.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?d=this._renderLegendForRamp(e,s.opacity,c):"relationship-ramp"===e.type?d=i(e,this.id,{opacity:s.opacity,effectList:t,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:c}):"pie-chart-ramp"===e.type?d=this._renderPieChartRamp(e,c):"univariate-above-and-below-ramp"===e.type?d=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t,c):"univariate-color-size-ramp"===e.type&&(d=this._renderUnivariateColorSizeRamp(e,s.opacity,t,c));if(!d)return null;const v=e.title;let h=null;if("string"==typeof v)h=v;else if(v){const e=m(this.messages,v,o||n);h=y(v,o||n)&&v.title?`${v.title} (${e})`:e}const g=l?r.layerChildTable:r.layerTable,b=h?L("div",{class:r.layerCaption},h):null,f={[r.layerTableSizeRamp]:p||!l};return L("div",{class:this.classes(g,f),key:`${a}-table`},b,d)}_renderPieChartRamp(e,s){return L("div",{afterCreate:v,bind:e.preview,key:`${s}-preview`})}_renderUnivariateAboveAndBelowRamp(e,s,t,a){const{sizeRampElement:l,colorRampElement:i}=o(e,s);if(!l)return null;const c=this.messages?.previewColorRampAriaLabel,m=n(l,"above",!0),y=n(l,"below",!0),h=12,g=p(i,{width:h,height:m,rampAlignment:"vertical",opacity:s,type:"above",effectList:t,ariaLabel:c}),b=p(i,{width:h,height:y,rampAlignment:"vertical",opacity:s,type:"below",effectList:t,ariaLabel:c}),f=d(l),u=l.infos.map((e=>e.label)),$=u.map(((e,s)=>{const t=2===s;return 0===s?L("div",{class:e?g?r.univariateAboveAndBelowLabel:r.rampLabel:void 0,key:`${a}-color-ramp-above-label-${e??s}`},e):t?L("div",null):null})),w=u.length-1,_=Math.floor(u.length/2),j=u.map(((e,s)=>s===_||s===w?L("div",{class:e?g?r.univariateAboveAndBelowLabel:r.rampLabel:void 0,key:`${a}-color-ramp-below-label-${e??s}`},e):null)),k={display:"table-cell",verticalAlign:"middle"},I={marginTop:`${f}px`},x={height:`${m}px`},F={height:`${y}px`};return L("div",{key:`${a}-container`,styles:C},L("div",{class:r.layerBody},l.infos.map(((e,s)=>L("div",{class:this.classes(r.layerRow,r.sizeRamp),key:`${a}-row-${s}`},L("div",{afterCreate:v,bind:e.preview,class:r.symbol,styles:k}),g||s%2!=0?null:L("div",{class:r.layerInfo},u[s]))))),g?L("div",{styles:I},L("div",{styles:R},L("div",{styles:A},L("div",{afterCreate:v,bind:g,class:r.rampContainer})),L("div",{styles:A},L("div",{class:r.rampLabelsContainer,styles:x},$))),L("div",{styles:R},L("div",{styles:A},L("div",{afterCreate:v,bind:b,class:r.rampContainer})),L("div",{styles:A},L("div",{class:r.rampLabelsContainer,styles:F},j)))):null)}_renderUnivariateColorSizeRamp(e,s,t,a){const{sizeRampElement:l,colorRampElement:i}=c(e);if(!l)return null;const o=d(l),m=12,y=n(l,"full",!1),h=p(i,{width:m,height:y,rampAlignment:"vertical",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),g=l.infos.length-1,b=l.infos.map(((e,s)=>0===s||s===g?L("div",{class:e.label?i?r.univariateAboveAndBelowLabel:r.rampLabel:void 0,key:`${a}-color-ramp-label-${e.label??s}`},e.label):null)),f={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${o}px`},$={height:`${y}px`};return L("div",{key:`${a}-container`,styles:C},L("div",{class:r.layerBody},l.infos.map(((e,s)=>L("div",{class:this.classes(r.layerRow,r.sizeRamp),key:`${a}-row-${s}`},L("div",{afterCreate:v,bind:e.preview,class:r.symbol,styles:f}))))),L("div",{styles:u},L("div",{styles:R},L("div",{styles:A},L("div",{afterCreate:v,bind:h,class:r.rampContainer})),L("div",{styles:A},L("div",{class:r.rampLabelsContainer,styles:$},b)))))}_renderLegendForRamp(e,s,t){const a=e.infos,l="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,o="stretch-ramp"===e.type,n=e.preview,p=l?r.opacityRamp:"";n.className=`${r.colorRamp} ${p}`,null!=s&&(n.style.opacity=s.toString());const d=a.map(((e,s)=>L("div",{class:e.label?r.rampLabel:void 0,key:`${t}-stop-${e.label??s}-label`},i?this.messages[e.label]||e.label:o?h(e,this.messages):e.label))),c={width:`${w}px`},m={height:n.style.height};return L("div",{class:r.layerRow,key:`${t}-row`},L("div",{class:r.symbolContainer,styles:c},L("div",{afterCreate:v,bind:n,class:r.rampContainer})),L("div",{class:r.layerInfo},L("div",{class:r.rampLabelsContainer,styles:m},d)))}_renderLegendForElementInfo(e,s,t,a,l,i){const o=`${i}-${e.label}`;if(e.type)return this._renderLegendForElement(e,s,t,o,!0);let n=null;const p=g(s,l);if(e.preview?n=L("div",{afterCreate:v,bind:e.preview,class:r.symbol}):e.src&&(n=this._renderImage(e,s,p)),!n)return null;const d={[r.imageryLayerInfoStretched]:p},c={[r.imageryLayerInfoStretched]:p,[r.sizeRamp]:!p&&a};return L("div",{class:r.layerRow,key:`${o}-row`},L("div",{class:this.classes(r.symbolContainer,c)},n),L("div",{class:this.classes(r.layerInfo,d)},m(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:a,src:l,opacity:i}=e,o={[r.imageryLayerStretchedImage]:t,[r.symbol]:!t},n={opacity:`${null!=i?i:s.opacity}`};return L("img",{alt:m(this.messages,a,!1),"aria-label":m(this.messages,a,!1),border:0,class:this.classes(o),height:e.height,src:l,styles:n,width:e.width})}};e([s()],_.prototype,"activeLayerInfos",void 0),e([s()],_.prototype,"headingLevel",void 0),e([s(),u("esri/widgets/Legend/t9n/Legend")],_.prototype,"messages",void 0),e([s({readOnly:!0})],_.prototype,"type",void 0),_=e([t("esri.widgets.Legend.styles.Classic")],_);const j=_;export{j as default};
