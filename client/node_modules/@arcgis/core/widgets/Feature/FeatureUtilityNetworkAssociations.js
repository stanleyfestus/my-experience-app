/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{destroyMaybe as t}from"../../core/maybe.js";import{watch as i,initial as s}from"../../core/reactiveUtils.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/RandomLCG.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import r from"../Widget.js";import a from"./FeatureUtilityNetworkAssociationType.js";import l from"./FeatureUtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel.js";import c from"./FeatureUtilityNetworkAssociations/VisibleElements.js";import p from"./support/FeatureElementInfo.js";import{loadCalciteComponents as d}from"../support/componentsUtils.js";import{globalCss as u}from"../support/globalCss.js";import"../support/widgetUtils.js";import{messageBundle as m}from"../support/decorators/messageBundle.js";import{tsx as h}from"../support/jsxFactory.js";const y="esri-feature",v=`${y}-relationship`,g={base:v,listContainer:`${v}__list`,listItem:`${v}__list-item`,listItemHidden:`${v}__list-item--hidden`,listContainerQuerying:`${v}__list--querying`,featureObserver:`${y}__feature-observer`,stickySpinnerContainer:`${y}__sticky-loading-container`,loadingSpinnerContainer:`${y}__loading-container`,expander:`${v}__expander`};let f=class extends r{constructor(e,t){super(e,t),this._featureElementInfo=null,this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=2,this.viewModel=new l,this.messages=null,this.messagesCommon=null,this.visibleElements=new c}initialize(){this._featureElementInfo=new p,this.addHandles([i((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),s)])}loadDependencies(){return d({chip:()=>import("@esri/calcite-components/dist/components/calcite-chip.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),loader:()=>import("@esri/calcite-components/dist/components/calcite-loader.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js")})}destroy(){this._featureElementInfo=t(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){const{state:e}=this.viewModel;return h("div",{class:this.classes(g.base,u.widget)},this._featureElementInfo?.render(),"loading"===e?this._renderLoading():"disabled"===e?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return"querying"===this.viewModel.state?h("div",{class:g.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:""})}_renderLoading(){return h("div",{class:g.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},this.messages?.noAssociations))}_setupFeatureElementInfo(){const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}_getAssociationTypeTitle(e){const{messages:t}=this;if(e.title)return e.title;switch(e.type){case"attachment":return t.associationsAttachments;case"connectivity":return t.associationsConnectivity;case"structure":return t.associationsStructure;case"content":return t.associationsContents;case"container":return t.associationsContainer}}_selectAssociationType(e){const{viewModel:t,flowItems:i,parentFeatureViewModel:s}=this;if(!i)return;const{associationTypes:o}=t;o.forEach((t=>{t.type===e.type?t.open=!0:t.open=!1}));const n=new a({viewModel:t,parentFeatureViewModel:s,listType:e,title:this._getAssociationTypeTitle(e),featureVisibleElements:this.featureVisibleElements,description:this.parentFeatureViewModel?.title,flowItems:i});i.push(n)}_renderAssociationType(e){const t=this._getAssociationTypeTitle(e);return h("calcite-list-item",{description:e.description,key:`association-type-${e.type}`,label:t,value:e.type,onCalciteListItemSelect:()=>this._selectAssociationType(e)},h("calcite-chip",{scale:"s",slot:"content-end",value:e.type},this._getFeatureCount(e.type)),h("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_getFeatureCount(e){switch(e){case"attachment":return this.viewModel.attachmentsFeatureCount;case"structure":return this.viewModel.structureFeatureCount;case"content":return this.viewModel.contentFeatureCount;case"container":return this.viewModel.containerFeatureCount;case"connectivity":return this.viewModel.connectivityFeatureCount}}_renderAssociations(e){return h("div",null,this._getFeatureCount(e.type)>0?this._renderAssociationType(e):null)}_renderContent(){const{state:e,associationTypes:t}=this.viewModel;return h("div",{class:this.classes(g.listContainer,{[g.listContainerQuerying]:"querying"===e}),key:"list-container"},"ready"===e?h("calcite-list",null,t.map((e=>this._renderAssociations(e)))):null,this._renderStickyLoading())}};e([o()],f.prototype,"flowType",void 0),e([o()],f.prototype,"flowItems",void 0),e([o()],f.prototype,"parentFeatureViewModel",void 0),e([o()],f.prototype,"featureVisibleElements",void 0),e([o()],f.prototype,"description",null),e([o()],f.prototype,"headingLevel",void 0),e([o()],f.prototype,"title",null),e([o({type:l})],f.prototype,"viewModel",void 0),e([o(),m("esri/widgets/Feature/t9n/Feature")],f.prototype,"messages",void 0),e([o(),m("esri/t9n/common")],f.prototype,"messagesCommon",void 0),e([o({type:c,nonNullable:!0})],f.prototype,"visibleElements",void 0),f=e([n("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],f);const _=f;export{_ as default};
