/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import"../core/has.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import"../core/Logger.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import n from"./Widget.js";import o from"./BatchAttributeForm/BatchAttributeFormViewModel.js";import{css as r}from"./BatchAttributeForm/css.js";import{VisibleElements as s}from"./BatchAttributeForm/VisibleElements.js";import{isGroupInput as a,isFieldInput as l}from"./BatchAttributeForm/inputs/support/inputUtils.js";import{loadCalciteComponents as d}from"./support/componentsUtils.js";import{isDateType as p,isNumberType as c,getLabelForDateFieldValue as u}from"./support/dateUtils.js";import{globalCss as m}from"./support/globalCss.js";import{Heading as b}from"./support/Heading.js";import"./support/widgetUtils.js";import{messageBundle as h}from"./support/decorators/messageBundle.js";import{tsx as v}from"./support/jsxFactory.js";import{substitute as f}from"../intl/substitute.js";let y=class extends n{constructor(e,t){super(e,t),this.headingLevel=2,this.messagesCommon=null,this.messages=null,this.readOnly=!1,this.viewModel=new o,this.visibleElements=new s}loadDependencies(){return d({input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),block:()=>import("@esri/calcite-components/dist/components/calcite-block.js"),"input-date-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-date-picker.js"),"input-number":()=>import("@esri/calcite-components/dist/components/calcite-input-number.js"),"input-time-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-time-picker.js"),"input-time-zone":()=>import("@esri/calcite-components/dist/components/calcite-input-time-zone.js"),"text-area":()=>import("@esri/calcite-components/dist/components/calcite-text-area.js"),label:()=>import("@esri/calcite-components/dist/components/calcite-label.js"),combobox:()=>import("@esri/calcite-components/dist/components/calcite-combobox.js"),"combobox-item":()=>import("@esri/calcite-components/dist/components/calcite-combobox-item.js"),"radio-button":()=>import("@esri/calcite-components/dist/components/calcite-radio-button.js"),"radio-button-group":()=>import("@esri/calcite-components/dist/components/calcite-radio-button-group.js"),switch:()=>import("@esri/calcite-components/dist/components/calcite-switch.js")})}get activeFeatureIndex(){return this.viewModel.activeFeatureIndex}set activeFeatureIndex(e){this.viewModel.activeFeatureIndex=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get icon(){return"edit-attributes"}set icon(e){this._overrideIfSome("icon",e)}render(){return v("div",{class:this.classes(r.base,m.widget,m.panel)},this._renderForm())}_renderForm(){return"single"!==this.viewModel.mode?v("div",null,v("form",null,this._renderHeader(),this._renderContent())):v("div",null)}_renderHeader(){const e="title",t="description",i=v(b,{key:"title",level:this.headingLevel},e),n=v("p",{key:"description"},t);return e||t?v("div",null,i,n):null}_renderContent(){const{inputs:e}=this.viewModel.activeForm;return e.items.filter((e=>e.visible)).map((e=>this._renderInput(e)))}_renderInput(e){return a(e)?this._renderGroupInput(e):l(e)?this._renderLabeledField(e):void 0}_renderGroupInput(e){const{inputs:t,template:i}=e,n=t.filter((e=>e.visible));return v("calcite-block",{class:this.classes(r.group,r.groupSequential,r.block),collapsible:!0,description:i.description??void 0,disabled:!1,heading:i.label??"",headingLevel:this.headingLevel,key:`{${i.elementId}-key}`,open:!0},n.map((e=>this._renderInput(e))))}_renderLabeledField(e){const{fieldName:t,description:i,label:n,field:o,elementId:s}=e.template,a=o.nullable,l=a?f(this.messages.requiredFieldLabel,{name:n}):n;return v("calcite-label",{"aria-label":l,class:r.label,key:`field--${s}`},v("div",{class:r.labelTextContent,key:"labelTextContainer"},n,i?v("span",{title:`${t}`},i):void 0,a?v("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),o.editable?this._renderFieldInput(e):this._renderReadOnlyComponent(e))}_renderFieldInput(e){const t=this.getCommonInputProps(e),{template:i}=e;if(i.input){const{type:n}=i.input;if(p(n))return this._renderDateComponents(e,t);if("coded-value"===i.field.domain?.type){const{domain:o}=i.field;return this._renderCodedInputs({input:e,domain:o,type:n,props:t})}return c(n)?this._renderNumberComponent(e,t):this._renderStringComponent(e,t)}return null}_renderCodedInputs({input:e,domain:t,type:i,props:n}){const o=this.viewModel.getCodedValueOptions(t);switch(i){case"combo-box":return this._renderComboBoxComponent({input:e,options:o,props:n});case"switch":return this._renderSwitchComponent(n);case"radio-buttons":return this._renderRadioButtonGroupComponent({input:e,options:o,props:n});default:return null}}_renderSwitchComponent(e){return v("calcite-switch",{...e,checked:!1,class:r.inputSwitch})}_renderComboBoxComponent({input:e,options:t,props:i}){const{label:n,field:o}=e.template,r=t.map((e=>this.renderComboboxItem({value:`${e.value}`,text:e.name,selected:o.defaultValue===e.value.toString()})));return v("calcite-combobox",{...i,label:n??"",selectionMode:"single"},r)}renderComboboxItem({text:e,value:t,selected:i}){return v("calcite-combobox-item",{key:t,selected:i,textLabel:e,value:t})}_renderRadioButtonGroupComponent({input:e,options:t,props:i}){const n=t.map((({name:t,value:i})=>this._renderRadioButtons({label:t,name:t,value:i,checked:i===e.template.field.defaultValue})));return v("calcite-radio-button-group",{...i,layout:"vertical",name:i.label??""},n)}_renderRadioButtons({name:e,value:t,checked:i,label:n}){return v("calcite-label",{class:r.inputRadioLabel,key:e,layout:"inline"},v("calcite-radio-button",{checked:i,name:e,value:`${t}`}),n)}_renderStringComponent(e,t){const{template:i}=e;return i.field.editable?i.input&&"text-area"===i.input.type?v("calcite-text-area",{...t,class:this.classes(r.group,r.groupSequential,r.individualElement),resize:"vertical"}):v("calcite-input",{...t,class:this.classes(r.group,r.groupSequential,r.individualElement),type:"text"}):this._renderReadOnlyComponent(e)}_renderNumberComponent(e,t){return v("calcite-input-number",{...t,type:"number",value:e.template.field.defaultValue?e.template.field.defaultValue.toString():void 0})}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return v("calcite-input",{class:this.classes(r.fieldInput,r.inputDisabled,r.individualElement),readOnly:!0,type:"text",value:null!=t?`${t}`:i.value})}_renderDateComponents(e,t){const{input:i}=e.template;switch(i?.type){case"datetime-picker":return this._renderDateFieldComponents(t);case"date-picker":return this._renderDateOnlyFieldComponent(t);case"time-picker":return this._renderTimeOnlyFieldComponent(t);case"datetimeoffset-picker":return this._renderTimestampOffsetFieldComponents(t);default:return this._renderReadOnlyComponent(e,u(e.field,t.value))}}_renderDateOnlyFieldComponent(e){const{class:t,key:i}=e;return v("calcite-input-date-picker",{class:t,"data-date-part":"date","data-field-name":"fieldNameAttribute",key:`${i}-date-input`,overlayPositioning:"fixed",value:void 0})}_renderTimeOnlyFieldComponent(e){const{class:t,key:i}=e;return v("calcite-input-time-picker",{class:t,"data-date-part":"time","data-field-name":"fieldNameAttribute",key:`${i}-time-input`,overlayPositioning:"fixed",value:void 0})}_renderTimestampOffsetFieldComponents(e){const{class:t,key:i}=e;return v("div",{class:r.dateInputContainer,key:`${i}-date-time-container`},v("calcite-input-date-picker",{class:t,"data-date-part":"date",key:`${i}-date-input`,value:void 0}),v("calcite-input-time-picker",{class:t,"data-date-part":"time",key:`${i}-time-input`,value:void 0}),null)}_renderDateFieldComponents(e){const{class:t,key:i}=e;return v("div",{class:r.dateInputContainer,key:`${i}-date-time-container`},v("calcite-input-date-picker",{class:t,"data-date-part":"date",key:`${i}-date-input`,value:void 0}),v("calcite-input-time-picker",{"data-date-part":"time",key:`${i}-time-input`,step:1,value:void 0}))}getCommonInputProps(e){const{disabled:t}=this,{template:i,field:n,valid:o}=e,{editable:s,name:a,nullable:l,defaultValue:d}=n,p=e.userHasChangedValue,c=!s||t;return{"aria-invalid":o?"false":"true",class:this.classes(r.fieldInput,c?r.inputDisabled:null),status:p&&!o?"invalid":"idle",key:i.elementId,label:a,placeholder:i.hint??void 0,readOnly:c,required:!l,value:null==d?"":`${d}`}}};e([t()],y.prototype,"activeFeatureIndex",null),e([t()],y.prototype,"disabled",null),e([t()],y.prototype,"features",null),e([t()],y.prototype,"headingLevel",void 0),e([t()],y.prototype,"icon",null),e([t(),h("esri/t9n/common")],y.prototype,"messagesCommon",void 0),e([t(),h("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],y.prototype,"messages",void 0),e([t()],y.prototype,"readOnly",void 0),e([t()],y.prototype,"viewModel",void 0),e([t({type:s,nonNullable:!0})],y.prototype,"visibleElements",void 0),y=e([i("esri.widgets.BatchAttributeForm")],y);const g=y;export{g as default};
