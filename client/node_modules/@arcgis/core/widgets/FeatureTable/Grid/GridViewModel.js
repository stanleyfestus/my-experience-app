/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.31/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import e from"../../../core/Collection.js";import{referenceSetter as o}from"../../../core/collectionUtils.js";import i from"../../../core/Evented.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import{isGroupColumn as s,isFieldColumn as r,isRelationshipColumn as d}from"../support/columnUtils.js";import{uniqueColumnNames as h,isPageIndexValid as a}from"../support/tableUtils.js";let u=class extends i.EventedAccessor{constructor(t){super(t),this.cellPartNameGenerator=(t,e)=>{let o="";e?.item&&this.rowHighlightIds.includes(e.item.objectId)&&(o+=" highlight");const i=this.findColumn(t?.path);return i?(i.invalid&&(o+=" invalid"),i.textWrap&&(o+=" text-wrap"),"editInfo"in i&&i.editInfo&&i.editInfo.rowData?.index===e.index&&(o+=" editing"),o):o},this.columnPerformanceModeEnabled=!0,this.columnReorderingEnabled=!0,this.columns=new e,this.dataProvider=async(t,e)=>{const{store:o}=this;if(!e)return;if(!o)return void(e&&e([]));e(await o.fetchItems(t))},this.maxSize=null,this.multipleSelectionEnabled=!0,this.multiSortEnabled=!1,this.paginationEnabled=!1,this.rowDetailsRenderer=null,this.store=null}get actionColumn(){return this.allColumns.find((t=>t.fieldName===h.action))}get allColumns(){return this.columns.toArray().flatMap((t=>[t,...s(t)&&t.columns?.length?t.columns:[]]))}get columnMenuIsOpen(){return this.allColumns.some((t=>t.menuIsOpen))}get editing(){return this.editableColumns.some((t=>t.editInfo))}get editableColumns(){return this.allColumns.filter((t=>"editable"in t))}get effectiveSize(){const{filterBySelectionEnabled:t,highlightIds:e,objectIds:o,pageSize:i,size:n}=this;if(this.paginationEnabled){const l=this.pageCount===this.pageIndex+1?n%i:i;return t?Math.min(e.length,l):o.length?Math.min(o.length,l):l}return t?e.length:o.length?o.length:n}get fieldColumns(){return this.allColumns.filter((t=>r(t)))}get filterBySelectionEnabled(){return!!this._get("filterBySelectionEnabled")}set filterBySelectionEnabled(t){this._set("filterBySelectionEnabled",t)}get groupColumns(){return this.columns.toArray().filter((t=>s(t)))}get highlightIds(){return this._get("highlightIds")||new e}set highlightIds(t){const i=Array.isArray(t)?new e(t):t;this.multipleSelectionEnabled||i.splice(1,i.length-1),this._set("highlightIds",o(i,this._get("highlightIds"),e))}get objectIds(){return this._get("objectIds")??new e}set objectIds(t){this._set("objectIds",o(t,this._get("objectIds"),e))}get pageCount(){const{pageSize:t,size:e}=this;return 0===e||0===t?1:Math.ceil(e/t)}get pageIndex(){return this._get("pageIndex")||0}set pageIndex(t){const{pageCount:e}=this;a(t,e)&&this._set("pageIndex",t)}get pageSize(){return this._get("pageSize")??50}set pageSize(t){this.store?.set("pageSize",t),this._set("pageSize",t)}get relationshipColumns(){return this.allColumns.filter((t=>d(t)))}get rowHighlightIds(){return this._get("rowHighlightIds")||new e}set rowHighlightIds(t){this._set("rowHighlightIds",o(t,this._get("rowHighlightIds"),e))}get size(){const t=this.store?.count??0,{maxSize:e}=this;return null!=t&&null!=e?Math.min(e,t):t}get state(){return this.store?.state??"disabled"}closeColumnMenus(){this.allColumns.forEach((t=>t.closeMenu()))}sortColumn(t,e){if(!t)return;const o=this.findColumn(t);o&&(o.direction=e)}hideColumn(t){const e=this.findColumn(t);!1===e?.hidden&&(e.hidden=!0)}showColumn(t){const e=this.findColumn(t);e?.hidden&&(e.hidden=!1)}showAllColumns(){this.allColumns.forEach((t=>{t.hidden&&(t.hidden=!1)}))}findColumn(t){return this.allColumns.find((e=>e.fieldName===t))}refresh(){this.store&&(this.store.reset(),this.store.load())}toggleColumnVisibility(t){const e=this.findColumn(t);e&&(e.hidden=!e.hidden)}};t([n()],u.prototype,"actionColumn",null),t([n()],u.prototype,"allColumns",null),t([n()],u.prototype,"cellPartNameGenerator",void 0),t([n()],u.prototype,"columnMenuIsOpen",null),t([n()],u.prototype,"columnPerformanceModeEnabled",void 0),t([n()],u.prototype,"columnReorderingEnabled",void 0),t([n()],u.prototype,"columns",void 0),t([n()],u.prototype,"dataProvider",void 0),t([n()],u.prototype,"editing",null),t([n()],u.prototype,"editableColumns",null),t([n()],u.prototype,"effectiveSize",null),t([n()],u.prototype,"fieldColumns",null),t([n()],u.prototype,"filterBySelectionEnabled",null),t([n()],u.prototype,"groupColumns",null),t([n()],u.prototype,"highlightIds",null),t([n()],u.prototype,"maxSize",void 0),t([n()],u.prototype,"multipleSelectionEnabled",void 0),t([n()],u.prototype,"multiSortEnabled",void 0),t([n()],u.prototype,"objectIds",null),t([n()],u.prototype,"pageCount",null),t([n()],u.prototype,"pageIndex",null),t([n()],u.prototype,"pageSize",null),t([n()],u.prototype,"paginationEnabled",void 0),t([n()],u.prototype,"relationshipColumns",null),t([n()],u.prototype,"rowHighlightIds",null),t([n()],u.prototype,"rowDetailsRenderer",void 0),t([n({readOnly:!0})],u.prototype,"size",null),t([n()],u.prototype,"store",void 0),t([n({readOnly:!0})],u.prototype,"state",null),u=t([l("esri.widgets.FeatureTable.Grid.GridViewModel")],u);const p=u;export{p as default};
