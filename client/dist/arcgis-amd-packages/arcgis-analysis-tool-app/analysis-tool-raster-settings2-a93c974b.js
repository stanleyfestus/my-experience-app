define(["exports","./index2-672b5477","./shared-components-01868776","./store-f238135f","./analysis-tool-context-f3d1c605"],(function(e,s,t,a,l){"use strict";const i=s.proxyCustomElement(class extends s.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolRasterSettingsHelpClick=s.createEvent(this,"analysisToolRasterSettingsHelpClick",7),this.loadedLayerObjects={},this.inferUIState=async()=>{const{cellSize:e,snapRaster:l,mask:i,resamplingMethod:r,recycleProcessingWorkers:n,parallelProcessingFactor:o,retryOnFailures:c,processorType:p}=a.state.context;if("object"==typeof e&&!s.isEmptyDataItem(e)&&"url"in e){this.selectedCellSizeOption=t.CellSizeOptions.Layer;const l=await s.getLayer({url:this.removeLayerToken(e.url)},a.state.mapLayers);void 0!==l&&(this.loadedLayerObjects.cellSize=l,void 0!==l&&this.isNotAnExistingLayer(l)&&this.browsedLayers.push(l))}else this.selectedCellSizeOption="number"==typeof e?t.CellSizeOptions.Value:e===t.CellSizeOptions.MinOf?t.CellSizeOptions.MinOf:t.CellSizeOptions.MaxOf;if(void 0!==l){const e=await s.getLayer({url:this.removeLayerToken(l.url)},a.state.mapLayers);void 0!==e&&(this.loadedLayerObjects.snapRaster=e,void 0!==e&&this.isNotAnExistingLayer(e)&&this.browsedLayers.push(e))}let y;if(void 0!==i){const e={...i};"url"in i&&void 0!==i.url&&(e.url=this.removeLayerToken(e.url)),y=await s.getLayer(e,a.state.mapLayers)}else void 0!==this.incomingLayerObjects.maskLayer&&(y=await s.getLayer(this.incomingLayerObjects.maskLayer,a.state.mapLayers));void 0!==y&&(this.loadedLayerObjects.mask=y,void 0!==y&&this.browsedLayers.push(y)),void 0!==r&&(this.selectedResamplingMethodOption=r),void 0!==n&&(this.recycleProcessingWorkersValue=n),void 0!==o&&(this.parallelProcessingFactorValue=o),void 0!==c&&(this.retryOnFailuresValue=c),void 0!==p&&(this.selectedProcessorTypeOption=p)},this.isNotAnExistingLayer=e=>{let t=e.url;return"layerId"in e&&(t+=`/${e.layerId??0}`),t=this.removeLayerToken(t),void 0===s.findExistingLayer(t,a.state.mapLayers)},this.removeLayerToken=e=>e?.indexOf("?token=")>0?e.slice(0,e.indexOf("?token=")):e,this.renderSnapRasterParameter=()=>{const{strings:e,loadedLayerObjects:t}=this;return s.h("div",null,s.h("analysis-label",{label:e.snapRaster,onAnalysisLabelHelpActionClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.SnapRaster,parameterName:e.snapRaster,refElement:s.target})}),s.h("analysis-layer-input",{layerFilterType:l.LayerFilterType.Imagery_All,mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:t?.snapRaster,user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.SnapRaster)}))},this.renderCellSizeParameter=()=>{const{strings:e,loadedLayerObjects:i,selectedCellSizeOption:r}=this;return s.h("div",null,s.h("analysis-label",{label:e.cellSize,onAnalysisLabelHelpActionClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.CellSize,parameterName:e.cellSize,refElement:s.target})}),s.h("calcite-select",{scale:t.UIDefaults.Scale,class:t.SharedHTMLClasses.controlSpacing,label:e.cellSize,value:r,onCalciteSelectChange:e=>this.handleCalciteSelectChange(e)},s.h("calcite-option",{value:t.CellSizeOptions.MaxOf,selected:r===t.CellSizeOptions.MaxOf},e.maxOf),s.h("calcite-option",{value:t.CellSizeOptions.MinOf,selected:r===t.CellSizeOptions.MinOf},e.minOf),s.h("calcite-option",{value:t.CellSizeOptions.Value,selected:r===t.CellSizeOptions.Value},e.asSpecified),s.h("calcite-option",{value:t.CellSizeOptions.Layer,selected:r===t.CellSizeOptions.Layer},e.fromLayer)),r===t.CellSizeOptions.Value&&s.h("analysis-number-input",{ref:e=>{this.numberInputElement=e},required:!0,value:a.state.context.cellSize,scale:t.UIDefaults.Scale,label:"",min:0,excludeMinValue:!0,numberType:"float",onAnalysisNumberInputChange:e=>a.state.context.cellSize=Number(e.target.value)}),r===t.CellSizeOptions.Layer&&s.h("analysis-layer-input",{ref:e=>{this.layerInputElement=e},required:!0,layerFilterType:l.LayerFilterType.Imagery_All,mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:i?.cellSize,user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.CellSize)}))},this.renderMaskParameter=()=>{const{strings:e,loadedLayerObjects:t}=this;return s.h("div",null,s.h("analysis-label",{label:e.mask,onAnalysisLabelHelpActionClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.Mask,parameterName:e.mask,refElement:s.target})}),s.h("analysis-layer-input",{mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:t?.mask,layerFilterType:[l.LayerFilterType.Imagery_All,l.LayerFilterType.Feature_All],user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.Mask)}))},this.renderResamplingMethodParameter=()=>{const{strings:e,selectedResamplingMethodOption:a}=this;return s.h("div",null,s.h("analysis-label",{label:e.resamplingMethod,onAnalysisLabelHelpActionClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ResamplingMethod,parameterName:e.resamplingMethod,refElement:s.target})}),s.h("calcite-select",{scale:t.UIDefaults.Scale,class:t.SharedHTMLClasses.controlSpacing,label:e.resamplingMethod,value:a,onCalciteSelectChange:e=>this.handleResamplingMethodSelectChange(e)},s.h("calcite-option",{value:t.ResamplingMethodOptions.Nearest,selected:a===t.ResamplingMethodOptions.Nearest},e.nearest),s.h("calcite-option",{value:t.ResamplingMethodOptions.Bilinear,selected:a===t.ResamplingMethodOptions.Bilinear},e.bilinear),s.h("calcite-option",{value:t.ResamplingMethodOptions.Cubic,selected:a===t.ResamplingMethodOptions.Cubic},e.cubic)))},this.renderRecycleProcessingWorkersParameter=()=>{const{strings:e,recycleProcessingWorkersValue:i}=this;return s.h("analysis-number-input",{required:!1,value:i,scale:t.UIDefaults.Scale,label:e.recycleProcessingWorkers,min:0,numberType:"integer",onAnalysisNumberInputChange:e=>a.state.context.recycleProcessingWorkers=Number(e.target.value),onAnalysisHelpClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.RecycleProcessingWorkers,parameterName:e.recycleProcessingWorkers,refElement:s.target})})},this.renderParallelProcessingFactorParameter=()=>{const{strings:e,parallelProcessingFactorValue:t}=this;return s.h("analysis-string-input",{value:t,label:e.parallelProcessingFactor,required:!1,selectionMode:"single",placeholderText:e.parallelProcessingFactorPlaceholderText,onAnalysisStringInputChange:e=>this.handleParallelProcessingFactorInputChange(e),onAnalysisHelpClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ParallelProcessingFactor,parameterName:e.parallelProcessingFactor,refElement:s.target})})},this.renderRetryOnFailuresParameter=()=>{const{strings:e,retryOnFailuresValue:i}=this;return s.h("analysis-number-input",{required:!1,value:i,scale:t.UIDefaults.Scale,label:e.retryOnFailures,min:0,numberType:"integer",onAnalysisNumberInputChange:e=>a.state.context.retryOnFailures=Number(e.target.value),onAnalysisHelpClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.RetryOnFailures,parameterName:e.retryOnFailures,refElement:s.target})})},this.renderProcessorTypeParameter=()=>{const{strings:e,selectedProcessorTypeOption:a}=this;return s.h("div",null,s.h("analysis-label",{label:e.processorType,onAnalysisLabelHelpActionClick:s=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ProcessorType,parameterName:e.processorType,refElement:s.target})}),s.h("calcite-select",{scale:t.UIDefaults.Scale,class:t.SharedHTMLClasses.controlSpacing,label:e.processorType,value:a,onCalciteSelectChange:e=>this.handleProcessorTypeSelectChange(e)},s.h("calcite-option",{value:t.ProcessorTypeOptions.Empty,selected:a===t.ProcessorTypeOptions.Empty},e.automatic),s.h("calcite-option",{value:t.ProcessorTypeOptions.CPU,selected:a===t.ProcessorTypeOptions.CPU},e.CPU),s.h("calcite-option",{value:t.ProcessorTypeOptions.GPU,selected:a===t.ProcessorTypeOptions.GPU},e.GPU)))},this.handleCalciteSelectChange=e=>{this.selectedCellSizeOption=e.target?.selectedOption.value,this.selectedCellSizeOption!==t.CellSizeOptions.MaxOf&&this.selectedCellSizeOption!==t.CellSizeOptions.MinOf||(a.state.context.cellSize=this.selectedCellSizeOption)},this.handleResamplingMethodSelectChange=e=>{this.selectedResamplingMethodOption=e.target?.selectedOption.value,a.state.context.resamplingMethod=this.selectedResamplingMethodOption},this.handleAnalysisLayerInputChange=async(e,t)=>{const l=e.target?.selectedLayers;if(void 0!==l){let e;!0===s.isFeatureLayer(l)?e=await s.getGPFeatureRecordSetLayerValue(l,a.state.mapView):!0!==s.isImageryLayer(l)&&!0!==s.isImageryTileLayer(l)||(e=s.getImageryLayerValue(l)),a.state.context[t]=e}else delete a.state.context[t]},this.handleParallelProcessingFactorInputChange=e=>{this.parallelProcessingFactorValue=e.target?.value,a.state.context.parallelProcessingFactor=this.parallelProcessingFactorValue},this.handleProcessorTypeSelectChange=e=>{this.selectedProcessorTypeOption=e.target?.selectedOption.value,a.state.context.processorType=this.selectedProcessorTypeOption===t.ProcessorTypeOptions.Empty?void 0:this.selectedProcessorTypeOption},this.browsedLayers=[],this.selectedCellSizeOption=t.CellSizeOptions.MaxOf,this.selectedResamplingMethodOption=t.ResamplingMethodOptions.Nearest,this.recycleProcessingWorkersValue=0,this.parallelProcessingFactorValue="",this.retryOnFailuresValue=0,this.selectedProcessorTypeOption=t.ProcessorTypeOptions.Empty,this.incomingLayerObjects={},this.hideCellSize=!1,this.hideResamplingMethod=!1,this.hideMask=!1,this.hideSnapRaster=!1,this.hideRecycleProcessingWorkers=!1,this.hideParallelProcessingFactor=!1,this.hideRetryOnFailures=!1,this.hideProcessorType=!1}async validateRasterSettings(){let e=!0;switch(this.selectedCellSizeOption){case t.CellSizeOptions.Layer:const s=this.layerInputElement;null!=s&&(e=await s.checkValidity());break;case t.CellSizeOptions.Value:const a=this.numberInputElement;null!=a&&(e=await a.checkValidity())}return e}resetUI(){this.loadedLayerObjects={},this.selectedCellSizeOption=t.CellSizeOptions.MaxOf,this.selectedResamplingMethodOption=t.ResamplingMethodOptions.Nearest,this.recycleProcessingWorkersValue=0,this.parallelProcessingFactorValue="",this.retryOnFailuresValue=0,this.selectedProcessorTypeOption=t.ProcessorTypeOptions.Empty;const e=this.hostElement.shadowRoot?.querySelectorAll("analysis-layer-input");return e?.forEach((e=>e.selectedLayerIds=[])),Promise.resolve()}async componentWillLoad(){({strings:this.strings}=await s.fetchComponentLocaleStrings(this.hostElement,s.getAssetPath(".")));const e={};void 0!==a.state.mapLevelContext.maskLayer&&(e.maskLayer=a.state.mapLevelContext.maskLayer),this.incomingLayerObjects=e,await this.inferUIState()}render(){const{hideCellSize:e,hideSnapRaster:t,hideMask:a,hideResamplingMethod:l,hideRecycleProcessingWorkers:i,hideParallelProcessingFactor:r,hideRetryOnFailures:n,hideProcessorType:o}=this;return s.h(s.Host,{key:"73efc0cc7f54cd57d1729849518e634bbb84bc91"},!1===t?this.renderSnapRasterParameter():null,!1===e?this.renderCellSizeParameter():null,!1===a?this.renderMaskParameter():null,!1===l?this.renderResamplingMethodParameter():null,!1===i?this.renderRecycleProcessingWorkersParameter():null,!1===r?this.renderParallelProcessingFactorParameter():null,!1===n?this.renderRetryOnFailuresParameter():null,!1===o?this.renderProcessorTypeParameter():null)}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}:host{display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input)}"}},[1,"analysis-tool-raster-settings",{hideCellSize:[516,"hide-cell-size"],hideResamplingMethod:[516,"hide-resampling-method"],hideMask:[516,"hide-mask"],hideSnapRaster:[516,"hide-snap-raster"],hideRecycleProcessingWorkers:[516,"hide-recycle-processing-workers"],hideParallelProcessingFactor:[516,"hide-parallel-processing-factor"],hideRetryOnFailures:[516,"hide-retry-on-failures"],hideProcessorType:[516,"hide-processor-type"],browsedLayers:[32],selectedCellSizeOption:[32],selectedResamplingMethodOption:[32],recycleProcessingWorkersValue:[32],parallelProcessingFactorValue:[32],retryOnFailuresValue:[32],selectedProcessorTypeOption:[32],incomingLayerObjects:[32],validateRasterSettings:[64],resetUI:[64]}]);function r(){"undefined"!=typeof customElements&&["analysis-tool-raster-settings"].forEach((e=>{"analysis-tool-raster-settings"===e&&(customElements.get(e)||customElements.define(e,i))}))}r(),e.AnalysisToolRasterSettings=i,e.defineCustomElement=r}));