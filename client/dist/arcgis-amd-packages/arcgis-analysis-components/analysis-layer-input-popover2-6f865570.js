define(["exports","./index-60d8a971","./index2-31657c04","./utils-c381fe27","./analysis-item-browser2-326c174c","./_Uint8Array-2357716e","./_baseIsEqual-b038bd4f","./isObject-a5254a4d","./get-ead8032d","./_baseGet-1781da83","./_MapCache-d92ee307","./identity-47e9f05a"],(function(e,t,s,i,a,r,n,o,l,h,c,d){"use strict";var m=1,p=2;function y(e){return e==e&&!o.isObject(e)}function u(e,t){return function(s){return null!=s&&s[e]===t&&(void 0!==t||e in Object(s))}}function f(e,t){return null!=e&&t in Object(e)}function v(e,t){return null!=e&&function(e,t,s){for(var i=-1,a=(t=h.castPath(t,e)).length,n=!1;++i<a;){var o=h.toKey(t[i]);if(!(n=null!=e&&s(e,o)))break;e=e[o]}return n||++i!=a?n:!!(a=null==e?0:e.length)&&r.isLength(a)&&r.isIndex(o,a)&&(c.isArray$1(e)||r.isArguments$1(e))}(e,t,f)}function g(e){return"function"==typeof e?e:null==e?d.identity:"object"==typeof e?c.isArray$1(e)?(i=e[0],a=e[1],h.isKey(i)&&y(a)?u(h.toKey(i),a):function(e){var t=l.get(e,i);return void 0===t&&t===a?v(e,i):n.baseIsEqual(a,t,3)}):(s=function(e){for(var t=r.keys(e),s=t.length;s--;){var i=t[s],a=e[i];t[s]=[i,a,y(a)]}return t}(t=e),1==s.length&&s[0][2]?u(s[0][0],s[0][1]):function(e){return e===t||function(e,t,s,i){var a=s.length,o=a;if(null==e)return!o;for(e=Object(e);a--;){var l=s[a];if(l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<o;){var h=(l=s[a])[0],c=e[h],d=l[1];if(l[2]){if(void 0===c&&!(h in e))return!1}else{var y,u=new r.Stack;if(!(void 0===y?n.baseIsEqual(d,c,m|p,i,u):y))return!1}}return!0}(e,0,s)}):function(e){return h.isKey(e)?(t=h.toKey(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return h.baseGet(t,e)}}(e);var t}(e);var t,s,i,a}function w(e,t,s,i){for(var a=-1,r=null==e?0:e.length;++a<r;){var n=e[a];t(i,n,s(n),e)}return i}const b=function(e,t,s){for(var i=-1,a=Object(e),r=s(e),n=r.length;n--;){var o=r[++i];if(!1===t(a[o],o,a))break}return e};var L=function(e,t){if(null==e)return e;if(!r.isArrayLike(e))return function(e,t){return e&&b(e,t,r.keys)}(e,t);for(var s=e.length,i=-1,a=Object(e);++i<s&&!1!==t(a[i],i,a););return e};const E=L;function B(e,t,s,i){return E(e,(function(e,a,r){t(i,e,s(e),r)})),i}var I,M;const T=(I=function(e,t,s){e[s?0:1].push(t)},M=function(){return[[],[]]},function(e,t){var s=c.isArray$1(e)?w:B,i=M?[[],[]]:{};return s(e,I,g(t),i)}),C="list-message",S=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisLayerInputPopoverClose=t.createEvent(this,"analysisLayerInputPopoverClose",7),this.analysisLayerInputPopoverSelectionChange=t.createEvent(this,"analysisLayerInputPopoverSelectionChange",7),this.analysisLayerInputPopoverLayerBrowsed=t.createEvent(this,"analysisLayerInputPopoverLayerBrowsed",7),this.analysisLayerInputPopoverConfirm=t.createEvent(this,"analysisLayerInputPopoverConfirm",7),this.checkForMatchingLayer=()=>{this.calciteFilterSearchTerm=this.listElement?.filterText,this.noSearchedLayersMessageActive=0===this.listElement?.filteredItems?.length&&0!==this.listElement?.filterText.length},this.buildListItem=e=>t.h("calcite-list-item",{key:e.id,value:e.id,label:s.getLayerLabel(e),description:s.isFeatureLayer(e)&&!i.isDerivedVariableLayer(e.id)?s.isTableLayer(e)?this.strings.table:this.strings[e.geometryType]:"",selected:void 0!==this.selectedLayerIds&&this.selectedLayerIds.includes(e.id),onClick:this.onListChange,"data-layer-title":e.title}),this.openItemBrowser=()=>{this.itemBrowserElement?.remove(),this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.heading,this.itemBrowserElement.hideAddToMap=this.hideAddToMap,this.itemBrowserElement.filter=this.itemBrowserFilter,this.itemBrowserElement.q=this.itemBrowserQ,this.itemBrowserElement.allowedGeometries=this.itemBrowserAllowedGeometries,this.itemBrowserElement.layerFilterType=this.layerFilterType,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.user=this.user,this.itemBrowserElement.viewIsSceneView=i.viewIsSceneView(this.mapView),this.itemBrowserElement.selectionMode="multi"!==this.selectionMode?"single-sublayer":"multiple-sublayer",this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.popoverElement.autoClose=!1,this.popoverElement.hidden=!0,document.body.appendChild(this.itemBrowserElement)},this.closeModals=()=>{this.popoverElement.autoClose=!0,this.popoverElement.hidden=!1,void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.removeEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.addLayersToMap=(e,t)=>{const i=T(t,(e=>s.isTableLayer(e)));e.addMany(i[1]),e.tables.addMany(i[0])},this.handleItemBrowserAddToMap=e=>{this.addLayersToMap(this.mapView.map,e.detail),this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.handleItemBrowserSelection=e=>{this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.onListChange=()=>{const e=this.listElement?.selectedItems;this.analysisLayerInputPopoverSelectionChange.emit(e?.map((e=>e.value))),"multi"!==this.selectionMode&&(this.open=!1)},this.onConfirm=()=>{const e=this.listElement?.selectedItems??[];this.analysisLayerInputPopoverConfirm.emit(e?.map((e=>e.value))),this.open=!1},this.hideAddToMap=!1,this.mapLayers=void 0,this.modelVariableLayers=void 0,this.analysisSessionLayers=[],this.hideBrowseButton=!1,this.showNoticeMessage=!1,this.noticeMessage=void 0,this.selectionMode=void 0,this.referenceElement=void 0,this.placement="auto",this.open=void 0,this.selectedLayerIds=void 0,this.popoverWidth=void 0,this.user=void 0,this.portal=void 0,this.mapView=void 0,this.itemBrowserAllowedGeometries=void 0,this.itemBrowserFilter="",this.itemBrowserQ="",this.heading=void 0,this.pointerDisabled=!1,this.maxHeight=void 0,this.layerFilterType=void 0,this.noSearchedLayersMessageActive=!1,this.calciteFilterSearchTerm=void 0}get bucketOptions(){const e=["my","favorites","group","org","all"];if(!0!==this.portal.isPortal||this.portal.sourceJSON.portalDeploymentType!==s.PortalDeploymentType.Kubernetes){const t=this.isImageryLayerBrowser();e.splice(4,0,t?"living atlas":"living atlas analysis")}return e}isImageryLayerBrowser(){const e=Array.isArray(this.layerFilterType)?this.layerFilterType:[this.layerFilterType];return e?.map((e=>!!e&&e.indexOf("imagery")>-1)).includes(!0)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath(".")))}componentDidLoad(){this.focusTimeoutId=setTimeout((async()=>{await(this.listElement?.setFocus?.())}),s.UIDefaults.PopoverTimer),setTimeout((()=>{this.popoverElement?.reposition?.()}),s.UIDefaults.PopoverTimer)}disconnectedCallback(){void 0!==this.focusTimeoutId&&clearTimeout(this.focusTimeoutId),this.closeModals()}async reposition(){await(this.popoverElement?.reposition?.())}render(){const e=this.popoverWidth??this.referenceElement?.getBoundingClientRect().width,i=s.formatMessage(this.strings.noMatchesFound,{searchTerm:this.calciteFilterSearchTerm??""}),a=0===this.analysisSessionLayers?.length&&0===this.mapLayers?.length&&(void 0===this.modelVariableLayers||0===this.modelVariableLayers?.length),r=!0===this.hideBrowseButton;return t.h(t.Host,{key:"1d371dca6230840a1856c7f8906755662ccf5f12",dir:this.dir,class:"analysis-popover js-app-flyout"},t.h("calcite-popover",{key:"178006c1feea3a97cb01439cf599aaeabb64a0c1",ref:e=>{this.popoverElement=e},style:{width:void 0!==e?`${e}px`:void 0},autoClose:!0,closable:!0,heading:this.heading??this.strings.heading,referenceElement:this.referenceElement??"analysis-layer-input",placement:this.placement,open:this.open,label:"",focusTrapDisabled:!0,pointerDisabled:this.pointerDisabled,onCalcitePopoverClose:()=>this.analysisLayerInputPopoverClose.emit()},t.h("calcite-panel",{key:"0f4509226df01cd944001eddaef467451ec39436",style:{maxHeight:void 0!==this.maxHeight?this.maxHeight-50+"px":void 0}},t.h("calcite-list",{key:"0231880e8e7751bad3a7475a69ee7547bba3ed18",class:"popover-content",selectionMode:"multi"===this.selectionMode?"multiple":"single",filterEnabled:!0,ref:e=>{this.listElement=e},onCalciteListFilter:this.checkForMatchingLayer},t.h("calcite-notice",{key:"28ab840c88fd3f9c2260a32f884350d14d723eb3",open:this.showNoticeMessage,class:this.showNoticeMessage?"half-margin":"",kind:"warning",scale:s.UIDefaults.Scale},t.h("div",{key:"f6fe6a40968561288c791c3d082f5d0e37038865",slot:"message"},Array.from(new Set(this.noticeMessage))?.map((e=>t.h("p",{innerHTML:e}))))),this.noSearchedLayersMessageActive&&t.h("p",{key:"9b036c2f9937efc259d3a8c466f776b248fd403b",class:C},i),a&&!1===this.noSearchedLayersMessageActive?t.h("p",{class:C},this.strings.noCompatibleLayers):t.h("div",null,t.h("calcite-list-item-group",{heading:this.strings.analysisSessionLayers,hidden:0===this.analysisSessionLayers?.length},(this.analysisSessionLayers??[]).map((e=>this.buildListItem(e)))),t.h("calcite-list-item-group",{heading:this.strings.mapLayers,hidden:0===this.mapLayers?.length},(this.mapLayers??[]).map((e=>this.buildListItem(e)))),(this.modelVariableLayers?.length??0)>0&&t.h("calcite-list-item-group",{heading:this.strings.modelVariableLayers},(this.modelVariableLayers??[]).map((e=>this.buildListItem(e)))))),!r&&t.h("calcite-button",{key:"e5b578a1842aab5a3d417933058d3578e274bab1",slot:"footer-actions",appearance:"transparent",width:"full",onClick:this.openItemBrowser},this.strings.browseAnalysisLayers),r&&t.h(t.Fragment,{key:"90482b6b8677898eb17178687e318d2eaed8715a"},t.h("calcite-button",{key:"c2336b969eaae365923ae0b1460990086f1797f8",slot:"footer-actions",appearance:"outline",width:"half",onClick:()=>this.analysisLayerInputPopoverClose.emit()},this.strings.cancel),t.h("calcite-button",{key:"fecf7ee505c591c83f59ddcc89cf2343ae63f835",slot:"footer-actions",appearance:"solid",width:"half",onClick:this.onConfirm},this.strings.add)))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.fab{justify-content:center;padding:var(--analysis-half-spacing)}.half-margin{margin:var(--analysis-half-spacing)}.list-message{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}"}},[1,"analysis-layer-input-popover",{hideAddToMap:[4,"hide-add-to-map"],mapLayers:[16],modelVariableLayers:[16],analysisSessionLayers:[16],hideBrowseButton:[516,"hide-browse-button"],showNoticeMessage:[4,"show-notice-message"],noticeMessage:[16],selectionMode:[513,"selection-mode"],referenceElement:[16],placement:[513],open:[1540],selectedLayerIds:[16],popoverWidth:[514,"popover-width"],user:[16],portal:[16],mapView:[16],itemBrowserAllowedGeometries:[16],itemBrowserFilter:[513,"item-browser-filter"],itemBrowserQ:[513,"item-browser-q"],heading:[1],pointerDisabled:[4,"pointer-disabled"],maxHeight:[2,"max-height"],layerFilterType:[1,"layer-filter-type"],noSearchedLayersMessageActive:[32],calciteFilterSearchTerm:[32],reposition:[64]}]);function k(){"undefined"!=typeof customElements&&["analysis-layer-input-popover","analysis-item-browser"].forEach((e=>{switch(e){case"analysis-layer-input-popover":customElements.get(e)||customElements.define(e,S);break;case"analysis-item-browser":customElements.get(e)||a.defineCustomElement()}}))}k(),e.AnalysisLayerInputPopover=S,e.baseFor$1=b,e.baseIteratee=g,e.defineCustomElement=k,e.hasIn=v}));