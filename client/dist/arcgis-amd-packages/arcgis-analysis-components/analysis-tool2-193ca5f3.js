define(["exports","./index-60d8a971","./index2-31657c04","./primitiveFactory-642234d0","./analysis-overwrite2-ccd6b26e","./utils-c381fe27","./helpmap_enterprise-d5a19c58","./analysis-layer-input-popover2-6f865570","./_baseGet-1781da83","./analysis-key-value2-ca00fe48","./analysis-expression-group2-c43af168","./analysis-value-table2-ea282848","./analysis-areal-unit-input2-9ceb8348","./analysis-attribute-expression2-5251ae6f","./analysis-block2-fbc83377","./analysis-boolean-input2-a0db9269","./analysis-chip-group2-3b7294c8","./analysis-data-file-input2-68b023f4","./analysis-dataset-input2-77abd4cf","./analysis-dataset-input-popover2-13d82070","./analysis-date-input2-37fdaf39","./analysis-field-input2-d81e7661","./analysis-field-select2-d08f3f3d","./analysis-folder-input2-09c578a5","./analysis-geoenrichment-databrowser2-3b8d96ff","./analysis-geoenrichment-input2-f90aaac7","./analysis-help-popover2-2306cbe6","./analysis-item-browser2-326c174c","./analysis-item-input2-fe9e764d","./analysis-label2-5082e9b8","./analysis-layer-input2-25808e07","./analysis-linear-unit-input2-46cd6e1e","./analysis-multiple-input2-4cf30ddf","./analysis-number-input2-b2684230","./analysis-parameter-group2-276e31f3","./analysis-query-builder2-d6563e02","./analysis-query-entry2-6efeefcb","./analysis-query-input2-5b2823aa","./analysis-query-modal2-ef038098","./analysis-query-target-select2-d19b2afa","./analysis-section2-d89c99ed","./analysis-sketch2-e4a035bf","./analysis-spatial-expression2-00a2b684","./analysis-spatial-reference-input2-222f4953","./analysis-spatial-reference-selector2-7ee3390b","./analysis-string-input2-ef684699","./analysis-summary-fields2-4f53abcb","./analysis-summary-fields-popover2-89ee90ce","./analysis-traffic-time-input2-a2781b31","./analysis-tree2-ccbef938","./analysis-unsupported-input2-35d6cead","./analysis-workflow-select2-d920e56b","./analysis-workflow-select-popover2-9dff6cd7","./debounce-c1955a21","./isEqual-9b8f87d3","./_Uint8Array-2357716e","./_MapCache-d92ee307","./isObject-a5254a4d","./identity-47e9f05a"],(function(e,a,t,s,i,n,o,l,r,p,m,u,c,d,y,h,f,v,g,b,E,C,P,I,T,k,U,L,D,A,S,w,H,V,M,x,J,N,R,q,G,O,F,B,$,j,_,K,W,z,Y,Z,Q,X,ee,ae,te,se,ie){"use strict";const ne="parameterViewModel",oe=["choiceListLabels","label","visible","componentName","serializationType","serializationParameterName","serializationKeys","uiParameterInfoSubSet","submissionName"],le=["dataType","choiceList","parameterType","parameterInfos"];function re(e,a,t){(void 0!==t&&!te.eq(e[a],t)||void 0===t&&!(a in e))&&m.baseAssignValue(e,a,t)}function pe(e,a){if(("constructor"!==a||"function"!=typeof e[a])&&"__proto__"!=a)return e[a]}function me(e,a,t,s,i){e!==a&&l.baseFor$1(a,(function(n,o){if(i||(i=new ae.Stack),se.isObject(n))!function(e,a,t,s,i,n,o){var l=pe(e,t),r=pe(a,t),p=o.get(r);if(p)re(e,t,p);else{var u,c=n?n(l,r,t+"",e,a,o):void 0,d=void 0===c;if(d){var y=te.isArray$1(r),h=!y&&ae.isBuffer$1(r),f=!y&&!h&&ae.isTypedArray$1(r);c=r,y||h||f?te.isArray$1(l)?c=l:(u=l,se.isObjectLike(u)&&ae.isArrayLike(u)?c=m.copyArray(l):h?(d=!1,c=m.cloneBuffer(r,!0)):f?(d=!1,c=m.cloneTypedArray(r,!0)):c=[]):m.isPlainObject(r)||ae.isArguments$1(r)?(c=l,ae.isArguments$1(l)?c=function(e){return m.copyObject(e,m.keysIn(e))}(l):se.isObject(l)&&!te.isFunction(l)||(c=m.initCloneObject(r))):d=!1}d&&(o.set(r,c),i(c,r,s,n,o),o.delete(r)),re(e,t,c)}}(e,a,o,t,me,s,i);else{var l=s?s(pe(e,o),n,o+"",e,a,i):void 0;void 0===l&&(l=n),re(e,o,l)}}),m.keysIn)}var ue,ce,de=(ue=function(e,a,t,s){me(e,a,t,s)},ce=function(e,a){var t=-1,s=a.length,i=s>1?a[s-1]:void 0,n=s>2?a[2]:void 0;for(i=ue.length>3&&"function"==typeof i?(s--,i):void 0,n&&function(e,a,t){if(!se.isObject(t))return!1;var s=typeof a;return!!("number"==s?ae.isArrayLike(t)&&ae.isIndex(a,t.length):"string"==s&&a in t)&&te.eq(t[a],e)}(a[0],a[1],n)&&(i=s<3?void 0:i,s=1),e=Object(e);++t<s;){var o=a[t];o&&ue(e,o,t,i)}return e},m.setToString$1(m.overRest(ce,undefined,ie.identity),ce+""));const ye=de;var he="Expected a function";const fe=({name:e,value:i,onSetRef:n,onValueChange:o,onHelpClick:l,label:r,required:p,UIparameterInfos:m,dataType:u,paramGroupDataType:c,portal:d,mapView:y,mapLayers:h,modelVariableLayers:f,supportsUpload:v,serviceUrl:g,...b})=>{const E=t.valueHasVariable(i)?"GPComposite":c??u,{parameterInfos:C,...P}=b,I=E===s.AnalysisToolParamDataType.GPComposite?(C||[]).map((e=>{const a=m?.find((a=>a.dataType===e.dataType));return a??e})):m||[];return a.h("analysis-parameter-group",{key:e,groupLabel:r,required:p,value:i,UIparameterInfos:I,dataType:E,portal:d,mapView:y,mapLayers:h,modelVariableLayers:f,ref:n,onAnalysisParameterGroupInputChange:o,onAnalysisHelpClick:l,...P,supportsUpload:v,serviceUrl:g})},ve=({name:e,onSetRef:t,onValueChange:s,onHelpClick:i,label:n,value:o,...l})=>{const r=l.parameterInfos?.map((e=>e.name));return void 0!==r&&r.length!==new Set(r).size?a.h("analysis-unsupported-input",{key:e,label:n,ref:t,user:l.user,portalHelpMap:l.portalHelpMap,required:l.required,value:o,onAnalysisHelpClick:i,...l}):a.h("analysis-value-table",{key:e,ref:t,onAnalysisValueTableChange:s,label:n,value:o,onAnalysisHelpClick:i,...l})},ge=({name:e,onSetRef:s,onValueChange:i,onHelpClick:n,label:o,value:l,required:r,...p})=>{const m=t.isEmptyDataItem(p.parameterInfos)?[{name:"",dataType:p.dataType?.split(":")[1]}]:p.parameterInfos;return a.h("analysis-value-table",{description:p.description,key:e,label:o,required:r,value:l,valueWithoutKey:!0,parameterInfos:m,UIparameterInfos:p?.UIparameterInfos,onAnalysisHelpClick:n,onAnalysisValueTableChange:i,ref:s})},be=(e,a)=>a,Ee={[s.AnalysisToolParamDataType.GPValueTable]:ve,[s.AnalysisToolParamDataType.GPMultiValueDate]:ge,[s.AnalysisToolParamDataType.GPMultiValueLinearUnit]:ge,[s.AnalysisToolParamDataType.GPMultiValueArealUnit]:ge,[s.AnalysisToolParamDataType.GPComposite]:fe},Ce={...s.primitiveComponentByType,...Ee},Pe={"analysis-parameter-group":fe,"analysis-value-table":ve,"analysis-key-value":({value:e,layout:t,parameterInfos:s,onSetRef:i,onValueChange:n,onHelpClick:o,UIparameterInfos:l,label:r,...p})=>a.h("analysis-key-value",{value:e,layout:t,parameterInfos:s,UIparameterInfos:l,label:r,ref:i,onAnalysisKeyValueChange:n,onAnalysisHelpClick:o,...p})},Ie={...s.primitiveComponentByName,...Pe},Te={"analysis-block":({label:e,summaryText:t,...s},i)=>a.h("analysis-block",{label:e,summaryText:t,...s},i),"analysis-section":({label:e,open:t},s)=>a.h("analysis-section",{label:e,open:t},s)},ke=e=>{let t;return void 0!==e.componentName?t=Ie[e.componentName]:void 0!==e.dataType&&(t=Ce[e.dataType]),t=t??s.NotFoundInput,a.h(t,{...s.standardizeInputProperties(e)})},Ue=ke,Le=(e,t)=>{let s;void 0!==e.componentName&&(s=Te[e.componentName]);const{componentName:i,...n}=e;return s=s??be,a.h(s,{...n},t)},De=(e,a)=>{let t=e;return void 0!==a&&void 0!==e&&e.startsWith("$")&&(t=a[e.replace("$","")]),t};function Ae({label:e,placeholderText:a,heading:t,filterPlaceholderText:s,selectButtonLabel:i,replaceTooltipText:n,choiceListLabels:o,UIparameterInfos:u,UIparameterInfosRules:c,validationParams:d,parameterGroupDataTypeLabel:y,disabledTooltip:h,noFieldsText:f,noLayersText:v,...g},b){const E=void 0!==o?((e,a)=>{const t={};return void 0!==e&&Object.entries(e).forEach((([e,s])=>{const i=De(s,a);void 0!==i&&(t[e]=i)})),t})(o,b):void 0,C=void 0!==u?u.map((e=>Ae(e,b))):void 0,P=c?.map((e=>{return"set"!==e.ruleType?{...e,effectParams:{...e.effectParams,...(a=Ae(e.effectParams,b),t=e=>void 0===e,function(e,a){if(null==e)return{};var t=r.arrayMap(m.getAllKeysIn(e),(function(e){return[e]}));return a=l.baseIteratee(a),p.basePickBy(e,t,(function(e,t){return a(e,t[0])}))}(a,function(e){if("function"!=typeof e)throw new TypeError(he);return function(){var a=arguments;switch(a.length){case 0:return!e.call(this);case 1:return!e.call(this,a[0]);case 2:return!e.call(this,a[0],a[1]);case 3:return!e.call(this,a[0],a[1],a[2])}return!e.apply(this,a)}}(l.baseIteratee(t))))}}:e;var a,t})),I=void 0!==d?((e,a)=>{const t={};return void 0!==e&&Object.entries(e).forEach((([e,s])=>{if("object"==typeof s)t.variables=s;else{const i=De(s,a);void 0!==i&&(t[e]=i)}})),t})(d,b):void 0;return{label:De(e,b),placeholderText:De(a,b),heading:De(t,b),filterPlaceholderText:De(s,b),selectButtonLabel:De(i,b),replaceTooltipText:De(n,b),choiceListLabels:E,UIparameterInfos:C,UIparameterInfosRules:P,validationParams:I,parameterGroupDataTypeLabel:De(y,b),disabledTooltip:De(h,b),noFieldsText:De(f,b),noLayersText:De(v,b),...g}}const Se=a.proxyCustomElement(class extends a.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolDataChange=a.createEvent(this,"analysisToolDataChange",7),this.analysisToolHelpPopoverChange=a.createEvent(this,"analysisToolHelpPopoverChange",7),this.analysisToolLoaded=a.createEvent(this,"analysisToolLoaded",7),this.analysisCustomRuleExecuting=a.createEvent(this,"analysisCustomRuleExecuting",7),this.parameterViewModel={},this.renderParameter=e=>{const s=e?.value??this.toolData[e?.name],o=e?.name??e?.displayName,l=this.parameterNotificationState?.[e.name]?.errors?.[0]??e?.validationParams,r=t.generateSelectedLayersKey(e?.name),p=this.toolData[r];let m=p;0===p?.length?m=void 0:1===p?.length&&(m=p[0]);const u=t.generateParamGroupDataTypeKey(e?.name),c=this.toolData[u],d=Array.isArray(p)?this.filterModelVariableLayers(p):void 0,y=[...this.mapLayers??[],...d??[]],h=t.uniqueMapLayers(y);return a.h(ke,{...e,key:o,name:o,toolTitle:this.toolTitle,value:s,validationParams:l,mapLayers:h,modelVariableLayers:this.modelVariableLayers,analysisDatasets:this.analysisDatasets,mapView:this.mapView,selectedLayers:m,paramGroupDataType:c,portal:this.portal,user:this.user,doCalciteInputChangeOnCommit:this.options?.doCalciteInputChangeOnCommit,paramGroupFilterLayersByChip:this.options?.paramGroupFilterLayersByChip,portalHelpMap:this.portalHelpMap,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl,toolData:this.toolData,onSetRef:a=>this.handleOnSetRef(e.name,a),onValueChange:a=>!0===this.options?.debounceParameterChanged?this.debouncedParameterChanged(e.name,a):this.parameterChanged(e.name,a),onHelpClick:a=>{const{paramName:s=e.name,paramLabel:n=e.label??s,refElement:o=this.renderedParameters[s]}=a.detail??{};t.removeHelpPopovers(),this.toolHelpPopover=i.showHelp(this.toolHelpPopover,{analysisEngine:this.analysisEngine,helpUrl:this.toolHelpFilePath,helpId:s,helpFileName:this.toolJson?.name,heading:n,referenceElement:o,isHelpFileExternalAsset:this.isHelpFileExternalAsset,portal:this.portal??this.user?.portal,portalHelpMap:this.portalHelpMap,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,helpMode:this.helpMode})},onClick:()=>{n.removeOpenableDomElement(this.toolHelpPopover)}})},this.renderParameterContainer=(e,s)=>{const i=e?.summaryText,n=p.AnalysisToolUILayout.Vertical;return a.h(Le,{...e,componentName:e.componentName,label:e.label,summaryText:De(i,this.toolUIStrings??this.internalToolUIStrings),style:t.isNotEmpty(s)?void 0:{display:"none"}},a.h("div",{class:`parameters-container ${n}`},s))},this.handleOnSetRef=(e,a)=>{null!==a?this.renderedParameters[e]=a:(delete this.renderedParameters[e],delete this.toolData[e])},this.parameterChanged=(e,a)=>{const{target:s,detail:i}=a,n={...this.toolData},{travelModeInfo:o}=this.toolUIJson??{};if(null!==s&&void 0!==e){const a=s;if(void 0!==this.toolJson&&a.value!==t.StraightLineParameterValue&&!0===t.isTravelModeParameter(e,this.toolJson.name)){if(void 0!==o?.travelModes){const t=o?.travelModes.filter((e=>e.id===a.value))[0];n[e]={...t}}}else if("timeOfDay"===e){const t=a.value;n[e]=t?.timeOfDay,n.timeZoneForTimeOfDay=t?.timeZoneForTimeOfDay}else if("analysisVariables"===e){const{analysisVariables:t,country:s,hierarchy:i,labels:o,countryAlias:l,hierarchyAlias:r}=a.value??{};n[e]=t,n.labels=o,void 0!==s&&(n.country=s),void 0!==i&&(n.hierarchy=i),void 0!==l&&(n.countryAlias=l),void 0!==r&&(n.hierarchyAlias=r)}else if("queryBuilder"===e){const{expressions:e,inputLayers:t}=a.value??{};n.expressions=e,n.inputLayers=t}else{let s;switch(a.nodeName){case"ANALYSIS-PARAMETER-GROUP":s=a.value,n[e]=s;const o=t.generateParamGroupDataTypeKey(e),l=a.dataType;n[o]=l,("GPFeatureRecordSetLayer"===l||"GPRecordSet"===l||"GPComposite"===l&&t.isNotEmpty(s)&&("GPFeatureRecordSetLayer"===s.dataType||"GPRecordSet"===s.dataType))&&(n[t.generateSelectedLayersCreationModeKey(e)]=i?.creationMode??"browse");break;case"ANALYSIS-LAYER-INPUT":s=a.value,n[e]=s,n[t.generateSelectedLayersCreationModeKey(e)]=i?.creationMode??"browse";break;default:s=a.value,n[e]=s}}n[ne]=this[ne],this.toolData=n,this.analysisToolDataChange.emit({toolData:n,parameterName:e})}},this.debouncedParameterChanged=X.debounce(this.parameterChanged,500),this.toolUIJson=void 0,this.toolHelpFilePath=void 0,this.isHelpFileExternalAsset=!1,this.analysisEngine=U.AnalysisEngine.Standard,this.usePanel=!0,this.closable=!0,this.toolUIStrings=void 0,this.toolJson=void 0,this.skipApplyingDefaults=!1,this.toolParameters=void 0,this.toolData={},this.mapLayers=void 0,this.modelVariableLayers=void 0,this.mapView=void 0,this.analysisDatasets=void 0,this.learnMoreUrl=void 0,this.externalHelpMap=void 0,this.user=void 0,this.portal=void 0,this.portalHelpMap=void 0,this.toolHelpPopover=void 0,this.environmentSettings=void 0,this.parameterNotificationState={},this.supportsUpload=!1,this.serviceUrl=void 0,this.emitAnalysisCustomRuleExecuting=e=>this.analysisCustomRuleExecuting.emit(e),this.helpMode="standalone",this.options={debounceParameterChanged:!1,doCalciteInputChangeOnCommit:!1,paramGroupFilterLayersByChip:!1},this.renderedParameters={},this.internalToolUIStrings=void 0}toolUIJsonChange(e,a){!1===ee.isEqual(e?.t9n,a?.t9n)&&(this.internalToolUIStrings={...e?.t9n})}async toolDataChange(e,a){const s=this.portal?.helperServices.geoenrichment?.url;if(!t.isEmptyDataItem(s)&&"EnrichLayer"===this.toolJson?.name&&void 0!==this.toolUIJson&&!ee.isEqual(m.omit$1(e?.inputLayer,"serviceToken"),m.omit$1(a?.inputLayer,"serviceToken"))){let a;void 0===e||t.isEmptyDataItem(e?.inputLayer)||(a=await t.getCountry({inputLayer:this.renderedParameters.inputLayer.selectedLayers,mapView:this.mapView,geoenrichmentUrl:s})),void 0===e||!t.isEmptyDataItem(e.inputLayer)&&e.country===a||(e.analysisVariables=void 0,e.hierarchy=void 0,e.country=a),this.toolData={...this.toolData,...p.pick$1(e,"inputLayer","analysisVariables","hierarchy","country")}}}async onUserChange(){let e=!1;void 0!==this.portal&&(e=await t.isStandardAnalysisServerAdvanced(this.portal)),this.toolData={...this.toolData,userSettings:{unitSystem:this.user?.units,hasNAPrivilege:t.hasNAPrivilege(this.user),hasGEPrivilege:t.hasGeoEnrichmentPrivilege(this.user),hasAdvancedLicense:e}},this.analysisToolDataChange.emit({toolData:this.toolData,parameterName:void 0})}toolHelpPopoverChange(){this.analysisToolHelpPopoverChange.emit()}disconnectedCallback(){n.removeOpenableDomElement(this.toolHelpPopover)}async componentWillRender(){this.toolParameters=void 0!==this.toolUIJson?await this.buildWithUIParameters(this.toolUIJson.UIparameters):this.buildWithoutUIParameters()}async componentWillLoad(){const{rtl:e}=t.getLocaleInfo(this.hostElement);this.direction=!0===e?"rtl":"ltr";let a=!1;if(void 0!==this.user&&(a=await t.isStandardAnalysisServerAdvanced(this.user?.portal)),void 0!==this.toolUIJson&&this.toolUIJsonChange(this.toolUIJson),void 0!==this.toolUIStrings&&(this.internalToolUIStrings={...this.toolUIStrings},void 0!==this.toolUIJson&&void 0===this.toolUIJson?.t9n&&(this.toolUIJson.t9n=this.toolUIStrings)),void 0!==this.toolJson?.parameters&&!this.skipApplyingDefaults){const e=await this.getDefaultValues(a,this.toolJson.parameters,this.toolUIJson?.UIparameters);this.toolData=ye({},e,this.toolData??{},((e,a)=>t.isEmptyDataItem(a)?e:void 0)),t.isEmptyDataItem(this.toolData)||this.analysisToolDataChange.emit({toolData:this.toolData,parameterName:void 0})}}componentDidLoad(){this.toolData[ne]=this[ne],this.analysisToolLoaded.emit()}async validateTool(){const e=await this.checkToolValidity(),a=await this.checkToolValidationRules();return void 0!==e&&a.push(e),{valid:0===a.length,errorKeys:a}}get toolTitle(){let e;if(void 0!==this.toolJson&&void 0!==this.internalToolUIStrings?.toolInfo){const a=`${t.toCamelToolName(this.toolJson?.name)}${t.formatAnalysisEngineSuffix(this.analysisEngine)}`;e=this.internalToolUIStrings.toolInfo?.[a]}else e=this.toolJson?.displayName;return e=e??this.toolUIJson?.toolName??this.toolJson?.displayName,e}render(){const e=this.hasParameters?this.toolParameters:this.showEmpytNotice();return a.h(a.Host,{key:"ce33000bde650e740204a275ff21c9da8339abcf"},!0===this.usePanel?a.h("calcite-panel",{dir:this.direction,heading:this.toolTitle,closable:this.closable,ref:e=>{this.panelElement=e}},a.h("calcite-action",{label:"",text:"",icon:"information",slot:"header-actions-end",onClick:()=>{void 0!==this.toolHelpFilePath&&(this.toolHelpPopover=i.showHelp(this.toolHelpPopover,{helpUrl:this.toolHelpFilePath,helpId:"toolDescription",heading:this.toolTitle,referenceElement:this.panelElement,isHelpFileExternalAsset:!0,portal:this.portal??this.user?.portal,portalHelpMap:this.portalHelpMap,helpFileName:this.toolJson?.name,analysisEngine:this.analysisEngine,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase,learnMoreUrl:this.learnMoreUrl,offsetDistance:15,externalHelpMap:this.externalHelpMap}))}}),e):e)}get hasParameters(){const e=this.toolJson?.parameters?.filter((e=>"context"!==e.name&&"esriGPParameterDirectionOutput"!==e.direction))?.length;return(this.toolUIJson?.UIparameters?.length??0)+(e??0)>0}filterModelVariableLayers(e){return e?.filter((e=>t.isNotEmpty(e)&&void 0===this.modelVariableLayers?.find((a=>a.id===e.id))))}showEmpytNotice(){const e=!0===this.user?.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[o.helpMapEnterprise.map.OtherHelpLinks.noParameters]:o.helpMap.map.OtherHelpLinks.noParameters,s=t.formatLearnMoreHelpUrl({url:e,basePath:t.getHelpBaseUrl(this.user?.portal),portalUrl:this.user?.portal?.restUrl}),i=t.formatMessage(this.internalToolUIStrings?.noParametersLearnMore,{docLink:s});return a.h("calcite-notice",{class:"notice-margin",open:!0,icon:!0,kind:"info"},a.h("div",{slot:"message"},this.internalToolUIStrings?.noParametersText," "),a.h("div",{slot:"link",innerHTML:i}))}async buildWithUIParameters(e){const{rules:a,travelModeInfo:s}=this.toolUIJson??{},i=u.getRulesByDestination(a??[]),n=u.joinParams(e??[],this.toolJson?.parameters??[]),o=[];for(let e of n){const a=e.name;if(void 0===a){o.push(e);continue}let n=this.toolData;void 0!==this.toolJson&&!0===t.isTravelModeParameter(a,this.toolJson.name)?[e,n]=u.adaptForTravelModes({param:e,data:n,travelModeInfo:s,straightLineLabel:this.internalToolUIStrings?.straightLineLabel??void 0}):(n[a]??(n[a]=e.value),e.value=n[a]);const l=i.get(a);if(void 0!==l&&([e,n]=await u.applyRules({param:e,data:n,rules:l,renderedParameters:this.renderedParameters,currentTool:this.hostElement})),[e,n]=u.applyVisibilityRules({param:e,data:n,renderedParameters:this.renderedParameters}),o.push(e),void 0!==e.name&&void 0===e.UIparameters){const a=p.pick$1(e,[...oe,...le]);if("UIparameterInfos"in e){const t={};e.UIparameterInfos?.forEach((e=>{void 0!==e.name&&(t[e.name]=p.pick$1(e,oe))})),a.uiParameterInfoSubSet=t}this[ne][e.name]=a}}return Promise.all(o.filter((e=>!1!==e.visible)).map((e=>Ae(e,this.toolUIStrings??this.internalToolUIStrings))).map((async e=>{if(void 0!==e.UIparameters){const a=await this.buildWithUIParameters(e.UIparameters);return this.renderParameterContainer(e,a)}{const a=e;return this.renderParameter(a)}})))}buildWithoutUIParameters(){const e=this.toolJson?.parameters??[];return e?.filter((e=>"esriGPParameterDirectionInput"===e.direction)).map(this.renderParameter)}async getDefaultValues(e,a,s){let i={};const{travelModeInfo:n,rules:o}=this.toolUIJson??{},{name:l}=this.toolJson??{},r=t.getUIParamsByName(s??[]);i=u.applyUserSettings({defaultValues:i,user:this.user,hasAdvancedLicense:e}),i=u.applyToolUIJsonParameterDefaults({defaultValues:i,toolName:l,toolUIJsonParametersByName:r,travelModeInfo:n}),i=u.applyToolParameterDefaults({defaultValues:i,toolJsonParameters:a,toolUIJsonParametersByName:r}),i=await u.applyUserSettingsRules({defaultValues:i,toolUIJsonParametersByName:r,rules:o});const p=await this.getDefaultLayerValues(a);return i={...i,...p},i}async getDefaultLayerValues(e){const a={};for(const s of e)if(void 0!==s.defaultValue&&null!==s.defaultValue&&"object"==typeof s.defaultValue&&("GPFeatureRecordSetLayer"===s.dataType||"GPRecordSet"===s.dataType)&&"url"in s.defaultValue){const{existingLayers:e,layersToAdd:i}=await t.convertJobLayersToMapLayers([s.defaultValue],this.mapLayers??[]);a[t.generateSelectedLayersKey(s?.name)]=[...e,...i]}return a}async checkToolValidity(){const e=Object.values(this.renderedParameters).filter((e=>"checkValidity"in e&&"function"==typeof e.checkValidity)).map((e=>e.checkValidity()));return!0===await Promise.all(e).then((e=>e.every((e=>!0===e))))?void 0:t.DEFAULT_ERROR_KEY}async checkToolValidationRules(){const{validationRules:e}=this.toolUIJson||{},a=[];if(!t.isEmptyDataItem(e))for(const s of e)!0===await t.processValidationRule({rule:s,data:this.toolData,renderedParams:this.renderedParameters,currentTool:this.hostElement})&&a.push(s.errorKey);return a}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{toolUIJson:["toolUIJsonChange"],toolData:["toolDataChange"],user:["onUserChange"],toolHelpPopover:["toolHelpPopoverChange"]}}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.parameters-container{display:flex;justify-content:space-between;column-gap:5%;width:var(--analysis-parameter-default-width)}.horizontal{flex-direction:row;align-items:center}.vertical{flex-direction:column}.notice-margin{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}"}},[1,"analysis-tool",{toolUIJson:[16],toolHelpFilePath:[513,"tool-help-file-path"],isHelpFileExternalAsset:[516,"is-help-file-external-asset"],analysisEngine:[513,"analysis-engine"],usePanel:[516,"use-panel"],closable:[516],toolUIStrings:[16],toolJson:[16],skipApplyingDefaults:[4,"skip-applying-defaults"],toolData:[1040],mapLayers:[16],modelVariableLayers:[16],mapView:[16],analysisDatasets:[16],learnMoreUrl:[513,"learn-more-url"],externalHelpMap:[16],user:[16],portal:[16],portalHelpMap:[16],toolHelpPopover:[1040],environmentSettings:[16],parameterNotificationState:[16],supportsUpload:[4,"supports-upload"],serviceUrl:[1,"service-url"],emitAnalysisCustomRuleExecuting:[16],helpMode:[1,"help-mode"],options:[16],toolParameters:[32],renderedParameters:[32],internalToolUIStrings:[32],validateTool:[64]},void 0,{toolUIJson:["toolUIJsonChange"],toolData:["toolDataChange"],user:["onUserChange"],toolHelpPopover:["toolHelpPopoverChange"]}]);function we(){"undefined"!=typeof customElements&&["analysis-tool","analysis-areal-unit-input","analysis-attribute-expression","analysis-block","analysis-boolean-input","analysis-chip-group","analysis-data-file-input","analysis-dataset-input","analysis-dataset-input-popover","analysis-date-input","analysis-expression-group","analysis-field-input","analysis-field-select","analysis-folder-input","analysis-geoenrichment-databrowser","analysis-geoenrichment-input","analysis-help-popover","analysis-item-browser","analysis-item-input","analysis-key-value","analysis-label","analysis-layer-input","analysis-layer-input-popover","analysis-linear-unit-input","analysis-multiple-input","analysis-number-input","analysis-overwrite","analysis-parameter-group","analysis-query-builder","analysis-query-entry","analysis-query-input","analysis-query-modal","analysis-query-target-select","analysis-section","analysis-sketch","analysis-spatial-expression","analysis-spatial-reference-input","analysis-spatial-reference-selector","analysis-string-input","analysis-summary-fields","analysis-summary-fields-popover","analysis-traffic-time-input","analysis-tree","analysis-unsupported-input","analysis-value-table","analysis-workflow-select","analysis-workflow-select-popover"].forEach((e=>{switch(e){case"analysis-tool":customElements.get(e)||customElements.define(e,Se);break;case"analysis-areal-unit-input":customElements.get(e)||c.defineCustomElement();break;case"analysis-attribute-expression":customElements.get(e)||d.defineCustomElement();break;case"analysis-block":customElements.get(e)||y.defineCustomElement();break;case"analysis-boolean-input":customElements.get(e)||h.defineCustomElement();break;case"analysis-chip-group":customElements.get(e)||f.defineCustomElement();break;case"analysis-data-file-input":customElements.get(e)||v.defineCustomElement();break;case"analysis-dataset-input":customElements.get(e)||g.defineCustomElement();break;case"analysis-dataset-input-popover":customElements.get(e)||b.defineCustomElement();break;case"analysis-date-input":customElements.get(e)||E.defineCustomElement();break;case"analysis-expression-group":customElements.get(e)||m.defineCustomElement();break;case"analysis-field-input":customElements.get(e)||C.defineCustomElement();break;case"analysis-field-select":customElements.get(e)||P.defineCustomElement();break;case"analysis-folder-input":customElements.get(e)||I.defineCustomElement();break;case"analysis-geoenrichment-databrowser":customElements.get(e)||T.defineCustomElement();break;case"analysis-geoenrichment-input":customElements.get(e)||k.defineCustomElement();break;case"analysis-help-popover":customElements.get(e)||U.defineCustomElement();break;case"analysis-item-browser":customElements.get(e)||L.defineCustomElement();break;case"analysis-item-input":customElements.get(e)||D.defineCustomElement();break;case"analysis-key-value":customElements.get(e)||p.defineCustomElement();break;case"analysis-label":customElements.get(e)||A.defineCustomElement();break;case"analysis-layer-input":customElements.get(e)||S.defineCustomElement();break;case"analysis-layer-input-popover":customElements.get(e)||l.defineCustomElement();break;case"analysis-linear-unit-input":customElements.get(e)||w.defineCustomElement();break;case"analysis-multiple-input":customElements.get(e)||H.defineCustomElement();break;case"analysis-number-input":customElements.get(e)||V.defineCustomElement();break;case"analysis-overwrite":customElements.get(e)||i.defineCustomElement();break;case"analysis-parameter-group":customElements.get(e)||M.defineCustomElement();break;case"analysis-query-builder":customElements.get(e)||x.defineCustomElement();break;case"analysis-query-entry":customElements.get(e)||J.defineCustomElement();break;case"analysis-query-input":customElements.get(e)||N.defineCustomElement();break;case"analysis-query-modal":customElements.get(e)||R.defineCustomElement();break;case"analysis-query-target-select":customElements.get(e)||q.defineCustomElement();break;case"analysis-section":customElements.get(e)||G.defineCustomElement();break;case"analysis-sketch":customElements.get(e)||O.defineCustomElement();break;case"analysis-spatial-expression":customElements.get(e)||F.defineCustomElement();break;case"analysis-spatial-reference-input":customElements.get(e)||B.defineCustomElement();break;case"analysis-spatial-reference-selector":customElements.get(e)||$.defineCustomElement();break;case"analysis-string-input":customElements.get(e)||j.defineCustomElement();break;case"analysis-summary-fields":customElements.get(e)||_.defineCustomElement();break;case"analysis-summary-fields-popover":customElements.get(e)||K.defineCustomElement();break;case"analysis-traffic-time-input":customElements.get(e)||W.defineCustomElement();break;case"analysis-tree":customElements.get(e)||z.defineCustomElement();break;case"analysis-unsupported-input":customElements.get(e)||Y.defineCustomElement();break;case"analysis-value-table":customElements.get(e)||u.defineCustomElement();break;case"analysis-workflow-select":customElements.get(e)||Z.defineCustomElement();break;case"analysis-workflow-select-popover":customElements.get(e)||Q.defineCustomElement()}}))}we(),e.AnalysisParameter=ke,e.AnalysisParameterContainer=Le,e.AnalysisTool=Se,e.createComponent=Ue,e.defineCustomElement=we}));