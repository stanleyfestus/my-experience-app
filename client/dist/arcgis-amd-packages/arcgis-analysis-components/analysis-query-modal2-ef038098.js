define(["exports","./index-60d8a971","./index2-31657c04","./analysis-expression-group2-c43af168","./utils-c381fe27","./analysis-attribute-expression2-5251ae6f","./analysis-query-builder2-d6563e02","./analysis-query-entry2-6efeefcb","./analysis-query-target-select2-d19b2afa","./analysis-spatial-expression2-00a2b684"],(function(e,s,t,i,a,n,r,o,l,d){"use strict";const h=s.proxyCustomElement(class extends s.H{constructor(){super(),this.__registerHost(),this.analysisQueryModalAdd=s.createEvent(this,"analysisQueryModalAdd",7),this.analysisQueryModalDismissed=s.createEvent(this,"analysisQueryModalDismissed",7),this.analysisQueryModalError=s.createEvent(this,"analysisQueryModalError",7),this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onQueryError=e=>{this.analysisQueryModalError.emit(e.detail)},this.onTargetChange=e=>{this.target=e.target.target},this.onSelectExpressionType=e=>{const s=e.target;this.selectedExpressionType=s.value},this.onOnboardingNextClick=()=>{this.expressionGroup=this.createDefaultGroup(),this.isOnboarding=!1},this.onAddClick=()=>{this.analysisQueryModalAdd.emit(this.newValue??this.expressionGroup),this.close()},this.onClose=()=>{this.analysisQueryModalDismissed.emit()},this.onQueryChange=e=>{this.newValue=e.detail},this.selectedExpressionType="attribute",this.isOnboarding=!0,this.value=void 0,this.mode=void 0,this.expressionGroup=void 0,this.target=void 0,this.layers=[],this.open=void 0,this.recordsTerm="features",this.options=void 0}async componentWillLoad(){({strings:this.strings}=await t.fetchComponentLocaleStrings(this.hostElement,s.getAssetPath("."))),this.isOnboarding=void 0===this.value||"string"!=typeof this.value&&this.value.expressions.length<1,await Promise.allSettled(this.layers.map((e=>e.load())))}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&void 0!==this.spatialExpressionTile&&(this.tooltipRef.referenceElement=this.spatialExpressionTile)}get loadedLayers(){return(0===this.layers.length&&void 0!==this.target?[this.target]:this.layers).filter((e=>e.loaded))}createDefaultGroup(){const e=this.target??this.loadedLayers[0];let s=new i.ExpressionGroup(e,"and");return s="group"===this.selectedExpressionType?s.addNewGroup("and"):"spatial"===this.selectedExpressionType?s.addDefaultSpatialExpression(e,this.loadedLayers):s.addDefaultExpression(this.options),s}render(){return s.h("calcite-modal",{key:"14dae76fa78faa5f419bc0db532aa517f7bd80c3",open:this.open,escapeDisabled:!0,outsideCloseDisabled:!0,ref:e=>this.containerRef=e,onCalciteModalClose:this.onClose},s.h("div",{key:"35958b178cfcae06de8584cfb0efa9ade42838a2",slot:"header"},this.strings.header),s.h("div",{key:"86e9370a2272932dd38c66a9df2f1263abdea1f5",slot:"content"},this.isOnboarding?this.renderOnboardingContent():this.renderQueryBuilder()),s.h("calcite-button",{key:"c59552d88f4834404c6ae73cf9f8d14cafd1d248",slot:"secondary",width:"full",appearance:"outline",onClick:this.close},this.strings.cancel),s.h("calcite-button",{key:"c1ef120a886754f03ad58009750cae7a45c3dec1",slot:"primary",width:"full",onClick:this.isOnboarding?this.onOnboardingNextClick:this.onAddClick},this.isOnboarding?this.strings.next:this.strings.add))}renderOnboardingContent(){const e=new Set(this.layers.map(a.formatLayerUrlAndId)),t="sql"!==this.mode?"expression-tile-select-w-third":"";return s.h(s.Fragment,null,s.h("analysis-query-target-select",{target:this.target,layers:this.loadedLayers,onAnalysisQueryTargetSelectChange:this.onTargetChange,recordsTerm:this.recordsTerm,disabled:"sql"===this.mode}),s.h("calcite-tile-select-group",{class:"expression-tile-select-group"},s.h("calcite-tile-select",{class:t,heading:this.getString(this.strings.attributeExpressionTitle,this.strings.expressionTitle),description:this.getString(this.strings.attributeExpressionDescription,this.strings.expressionDescription),checked:"attribute"===this.selectedExpressionType||void 0,icon:"list-check",value:"attribute",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),"sql"!==this.mode&&s.h(s.Fragment,null,s.h("calcite-tile-select",{class:t,ref:e=>{e&&(this.spatialExpressionTile=e)},heading:this.strings.spatialExpressionTitle,description:this.strings.spatialExpressionDescription,checked:"spatial"===this.selectedExpressionType||void 0,icon:"geographic-link-chart-layout",value:"spatial",disabled:e.size>1==0,inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),e.size>1==0&&s.h("calcite-tooltip",{label:this.strings.spatialExpressionTwoLayers,referenceElement:this.spatialExpressionTile,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),s.h("calcite-tile-select",{class:t,heading:this.strings.expressionGroupTitle,description:this.strings.expressionGroupDescription,checked:"group"===this.selectedExpressionType||void 0,icon:"group-form-plus",value:"group",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType})))}renderQueryBuilder(){return s.h("analysis-query-builder",{expressionGroup:this.expressionGroup,layers:this.loadedLayers,mode:this.mode,recordsTerm:this.recordsTerm,onAnalysisQueryChange:this.onQueryChange,onAnalysisQueryError:this.onQueryError,options:this.options})}getString(e,s){return"features"===this.recordsTerm?e:s}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.query-modal{--calcite-modal-width:60rem}.expression-tile-select-group{justify-content:center}.expression-tile-select-w-third{width:33%}"}},[0,"analysis-query-modal",{value:[1],mode:[513],expressionGroup:[16],target:[1040],layers:[16],open:[4],recordsTerm:[513,"records-term"],options:[16],selectedExpressionType:[32],isOnboarding:[32]}]);function c(){"undefined"!=typeof customElements&&["analysis-query-modal","analysis-attribute-expression","analysis-expression-group","analysis-query-builder","analysis-query-entry","analysis-query-target-select","analysis-spatial-expression"].forEach((e=>{switch(e){case"analysis-query-modal":customElements.get(e)||customElements.define(e,h);break;case"analysis-attribute-expression":customElements.get(e)||n.defineCustomElement();break;case"analysis-expression-group":customElements.get(e)||i.defineCustomElement();break;case"analysis-query-builder":customElements.get(e)||r.defineCustomElement();break;case"analysis-query-entry":customElements.get(e)||o.defineCustomElement();break;case"analysis-query-target-select":customElements.get(e)||l.defineCustomElement();break;case"analysis-spatial-expression":customElements.get(e)||d.defineCustomElement()}}))}c(),e.AnalysisQueryModal=h,e.defineCustomElement=c}));