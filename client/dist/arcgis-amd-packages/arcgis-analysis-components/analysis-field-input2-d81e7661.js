define(["exports","./index-60d8a971","./index2-31657c04","./analysis-field-select2-d08f3f3d","./analysis-label2-5082e9b8"],(function(e,i,s,t,l){"use strict";const a=i.proxyCustomElement(class extends i.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisFieldInputChange=i.createEvent(this,"analysisFieldInputChange",7),this.analysisHelpClick=i.createEvent(this,"analysisHelpClick",7),this.filterOutGeometryFields=e=>{let i=e;return void 0!==this.mapLayer&&(i=e.filter((e=>!1===[this.mapLayer?.geometryFieldsInfo?.shapeAreaField,this.mapLayer?.geometryFieldsInfo?.shapeLengthField].includes(e.name)))),i},this.getEmptyFieldsMessage=()=>{let e;return this.pickListFields.length>0&&0===this.filteredPickListFields.length?e=this.noFieldsText??this.strings.fieldTypesIncompatible:void 0===this.mapLayer&&void 0===this.analysisDataset?e=this.noLayersText??this.strings.layerNotSelected:this.errorMessage===this.strings.fieldLoadingErrorText&&(e=this.strings.fieldLoadingErrorText),e},this.arcgisFieldPickListDismissed=e=>{if(null!==e.detail){if(!0===this.storeAsGPValue)if(this.isMultiSelect){const i=e.detail.selectedFields;this.value=this.pickListFields.filter((e=>i.includes(e.name))).map((e=>this.convertFieldInstanceToFieldObject(e)))}else{const i=e.detail.selectedFields[0];this.value=this.convertFieldInstanceToFieldObject(this.pickListFields.find((e=>e.name===i)))}else this.value=this.isMultiSelect?e.detail.selectedFields:e.detail.selectedFields[0];this.analysisFieldInputChange.emit()}this.closeFieldPickList()},this.onAnalysisFieldRemoved=e=>{this.isStringArray(this.value)?this.value=this.value.filter((i=>i!==e.detail.value)):this.isGPFieldArray(this.value)?this.value=this.value.filter((i=>i.name!==e.detail.value)):this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()},this.openFieldPickList=()=>{this.fieldPickListOpen=!0},this.closeFieldPickList=()=>{this.fieldPickListOpen=!1,this.validate()},this.validate=()=>{let e;this.required&&(e=!0===s.isEmptyDataItem(this.value)?s.formatMessage(this.strings.requiredErrorMessage,{label:this.label??this.strings.requiredErrorLabelDefault}):e),this.errorMessage=e},this.errorMessage=void 0,this.pickListFields=[],this.loading=!1,this.fieldPickListOpen=!1,this.label=void 0,this.noFieldsText=void 0,this.noLayersText=void 0,this.required=!1,this.readOnly=!1,this.mapLayer=void 0,this.analysisDataset=void 0,this.fieldTypes=void 0,this.mapView=void 0,this.showFieldInfo=!0,this.selectionMode=void 0,this.usePopupTemplatesInfo=!0,this.useValueLabel=!1,this.value=void 0,this.storeAsGPValue=!1,this.selectedFields=void 0,this.placeholderText=void 0,this.showSort=!0,this.heading=void 0,this.filterPlaceholderText=void 0,this.hideFieldNames=!1,this.useDefaultValue=!1,this.allowGeometryFields=!1,this.hideHelp=!1,this.notAllowedFields=void 0}onReadOnlyChange(){this.readOnly??(this.readOnly=!1)}syncSelectedFieldsWithPickListFields(){this.syncSelectedFieldsWithValue(),this.analysisFieldInputChange.emit()}isString(e){return"string"==typeof e}isGPField(e){return!Array.isArray(e)&&"object"==typeof e&&"name"in e}isStringArray(e){return Array.isArray(e)&&e.every((e=>"string"==typeof e))}isGPFieldArray(e){return Array.isArray(e)&&e.every(this.isGPField)}syncSelectedFieldsWithValue(){const e=this.value;if(s.isEmptyDataItem(e))this.selectedFields=void 0;else if(!0===this.storeAsGPValue)if(!0===this.isMultiSelect){const i=new Set(e.map((e=>e.name)));this.selectedFields=this.pickListFields.filter((e=>i.has(e.name)))}else this.selectedFields=this.pickListFields.find((i=>i.name===e.name));else if(!0===this.isMultiSelect){const i=new Set(e);this.selectedFields=this.pickListFields.filter((e=>i.has(e.name)))}else this.selectedFields=this.pickListFields.find((i=>i.name===e))}disableFieldsFromPickList(){this.notAllowedFieldsSet=new Set(this.notAllowedFields),void 0!==this.value&&this.notAllowedFieldsSet.size&&(this.isStringArray(this.value)?this.value.forEach((e=>this.notAllowedFieldsSet.delete(e))):this.isGPFieldArray(this.value)?this.value.forEach((e=>this.notAllowedFieldsSet.delete(e.name))):this.isString(this.value)?this.notAllowedFieldsSet.delete(this.value):this.notAllowedFieldsSet.delete(this.value.name))}async updatePickListFieldsFromLayer(){await this.loadPickListFieldsFromLayer(),this.maybeResetValue()}async updatePickListFieldsFromDataset(){await this.loadPickListFieldsFromDataset(),this.maybeResetValue()}get filteredPickListFields(){const e=new Set(this.fieldTypes),i=!1===this.allowGeometryFields?this.filterOutGeometryFields(this.pickListFields):this.pickListFields;return 0===e.size?i:i.filter((i=>e.has(i.type)&&!this.notAllowedFieldsSet?.has(i.name)))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await s.fetchComponentLocaleStrings(this.hostElement,i.getAssetPath("."))),void 0!==this.mapLayer?this.loadPickListFieldsFromLayer().then((()=>{this.disableFieldsFromPickList()})):void 0!==this.analysisDataset&&this.loadPickListFieldsFromDataset().then((()=>{void 0!==this.errorMessage&&""!==this.errorMessage||!0===this.abortController?.signal.aborted||this.maybeResetValue(),this.disableFieldsFromPickList()}))}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}maybeResetValue(){const e=this.filteredPickListFields??[],i=new Set(e.map((e=>e.name)));this.errorMessage=void 0;let s=!0;if(this.isMultiSelect&&Array.isArray(this.value)){let e;e=this.isStringArray(this.value)?this.value.filter((e=>i.has(e))):this.value.filter((e=>i.has(e.name))),0!==e.length&&(this.value=e,this.validate(),this.analysisFieldInputChange.emit(),s=!1)}else s=this.isString(this.value)?!i.has(this.value):!i.has(this.value?.name);!0===s&&!1===this.readOnly&&(this.useDefaultValue&&e.length>0?(!1===this.storeAsGPValue?this.value=this.isMultiSelect?[e[0].name]:e[0].name:this.value=this.isMultiSelect?[e[0]]:e[0],this.validate(),this.analysisFieldInputChange.emit()):void 0!==this.value&&(this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()))}get isMultiSelect(){return"multi"===this.selectionMode}convertFieldInstanceToFieldObject(e){return void 0!==e&&"toJSON"in e&&"function"==typeof e.toJSON?e.toJSON():e}async loadPickListFieldsFromDataset(){if(void 0!==this.abortController&&this.abortController.abort(),void 0!==this.analysisDataset){this.loading=!0;try{this.abortController=new AbortController,this.pickListFields=await this.analysisDataset.getFields({signal:this.abortController.signal})}catch(e){!1===s.wasAborted(e)&&(this.errorMessage=this.strings.fieldLoadingErrorText)}this.loading=!1}else this.pickListFields=[]}async loadPickListFieldsFromLayer(){if(void 0!==this.mapLayer)try{this.pickListFields=await s.fetchLayerFieldsInfo(this.mapLayer,this.usePopupTemplatesInfo)}catch(e){this.errorMessage=this.strings.fieldLoadingErrorText}else this.pickListFields=[]}render(){return i.h(i.Host,{key:"6f970a67d4a961416614f9ec6bb1e850152d087d"},i.h("analysis-field-select",{key:"85263e720b341ce0b68eebd9c451f1faef5f2c28",errorMessage:this.errorMessage,value:!0===s.isEmptyDataItem(this.value)?void 0:this.value,label:this.label,hideHelp:this.hideHelp,ref:e=>{this.fieldSelectElement=e},fields:this.pickListFields,useValueLabel:this.useValueLabel,selectionMode:this.selectionMode,onAnalysisSelectFieldClick:this.openFieldPickList,onAnalysisFieldRemove:this.onAnalysisFieldRemoved,placeholderText:this.placeholderText,required:this.required,readOnly:this.readOnly}),this.fieldPickListOpen&&this.renderFieldPickList())}renderFieldPickList(){const e=this.filteredPickListFields;let s;const t=this.getEmptyFieldsMessage();let l,a,d;return this.loading?s=i.h("calcite-loader",{label:this.strings.loadingFields,type:"indeterminate",slot:"no-fields"}):void 0!==t&&(s=i.h("p",{slot:"no-fields",style:{margin:"var(--analysis-half-spacing)"}},t)),this.isMultiSelect||(l=this.strings.selectFieldPicklistHeading,a=this.strings.selectOkBtnText),l=this.heading??l,d=void 0!==this.value?this.isMultiSelect?!0===this.storeAsGPValue?this.value.map((e=>e.name)):this.value:[!0===this.storeAsGPValue?this.value.name:this.value]:[],i.h("arcgis-tunnel",{reference:this.hostElement},i.h("arcgis-field-pick-list",{dir:this.dir,class:"analysis-popover",layer:this.mapLayer,mapView:this.mapView,fields:this.loading?[]:e,selectedFields:d,multiple:this.isMultiSelect,showDescription:!0,showFieldName:!this.hideFieldNames,showSort:this.showSort,showSelectionAll:e.length>0,showFieldInfo:void 0===this.analysisDataset&&this.showFieldInfo,heading:l,okBtnText:a,filterPlaceholderText:this.filterPlaceholderText,onArcgisFieldPickListDismissed:this.arcgisFieldPickListDismissed,popoverProps:{refElement:this.fieldSelectElement,autoClose:!0,popoverWidth:300,overlayPositioning:"fixed"}},s))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],notAllowedFields:["disableFieldsFromPickList"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing)}"}},[1,"analysis-field-input",{label:[513],noFieldsText:[1,"no-fields-text"],noLayersText:[1,"no-layers-text"],required:[516],readOnly:[516,"read-only"],mapLayer:[16],analysisDataset:[16],fieldTypes:[16],mapView:[16],showFieldInfo:[4,"show-field-info"],selectionMode:[513,"selection-mode"],usePopupTemplatesInfo:[516,"use-popup-templates-info"],useValueLabel:[516,"use-value-label"],value:[1025],storeAsGPValue:[4,"store-as-g-p-value"],selectedFields:[1040],placeholderText:[513,"placeholder-text"],showSort:[516,"show-sort"],heading:[513],filterPlaceholderText:[513,"filter-placeholder-text"],hideFieldNames:[516,"hide-field-names"],useDefaultValue:[516,"use-default-value"],allowGeometryFields:[516,"allow-geometry-fields"],hideHelp:[516,"hide-help"],notAllowedFields:[16],errorMessage:[32],pickListFields:[32],loading:[32],fieldPickListOpen:[32],checkValidity:[64]},void 0,{readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],notAllowedFields:["disableFieldsFromPickList"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}]);function d(){"undefined"!=typeof customElements&&["analysis-field-input","analysis-field-select","analysis-label"].forEach((e=>{switch(e){case"analysis-field-input":customElements.get(e)||customElements.define(e,a);break;case"analysis-field-select":customElements.get(e)||t.defineCustomElement();break;case"analysis-label":customElements.get(e)||l.defineCustomElement()}}))}d(),e.AnalysisFieldInput=a,e.defineCustomElement=d}));