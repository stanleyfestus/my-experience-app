define(["exports","./index-60d8a971","./index2-31657c04"],(function(e,t,s){"use strict";const i="circle",h="polygon",a="polyline",n="point",r="rectangle",l="text",c=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisSketchLayerChange=t.createEvent(this,"analysisSketchLayerChange",7),this.analysisSketchToolsRendered=t.createEvent(this,"analysisSketchToolsRendered",7),this.analysisSketchRemove=t.createEvent(this,"analysisSketchRemove",7),this.sketchUpdated=!1,this.sketchLayerTitleNumber=1,this.createSketch=()=>{void 0!==this.sketchElement&&this.removeSketch();const e=s.getReactiveUtils();this.reactiveUtilsHandler=e.on((()=>this.mapView?.map.allLayers),"change",(()=>this.handleMapLayerChange())),this.createSketchLayer(),this.mapView?.when((()=>{this.sketchElement=document.createElement("arcgis-sketch-layer-editor"),this.sketchElement.mapView=this.mapView,this.sketchElement.showSketchToolsOnly=!0,this.sketchElement.layer=this.sketchLayer,this.sketchElement.sketchToolsToHide=this.hiddenSketchTools,this.sketchElement.sketchToolsReferenceElement=this.referenceElement;const e=this.mapLayers.filter((e=>!0===e?.title?.includes(this.sketchLayerTitle)));this.sketchElement.hideSelectionTools=!(e.length>0),this.sketchElement.addEventListener("sketchContentReRender",this.handleSketchContentReRender),this.sketchElement.addEventListener("sketchUpdated",(()=>{this.sketchUpdated=!0})),this.hostElement.appendChild(this.sketchElement),this.setupMutationObserver()})),setTimeout((()=>requestAnimationFrame((()=>this.sketchElement?.setFocus()))),1)},this.handleSketchContentReRender=e=>{const t=e.detail;t===r||t===i?this.currentSketchTool=h:s.isEmptyDataItem(t)||(this.currentSketchTool=t),this.selectSketchFeatureLayer()},this.selectSketchFeatureLayer=()=>{const e=this.mapLayers.find((e=>e?.title?.includes(this.sketchLayerTitle)&&"geometryType"in e&&e?.geometryType===this.currentSketchTool));let t;void 0!==e&&(t=new CustomEvent("analysisLayerSketchChange",{detail:[e.id]}),this.previousSketchFeatureLayer=e),this.analysisSketchLayerChange.emit(t)},this.referenceElement=void 0,this.label=void 0,this.toolTitle=void 0,this.mapView=void 0,this.layerFilterType=void 0,this.mapLayers=[]}mapLayersChange(e,t){const s=e.find((e=>e.title===this.previousSketchFeatureLayer?.title)),i=this.previousSketchFeatureLayer?.source?.length!==s?.source?.length;e?.length===t?.length&&!0!==i||!0!==this.sketchUpdated||(this.selectSketchFeatureLayer(),this.updateSketchTools())}async componentWillLoad(){({strings:this.strings}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),this.createSketch()}async disconnectedCallback(){await this.removeSketch(),this.mutationObserver?.disconnect()}setupMutationObserver(){this.mutationObserver=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.length>0&&void 0!==Array.from(e.addedNodes).find((e=>"ARCGIS-SKETCH-LAYER-EDITOR-TOOLS"===e.nodeName))&&this.analysisSketchToolsRendered.emit(!0)}))})),this.mutationObserver.observe(document,{childList:!0,subtree:!0})}handleMapLayerChange(){const e=this.mapView?.map.allLayers.find((e=>e.title===this.sketchLayerTitle));void 0===e&&this.analysisSketchRemove.emit()}async removeSketch(){this.sketchUpdated=!1,this.reactiveUtilsHandler.remove(),await(this.sketchElement?.done()),this.sketchElement?.removeEventListener("sketchContentReRender",this.handleSketchContentReRender),this.sketchElement?.remove(),this.sketchElement=void 0}updateSketchTools(){const e=this.mapLayers.filter((e=>!0===e?.title?.includes(this.sketchLayerTitle)));void 0!==this.sketchElement&&(this.sketchElement.hideSelectionTools=!(e.length>0),this.sketchElement.updateSketchTools())}createSketchLayer(){this.setSketchLayerName(),this.sketchLayer=s.getMapNotesLayer(this.sketchLayerTitle),this.mapView?.map.add(this.sketchLayer)}setSketchLayerName(){let e=`${this.toolTitle?.trim()??""} ${this.label} ${this.strings.sketchLayerTitle}`.trim();e=s.convertStringToTitleCase(e);const t=this.mapView?.map.allLayers.filter((t=>t?.title?.includes(e)))??[];if(0===t?.length)this.sketchLayerTitle=e;else{let t=!1;for(;!1===t;){const s=`${e} ${this.sketchLayerTitleNumber}`;t=void 0===this.mapView?.map.allLayers.find((e=>e?.title===s)),!0===t?this.sketchLayerTitle=s:this.sketchLayerTitleNumber+=1}}}get hiddenSketchTools(){const e=Array.isArray(this.layerFilterType)?this.layerFilterType:[this.layerFilterType];let t=[n,a,h,r,i,l];return!1===e.includes("feature")?e.forEach((e=>{"feature_point"===e||"feature_multiPoint"===e?t=t.filter((e=>e!==n)):"feature_line"===e?t=t.filter((e=>e!==a)):"feature_polygon"===e&&(t=t.filter((e=>e!==h&&e!==r&&e!==i)))})):t=[l],t}render(){return t.h(t.Host,{key:"e65ae9142678ce0fffba00d922d2be5788ef9284"})}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{mapLayers:["mapLayersChange"]}}static get style(){return""}},[1,"analysis-sketch",{referenceElement:[16],label:[513],toolTitle:[1,"tool-title"],mapView:[16],layerFilterType:[1,"layer-filter-type"],mapLayers:[16],removeSketch:[64]},void 0,{mapLayers:["mapLayersChange"]}]);function o(){"undefined"!=typeof customElements&&["analysis-sketch"].forEach((e=>{"analysis-sketch"===e&&(customElements.get(e)||customElements.define(e,c))}))}o(),e.AnalysisSketch=c,e.defineCustomElement=o}));