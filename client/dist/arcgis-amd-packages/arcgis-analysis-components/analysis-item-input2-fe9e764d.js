define(["exports","./index-60d8a971","./index2-31657c04","./utils-c381fe27","./analysis-item-browser2-326c174c","./analysis-label2-5082e9b8"],(function(e,t,i,s,n,a){"use strict";const r="analysis-item-input",l={label:`${r}__label`,buttonContainer:`${r}__buttons-container`,border:`${r}__border`,loaderContainer:`${r}__loader-container`,loader:`${r}__loader`},o=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisItemInputChange=t.createEvent(this,"analysisItemInputChange",7),this.analysisHelpClick=t.createEvent(this,"analysisHelpClick",7),this.renderInitialMode=()=>{let e;if(void 0!==this.newItemMode){const i=this.getNewItemButtonProps(this.newItemMode);e=t.h("calcite-button",{appearance:"outline",scale:s.UIDefaults.Scale,kind:"neutral","icon-start":i.icon,onClick:this.openAddItem},i.label)}return t.h("div",{class:l.buttonContainer},e,t.h("calcite-button",{appearance:"outline",kind:"neutral",scale:s.UIDefaults.Scale,"icon-start":"select",onClick:this.openItemBrowser},this.selectButtonLabel??this.strings.selectItem))},this.clearSelectedItem=()=>{this.value=void 0},this.openItemBrowser=()=>{this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.selectItem,this.itemBrowserElement.filter=this.filterExpression,this.itemBrowserElement.q=this.q,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.user=this.user,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.hidePreview=this.hidePreview,this.itemBrowserElement.hideFilters=!0,this.itemBrowserElement.hideAddToMap=!0,this.itemBrowserElement.selectionMode="single",this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.onSelectedBrowserItem),document.body.appendChild(this.itemBrowserElement)},this.onSelectedBrowserItem=e=>{null!==e.detail&&(this.value={itemId:e.detail.id})},this.openAddItem=()=>{if(void 0===this.newItemMode||void 0===this.newItemConfig)return;this.newItemElement=document.createElement("arcgis-new-item"),this.newItemElement.allowPublish=!1,this.newItemElement.allowedItemTypes=this.itemTypes,this.newItemElement.allowedModes=[this.newItemMode],this.newItemElement.api=4,this.newItemElement.config=this.newItemConfig,this.newItemElement.portal=this.portal,this.newItemElement.user=this.user;const e=[["cloudStore_amazon","dataStoreSelectCloudCredentialsAmazonS3"],["cloudStore_azure","dataStoreSelectCloudCredentialsAzureBlob"],["snowflake","dataStoreDatabaseCredentialsSnowflake"],["bigquery","dataStoreDatabaseCredentialsBigQuery"]];for(const[t,i]of e)if(`typekeywords:${t}`===this.itemFilter){this.newItemElement.firstStep=i;break}this.newItemElement.addEventListener("workflowCancel",this.closeModals),this.newItemElement.addEventListener("workflowComplete",this.onAddItemComplete),document.body.appendChild(this.newItemElement)},this.onAddItemComplete=e=>{void 0!==e.detail.id?this.value={itemId:e.detail.id}:this.value=void 0,void 0!==this.newItemElement&&(this.newItemElement.isActive=!1)},this.closeModals=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0),void 0!==this.newItemElement&&(this.newItemElement.removeEventListener("workflowCancel",this.closeModals),this.newItemElement.removeEventListener("workflowComplete",this.onAddItemComplete),this.newItemElement.remove(),this.newItemElement=void 0)},this.getNewItemButtonProps=e=>{if("file"===e)return{icon:"upload-to",label:this.strings.addFile};if("dataStore"===e)return{icon:"plus",label:this.strings.addDataStore};throw new Error("Unsupported new item mode.")},this.validate=()=>{let e;return this.required&&i.isEmptyDataItem(this.value)?(e=!1,this.errorMessage=this.strings.requiredInputMessage):(e=!0,this.errorMessage=void 0),e},this.renderLoader=()=>{const e=!0===this.isProcessingItem;return t.h("div",{class:l.loaderContainer},t.h("calcite-loader",{class:l.loader,hidden:!e,inline:!0,label:"loader",scale:s.UIDefaults.Scale,type:"indeterminate"}),e?this.processingItemMessage??this.strings.queryModelArgsMsg:null)},this.onListItemMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.replaceTooltipText??this.strings.replaceItem),this.replaceTooltip.referenceElement=t,s.addOpenableDomElement(document,this.replaceTooltip))},this.onListItemMouseOut=()=>{s.removeOpenableDomElement(this.replaceTooltip)},this.onListItemClick=e=>{const t=e.target;"calcite-list-item"===t?.localName&&this.openItemBrowser()},this.isProcessingItem=!1,this.errorMessage=void 0,this.selectedItem=void 0,this.deepLearningParameters={},this.value=void 0,this.required=!1,this.label=void 0,this.itemTypes=[],this.itemFilter=void 0,this.q=void 0,this.sharingLevels=void 0,this.hidePreview=!1,this.newItemMode=void 0,this.selectButtonLabel=void 0,this.processingItemMessage=void 0,this.replaceTooltipText=void 0,this.newItemConfig=void 0,this.user=void 0,this.portal=void 0,this.selectedItemIcon=void 0}async hydrateSelectedItem(e){const t=e?.itemId;if(t!==this.selectedItem?.id){if(void 0===t)this.selectedItem=void 0,this.deepLearningParameters=void 0;else{const e=i.getPortalItemMemo(t,this.portal);try{await e.load(),this.selectedItem=e,await this.loadItemProperties()}catch(e){this.value=void 0,"object"==typeof e&&null!==e&&("identity-manager:not-authorized"===e.name?this.errorMessage=this.strings.itemPermissionDenied:"request:server"===e.name&&"object"==typeof e.details&&null!==e.details&&"CONT_0001"===e.details.messageCode&&(this.errorMessage=this.strings.itemNotFound))}}this.analysisItemInputChange.emit()}}validateOnValueChange(){this.validate()}get hasError(){return void 0!==this.errorMessage}get filterExpression(){return s.makePortalSearchFilter(this.itemTypes,this.itemFilter)}get bucketOptions(){let e;if(void 0!==this.sharingLevels){e=[...this.sharingLevels];const t=e.indexOf("org-admin");t>=0&&(e.splice(t,1),"org_admin"!==this.user.role||e.includes("org")||e.push("org"))}return e}async componentWillLoad(){({strings:this.strings}=await i.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),this.hydrateSelectedItem(this.value)}disconnectedCallback(){this.closeModals(),s.removeOpenableDomElement(this.replaceTooltip),void 0!==this.itemBrowserElement&&(this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)}async checkValidity(){const e=this.validate();return Promise.resolve(e)}render(){const e=i.isEmptyDataItem(this.value)?this.renderInitialMode():this.renderSelection();return t.h(t.Host,{key:"d222df663d9a96c19f83a516e41167ea795e5743"},void 0!==this.label&&""!==this.label?t.h("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,e,t.h("calcite-input-message",{key:"3202c97ad412ec8e2c314c07d24fbfe4176277b4",status:"invalid",scale:s.UIDefaults.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}renderSelection(){return t.h("div",null,t.h("calcite-list",{selectionMode:"none"},t.h("calcite-list-item",{key:this.selectedItem?.id,value:this.selectedItem?.id,label:this.selectedItem?.title??"",class:l.border,onMouseOver:this.onListItemMouseOver,onMouseOut:this.onListItemMouseOut,onClick:this.onListItemClick},void 0!==this.selectedItemIcon&&t.h("calcite-icon",{icon:this.selectedItemIcon,slot:"content-start"}),t.h("calcite-action",{text:this.strings.removeItem,slot:"actions-end",label:this.strings.removeItem,appearance:"transparent",icon:"x",onClick:this.clearSelectedItem}))),this.renderLoader())}async loadItemProperties(){if(void 0!==this.abortController&&this.abortController.abort(),this.deepLearningParameters=void 0,"Deep Learning Package"===this.selectedItem?.type)try{this.abortController=new AbortController,this.isProcessingItem=!0,this.deepLearningParameters=await i.processDeepLearningModelItem(this.selectedItem,this.portal,{signal:this.abortController.signal}),this.isProcessingItem=!1}catch(e){!1===i.wasAborted(e)&&(this.isProcessingItem=!1,this.errorMessage=this.strings.queryModelArgsErrMsg)}}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{value:["hydrateSelectedItem","validateOnValueChange"]}}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.analysis-item-input__border{border:1px solid var(--analysis-ui-border-input);box-shadow:none}.analysis-item-input__buttons-container{display:flex;flex-direction:row;flex-wrap:wrap;gap:var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.analysis-item-input__buttons-container>calcite-button{flex:1;max-width:100%}.analysis-item-input__label{cursor:pointer;padding-bottom:var(--analysis-half-spacing);margin-block-start:0;margin-block-end:0}.analysis-item-input__loader-container{font-size:var(--calcite-font-size--2)}.analysis-item-input__loader{margin-top:0.5rem}"}},[1,"analysis-item-input",{selectedItem:[1040],deepLearningParameters:[16],value:[1040],required:[516],label:[513],itemTypes:[16],itemFilter:[1,"item-filter"],q:[1],sharingLevels:[16],hidePreview:[4,"hide-preview"],newItemMode:[513,"new-item-mode"],selectButtonLabel:[513,"select-button-label"],processingItemMessage:[513,"processing-item-message"],replaceTooltipText:[513,"replace-tooltip-text"],newItemConfig:[16],user:[16],portal:[16],selectedItemIcon:[513,"selected-item-icon"],isProcessingItem:[32],errorMessage:[32],checkValidity:[64]},void 0,{value:["hydrateSelectedItem","validateOnValueChange"]}]);function m(){"undefined"!=typeof customElements&&["analysis-item-input","analysis-item-browser","analysis-label"].forEach((e=>{switch(e){case"analysis-item-input":customElements.get(e)||customElements.define(e,o);break;case"analysis-item-browser":customElements.get(e)||n.defineCustomElement();break;case"analysis-label":customElements.get(e)||a.defineCustomElement()}}))}m(),e.AnalysisItemInput=o,e.defineCustomElement=m}));