define(["exports","./index-60d8a971","./index2-31657c04"],(function(e,t,s){"use strict";const i=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.analysisItemBrowserSelection=t.createEvent(this,"analysisItemBrowserSelection",7),this.analysisItemBrowserAddToMap=t.createEvent(this,"analysisItemBrowserAddToMap",7),this.analysisItemBrowserClose=t.createEvent(this,"analysisItemBrowserClose",7),this.start=1,this.getAllowedItemTypes=()=>{let e=["layers","layers-weblayers-features","layers-weblayers-imagery","layers-weblayers-mapimage","layers-weblayers-tiledimagelayers","layers-weblayers-tables"];return this.viewIsSceneView&&(e=e.filter((e=>"layers-weblayers-tables"!==e))),e},this.formatSublayerUrl=e=>`${"item"in e?e.item.url:e.url}/${"sublayer"in e?e.sublayer?.id??0:""}`,this.formatErrorMessage=()=>{let e="";return e=!0===this.layerLoadingFailed&&void 0!==this.errorStrings.layerLoadFailure?this.errorStrings.layerLoadFailure:s.formatMessage(this.strings.unsupportedLayer,{layerName:this.invalidBrowsedLayers.join(", ")}),e},this.getItemDetailsUrl=e=>{let t="";if(!s.isEmptyDataItem(e)){const{id:i}=e;t=`${s.getBaseUrl(this.portal)}/home/item.html?id=${i}`}return t},this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onSelectButtonClick=async(e,t)=>{const i=!0===t?this.analysisItemBrowserAddToMap:this.analysisItemBrowserSelection;switch(this.selectionMode){case"single":i.emit(this.selectedItems[0]),this.close();break;case"multiple":default:i.emit(this.selectedItems),this.close();break;case"single-sublayer":case"multiple-sublayer":if("task"in this.selectedItems[0])return i.emit(this.selectedItems),void this.close();const t=e.target;t.loading=!0,this.browsedLayerCreating=!0;let r=[];try{const e=this.selectedItems.map((e=>s.getLayerObject({url:this.formatSublayerUrl(e)})));r=(await Promise.all(e)).filter((e=>void 0!==e)),this.invalidBrowsedLayers=await this.filterUnsupportedLayers(r),this.layerLoadingFailed=!1}catch{this.layerLoadingFailed=!0}this.browsedLayerCreating=!1,t.loading=!1,0===this.invalidBrowsedLayers.length&&!1===this.layerLoadingFailed&&(i.emit(r),this.close())}},this.onClose=()=>{this.analysisItemBrowserClose.emit()},this.onItemBrowserUpdate=e=>{this.items=e.detail.results,this.totalItems=e.detail.total,this.start=e.detail.start},this.onItemBrowserSelect=e=>{this.selectedItems=e.detail},this.onItemBrowserLoading=()=>{this.items=[],this.totalItems=void 0},this.onItemBrowserPreview=e=>{const t=e.detail;this.currentPreviewItem=t,!0===this.tasksLoading&&(this.tasksLoading=!1)},this.items=[],this.selectedItems=[],this.totalItems=void 0,this.browsedLayerCreating=!1,this.invalidBrowsedLayers=[],this.currentPreviewItem=void 0,this.layerLoadingFailed=!1,this.tasksLoading=!1,this.allowedGeometries=void 0,this.layerFilterType=void 0,this.displayMode="modal",this.filter="",this.bucketOptions=void 0,this.hidePreview=!1,this.hideFilters=!1,this.hideAddToMap=!1,this.header=void 0,this.user=void 0,this.portal=void 0,this.selectionMode=void 0,this.viewIsSceneView=void 0,this.q="",this.cardMessageOverrides=void 0}async componentWillLoad(){let e="";({strings:this.strings,locale:e}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),this.errorStrings=await s.fetchErrorsStrings(e)}render(){return this.renderModal()}renderModal(){return t.h("calcite-modal",{class:"analysis-item-browser-modal-variables",scale:"s",open:!0,escapeDisabled:!0,outsideCloseDisabled:!0,focusTrapDisabled:!0,onCalciteModalClose:this.onClose,ref:e=>this.containerRef=e},t.h("div",{slot:"header"},this.header??this.strings.header),t.h("div",{slot:"content",class:"analysis-item-browser-modal-content"},this.renderItemBrowser(),(0!==this.invalidBrowsedLayers.length||!0===this.layerLoadingFailed)&&t.h("div",{class:"analysis-item-browser-modal-alert"},t.h("calcite-alert",{open:!0,kind:"danger",label:this.formatErrorMessage(),onCalciteAlertClose:()=>{this.invalidBrowsedLayers=[],this.layerLoadingFailed=!1}},t.h("div",{slot:"title"},this.formatErrorMessage())))),t.h("calcite-button",{slot:"back",width:"full",appearance:"solid",kind:"neutral",onClick:this.close},this.strings.cancel),!1===this.hideAddToMap&&t.h("calcite-button",{slot:"primary",width:"full",appearance:"solid",disabled:!0===this.browsedLayerCreating||0===this.selectedItems?.length,onClick:e=>this.onSelectButtonClick(e,!0)},this.strings.addToMap),t.h("calcite-button",{slot:this.hideAddToMap?"primary":"secondary",appearance:this.hideAddToMap?"solid":"outline",width:"full",disabled:!0===this.browsedLayerCreating||0===this.selectedItems?.length,onClick:e=>this.onSelectButtonClick(e,!1)},this.strings.confirm))}renderItemBrowser(){const e="single-sublayer"===this.selectionMode||"multiple-sublayer"===this.selectionMode||"none"===this.selectionMode?"top":"action";return t.h("arcgis-item-browser",{api:4,allowedGeometries:this.allowedGeometries,q:this.q,filter:this.filter,num:20,config:{baseUrl:`${s.getBaseUrl(this.portal)}/home/`},portal:this.portal,user:this.user,selection:this.selectionMode??"single",onArcgisItemBrowserLoading:this.onItemBrowserLoading,onArcgisItemBrowserUpdate:this.onItemBrowserUpdate,onArcgisItemBrowserSelect:this.onItemBrowserSelect,onArcgisItemBrowserPreview:this.onItemBrowserPreview},t.h("arcgis-item-browser-top-bar",{slot:"top-bar","filter-toggle":!0},t.h("arcgis-item-browser-bucket-select",{slot:"bucket",options:this.bucketOptions}),t.h("arcgis-item-browser-search",{slot:"search",term:""})),t.h("arcgis-item-browser-sort",{slot:"sort",field:"modified"}),!1===this.hideFilters&&t.h("arcgis-item-browser-filters",{slot:"filters"},t.h("arcgis-item-browser-filter-folder",null),t.h("arcgis-item-browser-filter-categories",null),t.h("arcgis-item-browser-filter-date",{property:"modified"}),t.h("arcgis-item-browser-filter-date",{property:"created"}),t.h("arcgis-item-browser-filter-item-type",{allowedItemTypes:this.getAllowedItemTypes()}),t.h("arcgis-item-browser-filter-tags",null),t.h("arcgis-item-browser-filter-sharing",null),t.h("arcgis-item-browser-filter-content-status",null),t.h("arcgis-item-browser-filter-collaborations",null)),t.h("arcgis-item-browser-content",{slot:"content"},this.items.map((s=>t.h("arcgis-item-browser-card",{key:s.id,item:s,portal:this.portal,user:this.user,name:"item-browser",preview:this.hidePreview?void 0:e,showThumbnail:!1,messageOverrides:this.cardMessageOverrides})))),t.h("div",{slot:"preview-footer"},t.h("calcite-button",{href:this.getItemDetailsUrl(this.currentPreviewItem),target:"_blank",appearance:"outline-fill",kind:"neutral",width:"full"},this.strings.viewDetails)),t.h("arcgis-item-browser-pagination",{slot:"pagination",start:this.start,num:20,total:this.totalItems}))}async filterUnsupportedLayers(e){const{filteredLayers:t}=await s.filterLayersByType({layers:e,layerFilterTypes:this.layerFilterType,user:this.user});return[...t,...e.filter((e=>!s.checkLayerAllowAnalysis(e,this.user?.orgId)))].map((e=>e.title))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.analysis-item-browser-modal-content{height:100%}.analysis-item-browser-modal-variables{--calcite-modal-height:min(900px, calc(80vh + 100px));--calcite-modal-width:1080px;--calcite-modal-content-padding:0px}.analysis-item-browser-modal-alert{pointer-events:none;position:absolute;left:0px;bottom:0px;width:100%;display:block;z-index:50;transform:translate(0px, -0.5rem);height:calc(100% - 4rem)}"}},[0,"analysis-item-browser",{allowedGeometries:[16],layerFilterType:[1,"layer-filter-type"],displayMode:[513,"display-mode"],filter:[513],bucketOptions:[16],hidePreview:[4,"hide-preview"],hideFilters:[4,"hide-filters"],hideAddToMap:[4,"hide-add-to-map"],header:[513],user:[16],portal:[16],selectionMode:[1,"selection-mode"],viewIsSceneView:[4,"view-is-scene-view"],q:[513],cardMessageOverrides:[16],items:[32],selectedItems:[32],totalItems:[32],browsedLayerCreating:[32],invalidBrowsedLayers:[32],currentPreviewItem:[32],layerLoadingFailed:[32],tasksLoading:[32]}]);function r(){"undefined"!=typeof customElements&&["analysis-item-browser"].forEach((e=>{"analysis-item-browser"===e&&(customElements.get(e)||customElements.define(e,i))}))}r(),e.AnalysisItemBrowser=i,e.defineCustomElement=r}));