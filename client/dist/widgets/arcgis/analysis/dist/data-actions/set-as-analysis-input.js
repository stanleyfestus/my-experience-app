System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-core/react"],(function(e,t){var a={},n={},s={},i={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataLevel=e.DataLevel,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.classNames=e.classNames,a.css=e.css,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.moduleLoader=e.moduleLoader,a.urlUtils=e.urlUtils},function(e){n.featureUtils=e.featureUtils},function(e){s.Button=e.Button,s.Popper=e.Popper,s.Select=e.Select},function(e){i.default=e.default}],execute:function(){e((()=>{var e={28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";o.r(r),o.d(r,{default:()=>N});var e,t,a=o(79244),n=o(62686),s=o(14321);!function(e){e.Standard="standard",e.Custom="custom",e.RasterFunction="rfx"}(e||(e={})),function(e){e.None="NONE",e.Error="ERROR",e.Warning="WARNING",e.Info="INFO"}(t||(t={}));var i=o(68972),l=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};class c{constructor(){this.cache={}}static getInstance(){return c.instance||(c.instance=new c),c.instance}getStrings(e){return l(this,void 0,void 0,(function*(){return this.cache[e]?this.cache[e]:function(e){return l(this,void 0,void 0,(function*(){const t=yield fetch(e);return yield t.json()}))}(e).then((t=>(this.cache[e]=t,t)))}))}}function u(){return e="arcgis-analysis-assets",`${a.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/${e}/`;var e}const d=e=>(e=>{const[t,a]=i.default.useState();return i.default.useEffect((()=>{c.getInstance().getStrings(e).then(a).catch((()=>{a({})}))}),[]),t})(`${u()}assets/t9n/common.t9n.${null!=e?e:"en-US"}.json`),m=(e,t)=>{let a=e;return void 0!==t&&void 0!==e&&e.startsWith("$")&&(a=t[e.replace("$","")]),a},f={_widgetLabel:"Analysis",history:"History",result:"Result",viewDetails:"View details",openTool:"Open tool",historyEmptyPlaceholder:"After you run a tool, you can track the status at history.",run:"Run",completeAtTime:"Complete at {time}",canceling:"Canceling...",canceledAtTime:"Canceled at {time}",canceled:"Canceled",jobFailedAtTime:"Failed at {time}",jobFailed:"Failed",provisioningResources:"Provisioning resources...",submitted:"Submitted...",waiting:"Waiting...",running:"Running",cancelLabel:"Cancel analysis",uncancellableLabel:"This tool cannot be canceled.",cancelWarningText:"Are you sure you want to cancel this analysis? Current process will be lost.",keepRunning:"Keep running",cancelAnalysis:"Cancel analysis",jobAlertStatusCancelled:"{toolName} canceled",jobAlertStatusDeleted:"{toolName} deleted",jobAlertStatusFailed:"{toolName} failed",jobAlertStatusSucceededWithWarnings:"{toolName} succeeded with warnings",jobAlertStatusSucceededWithoutWarnings:"{toolName} succeeded",jobAlertStatusTimedOut:"{toolName} timed out",submittedAlertLabel:"{toolName} submitted",parameters:"Parameters",environments:"Environments",context:"Context",spatialReference:"Spatial reference",environmentSettings:"Environment settings",outputCoordinateSystem:"Output coordinate system",processingExtent:"Processing extent",snapRaster:"Snap raster",cellSize:"Cell size",resamplingMethod:"Resampling method",mask:"Mask",sameAsInput:"Same as input (default)",fullExtent:"Full extent (default)",maxOf:"Maximum of inputs",minOf:"Minimum of inputs",asSpecified:"As specified",fromLayer:"From layer",nearest:"Nearest neighbor (for discrete data)",bilinear:"Bilinear interpolation (for continuous data)",cubic:"Cubic convolution (for continuous data)",xmin:"Left (x-min)",xmax:"Right (x-max)",ymin:"Bottom (y-min)",ymax:"Top (y-max)",nowDate:"Now ({dateString})",optimizeTableView:"Optimize table view",genericFailureMessage:"{toolName} failed.",messages:"Messages",startTime:"Start time",endTime:"Completed",creditMessage:"<a href='{docLink}' target='_blank'>Credits consumed</a>",creditsMessageNoLink:"Credits consumed",zeroCreditsMessage:"No credits were consumed for this tool.",warning:"Warning",elapsedTime:"Elapsed time",failedTime:"Failed time: {failedTime}",minutes:"Minutes",hours:"Hours",days:"Days",jobCancelled:"{toolName} canceled.",jobId:"Run ID",checkCreditUsage:"Administrators can check credit usage through the credit status page. <calcite-link target='_blank' href='{url}'>Learn more.</calcite-link>",noAccess:"You do not have permission to access this result.",invalidUrl:"The result no longer exists. Run the analysis again to recreate it.",defaultLayerFailure:"The result cannot be accessed. Run the analysis again to recreate it.",toolInaccessible:"Tool is inaccessible.",_action_setAsAnalysisInput_label:"Set as Analysis input",selectTool:"Select a tool",selectParameter:"Select a parameter",noApplicableParameter:"No applicable parameter"};var p=o(28996),g=o.n(p),y=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const v=e=>{const t=window.SVG,{className:n}=e,s=y(e,["className"]),i=(0,a.classNames)("jimu-icon jimu-icon-component",n);return t?a.React.createElement(t,Object.assign({className:i,src:g()},s)):a.React.createElement("svg",Object.assign({className:i},s))};var h=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};const S=e=>e.type===a.AllDataSourceTypes.ImageryLayer||e.type===a.AllDataSourceTypes.ImageryTileLayer,b=e=>{var t;return e.type===a.AllDataSourceTypes.FeatureLayer||"feature"===(null===(t=e.layer)||void 0===t?void 0:t.type)},x={width:320,height:280},j={width:320,height:280},R=t=>{var n;const s=a.ReactRedux.useSelector((e=>window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig.utilities:e.appConfig.utilities)),o=null===(n=null==t?void 0:t.getLocaleInfo())||void 0===n?void 0:n.locale,r=d(o),l=(e=>{const t=d(e);return i.default.useMemo((()=>t?Object.assign(Object.assign({},t.toolInfo||{}),t.toolInfoKeys||{}):null),[t])})(o);return{getDisplayedToolName:a=>a&&t?a.type===e.Standard?function(e,t,a,n,s){const i=`${s(e)}${n(t)}`;return(null==a?void 0:a[i])||e}(a.toolName,a.analysisEngine,l,t.formatAnalysisEngineSuffix,t.toCamelToolName):function(e,t){var a;if(!e)return"";const n=e.config,{toolDisplayName:s}=n.option||{};if(s)return s;if(n.utility){const{utilityId:e,task:a}=n.utility,s=null==t?void 0:t[e];if(a){const e=s&&s.tasks?s.tasks.find((e=>e.name===a)):null;if(e&&e.label)return e.label}else if(s&&s.label)return s.label}return(null===(a=e.config.toolInfo)||void 0===a?void 0:a.displayName)||e.toolName}(a,s):"",getDisplayedParameterName:e=>m(e.label,r)||e.displayName}},T=e=>{const{translate:t,analysisSharedUtils:n,toolList:i,selectedTool:o,onSelectedToolChange:r,validParameters:l,selectedParameter:c,onSelectedParameterChange:u}=e,{getDisplayedToolName:d,getDisplayedParameterName:m}=R(n);return(0,a.jsx)("div",null,(0,a.jsx)("div",null,(0,a.jsx)("div",{className:"mb-1 form-item-label"},t("selectTool")),(0,a.jsx)("div",null,(0,a.jsx)(s.Select,{value:null==o?void 0:o.id,onChange:r},i.map((e=>(0,a.jsx)("option",{key:e.id,value:e.id},d(e))))))),o&&(0,a.jsx)("div",{className:"mt-4"},(0,a.jsx)("div",{className:"mb-1 form-item-label"},t("selectParameter")),(0,a.jsx)("div",null,(0,a.jsx)(s.Select,{value:null==c?void 0:c.name,onChange:u,disabled:!l.length},l.map((e=>(0,a.jsx)("option",{key:e.name,value:e.name},m(e))))),!l.length&&(0,a.jsx)("div",{className:"mt-2 warning-msg"},(0,a.jsx)(v,{className:"mr-2",color:"var(--warning-900)"}),t("noApplicableParameter")))))},w=a.css`
  flex-direction: column;
  justify-content: space-between;
  .form-item-label {
    line-height: 18px;
    font-weight: 500;
    color: var(--ref-palette-black);
  }
  .warning-msg {
    display: flex;
    align-items: center;
    line-height: 24px;
  }
  .footer{
    text-align: right;
    .btn {
      min-width: 75px;
      font-weight: 500;
    }
  }
`,A=t=>{const{activeRef:i,widgetId:o,dataSet:r,dataLevel:l,version:c,intl:u}=t,{dataSource:d}=r,[p,g]=a.React.useState(j),[y,v]=a.React.useState(!0),R=(()=>{const[e,t]=a.React.useState();return a.React.useEffect((()=>{a.moduleLoader.loadModule("arcgis-amd-packages/arcgis-analysis-shared-utils").then((e=>{t(e)}))}),[]),e})(),A=a.React.useMemo((()=>{var e;return(null===(e=null==R?void 0:R.getLocaleInfo())||void 0===e?void 0:e.locale)||""}),[R]),P=e=>u.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},f),a.defaultMessages)[e]});a.React.useEffect((()=>{v(!0),O(null),E(null)}),[c,d.id,o]);const N=()=>{v(!1),setTimeout((()=>{i.focus()}),10)},[L,D]=a.React.useState([]);a.React.useEffect((()=>{var t,n,s,i,r;if(!y)return;const l=null!==(n=null===(t=(0,a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)&&void 0!==n?n:(0,a.getAppStore)().getState(),c=null===(r=null===(i=null===(s=null==l?void 0:l.appConfig)||void 0===s?void 0:s.widgets)||void 0===i?void 0:i[o])||void 0===r?void 0:r.config;Array.isArray(null==c?void 0:c.toolList)&&D(c.toolList.asMutable({deep:!0}).filter((t=>t.type!==e.RasterFunction)))}),[y]);const[M,O]=a.React.useState(),[C,I]=a.React.useState([]),[k,E]=a.React.useState(),F=a.React.useMemo((()=>{const e=d.getGeometryType(),t=b(d),n=S(d);return C.filter((s=>{if("esriGPParameterDirectionOutput"===s.direction)return!1;if(t&&("GPRecordSet"===s.dataType||"GPMultiValue:GPRecordSet"===s.dataType))return!0;const i=l===a.DataLevel.DataSource&&t||l===a.DataLevel.Records;if(e&&i&&("GPFeatureRecordSetLayer"===s.dataType||"GPMultiValue:GPFeatureRecordSetLayer"===s.dataType)){const t=(e=>{var t;const{filter:a,defaultValue:n}=e;if("featureClass"===(null==a?void 0:a.type)&&(null===(t=null==a?void 0:a.list)||void 0===t?void 0:t.length))return a.list;if(Array.isArray(n))return n.filter((e=>!!e.geometryType)).map((e=>e.geometryType));const s=null==n?void 0:n.geometryType;return s?[s]:[]})(s);return!t.length||t.includes(e)}return!(l!==a.DataLevel.DataSource||!n||"GPRasterDataLayer"!==s.dataType&&"GPMultiValue:GPRasterDataLayer"!==s.dataType)}))}),[l,d,C]);a.hooks.useUpdateEffect((()=>{if(M&&A){if(M.type===e.Standard){const e=`${M.toolName.toLowerCase()}${null==R?void 0:R.formatAnalysisEngineSuffix(M.analysisEngine)}`,t=`${a.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/tool-json/${e}.tool.json`,n=`${a.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/tool-ui-json/${e}.tool.ui.json`,s=`${a.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/t9n/${e}/${e}.t9n.${A}.json`;Promise.all([fetch(t).then((e=>e.json())),fetch(n).then((e=>e.json())),fetch(s).then((e=>e.json()))]).then((([e,t,a])=>{var n;const s=e.parameters,i=t.UIparameters.map((e=>e.UIparameters||[])).flat(),o=null===(n=s.filter((e=>"esriGPParameterDirectionOutput"!==e.direction)))||void 0===n?void 0:n.map((e=>{const t=i.find((t=>t.name===e.name)),n=Object.assign(Object.assign({},t),e),s=m(n.label,a);return s&&(n.label=s),n}));I(o)}))}else M.type===e.Custom&&I(M.config.toolInfo.parameters);E(null)}}),[M,A]);const U=(e,t)=>{const a=e.dataType.startsWith("GPMultiValue");let n=Object.assign({},t);return"GPRasterDataLayer"!==e.dataType&&"GPMultiValue:GPRasterDataLayer"!==e.dataType||(n.inputType="layer"),a&&(n=[n]),n};return(0,a.jsx)(s.Popper,{floating:!0,open:y,headerTitle:P("_action_setAsAnalysisInput_label"),onHeaderClose:N,minSize:x,onResize:e=>{g(e)},dragBounds:"body",defaultSize:p,reference:i,toggle:(e,t)=>{"clickOutside"!==t&&N()}},(0,a.jsx)("div",{className:"h-100 p-4 d-flex",css:w},R&&(0,a.jsx)(T,{translate:P,analysisSharedUtils:R,toolList:L,selectedTool:M,onSelectedToolChange:e=>{const t=L.find((t=>t.id===e.target.value));O(t)},validParameters:F,selectedParameter:k,onSelectedParameterChange:e=>{const t=F.find((t=>t.name===e.target.value));E(t)}}),(0,a.jsx)("div",{className:"footer"},(0,a.jsx)(s.Button,{type:"primary",disabled:!M||!k,onClick:()=>h(void 0,void 0,void 0,(function*(){var e,t,s,i,c;const{records:u,fields:m,name:f}=r,p=!!d.url,g=l===a.DataLevel.DataSource,y=null===(e=d.getDataSourceJson())||void 0===e?void 0:e.isOutputFromWidget,v=a.MutableStoreManager.getInstance().readStateValue(o,"input")||{};let h;const S=d;if(g&&p&&!y){const{url:e}=S;h={url:e};const a=null===(s=null===(t=S.getCurrentQueryParams)||void 0===t?void 0:t.call(S))||void 0===s?void 0:s.where;a&&(h.filter=a)}else if(g)try{const e=yield S.createJSAPILayerByDataSource();h=yield R.getGPFeatureRecordSetLayerValue(e),p&&y&&(h.title=f)}catch(e){console.error("create feature set error",e)}else try{const e=yield n.featureUtils.convertDataRecordSetToFeatureSet({dataSource:d,records:u,fields:m,name:f}),t=d.getSchema(),s=(null==m?void 0:m.length)?m:Object.keys(null==t?void 0:t.fields)||[],o=d.getGeometryType(),r={name:`${t.label||d.getLabel()}${l===a.DataLevel.Records?" - Selection":""}`,type:o?"Feature Layer":"Table",geometryType:o,fields:s.map((e=>{const a=t.fields[e];return{name:a.name,type:a.esriType,alias:a.alias,format:a.format}})),objectIdField:t.idField,spatialReference:e.spatialReference},p=null===(c=(i=d).getCurrentQueryParams)||void 0===c?void 0:c.call(i);(null==p?void 0:p.where)&&(r.definitionExpression=p.where,r.defaultVisibility=!0),h={layerDefinition:r,featureSet:e}}catch(e){console.error("create feature set error",e)}a.MutableStoreManager.getInstance().updateStateValue(o,"toolId",M.id),a.MutableStoreManager.getInstance().updateStateValue(o,"input",Object.assign(Object.assign({},v),{[k.name]:U(k,h)})),N()}))},P("ok")),(0,a.jsx)(s.Button,{className:"ml-2",onClick:N},P("cancel")))))};var P=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};class N extends a.AbstractDataAction{isSupported(e,t){return P(this,void 0,void 0,(function*(){if(e.length>1)return!1;const s=e[0];if(S(s.dataSource))return!0;if(t===a.DataLevel.DataSource)return b(s.dataSource);const{dataSource:i,records:o,fields:r,name:l}=s;try{if((yield n.featureUtils.convertDataRecordSetToFeatureSet({dataSource:i,records:o,fields:r,name:l})).features.length)return!0}catch(e){return!1}}))}onExecute(e,t){return P(this,void 0,void 0,(function*(){const n=e[0];return this._version||(this._version=0,this._versionPrefix=Date.now()),a.React.createElement(A,{activeRef:document.querySelector(".active-data-action-item"),widgetId:this.widgetId,dataSet:n,dataLevel:t,version:`${this._versionPrefix}_${this._version++}`,intl:this.intl})}))}}})(),r})())}}}));