/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-928944.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-928944"],{5424:(e,t,o)=>{o.r(t),o.d(t,{arcgis_font_picker:()=>h});var n=o(20536),i=o(67911),s=o(34752),r=o(37568),l=o(98034),a=o(38973),c=o(369);o(91102),o(73807),o(99004),o(44090),o(10699);const d=["Arial Bold","Arial Bold Italic","Arial Italic","Arial Regular","Arial Unicode MS Bold Italic","Arial Unicode MS Italic","Avenir Bold","Avenir Bold Italic","Avenir Italic","Avenir Regular","Palatino Linotype Regular","Times New Roman Bold","Times New Roman Bold Italic","Times New Roman Italic","Times New Roman Regular","Verdana Bold","Verdana Bold Italic","Verdana Italic","Verdana Regular"];var u;!function(e){e.ascending="ascending",e.descending="descending"}(u||(u={}));const h=class{constructor(e){(0,n.r)(this,e),this.arcgisFontPickerDismissed=(0,n.c)(this,"arcgisFontPickerDismissed",7),this.arcgisFontPickerChange=(0,n.c)(this,"arcgisFontPickerChange",7),this.currentFont="",this.mapSpecificFontMap=new Map,this.view=void 0,this.enableMapSpecificFontList=!1,this.fontMap=void 0,this.font=void 0,this.popoverProps=void 0,this.showCancel=!0,this.lastSortBy=u.ascending,this.currentFontGroup=this.enableMapSpecificFontList&&this.view?"map-fonts":"static-fonts"}async setFocus(){setTimeout((()=>this.panelNode.setFocus()),100)}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async componentWillLoad(){const{font:e,enableMapSpecificFontList:t}=this;[this.strings]=await(0,r.g)(this.hostElement),this.currentFont=e&&(0,i.f)(e),await this.loadAllModules(),await this.loadAllFonts(),t&&await this.loadMapSpecificFonts()}async componentDidLoad(){const{font:e}=this;e&&setTimeout((()=>{var e,t;return null===(t=null===(e=this.listNode.selectedItems)||void 0===e?void 0:e[0])||void 0===t?void 0:t.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}),300),setTimeout((()=>requestAnimationFrame((()=>this.panelNode.setFocus()))),300)}render(){var e;const{strings:t,popoverProps:o}=this,i={width:`${o.popoverWidth||o.refElement.getBoundingClientRect().width}px`};return o.maxHeight&&(i.maxHeight=o.maxHeight),(0,n.h)(n.H,{key:"6c15dc7c5a214ffc7ab0d95eae92a495d97a9309",class:"js-app-flyout"},(0,n.h)("calcite-popover",{key:"e7882ff62efcf40d10a4a294bdfa27a067ad5082",dir:(0,s.g)(this.hostElement),class:"popover",placement:o.placement||"leading-start",open:!0,pointerDisabled:!0,referenceElement:o.refElement,offsetDistance:null!==(e=o.offsetDistance)&&void 0!==e?e:-Math.round(o.refElement.getBoundingClientRect().width),offsetSkidding:o.offsetSkidding||0,overlayPositioning:o.overlayPositioning,triggerDisabled:o.triggerDisabled,autoClose:o.autoClose,label:t.fonts,ref:e=>this.popoverNode=e},(0,n.h)("calcite-panel",{key:"51ece87081e92073e7e173a0587c3c28937ee0af",class:"panel",heading:t.fonts,closable:!0,style:i,onCalcitePanelClose:()=>this.arcgisFontPickerDismissed.emit(),ref:e=>this.panelNode=e},this.renderFontControls(),(0,n.h)("calcite-list",{key:"2bd9ffc0a0b25849e94d25f539cf96dba0e05d75",class:"content",filterEnabled:!0,filterPlaceholder:t.searchFonts,selectionMode:"single-persist",ref:e=>this.listNode=e},this.renderSortDropdown(),[...this.getSortedFontList(this.currentFontGroup)].map((([e])=>this.renderListItem(e)))),this.renderCancelButton())))}renderFontControls(){const{strings:e,view:t,enableMapSpecificFontList:o}=this;return t&&o?(0,n.h)("div",{slot:"content-top",class:"font-mode-wrapper"},(0,n.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{const t=e.target.value;this.currentFontGroup=t,setTimeout((()=>{var e,t;null===(t=null===(e=this.listNode.selectedItems)||void 0===e?void 0:e[0])||void 0===t||t.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}),300)}},(0,n.h)("calcite-segmented-control-item",{value:"map-fonts",checked:!0},e.mapFonts),(0,n.h)("calcite-segmented-control-item",{value:"static-fonts",checked:!1},e.allFonts))):null}renderListItem(e){const{strings:t,fontMap:o,mapSpecificFontMap:i,currentFont:s,currentFontGroup:r}=this,l="static-fonts"===r?o:i;return(0,n.h)("calcite-list-item",{key:e,label:e,value:e,selected:s===e,metadata:{label:e},onCalciteListItemSelect:async()=>{const e=await this.getSelectedFont();this.arcgisFontPickerChange.emit(e),this.arcgisFontPickerDismissed.emit()}},(0,n.h)("div",{class:"font-preview",slot:"actions-end",style:{fontFamily:`${l.get(e).font.family}`,fontStyle:`${l.get(e).font.style}`,fontWeight:`${l.get(e).font.weight}`}},t.fontPreview))}renderSortDropdown(){const{strings:e}=this;return(0,n.h)("calcite-dropdown",{slot:"filter-actions-end",overlayPositioning:"fixed"},(0,n.h)("calcite-action",{slot:"trigger",icon:"sortDescending",text:e.sort,title:e.sort}),(0,n.h)("calcite-dropdown-group",null,(0,n.h)("calcite-dropdown-item",{selected:this.lastSortBy===u.ascending,onClick:()=>this.lastSortBy=u.ascending,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=u.ascending)}},e.ascending),(0,n.h)("calcite-dropdown-item",{selected:this.lastSortBy===u.descending,onClick:()=>this.lastSortBy=u.descending,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=u.descending)}},e.descending)))}renderCancelButton(){const{strings:e,showCancel:t}=this;return t?(0,n.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:"full",onClick:()=>this.arcgisFontPickerDismissed.emit()},e.cancel):null}async loadAllModules(){const[e,t,o,n]=await(0,l.l)(["esri/core/fontUtils","esri/request","esri/symbols/Font","esri/portal/PortalItem"]);this.modules={fontUtils:e,request:t,symbolFontUtils:o,portalItem:n}}async loadAllFonts(){const{modules:e,fontMap:t}=this,o=Array.from(t.entries());Promise.all(o.map((async t=>{try{d.includes(t[0])||await e.fontUtils.loadFont(t[1].font)}catch(e){}})))}async loadMapSpecificFonts(){var e,t;const{view:o}=this;if(!o)return null;const n=null!==(t=null===(e=o.map.allLayers)||void 0===e?void 0:e.items)&&void 0!==t?t:[];if(n.length){const[e]=await(0,l.l)(["esri/core/CollectionFlattener"]),t=new e({getCollections:()=>[n],getChildrenFunction:e=>"layers"in e?e.layers:"sublayers"in e?e.sublayers:null});await this.loadLayerFonts(t)}const i=o.map.portalItem;i&&await this.loadItemFonts(i)}async loadLayerFonts(e){var t,o;const n=[],i=null!==(t=e.filter((e=>"vector-tile"!==e.type)))&&void 0!==t?t:[],s=null!==(o=e.filter((e=>"vector-tile"===e.type)))&&void 0!==o?o:[];i.forEach((async e=>{if(e.labelingInfo){[...e.labelingInfo].forEach((e=>{var t;(null===(t=e.symbol)||void 0===t?void 0:t.font)&&n.push(e.symbol.font)}))}})),this.loadNonVectorTileLayerFonts(n),await this.loadVectorTileLayerFonts(s)}async loadItemFonts(e){var t,o,n,i,s;const{modules:r}=this,l=`${(0,a.g)(e.portal)}content/items/${e.id}/data`,d=await r.request(l,{query:{f:"json"},method:"get",responseType:"json",token:(0,c.g)(e.portal)});if(null==d?void 0:d.data){const e=d.data,l=[...null!==(t=e.operationalLayers)&&void 0!==t?t:[],...null!==(n=null===(o=e.baseMap)||void 0===o?void 0:o.baseMapLayers)&&void 0!==n?n:[]];if(l.length){const e=null!==(i=l.filter((e=>"VectorTileLayer"!==e.layerType)))&&void 0!==i?i:[],t=null!==(s=l.filter((e=>"VectorTileLayer"===e.layerType)))&&void 0!==s?s:[],o=[];e.forEach((e=>{var t,n;const i=null===(n=null===(t=e.layerDefinition)||void 0===t?void 0:t.drawingInfo)||void 0===n?void 0:n.labelingInfo;if(i){[...i].forEach((e=>{var t,n;(null===(t=e.symbol)||void 0===t?void 0:t.font)&&o.push(r.symbolFontUtils.fromJSON(null===(n=e.symbol)||void 0===n?void 0:n.font))}))}})),this.loadNonVectorTileLayerFonts(o),await this.loadVectorTileLayerFonts(t)}}}loadNonVectorTileLayerFonts(e){const{fontMap:t}=this;e.map((async e=>{const o=(0,i.f)(e);t.get(o)&&this.mapSpecificFontMap.set(o,t.get(o))}))}async loadVectorTileLayerFonts(e){const{modules:t}=this,o=e.map((async e=>await t.request(e.styleUrl,{query:{f:"json"},method:"get",responseType:"json"})));(await Promise.all(o)).forEach((e=>{const t=null==e?void 0:e.data;if(null==t?void 0:t.layers){const e=[];t.layers.forEach((t=>{var o,n;const i=null===(n=null===(o=t.layout)||void 0===o?void 0:o["text-font"])||void 0===n?void 0:n[0];i&&!e.includes(i)&&e.push(i)})),e.forEach((e=>{const t=this.fontMap.get(e);t&&this.mapSpecificFontMap.set(e,t)}))}}))}getSortedFontList(e){const{fontMap:t,mapSpecificFontMap:o,lastSortBy:n}=this,i="static-fonts"===e?t:o;return n===u.ascending?[...i].sort():[...i].sort().reverse()}async getSelectedFont(){var e;const{fontMap:t,font:o}=this;return(null===(e=t.get(this.listNode.selectedItems[0].value))||void 0===e?void 0:e.font)||o}get hostElement(){return(0,n.d)(this)}};h.style=".popover{z-index:100}.panel{min-height:300px}.content{max-height:60vh}.font-mode-wrapper{width:100%}.font-preview{min-width:40px}"},44090:(e,t,o)=>{o.d(t,{c:()=>i,o:()=>s});const n=(0,o(10699).c)({portal:null,user:null,api:4,scale:"m"}),i=n.state,s=n.onChange},10699:(e,t,o)=>{o.d(t,{c:()=>a});var n=o(20536);const i=e=>!("isConnected"in e)||e.isConnected,s=((e,t)=>{let o;return(...n)=>{o&&clearTimeout(o),o=setTimeout((()=>{o=0,e(...n)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(i))}),2e3),r=e=>"function"==typeof e?e():e,l=(e,t)=>{const o=e.indexOf(t);o>=0&&(e[o]=e[e.length-1],e.length--)},a=(e,t)=>{const o=((e,t=(e,t)=>e!==t)=>{const o=r(e);let n=new Map(Object.entries(null!=o?o:{}));const i={dispose:[],get:[],set:[],reset:[]},s=()=>{var t;n=new Map(Object.entries(null!==(t=r(e))&&void 0!==t?t:{})),i.reset.forEach((e=>e()))},a=e=>(i.get.forEach((t=>t(e))),n.get(e)),c=(e,o)=>{const s=n.get(e);t(o,s,e)&&(n.set(e,o),i.set.forEach((t=>t(e,o,s))))},d="undefined"==typeof Proxy?{}:new Proxy(o,{get:(e,t)=>a(t),ownKeys:e=>Array.from(n.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>n.has(t),set:(e,t,o)=>(c(t,o),!0)}),u=(e,t)=>(i[e].push(t),()=>{l(i[e],t)});return{state:d,get:a,set:c,on:u,onChange:(t,o)=>{const n=u("set",((e,n)=>{e===t&&o(n)})),i=u("reset",(()=>o(r(e)[t])));return()=>{n(),i()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(u("set",t.set)),t.get&&e.push(u("get",t.get)),t.reset&&e.push(u("reset",t.reset)),t.dispose&&e.push(u("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{i.dispose.forEach((e=>e())),s()},reset:s,forceUpdate:e=>{const t=n.get(e);i.set.forEach((o=>o(e,t,t)))}}})(e,t);return o.use((()=>{if("function"!=typeof n.a)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const o=(0,n.a)();o&&((e,t,o)=>{const n=e.get(t);n?n.includes(o)||n.push(o):e.set(t,[o])})(e,t,o)},set:t=>{const o=e.get(t);o&&e.set(t,o.filter(n.f)),s(e)},reset:()=>{e.forEach((e=>e.forEach(n.f))),s(e)}}})()),o}},38973:(e,t,o)=>{o.d(t,{a:()=>f,b:()=>h,c:()=>S,d:()=>m,e:()=>F,f:()=>s,g:()=>w,h:()=>r,i:()=>y,j:()=>p,k:()=>v,p:()=>u,r:()=>a,s:()=>i,t:()=>g,v:()=>c});var n=o(44090);const i=/\+|\?|\/|\(|\)|\\|\!|\#|\"|\||\*|\:|<|>|\%|\$|\@|\'|\^|\[|\]|\,|\=|\;/gi,s=/(\.|outputFormat=)json|geojson$/i,r=/\/ags\//gi,l="MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer|SceneServer|VectorTileServer|StreamServer|WorkspaceServer|GeoenrichmentServer|VideoServer|KnowledgeGraphServer",a=new RegExp(`http.+/(${l})`),c="/arcgis/rest/services|/rest/services|/arcgis/services|/arcgis/rest",d=new RegExp(`(?<server>http.+(?:${c})(?:/?.*/(?<name>.*)/(?<type>${l})))(?!.*/${l})/?(?<soe>\\d+)?.*`,"i"),u=e=>{const t=e.match(d);if(!t){return e.match(r)?{baseServerUrl:e,serverName:null,serverType:"MapServer",index:null}:null}const[,o,n,i,s]=t,l=parseInt(s);return{baseServerUrl:o,serverName:n,serverType:i,index:isNaN(l)?null:l}},h=e=>{if(!e)return null;if(!e.match(c))return null;const t=e.split("/rest");return t.length<2?null:`${t[0]}/rest/`};function p(e){return new URLSearchParams(e).toString()}function v(e,t){return(null==e?void 0:e.includes("?"))?new URLSearchParams(e.substring(e.indexOf("?"))).get(t):""}const f=e=>e&&"/"!==e.charAt(e.length-1)?`${e}/`:e,g=({path:e,url:t})=>{const o=t.split("/"),n=e.split("/");return o.slice(0,o.length-n.length).join("/")};function m(e){const{customBaseUrl:t,portalHostname:o,urlKey:n}=e,{protocol:i}=window.location;return`${i}//${n?`${n}.${t}`:o}`}function y(e){var t,o;return null!==(t=null==e?void 0:e.isWebTierAuth)&&void 0!==t?t:null===(o=e.sourceJSON)||void 0===o?void 0:o.isWebTierAuth}function w(e){var t;const{portal:o,config:i}=n.c||{};return null!==(t=f(null==i?void 0:i.restBaseUrl))&&void 0!==t?t:S(e||o)}function S(e){var t;return f(null!==(t=e.restUrl)&&void 0!==t?t:e.portalUrl)}function F(e){var t,o,n;return(null===(o=null===(t=null==e?void 0:e.user)||void 0===t?void 0:t.sourceJSON)||void 0===o?void 0:o.culture)||(null===(n=null==e?void 0:e.sourceJSON)||void 0===n?void 0:n.culture)||navigator.language||"en-US"}},369:(e,t,o)=>{o.d(t,{g:()=>i});var n=o(44090);function i(e){var t,o,i,s;return null!=e||(e=null===n.c||void 0===n.c?void 0:n.c.portal),(null===(t=null==e?void 0:e.credential)||void 0===t?void 0:t.token)||(null==e?void 0:e.token)||(null===(i=null===(o=null==e?void 0:e.user)||void 0===o?void 0:o.credential)||void 0===i?void 0:i.token)||(null===(s=null==e?void 0:e.portalUser)||void 0===s?void 0:s.token)||""}}}]);