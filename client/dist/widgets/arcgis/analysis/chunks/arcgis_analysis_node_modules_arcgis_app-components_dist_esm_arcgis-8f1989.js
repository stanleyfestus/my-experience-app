/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8f1989.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8f1989"],{62244:(e,t,i)=>{i.r(t),i.d(t,{arcgis_table:()=>u,arcgis_table_column_info:()=>f,arcgis_table_field_selection:()=>C});var l=i(20536),a=i(60883),s=i(37568),n=i(98034),o=i(98072),r=i(74129),d=i(34752),c=i(91616);i(91102),i(73807),i(99004);function h(e){if(!(null==e?void 0:e.capabilities))return!1;const{capabilities:{data:{supportsAttachment:t},operations:{supportsQueryAttachments:i}}}=e;return t&&i}const u=class{constructor(e){(0,l.r)(this,e),this.arcgisTableUpdated=(0,l.c)(this,"arcgisTableUpdated",7),this.arcgisTableScaleChange=(0,l.c)(this,"arcgisTableScaleChange",7),this.arcgisTableDismissedChange=(0,l.c)(this,"arcgisTableDismissedChange",7),this.arcgisTableEditRecordClick=(0,l.c)(this,"arcgisTableEditRecordClick",7),this.arcgisTableCreateRecordClick=(0,l.c)(this,"arcgisTableCreateRecordClick",7),this.arcgisTableInCellEdit=(0,l.c)(this,"arcgisTableInCellEdit",7),this.selectedOnlyMode=!1,this.recordsCount=0,this.selectedCount=0,this.keepTableSelection=!1,this.isWithinTabsManager=!1,this.panelKeyDownHandler=e=>{this.dismissible&&"Escape"===e.key&&!e.defaultPrevented&&(this.handleCloseClick(),e.preventDefault())},this.afterCreatePanel=async e=>{const{layer:t}=this.props;this.panelNode=e,this.watchTitleHandler=t.watch("title",(()=>{this.reRender=!this.reRender}))},this.afterCreateCloseButton=e=>{this.closeButtonNode=e},this.afterCreateTableNode=e=>{var t,i,l,s;const{props:n,reactiveUtils:o,supportsSelection:r}=this;let{selectedFeatureIds:d}=this;const{layer:u,view:m}=n,{table:p}=this;if(p)return;const{allowAddEditRecord:b}=this,f=["feature","oriented-imagery"].includes(u.type)&&u.effectiveEditingEnabled;this.table=this.activeTable=new this.FeatureTable({objectIds:d,highlightIds:d,layer:u,view:m,relatedRecordsEnabled:!0,editingEnabled:f,attachmentsEnabled:a.s.includes(u.type)&&h(u),highlightOnRowSelectEnabled:r,multiSortEnabled:!1,visibleElements:{header:!1,menu:!1,columnDescriptions:!1},actionColumnConfig:b&&f?this.getActionColumnConfig(u,"parent-table"):void 0,container:e}),f&&this.table.layer.on("edits",(0,c.d)((()=>{this.table.layer&&this.arcgisTableInCellEdit.emit({layer:this.table.layer})}),300)),r||(this.activeTable.grid.visibleElements={selectionColumn:!1}),this.watchHndlSize=o.watch((()=>this.table.viewModel.size),(e=>{this.recordsCount=e,this.displayCount()})),null===(t=this.menuHandle)||void 0===t||t.remove(),this.menuHandle=this.getMenuHandle(),null===(i=this.attachmentsViewOptionsHandle)||void 0===i||i.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),null===(l=this.columnSortOrderHandle)||void 0===l||l.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),null===(s=this.columnReorderHandle)||void 0===s||s.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),r&&(this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),this.selectedCount=new Set(t).size,this.displayCount(),this.lockRasters(),this.reRender=!this.reRender})),this.watchHndlActive=o.watch((()=>{var e,t;return null===(t=null===(e=m.popup)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.active}),(()=>{var e,t,i,l;const a=m.popup.selectedFeature;if(a&&m.popup.visible&&((null===(e=a.layer)||void 0===e?void 0:e.id)===u.id||"sublayer"===u.type&&(null===(i=null===(t=a.sourceLayer)||void 0===t?void 0:t.layer)||void 0===i?void 0:i.id)===(null===(l=u.layer)||void 0===l?void 0:l.id))){this.activeTable.highlightIds.removeAll(),d=[];const e=m.popup.selectedFeature.getObjectId();this.activeTable.highlightIds.push(e),d.push(e),this.selectedOnlyMode&&!this.activeTable.objectIds.includes(e)&&(this.activeTable.objectIds.push(e),this.reRender=!this.reRender)}else!a||m.popup.visible||this.keepTableSelection||(this.activeTable.highlightIds.removeAll(),this.selectedOnlyMode&&this.handleShowAllClick());this.keepTableSelection=!1})))},this.handleEditingClick=()=>{const{strings:e}=this;this.editingPopoverNode||(document.removeEventListener("click",this.editingPopoverClickHandler),this.editingPopoverNode=document.createElement("arcgis-table-editing-popover"),this.editingPopoverNode.referenceElement=this.editingActionNode,this.editingPopoverNode.strings=e,this.editingPopoverNode.addEventListener("arcgisTableEditingPopoverClose",(e=>{e.stopPropagation(),this.removeEditingPopover(),setTimeout((()=>this.editingActionNode.setFocus()),200)})),document.body.appendChild(this.editingPopoverNode),setTimeout((()=>{this.editingPopoverNode.setFocus(),document.addEventListener("click",this.editingPopoverClickHandler)}),100))},this.handleVisibilityClick=e=>{var t;if(this.fieldSelectionPopover)return;document.removeEventListener("click",this.visibilityClickHandler);const i=this.activeTable.layer,{props:l,strings:s,currentLanguageIntl:n,fieldSortOrder:o,activeTable:r}=this,d=document.createElement("arcgis-table-field-selection");d.props={layer:i,view:l.view},d.strings=s,d.currentLanguage=n,d.columnTemplates=r.tableTemplate.columnTemplates;const c=null!==(t=this.activeTable.columns.filter((e=>"field"in e)))&&void 0!==t?t:[],u=Array.from(c.map((e=>e.fieldName)));d.fieldColumnOrder=u,d.sortBy=o,d.attachmentsEnabled=!(!a.s.includes(i.type)||!h(i))&&r.attachmentsEnabled,d.relationshipsEnabled=r.relatedRecordsEnabled,d.popoverReferenceElement=e.target,d.addEventListener("columnTemplatesVisibilityChange",(e=>{e.stopPropagation();e.detail.forEach((e=>this.activeTable.toggleColumnVisibility(e))),this.updateTable(this.activeTable.tableTemplate)})),d.addEventListener("attachmentsChange",(e=>{e.stopPropagation();this.activeTable.columns.find((e=>"onShowAttachments"in e)).hidden=!e.detail;this.activeTable.tableTemplate.columnTemplates.find((e=>"attachment"===e.type)).visible=e.detail,this.updateTable(this.activeTable.tableTemplate)})),d.addEventListener("relationshipsChange",(e=>{e.stopPropagation();this.activeTable.columns.filter((e=>"relationshipId"in e)).forEach((t=>t.hidden=!e.detail));this.activeTable.tableTemplate.columnTemplates.filter((e=>"relationship"===e.type)).forEach((t=>t.visible=e.detail)),this.updateTable(this.activeTable.tableTemplate)})),d.addEventListener("fieldSortByChange",(e=>{e.stopPropagation(),this.fieldSortOrder=e.detail})),d.addEventListener("arcgisTableFieldSelectionClose",(()=>{this.closePopovers(),setTimeout((()=>this.settingsActionNode.setFocus()),200)})),document.body.appendChild(d),this.fieldSelectionPopover=d,setTimeout((()=>document.addEventListener("click",this.visibilityClickHandler)),200)},this.visibilityClickHandler=e=>{this.fieldSelectionPopover?(0,a.i)(e.target,"arcgis-table-field-selection")||(document.body.removeChild(this.fieldSelectionPopover),this.fieldSelectionPopover=null,document.removeEventListener("click",this.visibilityClickHandler)):document.removeEventListener("click",this.visibilityClickHandler)},this.columnInfoClickHandler=e=>{this.columnInfoPopover?(0,a.i)(e.target,"arcgis-table-column-info")||(document.body.removeChild(this.columnInfoPopover),this.columnInfoPopover=null,document.removeEventListener("click",this.columnInfoClickHandler)):document.removeEventListener("click",this.columnInfoClickHandler)},this.editingPopoverClickHandler=e=>{this.editingPopoverNode?(0,a.i)(e.target,"arcgis-table-editing-popover")||(document.body.removeChild(this.editingPopoverNode),this.editingPopoverNode=null,document.removeEventListener("click",this.editingPopoverClickHandler)):document.removeEventListener("click",this.editingPopoverClickHandler)},this.handleHomeClick=()=>{const{view:e,initialViewpoint:t}=this;e.goTo(t)},this.handleZoomToClick=()=>{var e,t;const{view:i,selectedFeatureIds:l,Query:a}=this,s=null!==(t=null===(e=this.activeTable)||void 0===e?void 0:e.layer)&&void 0!==t?t:this.layer;if("imagery"===function(e){return"esri.layers.support.Sublayer"===e.declaredClass?"sublayer":(0,o.d)(e)}(s)){const e=new a;e.outSpatialReference=i.spatialReference,e.objectIds=[...l],e.returnGeometry=!0,s.queryRasters(e).then((e=>{i.goTo(e.features)}))}else{const e=s,t=e.createQuery();t.outSpatialReference=i.spatialReference,t.objectIds=[...l],t.returnGeometry=!0,e.queryFeatures(t).then((e=>{i.goTo(e.features)}))}},this.handleClearClick=()=>{const{activeTable:e,supportsSelection:t}=this,{grid:i}=e;e.highlightIds.removeAll(),this.clearFilter(),t&&(i.visibleElements={selectionColumn:!0})},this.handleShowSelectedClick=()=>{this.selectedOnlyMode=!0,this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(this.activeTable.highlightIds),this.reRender=!this.reRender},this.handleShowAllClick=()=>{this.selectedOnlyMode=!1,this.activeTable.objectIds.removeAll(),this.reRender=!this.reRender},this.handleSelectVisibleClick=async()=>{const{layer:e,view:t,table:i}=this;i.highlightIds.removeAll();const l=t.get("extent"),a=await async function(e,t,i){const[l,a,s]=await(0,n.l)(["esri/geometry/Polygon","esri/geometry/Point","esri/rest/support/ImageIdentifyParameters"]),o=new l(e.spatialReference);o.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]);const r=new a((e.xmax-e.xmin)/t.width,(e.ymax-e.ymin)/t.height,e.spatialReference),d=new s;d.geometry=o,d.returnGeometry=!0,d.pixelSize=r;const c=i.mosaicRule.clone();return i.definitionExpression&&(c.where=i.definitionExpression),d.mosaicRule=c,d}(l,t,e);this.selectFeaturesFromIdentify(a)},this.handleDisplaySelectedClick=()=>{this.lockRaster=!0,this.lockRasters()},this.handleDisplayAllClick=()=>{var e;const{MosaicRule:t}=this;this.lockRaster=!1;const i=this.layer,{sourceJSON:l}=i,a=l.allowedMosaicMethods.split(",").map((e=>e.trim().toLowerCase()));a.unshift(l.defaultMosaicMethod.toLowerCase());const s=null!==(e=a.find((e=>"lockraster"!==e&&"viewpoint"!==e&&("byattribute"!==e||!!l.sortField))))&&void 0!==e?e:"none";i.mosaicRule=t.fromJSON(Object.assign(Object.assign({},l),{defaultMosaicMethod:s})),i.visible=!0},this.handleRefreshClick=()=>{const{table:e}=this;e.refresh(),this.reRender=!this.reRender},this.handleExpandClick=()=>{const{scale:e}=this,t=e===a.a.SMALL?a.a.MEDIUM:a.a.SMALL;this.arcgisTableScaleChange.emit(t),this.scale=t,this.closePopovers()},this.handleCloseClick=()=>{this.arcgisTableDismissedChange.emit()},this.focusOutHandler=()=>(0,a.r)(),this.view=void 0,this.layer=void 0,this.initialViewpoint=void 0,this.scale=a.a.MEDIUM,this.dismissible=!1,this.allowFieldCalculate=!1,this.config=void 0,this.allowAddEditRecord=!1,this.initiallySelectedObjectIds=void 0,this.tableTemplate=void 0,this.reRender=!1,this.lockRaster=!1,this.isBarExpanded=!1,this.selectedFeatureIds=[]}async setFocus(){this.focus()}async refresh(e){var t,i,l;const a=(null===(t=null==e?void 0:e.addedObjectIds)||void 0===t?void 0:t.length)?e.addedObjectIds:null==e?void 0:e.updatedObjectIds;a?(this.selectedFeatureIds=a,this.selectedCount=a.length,this.updateHighlightsAndSelection()):(null===(i=null==e?void 0:e.selectedObjectIds)||void 0===i?void 0:i.length)&&(this.selectedFeatureIds=e.selectedObjectIds,this.selectedCount=1,this.selectedOnlyMode=!0,this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(e.selectedObjectIds),this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(e.selectedObjectIds)),await(null===(l=this.table)||void 0===l?void 0:l.refresh())}async conditionalRefresh(e){const{table:t}=this;if(t.viewModel.relationshipColumns.some((t=>t.layer.id===e.id)))await t.refresh();else for(const i of t.relatedTables){if(i.layer.id===e.id){await t.refresh();break}if(i.viewModel.relationshipColumns.some((t=>t.layer.id===e.id))){await t.refresh();break}}}async containsLayer(e){const{table:t}=this;if(t.layer.id===e.id)return!0;for(const i of t.relatedTables)if(i.layer.id===e.id)return!0;return!1}async highlightRootFeature(e,t){this.selectedFeatureIds=e?[t]:[],this.updateHighlightsAndSelection()}async enableEdits(e){e?(this.activeTable.editingEnabled=["feature","oriented-imagery"].includes(this.activeTable.layer.type)&&this.activeTable.layer.effectiveEditingEnabled,this.fabNode&&(this.fabNode.disabled=!1)):(this.activeTable.editingEnabled=!1,this.fabNode&&(this.fabNode.disabled=!0))}async getSelectedObjectIds(){return Promise.resolve(this.activeTable.highlightIds)}async disableTableEditorHooks(e){if(!this.activeTable.layer)return;this.allowAddEditRecord=!e;const t=["feature","oriented-imagery"].includes(this.activeTable.layer.type)&&this.activeTable.layer.effectiveEditingEnabled;e?(this.activeTable.actionColumnConfig=void 0,this.fabNode&&(this.fabNode.hidden=!0)):(this.activeTable.actionColumnConfig=this.allowAddEditRecord&&t?this.getActionColumnConfig(this.activeTable.layer,this.activeTable.relatedTable?"related-table":"parent-table"):void 0,this.fabNode&&(this.fabNode.hidden=!1))}async componentWillLoad(){const[e,t,i]=await(0,s.g)(this.hostElement);this.strings=e,this.currentLanguage=t,this.currentLanguageIntl=i,await this.loadAllModules();const{view:l,layer:n}=this;(0,o.d)(n)===r.s.imagery?(this.imagerySelection=!0,this.props={view:l,layer:n}):this.props={view:l,layer:n},this.supportsSelection=!0,this.initiallySelectedObjectIds&&(this.selectedFeatureIds=this.initiallySelectedObjectIds,this.selectedCount=this.initiallySelectedObjectIds.length,this.selectedOnlyMode=!0),this.isWithinTabsManager=(0,a.i)(this.hostElement,"arcgis-tabs-manager")}async componentDidLoad(){requestAnimationFrame((()=>this.focus()));const e=await this.getFieldTemplates();this.activeTable.tableTemplate=e;const{allowAddEditRecord:t,reactiveUtils:i}=this,{table:s}=this;this.relatedTablesHandle=s.relatedTables.on("change",(async({added:e})=>{var n,o,r,d,u;e.length&&e.forEach((e=>{const i=e.layer,l=["feature","oriented-imagery"].includes(i.type)&&i.effectiveEditingEnabled;e.visibleElements={header:!1,menu:!1,columnDescriptions:!1},e.actionColumnConfig=t&&l?this.getActionColumnConfig(i,"related-table"):void 0,e.attachmentsEnabled=a.s.includes(i.type)&&h(i)})),this.activeTable=null!==(n=s.relatedTable)&&void 0!==n?n:s;["feature","oriented-imagery"].includes(this.activeTable.layer.type)&&this.activeTable.layer.effectiveEditingEnabled&&this.activeTable.layer.on("edits",(0,c.d)((()=>{this.activeTable.layer&&this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer})}),300)),s.relatedTable&&(this.showSelectedNode.disabled=!0);const m=await this.getFieldTemplates();this.activeTable.tableTemplate=m,setTimeout((()=>this.updateTable(this.activeTable.tableTemplate)),300),this.selectedFeatureIds=[],this.activeTable.highlightIds.items.forEach((e=>this.selectedFeatureIds.push(e))),this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),this.selectedCount=new Set(t).size,this.lockRasters(),this.reRender=!this.reRender})),this.createFeatureHandle=i.watch((()=>this.activeTable.viewModel.store.canAddRelatedFeature),(()=>(0,l.f)(this.hostElement))),(0,l.f)(this.hostElement),null===(o=this.menuHandle)||void 0===o||o.remove(),this.menuHandle=this.getMenuHandle(),null===(r=this.attachmentsViewOptionsHandle)||void 0===r||r.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),null===(d=this.columnSortOrderHandle)||void 0===d||d.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),null===(u=this.columnReorderHandle)||void 0===u||u.remove(),this.columnReorderHandle=this.getColumnReorderHandle()})),this.showAllTablesHandle=i.watch((()=>this.table.allRelatedTablesVisible),(e=>this.settingsActionNode.disabled=e))}disconnectedCallback(){var e,t,i,l,a,s,n,o,r,d,c;this.closePopovers();const{table:h}=this;null==h||h.destroy(),null===(e=this.watchTitleHandler)||void 0===e||e.remove(),null===(t=this.watchHndlSize)||void 0===t||t.remove(),null===(i=this.watchHndlActive)||void 0===i||i.remove(),null===(l=this.popupTemplateWatchHandle)||void 0===l||l.remove(),null===(a=this.createFeatureHandle)||void 0===a||a.remove(),null===(s=this.menuHandle)||void 0===s||s.remove(),null===(n=this.attachmentsViewOptionsHandle)||void 0===n||n.remove(),null===(o=this.columnSortOrderHandle)||void 0===o||o.remove(),null===(r=this.columnReorderHandle)||void 0===r||r.remove(),null===(d=this.showAllTablesHandle)||void 0===d||d.remove(),null===(c=this.relatedTablesHandle)||void 0===c||c.remove()}render(){const{props:e,isWithinTabsManager:t}=this,{layer:i}=e;if(!i)return null;const s="rtl"===(0,d.g)(this.hostElement);return(0,l.h)(l.H,{class:a.C.host},(0,l.h)("div",{class:{[a.C.content]:!0,[d.C.rtl]:s}},this.renderActionBar(),(0,l.h)("calcite-panel",{heading:t?void 0:i.title,ref:this.afterCreatePanel,onKeyDown:this.panelKeyDownHandler},this.renderHeaderActions(),this.renderTable(),this.renderCreateRecordFab())))}renderActionBar(){var e,t;const{supportsSelection:i,selectedFeatureIds:s,imagerySelection:n,strings:o,isWithinTabsManager:r}=this,d=this.isKnowledgeGraphSubTable();return(0,l.h)("div",{class:""+(r?"":"non-tabs-manager-action-bar-wrapper")},(0,l.h)("calcite-action-bar",{class:a.C.actionBar,onCalciteActionBarToggle:e=>this.isBarExpanded=e.target.expanded},(0,l.h)("calcite-action-group",null,i&&!(null!==(t=null===(e=this.activeTable)||void 0===e?void 0:e.layer)&&void 0!==t?t:this.layer).isTable&&!d&&(0,l.h)("calcite-action",{icon:"zoom-to-object",text:o.zoomToSelection,disabled:!(null==s?void 0:s.length),onClick:this.handleZoomToClick,ref:e=>{this.zoomNode=e,this.afterCreateAction(this.zoomNode,o.zoomToSelection)}}),(0,l.h)("calcite-action",{icon:"home",text:o.home,disabled:!this.initialViewpoint,onClick:this.handleHomeClick,ref:e=>{this.homeNode=e,this.afterCreateAction(this.homeNode,o.home)}}),(0,l.h)("calcite-tooltip",{slot:"menu-tooltip"},(0,l.h)("div",{class:a.C.tooltip},o.more))),!n&&this.renderTableActions(),n&&i&&this.renderImageryTableActions(),(0,l.h)("calcite-tooltip",{slot:"expand-tooltip"},(0,l.h)("div",{class:a.C.tooltip},o.expand))))}renderTableActions(){var e,t,i,s;const{selectedFeatureIds:n,supportsSelection:o,selectedOnlyMode:r,strings:d}=this,c=r||(null===(i=null===(t=null===(e=this.activeTable)||void 0===e?void 0:e.objectIds)||void 0===t?void 0:t.items)||void 0===i?void 0:i.length);return(0,l.h)("calcite-action-group",null,o&&(0,l.h)(l.F,null,(0,l.h)("calcite-action",{icon:"erase",text:d.clearSelection,disabled:!(null==n?void 0:n.length),onClick:this.handleClearClick,ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,d.clearSelection)}})),o&&(0,l.h)(l.F,null,(0,l.h)("calcite-action",{icon:"selected-items-filter",text:d.showSelected,disabled:(null===(s=this.table)||void 0===s?void 0:s.relatedTable)||!(null==n?void 0:n.length),onClick:this.handleShowSelectedClick,ref:e=>{this.showSelectedNode=e,this.afterCreateAction(this.showSelectedNode,d.showSelected)}})),o&&(0,l.h)(l.F,null,(0,l.h)("calcite-action",{icon:"list",text:d.showAll,disabled:!c,onClick:this.handleShowAllClick,ref:e=>{this.showAllNode=e,this.afterCreateAction(this.showAllNode,d.showAll)}})),(0,l.h)("calcite-action",{icon:"refresh",text:d.refresh,onClick:this.handleRefreshClick,ref:e=>{this.refreshNode=e,this.afterCreateAction(this.refreshNode,d.refresh)}}),(0,l.h)("calcite-tooltip",{slot:"menu-tooltip"},(0,l.h)("div",{class:a.C.tooltip},d.more)))}renderImageryTableActions(){const{selectedFeatureIds:e,lockRaster:t,strings:i}=this;return(0,l.h)("calcite-action-group",null,(0,l.h)("calcite-action",{icon:"erase",text:i.clearSelection,disabled:!(null==e?void 0:e.length),onClick:this.handleClearClick,ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,i.clearSelection)}}),(0,l.h)("calcite-action",{icon:"select-visible",text:i.selectVisible,onClick:this.handleSelectVisibleClick,ref:e=>{this.selectVisibleImageryNode=e,this.afterCreateAction(this.selectVisibleImageryNode,i.selectVisible)}}),(0,l.h)("calcite-action",{icon:t?"unlock":"lock",text:t?i.displayAll:i.displaySelected,onClick:t?this.handleDisplayAllClick:this.handleDisplaySelectedClick,ref:e=>{this.displayImageNode=e,this.afterCreateAction(this.displayImageNode,t?i.displayAll:i.displaySelected)}}),(0,l.h)("calcite-tooltip",{slot:"menu-tooltip"},(0,l.h)("div",{class:a.C.tooltip},i.more)))}renderHeaderActions(){const{layer:e,strings:t}=this,i="type"in e&&["feature","oriented-imagery"].includes(e.type)&&e.effectiveEditingEnabled&&!e.editingEnabled;return(0,l.h)("div",{slot:"header-actions-end",class:a.C.menuActions},i&&(0,l.h)("calcite-action",{text:t.layerEditing,scale:"s",onClick:this.handleEditingClick,ref:e=>this.editingActionNode=e},(0,l.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-circle"})),(0,l.h)("calcite-action",{text:t.fieldVisibility,scale:"s",onClick:this.handleVisibilityClick,ref:e=>this.settingsActionNode=e},(0,l.h)("calcite-icon",{scale:"s",icon:"gear"})),this.renderExpandCollapseButton(),this.renderCloseButton())}renderExpandCollapseButton(){const{strings:e,scale:t,isWithinTabsManager:i}=this;return i?null:t===a.a.SMALL?(0,l.h)("calcite-action",{key:"expand-table",text:e.expand,scale:"s",onClick:this.handleExpandClick},(0,l.h)("calcite-icon",{icon:"chevrons-up"})):(0,l.h)("calcite-action",{key:"expand",text:e.shrink,scale:"s",onClick:this.handleExpandClick},(0,l.h)("calcite-icon",{icon:"chevrons-down"}))}renderCloseButton(){const{strings:e,isWithinTabsManager:t,dismissible:i}=this;return t||!i?null:(0,l.h)("calcite-action",{text:e.close,icon:"x",onClick:this.handleCloseClick,ref:this.afterCreateCloseButton})}renderTable(){return(0,l.h)("div",{class:a.C.table},(0,l.h)("div",{ref:this.afterCreateTableNode}))}renderCreateRecordFab(){var e,t,i;const{strings:a,allowAddEditRecord:s}=this,n=(null===(e=this.table)||void 0===e?void 0:e.relatedTable)?null===(t=this.table)||void 0===t?void 0:t.relatedTable.layer:this.layer;if(!s)return null;if(!(["feature","oriented-imagery"].includes(n.type)&&n.effectiveEditingEnabled))return null;if((null===(i=this.table)||void 0===i?void 0:i.relatedTable)&&!this.table.relatedTable.viewModel.store.canAddRelatedFeature)return null;const o=this.templateUtils.getAllTemplatesForLayer(n);return n.isTable||o.length?(0,l.h)("calcite-fab",{scale:"s",class:"table-fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:n.isTable?a.createRecord:a.createFeature,onClick:()=>{this.fabNode&&(this.fabNode.disabled=!0),this.activeTable.highlightIds.removeAll(),this.handleCreateRecordClick()},ref:e=>this.fabNode=e}):null}removeEditingPopover(){if(this.editingPopoverNode)try{document.body.removeChild(this.editingPopoverNode),this.editingPopoverNode=null}catch(e){}}handleHideClick(e){this.activeTable.hideColumn(e),this.activeTable.tableTemplate.columnTemplates.forEach((t=>{t.fieldName===e&&(t.visible=!1)})),this.updateTable(this.activeTable.tableTemplate)}handleCalculateField(e){const t=document.createElement("arcgis-field-calculate");t.fieldName=e,t.layer=this.activeTable.layer,t.config=this.config,t.addEventListener("arcgisFieldCalculateClose",(()=>{document.body.removeChild(t),this.activeTable.refresh(),this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer})})),document.body.appendChild(t)}handleColumnInfo(e){const{currentLanguageIntl:t}=this;this.columnInfoPopover&&this.columnInfoPopover.parentNode.removeChild(this.columnInfoPopover),document.removeEventListener("click",this.columnInfoClickHandler);const{props:i,strings:l}=this,a=this.activeTable.layer,s=document.createElement("arcgis-table-column-info");s.props={view:i.view,layer:a},s.strings=l,s.currentLanguage=t,s.fieldName=e,s.popoverReferenceElement=this.settingsActionNode,s.addEventListener("arcgisTableColumnInfoClose",(()=>{this.closePopovers(),setTimeout((()=>this.focus()),100)})),s.addEventListener("arcgisTableColumnInfoSetupComplete",(()=>this.syncMenuHandles())),document.body.appendChild(s),this.columnInfoPopover=s,setTimeout((()=>document.addEventListener("click",this.columnInfoClickHandler)),200)}closePopovers(){document.removeEventListener("click",this.visibilityClickHandler),document.removeEventListener("click",this.columnInfoClickHandler),document.removeEventListener("click",this.editingPopoverClickHandler),this.fieldSelectionPopover&&(document.body.removeChild(this.fieldSelectionPopover),this.fieldSelectionPopover=null),this.columnInfoPopover&&(document.body.removeChild(this.columnInfoPopover),this.columnInfoPopover=null),this.removeEditingPopover()}async selectFeaturesFromIdentify(e){var t;const{layer:i,imageService:l}=this;let a=[];if("imagery"===i.type&&i.visible){const s=await l.identify(i.url,e);if((null===(t=null==s?void 0:s.catalogItems)||void 0===t?void 0:t.features)&&s.catalogItemVisibilities)for(let e=0;e<s.catalogItems.features.length;e++)s.catalogItemVisibilities[e]>0&&a.push(s.catalogItems.features[e]);const n=a.map((e=>new this.Graphic({attributes:e.attributes,geometry:e.geometry,sourceLayer:this.activeTable.layer,layer:this.activeTable.layer})));n.length?n.forEach((e=>this.activeTable.highlightIds.add(e.getObjectId()))):this.activeTable.highlightIds.removeAll()}}async lockRasters(){const{selectedFeatureIds:e,layer:t,imagerySelection:i,MosaicRule:l}=this;if(this.lockRaster)if(i&&e.length){const i=[...e],a=new l;a.method="lock-raster",a.lockRasterIds=i;const s=t.definitionExpression;s&&(a.where=s),t.mosaicRule=a,t.visible=!0}else t.visible=!1}updateTable(e){this.activeTable.tableTemplate=e,this.isStandardView()&&this.syncAttributeTableTemplate()}async getFieldTemplates(){var e,t,i,l;const{activeTable:s,strings:n}=this,o=null!==(e=null==s?void 0:s.layer)&&void 0!==e?e:this.layer,r=e=>{var t,i,l;let a=[{label:n.information,icon:"information",clickFunction:()=>{this.handleColumnInfo(e.name)}}];const s=!["blob","global-id","guid","oid","raster"].includes(e.type),r=null===(t=o.sourceJSON)||void 0===t?void 0:t.geometryProperties,d=[null==r?void 0:r.shapeLengthFieldName,null==r?void 0:r.shapeAreaFieldName].includes(e.name),c=e.editable&&s&&!d&&e.name!==this.activeTable.layer.objectIdField,h=("feature"===o.type||"oriented-imagery"===o.type)&&o.sourceJSON.supportsCalculate&&(null===(l=null===(i=o.portalItem)||void 0===i?void 0:i.typeKeywords)||void 0===l?void 0:l.indexOf("Hosted Service"))>-1&&"admin"===o.portalItem.itemControl;return this.allowFieldCalculate&&this.config&&h&&c&&a.push({label:n.calculateField,icon:"calculator",clickFunction:()=>{this.handleCalculateField(e.name)}}),a.push({label:n.hideField,icon:"view-hide",clickFunction:()=>{this.handleHideClick(e.name)}}),{items:a}};let d;if(a.b.includes(o.type)){o.attributeTableTemplate&&this.syncAttributeTableTemplateWithLayerFields(),d=o.attributeTableTemplate?await this.attributeTableTemplateUtils.createTableTemplateFromAttributeTableTemplate({layer:o,template:o.attributeTableTemplate,includeHiddenFields:!0}):await this.attributeTableTemplateUtils.createDefaultTableTemplateFromLayer({layer:o}),(null==o?void 0:o.attributeTableTemplate)||(o.attributeTableTemplate=await this.attributeTableTemplateUtils.createDefaultAttributeTableTemplateFromLayer({layer:o}));const e=o.fields.filter((e=>!e.visible)).map((e=>e.name));d.columnTemplates=d.columnTemplates.filter((t=>!("field"===t.type&&e.includes(t.fieldName)))),d.columnTemplates.forEach((e=>{var t,i,l;if("field"===e.type){const a=e.fieldName,s=o.fields.find((e=>e.name===a)),n=null===(i=null===(t=o.popupTemplate)||void 0===t?void 0:t.fieldInfos)||void 0===i?void 0:i.find((e=>e.fieldName===a));e.label=(null==n?void 0:n.label)||s.alias||s.name,e.menuConfig=r(s),e.format=null!==(l=null==n?void 0:n.format)&&void 0!==l?l:this.getDefaultFormat(s)}}))}else{d=new this.TableTemplate({columnTemplates:[]});const e=this.popupUtils.createFieldInfos({fields:o.fields,objectIdField:o.objectIdField}),i=new Map(e.map((e=>[e.fieldName,e]))),l=(null===(t=o.popupTemplate)||void 0===t?void 0:t.fieldInfos)?new Map(o.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))):void 0,a=[];o.fields.forEach((e=>{if("geometry"===e.type||!e.visible)return;const t=i.get(e.name),s=null==l?void 0:l.get(e.name),n={fieldName:e.name,label:(null==s?void 0:s.label)||e.alias||e.name,type:"field",visible:!!t&&t.visible,format:(null==s?void 0:s.format)||this.getDefaultFormat(e),menuConfig:r(e)};a.push(n)})),d.columnTemplates=a}return(null===(i=o.popupTemplate)||void 0===i?void 0:i.fieldInfos)&&(null===(l=this.popupTemplateWatchHandle)||void 0===l||l.remove(),this.popupTemplateWatchHandle=this.reactiveUtils.watch((()=>o.popupTemplate),(async()=>{var e;let t=!1,i=!1;const{popupTemplate:l}=o;if(d.columnTemplates.forEach((e=>{l.fieldInfos.forEach((l=>{if(e.fieldName===l.fieldName&&(JSON.stringify(e.format)!==JSON.stringify(l.format)&&(i=!0,e.format=l.format),e.label!==l.label)){t=!0,e.label=l.label;const i=this.activeTable.columns.find((e=>e.fieldName===l.fieldName));i&&(i.label=l.label)}}))})),a.b.includes(o.type)){const e=await this.getFieldTemplates();this.activeTable.tableTemplate=e}else t?this.updateTable(new this.TableTemplate({columnTemplates:d.columnTemplates})):i&&await(null===(e=this.table)||void 0===e?void 0:e.refresh())}))),d}getDefaultFormat(e){return["integer","small-integer","big-integer"].indexOf(e.type)>-1?new this.FieldInfoFormat({digitSeparator:!1,places:0}):["single","double","long"].indexOf(e.type)>-1?new this.FieldInfoFormat({digitSeparator:!1,places:2}):["date","time-only","timestamp-offset"].indexOf(e.type)>-1?new this.FieldInfoFormat({dateFormat:"short-date-short-time"}):"date-only"===e.type?new this.FieldInfoFormat({dateFormat:"short-date"}):void 0}displayCount(){const{strings:e,panelNode:t,recordsCount:i,selectedCount:l,supportsSelection:a,intl:s}=this;if(!t)return;const n=s.convertNumberFormatToIntlOptions({digitSeparator:!0}),r=s.formatNumber(i,n);if((0,o.i)(l)&&a)if(0===l)t.description=0===i?e.zeroRecordsZeroSel:1===i?e.oneRecordZeroSel:e.numRecordsZeroSel.replace("${count}",`${r}`);else if(1===l)t.description=0===i?e.zeroRecordsOneSel:1===i?e.oneRecordOneSel:e.numRecordsOneSel.replace("${count}",`${r}`);else{const a=s.formatNumber(l,n);t.description=0===i?e.zeroRecordsNumSel.replace("${countSel}",`${a}`):1===i?e.oneRecordNumSel.replace("${countSel}",`${a}`):e.numRecordsNumSel.replace("${count}",`${r}`).replace("${countSel}",`${a}`)}else t.description=0===i?e.zeroRecords:1===i?e.oneRecord:e.numRecords.replace("${count}",`${r}`)}async loadAllModules(){const[e,t,i,l,a,s,o,r,d,c,h,u]=await(0,n.l)(["esri/widgets/FeatureTable","esri/widgets/FeatureTable/support/TableTemplate","esri/applications/MapViewer/templateUtils","esri/support/popupUtils","esri/core/reactiveUtils","esri/widgets/support/templateUtils","esri/popup/support/FieldInfoFormat","esri/rest/support/Query","esri/rest/imageService","esri/layers/support/MosaicRule","esri/Graphic","esri/intl"]);this.FeatureTable=e,this.TableTemplate=t,this.attributeTableTemplateUtils=i,this.popupUtils=l,this.reactiveUtils=a,this.templateUtils=s,this.FieldInfoFormat=o,this.Query=r,this.imageService=d,this.MosaicRule=c,this.Graphic=h,this.intl=u}clearFilter(){this.selectedOnlyMode=!1,this.selectedCount=0,this.selectedFeatureIds=[],this.activeTable.objectIds.removeAll()}handleCreateRecordClick(){var e,t;const{table:i}=this;if(i.relatedTable){const l=i.relatedTable;l.editingEnabled=!1;const a=l.tableParent;if(l.relationshipConfig){const{objectId:i}=l.relationshipConfig,s=a.viewModel.store.getItemByObjectId(i);if(null==s?void 0:s.feature){const{relatedLayer:i,relationshipId:a}=l.relationshipConfig,n=null===(e=i.relationships)||void 0===e?void 0:e.find((e=>e.id===a)),o=s.feature,r=null===(t=l.layer.relationships)||void 0===t?void 0:t.find((e=>e.id===a)),d=o.getAttribute(n.keyField);this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:l,relationshipKeyField:r.keyField,relationshipKeyFieldValue:d})}else l.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:l})}else l.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:l})}else this.table.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:this.table})}updateHighlightsAndSelection(){this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(this.selectedFeatureIds),this.activeTable.objectIds.length&&this.activeTable.objectIds.addMany(this.selectedFeatureIds)}getActionColumnConfig(e,t){const{strings:i}=this;return{icon:"pencil",label:e.isTable?i.editRecord:i.editFeature,callback:({feature:i})=>{this.keepTableSelection=!0,this.activeTable.columns.forEach((e=>e.closeMenu())),this.selectedFeatureIds=[i.getObjectId()],this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.add(i.getObjectId()),this.activeTable.editingEnabled=!1,"related-table"===t&&(i.layer=e,i.sourceLayer=e),this.arcgisTableEditRecordClick.emit({parentTable:this.table,feature:i,layer:e})},disabled:()=>this.activeTable&&!this.activeTable.editingEnabled}}getMenuHandle(){return this.reactiveUtils.watch((()=>{var e;return null===(e=this.activeTable)||void 0===e?void 0:e.state}),(e=>{"loaded"===e&&(this.syncMenuHandles(),this.activeTable.columns.on("change",(()=>this.syncMenuHandles())))}))}syncMenuHandles(){var e;null===(e=this.activeTable.columns)||void 0===e||e.forEach((e=>{var t,i;(null==e?void 0:e.menu)&&(null===(t=null==e?void 0:e.menu)||void 0===t||t.addEventListener("calciteDropdownOpen",(()=>{this.fabNode&&(this.fabNode.hidden=!0)})),null===(i=null==e?void 0:e.menu)||void 0===i||i.addEventListener("calciteDropdownClose",(()=>{this.fabNode&&(this.fabNode.hidden=!1)})))}))}getAttachmentsViewOptionsHandle(){return this.reactiveUtils.watch((()=>this.activeTable.attachmentsViewOptions.objectId),(e=>{this.fabNode&&(e&&!this.fabNode.classList.contains("hidden-fab")?this.fabNode.classList.add("hidden-fab"):!e&&this.fabNode.classList.contains("hidden-fab")&&this.fabNode.classList.remove("hidden-fab"))}))}getColumnSortOrderHandle(){return this.reactiveUtils.watch((()=>this.activeTable.activeSortOrders),(async()=>{"loaded"===this.activeTable.state&&this.isStandardView()&&this.syncAttributeTableTemplate()}))}getColumnReorderHandle(){const{activeTable:e}=this;return e.on("column-reorder",(()=>{var e,t;null===(t=null===(e=this.fieldSelectionPopover)||void 0===e?void 0:e.parentElement)||void 0===t||t.removeChild(this.fieldSelectionPopover),this.fieldSelectionPopover=void 0,document.body.removeEventListener("click",this.visibilityClickHandler),this.isStandardView()&&this.syncAttributeTableTemplate()}))}async syncAttributeTableTemplate(){const e=this.activeTable.layer;if(a.b.includes(e.type)){if(e.attributeTableTemplate){const t=this.attributeTableTemplateUtils.syncAttributeTableTemplate(this.activeTable,e.attributeTableTemplate);e.attributeTableTemplate=t}if(e.attributeTableTemplate.orderByFields.length>1){const t=this.table.activeSortOrders[0];e.attributeTableTemplate.orderByFields=[{field:t.fieldName,order:t.direction}],this.syncColumnDirectionsWithOrderByFields()}this.arcgisTableUpdated.emit()}}isStandardView(){return!this.table.relatedTable&&!this.activeTable.attachmentsViewOptions.objectId}syncColumnDirectionsWithOrderByFields(){var e;const t=null===(e=this.activeTable.activeSortOrders[0])||void 0===e?void 0:e.fieldName;this.activeTable.columns.forEach((e=>{"fieldName"in e&&e.fieldName!==t&&(e.direction=void 0)})),this.activeTable.tableTemplate.columnTemplates.forEach((e=>{"fieldName"in e&&e.fieldName!==t&&(e.direction=void 0)}))}syncAttributeTableTemplateWithLayerFields(){var e,t;const i=null!==(t=null===(e=this.activeTable)||void 0===e?void 0:e.layer)&&void 0!==t?t:this.layer,l=i.fields.map((e=>e.name)),a=[];i.attributeTableTemplate.elements.forEach((e=>{("field"!==e.type||l.includes(e.fieldName))&&a.push(e)})),i.attributeTableTemplate.elements=a}isKnowledgeGraphSubTable(){var e,t,i,l;const a=null!==(t=null===(e=this.activeTable)||void 0===e?void 0:e.layer)&&void 0!==t?t:this.layer;if("knowledge-graph-sublayer"===a.type){return(null!==(l=null===(i=a.parentCompositeLayer.tables)||void 0===i?void 0:i.items)&&void 0!==l?l:[]).map((e=>e.id)).includes(a.id)}return!1}focus(){var e,t;const{isWithinTabsManager:i}=this;i?null===(e=this.settingsActionNode)||void 0===e||e.setFocus():null===(t=this.closeButtonNode)||void 0===t||t.setFocus()}afterCreateAction(e,t){e&&(e.onmouseover=e.onfocus=()=>{const{isBarExpanded:i}=this;i||e.textEnabled||(0,a.c)(e,t)},e.onmouseout=()=>(0,a.r)(),e.removeEventListener("focusout",this.focusOutHandler),e.addEventListener("focusout",this.focusOutHandler))}get hostElement(){return(0,l.d)(this)}};u.style=".host.sc-arcgis-table{width:100%}.content.sc-arcgis-table{height:100%;display:flex}.manager.sc-arcgis-table{height:100%}.non-tabs-manager-action-bar-wrapper.sc-arcgis-table{padding:2px 0px;background-color:var(--arcgis-app-background)}.action-bar.sc-arcgis-table{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-color-border-2);overflow-y:auto;overflow-x:hidden}.menu-actions.sc-arcgis-table{display:inline-flex;justify-self:stretch}.table.sc-arcgis-table{height:100%}.tooltip.sc-arcgis-table{white-space:nowrap}.table-fab.sc-arcgis-table{position:absolute;bottom:24px;left:auto;right:76px;--calcite-opacity-disabled:0.8}.hidden-fab.sc-arcgis-table{visibility:hidden}.arcgis--rtl.sc-arcgis-table .action-bar.sc-arcgis-table{border-width:0 0 0 1px}.arcgis--rtl.sc-arcgis-table .table-fab.sc-arcgis-table{left:76px;right:auto}";const m="popover",p="flow",b="info",f=class{constructor(e){(0,l.r)(this,e),this.arcgisTableColumnInfoClose=(0,l.c)(this,"arcgisTableColumnInfoClose",7),this.arcgisTableColumnInfoSetupComplete=(0,l.c)(this,"arcgisTableColumnInfoSetupComplete",7),this.afterCreatePopover=e=>{this.popoverNode=e},this.afterCreateCloseButton=e=>{this.closeButtonNode=e},this.afterCreateFieldInfo=e=>{e.addEventListener("arcgisFieldInfoComplete",(()=>{this.reposition(),this.arcgisTableColumnInfoSetupComplete.emit()}))},this.handleCloseClick=()=>{this.arcgisTableColumnInfoClose.emit()},this.props=void 0,this.fieldName=void 0,this.popoverReferenceElement=void 0,this.strings=void 0,this.currentLanguage=void 0,this.isOpen=!1,this.reRender=!1}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async componentWillLoad(){const{layer:e}=this.props;this.fieldsMap=await(0,o.e)(e)}componentDidLoad(){this.reposition(),this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.closeButtonNode.setFocus()))),100)}render(){const{fieldName:e,fieldsMap:t,popoverReferenceElement:i}=this,a=t.get(e);return(0,l.h)(l.H,{key:"2e549cf328786680c48a99fa9fe2b8959aaa66f2",class:"js-app-flyout"},(0,l.h)("calcite-popover",{key:"0300b2fba32660cd7d10ed7959b20a28f8b4d8e0",placement:"leading",dir:document.dir,open:this.isOpen,pointerDisabled:!0,referenceElement:i,offsetDistance:-48,offsetSkidding:0,class:m,label:"",ref:this.afterCreatePopover},(0,l.h)("calcite-flow",{key:"81d0bac9aca5a7592686522630e61a3eaf3539e1",class:p},(0,l.h)("calcite-flow-item",{key:"13a8a666e5490423969d94e1d7cf2fccda31d1c7",heading:a.alias||a.name,description:e},this.renderCloseButton(),this.renderInfo()))))}renderCloseButton(){const{strings:e}=this;return(0,l.h)("calcite-action",{text:e.close,scale:"s",slot:"header-actions-end",onClick:this.handleCloseClick,ref:this.afterCreateCloseButton,icon:"x"})}renderInfo(){const{layer:e,view:t}=this.props,{fieldName:i,currentLanguage:a}=this;return(0,l.h)("arcgis-field-info",{fieldName:i,layer:e,view:t,lang:a,class:b,ref:this.afterCreateFieldInfo})}get hostElement(){return(0,l.d)(this)}};f.style=".flow{max-height:400px;max-width:420px}.info{background-color:#ffffff;max-height:400px;max-width:420px;min-width:240px;overflow-x:hidden}";const v="popover",g="flow",y="info",T="select-button",C=class{constructor(e){(0,l.r)(this,e),this.arcgisTableFieldSelectionClose=(0,l.c)(this,"arcgisTableFieldSelectionClose",7),this.columnTemplatesVisibilityChange=(0,l.c)(this,"columnTemplatesVisibilityChange",7),this.fieldSortByChange=(0,l.c)(this,"fieldSortByChange",7),this.attachmentsChange=(0,l.c)(this,"attachmentsChange",7),this.relationshipsChange=(0,l.c)(this,"relationshipsChange",7),this.filterFields=null,this.waitHandler=null,this.changedFieldNames=[],this.handleCloseClick=()=>{this.arcgisTableFieldSelectionClose.emit()},this.props=void 0,this.columnTemplates=void 0,this.fieldColumnOrder=void 0,this.attachmentsEnabled=!1,this.relationshipsEnabled=!1,this.popoverReferenceElement=void 0,this.sortBy=void 0,this.strings=void 0,this.currentLanguage=void 0,this.lastSortBy=r.L.display}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async componentWillLoad(){const{layer:e}=this.props;this.fieldsMap=await(0,o.e)(e),this.totalCounts=this.getTotalFieldTypeCount(),this.lastSortBy=this.sortBy||r.L.default;const[t]=await(0,n.l)(["esri/widgets/FeatureTable/support/FieldColumnTemplate"]);this.FieldColumnTemplate=t}componentDidLoad(){this.reposition(),setTimeout((()=>requestAnimationFrame((()=>this.closeButtonNode.setFocus()))),200)}render(){const{strings:e,popoverReferenceElement:t}=this;return(0,l.h)(l.H,{key:"9da2b728b9fdf63811a2b4153452c56b23b20fd8",class:"js-app-flyout"},(0,l.h)("calcite-popover",{key:"3f887a1d9fd44ea07a2c86b72db653a129efe715",placement:"leading",dir:document.dir,open:!0,pointerDisabled:!0,referenceElement:t,offsetDistance:-48,offsetSkidding:0,class:v,label:"",ref:e=>this.popoverNode=e},(0,l.h)("calcite-flow",{key:"ae8befc200c777dbb519369931811fbd83bf7948",class:g,ref:e=>this.flowNode=e},(0,l.h)("calcite-flow-item",{key:"ad3ee2a55aa5f7a5db5027fa8686fe661fb084a5",heading:e.fieldVisibility,ref:e=>this.flowItemNode=e},this.renderCloseButton(),this.renderDoneButton(),this.renderList()))))}renderCloseButton(){const{strings:e}=this;return(0,l.h)("calcite-action",{text:e.close,scale:"s",slot:"header-actions-end",onClick:this.handleCloseClick,icon:"x",ref:e=>this.closeButtonNode=e})}renderDoneButton(){const{strings:e}=this;return(0,l.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"full",onClick:this.handleCloseClick,label:e.done},e.done)}renderList(){const{strings:e}=this;return(0,l.h)("calcite-list",{class:"content","drag-enabled":!1,selectionMode:"multiple",filterEnabled:!0,filterPlaceholder:e.filterFields,onCalciteListFilter:e=>{const t=e.currentTarget;this.filterFields=t.filteredItems,(0,l.f)(this.hostElement)},ref:e=>this.listNode=e},this.renderSort(),this.renderSelection(),this.renderColumnTemplateListItems(),this.renderAttachmentListItem(),this.renderRelationshipsListItem())}renderSelection(){const{filterFields:e,strings:t}=this,i=this.filterContainsAll();return(0,l.h)("calcite-button",{key:`${e}`,class:T,appearance:"transparent",scale:"s",width:"full",onClick:()=>this.handleSelectionAllClick(i),label:i?t.deselectAll:t.selectAll},i?t.deselectAll:t.selectAll)}renderSort(){const{lastSortBy:e,totalCounts:t,strings:i}=this;let a=t.number>0,s=t.string>0,n=t.date>0,o=!(!a||!s&&!n)||!(!s||!n);return(0,l.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed"},(0,l.h)("calcite-action",{slot:"trigger",text:i.sortFields,title:i.sortFields},(0,l.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,l.h)("calcite-dropdown-group",{"group-title":i.sortBy},(0,l.h)("calcite-dropdown-item",{selected:e===r.L.default,onClick:()=>{this.lastSortBy=r.L.default,this.fieldSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=r.L.default,this.fieldSortByChange.emit(this.lastSortBy))}},i.default),(0,l.h)("calcite-dropdown-item",{selected:e===r.L.display,onClick:()=>{this.lastSortBy=r.L.display,this.fieldSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=r.L.display,this.fieldSortByChange.emit(this.lastSortBy))}},i.sortByDisplayName),o?(0,l.h)("calcite-dropdown-item",{selected:e===r.L.type,onClick:()=>{this.lastSortBy=r.L.type,this.fieldSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=r.L.type,this.fieldSortByChange.emit(this.lastSortBy))}},i.sortByType):null,(0,l.h)("calcite-dropdown-item",{selected:e===r.L.field,onClick:()=>{this.lastSortBy=r.L.field,this.fieldSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy=r.L.field,this.fieldSortByChange.emit(this.lastSortBy))}},i.sortByFieldName)))}renderColumnTemplateListItems(){const{fieldColumnOrder:e,lastSortBy:t}=this;let i=this.cloneFieldTemplates();return e&&(i=i.sort(((t,i)=>e.indexOf(t.fieldName)-e.indexOf(i.fieldName)))),t===r.L.display?i=this.sortFieldsAlphabetically(i):t===r.L.type?i=this.sortFieldsByType(this.sortFieldsAlphabetically(i)):t===r.L.field&&i.sort(((e,t)=>e.fieldName.localeCompare(t.fieldName))),i.map((e=>this.renderColumnTemplateListItem(e)))}renderColumnTemplateListItem(e){const{strings:t}=this;return(0,l.h)("calcite-list-item",{key:e.fieldName,label:e.label,value:e.fieldName,selected:e.visible,onCalciteListItemSelect:e=>{const t=e.currentTarget;this.handleColumnTemplateListItemChange(t)}},(0,l.h)("calcite-action",{slot:"actions-end",text:t.info,onClick:t=>{t.stopPropagation(),this.handleInfoClick(e,t.target)}},(0,l.h)("calcite-icon",{scale:"s",icon:"information"})))}renderAttachmentListItem(){const{layer:e}=this.props,{strings:t}=this;if(!a.s.includes(e.type)||!h(e))return null;const i=this.columnTemplates.find((e=>"attachment"===e.type));return(0,l.h)("calcite-list-item",{key:"attachments",label:t.photosAndFiles,description:t.attachments,value:"__attachments",selected:null==i?void 0:i.visible,hidden:!1,onCalciteListItemSelect:e=>{const t=e.currentTarget;this.handleAttachmentsItemChange(t)}})}renderRelationshipsListItem(){var e;const{layer:t}=this.props,{strings:i}=this;if(!("relationships"in t)||!(null===(e=t.relationships)||void 0===e?void 0:e.length))return null;const a=this.columnTemplates.find((e=>"relationship"===e.type));return(0,l.h)("calcite-list-item",{key:"relationships",label:i.relatedRecords,value:"__relationships",selected:null==a?void 0:a.visible,hidden:!1,onCalciteListItemSelect:e=>{const t=e.currentTarget;this.handleRelationshipsItemChange(t)}})}handleSelectionAllClick(e){const{columnTemplates:t,filterFields:i}=this;t.forEach((t=>{i&&!i.some((e=>e.value===t.fieldName))||(t.visible=!e)})),this.listNode.querySelectorAll("calcite-list-item").forEach((t=>{i&&!i.some((e=>e.value===t.value))||t.selected!==e||(t.selected=!e,this.changedFieldNames.push(t.value),this.handleListItemChange(t))})),(0,l.f)(this.hostElement)}handleListItemChange(e){"__attachments"===e.value?this.handleAttachmentsItemChange(e):"__relationships"===e.value?this.handleRelationshipsItemChange(e):this.handleColumnTemplateListItemChange(e)}handleColumnTemplateListItemChange(e){const{columnTemplates:t}=this;t.forEach((t=>{t.fieldName===e.value&&t.visible!==e.selected&&(t.visible=e.selected,this.changedFieldNames.push(t.fieldName))})),this.waitHandler&&clearTimeout(this.waitHandler),this.waitHandler=setTimeout((()=>{this.waitHandler=null,this.columnTemplatesVisibilityChange.emit(new Set([...this.changedFieldNames])),this.changedFieldNames=[],(0,l.f)(this.hostElement)}),100)}handleAttachmentsItemChange(e){const t=e.selected;this.attachmentsChange.emit(t),this.attachmentsEnabled=t,(0,l.f)(this.hostElement)}handleRelationshipsItemChange(e){const t=e.selected;this.relationshipsChange.emit(t),this.relationshipsEnabled=t,(0,l.f)(this.hostElement)}handleInfoClick(e,t){var i;const{layer:l,view:a}=this.props,{flowNode:s,flowItemNode:n,currentLanguage:o}=this,r=n.getBoundingClientRect(),d=document.createElement("arcgis-field-info");d.lang=o,d.fieldName=e.fieldName,d.layer=l,d.view=a,d.className=y;const c=document.createElement("calcite-flow-item");c.heading=null!==(i=e.label)&&void 0!==i?i:e.fieldName,c.description=e.fieldName,c.style.height=`${r.height}px`,c.style.width=`${r.width}px`,c.appendChild(d),c.addEventListener("calciteFlowItemBack",(()=>requestAnimationFrame((()=>t.setFocus())))),s.appendChild(c),setTimeout((()=>c.setFocus()),200),this.reposition()}cloneFieldTemplates(){var e;return(null!==(e=this.columnTemplates.filter((e=>"field"===e.type)))&&void 0!==e?e:[]).map((e=>new this.FieldColumnTemplate({fieldName:e.fieldName,label:e.label,visible:e.visible,menuConfig:e.menuConfig,format:e.format})))}filterContainsAll(){var e;const{props:t,columnTemplates:i,filterFields:l,attachmentsEnabled:s,relationshipsEnabled:n}=this,{layer:o}=t;if(l){const e=l.filter((e=>"__attachments"!==e.value&&"__relationships"!==e.value)).map((e=>({value:e.value,selected:e.selected}))),t=i.filter((t=>e.some((e=>t.fieldName===e.value)))),a=!!l.find((e=>"__attachments"===e.value)),o=!!l.find((e=>"__relationships"===e.value));return e.every((e=>!t.some((t=>t.fieldName===e.value&&!t.visible))))&&(a&&s&&(o&&n||!o)||o&&n&&!a||!a&&!o)}{const t=a.s.includes(o.type)&&h(o),l="relationships"in o&&(null===(e=o.relationships)||void 0===e?void 0:e.length);return i.every((e=>e.visible))&&(t&&s&&(l&&n||!l)||l&&n&&!t||!t&&!l)}}getTotalFieldTypeCount(){const{columnTemplates:e,fieldsMap:t}=this,i={string:0,number:0,date:0};return e.forEach((e=>{if("field"===e.type){switch(t.get(e.fieldName).type){case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":case"oid":case"guid":i.number++;break;case"string":i.string++;break;case"date":case"date-only":case"time-only":case"timestamp-offset":i.date++}}})),i}sortFieldsAlphabetically(e){return e.sort(((e,t)=>"_"===e.label.charAt(0)?1:"_"===t.label.charAt(0)?-1:e.label.localeCompare(t.label)))}sortFieldsByType(e){const{fieldsMap:t}=this;return e.filter((e=>["small-integer","big-integer","integer","single","double","long"].indexOf(t.get(e.fieldName).type)>-1)).map((e=>e)).concat(e.filter((e=>"string"===t.get(e.fieldName).type)).map((e=>e))).concat(e.filter((e=>["date","date-only","time-only","timestamp-offset"].indexOf(t.get(e.fieldName).type)>-1)).map((e=>e))).concat(e.filter((e=>"oid"===t.get(e.fieldName).type)).map((e=>e))).concat(e.filter((e=>"guid"===t.get(e.fieldName).type)).map((e=>e))).concat(e.filter((e=>-1===["small-integer","big-integer","integer","single","double","long","string","date","date-only","time-only","timestamp-offset","oid","guid"].indexOf(t.get(e.fieldName).type))).map((e=>e)))}get hostElement(){return(0,l.d)(this)}};C.style=".flow{max-height:400px;width:280px}.content{max-height:80vh}.info{background-color:#ffffff}.select-button{margin:4px 0}"},60883:(e,t,i)=>{i.d(t,{C:()=>l,a:()=>a,b:()=>n,c:()=>d,d:()=>o,i:()=>r,r:()=>c,s:()=>s});const l={host:"host",content:"content",manager:"manager",actionBar:"action-bar",menuActions:"menu-actions",table:"table",tooltip:"tooltip"};var a;!function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(a||(a={}));const s=["feature","oriented-imagery"],n=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint"];function o(e){return null!=e}function r(e,t){for(;e;){if(e.nodeName===t.toUpperCase())return!0;e=e.parentElement}return!1}function d(e,t){const i=document.createElement("calcite-tooltip");i.className="table-tooltip",i.referenceElement=e,i.placement="trailing-start",i.open=!0;const a=document.createElement("div");a.className=l.tooltip,a.innerHTML=t,i.append(a),document.body.append(i)}function c(){document.querySelectorAll(".table-tooltip").forEach((e=>{var t;return null===(t=e.parentNode)||void 0===t?void 0:t.removeChild(e)}))}},91616:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>u,c:()=>a,d:()=>l,e:()=>s,f:()=>c,g:()=>p,h:()=>m,i:()=>n,m:()=>o,t:()=>r,u:()=>h});const l=(e,t)=>{let i,l="idle";const a=(...a)=>new Promise((s=>{switch(l){case"flushed":l="idle",i?(clearTimeout(i),s(e(...a))):s(null);break;case"invoked":clearTimeout(i),l="idle",s(e(...a));break;case"cancelled":clearTimeout(i),l="idle",s(null);break;default:i&&clearTimeout(i),l="pending",i=setTimeout((()=>(l="idle",s(e(...a)))),t)}}));return a.flush=function(...e){return l="flushed",a(...e)},a.invoke=function(...e){return l="invoked",a(...e)},a.cancel=function(...e){return l="cancelled",a(...e)},a.getStatus=function(){return l},a},a=(e,t)=>{let i;return(...l)=>new Promise((a=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,a(e(...l))}),t))}))};function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){return null!=e}async function o(e,t){return await Promise.all([e,r(t)]),e}function r(e){return new Promise((t=>setTimeout(t,e)))}const d=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:l}=t(e);return[i,l]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function h(e,t){const i=[],l={};return e.forEach((e=>{const a=t(e);null==l[a]&&(l[a]=e,i.push(e))})),i}function u(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let l=typeof e;return l in t?!t[l].hasOwnProperty(e)&&(t[l][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const m=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,l)=>e.slice(t*l,t+t*l))),p=(e,t)=>e.includes(t)}}]);