/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-22c199.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-22c199"],{74351:(e,t,a)=>{a.r(t),a.d(t,{arcgis_delete_folder:()=>w,arcgis_delete_items:()=>f,arcgis_item_category_schema_editor:()=>S,arcgis_schema_editor:()=>T});var i=a(20536),s=a(44090),o=a(34752),r=a(37568),l=a(96295),n=a(38973),c=a(25972),h=a(10699),d=a(91565),g=a(86980),m=a(29259),u=a(68537),p=a(98525),C=a(59377);a(98034),a(99004),a(91102),a(73807),a(369),a(5479),a(78231),a(79717),a(85781);const y=async(e,t)=>(0,c.r)(`${e.userContentUrl}/${t.id}`);async function v(e,t,a,i){try{const s=`${(0,n.g)(e)}search`;return{result:(await(0,c.r)(s,{q:`owner:${t.username} ownerfolder:${a.id} ${i||""}`,num:1})).total}}catch(e){return{result:0}}}const w=class{constructor(e){(0,i.r)(this,e),this.arcgisDeleteFolderClose=(0,i.c)(this,"arcgisDeleteFolderClose",7),this.arcgisDeleteFolderSuccess=(0,i.c)(this,"arcgisDeleteFolderSuccess",7),this.arcgisDeleteFolderFail=(0,i.c)(this,"arcgisDeleteFolderFail",7),this.updateItems=async()=>{var e;const t=await y(null!==(e=this.user)&&void 0!==e?e:s.c.user,this.folder);this.items=t.items},this.renderMessage=()=>{var e;const{i18n:t,folder:a,mode:s,folderTotal:r,portal:l,lang:n,items:c}=this,{text:h,description:d}=(null===(e=null==l?void 0:l.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled)?(()=>{let e="",i="";switch(s){case"UNPROTECTED":e=t.message.recycleAll.replace("${title}",a.title);break;case"UNRECYCLABLE":case"UNRECYCLABLE_UNPROTECTED":e=t.message.canBeEmptied.replace("${title}",a.title);break;case"PROTECTED_UNRECYCLABLE":case"PROTECTED_UNPROTECTED":case"PROTECTED_UNRECYCLABLE_UNPROTECTED":e=t.message.mustBeEmpty.replace("${title}",a.title),i=t.message.aFewCannotBeDeleted;break;case"PROTECTED":e=t.message.cannotBeDeleted.replace("${title}",a.title)}return{text:e,description:i}})():(()=>{let e="";if("PROTECTED"===s)e=t.message.cannotBeDeleted.replace("${title}",a.title);else{e=(0,o.b)(n,t.disabledMessage,r||(null==c?void 0:c.length)||0).replace("${label}",a.title)}return{text:e,description:null}})();return(0,i.h)(i.F,null,h&&(0,i.h)("p",{innerHTML:h}),d&&(0,i.h)("p",null,d))},this.handlePostDeleteItems=async()=>{var e;0===(await y(null!==(e=this.user)&&void 0!==e?e:s.c.user,this.folder)).total?await this.handleDeleteFolder():this.arcgisDeleteFolderFail.emit(this.i18n.deleteProtectedItemsInFolder)},this.handleDeleteFolder=async()=>{var e;(await(async(e,t,a)=>{const i=`${(null!=a?a:t.user).userContentUrl}/${e.id}/delete`;return await(0,c.r)(i,{},{},"post")})(this.folder,this.portal,null!==(e=this.user)&&void 0!==e?e:s.c.user)).success&&this.arcgisDeleteFolderSuccess.emit(this.i18n.success.replace("${title}",this.folder.title))},this.portal=void 0,this.user=void 0,this.folder=void 0,this.active=!0,this.mode=void 0,this.items=void 0}async componentWillLoad(){var e,t;const a=await(0,r.g)(this.el);this.i18n=a[0],this.lang=a[1];const i=null!==(e=this.user)&&void 0!==e?e:s.c.user,o=null!==(t=this.portal)&&void 0!==t?t:s.c.portal;this.isEmpty=(await async function(e,t,a){return{result:0===(await v(e,t,a)).result}}(o,i,this.folder)).result,this.folderTotal=(await async function(e,t,a){return{result:(await v(e,t,a,l.H)).result}}(o,i,this.folder)).result,this.updateItems()}render(){var e,t;const{portal:a,user:s,active:o,i18n:r,folder:l,items:n,mode:c,isEmpty:h}=this;if(l)return h?(0,i.h)("calcite-modal",{widthScale:"s",open:o,kind:"danger",onCalciteModalClose:()=>this.arcgisDeleteFolderClose.emit()},(0,i.h)("div",{slot:"header"},r.deleteFolder),(0,i.h)("div",{slot:"content",innerHTML:r.message.empty.replace("${title}",l.title)}),(0,i.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},width:"full"},r.cancel),(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>{await this.handleDeleteFolder(),this.active=!1},width:"full"},r.delete)):(0,i.h)("arcgis-delete-items",{items:n,portal:a,user:s,active:o,showSelectedItemsCount:!1,primaryBucket:(null===(e=this.mode)||void 0===e?void 0:e.includes("PROTECTED"))?"protectedItems":"unrecyclableItems",allowPermanentlyDeleteDeselect:!1,showConfirmDeleteMessage:"PROTECTED"===c&&(null===(t=null==a?void 0:a.sourceJSON)||void 0===t?void 0:t.recycleBinEnabled),closeOnConfirm:!1,onArcgisDeleteItemsModeChange:e=>{this.mode=e.detail},onArcgisDeleteItemsClose:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},onArcgisDeleteItemsDelete:async()=>{await this.handlePostDeleteItems(),this.active=!1}},(0,i.h)("div",{slot:"header"},r.deleteFolder),(0,i.h)("div",{slot:"message"},this.renderMessage()))}get el(){return(0,i.d)(this)}},f=class{constructor(e){(0,i.r)(this,e),this.arcgisDeleteItemsDelete=(0,i.c)(this,"arcgisDeleteItemsDelete",7),this.arcgisDeleteItemsError=(0,i.c)(this,"arcgisDeleteItemsError",7),this.arcgisDeleteItemsClose=(0,i.c)(this,"arcgisDeleteItemsClose",7),this.arcgisDeleteItemsModeChange=(0,i.c)(this,"arcgisDeleteItemsModeChange",7),this.compositeItemsTotal=0,this.additionalCompositeItemsTotal=0,this.deletePrimaryAction="RECYCLE",this.headerTitle="",this.configurePermanentlyDeleteOverrideUI=()=>{var e;const{i18n:t}=this;this.headerTitle=t.permanentlyDelete,this.primaryButtonText=t.permanentlyDelete,this.deleteMode="UNRECYCLABLE",this.permanentDeleteOverrideEnabled=!0,null===(e=this.modalRef)||void 0===e||e.setFocus()},this.renderContent=()=>{var e,t;const{portal:a,items:s,inRecycleBin:o,deleteItemsBuckets:r,deleteMode:l,deletePrimaryAction:n,permanentDeleteOverrideEnabled:c,configurePermanentlyDeleteOverrideUI:h,showConfirmDeleteMessage:d,allowPermanentlyDeleteDeselect:g}=this;return(0,i.h)(i.F,null,(0,i.h)("slot",{name:"message"}),this.showCompositeDisclaimer?(0,i.h)("arcgis-delete-items-composite-disclaimer",{buckets:this.deleteItemsBuckets,additionalDependentItemsTotal:this.additionalCompositeItemsTotal}):(null!==(t=null===(e=a.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled)&&void 0!==t?t:a.recycleBinEnabled)&&!o?(0,i.h)("arcgis-delete-items-recycle",{items:s,buckets:r,mode:l,primaryAction:n,primaryBucket:this.primaryBucket,allowPermanentlyDeleteDeselect:g,permanentlyDeleteOverridden:c,disableLinks:this.disableLinks,onArcgisDeleteItemsPermanentlyDeleteOverride:()=>{h()},onArcgisDeleteItemsPermanentlyDeleteBucketToggle:({detail:e})=>{this.preventNonRecyclableItemDelete=e},showSelectedItemsCount:this.showSelectedItemsCount}):d?(0,i.h)("arcgis-delete-items-permanent",{buckets:r,mode:l}):null)},this.handleDelete=async()=>{var e,t;this.isLoading=!0;const{unprotectedItems:a,unrecyclableItems:i}=this.deleteItemsBuckets;let s=[],o=[];const r=e=>e+this.compositeItemsTotal;try{if(this.permanentDeleteOverrideEnabled){const e=[...a];!this.preventNonRecyclableItemDelete&&e.push(...i),s=await this.deleteItems(e.map((e=>e.item)),!0)}else o=a.length>0?await this.deleteItems(a.map((e=>e.item))):[],s=i.length>0&&!this.preventNonRecyclableItemDelete?await this.deleteItems(i.map((e=>e.item)),!0):[];const e=(0,d.s)({deletedItems:o,permanentlyDeletedItems:s}),t={deletedItems:[...e.successes.filter((e=>!e.permanentDelete))],permanentlyDeletedItems:[...e.successes.filter((e=>e.permanentDelete))],deletedItemsCount:o.length>0?r(o.length):0,permanentlyDeletedItemsCount:s.length>0?r(s.length):0};e.successes.length>0&&this.arcgisDeleteItemsDelete.emit(t);const{errors:l}=e;l.length>0&&this.arcgisDeleteItemsError.emit(l),this.closeOnConfirm&&(this.active=!1)}catch(a){this.arcgisDeleteItemsError.emit({messageCode:null!==(t=null===(e=a.details)||void 0===e?void 0:e.messageCode)&&void 0!==t?t:"unknown"}),this.isLoading=!1}},this.deleteItems=async(e,t=!1)=>1===e.length?[await(0,d.d)(e[0],this.portal,t)]:(await(0,d.a)(e,this.portal,t)).results,this.user=void 0,this.portal=void 0,this.items=[],this.inRecycleBin=void 0,this.active=void 0,this.showSelectedItemsCount=!0,this.showConfirmDeleteMessage=!0,this.allowPermanentlyDeleteDeselect=!0,this.disableLinks=void 0,this.primaryBucket="unrecyclableItems",this.closeOnConfirm=!0,this.allowDiscouraged=void 0,this.store=(0,h.c)({}),this.deleteItemsBuckets={unrecyclableItems:[],unprotectedItems:[],protectedItems:[],selectedCompositeItems:[]},this.permanentDeleteOverrideEnabled=!1,this.showCompositeDisclaimer=!1,this.isLoading=!1,this.preventNonRecyclableItemDelete=!1}async componentWillLoad(){const e=await(0,r.g)(this.el);this.i18n=e[0],this.store.state.i18n=this.i18n,this.store.state.portal=this.portal,this.store.state.locale=(0,r.a)(this.el),this.determineDeleteState()}async handleItemUpdate(){this.determineDeleteState({fetch:!0})}async determineDeleteState(e={fetch:!0}){const{fetch:t}=e;try{if(this.inRecycleBin)return this.deleteMode="UNRECYCLABLE",this.deletePrimaryAction="PERMANENTLY_DELETE",this.primaryButtonText=this.i18n.permanentlyDelete,this.headerTitle=this.i18n.permanentlyDelete,void(this.deleteItemsBuckets.unrecyclableItems=this.items.map((e=>({item:e}))));t&&(this.isLoading=!0,this.deleteItemsBuckets=Object.assign({},await(0,d.b)(this.items,this.portal,this.allowDiscouraged)),this.compositeItemsTotal=this.countDependentItems(),this.additionalCompositeItemsTotal=this.compositeItemsTotal-this.deleteItemsBuckets.selectedCompositeItems.length,this.showCompositeDisclaimer=this.additionalCompositeItemsTotal>0,this.isLoading=!1),this.deleteMode=(0,d.c)(this.deleteItemsBuckets),this.arcgisDeleteItemsModeChange.emit(this.deleteMode),this.deletePrimaryAction=(0,d.e)(this.deleteMode),this.primaryButtonText=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"delete"],this.headerTitle=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":(0,d.i)(this.deleteItemsBuckets.unprotectedItems)||1!==this.items.length?"deleteItems":"deleteItem"]}catch(e){console.error(e)}}countDependentItems(){const{unprotectedItems:e}=this.deleteItemsBuckets;return e.reduce(((e,t)=>{var a,i,s,o;return e+(null!==(o=(null===(a=t.relatedItems)||void 0===a?void 0:a.isComposite)&&(null===(s=null===(i=t.relatedItems)||void 0===i?void 0:i.resultData)||void 0===s?void 0:s.count))&&void 0!==o?o:0)}),0)}renderDeleteButton(){const{isLoading:e,i18n:t,primaryButtonText:a}=this;return(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>this.handleDelete(),width:"full",disabled:e||"PROTECTED_UNRECYCLABLE"===this.deleteMode&&this.preventNonRecyclableItemDelete},null!=a?a:t.delete)}renderCompositeDisclaimerNextButton(){const{isLoading:e,i18n:t}=this;return(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:async()=>this.showCompositeDisclaimer=!1,width:"full",disabled:e},t.next)}render(){const{i18n:e,active:t,isLoading:a,headerTitle:s,deletePrimaryAction:o,permanentDeleteOverrideEnabled:r,additionalCompositeItemsTotal:l,showCompositeDisclaimer:n,renderContent:c}=this,h=r||!n&&l>0;return(0,i.h)("calcite-modal",{key:"3680f5e8f6ab658175166915d648d5bbf396ef40",open:t,widthScale:"s",kind:n?"info":"danger",outsideCloseDisabled:!0,ref:e=>this.modalRef=e,onCalciteModalClose:()=>{this.arcgisDeleteItemsClose.emit(),this.active=!1}},(0,i.h)("span",{key:"a915eb0a348ca71c9e12b0bf7495fd27791d22c3",slot:"header",class:"header"},(0,i.h)("slot",{key:"76a3b561e28185dc8f074ba683ca8122411d7709",name:"header"},s)),(0,i.h)("div",{key:"ee8ac0a27be8d4e3860656eafac3d06a5e0ec095",slot:"content",class:"content"},a?(0,i.h)("calcite-scrim",{loading:!0}):c()),!a&&(0,i.h)(i.F,{key:"a39b4e4eae1cf906583ec176ff760e8870f3a509"},(0,i.h)("div",{key:"9724aa4c1a539b22bd670222c9fab28cdda24479",slot:"back"},h&&(0,i.h)("calcite-button",{key:"f4835b54a66f41b9e0e8651be57bf0ee8febb1ec",appearance:"outline-fill",kind:"neutral","data-id":"backButton",onClick:()=>{r?(this.permanentDeleteOverrideEnabled=!1,this.determineDeleteState({fetch:!1})):this.showCompositeDisclaimer=!0},width:"full",disabled:a},e.back)),(0,i.h)("calcite-button",{key:"55a3956c6e9a34734be95740bcdf394394638597",slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.active=!1},width:"full"},e.cancel),"NONE"!==o&&(this.showCompositeDisclaimer?this.renderCompositeDisclaimerNextButton():this.renderDeleteButton())))}get el(){return(0,i.d)(this)}static get watchers(){return{items:["handleItemUpdate"]}}};f.style=".content{display:flex;min-height:72px;flex-direction:column;justify-content:center}::slotted([slot=message]){margin-bottom:1rem}";const D=async(e,t,a)=>{const i=a?`${(0,n.g)(t)}/content/groups/${a.id}/`:`${(0,n.g)(t)}`,s=a?{q:l.H,countFields:"access,contentstatus,groupCategories"}:{q:`orgid:${e.orgId} ${l.H}`,countFields:"categories"};try{const{aggregations:e}=await(0,c.r)(`${i}search`,Object.assign(Object.assign({},s),{countSize:200,num:0,f:"json"}));return{result:a?e.counts.find((({fieldName:e})=>"groupCategories"===e)):e.counts[0]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},I=e=>{e.forEach((e=>{e.description&&delete e.description,e.categories?I(e.categories):e.categories=[]}))},b=e=>{const t=structuredClone(e);return I(t),t},S=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,i.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,i.c)(this,"deleteAllSchema",7),this.hasChangeSinceLastOpen=!1,this.didFetchTemplates=!1,this.templateInfo={custom:{schema:[{title:"Categories",categories:[]}]},arcgis:{schema:[],learnMoreId:"120001309",enterpriseLearnMoreId:"120001580"},iso:{schema:[],learnMoreId:"120001310",enterpriseLearnMoreId:"120001581"},inspire:{schema:[],learnMoreId:"120001311",enterpriseLearnMoreId:"120001582"}},this.fetchCategoryData=async()=>{var e,t;const{user:a,portal:i,setCategorySchema:s,group:o,templateInfo:r,didFetchTemplates:l}=this,[{result:n},{result:c}]=await Promise.all([(0,g.g)({user:a,portal:i,group:o}),D(a,i,o)]);if(null===(t=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.categories)||void 0===t?void 0:t.length)s(n),this.categoryAggregationData=c;else if(this.rootCategoryTitle=m.U.replace("/",""),this.categorySchema=[],this.newCategoryMode=!0,!l){this.isFetchingTemplate=!0;const{result:e}=await(async e=>{try{const[{categorySchema:t},{categorySchema:a},{categorySchema:i}]=await Promise.all([(0,g.a)(e,"LivingAtlas"),(0,g.a)(e,"Inspire"),(0,g.a)(e,"ISO")]);return{result:{LivingAtlas:t,Inspire:a,ISO:i}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(i);r.arcgis.schema=e.LivingAtlas,r.iso.schema=e.ISO,r.inspire.schema=e.Inspire,this.didFetchTemplates=!0,this.isFetchingTemplate=!1}},this.setCategorySchema=e=>{this.rootCategoryTitle=e[0].title,this.categorySchema=e[0].categories},this.closeDialog=()=>{this.schemaToConfirm=null,this.hasUnsavedChanges=!1,this.workflowCancel.emit({hasChangeSinceLastOpen:this.hasChangeSinceLastOpen})},this.updateSchema=async({schemaToUpdate:e,ignoreNewCategoryMode:t=!1,optimisticUpdate:a=!0})=>{const{portal:i,rootCategoryTitle:s,handleError:o,fetchCategoryData:r,newCategoryMode:l,group:h,deleteAllSchema:d}=this;if(l&&!t)return this.hasUnsavedChanges=e.length>0,this.categorySchema=e,!0;this.hasChangeSinceLastOpen=!0;const g=this.categorySchema;a&&(this.categorySchema=e);return(async()=>{if(this.error=null,0===e.length){const{error:e}=await(async(e,t)=>{try{const a=t?(0,C.a)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,c.r)(`${a}deleteCategorySchema`,{},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(i,h);return void(e?(o("generic"),a&&(this.categorySchema=g)):(this.newCategoryMode=!0,d.emit()))}const{error:t}=await(async({portal:e,group:t,categorySchema:a})=>{try{const i=t?(0,C.a)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,c.r)(`${i}assignCategorySchema`,{categorySchema:JSON.stringify({categorySchema:a})},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({portal:i,categorySchema:[{title:s,categories:l?b(e):e}],group:h});t?(o("generic"),a&&(this.categorySchema=g)):(this.hasUnsavedChanges=!1,await r())})(),!0},this.finishSetupNewCategorySchema=async()=>{const{newSchemaWorkflowComplete:e,categorySchema:t,updateSchema:a}=this;await a({schemaToUpdate:t,ignoreNewCategoryMode:!0})&&(this.newCategoryMode=!1,e.emit({newSchema:t}))},this.renderTemplates=()=>{const{templateInfo:e,i18n:t,chosenTemplate:a,portal:s,config:o,group:r,setCategorySchema:l}=this,{helpBase:n,helpMap:c}=o;return(0,i.h)("div",{class:"template-container"},(0,i.h)("p",{class:"template-title"},t.template.title),(0,i.h)("calcite-tile-select-group",null,Object.keys(e).map((o=>{const{learnMoreId:h,enterpriseLearnMoreId:d}=e[o];return(0,i.h)("calcite-tile-select",{key:o,checked:a===o,description:t.template.templateList[o][r&&"custom"===o?"messageGroup":"message"],heading:t.template.templateList[o].title,width:"auto",value:o,onCalciteTileSelectChange:t=>{const a=t.target.value;this.chosenTemplate=a,l(e[a].schema),this.hasUnsavedChanges="custom"!==a}},h&&(0,i.h)("calcite-link",{href:`${n}${c[s.isPortal?d:h]}`,role:"presentation",class:"template-link",iconEnd:"launch",target:"_blank",rel:"noopener noreferrer"},t.template.learnMore))}))))},this.renderConfirmationModal=()=>{const{i18n:e,handleUpdateSchemaWithCount:t,schemaToConfirm:a,lang:s}=this;if(!a)return null;const r=e.warning["delete"===a.type?"deleteInUseCategory":"changeTitleInUseCategory"];return(0,i.h)("calcite-modal",{kind:"danger",scale:"m",widthScale:"s",onCalciteModalClose:e=>{e.stopPropagation(),this.schemaToConfirm=null},open:!!a,class:"confirm-modal",style:{"--calcite-modal-scrim-background":"rgba(255, 255, 255, 0.5)"}},(0,i.h)("div",{slot:"header"},r.title),(0,i.h)("div",{slot:"content",class:"confirm-modal-content"},(0,o.b)(s,r.message,a.count).replace("${newTitle}","change-title"===a.type?a.newTitle:"")),(0,i.h)("calcite-button",{slot:"secondary",appearance:"outline","data-id":"cancelButton",onClick:()=>{this.schemaToConfirm=null,"change-title"===a.type&&(this.categorySchema=[...this.categorySchema])},width:"full"},e.cancel),(0,i.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:t,width:"full"},r.cta))},this.handleUpdateSchemaWithCount=async()=>{const{group:e,schemaToConfirm:t,portal:a,updateSchema:i,categoryAggregationData:s}=this;this.isUpdatingCategoryWithCount=!0,this.schemaToConfirm=null;await i({schemaToUpdate:t.schema})&&(await(0,g.d)({path:t.path,portal:a,updateInfo:"delete"===t.type?{type:"delete"}:{type:"change-title",newTitle:t.newTitle},group:e}),"change-title"===t.type&&(s.fieldValues=s.fieldValues.map((e=>{const a=t.path.toLowerCase(),i=(0,m.a)(a,t.newTitle.toLowerCase());return e.value.toLowerCase()===a?Object.assign(Object.assign({},e),{value:i}):e})),this.categoryAggregationData=Object.assign({},s))),this.isUpdatingCategoryWithCount=!1},this.handleError=e=>{const{i18n:t}=this;let a=t.error[e].message;"maxCharacter"===e&&(a=a.replace("${maxCharacter}",`${p.M}`)),this.error={title:t.error[e].title,message:a}},this.getUnsavedChangesConfirmation=()=>window.confirm(this.i18n.hasUnsavedChanges),this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.isActive=void 0,this.newCategoryMode=!1,this.categorySchema=[],this.categoryAggregationData={fieldName:"categories",fieldValues:[]},this.hasUnsavedChanges=void 0,this.error=null,this.isFetchingSchemaOnActiveChange=!1,this.isFetchingTemplate=!1,this.isUpdatingCategoryWithCount=!1,this.schemaToConfirm=void 0,this.rootCategoryTitle=void 0,this.chosenTemplate="custom"}async componentWillLoad(){const e=await(0,r.g)(this.el);this.i18n=e[0],this.lang=e[1]}componentDidLoad(){this.handleIsActiveChange()}async handleIsActiveChange(){this.hasChangeSinceLastOpen=!1,this.chosenTemplate="custom",this.error=null,this.schemaToConfirm=null,!this.isActive||(0,u.b)(this.user)&&!this.group||(this.isFetchingSchemaOnActiveChange=!0,await this.fetchCategoryData(),this.isFetchingSchemaOnActiveChange=!1)}render(){const{newCategoryMode:e,categorySchema:t,categoryAggregationData:a,rootCategoryTitle:s,isActive:o,isFetchingSchemaOnActiveChange:r,closeDialog:l,i18n:n,group:c,updateSchema:h,error:d,renderTemplates:g,chosenTemplate:m,isFetchingTemplate:u,workflowCancel:p,finishSetupNewCategorySchema:C,hasUnsavedChanges:y,handleError:v,renderConfirmationModal:w,isUpdatingCategoryWithCount:f,getUnsavedChangesConfirmation:D}=this;return!o||r?null:(0,i.h)("calcite-modal",{open:o,beforeClose:async()=>{if(y&&!D())throw new Error},onCalciteModalClose:l,scale:"m",class:{modal:!0,"modal--large":e},outsideCloseDisabled:!0},(0,i.h)("div",{slot:"header",class:"header"},n[c?"modalGroupHeader":"modalHeader"]),(0,i.h)("div",{slot:"content",class:"stage"},w(),(0,i.h)("calcite-alert",{icon:!0,open:!!d,label:null==d?void 0:d.title,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,i.h)("div",{slot:"message"},null==d?void 0:d.message)),(u||f)&&(0,i.h)("calcite-scrim",{loading:!0},n.loadingText),e&&g(),(0,i.h)("div",{class:{"inner-container":!0,"inner-container--new-category":e}},!e&&(0,i.h)("calcite-notice",{open:!0,class:"help-text"},(0,i.h)("div",{slot:"title"},c?n.helpTextGroup:n.helpText),(0,i.h)("div",{slot:"message"},c?n.helpTextGroupDescription:n.helpTextDescription)),(0,i.h)("arcgis-schema-editor",{newCategoryMode:e,showInputByDefault:"custom"===m,canEditCategory:()=>!0,categoryAggregationData:a,categorySchema:t,rootCategoryPath:`/${s}`,canCollapseAll:!e,saveNewTitle:async({newSchema:e,categoryCount:t,path:a,newTitle:i})=>t?(this.schemaToConfirm={schema:e,count:t,path:a,newTitle:i,type:"change-title"},!0):h({schemaToUpdate:e,optimisticUpdate:!1}),saveNewCategory:async({newSchema:e})=>h({schemaToUpdate:e}),onArcgisSchemaEditorDelete:async({detail:{newSchema:e,categoryCount:t,path:a}})=>t?this.schemaToConfirm={schema:e,count:t,path:a,type:"delete"}:h({schemaToUpdate:e}),onArcgisSchemaEditorListOrderChange:async({detail:{newSchema:e}})=>h({schemaToUpdate:e}),onArcgisSchemaEditorInvalidMove:({detail:{errorCode:e}})=>{v(e)},onArcgisSchemaEditorTitleInvalid:({detail:{errorCode:e}})=>{v(e)}}))),e&&(0,i.h)(i.F,null,(0,i.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{y&&!D()||p.emit()},width:"full"},n.cancel),(0,i.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:C,width:"full",disabled:!y},n.finishSetup)))}get el(){return(0,i.d)(this)}static get watchers(){return{isActive:["handleIsActiveChange"]}}};S.style=".stage{height:100%;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));overflow:hidden;display:flex}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:48rem;--calcite-modal-height:90vh;--calcite-modal-content-background:var(--calcite-color-background)}.modal--large{--calcite-modal-width:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;box-sizing:border-box;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-bottom:0.75rem}.confirm-modal{--calcite-modal-width:32rem;--calcite-modal-height:auto}.confirm-modal-content{padding:1rem}";const T=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorListOrderChange=(0,i.c)(this,"arcgisSchemaEditorListOrderChange",7),this.arcgisSchemaEditorDelete=(0,i.c)(this,"arcgisSchemaEditorDelete",7),this.arcgisSchemaEditorInvalidMove=(0,i.c)(this,"arcgisSchemaEditorInvalidMove",7),this.arcgisSchemaEditorTitleInvalid=(0,i.c)(this,"arcgisSchemaEditorTitleInvalid",7),this.prevChangeEventPayload=null,this.prevSchema=null,this.handleExpandCollapseAllClick=()=>{this.isCollapsedAll=!this.isCollapsedAll,this.itemRef.expandOrCollapseAll(this.isCollapsedAll)},this.handleListOrderChange=e=>{const{categorySchema:t,arcgisSchemaEditorListOrderChange:a,uiCategory:i,rootCategoryPath:s}=this,o=(0,p.g)(i,e,s);a.emit(Object.assign(Object.assign({},e),{newSchema:o})),this.prevSchema=t},this.handleDeleteClick=e=>{const{arcgisSchemaEditorDelete:t,uiCategory:a,rootCategoryPath:i}=this,s=(0,p.a)(a,e,i);t.emit(Object.assign(Object.assign({},e),{path:(0,p.b)({uiPath:e.path,rootCategoryPath:i,uiCategory:a}),newSchema:s})),this.prevSchema=this.categorySchema},this.handleSaveNewTitle=async e=>{const{saveNewTitle:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:s}=this,o=e.path,r=(0,p.c)({targetParentCategory:(0,p.d)(a,o,s).parentCategory,targetCategory:{path:o,title:e.newTitle}});if(r)return i.emit(Object.assign(Object.assign({},e),{errorCode:r})),!1;const l=this.categorySchema,n=(0,p.e)(a,e,s),c=await t(Object.assign(Object.assign({},e),{path:(0,p.b)({uiPath:o,rootCategoryPath:s,uiCategory:a}),newSchema:n}));if(c){this.prevSchema=l;const{targetCategory:t,parentCategory:i}=(0,p.d)(a,e.path,s);t.title=e.newTitle,t.path=(0,m.b)(i.path,t)}return c},this.handleSaveNewCategory=async e=>{const{saveNewCategory:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:s}=this,o=e.path,{parentCategory:r,targetCategory:l}=(0,p.d)(a,o,s),n=(0,p.c)({targetParentCategory:null!=l?l:r,targetCategory:{path:o,title:e.newTitle}});if(n)return i.emit(Object.assign(Object.assign({},e),{errorCode:n})),!1;const c=this.categorySchema,h=(0,p.f)(a,e,s),d=await t(Object.assign(Object.assign({},e),{newSchema:h}));return d&&(this.prevSchema=c),d},this.isMoveValid=e=>{const{maxDepth:t,arcgisSchemaEditorInvalidMove:a,prevChangeEventPayload:i,rootCategoryPath:s}=this,{fromCategory:o,toCategory:r,fromItemCategory:l}=e,{fromCategory:n,fromItemCategory:c,toCategory:h,fromIndex:d,toIndex:g}=null!=i?i:{};if(i&&n.path===o.path&&c.path===l.path&&h.path===r.path&&d===e.fromIndex&&g===e.toIndex)return this.prevChangeEventPayload=null,null;this.prevChangeEventPayload=e;const{path:m}=r;if("number"==typeof t&&m&&(0,p.h)(m,s)>t)return a.emit(Object.assign(Object.assign({},e),{errorCode:"maxDepthExceeded"})),!1;const u=(0,p.c)({targetParentCategory:r,targetCategory:l});return!u||(a.emit(Object.assign(Object.assign({},e),{errorCode:u})),!1)},this.categorySchema=void 0,this.rootCategoryPath=void 0,this.categoryAggregationData=void 0,this.showInputByDefault=!1,this.newCategoryMode=void 0,this.maxDepth=2,this.maxCategories=900,this.canCollapseAll=!0,this.canEditCategory=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.isCollapsedAll=!1,this.uiCategory=void 0,this.canAddCategory=!1,this.canDeleteCategory=!1}async componentWillLoad(){const e=await(0,r.g)(this.el);this.i18n=e[0],this.categorySchemaChangeHandler()}async revertSchema(){this.categorySchema=this.prevSchema}categorySchemaChangeHandler(){const{categorySchema:e,categoryAggregationData:t,rootCategoryPath:a}=this;this.uiCategory=(0,p.i)({categorySchema:e,categoryAggregationData:t,rootCategoryPath:a});const i=(0,p.j)(e);this.canAddCategory=i<this.maxCategories,this.canDeleteCategory=!0}render(){const{uiCategory:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:s,canAddCategory:o,canDeleteCategory:r,canEditCategory:l,canCollapseAll:n,i18n:c,isCollapsedAll:h,maxDepth:d,handleExpandCollapseAllClick:g,handleListOrderChange:m,handleSaveNewTitle:u,handleSaveNewCategory:p,isMoveValid:C}=this;return(0,i.h)(i.H,{key:"3eef083c23efff7f11bcc925785b7733b6d6e55a"},n&&(0,i.h)("calcite-button",{key:"95637e15e31538d5e5d8b177774fb52793880465",iconStart:h?"chevron-down":"chevron-up",appearance:"outline-fill",kind:"neutral",onClick:g,class:"expand-collapse-all"},h?c.expandAll:c.collapseAll),(0,i.h)("arcgis-schema-editor-category",{key:"e83fdcefc1371d4dbfb596504bc584d2139b6f83",category:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:s,canAddCategory:o,canDeleteCategory:r,canEditCategory:l,i18n:c,maxDepth:d,isMoveValid:C,onListOrderChanged:e=>m(e.detail),onArcgisSchemaEditorInternalDeleteClick:e=>this.handleDeleteClick(e.detail),saveNewTitle:u,saveNewCategory:p,ref:e=>this.itemRef=e}))}get el(){return(0,i.d)(this)}static get watchers(){return{rootCategoryPath:["categorySchemaChangeHandler"],categorySchema:["categorySchemaChangeHandler"],categoryAggregationData:["categorySchemaChangeHandler"]}}};T.style=".expand-collapse-all{margin-bottom:1rem}"},96295:(e,t,a)=>{a.d(t,{H:()=>i,R:()=>s});const i='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")',s="Indoors Map Configuration,Code Attachment"},98525:(e,t,a)=>{a.d(t,{M:()=>y,a:()=>l,b:()=>C,c:()=>p,d:()=>c,e:()=>o,f:()=>r,g:()=>s,h:()=>n,i:()=>h,j:()=>u});var i=a(29259);const s=(e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:i,toIndex:s},o)=>{const r=structuredClone(e),l=c(r,t,o);let n=l;t!==a&&(n=c(r,a,o));const[h]=l.targetCategory.categories.splice(i,1);return n.targetCategory.categories.splice(s,0,h),d(r)},o=(e,{newTitle:t,path:a},i)=>{const s=structuredClone(e);return c(s,a,i).targetCategory.title=t,d(s)},r=(e,{newTitle:t,path:a},i)=>{const s=structuredClone(e),o=a.replace(/\/[^/]+$/,"");if(o){const{targetCategory:e}=c(s,o,i);e.categories.push({title:t,categories:[],count:0,path:null})}else s.categories.push({title:t,categories:[],count:0,path:null});return d(s)},l=(e,{path:t},a)=>{const i=structuredClone(e),{targetIndex:s,parentCategory:o}=c(i,t,a);return null==o||o.categories.splice(s,1),d(i)},n=(e,t)=>{var a;return null!==(a=null==e?void 0:e.toLocaleLowerCase().replace(t.toLowerCase(),"").slice(1).split("/").length)&&void 0!==a?a:0},c=(e,t,a)=>{var s;const o=a.toLocaleLowerCase();if(null==t||t===o)return{targetCategory:e,targetIndex:1,parentCategory:null,originalPath:t};const r=t.slice(1).split("/");let l=0===t.toLocaleLowerCase().indexOf(o)?(0,i.b)("",{title:r.shift()}):"",n=null,c=e,h=0,d=l;do{l=(0,i.b)(l,{title:r.shift()}),n=c,h=c.categories.findIndex((e=>e.path.toLocaleLowerCase()===l.toLocaleLowerCase())),c=c.categories[h],d+=`/${null!==(s=null==c?void 0:c.title)&&void 0!==s?s:""}`}while(r.length>0&&c.categories.length);return d=d.replace(o,a),{targetCategory:c,targetIndex:h,parentCategory:n,originalPath:d}},h=({categoryAggregationData:e,categorySchema:t,rootCategoryPath:a})=>{var i,s;const o=a.toLocaleLowerCase();return{title:"",path:null,count:null!==(s=null===(i=e.fieldValues.find((e=>e.value===o)))||void 0===i?void 0:i.count)&&void 0!==s?s:0,categories:m({parentPath:null,categorySchema:t,categoryAggregationData:e,lowerCaseRootCategoryPath:o})}},d=e=>e.categories.map(g),g=e=>({title:e.title,categories:e.categories.map(g)}),m=({categoryAggregationData:e,categorySchema:t,parentPath:a,lowerCaseRootCategoryPath:s})=>t.map((t=>{var o,r,l;const n=(0,i.b)(null!=a?a:s,t),c=null===(o=e.fieldValues.find((e=>e.value===n)))||void 0===o?void 0:o.count,h=m({parentPath:n,categorySchema:null!==(r=t.categories)&&void 0!==r?r:[],categoryAggregationData:e,lowerCaseRootCategoryPath:s});return{title:null!==(l=t.displayName)&&void 0!==l?l:t.title,path:n,count:null!=c?c:0,categories:h}})),u=e=>e.reduce(((e,t)=>{var a;return e+1+u(null!==(a=t.categories)&&void 0!==a?a:[])}),0),p=({targetCategory:e,targetParentCategory:t})=>{var a;const i=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();return i?i.length>y?"maxCharacter":t.categories.some((t=>t.title.toLowerCase()===i&&t.path!==e.path))?"destinationHasSameName":null:"emptyTitle"},C=({rootCategoryPath:e,uiCategory:t,uiPath:a})=>c(t,a,e).originalPath,y=100}}]);