"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-01fbb1"],{56750:(e,t,i)=>{i.r(t),i.d(t,{rfx_color_picker:()=>f,rfx_dte_number_input:()=>k,rfx_dte_raster_input:()=>E,rfx_dtex_field_select:()=>F,rfx_grid:()=>O});var a=i(17002),r=i(56451),s=(i(5294),i(13661),i(18423),i(21255),i(35431),i(588),i(55448),i(2924),i(11840),i(52373),i(33752),i(440),i(66744),i(44345),i(19562)),o=i(33355),l=(i(23795),i(17902),i(71802),i(32513),i(36596),i(93210)),n=i(40320),c=i(45709),d=i(10259),h=i(54667),u=i(95730),g=i(15195),p=i(28004);i(68708);const f=class{constructor(e){(0,a.r)(this,e),this.rfxColorPickerValueChange=(0,a.c)(this,"rfxColorPickerValueChange",7),this.onColorSwatchClick=e=>{const t=e.target.value;this.popoverElememt.open=!1,this.value=new r.default(t).toRgba(),this.rfxColorPickerValueChange.emit({value:this.value})},this.value=[0,0,0,255]}render(){const e=new r.default(this.value).toHex();return(0,a.h)("div",{key:"5111e198d0ef502de33bd6687edfe89d7542d5a1"},(0,a.h)("calcite-color-picker-swatch",{key:"602362a3186e511646328675bfdf3dff6794e1be",active:!1,color:e,id:"color-picker-swatch",scale:s.U.Scale,onClick:()=>{setTimeout((()=>requestAnimationFrame((()=>{this.popoverElememt.open=!0,this.popoverElememt?.setFocus()}))),1)},role:"button",ref:e=>{}}),(0,a.h)("calcite-popover",{key:"3a707c5aecde0397924648e28932a9ac893c56c4",autoClose:!0,pointerDisabled:!0,referenceElement:"color-picker-swatch",placement:"auto",overlayPositioning:s.a.fixed,scale:s.U.Scale,label:"color-picker-popover",ref:e=>{this.popoverElememt=e}},(0,a.h)("calcite-color-picker",{key:"95c5ca1ceff5023ebab982330e76ad511933e9f9",scale:s.U.Scale,value:e,format:"auto",onCalciteColorPickerChange:this.onColorSwatchClick})))}get hostElement(){return(0,a.a)(this)}},m="invalidIntegerMessage",y="invalidDoubleMessage",v="requiredInputMessage",b="belowMinimumMessage",x="aboveMaximumMessage",C="strictlyMinimumMessage",L="strictlyMaximumMessage",w={errorMessage:"rfx-dte-number-input__error-message"},k=class{constructor(e){(0,a.r)(this,e),this.rfxNumberInputChange=(0,a.c)(this,"rfxNumberInputChange",7),this.rfxNumberInputValueChange=(0,a.c)(this,"rfxNumberInputValueChange",7),this.inputChanged=e=>{if(null!==e.target){const t=(e?.target).value;if(this.value=(0,c.p)(t),""===t)return;this.validate(),void 0===this.errorMessage&&this.rfxNumberInputChange.emit()}},this.inputValueChanged=e=>{if(null!==e?.target){const t=e.target.value;this.value=(0,c.p)(t),void 0!==this.defaultValue&&void 0===this.value&&(this.value=this.defaultValue,this.rfxNumberInputChange.emit()),this.validate(),void 0===this.errorMessage&&this.rfxNumberInputValueChange.emit()}},this.validateNumber=(e,t)=>{const{required:i,isFloatType:a,excludeMinValue:r,excludeMaxValue:s,min:o,max:l}=t;let n;return(0,c.i)(e)?!1!==a||Number.isInteger(e)?void 0!==o&&void 0!==e&&(e<o||!0===r&&e<=o)?n=!0===r?C:b:void 0!==l&&void 0!==e&&(e>l||!0===s&&e>=l)&&(n=!0===s?L:x):n=m:null!=e?n=!0===a?y:m:!0===i&&(n=v),n},this.errorMessage=void 0,this.value=void 0,this.numberType=void 0,this.required=void 0,this.min=void 0,this.excludeMinValue=void 0,this.max=void 0,this.excludeMaxValue=void 0,this.numberButtonType="vertical",this.dependentFields=void 0,this.placeholder=void 0,this.isDisabled=!1,this.defaultValue=void 0,this.initialValue=void 0}onValueChange(){this.validate()}onRequiredChange(){this.validate()}onValidationChange(){this.errorMessage=void 0,!1===(0,n.o)(this.value)&&this.validate()}async checkValidity(){return this.validate(),Promise.resolve(void 0===this.errorMessage||""===this.errorMessage)}async componentWillLoad(){({strings:this.strings,locale:this.locale}=await(0,l.c)(this.hostElement,(0,a.g)("."))),this.value=this.value??this.initialValue}componentDidLoad(){this.validate()}get isFloatType(){return(0,n.o)(this.numberType)||"float"===this.numberType}get formatOptions(){return{min:`${this.getDependentFieldName("min")??this.min??Number.MIN_SAFE_INTEGER}`,max:`${this.getDependentFieldName("max")??this.max??Number.MAX_SAFE_INTEGER}`}}getDependentFieldName(e){if(void 0!==this.dependentFields)return"min"===e?this.dependentFields.greaterThan??this.dependentFields.greaterThanOrEqual:"max"===e?this.dependentFields.lessThan??this.dependentFields.lessThanOrEqual:void 0}validate(){const e=this.value,t=this.validateNumber(e,this.formatValidationOptions()),i=void 0!==t?(0,o.f)(this.strings[t],this.formatOptions):void 0;this.errorMessage=i}formatValidationOptions(){return{required:this.required,isFloatType:this.isFloatType,excludeMaxValue:this.excludeMaxValue,excludeMinValue:this.excludeMinValue,max:this.max??Number.MAX_SAFE_INTEGER,min:this.min??Number.MIN_SAFE_INTEGER}}render(){const e=void 0!==this.errorMessage;return(0,a.h)("host",{key:"d7c662d5fdc74b86b90bd8fad845781bb0f45d40"},(0,a.h)("calcite-input",{key:"fda796d405bebcc8b28b9b168edcdb95a88a729d",type:"number",value:(0,c.s)(this.value),step:this.isFloatType?"any":1,required:this.required||void 0,min:this.min,max:this.max,status:e?"invalid":"valid",scale:s.U.Scale,groupSeparator:!0,onCalciteInputInput:this.inputChanged,onCalciteInputChange:this.inputValueChanged,numberButtonType:this.numberButtonType,placeholder:this.placeholder??this.strings.placeholder,disabled:this.isDisabled,title:this.value?.toLocaleString(this.locale)}),(0,a.h)("calcite-input-message",{key:"dedd5c54d70a1a1722a42851d16a13cde79469bd",class:w.errorMessage,status:e?"invalid":"valid",scale:s.U.Scale,hidden:!1===e,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}static get watchers(){return{value:["onValueChange"],required:["onRequiredChange"],min:["onValidationChange"],max:["onValidationChange"],excludeMaxValue:["onValidationChange"],excludeMinValue:["onValidationChange"],numberType:["onValidationChange"]}}};k.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-number-input__error-message{margin-top:0.5rem}";const T="rfx-dte-raster-input",R={layerInput:`${T}__layer-input`,layerLoadFail:`${T}__layer-load-fail`,layerValidation:`${T}__layer-input-validation-msg`},E=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange",7),this.calciteComboboxOpen=(0,a.c)(this,"calciteComboboxOpen",7),this.calciteComboboxClose=(0,a.c)(this,"calciteComboboxClose",7),this.scalarValues=[],this.showNoticeForNonAnalysisLayers=!1,this.loaded=!1,this.applyStyleToCombobox=e=>{this.layerSelectorCombobox=e;(0,p.o)(e,["shadowRoot","children[0]","children[2]"],(e=>{const t=document.createElement("style");t.innerHTML="div { overflow: auto !important}",e.appendChild(t)})),this.changeLoadingIconColor()},this.layerLoadFailed=!1,this.errorCode=void 0,this.layerLoading=!1,this.inputLayers=void 0,this.value=void 0,this.allowScalar=!1,this.overlayPositioning=s.a.absolute,this.maxItems=5,this.rfxVariable=void 0,this.mode=void 0,this.portal=void 0,this.rfxBrowseLayerClick=void 0}onInputLayersChange(e){const t=(0,h.p)(e);t.length!==e.length&&(this.showNoticeForNonAnalysisLayers=!0,this.inputLayers=t)}async onRFxVariableChange(e){if(e.value)this.value=e.value;else if(this.argRFT=(0,d.o)(e),e.type===g.J.RASTER_FUNCTION_TEMPLATE)try{const e=(0,d.k)(this.argRFT,["input","uxBlocks","overrideWidget","displayName","helpTextID"]),t=(0,h.q)((0,o.j)(this.portal??o.m.portal),e);await t.load(),this.rasterRenderingLayer=t}catch(e){console.error(e?.details?.messages)}}async connectedCallback(){return await this.load(),this.loaded=!0,Promise.resolve()}async componentWillLoad(){({strings:this.strings,locale:this.locale}=await(0,l.c)(this.hostElement,(0,a.g)("."))),void 0!==this.inputLayers&&this.onInputLayersChange(this.inputLayers)}async getSelectedLayer(){return!1===this.loaded&&await this.load(),void 0!==this.value&&"object"==typeof this.value?this._getSelectedLayer(this.value):this.rfxVariable.type===g.J.RASTER_FUNCTION_TEMPLATE?this.rasterRenderingLayer:Promise.resolve(void 0)}async updateBrowsedLayer(e){return e.forEach((e=>{0===this.inputLayers.filter((t=>e.url===t.url)).length&&this.inputLayers.push(e),this.value=(0,h.e)(e),this.rfxArgumentChange.emit({value:this.value})})),Promise.resolve(void 0)}async checkValidity({required:e}){let t=!0;return this.layerLoadFailed&&(t=!1),e&&(0,n.o)(this.value)&&(0,n.o)(this.argRFT)&&(this.errorCode="required",t=!1),Promise.resolve(t)}async load(){(0,n.o)(this.rfxVariable)||await this.onRFxVariableChange(this.rfxVariable),(0,n.o)(this.value)||await this.processValueLayer()}async processValueLayer(){if(this.rfxVariable?.type===g.J.RASTER_FUNCTION_TEMPLATE)return;if("scalar"===this.value.type?.toLowerCase())return void this.scalarValues.push(this.value);const e=this.value?.url;if((0,n.o)(e))return void(this.layerLoadFailed=!0);const t=(0,h.f)(this.value,this.inputLayers);if((0,n.o)(t)){this.layerLoading=!0;const e=await(0,h.h)(this.value);if(this.layerLoading=!1,setTimeout((()=>this.changeLoadingIconColor()),100),void 0===e)return void(this.layerLoadFailed=!0);this.inputLayers=[...this.inputLayers,e]}const i=await this._getSelectedLayer(this.value);void 0!==i&&(this.value=(0,h.e)(i)),this.inputLayers=(0,o.a)(this.inputLayers,["title","url"])}async _handleComboBoxChange(e){this.layerLoadFailed=!1,this.errorCode=void 0;const t=e.target.value;if((0,n.o)(t))this.value=void 0;else{if("browse"===t)return this.value=void 0,void this.rfxBrowseLayerClick({referenceElement:this.hostElement});if(-1!==t.indexOf("&layerName")){const e=await this._getSelectedLayer(this.getLayerNameAndUrlFromValue(t));void 0!==e&&(this.value=(0,h.e)(e))}else 1==this.allowScalar&&(this.value={type:"Scalar",value:t})}this.rfxArgumentChange.emit({value:this.value})}getLayerNameAndUrlFromValue(e){const t=e.split("&layerName=")[0];return{name:e.split("&layerName=")[1],url:t}}async _getSelectedLayer(e){const t=(0,h.g)(e.url);let i;if(void 0!==e.url&&void 0!==e.name&&(i=this.inputLayers.find((i=>i.url===t&&i.title===e.name))),i&&(await i.load(),(0,n.m)(i)))try{i.rasterInfo=await i.generateRasterInfo(i.rasterFunction)}catch(e){console.error(e)}return i}getFormattedValueFromVariable(){if(!(0,n.o)(this.argRFT)){const e=this.argRFT.function?.name;return`<${e}.${this.strings.outputRaster}>`}return this.mode===g.a.ANALYSIS?this.getDefaultPlaceHolder():`<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`}getDefaultPlaceHolder(){return this.allowScalar?this.strings.allowScalar:this.strings.selectLayer}getPlaceHolderText(){return(0,n.o)(this.rfxVariable)?this.getDefaultPlaceHolder():this.getFormattedValueFromVariable()}getValueString(e){return`${e.url}&layerName=${e.title??e.name}`}changeLoadingIconColor(){(0,p.o)(this.layerSelectorCombobox,["shadowRoot","children[0]","children[0]","children[0]","children[0]"],(e=>{e.classList.contains("placeholder-icon")?e.style.color="var(--calcite-color-brand)":e.style.color="var(--calcite-text-color)"}))}renderInputOptions(e){let t=[];return this.inputLayers&&Array.isArray(this.inputLayers)&&(t=this.inputLayers.map(((t,i)=>{const r=this.getValueString(t);if(void 0!==t?.url)return(0,a.h)("calcite-combobox-item",{key:`layer-item-${i}`,value:r,selected:r===e,textLabel:t.title,icon:"imagery"===t.type?"image-layer":"tiled-imagery-layer"})}))),0!==this.scalarValues?.length&&this.scalarValues.forEach((e=>{t.push((0,a.h)("calcite-combobox-item",{key:`layer-item-${this.inputLayers.length+1}`,value:e.value,textLabel:e.value,selected:!0}))})),t}render(){const e=(0,h.g)(this.value?.url),t=(0,n.o)(this.value)?this.value:"Scalar"===this.value?.type?this.value.value:this.getValueString({url:e,name:this.value?.name}),i=this.portal?.isPortal,r=this.portal?.sourceJSON?.helpBase||d.F.learnMoreDocBaseURL,o=(0,l.f)(r,this.locale);let c;if(!0===i){const e=d.F.learnMoreDocSupportAnalysisLayerEnterpriseHelpID,{restUrl:t}=this.portal;c=`${o}${(0,u.b)(e)}`,c=(0,l.a)(c,t)}else{const e=d.F.learnMoreDocSupportAnalysisLayerHelpID;c=(0,u.f)(o,e)}return(0,a.h)("div",{key:"2a51408a2d3418fe02e8fe06a69269f3c0a97846",class:`esriRFxRasterInput ${R.layerInput}`},(0,a.h)("calcite-combobox",{key:"3be417c4728341cba05dd26f3006f7e956c68216",label:"rfx-dte-raster-input-combobox",placeholder:!0===this.layerLoading?"":this.getPlaceHolderText(),selectionMode:"single",scale:s.U.Scale,disabled:void 0!==this.argRFT,allowCustomValues:this.allowScalar,value:t,onCalciteComboboxChange:e=>this._handleComboBoxChange(e),overlayPositioning:this.overlayPositioning,clearDisabled:!0,placeholderIcon:!0===this.layerLoading?"spinner":"",ref:this.applyStyleToCombobox,maxItems:this.mode===g.a.EDITOR?this.maxItems:0},(0,a.h)(a.F,{key:"da9c414a3865b11bcc6c019c63c343fe2e82e067"},(0,a.h)("calcite-notice",{key:"6404f16f360dcf4dbdd678a39142537e2072c30b",class:"layer-notice",scale:"s",open:this.showNoticeForNonAnalysisLayers,kind:"warning"},(0,a.h)("div",{key:"8c6df628888719048ca3a122b0dfff44630713af",slot:"message"},this.strings.layerMissing," ",(0,a.h)("calcite-link",{key:"40fccd92ad2bc1f51e8e1a4046d0e7ddf992915c",slot:"link",title:"learn more",href:c,rel:"help",target:"_blank"},this.strings.learnMore))),(0,a.h)("calcite-combobox-item",{class:"browse-layer",key:"layer-item-browse",value:"browse",textLabel:this.strings.browseLayer,icon:"search",filterDisabled:!0}),...this.renderInputOptions(t))),(0,a.h)("calcite-input-message",{key:"249014712421952c28d9cfdd0d92996dc0cbbc35",class:R.layerLoadFail,status:"invalid",scale:s.U.Scale,hidden:!1===this.layerLoadFailed,icon:"exclamationMarkTriangle"},this.strings.layerFailedToLoad),(0,a.h)("calcite-input-message",{key:"fea8c4ff7289461be2fec2a3c591f62f491ee7c9",class:R.layerValidation,status:"invalid",scale:s.U.Scale,hidden:!0===(0,n.o)(this.errorCode),icon:"exclamationMarkTriangle"},this.strings.errorCodes[this.errorCode]))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}static get watchers(){return{inputLayers:["onInputLayersChange"],rfxVariable:["onRFxVariableChange"]}}};E.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-raster-input__layer-input{text-align:start}.rfx-dte-raster-input__layer-load-fail{margin-top:0.5rem;color:var(--calcite-color-status-danger)}.rfx-dte-raster-input__layer-input-validation-msg{margin-top:0.5rem}.browse-layer{--calcite-color-text-1:var(--calcite-color-text-link);--calcite-color-text-3:var(--calcite-color-text-link)}.layer-notice{overflow:hidden;margin-bottom:0.5rem}";const F=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange",7),this.rfxFieldOptionsLoaded=(0,a.c)(this,"rfxFieldOptionsLoaded",7),this.handleFieldSelectChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})},this.layerArg=void 0,this.rasterInputVariable=void 0,this.otherOptions=void 0,this.value=void 0,this.options=void 0,this.fieldType=void 0,this.isInGrid=!1,this.inputLayers=void 0,this.mode=void 0,this.showDefaultFields=!0}onrasterInputVariableChange(){this.processLayerArg()}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.g)("."))),await this.processLayerArg(),this.processDefaultValue()}render(){return(0,a.h)("div",{key:"d8164e3fd99224c5ee82d59a11643e5bdeced697"},(0,a.h)("rfx-dtex-common-select",{key:"91289e7bcf9a6a90292083649f46d3009e86abd4",isInGrid:this.isInGrid,mode:this.mode,options:this.options,value:this.value,placeHolderText:this.strings.selectField,onRfxArgumentChange:this.handleFieldSelectChange}))}async getSelectedRasterLayer(e){e=(0,h.g)(e);const t=this.inputLayers.find((t=>t.url===e));if(t&&(await t.load(),(0,n.m)(t)))try{t.rasterInfo=await t.generateRasterInfo(t.rasterFunction)}catch(e){console.error(e)}return t}async processLayerArg(){if((0,n.o)(this.rasterInputVariable))if((0,n.o)(this.layerArg))this.setDefaultFieldOptions();else{const e=this.layerArg.input;e?(await this.updateFields(),e.addEventListener("rfxArgumentChange",(async()=>{await this.updateFields()}))):this.setDefaultFieldOptions()}else await this.updateFields();this.rfxFieldOptionsLoaded.emit()}async updateFields(){let e;if((0,n.o)(this.rasterInputVariable?.value)){if(!(0,n.o)(this.layerArg)){const t=this.layerArg.input;e="function"==typeof t.getSelectedLayer?await t.getSelectedLayer():void 0}}else e=await this.getSelectedRasterLayer(this.rasterInputVariable?.value?.url);if(e){if((0,n.j)(e))this.options=this.convertFieldsToOptions(e.fields),this.otherOptions&&this.addOtherOptions();else if((0,n.m)(e)||(0,n.n)(e))if(e.sourceJSON?.hasRasterAttributeTable){const t=(0,n.m)(e)?e.serviceRasterInfo.attributeTable:e.rasterInfo.attributeTable;(0,n.o)(t?.fields)?this.setDefaultFieldOptions():this.setFieldOptions(t.fields)}else this.setDefaultFieldOptions()}else this.setDefaultFieldOptions();this.processDefaultValue()}addOtherOptions(){const e=[],t=this.options,i=this.otherOptions;Object.keys(i).forEach((function(t){const a={key:t,label:i[t]};e.push(a)})),t&&t.length>0?(e.forEach((function(e){t.some((function(t){if(t.key===e.key)return!0}))||t.push(e)})),this.options=t):this.options=e}setFieldOptions(e){const t=["esriFieldTypeString"],i=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].concat(t),a=this.fieldType;if(e?.length>0){const r=(e=JSON.parse(JSON.stringify(e))).filter((e=>"list"===a?t.indexOf(e.type)>-1:i.indexOf(e.type)>-1));this.options=this.convertFieldsToOptions(r)}else this.setDefaultFieldOptions()}setDefaultFieldOptions(){!0===this.showDefaultFields&&(this.options=this.isInGrid?[{key:"VALUE",label:this.strings.value}]:[{key:"VALUE",label:this.strings.value},{key:"COUNT",label:this.strings.count}])}convertFieldsToOptions(e){const t=[];return e.map((e=>{t.push({key:e.name,label:e.alias})})),t}processDefaultValue(){(0,n.o)(this.options)||this.options?.length<1||(void 0!==this.value&&null!==this.value||(this.value=this.options[0].key),this.isInGrid||this.options.some((e=>e.key===this.value))||(this.value=this.options[0].key),(0,n.o)(this.rasterInputVariable)&&(0,n.o)(this.layerArg)||this.rfxArgumentChange.emit({value:this.value}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}static get watchers(){return{rasterInputVariable:["onrasterInputVariableChange"]}}},_="rfx-grid__grid-container",I="border",V="stacked",O=class{constructor(e){(0,a.r)(this,e),this.rfxGridOptionChange=(0,a.c)(this,"rfxGridOptionChange",7),this.rfxGridRowClick=(0,a.c)(this,"rfxGridRowClick",7),this.calciteComboboxClose=(0,a.c)(this,"calciteComboboxClose",7),this.gridChildElements=[],this.openDropdown=null,this.gridValueChange=e=>{e.stopImmediatePropagation();const t=e.type,i=e.target;let a,r,s;switch(t){case"calciteCheckboxChange":case"calciteSwitchChange":a=i.checked;break;default:a=i.value}if(i?.tagName===g.A.RFX_DTE_RASTER_INPUT){const e=(0,h.a)();e.value=(0,h.c)(a),r=e,s=i?.inputLayers,(0,n.o)(s)||(this.inputLayers=s)}const[o,l]=i.id.split("-");let c;this.gridOptions=this.gridOptions.map(((e,t)=>{if(e.id===Number.parseInt(l,10)){if(i.id.indexOf(o)>-1){this.gridLayout[o].uiType===g.G.select?e[o].value=r??a:e[o]=r??a}c=t}return e})),this.canAdd&&this.addRow(),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:c,columnName:o})},this.onRemoveClick=e=>{const t=e.target.id.split("-")[1],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.gridOptions=this.gridOptions.filter((e=>e.id!==Number.parseInt(t,10))),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:i}),0===this.gridOptions.length&&(this.gridOptions=[{id:this.gridOptions.length}])},this.onGridRowClick=e=>{e.stopPropagation();const t=e.currentTarget.id.split("_")[2],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.rfxGridRowClick.emit({gridOptions:this.gridOptions,rowIndex:i})},this.handleDropdownToggled=e=>{const t=e.type,i=e.target;let a;switch(a="RFX-DTEX-COMMON-SELECT"===i.tagName?i.shadowRoot?.children[0]?.children[0]:i.shadowRoot?.querySelector(".esriRFxRasterInput")?.children[0],t){case"calciteComboboxOpen":this.openDropdown?.id&&this.openDropdown?.id!==i.id&&this.openDropdown.dispatchEvent(this.calciteComboboxClose.emit()),this.openDropdown=i;break;case"calciteComboboxClose":this.openDropdown?.id===i.id&&((0,n.o)(a)||(a.open=!1),this.openDropdown=null)}},this.gridOptions=[],this.inputLayers=void 0,this.canAdd=!0,this.canRemove=!0,this.hasHeader=!0,this.isStacked=!1,this.gridLayout=void 0,this.hasIdColumn=!0,this.hasBorder=!1,this.rfxBrowseLayerClick=void 0,this.isEditable=!0}async checkValidity(){const e=[];let t;const i=this.gridChildElements.length,a=Object.keys(this.gridLayout).length;i>a&&!0===this.canAdd&&(t=this.gridChildElements.sort(((e,t)=>e.id-t.id)).slice(0,i-a));for(const i of t??this.gridChildElements){const t=i.element,a=i.required;if(t&&t.checkValidity){const i=await t.checkValidity({required:a});e.push(i)}}return Promise.resolve(e.every((e=>!0===e)))}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.g)("."))),this.gridOptions.forEach((e=>{e.uid=(0,o.g)("-element-")}))}adjustValueListItemIds(){this.gridOptions.forEach(((e,t)=>{e.id=t}))}isLastRowEmpty(e){return!Object.keys(this.gridLayout).some((t=>{const i=this.gridLayout[t].uiType===g.G.select?e[t].value:e[t];return!(0,n.o)(i)}))}addRow(){const e=this.gridOptions[this.gridOptions.length-1];if(!!this.isLastRowEmpty(e))return;this.adjustValueListItemIds();const t={id:this.gridOptions.length,uid:(0,o.g)("-element-")};for(const e in this.gridLayout)if(this.gridLayout.hasOwnProperty(e)){const i=this.gridLayout[e].uiType===g.G.select,a=this.gridOptions[0][e];i&&(t[e]={...a,value:void 0})}this.gridOptions.push(t)}renderGridRow(e,t){const i=Number.parseInt(t,10)+1,r=Object.keys(this.gridLayout).map((t=>{const i=this.gridLayout[t];switch(i.uiType){case g.G.textInput:return(0,a.h)("td",null,(0,a.h)("calcite-input-text",{class:i.style,scale:s.U.Scale,key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onCalciteInputTextChange:this.gridValueChange,title:e[t],ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.text:return(0,a.h)("td",{key:`${t}_${e.id}`,class:i.style},i.constValue||e[t]);case g.G.raster:return(0,a.h)("td",null,(0,a.h)("rfx-dte-raster-input",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,allowScalar:i.allowScalar,rfxVariable:e.rasterElement,value:e[t]?.value,overlayPositioning:s.a.fixed,onRfxArgumentChange:this.gridValueChange,rfxBrowseLayerClick:this.rfxBrowseLayerClick,onCalciteComboboxOpen:this.handleDropdownToggled,onCalciteComboboxClose:this.handleDropdownToggled,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required});(0,p.o)(t,["shadowRoot","children[0]","children[0]","children[0]"],(e=>{e.style.width="11rem"}))},portal:o.m.portal}));case g.G.number:const r=i.validationRule,l=`${t}Rule`,{min:c,max:d,numberType:h,excludeMaxValue:u,excludeMinValue:f,numberButtonType:m,required:y,defaultValue:v,initialValue:b}=r??e[l]??{};return i.isEditable=this.isEditable,(0,a.h)("td",null,(0,a.h)("rfx-dte-number-input",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],min:c,max:d,defaultValue:v,initialValue:b,numberType:h,numberButtonType:m??"none",excludeMaxValue:u,excludeMinValue:f,required:y,onRfxNumberInputChange:this.gridValueChange,title:e[t],isDisabled:!i.isEditable,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.boolean:return(0,a.h)("td",null,(0,a.h)("calcite-checkbox",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteCheckboxChange:this.gridValueChange,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.switch:return(0,a.h)("td",null,(0,a.h)("calcite-switch",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteSwitchChange:this.gridValueChange,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.field:return(0,a.h)("td",null,(0,a.h)("rfx-dtex-field-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,isInGrid:!0,rasterInputVariable:e.layer,value:e[t],onRfxArgumentChange:this.gridValueChange,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.color:return(0,a.h)("td",null,(0,a.h)("rfx-color-picker",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onRfxColorPickerValueChange:this.gridValueChange,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.select:return(0,a.h)("td",null,(0,a.h)("rfx-dtex-common-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,options:e[t].options,value:e[t].value,allowCustomValues:i.allowCustomValues,isInGrid:!0,onCalciteComboboxOpen:this.handleDropdownToggled,onCalciteComboboxClose:this.handleDropdownToggled,onRfxArgumentChange:this.gridValueChange,ref:t=>{(0,n.o)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case g.G.icon:return(0,a.h)("td",null,e[t]?(0,a.h)("calcite-icon",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,icon:i.icon,scale:s.C.s,textLabel:i.label}):null)}}));return!0===this.hasIdColumn&&r.unshift((0,a.h)("td",null,(0,a.h)("div",{key:`idColumn_${e.id}`},i))),!0===this.canRemove&&r.push((0,a.h)("td",null,(0,a.h)("calcite-icon",{id:`remove-${e.id}`,key:`remove-${e.id}`,scale:s.U.Scale,icon:"x",onClick:i===this.gridOptions.length?void 0:this.onRemoveClick}))),r}renderHeader(){return(0,a.h)("thead",null,(0,a.h)("tr",null,!0===this.hasIdColumn&&(0,a.h)("th",null,this.strings.id),Object.keys(this.gridLayout).map((e=>{const t=this.gridLayout[e];return(0,a.h)("th",{class:`${t.style}`},t.label)})),!0===this.canRemove&&(0,a.h)("th",null," ")))}renderGridOptions(){return this.gridChildElements=[],this.gridOptions.map(((e,t)=>(0,a.h)("tr",{id:`grid_row_${e.uid??e.id}`,key:`grid_row_${e.uid??e.id}`,onClick:t===this.gridOptions.length-1?void 0:this.onGridRowClick},this.renderGridRow(e,t))))}render(){return(0,a.h)(a.H,{key:"50b9d4707fb53e5e082bccea6005e13b127534e1"},(0,a.h)("table",{key:"0bd9836a475b41f30c983b6a1bbe2a09ec1992a2",class:`${_} ${this.hasBorder?I:""} ${this.isStacked?V:""}`},this.hasHeader&&this.renderHeader(),(0,a.h)("tbody",{key:"1a4dc8d06b94a567a1a6262fd67ad314537dde26"},...this.renderGridOptions())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};O.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-grid__grid-container{width:100%;border-collapse:collapse}.rfx-grid__grid-container div{box-sizing:border-box}.rfx-grid__grid-container body{width:100%;height:100%;margin:0;padding:0}.rfx-grid__grid-container td{padding:0.5em;text-align:center}.rfx-grid__grid-container th{background:var(--calcite-color-foreground-2);padding:0.5em;border:1px solid var(--calcite-color-foreground-3);text-align:center;font-weight:normal}.rfx-grid__grid-container.border td{border:1px solid var(--calcite-color-foreground-3)}.rfx-grid__grid-container.stacked td,.rfx-grid__grid-container.stacked th{text-align:inherit;display:block;width:auto}"},45709:(e,t,i)=>{i.d(t,{a:()=>c,f:()=>n,i:()=>s,p:()=>l,s:()=>o});var a=i(93210),r=i(40320);function s(e){return null!=e&&!1===Number.isNaN(e)&&!0===Number.isFinite(e)}function o(e,t){let i;if(null!==e){const a="string"==typeof e?Number.parseFloat(e):e;s(a)?i=a:s(t)&&(i=t)}return void 0===i?"":`${i}`}function l(e){if(!(0,r.o)(e))return Number.parseFloat(e)}function n(e,t=3){if(!(0,r.o)(e))return Number.parseFloat(e.toFixed(t))}function c(e,t){let i="";if(!(0,r.o)(e)&&!Number.isNaN(e)){const r=(0,a.g)().locale;i=Intl.NumberFormat(r,t).format(Number(e))}return i}},19562:(e,t,i)=>{i.d(t,{C:()=>r,U:()=>a,a:()=>s});const a={Scale:"s",PopoverTimer:60},r={s:"s",m:"m",l:"l"},s={absolute:"absolute",fixed:"fixed"}},28004:(e,t,i)=>{i.d(t,{D:()=>n,J:()=>h,a:()=>p,b:()=>C,c:()=>f,d:()=>m,e:()=>w,f:()=>x,g:()=>L,h:()=>y,i:()=>c,j:()=>d,k:()=>g,l:()=>l,m:()=>T,n:()=>R,o:()=>E,s:()=>k});var a=i(5294),r=(i(13661),i(18423),i(21255),i(35431),i(68708)),s=i(40320),o=(i(588),i(55448),i(2924),i(11840),i(52373),i(33752),i(440),i(66744),i(44345),i(10259));i(33355),i(23795),i(17902),i(56451),i(71802),i(32513),i(36596);const l=[38,39,40,41,42,43,47,54,55,58,66,67,68,69,70,71,72,73,74,75,93,94],n="distanceLegacy",c=({category:e})=>!![n].includes(e),d={local:"LocalFunction",gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},h={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},u={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},g={name:"Raster",isDataset:!0,isPublic:!1,type:h.RASTER_FUNCTION_VARIABLE};function p(e){return null==e?"":e.name||e.datasetName&&e.datasetName.name}function f(e){return e.hasOwnProperty("EsriClassifierDefinitionFile")}function m(e){return e.type&&e.type.toLowerCase().indexOf(h.RECORD_SET.toLowerCase())>=0}function y(e,t){const i=t&&t.value;if(null==i)return;let a;return e.some((e=>{if(e.values&&e.values.indexOf(i)>-1)return a=e.inputArgs,!0})),a}function v(e,t){let i;if(!(0,s.o)(e)&&(i=e.rasterFunctionArguments,1===Object.keys(i).length&&!e.hasArgumentsObject))return!0;const a=t.arguments,r=a&&a.type;return!(!r||r!==h.RASTER_FUNCTION_TEMPLATE&&r!==h.RASTER_FUNCTION_VARIABLE)||void 0}function b(e,t,i){if((0,s.o)(t)||(0,s.o)(i))return;const a=e?.rasterFunctionArguments;return(0,s.o)(a)?void 0:(0,o.l)(t,a)}function x(e,t,i,a){if((0,s.o)(t)&&(0,s.o)(a))return!1;const o=b(e,a=a||t.key,i);if(!(0,s.o)(o)&&o.dataType===r.d.rasterArray)return!0;if(!t)return;const l=t.value;if(l&&l.elements){return l.elements.some((e=>e&&(e.isDataset||e.type===h.RASTER_FUNCTION_TEMPLATE||e.value&&e.value.type===h.RASTER_FUNCTION_TEMPLATE)))}l&&Array.isArray(l)&&l.some((e=>e&&e.name&&e.url))}function C(e,t,i){t.value||(t.value={elements:[],type:h.ARGUMENT_ARRAY});let a=t.value&&t.value.elements?t.value.elements:t.value;return a&&Array.isArray(a)?void 0!==i?a[i]=e:(a.push(e),i=a.length-1):(a=[e],i=0),t.value&&t.value.elements?t.value.elements=a:t.value=a,i}function L(e,t,i){let a,r;if("string"==typeof t?a=t:(a=t.key,r=t.index),(0,s.o)(a)||(0,s.o)(i))return;const o=i.arguments,l=o&&o.type,n=a&&a.toLowerCase();let c;if(v(e,i))return l!==h.RASTER_FUNCTION_TEMPLATE&&!o.isDataset||"raster"!==n?l===h.RASTER_FUNCTION_VARIABLE&&"rasters"===n&&(c=void 0!==r?function(e,t){if((0,s.o)(t)||void 0===e)return;const i=t.value&&t.value.elements?t.value.elements:t.value;return i&&i.length?i[e]:void 0}(r,o):o):c=o,c;if(c=o[a],void 0!==r&&x(e,c,i,a)){const e=c.value&&c.value.elements?c.value.elements:c.value;c=e&&e.length?e[r]:void 0}return c}function w(e,t){if((0,s.o)(t))return;const i=[],r=t.arguments,o=r&&r.type;if(v(e,t)){let e,t=a.clone(r);return e=o===h.RASTER_FUNCTION_TEMPLATE||t.isDataset?"Raster":"Rasters",(0,s.o)(t)?t={key:e}:t.key=e,i.push(t),i}return Object.keys(r).forEach((e=>{if(e===u.MATCH_VARIABLE||e===u.UNION_DIMENSION)return;let t=a.clone(r[e]);(0,s.g)(t)&&((0,s.o)(t)?t={key:e}:t.key=e,i.push(t))})),i}function k(e,t,i,a,r){if((0,s.o)(t)||(0,s.o)(i)||(0,s.o)(a))return;const o=t.arguments,l=x(e,o,t,a)&&void 0!==r;if(v(e,t))l?r=C(i,o,r):t.arguments=i;else{const e=o[a];l?r=C(i,e,r):o[a]=i}return i.value&&"Scalar"===i.value.type&&(0,s.o)(i.name)&&(i.name=l?t.function.type.toLowerCase()===d.local.toLowerCase()&&r>0?`InRaster${r+1}`:`Raster${r>0?r+1:""}`:b(e,a,t).displayName||a),{key:a,index:r}}function T(e){return e.dataType===r.d.raster||e.dataType===r.d.rfxtemplate}function R(e){return e.dataType===r.d.scalar}const E=(e,t,i)=>{let a=e;!function e(r){if(r>=t.length)return void i(a);const s=t[r];let o;if("shadowRoot"===s)o=a?.shadowRoot;else if(s.startsWith("children[")){const e=parseInt(s.match(/\d+/)[0],10);o=a.children[e]}o?(a=o,e(r+1)):requestAnimationFrame((()=>e(r)))}(0)}}}]);