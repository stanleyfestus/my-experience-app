/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-ad0b4c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-ad0b4c"],{59907:(e,t,i)=>{i.r(t),i.d(t,{arcgis_popup:()=>z,arcgis_popup_arcade:()=>j,arcgis_popup_attachments:()=>J,arcgis_popup_attributes:()=>Y,arcgis_popup_chart:()=>he,arcgis_popup_expressions:()=>ue,arcgis_popup_field_pick_list:()=>me,arcgis_popup_image:()=>ye,arcgis_popup_main_contentpopover:()=>be,arcgis_popup_multimedia:()=>Ie,arcgis_popup_relationship:()=>Fe,arcgis_popup_richtext:()=>Le,arcgis_popup_title:()=>we});var s=i(20536),o=i(37568),a=i(74129),l=i(98072),n=i(98034),r=i(46227),p=i(23709),c=i(34752),d=i(15368),h=i(91616);i(91102),i(73807),i(99004),i(10699);const u="enable-popup",m="component-ul",g="summary-et",f="summary-et-label",v="summary-et-action",y="imagery-options",b="notice",P=(e,t)=>{var i,s;const o=null===(s=null===(i=null==e?void 0:e.shadowRoot)||void 0===i?void 0:i.querySelector("input"))||void 0===s?void 0:s.selectionStart;return C(o)?[e.value.slice(0,o),`{${t}}`,e.value.slice(o)].join(""):`${e.value}{${t}}`},C=e=>null!=e,k=async(e,t,i)=>{var s,o,l,n,r;const p=null===(o=null===(s=e.capabilities)||void 0===s?void 0:s.queryRelated)||void 0===o?void 0:o.supportsCount,c=null===(n=null===(l=e.capabilities)||void 0===l?void 0:l.queryRelated)||void 0===n?void 0:n.supportsPagination;if([a.s.feature,a.s.scene,a.s.mapImage,a.s.subtype].indexOf(i)>-1&&(null===(r=null==e?void 0:e.relationships)||void 0===r?void 0:r.length)&&p&&c)for(const i of e.relationships){const s=x(t);for(const t of s){const s=t;if("subtype-sublayer"!==s.type&&"subtype-group"!==s.type&&await F(e,s,i))return await s.load(),Promise.resolve(!0)}}return Promise.resolve(!1)};function I(e){return["feature","subtype-sublayer"].indexOf(e.type)&&e.url.toLocaleLowerCase().endsWith("/featureserver")?e.url.substring(0,e.url.length-14):["feature","map-image","sublayer"].indexOf(e.type)>-1&&e.url.toLocaleLowerCase().endsWith("/mapserver")?e.url.substring(0,e.url.length-10):["feature","map-image","sublayer"].indexOf(e.type)>-1&&e.url.toLocaleLowerCase().indexOf("/mapserver/")>-1?e.url.substring(0,e.url.toLocaleLowerCase().indexOf("/mapserver/")):"scene"===e.type&&e.url.toLocaleLowerCase().endsWith("/sceneserver")?e.url.substring(0,e.url.length-12):e.url}async function F(e,t,i){var s,o,a;const l=t.url?t.url===e.url||I(t)===I(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id);["feature","scene"].indexOf(t.type)>-1&&l&&"layerId"in t&&!C(t.layerId)&&await t.load();const n="sublayer"===t.type||"subtype-sublayer"===t.type;return Promise.resolve(["feature","scene","sublayer","subtype-sublayer"].indexOf(t.type)>-1&&l&&(!n&&t.layerId===i.relatedTableId||n&&t.id===i.relatedTableId))}function L(e,t,i){var s,o,a;const l=t.url?t.url===e.url||I(t)===I(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id),n="sublayer"===t.type||"subtype-sublayer"===t.type;return["feature","scene","sublayer","subtype-sublayer"].indexOf(t.type)>-1&&l&&(!n&&t.layerId===i.relatedTableId||n&&t.id===i.relatedTableId)}function x(e){let t=[...e.map.allLayers,...e.map.allTables];return t.forEach((e=>{if("map-image"===e.type){const i=e;t=t.concat([...i.sublayers])}})),t}var w,T,E;!function(e){e.attributes="attributes",e.attachments="attachments",e.charts="charts",e.images="images",e.richText="richText",e.summaryET="summaryET",e.arcade="arcade",e.relationship="relationship"}(w||(w={})),function(e){e.image="image",e.barChart="bar-chart",e.columnChart="column-chart",e.lineChart="line-chart",e.pieChart="pie-chart"}(T||(T={})),function(e){e.preview="preview",e.list="list",e.auto="auto"}(E||(E={}));const M=(e,t,i)=>e||(t===a.l.cluster?H(i):""),R=async(e,t,i,s,o)=>o===a.l.cluster?{id:"popup-feature-reduction",definitions:{$feature:{fields:(0,l.l)(s,!1)},$aggregatedFeatures:await A(t,e,s)}}:Object.assign(Object.assign(Object.assign({id:"popup"},(i===a.s.mapImage||i===a.s.scene||i===a.s.tile)&&{disabledVariables:["$layer","$map","$datastore"]}),(i===a.s.geojson||i===a.s.wfs||i===a.s.csv)&&{disabledVariables:["$datastore"]}),{definitions:{$feature:e,$layer:e,$map:t.map,$datastore:e}}),S=async(e,t,i,s)=>{var o;try{if("subtype-sublayer"!==e.type&&i===a.l.cluster)return{profileVariableInstances:{$feature:await(0,l.m)(t,e,s),$aggregatedFeatures:await A(t,e,s)},spatialReference:t.spatialReference,timeZone:t.timeZone};return{profileVariableInstances:{$feature:(await(0,l.n)(e,t)).features[0],$layer:e,$map:t.map,$datastore:"subtype-sublayer"===e.type?e.parent.url:e.url,$userInput:null===(o=t.extent)||void 0===o?void 0:o.center},spatialReference:t.spatialReference,timeZone:t.timeZone}}catch(e){console.log(e)}},D=(e,t,i)=>{let s;return"popupElement"===i&&(s=[{label:t.chartTemplate,code:U()},{label:t.fieldsListTemplate,code:B()},{label:t.richText,code:N()}]),"hasM"in e&&e.hasM&&(s=s||[],s.push({label:t.mValueTemplate,code:V()})),(null==s?void 0:s.length)?[{label:t.templates,suggestions:s}]:void 0},A=async(e,t,i)=>{const s=await e.whenLayerView(t),o=s.createQuery();return o.aggregateIds=[(await(0,l.m)(e,t,i)).getObjectId()],s.queryFeatures(o)},H=e=>`// ${e.clusterArcadeScriptLine3} \nExpects($aggregatedFeatures, "field1", "field2")\n`,O=(e,t)=>{const i=`// ${t.arcadeContentClusterScriptLine} \nExpects($aggregatedFeatures, "field1", "field2")\n\n`,s=`/* \n${t.arcadeContentScriptLine1} \n${t.arcadeContentScriptLine2} \nhttps://developers.arcgis.com/arcade/guide/profiles/#popup-element \n*/\n\n${N()}`;return e===a.l.cluster?i+s:s},N=()=>"return { \n\ttype : 'text', \n\ttext : 'place your text or html here' //this property supports html tags \n}",B=()=>"return {\n    type: 'fields',\n    //title: '',\n    //description : '',\n    fieldInfos:  [{\n          fieldName: \"att1\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att2\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att3\"  // fieldName should match the key in the attributes dictionary\n        }],\n    attributes : {att1 : 2, att2 : 3, att3 : 4}  // replace this dictionary with your own key-value pairs\n  }",U=()=>"return {\n    type: 'media',\n    // title : 'The title for all media in the element',\n    // description : '',\n    attributes : {att1 : 2, att2 : 3, att3 : 4},  // replace this dictionary with your own key-value pairs,\n    mediaInfos: [{\n        type : 'piechart', //linechart | barchart | piechart | columnchart\n        title : 'give your chart a title',\n        // caption : '',\n        altText : '', //altText will be read by screen readers\n        value : {\n          fields: [\"att1\", \"att2\", \"att3\"],  // choose what attributes to use in the chart\n          /* colors: [  // values must be an array of [r, g, b, a] values (0-255)\n            [122, 190, 229, 255],\n            [179, 155, 213, 255],\n            [248, 174, 131, 255]\n          ], */\n          //normalizeField : '',  // the name of the attribute to normalize by or value\n        }\n      }]\n  }",V=()=>"if (TypeOf($userInput) == \"Point\") {\n  var result = PointToCoordinate($feature, $userInput);\n  return Text(result.coordinate.m, '#,###.00');\n}",$=(e,t,i,s)=>{const o=t,a=new i;return a.expression=e.script,a.title=e.title,a.name=((e,t)=>{var i;if(t)return t;if(null===(i=e.expressionInfos)||void 0===i?void 0:i.length){const t=e.expressionInfos[e.expressionInfos.length-1].name.match(/\d+$/);return(null==t?void 0:t[0])?`expr${Number(t[0])+1}`:`expr${e.expressionInfos.length}`}return"expr0"})(s,o),a.returnType="number"===e.predictOutputType?"number":"string",s.expressionInfos?o?s.expressionInfos.find(((e,t)=>{e.name===o&&(s.expressionInfos[t]=a)})):s.expressionInfos.push(a):s.expressionInfos=[a],a},_=async(e,t,i,s)=>{t===a.l.cluster?(i.featureReduction.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=((e,t)=>{var i;const s=[];return e.fieldInfos.forEach((e=>{e.fieldName.includes(a.f.expression)||s.push(e)})),null===(i=e.expressionInfos)||void 0===i||i.forEach((async e=>{const i=new t;i.fieldName=`${a.f.expression}${e.name}`,i.visible=!1,s.push(i)})),s})(e,s)):(i.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=[...await(0,p.g)(i,e)])};const z=class{constructor(e){(0,s.r)(this,e),this.popupUpdated=(0,s.c)(this,"popupUpdated",7),this.bulkPopupUpdated=(0,s.c)(this,"bulkPopupUpdated",7),this.arcgisPopupDismissedChange=(0,s.c)(this,"arcgisPopupDismissedChange",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.resetMultiMediaIndex=(0,s.c)(this,"resetMultiMediaIndex",7),this.mainPopupReRender=(0,s.c)(this,"mainPopupReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.closeAttributePopovers=(0,s.c)(this,"closeAttributePopovers",7),this.attributesChangeNotification=(0,s.c)(this,"attributesChangeNotification",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.attributeData=[],this.fieldData=[],this.richTextElements=[],this.popupHasAttachment=!1,this.layerHasAttributes=!0,this.layerHasCharts=!0,this.layerHasImages=!0,this.layerHasText=!0,this.isPopupOpenForCurrentLayer=!1,this.relatedRecordsDefaultCount=1,this.guidList=[],this.debouncedPopupUpdates=(0,h.d)((e=>{var t;this.multiplePopupsSelected&&this.bulkPopupUpdated.emit(),this.disableEditing||(this.serviceType!==a.s.wms&&(e&&(null===(t=this.layer)||void 0===t?void 0:t.popupTemplate)||(this.layerDisplayType===a.l.feature?this.layer.popupEnabled===this.enableSwitchEl.checked&&(this.layer.popupTemplate=this.popupTemplate.clone()):this.layerDisplayType===a.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()))),this.popupUpdated.emit(this.layerDisplayType===a.l.mapNotes&&{mapNotesPopuptemplate:this.mapNotesPopupEnabled?this.popupTemplate.clone():null}),this.disableEditing=this.multiplePopupsSelected)}),1e3),this.manageExpressionBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit();let t=document.createElement("arcgis-popup-expressions");this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),t.addEventListener("arcgisPopupExpressionsBackClick",(()=>{var e;null===(e=t.parentElement)||void 0===e||e.removeChild(t),t=null})),setTimeout((()=>requestAnimationFrame((()=>t.setFocus()))),200)},this.popupTitleComponent=()=>(0,s.h)("arcgis-popup-title",{popupFlowItem:this.popupPanel}),this.fieldComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attributes",{guid:e,popupContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.attachmentComponent=(e,t,i)=>{var o,a,l;return(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attachments",{guid:e,attachmentContent:t,layerSupportsResizeAttachments:!!(null===(l=null===(a=null===(o=this.layer)||void 0===o?void 0:o.capabilities)||void 0===a?void 0:a.operations)||void 0===l?void 0:l.supportsResizeAttachments),popupFlowItem:this.popupPanel,blockOpen:i}))},this.richtextComponent=(e,t,i)=>{var o,a;const l=null===(o=this.popupTemplate.toJSON().fieldInfos)||void 0===o?void 0:o.map((({fieldName:e,label:t})=>({name:e,alias:t||e})));this.fieldData=l||[];const n=null===(a=this.popupTemplate)||void 0===a?void 0:a.toJSON().expressionInfos,r=null==n?void 0:n.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));return(null==r?void 0:r.length)&&(this.fieldData=this.fieldData.filter((e=>!r.some((t=>t.name===e.name))))),this.attributeData=r?[...r,...this.fieldData]:this.fieldData,(0,s.h)("div",{key:e,id:e,ref:e=>{e&&(this.richTextElements=[...this.richTextElements,e])}},(0,s.h)("arcgis-popup-richtext",{fieldExpressionData:{data:this.attributeData,placeholderText:this.strings.searchFields,heading:this.strings.selectField,label:this.strings.fieldsListPluginName,mapView:this.mapView,layer:this.layer},arcgisColorPickerData:{data:this.attributeData,filterPlaceholder:this.strings.searchAttributes,label:this.strings.colorPicker,doneText:this.strings.done,customText:this.strings.customText,attributeText:this.strings.attributeText},guid:e,richtextContent:t,popupFlowItem:this.popupPanel,blockOpen:i}))},this.multimediaComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-multimedia",{guid:e,multimediaContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.arcadeComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-arcade",{guid:e,arcadeContent:t,blockOpen:i})),this.relationshipComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-relationship",{guid:e,relatedRecordsContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.displayPopup=!0,this.config=void 0,this.layerDisplayType=a.l.feature,this.dismissible=!1,this.backButton=!1,this.hideLayerTitle=!1,this.showConfigureFields=!1,this.showManageExpressions=!0,this.disableEditing=!1,this.multiplePopupsSelected=!1,this.calciteFlowProps=null,this.mapNotesPopupTemplate=void 0,this.mapNotesGraphic=void 0,this.reRender=void 0,this.popupComponents=[],this.hasError=!1}async componentWillLoad(){var e,t,i,s,r,c;if((0,d.c)(d.p),[this.strings,this.currentLanguage,this.currentLanguageIntl]=await(0,o.g)(this.hostElement),this.serviceType=(0,l.d)(this.layer),await this.loadAllModules(),this.layer&&"load"in this.layer&&await this.layer.load(),this.supportsArcade=this.showManageExpressions&&(this.layerDisplayType===a.l.feature||this.layerDisplayType===a.l.cluster)&&this.serviceType!==a.s.ogcFeature&&this.serviceType!==a.s.imagery&&this.serviceType!==a.s.imageryTile,this.serviceType===a.s.tile&&"url"in this.layer&&!("type"in this.layer)&&this.layer.url.indexOf(this.layer.layer.url)>-1)this.hasError=!0,console.error("popups not supported, no related feature service");else if(this.serviceType!==a.s.wms)if(this.layerDisplayType===a.l.feature){const s="type"in this.layer?this.layer.type:"sublayer",o=this.mapView.popup.visible?null===(e=this.mapView.popup.selectedFeature)||void 0===e?void 0:e.sourceLayer:void 0;this.isPopupOpenForCurrentLayer="subtype-sublayer"===s?(null==o?void 0:o.subtypeCode)===this.layer.subtypeCode&&(null==o?void 0:o.parent.id)===this.layer.parent.id:"sublayer"===s?(null==o?void 0:o.id)===this.layer.id&&(null==o?void 0:o.layer.id)===this.layer.layer.id:"id"in this.layer&&(null==o?void 0:o.id)===this.layer.id,C(null===(i=null===(t=this.layer.capabilities)||void 0===t?void 0:t.data)||void 0===i?void 0:i.supportsAttachment)&&(this.layerHasAttachment=this.layer.capabilities.data.supportsAttachment),this.layerHasET=!!this.layer.editFieldsInfo,d.p.layerHasRelatedRecords=await k(this.layer,this.mapView,this.serviceType),this.serviceType!==a.s.mapImage||this.layer.popupTemplate||(this.layer.popupEnabled=!1),this.popupTemplate=this.layer.popupTemplate?this.layer.popupTemplate.clone():this.layer.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await(0,p.g)(this.layer,this.popupTemplate)]}else if(this.layerDisplayType===a.l.cluster)this.layerHasAttachment=!1,this.layerHasET=!1,this.popupTemplate=this.layer.featureReduction.popupTemplate.clone();else if(this.layerDisplayType===a.l.mapNotes){if(this.mapNotesPopupTemplate)this.mapNotesPopupEnabled=!0,this.popupTemplate=this.mapNotesPopupTemplate.clone();else{this.mapNotesPopupEnabled=!1;const[e]=await(0,n.l)(["esri/PopupTemplate"]);this.popupTemplate=new e}this.layerHasAttachment=!1,this.layerHasET=!1,this.layerHasAttributes=!1,this.layerHasCharts=!1}d.p.layer=this.layer,d.p.mapView=this.mapView,d.p.portal=this.portal,d.p.config=this.config,d.p.strings=this.strings,d.p.currentLanguage=this.currentLanguage,d.p.currentLanguageIntl=this.currentLanguageIntl,d.p.serviceType=this.serviceType,d.p.popupTemplate=this.popupTemplate,d.p.layerHasAttachment=this.layerHasAttachment,d.p.layerHasET=this.layerHasET,d.p.layerHasAttributes=this.layerHasAttributes,d.p.layerHasCharts=this.layerHasCharts,d.p.layerHasImages=this.layerHasImages,d.p.layerHasText=this.layerHasText,d.p.layerDisplayType=this.layerDisplayType,d.p.supportsArcade=this.supportsArcade,d.p.blockFeatureReductionArcade=function(){const{layer:e,mapView:t,layerDisplayType:i}=d.p;return i===a.l.cluster&&e.featureReduction.maxScale>=t.scale}(),this.layerDisplayType===a.l.cluster&&(this.featureReductionArcadeHandle=(r=this.layer,c=this.mapView,this.reactiveUtils.watch((()=>c.scale),(()=>{const e=r.featureReduction;c.scale<=e.maxScale&&!d.p.blockFeatureReductionArcade?d.p.blockFeatureReductionArcade=!0:c.scale>e.maxScale&&d.p.blockFeatureReductionArcade&&(d.p.blockFeatureReductionArcade=!1)})))),(null===(s=this.calciteFlowProps)||void 0===s?void 0:s.calciteFab)&&!this.getPopupEnabledProp()&&(this.calciteFlowProps.calciteFab.hidden=!0)}async componentDidLoad(){var e;if(this.popupTemplate){if("string"==typeof this.popupTemplate.content){const e=await(0,n.l)(["esri/popup/content/TextContent"]).then((([e])=>new e({text:this.popupTemplate.content})));this.popupTemplate.content=[e]}Array.isArray(this.popupTemplate.content)?this.popupTemplate.content.forEach(((e,t)=>{"attachments"!==e.type||this.layerHasAttachment?this.addToPopupComponents(e):this.popupTemplate.content.splice(t,1)})):console.error("content not supported"),this.reRender=!this.reRender}this.serviceType!==a.s.wms&&(this.layerDisplayType===a.l.feature&&this.watchForChangesToLayersList(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id"),this.calciteFab=(null===(e=this.calciteFlowProps)||void 0===e?void 0:e.calciteFab)||this.hostElement.shadowRoot.getElementById("addComponentBtn_Id"),this.setupResizeObserver(),this.calciteFab.onclick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.contentPopover||(this.contentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.contentPopover.contentPopoverRefElement=this.calciteFab,this.contentPopover.popupHasAttachment=this.popupHasAttachment,this.contentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,document.body.appendChild(this.contentPopover),this.calciteFab.disabled=!0,this.disablePopupPanel.emit(!0))}),requestAnimationFrame((()=>this.popupPanel.setFocus()))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e,t,i;null===(e=this.featureReductionArcadeHandle)||void 0===e||e.remove(),null===(t=this.parentShellObserver)||void 0===t||t.disconnect(),null===(i=this.watchLayersAndTables)||void 0===i||i.remove(),this.contentPopover&&document.body.removeChild(this.contentPopover)}async done(){var e;this.resetMultiMediaIndex.emit(),this.closePopupPopovers.emit(),null===(e=this.attributesComponent)||void 0===e||e.done(),this.showPreviewPopup(!1)}async setFocus(e){var t;null===(t=this.calciteFab)||void 0===t||t.setFocus()}async update(){this.internalPopupUpdated.emit()}calciteFlowItemBackHandler(e){e.stopPropagation(),this.closePopupPopovers.emit()}mainPopupReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}internalPopupUpdatedHandler(e){var t,i;e.stopPropagation(),this.singleFeature&&(null===(i=null===(t=this.mapView.popup)||void 0===t?void 0:t._flowItems)||void 0===i?void 0:i.length)&&(this.mapView.popup.features=void 0,setTimeout((()=>this.mapView.popup.features=[this.singleFeature]),1e3)),this.debouncedPopupUpdates(e.detail)}deleteComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){this.popupTemplate.content.splice(i,1),this.popupComponents.splice(i,1),this.guidList.splice(i,1);break}if(this.popupHasAttachment=this.popupTemplate.content.some((e=>{if("attachments"===e.type)return!0})),this.richTextElements){const t=this.richTextElements.filter((t=>t.id!==e.detail));this.richTextElements=t}this.mainPopupReRender.emit(),this.calciteFab.setFocus()}duplicateComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){const e=this.popupTemplate.content[i].clone();this.popupTemplate.content.push(e),this.addToPopupComponents(e,!0);break}}closePopupPopoversHandler(){this.contentPopover&&(document.body.removeChild(this.contentPopover),this.contentPopover=null,this.calciteFab.disabled=!1,requestAnimationFrame((()=>this.calciteFab.setFocus())),this.disablePopupPanel.emit(!1))}notifyAddContentSelectionHandler(e){e.stopPropagation(),this.closePopupPopovers.emit(),e.detail===w.summaryET?(this.popupTemplate.lastEditInfoEnabled=!0,this.mainPopupReRender.emit(),this.summaryETDiv.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.calciteFab.setFocus()):this.addPopupContents(e.detail)}disablePopupPanelHandler(e){var t;e.stopPropagation();((null===(t=this.calciteFlowProps)||void 0===t?void 0:t.calciteFlowItem)||this.popupPanel).disabled=e.detail}arcadeChangeNotificationHandler(){var e;if(this.richTextElements){const t=null===(e=this.popupTemplate)||void 0===e?void 0:e.toJSON().expressionInfos.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));this.attributeData=t?[...t,...this.fieldData]:this.fieldData,this.richTextElements.forEach((e=>{const t=e.firstChild;t.arcgisColorPickerData.data=this.attributeData,t.fieldExpressionData.data=this.attributeData}))}this.mainPopupReRender.emit()}async loadAllModules(){[this.LayerOptions,this.reactiveUtils]=await(0,n.l)(["esri/popup/LayerOptions","esri/core/reactiveUtils"])}watchForChangesToLayersList(){var e,t;this.layerDisplayType===a.l.feature&&[a.s.feature,a.s.mapImage].indexOf(this.serviceType)>-1&&(null===(t=null===(e=this.layer)||void 0===e?void 0:e.relationships)||void 0===t?void 0:t.length)&&(this.watchLayersAndTables=this.reactiveUtils.watch((()=>[this.mapView.map.allLayers.length,this.mapView.map.allTables.length]),(async()=>{d.p.layerHasRelatedRecords=await k(this.layer,this.mapView,this.serviceType)})))}enableDisablePopup(e){if(this.serviceType!==a.s.wms){this.hostElement.shadowRoot.getElementById("popupDiv_Id").style.display=e?"block":"none",this.calciteFab.style.display=e?"block":"none"}this.closePopupPopovers.emit()}getPopupEnabledProp(){switch(this.layerDisplayType){case a.l.feature:return(this.serviceType===a.s.wms||!!this.layer.popupTemplate)&&this.layer.popupEnabled;case a.l.cluster:return this.layer.featureReduction.popupEnabled;case a.l.mapNotes:return this.mapNotesPopupEnabled;default:return this.layer.popupEnabled}}reorder(e,t,i){const s=[...e];e.length=0,s.forEach(((s,o)=>{let a;i.forEach(((e,i)=>{t[o]===e&&(a=i)})),e[a]=s}))}addToPopupComponents(e,t=!1){const i=(0,r.g)();"fields"===e.type?(this.popupComponents=[...this.popupComponents,this.fieldComponent(i,e,t)],this.guidList=[...this.guidList,i]):"attachments"===e.type?(this.popupComponents=[...this.popupComponents,this.attachmentComponent(i,e,t)],this.popupHasAttachment=!0,this.guidList=[...this.guidList,i]):"media"===e.type?(this.popupComponents=[...this.popupComponents,this.multimediaComponent(i,e,t)],this.guidList=[...this.guidList,i]):"text"===e.type?(this.popupComponents=[...this.popupComponents,this.richtextComponent(i,e,t)],this.guidList=[...this.guidList,i]):"expression"===e.type?(this.popupComponents=[...this.popupComponents,this.arcadeComponent(i,e,t)],this.guidList=[...this.guidList,i]):"relationship"===e.type&&(this.popupComponents=[...this.popupComponents,this.relationshipComponent(i,e,t)],this.guidList=[...this.guidList,i])}async addPopupContents(e){const[t,i,s,o,l,r,p,c,d,h]=await(0,n.l)(["esri/popup/content/FieldsContent","esri/popup/content/AttachmentsContent","esri/popup/content/TextContent","esri/popup/content/MediaContent","esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue","esri/popup/content/ExpressionContent","esri/popup/content/RelationshipContent"]);let u=null;if(e===w.attributes)u=new t({fieldInfos:null});else if(e===w.attachments)u=new i({displayType:null});else if(e===w.richText)u=new s({text:null});else if(e===w.images){u=new o({mediaInfos:[new l({title:"",caption:"",altText:"",value:new p({sourceURL:"",linkURL:""})})]})}else if(e===w.charts){u=new o({mediaInfos:[new r({title:"",caption:"",altText:"",value:new c({fields:[]})})]})}else if(e===w.arcade)u=new d({expressionInfo:{expression:O(this.layerDisplayType,this.strings)}});else if(e===w.relationship){const e=await(async(e,t,i)=>{var s;if([a.s.feature,a.s.scene,a.s.mapImage,a.s.subtype].indexOf(i)>-1&&(null===(s=null==e?void 0:e.relationships)||void 0===s?void 0:s.length))for(const i of e.relationships){const s=x(t);for(const t of s){const s=t;if("subtype-sublayer"!==s.type&&"subtype-group"!==s.type&&await F(e,s,i))return await s.load(),{relationship:i,currLayer:s}}}})(this.layer,this.mapView,this.serviceType);let t=e.currLayer.fields.find((e=>e.visible&&"date"===e.type));t||(t=e.currLayer.fields.find((e=>e.visible))),u=new h({displayCount:this.relatedRecordsDefaultCount,relationshipId:e.relationship.id,orderByFields:[{field:t.name,order:"asc"}]})}this.popupTemplate.content.push(u),this.addToPopupComponents(u,!0)}async showPreviewPopup(e){var t,i,s;this.displayPopup&&this.layerDisplayType===a.l.feature&&!this.isPopupOpenForCurrentLayer?e&&this.layer.popupEnabled&&this.layer.popupTemplate?((null===(i=null===(t=this.mapView.popup)||void 0===t?void 0:t.features)||void 0===i?void 0:i.length)&&(this.mapView.closePopup(),this.mapView.popup.features=void 0),this.previewPopupController=new AbortController,this.singleFeature=await(0,p.p)(this.mapView,this.layer,this.previewPopupController)):(null===(s=this.previewPopupController)||void 0===s||s.abort(),this.mapView.closePopup()):this.layerDisplayType===a.l.mapNotes&&(e&&this.mapNotesGraphic?this.mapView.openPopup({features:[this.mapNotesGraphic],location:(0,l.o)(this.mapNotesGraphic.geometry)}):this.mapView.closePopup())}setupResizeObserver(){var e;const t=null===(e=this.hostElement)||void 0===e?void 0:e.parentElement;if("CALCITE-SHELL-PANEL"===(null==t?void 0:t.tagName)){const e=t;C(e.collapsed)&&(this.parentShellObserver=new ResizeObserver((()=>{e.collapsed?this.done():this.showPreviewPopup(!0)})),this.parentShellObserver.observe(e))}else this.showPreviewPopup(!0)}createLayerOptions(){var e,t;const i=this.popupTemplate.layerOptions||new this.LayerOptions;i.showNoDataRecords=null!==(e=i.showNoDataRecords)&&void 0!==e&&e,i.returnTopmostRaster=null===(t=i.returnTopmostRaster)||void 0===t||t,this.popupTemplate.layerOptions=i}render(){var e,t,i,o,n,r;if(this.hasError)return this.renderPopupError();const p=(0,s.h)("calcite-label",{class:u,alignment:"start",layout:"inline-space-between"},this.strings.enablePopup,(0,s.h)("calcite-switch",{scale:"s",checked:this.getPopupEnabledProp(),ref:e=>this.enableSwitchEl=e,onCalciteSwitchChange:e=>{const t=e.target.checked;switch(this.layerDisplayType){case a.l.feature:this.layer.popupEnabled=t;break;case a.l.cluster:this.layer.featureReduction.popupEnabled=t;break;case a.l.mapNotes:this.mapNotesPopupEnabled=t;break;default:this.layer.popupEnabled=t}this.enableDisablePopup(t),this.internalPopupUpdated.emit(!0),this.layerDisplayType!==a.l.mapNotes&&t&&!this.layer.popupTemplate&&(this.layer.popupTemplate=this.popupTemplate),this.showPreviewPopup(t)}})),h=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,c.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.manageExpressions,width:"full",onClick:this.manageExpressionBtnClick},this.strings.manageExpressions),b=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.ignoreNoData,(0,s.h)("calcite-switch",{scale:"s",checked:!(null!==(i=null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.layerOptions)||void 0===t?void 0:t.showNoDataRecords)&&void 0!==i&&i),onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.showNoDataRecords=!i,this.internalPopupUpdated.emit()}})),P=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.displayTopmost,(0,s.h)("calcite-switch",{scale:"s",checked:null===(r=null===(n=null===(o=this.popupTemplate)||void 0===o?void 0:o.layerOptions)||void 0===n?void 0:n.returnTopmostRaster)||void 0===r||r,onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.returnTopmostRaster=i,this.internalPopupUpdated.emit()}})),C=(0,s.h)("section",{class:g},(0,s.h)("calcite-icon",{scale:"m",icon:"user"}),(0,s.h)("label",{class:f},this.strings.summaryETHeading),(0,s.h)("calcite-action",{text:this.strings.remove,appearance:"transparent",icon:"x",class:v,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupTemplate.lastEditInfoEnabled=!1,this.mainPopupReRender.emit(),this.calciteFab.setFocus()}})),k=(0,s.h)("calcite-fab",{hidden:!this.getPopupEnabledProp(),id:"addComponentBtn_Id",icon:"plus",slot:"fab",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addContent,text:this.strings.addContent,"text-enabled":!0}),I=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,c.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.configureFields,width:"full",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit();const t=document.createElement("calcite-flow-item");t.heading=this.strings.attributes,t.description=this.hideLayerTitle?void 0:this.layer.title,this.attributesComponent=document.createElement("arcgis-attributes"),this.attributesComponent.lang=this.currentLanguage,this.attributesComponent.layer=this.layer,this.attributesComponent.mapView=this.mapView,this.attributesComponent.portal=this.portal,this.attributesComponent.layerDisplayType=this.layerDisplayType,this.attributesComponent.config=this.config,this.attributesComponent.calciteFlowProps=!0,this.attributesComponent.displayPopup=!1,this.attributesComponent.addEventListener("attributesUpdated",(async e=>{e.stopPropagation(),this.popupTemplate=this.layer.popupTemplate.clone(),d.p.popupTemplate=this.popupTemplate,this.attributesChangeNotification.emit(),this.mainPopupReRender.emit()})),t.appendChild(this.attributesComponent),t.beforeBack=async()=>{this.closeAttributePopovers.emit()},this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),setTimeout((()=>requestAnimationFrame((()=>t.setFocus()))),200)}},this.strings.configureFields),F=()=>{var e,t,i;const o=this.layer,a=!!(null===(t=null===(e=o.capabilities)||void 0===e?void 0:e.operations)||void 0===t?void 0:t.supportsQuery)&&(null===(i=o.fields)||void 0===i?void 0:i.length),n=o.hasMultidimensions;return(0,s.h)("div",{class:y},b,(0,l.p)(o)>=10.8&&(a||n)&&P)},L=(0,s.h)("div",null,p,(0,s.h)("div",{id:"popupDiv_Id",hidden:!this.getPopupEnabledProp()},(()=>{const e=this.showConfigureFields,t=this.serviceType===a.s.imagery;if(e||this.supportsArcade||t)return(0,s.h)("calcite-block",{heading:this.strings.options,open:!0,collapsible:!0},t&&F(),this.supportsArcade&&h,e&&I)})(),this.popupTitleComponent(),(0,s.h)("div",{class:m},(0,s.h)("calcite-sortable-list",{id:"SortableComponents_Id",class:"sortable-list",onCalciteListOrderChange:e=>{e.stopPropagation(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id");const t=[],i=this.sortableComponents.getElementsByTagName("div");for(let e=0;e<i.length;e++)t.push(i[e].id);this.reorder(this.popupTemplate.content,this.guidList,t),this.reorder(this.popupComponents,this.guidList,t),this.guidList=t,this.internalPopupUpdated.emit()}},this.popupComponents)),(0,s.h)("div",{ref:e=>this.summaryETDiv=e},this.layerHasET&&this.popupTemplate.lastEditInfoEnabled&&C))),x=(0,s.h)("calcite-action",{text:this.strings.back,scale:"s",slot:"header-actions-start",ref:e=>this.backButtonEl=e,onClick:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},(0,s.h)("calcite-icon",{icon:"rtl"===(0,c.g)(this.hostElement)?"chevron-right":"chevron-left"}));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,c.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},this.serviceType===a.s.wms?p:L):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,c.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.popupPanel.closed=!0,this.done(),this.arcgisPopupDismissedChange.emit(),setTimeout((()=>this.popupPanel.closed=!1),300)}},this.serviceType===a.s.wms?p:L,this.serviceType!==a.s.wms&&k,this.backButton&&x)))}renderPopupError(){const e=(0,s.h)("div",{class:b},(0,s.h)("calcite-notice",{open:!0,closable:!1,icon:"exclamation-mark-triangle",scale:"s"},(0,s.h)("div",{slot:"message"}," ",this.strings.popupTileError)));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,c.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},e):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,c.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.popupPanel.closed=!0,this.done(),this.arcgisPopupDismissedChange.emit(),setTimeout((()=>this.popupPanel.closed=!1),300)}},e)))}get hostElement(){return(0,s.d)(this)}};z.style=".enable-popup{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-cap-spacing-half) var(--arcgis-app-cap-spacing-quarter);border-bottom:solid 1px var(--arcgis-app-border)}.component-ul{margin:0 0 var(--arcgis-app-cap-spacing);padding:0}.summary-et{display:flex;align-items:center;padding:0% var(--arcgis-app-cap-spacing-three-quarters)}.summary-et-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden;padding:0% var(--arcgis-app-cap-spacing-half);font-size:medium}.summary-et-action{margin:0;flex:0 0 0%;justify-self:flex-end}.notice{margin:0.5rem}.imagery-options{padding:0 var(--arcgis-app-cap-spacing-three-quarters)}.sortable-list{display:block}";const j=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.guid=void 0,this.arcadeContent=void 0,this.blockOpen=!1,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),await this.launchArcade())}async launchArcade(){var e,t,i;this.arcadeEditor||(this.disablePopupPanel.emit(!0),this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=M(null===(e=this.arcadeContent.expressionInfo)||void 0===e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await R(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await S(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.suggestions=D(this.layer,this.strings,"popupElement"),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null===(t=this.arcadeContent.expressionInfo)||void 0===t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.returnPredictOutputType=!1,this.arcadeEditor.arcadeTitleEditingEnabled=!(null===(i=this.arcadeContent.expressionInfo)||void 0===i?void 0:i.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>this.arcadeSetup(e.detail))))}async arcadeSetup(e){e&&(this.arcadeContent.expressionInfo.expression=e.script,this.arcadeContent.expressionInfo.title=e.title,this.reRender=!this.reRender,this.internalPopupUpdated.emit()),this.disablePopupPanel.emit(!1),document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}render(){return(0,s.h)(s.H,{key:"afc7592f6770af222a9dce0757bdf4d2910914d7"},(0,s.h)("calcite-block",{key:"bdaa804b7f68baf0d0d25b5cb0c5e860d35065dc",dir:(0,c.g)(this.hostElement),heading:this.strings.arcade,description:this.arcadeContent.expressionInfo.title,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"28dc6f8c89b629b2183af7ebf22c30b9bef74545",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"2cfd42c2b6141630f10a5a062d511f4cb6597145",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0,disableDuplicate:d.p.blockFeatureReductionArcade}})),(0,s.h)("div",{key:"4a4c22d5c1fb002ebe22b450e9f4de7544dd99a4",slot:"icon"},(0,s.h)("calcite-icon",{key:"b6c6ef037fcf0b899ec348a1abee8a54d6c88cd3",scale:"m",icon:"code"})),(0,s.h)("div",{key:"540d154396a18007a2e0849c9ec13bdf5067294c",class:"ignore-elements-sortable"},(0,s.h)("calcite-button",{key:"480ff6c989a9f40d7aaca40ce32b3ac102f7c590",disabled:d.p.blockFeatureReductionArcade,appearance:"transparent",width:"full",onClick:async()=>await this.launchArcade()},this.strings.editExpression))))}get hostElement(){return(0,s.d)(this)}},W="list-warning-div",q="list-warning-icon",G="list-warning-label",K="list-warning-text",Z="form-input-button",J=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.formInput=(e,t,i,o,a)=>{var l;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:Z},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.attachmentContent.title=i:this.attachmentContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(l=this.popupTemplate.fieldInfos)||void 0===l?void 0:l.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.attachmentContent=void 0,this.layerSupportsResizeAttachments=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerSupportsResizeAttachments?this.attachmentContent.displayType||(this.attachmentContent.displayType=E.auto,this.internalPopupUpdated.emit()):this.attachmentContent.displayType=E.list,this.attachmentContent.title||(this.attachmentContent.title=""),this.attachmentContent.description||(this.attachmentContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=P(this.contentTitle,i),this.contentTitle.setFocus(),this.attachmentContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=P(this.contentDescription,i),this.contentDescription.setFocus(),this.attachmentContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}render(){const e=(0,s.h)("calcite-label",null,this.strings.displayAttachmentsAs,(0,s.h)("calcite-segmented-control",{width:"full",scale:"s",disabled:!this.layerSupportsResizeAttachments,onCalciteSegmentedControlChange:e=>{const t=e.target.selectedItem;this.attachmentContent.displayType=t.value,this.reRender=!this.reRender}},(0,s.h)("calcite-segmented-control-item",{value:E.auto,iconStart:"check",checked:this.attachmentContent.displayType===E.auto},this.strings.auto),(0,s.h)("calcite-segmented-control-item",{value:E.list,iconStart:"list",checked:this.attachmentContent.displayType===E.list},this.strings.list),(0,s.h)("calcite-segmented-control-item",{value:E.preview,iconStart:"image",checked:this.attachmentContent.displayType===E.preview},this.strings.gallery)),(0,s.h)("calcite-label",{scale:"s"},(()=>{switch(this.attachmentContent.displayType){case E.auto:return this.strings.autoDisplayMessage;case E.list:return this.strings.listDisplayMessage;case E.preview:return this.strings.previewDisplayMessage;default:return this.strings.listDisplayMessage}})())),t=(0,s.h)("div",{class:W},(0,s.h)("label",{class:G},(0,s.h)("span",{class:q},(0,s.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-triangle"})),(0,s.h)("span",{class:K},this.strings.layerOnlySupportsListView)));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,c.g)(this.hostElement),heading:this.strings.attachments,description:this.attachmentContent.title&&`${this.attachmentContent.title.substring(0,25)}${this.attachmentContent.title.length>25?"...":""}`||(()=>{switch(this.attachmentContent.displayType){case E.auto:return this.strings.auto;case E.list:return this.strings.list;case E.preview:return this.strings.gallery;default:return this.strings.list}})(),collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,calciteBlockOptions:{hasDelete:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"attachment"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.attachmentContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.attachmentContent.description,this.strings.enterDescription),e,this.layerSupportsResizeAttachments?null:t)))}get hostElement(){return(0,s.d)(this)}};J.style=".list-warning-div{background-color:var(--arcgis-app-background)}.list-warning-label{align-items:stretch;background-color:var(--arcgis-app-background);border-radius:var(--arcgis-app-border-radius);border:1px solid var(--arcgis-app-border);display:flex;font-size:var(--arcgis-app-font-size--2)}.list-warning-icon{align-items:center;background-color:var(--arcgis-app-background-content);display:flex;padding:0 var(--arcgis-app-side-spacing-half)}.list-warning-text{padding:var(--arcgis-app-cap-spacing-quarter) var(--arcgis-app-side-spacing-half)}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const Q="manage-btn",X="form-input-button",Y=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.arcadeExpMap=new Map,this.manageBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldManagePickList.selectedFields=this.getSelectedFields(),this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.disablePopupPanel.emit(!0))},this.popupFieldManagePickListChanges=e=>{var t;e.stopPropagation();const i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields,s=[];this.setupFieldMapInfo(),i.forEach((e=>{var t;if(this.fieldInfoMap.has(e)){const i=null===(t=this.fieldInfoMap.get(e))||void 0===t?void 0:t.clone();i.visible=!0,s.push(i)}})),this.popupContent.fieldInfos=[...s],this.reRender=!this.reRender},this.calcitePickList=e=>(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,l.c)(e,this.arcadeExpMap),value:e.fieldName},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>this.removeBtnClick(e.fieldName)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.formInput=(e,t,i,o,a)=>{var l;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:X},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.popupContent.title=i:this.popupContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(l=this.popupTemplate.fieldInfos)||void 0===l?void 0:l.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.popupContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.popupContent.fieldInfos||(this.popupContent.fieldInfos=await this.getFieldsContent()),this.popupContent.title||(this.popupContent.title=""),this.popupContent.description||(this.popupContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus(),this.internalPopupUpdated.emit())}componentWillRender(){this.arcadeExpMap=(0,l.f)(this.popupTemplate),this.setupFieldMapInfo(),this.pickList=[],this.popupContent.fieldInfos.forEach((e=>{this.pickList.push(this.calcitePickList(e))}))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}arcadeChangeNotificationHandler(){this.reRender=!this.reRender}async attributesChangeNotificationHandler(){this.popupContent.fieldInfos.forEach(((e,t)=>{this.fieldInfoMap.has(e.fieldName)&&(this.popupContent.fieldInfos[t]=this.fieldInfoMap.get(e.fieldName).clone(),this.popupContent.fieldInfos[t].visible=!0)})),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null,this.blockOptions.setFocus(),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}async getFieldsContent(){var e,t;let i=[];if(this.checkForCreateFieldsContent()){const[s]=await(0,n.l)(["esri/support/popupUtils"]),o=null===(t=s.createFieldsContent({fields:await(0,l.k)(this.layer),objectIdField:this.layer.objectIdField,editFieldsInfo:(null===(e=this.layer)||void 0===e?void 0:e.editFieldsInfo)||null}))||void 0===t?void 0:t.fieldInfos;!this.fieldInfoMap&&this.setupFieldMapInfo(),o.forEach((e=>{if(this.fieldInfoMap.has(e.fieldName)){const t=this.fieldInfoMap.get(e.fieldName);i.push(t.clone()),i[i.length-1].visible=!0}})),this.popupTemplate.fieldInfos.forEach((e=>{(e.fieldName.includes(a.f.expression)||e.fieldName.includes(a.f.relationship))&&e.visible&&i.push(e.clone())}))}else this.popupTemplate.fieldInfos.forEach((e=>{e.visible&&i.push(e.clone())}));return i}checkForCreateFieldsContent(){var e,t,i;return this.layerDisplayType===a.l.feature&&("fields"!==(null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.content[0])||void 0===t?void 0:t.type)||!!(null===(i=this.popupTemplate.content[0])||void 0===i?void 0:i.fieldInfos))}removeBtnClick(e){this.closePopupPopovers.emit(),this.popupContent.fieldInfos.find(((t,i)=>{if(t.fieldName===e)return this.popupContent.fieldInfos.splice(i,1)})),this.reRender=!this.reRender}getSelectedFields(){const e=[];return this.popupContent.fieldInfos.forEach((t=>{e.push(t.fieldName)})),e}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=P(this.contentTitle,i),this.contentTitle.setFocus(),this.popupContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=P(this.contentDescription,i),this.contentDescription.setFocus(),this.popupContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}setupFieldMapInfo(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])))}render(){return(0,s.h)(s.H,{key:"4be67bfee51063c1d36c383cf92e568af86968bb"},(0,s.h)("calcite-block",{key:"5830ed5aeaebfe9e11bba56eed56d329f437e2dd",dir:(0,c.g)(this.hostElement),heading:this.strings.fieldsList,description:this.popupContent.title&&`${this.popupContent.title.substring(0,25)}${this.popupContent.title.length>25?"...":""}`||`${this.popupContent.fieldInfos.length}/${this.popupTemplate.fieldInfos.length} ${this.strings.attributes_L}`,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"212ff6c01e6d03d76e1d97e855ecc0dca7e63641",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"7646c4cec4a6e5be0cab7597f5d55d1f84b6e800",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"13f895ed8cb9cf6542f806e3ae7362f533890ad0",slot:"icon"},(0,s.h)("calcite-icon",{key:"501afe8dd7adbbe437c55abc78556d751712caa3",scale:"m",icon:"feature-details"})),(0,s.h)("div",{key:"6abbf75467f7be7e1104b946b353482479aa875f",class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.popupContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.popupContent.description,this.strings.enterDescription),(0,s.h)("calcite-button",{key:"b32d83ee8281284efe8ccd013012b4338d8d0200",class:Q,appearance:"transparent",scale:"m",width:"full",id:"openManageAttributes_Id",onClick:this.manageBtnClick},this.strings.selectAttributes),(0,s.h)("calcite-list",{key:"354fc989b54716e4ec62edf71b78d6ce563b7381","drag-enabled":!0,onCalciteListOrderChange:e=>{const t=e.target,i=[];t.childNodes.forEach((e=>{this.popupContent.fieldInfos.find((t=>{if(t.fieldName===e.value)return i.push(t)}))})),this.popupContent.fieldInfos=i,this.internalPopupUpdated.emit()}},this.pickList))))}get hostElement(){return(0,s.d)(this)}};Y.style=".manage-btn{justify-content:flex-end;margin:4px 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const ee="manage-btn",te="enable-column",ie="enable-column-label",se="column-switch",oe="normalize-block",ae="normalize-content-btn-section",le="normalize-content-btn",ne="normalize-content-btn-text",re="normalize-content-btn-icon",pe="popover-chart-div",ce="form-input-button",de="chart-group",he=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.chartChangedReRender=(0,s.c)(this,"chartChangedReRender",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.lastColors={},this.pickList=[],this.arcadeExpMap=new Map,this.colorNodes=[],this.popupFieldManagePickListChanges=e=>{var t,i,o,a,l,n,r,p,c,d;const{esriLang:h,esriColor:u,rendererColors:m}=this;e.stopPropagation();const g=this.chartMediaInfo.value.fields,f=e.detail.selectedFields;if(this.chartMediaInfo.value.fields=f,this.chartMediaInfo.type===T.lineChart){if((null===(t=this.chartMediaInfo.value.fields)||void 0===t?void 0:t.length)&&!(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)){const e=this.getDefaultColorScheme();this.colors=[e.colors[0]],this.chartMediaInfo.value.colors=h.clone(this.colors),(0,s.f)(this.hostElement)}else!(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)&&(null===(a=this.chartMediaInfo.value.colors)||void 0===a?void 0:a.length)&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement));if(null===(l=this.lastColors.rampColors)||void 0===l?void 0:l.length){const e=this.getDefaultColorScheme();this.lastColors.rampColors=null===(n=this.chartMediaInfo)||void 0===n?void 0:n.value.fields.map(((t,i)=>{var s;const o=g.indexOf(t);return o>-1&&(null===(s=this.lastColors.rampColors)||void 0===s?void 0:s[o])||new u(e.colors[i%10])||new u([0,0,0,1])}))}}else if(null===(r=this.chartMediaInfo.value.fields)||void 0===r?void 0:r.length){const e=this.getDefaultColorScheme();this.colors=null===(p=this.chartMediaInfo)||void 0===p?void 0:p.value.fields.map(((t,i)=>{var s;const o=g.indexOf(t);return o>-1&&(null===(s=this.colors)||void 0===s?void 0:s[o])||((null==m?void 0:m.get(t))?h.clone(m.get(t)[0]):new u(e.colors[i%10])||new u([0,0,0,1]))})),(null===(c=this.chartMediaInfo.value.colors)||void 0===c?void 0:c.length)?this.chartMediaInfo.value.colors=h.clone(this.colors):(this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),(null==g?void 0:g.length)?this.colorButtonNode&&(0,s.f)(this.colorButtonNode):(0,s.f)(this.hostElement)}else this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement);this.chartChangedReRender.emit(),(null==g?void 0:g.length)&&(null===(d=this.chartMediaInfo.value.fields)||void 0===d?void 0:d.length)||(0,s.f)(this.hostElement)},this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.chartMediaInfo.value.normalizeField=s,this.chartChangedReRender.emit()),this.closePopupPopovers.emit(this.guid),this.normalizeBtn.focus()},this.popupFieldSelectionPickListChanges=(e,t)=>{const i=e.detail.selectedFields[0];"title"===t?(this.editChartTitle.value=P(this.editChartTitle,i),this.chartMediaInfo.title=this.editChartTitle.value,this.editChartTitle.setFocus()):"caption"===t?(this.editChartCaption.value=P(this.editChartCaption,i),this.chartMediaInfo.caption=this.editChartCaption.value,this.editChartCaption.setFocus()):"altText"===t&&(this.editAltText.value=P(this.editAltText,i),this.chartMediaInfo.altText=this.editAltText.value,this.editAltText.setFocus()),this.closePopupPopovers.emit(this.guid),this.chartChangedReRender.emit()},this.chartFormInput=e=>{var t;return(0,s.h)("calcite-label",{scale:"s"},(()=>"title"===e?this.strings.title:"caption"===e?this.strings.caption:"altText"===e?this.strings.description:void 0)(),(0,s.h)("div",{class:ce},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:t=>(t.addEventListener("calciteInputChange",(t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.chartMediaInfo.title=i:"caption"===e?this.chartMediaInfo.caption=i:"altText"===e&&(this.chartMediaInfo.altText=i),this.chartChangedReRender.emit()})),"title"===e?this.editChartTitle=t:"caption"===e?this.editChartCaption=t:"altText"===e?this.editAltText=t:void 0),value:(()=>"title"===e?this.chartMediaInfo.title:"caption"===e?this.chartMediaInfo.caption:"altText"===e?this.chartMediaInfo.altText:void 0)(),placeholder:(()=>"title"===e?this.strings.imageTitlePlaceHolder:"caption"===e?this.strings.imageCaptionPlaceHolder:"altText"===e?this.strings.describeChart:void 0)(),onClick:()=>this.closePopupPopovers.emit(this.guid)}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,"text-display":"hidden",onClick:()=>{var t;this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},scale:"s",icon:"brackets-curly"})))},this.calcitePickList=(e,t)=>(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,l.c)(e,this.arcadeExpMap),value:e.fieldName},this.renderColorIcon(t),(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>{var t,i,o;this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)?this.chartMediaInfo.value.fields.forEach(((t,i)=>{var o;t===e.fieldName&&(this.chartMediaInfo.value.fields.splice(i,1),this.chartMediaInfo.type!==T.lineChart&&(this.chartMediaInfo.value.colors.splice(i,1),this.colors.splice(i,1),this.colorButtonNode&&(0,s.f)(this.colorButtonNode)),(null===(o=this.lastColors.rampColors)||void 0===o?void 0:o.length)&&this.lastColors.rampColors.splice(i,1))})):(this.chartMediaInfo.value.fields.forEach(((t,i)=>{t===e.fieldName&&this.chartMediaInfo.value.fields.splice(i,1)})),this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),this.chartChangedReRender.emit(),(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)||(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.guid=void 0,this.chartMediaInfo=void 0,this.mediaContent=void 0,this.mediaIndexPosition=void 0,this.refElement=void 0,this.isOpen=!1,this.reRender=void 0}async componentWillLoad(){var e;this.layer=d.p.layer,this.mapView=d.p.mapView,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.chartMediaInfo.title=this.chartMediaInfo.title||"",this.chartMediaInfo.altText=this.chartMediaInfo.altText||"",this.chartMediaInfo.caption=this.chartMediaInfo.caption||"";const[t,i,s,o]=await(0,n.l)(["esri/core/lang","esri/Color","esri/smartMapping/symbology/pieChart","esri/renderers/support/utils"]);if(this.esriLang=t,this.esriColor=i,this.pieChartSchemes=s,this.rendererUtils=o,"renderer"in this.layer){let e;e=this.layerDisplayType===a.l.cluster?this.layer.featureReduction.renderer:this.layer.renderer,["class-breaks","dot-density","heatmap","pie-chart","simple","unique-value"].indexOf(null==e?void 0:e.type)>-1&&(this.rendererColors=await this.rendererUtils.getColorsFromRenderer(e))}this.colors=t.clone(null===(e=this.chartMediaInfo)||void 0===e?void 0:e.value.colors)||[],this.setColors()}componentDidLoad(){this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}async componentWillRender(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))),this.layerFieldsMap=await(0,l.e)(this.layer),this.arcadeExpMap=(0,l.f)(this.popupTemplate),this.pickList=[],this.chartMediaInfo.value.fields.forEach(((e,t)=>{var i,s;if(this.fieldInfoMap.has(e)){const i=this.fieldInfoMap.get(e);this.pickList.push(this.calcitePickList(i,t))}else if(this.chartMediaInfo.value.fields.splice(t,1),this.chartMediaInfo.type!==T.lineChart)if(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)this.chartMediaInfo.value.colors.splice(t,1),this.colors.splice(t,1);else{const e=this.getDefaultColorScheme();this.colors=null===(s=this.chartMediaInfo)||void 0===s?void 0:s.value.fields.map(((t,i)=>{var s,o;return(null===(s=this.rendererColors)||void 0===s?void 0:s.get(t))?this.esriLang.clone(this.rendererColors.get(t)[0]):(null===(o=this.colors)||void 0===o?void 0:o[i])||new this.esriColor(e.colors[i%10])||new this.esriColor([0,0,0,1])}))}}))}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition}),this.chartPopover.reposition()}disconnectedCallback(){var e;this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList),null===(e=this.colorButtonNode)||void 0===e||e.closePopover()}async reposition(){this.chartPopover.reposition()}chartChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}arcadeChangeNotificationHandler(){this.chartChangedReRender.emit()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null),this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null),this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null),this.panelElement.disabled=!1}async chartSelection(e){const[t,i,s,o]=await(0,n.l)(["esri/popup/content/BarChartMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/LineChartMediaInfo","esri/popup/content/PieChartMediaInfo"]);let a=null;e===T.barChart&&(a=new t({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===T.columnChart&&(a=new i({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===T.lineChart&&(a=new s({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===T.pieChart&&(a=new o({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),this.chartMediaInfo=a.clone(),this.mediaContent.mediaInfos[this.mediaIndexPosition]=this.chartMediaInfo,this.chartChangedReRender.emit()}getSummaryString(){return this.chartMediaInfo.type===T.barChart?this.strings.bar:this.chartMediaInfo.type===T.columnChart?this.strings.column:this.chartMediaInfo.type===T.lineChart?this.strings.line:this.chartMediaInfo.type===T.pieChart?this.strings.pie:void 0}render(){var e,t;const i=!!(null===(e=this.chartMediaInfo.value.fields)||void 0===e?void 0:e.length),o=(0,s.h)("calcite-segmented-control",{key:"d91597812f2fb68e00a2dd689befa4f293fa8b41",width:"full",scale:"s",class:de,onCalciteSegmentedControlChange:async e=>{var t;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover();const i=e.target.selectedItem;if(this.chartMediaInfo.type===T.lineChart&&i.value!==T.lineChart||this.chartMediaInfo.type!==T.lineChart&&i.value===T.lineChart){const e=this.chartMediaInfo.value.colors;this.chartMediaInfo.type===T.lineChart?(this.lastColors.lineColors=e&&this.esriLang.clone(e),this.colors=void 0,this.chartMediaInfo.value.colors=void 0):(this.lastColors.rampColors=e&&this.esriLang.clone(e),i.value===T.lineChart&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0))}i.value!==this.chartMediaInfo.type&&(i.value!==T.columnChart||this.chartMediaInfo.type!==T.barChart)&&await this.chartSelection(i.value),this.setColors()}},(0,s.h)("calcite-segmented-control-item",{key:"cb6c5d72db4da49eed2c757e20ee7bceab5708f5",value:T.columnChart,iconStart:"graph-bar",checked:this.chartMediaInfo.type===T.columnChart||this.chartMediaInfo.type===T.barChart},this.strings.bar),(0,s.h)("calcite-segmented-control-item",{key:"5359d9b7e9e3f701fcd9028358feca87d787c730",value:T.lineChart,iconStart:"graph-time-series",checked:this.chartMediaInfo.type===T.lineChart},this.strings.line),(0,s.h)("calcite-segmented-control-item",{key:"f3c11f8a06c42cdddf3d0b83d0f78756a101417c",value:T.pieChart,iconStart:"pie-chart",checked:this.chartMediaInfo.type===T.pieChart},this.strings.pie)),a=(0,s.h)("arcgis-popup-color-button",{key:"33b0cf8901e6a3fe54b0882e09f9eb158771bf82",chartMediaInfo:this.chartMediaInfo,colors:this.colors,popoverReferenceElement:this.panelElement,onArcgisPopupColorButtonChange:({detail:e})=>{this.colors=e,this.chartMediaInfo.value.colors=this.esriLang.clone(e),this.chartChangedReRender.emit()},onArcgisPopupColorButtonBeforeOpen:()=>this.closeColorPopover(),ref:e=>this.colorButtonNode=e}),n=(0,s.h)("calcite-label",{key:"305521f6270dbdbfb5afde2f6aab8fb744d53441",layout:"inline-space-between"},this.strings.resetColors,(0,s.h)("calcite-action",{key:"d1bb74704d0ae04e51087e4661980f2148f07416",appearance:"transparent",text:this.strings.resetColors,disabled:!(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length),onClick:()=>{var e;null===(e=this.colorButtonNode)||void 0===e||e.closePopover(),this.closeColorPopover(),this.chartMediaInfo.value.colors=null,this.colors=[],this.chartMediaInfo.type===T.lineChart?this.lastColors.lineColors=void 0:this.lastColors.rampColors=void 0,this.setColors(),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{key:"541b82a5acf9c71592b13e8ee97225dfb54e3dda",scale:"s",icon:"reset"}))),r=(0,s.h)("div",{key:"55072c7bce54f22a530b0f52f87b1e64ba2e1478"},(0,s.h)("calcite-button",{key:"92489558f99448719e8f102c332af49a961bf698",class:ee,appearance:"transparent",scale:"m",width:"full",onClick:async e=>{var t,i,s;e.stopPropagation(),this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.panelElement},this.popupFieldManagePickList.selectedFields=(null===(s=null===(i=this.chartMediaInfo)||void 0===i?void 0:i.value)||void 0===s?void 0:s.fields)||[],this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.numbersOnly=!0,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.panelElement.disabled=!0)}},this.strings.selectAttributes),(0,s.h)("calcite-list",{key:"7f48d64c396da8193abe0827013b4b1d0f309d02","drag-enabled":!0,onCalciteListOrderChange:async e=>{var t,i;e.stopPropagation();const s=e.target.querySelectorAll("calcite-list-item"),o=[];if(s.forEach((e=>{this.chartMediaInfo.value.fields.forEach(((t,i)=>{e.value===t&&o.push(i)}))})),this.chartMediaInfo.type===T.lineChart)this.chartMediaInfo.value.fields=Array.from(s).map((e=>e.value));else{(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length)||(this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors));const e=[],i=[];o.forEach((t=>{e.push(this.chartMediaInfo.value.fields[t]),i.push(this.esriLang.clone(this.chartMediaInfo.value.colors[t]))})),this.chartMediaInfo.value.fields=e,this.colors=i,this.chartMediaInfo.value.colors=this.esriLang.clone(i)}if(null===(i=this.lastColors.rampColors)||void 0===i?void 0:i.length){const e=[];o.forEach((t=>{e.push(this.lastColors.rampColors[t])})),this.lastColors.rampColors=e}this.chartChangedReRender.emit()}},this.pickList)),p=(this.chartMediaInfo.type===T.barChart||this.chartMediaInfo.type===T.columnChart)&&(0,s.h)("section",{key:"f477be12247eb6e57c0cabd5f084befb922b9d43",class:te},(0,s.h)("label",{key:"63bd283c803a228e7c96fdd32206344d323e7a9b",class:ie},this.strings.horizontalOrientation),(0,s.h)("calcite-switch",{key:"6abc039cf1a87dc17b79a24e2bab80afb39fa0a6",scale:"s",class:se,checked:this.chartMediaInfo.type===T.barChart,onCalciteSwitchChange:async e=>{var t;await this.chartSelection((null===(t=e.target)||void 0===t?void 0:t.checked)?T.barChart:T.columnChart)}})),d=(0,s.h)("calcite-block-section",{key:"eaeb728ea2c46d6175571c71f02fd162fb4ebd9b",class:oe,text:this.strings.normalize,toggleDisplay:"switch",open:!!this.chartMediaInfo.value.normalizeField,onCalciteBlockSectionToggle:e=>{e.target.open?this.chartMediaInfo.value.normalizeField=this.tempNormalizedField:(this.tempNormalizedField=this.chartMediaInfo.value.normalizeField,this.chartMediaInfo.value.normalizeField=""),this.chartChangedReRender.emit()}},(0,s.h)("div",{key:"9ebffb9ef27c740a0c6e1d73c9613abe714196ad",class:ae},(0,s.h)("button",{key:"a2f666eb651670ea29746fd6d4fe176361cf2036",ref:e=>this.normalizeBtn=e,class:le,title:this.strings.normalizeBy,onClick:e=>{var t;e.stopPropagation(),this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-popup-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.panelElement},this.arcgisFieldPickList.selectedFields=this.chartMediaInfo.value.normalizeField?[this.chartMediaInfo.value.normalizeField]:[],this.arcgisFieldPickList.numbersOnly=!0,this.arcgisFieldPickList.addEventListener("arcgisPopupPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.panelElement.disabled=!0)}},(0,s.h)("span",{key:"4697402ba0f35bb0f46efe82876e176d0be02f3b",class:ne},this.fieldInfoMap.has(this.chartMediaInfo.value.normalizeField)?(0,l.c)(this.fieldInfoMap.get(this.chartMediaInfo.value.normalizeField),this.arcadeExpMap):this.strings.normalizeBy),(0,s.h)("span",{key:"8b130b0de443f3091a9eb7fb6ea3c6e14e61d05f",class:re},(0,s.h)("calcite-icon",{key:"2f36e043d03a3d496bc87f10aa92b22524e804ad",scale:"s",icon:"pencil"}))))),h=(0,s.h)("calcite-button",{key:"26734e4ed26e85a3f55da3f78977750ab69db295",appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{key:"d63feadab8aa9de705f0f98de7390d323e967911",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"398d5187cdb72ac4f80b0d2e88ce4228492cbffb",dir:(0,c.g)(this.hostElement),ref:e=>this.chartPopover=e,placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:this.strings.configureChart,style:{zIndex:"100"},triggerDisabled:!0},(0,s.h)("calcite-panel",{key:"be5b017a60d1fca34e25aa3f131c45b7568a05d3",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"7c0c296703eaa8e5f9bddf95c162c5dcbd333481",slot:"header-content"},this.strings.configureChart),h,(0,s.h)("div",{key:"d30c4de85a85e781517b57da97e1f83c0ae4d785",class:pe},o,this.chartFormInput("title"),this.chartFormInput("caption"),this.chartFormInput("altText"),i&&a,i&&n,r,p,d))))}renderColorIcon(e){const{strings:t,selectedFieldIdx:i,colors:o}=this;if(this.chartMediaInfo.type!==T.lineChart)return(0,s.h)("div",{class:"color-icon",style:{backgroundColor:o[e].toHex()},slot:"content-start",onClick:()=>this.openColorPicker(e),role:"button",tabIndex:0,"aria-label":t.changeColor,"aria-haspopup":"true","aria-expanded":i===e,onKeyUp:t=>{" "!==t.key&&"Enter"!==t.key||this.openColorPicker(e)},ref:t=>{this.colorNodes[e]=t}})}openColorPicker(e){var t;const{colors:i,strings:o,esriColor:a}=this;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.selectedFieldIdx=e;const l=document.createElement("arcgis-popup-color-popover");l.heading=o.selectColor,l.intlDone=o.done,l.label=o.selectColor,l.hexColor=i[e].toHex(),l.popoverProps={placement:"leading-start",offsetDistance:1,offsetSkidding:52,pointerDisabled:"true",popoverWidth:315,refElement:this.chartPopover},l.addEventListener("arcgisPopupColorPopoverClose",(()=>{this.selectedFieldIdx=void 0,this.colorPopoverNode=null})),l.addEventListener("arcgisPopupColorPopoverChange",(({detail:t})=>{i[e]=new a(t),this.chartMediaInfo.value.colors=this.esriLang.clone(i),this.chartChangedReRender.emit(),(0,s.f)(this.colorButtonNode)})),document.body.appendChild(l),l.setOpen(!0),this.colorPopoverNode=l}setColors(){var e,t,i,s,o,a;const{esriColor:l,lastColors:n,rendererColors:r}=this;if(this.chartMediaInfo.type===T.lineChart)if(!(null===(e=this.colors)||void 0===e?void 0:e.length)&&n.lineColors&&(this.colors=n.lineColors,this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),null===(t=this.colors)||void 0===t?void 0:t.length)this.colors.length>1&&(this.colors=[this.colors[0]]);else{const e=this.getDefaultColorScheme();this.colors=[e.colors[0]]}else if(!(null===(i=this.colors)||void 0===i?void 0:i.length)&&n.rampColors&&(this.colors=this.esriLang.clone(n.rampColors),this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),!(null===(s=this.colors)||void 0===s?void 0:s.length)||this.colors.length!==(null===(o=this.chartMediaInfo)||void 0===o?void 0:o.value.fields.length)){const e=this.getDefaultColorScheme();this.colors=null===(a=this.chartMediaInfo)||void 0===a?void 0:a.value.fields.map(((t,i)=>{var s;return(null==r?void 0:r.get(t))?this.esriLang.clone(r.get(t)[0]):(null===(s=this.colors)||void 0===s?void 0:s[i])||new l(e.colors[i%10])||new l([0,0,0,1])}))}}getDefaultColorScheme(){const e=this.pieChartSchemes.getSchemes({basemap:this.mapView.map.basemap,geometryType:"polygon",numColors:Math.min(10,this.chartMediaInfo.value.fields.length)});return[e.primaryScheme].concat(e.secondarySchemes).find((e=>"Olympic Sunset"===e.name))||e.primaryScheme}closeColorPopover(){this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null)}get hostElement(){return(0,s.d)(this)}};he.style=".manage-btn{justify-content:flex-end}.enable-column{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter)}.enable-column-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.column-switch{margin:0;flex:0 0 0%;justify-self:flex-end}.normalize-block{padding:0 var(--arcgis-app-side-spacing-quarter)}.normalize-content-btn-section{background-color:var(--arcgis-app-background);min-width:100%}.normalize-content-btn{background:var(--arcgis-app-background-clear);border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius);display:flex;align-items:center;justify-content:space-between;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter);cursor:pointer;width:100%;text-align:unset;transition:background-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function), border-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function)}.normalize-content-btn:hover{background-color:var(--arcgis-app-background-hover);border-color:var(--arcgis-app-border-hover)}.normalize-content-btn-text{font-family:var(--arcgis-app-font-family);font-size:var(--arcgis-app-font-size-0);flex:0 1 auto;overflow:hidden;padding:0 var(--arcgis-app-side-spacing-eighth);text-overflow:ellipsis;white-space:nowrap}.normalize-content-btn-icon{flex:0 0 0%;padding:0 var(--arcgis-app-side-spacing-half)}.popover-chart-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:60vh}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.chart-group{margin-bottom:var(--arcgis-app-cap-spacing-half)}.color-icon{width:18px;height:18px;border-radius:90%}";const ue=class{constructor(e){(0,s.r)(this,e),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.arcgisPopupExpressionsBackClick=(0,s.c)(this,"arcgisPopupExpressionsBackClick",7),this.valueList=[],this.filterLength=5,this.calciteValueList=e=>(0,s.h)("calcite-list-item",{disabled:d.p.blockFeatureReductionArcade,label:e.title,description:`{${a.f.expression}${e.name}}`,value:e.name,metadata:{title:e.title,name:`{${a.f.expression}${e.name}}`},onClick:t=>this.launchArcade(t,e)},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:t=>this.removeBtnClick(t,e.name)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.reRender=void 0}componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){await this.loadAllModules()}componentWillRender(){var e;this.valueList=[],(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)&&this.popupTemplate.expressionInfos.forEach((e=>{this.valueList.push(this.calciteValueList(e))}))}async setFocus(){this.expressionFlowItem.setFocus()}async loadAllModules(){[this.FieldInfo,this.PopupExpressionInfo]=await(0,n.l)(["esri/popup/FieldInfo","esri/popup/ExpressionInfo"])}async launchArcade(e,t){e.stopPropagation(),this.arcadeEditor||(this.expressionFlowItem.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=M(null==t?void 0:t.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await R(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await S(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.suggestions=D(this.layer,this.strings,"attributeExpression"),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==t?void 0:t.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>{this.arcadeSetup(e.detail,t),setTimeout((()=>this.fabButtonNode.setFocus()),300)})))}async arcadeSetup(e,t){e&&($(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate),await this.popupExpressionSetup()),this.expressionFlowItem.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async popupExpressionSetup(){await _(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.arcadeChangeNotification.emit(),this.internalPopupUpdated.emit(),this.reRender=!this.reRender}removeBtnClick(e,t){e.stopPropagation(),this.popupTemplate.expressionInfos.find(((e,i)=>{if(e.name===t)return this.popupTemplate.expressionInfos.splice(i,1)})),this.popupExpressionSetup()}render(){var e;const t=(0,s.h)("calcite-fab",{key:"b8b5b319f1e0200705214c5107fbbff5f054d942",disabled:d.p.blockFeatureReductionArcade,slot:"fab",class:"fab",icon:"plus",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addExpression,text:this.strings.addExpression,"text-enabled":!0,onClick:e=>this.launchArcade(e),ref:e=>this.fabButtonNode=e});return(0,s.h)(s.H,{key:"a50539135ec7ccfaba0048544669fcf936d08fd1",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"a69e311590c077ba61d12d516b4addd774e7fd5e",dir:(0,c.g)(this.hostElement),heading:this.strings.manageExpressions,ref:e=>this.expressionFlowItem=e,onCalciteFlowItemBack:()=>this.arcgisPopupExpressionsBackClick.emit()},(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-list",{key:"9c2ac952d271d0bb72f11fe961a6fe6083da171c",filterEnabled:this.valueList.length>=this.filterLength},this.valueList),t))}get hostElement(){return(0,s.d)(this)}},me=class{constructor(e){(0,s.r)(this,e),this.arcgisPopupPickListDismissed=(0,s.c)(this,"arcgisPopupPickListDismissed",7),this.arcgisPopupPickListChange=(0,s.c)(this,"arcgisPopupPickListChange",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.arcadeExpMap=new Map,this.calciteFieldOnlyValueList=e=>(0,s.h)("calcite-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},this.layerDisplayType===a.l.feature&&!e.name.includes(a.f.relationship)&&(0,s.h)("calcite-action",{slot:"actions-end",text:this.strings.info,title:this.strings.info,scale:"s",icon:"information",onClick:t=>{var i;t.stopPropagation();const s=t.target,o=document.createElement("calcite-flow-item");o.heading=null!==(i=e.alias)&&void 0!==i?i:e.name,o.description=e.name;const a=document.createElement("arcgis-field-info");a.lang=this.currentLanguageIntl,a.fieldName=e.name,a.layer=this.layer,a.view=this.mapView,a.classList.add("content"),o.addEventListener("calciteFlowItemBack",(()=>requestAnimationFrame((()=>s.setFocus())))),o.appendChild(a),this.flowElement.appendChild(o),setTimeout((()=>o.setFocus()),200)}})),this.calciteExpressionsOnlyValueList=e=>(0,s.h)("calcite-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},(0,s.h)("div",{class:"expression-actions",slot:"actions-end"},(0,s.h)("calcite-action",{disabled:d.p.blockFeatureReductionArcade,text:this.strings.edit,title:this.strings.edit,scale:"s",icon:this.numbersOnly&&e.type.toLowerCase()!==a.a.number?"exclamation-mark-triangle":"pencil",onClick:()=>{this.arcadeExpMap.has(e.name)&&this.launchArcade(this.arcadeExpMap.get(e.name))}}),(0,s.h)("calcite-action",{text:this.strings.remove,title:this.strings.remove,scale:"s",icon:"trash",onClick:async()=>{this.popupTemplate.expressionInfos.find(((t,i)=>{if(e.name.includes(`/${t.name}`))return this.popupTemplate.expressionInfos.splice(i,1)})),await _(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.fields=this.fields.filter((t=>t.name!==e.name)),this.selectedFields=[...this.selectedFields].filter((t=>t!==e.name)),this.multiple&&this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}}))),this.selectedFields=[],this.popoverProps=void 0,this.showCancel=!0,this.multiple=!1,this.heading=void 0,this.okBtnText=void 0,this.showFilterLength=5,this.numbersOnly=!1,this.lastSortyBy=a.L.default,this.filterFields=null,this.arcadeEditor=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.currentLanguageIntl=d.p.currentLanguageIntl,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.supportsArcade=d.p.supportsArcade,this.layerFieldsMap=await(0,l.e)(this.layer),this.arcadeExpMap=(0,l.f)(this.popupTemplate),this.fields=await this.getFields(),!this.multiple&&this.selectedFields.length>1&&(this.selectedFields=[this.selectedFields[0]])}async componentDidLoad(){await this.loadAllModules(),this.popoverNode.open=!0,setTimeout((()=>requestAnimationFrame((()=>this.flowItemElement.setFocus()))),200)}componentWillRender(){this.arcadeExpMap=(0,l.f)(this.popupTemplate),this.fieldsOnly=[...this.getSortedList()].filter((e=>!e.name.includes(a.f.expression))),this.expressionsOnly=[...this.getSortedList()].filter((e=>e.name.includes(a.f.expression)))}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}getSortedList(){const e=[...this.fields];return this.lastSortyBy===a.L.display?e.sort(((e,t)=>e.alias.localeCompare(t.alias))):this.lastSortyBy===a.L.field?e.sort(((e,t)=>e.name.localeCompare(t.name))):this.lastSortyBy===a.L.type&&e.sort(((e,t)=>e.type.localeCompare(t.type))),e}selectDeselect(){var e;return(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.filterContainsAll():this.selectedFields.length===this.fields.length}filterContainsAll(){return this.filterFields.every((e=>this.selectedFields.some((t=>t===e))))}async loadAllModules(){[this.PopupExpressionInfo,this.FieldInfo]=await(0,n.l)(["esri/popup/ExpressionInfo","esri/popup/FieldInfo"])}async launchArcade(e){this.arcadeEditor||(this.flowItemElement.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=M(null==e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await R(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await S(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==e?void 0:e.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==e?void 0:e.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(t=>this.arcadeSetup(t.detail,e))))}async arcadeSetup(e,t){if(e){const i=$(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate);await _(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo);const s=`${a.f.expression}${i.name}`;this.fields.push({name:s,alias:i.title,type:i.returnType}),this.fields=[...new Map(this.fields.map((e=>[e.name,e]))).values()],this.multiple?this.selectedFields.push(s):this.selectedFields=[s],this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}this.flowItemElement.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async getFields(){const e=[];let t=await(0,l.k)(this.layer);t=t.filter((e=>e.visible));const i=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])));if(t.forEach((t=>{if(i.has(t.name)){const s=i.get(t.name);e.push({name:s.fieldName,alias:(0,l.c)(s,this.arcadeExpMap),type:(0,l.b)(s.fieldName,this.layerFieldsMap,this.arcadeExpMap)}),i.delete(t.name)}})),i.forEach((t=>{e.push({name:t.fieldName,alias:(0,l.c)(t,this.arcadeExpMap),type:(0,l.b)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap)})})),this.numbersOnly){const t=new Set(this.selectedFields);return e.filter((e=>{const i=e.type.toLowerCase();if((t.has(e.name)||i===a.a.integer||i===a.a.smallInteger||i===a.a.bigInteger||i===a.a.single||i===a.a.double||i===a.a.long||i===a.a.number||i===a.a.oid)&&!e.name.includes(a.f.relationship))return e}))}return e}render(){const e=(0,s.h)("calcite-button",{appearance:this.showCancel?"solid":"outline-fill",width:this.showCancel?"half":"full",scale:"m",onClick:()=>{this.arcgisPopupPickListDismissed.emit({selectedFields:[...new Set(this.selectedFields)]})}},this.okBtnText||(this.multiple?this.strings.done:this.strings.ok)),t=(0,s.h)("calcite-button",{appearance:"outline-fill",width:this.multiple?"half":"full",scale:"m",onClick:()=>this.arcgisPopupPickListDismissed.emit()},this.strings.cancel),i=(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed"},(0,s.h)("calcite-action",{slot:"trigger",text:this.strings.sort,title:this.strings.sort},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.default,onClick:()=>this.lastSortyBy=a.L.default,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.default)}},this.strings.default),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.display,onClick:()=>this.lastSortyBy=a.L.display,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.display)}},this.strings.displayName),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.type,onClick:()=>this.lastSortyBy=a.L.type,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.type)}},this.strings.type),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.field,onClick:()=>this.lastSortyBy=a.L.field,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.field)}},this.strings.fieldName))),o=(0,s.h)("div",{class:"selection-button-div"},(0,s.h)("calcite-button",{appearance:"transparent",scale:"m",width:"full",class:"selection-button",onClick:()=>{var e,t;this.selectDeselect()?this.selectedFields=(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.selectedFields.filter((e=>!this.filterFields.includes(e))):[]:this.selectedFields=(null===(t=this.filterFields)||void 0===t?void 0:t.length)?[...new Set([...this.selectedFields,...this.filterFields])]:this.fields.map((e=>e.name)),this.arcgisPopupPickListChange.emit({selectedFields:this.selectedFields})}},this.selectDeselect()?this.strings.deselectAll:this.strings.selectAll)),l=(0,s.h)("calcite-button",{disabled:d.p.blockFeatureReductionArcade,appearance:"transparent",scale:"m",width:"full",iconStart:"plus",class:"add-expression-button",onClick:()=>{this.launchArcade()}},this.strings.addExpression);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:(0,c.g)(this.hostElement),class:"popover",placement:this.popoverProps.placement||"leading-start",open:!1,pointerDisabled:!0,referenceElement:this.popoverProps.refElement,offsetDistance:this.popoverProps.offsetDistance||-Math.round(this.popoverProps.refElement.getBoundingClientRect().width),offsetSkidding:this.popoverProps.offsetSkidding||50,label:this.heading,triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-flow",{ref:e=>{this.flowElement=e},style:{width:`${this.popoverProps.popoverWidth||this.popoverProps.refElement.getBoundingClientRect().width}px`}},(0,s.h)("calcite-flow-item",{ref:e=>this.flowItemElement=e,class:"panel",heading:this.heading,closable:!0,onCalciteFlowItemClose:()=>this.arcgisPopupPickListDismissed.emit()},(0,s.h)("div",{class:"footer",slot:"footer"},this.supportsArcade&&l,this.multiple&&e,this.showCancel&&t),(0,s.h)("calcite-list",{class:"content",selectionMode:this.multiple?"multiple":"single",ref:e=>{this.listNode=e},filterEnabled:this.fields.length>=this.showFilterLength,filterPlaceholder:this.strings.searchFields,onCalciteListFilter:e=>{var t;e.stopPropagation(),this.filterFields=null===(t=this.listNode.filteredItems)||void 0===t?void 0:t.map((e=>e.value))},onCalciteListChange:()=>{const e=this.listNode.selectedItems.map((e=>e.value)),t=this.selectedFields.filter((t=>e.includes(t))),i=e.filter((e=>!this.selectedFields.includes(e))),s=[...new Set([...t,...i])];this.isSameLists(s,this.selectedFields)||(this.selectedFields=s,this.arcgisPopupPickListChange.emit({selectedFields:this.selectedFields}),this.multiple||this.arcgisPopupPickListDismissed.emit({selectedFields:this.selectedFields}))}},this.fields.length>=this.showFilterLength&&i,this.multiple&&o,this.supportsArcade&&(0,s.h)("calcite-list-item-group",{heading:this.strings.expressions},this.expressionsOnly.length?this.expressionsOnly.map((e=>this.calciteExpressionsOnlyValueList(e))):(0,s.h)("calcite-label",{alignment:"center"},this.strings.noExpressions)),(0,s.h)("calcite-list-item-group",{heading:this.supportsArcade?this.strings.attributes:null},this.fieldsOnly.map((e=>this.calciteFieldOnlyValueList(e)))))))))}isSameLists(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length))return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}get hostElement(){return(0,s.d)(this)}};me.style=".popover{z-index:100}.panel{min-height:300px}.content{max-height:calc(60vh - 142px);}.selection-button-div{padding:4px 10px}.footer{width:100%}.expression-actions{display:flex}.add-expression-button{margin:4px 0 8px}";const ge="popover-image-div",fe="form-input-button",ve="refresh-image-input",ye=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.imageChangedReRender=(0,s.c)(this,"imageChangedReRender",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.changeImageProperties=e=>{null==e||e.stopPropagation(),null==e||e.preventDefault(),this.imageMediaInfo.value.sourceURL=this.editImageUrl.value,this.imageMediaInfo.title=this.editImageTitle.value,this.imageMediaInfo.refreshInterval=this.editRefreshImage.value||0,this.imageMediaInfo.caption=this.editImageCaption.value,this.imageMediaInfo.altText=this.editAltText.value,this.imageMediaInfo.value.linkURL=this.editImageLinkUrl.value,this.imageChangedReRender.emit()},this.openAttributesList=e=>{this.closePopupPopovers.emit(this.guid),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},this.imageFormInput=e=>{var t;const i=this.getImageInputObject(e);return(0,s.h)("calcite-label",{scale:"s"},i.inputLabel,(0,s.h)("div",{id:i.popoverId,class:fe},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i.referenceElement,value:i.inputValue,placeholder:i.placeHolder,onClick:()=>this.closePopupPopovers.emit(this.guid)}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,"text-display":"hidden",onClick:()=>this.openAttributesList(i.imageInput),scale:"s",icon:"brackets-curly"})))},this.getImageInputObject=e=>{const t=new class{};return t.imageInput=e,t.popoverId=`popoverId_${t.imageInput}`,e===a.i.sourceUrl?(t.inputLabel=this.strings.url,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageUrl=e},t.inputValue=this.imageMediaInfo.value.sourceURL,t.placeHolder=this.strings.imageUrlPlaceHolder):e===a.i.title?(t.inputLabel=this.strings.title,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageTitle=e},t.inputValue=this.imageMediaInfo.title,t.placeHolder=this.strings.imageTitlePlaceHolder):e===a.i.caption?(t.inputLabel=this.strings.caption,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageCaption=e},t.inputValue=this.imageMediaInfo.caption,t.placeHolder=this.strings.imageCaptionPlaceHolder):e===a.i.altText?(t.inputLabel=this.strings.description,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editAltText=e},t.inputValue=this.imageMediaInfo.altText,t.placeHolder=this.strings.describeImage):e===a.i.linkUrl&&(t.inputLabel=this.strings.link,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageLinkUrl=e},t.inputValue=this.imageMediaInfo.value.linkURL,t.placeHolder=this.strings.imageLinkUrlPlaceHolder),t},this.guid=void 0,this.imageMediaInfo=void 0,this.refElement=void 0,this.mediaIndexPosition=void 0,this.isOpen=!1,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.imageMediaInfo.title=this.imageMediaInfo.title||"",this.imageMediaInfo.altText=this.imageMediaInfo.altText||"",this.imageMediaInfo.caption=this.imageMediaInfo.caption||"",this.imageMediaInfo.value.sourceURL=this.imageMediaInfo.value.sourceURL||"",this.imageMediaInfo.value.linkURL=this.imageMediaInfo.value.linkURL||""}componentDidLoad(){this.editImageUrl.value=this.imageMediaInfo.value.sourceURL,this.editImageTitle.value=this.imageMediaInfo.title,this.editRefreshImage.value=this.imageMediaInfo.refreshInterval||0,this.editImageCaption.value=this.imageMediaInfo.caption,this.editImageLinkUrl.value=this.imageMediaInfo.value.linkURL,this.editAltText.value=this.imageMediaInfo.altText,this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition})}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}imageChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}calciteBlockSectionToggleHandler(e){const t=e.composedPath();"refreshImageBlockSection_id"===(null==t?void 0:t[0].id)&&(this.editRefreshImage.value=0,this.changeImageProperties(e),this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition()),e.stopPropagation()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null),this.panelElement.disabled=!1}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];t===a.i.sourceUrl?(this.editImageUrl.value=P(this.editImageUrl,i),this.editImageUrl.setFocus()):t===a.i.title?(this.editImageTitle.value=P(this.editImageTitle,i),this.editImageTitle.setFocus()):t===a.i.caption?(this.editImageCaption.value=P(this.editImageCaption,i),this.editImageCaption.setFocus()):t===a.i.linkUrl?(this.editImageLinkUrl.value=P(this.editImageLinkUrl,i),this.editImageLinkUrl.setFocus()):t===a.i.altText&&(this.editAltText.value=P(this.editAltText,i),this.editAltText.setFocus()),this.closePopupPopovers.emit(this.guid),this.changeImageProperties()}render(){const e=(0,s.h)("calcite-block-section",{key:"ceba447979722928df019dd2676ef5908e7e6320",id:"refreshImageBlockSection_id",text:this.strings.refreshInterval,toggleDisplay:"switch",open:!!this.imageMediaInfo.refreshInterval},(0,s.h)("div",{key:"405602151ce11aa866d58ef8ea833c89dca9760c",class:"refresh-label"},(0,s.h)("calcite-label",{key:"259fbec702606c86f1ae654e7a25fa37bce6c410",scale:"s",layout:"inline"},(0,s.h)("calcite-input",{key:"2b250b54b598a8aaff402563fb355ce2a11f9812",class:ve,type:"number",min:0,max:1440,ref:e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editRefreshImage=e},value:this.imageMediaInfo.refreshInterval?this.imageMediaInfo.refreshInterval.toString():"0",onClick:()=>this.closePopupPopovers.emit(this.guid),onCalciteInputInput:()=>{if(this.editRefreshImage.value){const e=parseInt(this.editRefreshImage.value);e<0?this.editRefreshImage.value=0:e>1440&&(this.editRefreshImage.value=1440)}}}),this.strings.minutes))),t=(0,s.h)("div",{key:"4d7c7c8e702a8668ed493f33b6d6c7ab5eed51aa",class:"ignore-elements-sortable"},this.imageFormInput(a.i.sourceUrl),(0,s.h)("calcite-block-section",{key:"43d14bdd0830b42186aa18caadb7d40bf1c579cd",open:!0,text:this.strings.options},this.imageFormInput(a.i.title),this.imageFormInput(a.i.caption),this.imageFormInput(a.i.altText),this.imageFormInput(a.i.linkUrl),e)),i=(0,s.h)("calcite-button",{key:"422b3e22885a03be6b0bc69074aaa9b7b61a913f",appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{key:"a98e74a79834946ecc21b0adddce68aad605799e",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"906a0d7d973d4994ae73ff79e326acc265b7fb05",dir:(0,c.g)(this.hostElement),id:"managePopover_Id",placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:this.strings.configureImage,style:{zIndex:"100"},triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"3cf938e6e4b117d945532a90d642165ecb7d7527",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"3112df075038dcadfa315416d8009625da5b0f40",slot:"header-content"},this.strings.configureImage),i,(0,s.h)("div",{key:"de0f6d15c94e649ae8857abf16a7bc4907f0f33d",class:ge},t))))}get hostElement(){return(0,s.d)(this)}};ye.style=".popover-image-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:calc(60vh - 102px);}.refresh-label{margin-top:6px}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.refresh-image-input{width:5rem}";const be=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.notifyAddContentSelection=(0,s.c)(this,"notifyAddContentSelection",7),this.notifyAddMultiMediaContentSelection=(0,s.c)(this,"notifyAddMultiMediaContentSelection",7),this.contentPopoverRefElement=void 0,this.popupHasAttachment=void 0,this.popoverPanelWidth=void 0,this.isMultimediaContent=!1,this.guid=void 0,this.isOpen=!1}async reposition(){var e;null===(e=this.popoverElement)||void 0===e||e.reposition()}componentWillLoad(){this.strings=d.p.strings,this.layerHasAttachment=d.p.layerHasAttachment,this.layerHasET=d.p.layerHasET,this.layerHasAttributes=d.p.layerHasAttributes,this.layerHasCharts=d.p.layerHasCharts,this.layerHasImages=d.p.layerHasImages,this.layerHasText=d.p.layerHasText,this.popupTemplate=d.p.popupTemplate,this.supportsArcade=d.p.supportsArcade}componentDidLoad(){this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition(),this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}contentSelection(e){this.isMultimediaContent?this.notifyAddMultiMediaContentSelection.emit({guid:this.guid,content:e}):this.notifyAddContentSelection.emit(e)}render(){const e=(0,s.h)("calcite-action",{key:"4d66e6d7966937653fc9890200a2d07350951f49",label:this.strings.fieldsList,text:this.strings.fieldsList,textEnabled:!0,onClick:()=>{this.contentSelection(w.attributes)}},(0,s.h)("calcite-icon",{key:"9feb15fb243bb51d58e0d6cbbdd9bb5e4a1985a8",scale:"s",icon:"feature-details"})),t=(0,s.h)("calcite-action",{key:"be3b24cafd0f9a425cc3ed459d2cb2852e0e4f94",label:this.strings.attachments,text:this.strings.attachments,textEnabled:!0,onClick:()=>{this.contentSelection(w.attachments)},disabled:!!this.popupHasAttachment},(0,s.h)("calcite-icon",{key:"d9ab1cbac36900334131fee4c40276f0359037cc",scale:"s",icon:"attachment"})),i=(0,s.h)("calcite-action",{key:"347ae35b1eb0287668034e8b0635f8a6eae41233",label:this.strings.chart,text:this.strings.chart,textEnabled:!0,onClick:()=>{this.contentSelection(w.charts)}},(0,s.h)("calcite-icon",{key:"15b7356f435407236d34224b4cc5001364968a85",scale:"s",icon:"graph-bar"})),o=(0,s.h)("calcite-action",{key:"b87b126079cb43f4e32377dd7eadecb271fd2cbf",label:this.strings.image,text:this.strings.image,textEnabled:!0,onClick:()=>{this.contentSelection(w.images)}},(0,s.h)("calcite-icon",{key:"9a6e8e4633938f4339ecb25eef080f34b23eea61",scale:"s",icon:"image"})),a=(0,s.h)("calcite-action",{key:"36a22aff89597d9e58ce0cff1b60a74b5ab5b988",label:this.strings.text,text:this.strings.text,textEnabled:!0,onClick:()=>{this.contentSelection(w.richText)}},(0,s.h)("calcite-icon",{key:"96230baab6c0faa2d7ce556f14e9b26a9a151d7e",scale:"s",icon:"text"})),n=(0,s.h)("calcite-action",{key:"711769fb6c417bf76f39e69e53092f3d45bf4a5c",disabled:d.p.blockFeatureReductionArcade,label:this.strings.arcade,text:this.strings.arcade,icon:"code",textEnabled:!0,onClick:()=>{this.contentSelection(w.arcade)}}),r=(0,s.h)("calcite-action",{key:"deb3b31e8938cc5db308d1a8c4bb5f88e5a0cd64",label:this.strings.summaryETHeading,text:this.strings.summaryETHeading,textEnabled:!0,onClick:()=>{this.contentSelection(w.summaryET)},disabled:!!this.popupTemplate.lastEditInfoEnabled},(0,s.h)("calcite-icon",{key:"2beb40d23e6fd8b16a871c75e3556f0a6501cea9",scale:"s",icon:"user"})),p=(0,s.h)("calcite-action",{key:"e4be8a23b462433f5b3cb3cfb255d1bc1b3cf862",label:this.strings.relatedRecords,text:this.strings.relatedRecords,textEnabled:!0,onClick:()=>{this.contentSelection(w.relationship)}},(0,s.h)("calcite-icon",{key:"73804f71e161893550314f5fe402308f771c7970",scale:"s",icon:"link"})),h=(0,l.q)(this.contentPopoverRefElement,"calcite-flow-item"),u=(null==h?void 0:h.getBoundingClientRect().top)||56,m=(null==h?void 0:h.getBoundingClientRect().bottom)||0,g=this.contentPopoverRefElement.getBoundingClientRect().top,f=g-u<m-(g+25)?0:g-u-54-10,v={maxHeight:f>0?`${f}px`:"60vh"};return(0,s.h)(s.H,{key:"d57811998bdd7860187eddf86c8e69fc3b9e57df",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"4f2629f98281c82e0e94ea302f51abc9485ff3a1",ref:e=>this.popoverElement=e,dir:(0,c.g)(this.hostElement),id:"managePopover_Id",placement:"bottom",open:this.isOpen,referenceElement:this.contentPopoverRefElement,label:this.isMultimediaContent?this.strings.addMedia:this.strings.addContent,style:{zIndex:"100"},triggerDisabled:!0},(0,s.h)("calcite-panel",{key:"4e7c5d68bc8d8c003db88793f3224c19204045fd",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.popoverPanelWidth}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"ca6ac2519f4363e3400f2cdc7d084813604cc57b",slot:"header-content"},this.isMultimediaContent?this.strings.addMedia:this.strings.content),this.isMultimediaContent?(0,s.h)("div",{style:v},this.layerHasCharts&&i,this.layerHasImages&&o):(0,s.h)("div",{style:v},this.layerHasAttributes&&e,this.layerHasAttachment&&t,this.layerHasCharts&&i,this.layerHasImages&&o,this.layerHasText&&a,this.supportsArcade&&n,this.layerHasET&&r,d.p.layerHasRelatedRecords&&p))))}get hostElement(){return(0,s.d)(this)}},Pe="add-media-button",Ce="form-input-button",ke="disable-spacing",Ie=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.closeMultiMediaPopover=(0,s.c)(this,"closeMultiMediaPopover",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.deleteComponent=(0,s.c)(this,"deleteComponent",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.mediaMap=new Map,this.calciteListItem=(e,t)=>(0,s.h)("calcite-list-item",{id:t,label:e.title&&`${e.title.substring(0,25)}${e.title.length>25?"...":""}`||this.strings.noTitle,description:this.getMultiMediaText(e.type),value:t,onClick:i=>{i.stopPropagation(),this.closePopupPopovers.emit(),this.openMediaPopover(e,this.findChartIndexPosition(t))}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit();const i=this.hostElement.shadowRoot.getElementById("list_Id").getElementsByTagName("calcite-list-item");for(let e=0;e<i.length;e++)if(i[e].id===t){this.multimediaContent.mediaInfos.splice(e,1),0===this.multimediaContent.mediaInfos.length?this.deleteComponent.emit(this.guid):(this.setActiveMediaInfoIndex(0),this.reRender=!this.reRender);break}}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.formInput=(e,t,i,o,a)=>{var l;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:Ce},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.multimediaContent.title=i:this.multimediaContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(l=this.popupTemplate.fieldInfos)||void 0===l?void 0:l.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.multimediaContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.strings=d.p.strings,this.mapView=d.p.mapView,this.popupTemplate=d.p.popupTemplate;const[e]=await(0,n.l)(["esri/core/reactiveUtils"]);e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.selectedFeature}),(()=>this.setActiveMediaInfoIndex(0))),e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.visible}),(()=>this.setActiveMediaInfoIndex(0))),this.multimediaContent.title||(this.multimediaContent.title=""),this.multimediaContent.description||(this.multimediaContent.description="")}componentDidLoad(){this.blockOpen&&(this.addMediaBtn.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===this.multimediaContent.mediaInfos.length?this.openMediaPopover(this.multimediaContent.mediaInfos[0],0):this.blockOptions.setFocus())}componentWillRender(){this.pickList=[],this.mediaMap.clear(),this.multimediaContent.mediaInfos.forEach((e=>{const t=(0,r.g)();this.mediaMap.set(t,e),this.pickList.push(this.calciteListItem(e,t))}))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.imagePopover&&document.body.removeChild(this.imagePopover),this.chartPopover&&document.body.removeChild(this.chartPopover),this.multimediaContentPopover&&document.body.removeChild(this.multimediaContentPopover),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}calciteListOrderChangeHandler(){let e=[];const t=this.hostElement.shadowRoot.getElementById("list_Id").getElementsByTagName("calcite-list-item");Array.from(t).map((e=>e.id)).forEach((t=>{this.mediaMap.has(t)&&e.push(this.mediaMap.get(t))})),e.length>0&&(this.multimediaContent.mediaInfos=e),this.setActiveMediaInfoIndex(0,!0),this.closePopupPopovers.emit()}resetMultiMediaIndexHandler(){this.setActiveMediaInfoIndex(0,!0)}closePopupPopoversHandler(e){(null==e?void 0:e.detail)!==this.guid&&this.imagePopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.imagePopover),this.imagePopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),(null==e?void 0:e.detail)!==this.guid&&this.chartPopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.chartPopover),this.chartPopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),this.multimediaContentPopover&&(document.body.removeChild(this.multimediaContentPopover),this.multimediaContentPopover=null,this.addMediaBtn.disabled=!1,requestAnimationFrame((()=>this.addMediaBtn.setFocus())),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}notifyMultiMediaChangeHandler(e){var t,i;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(this.setActiveMediaInfoIndex(null===(i=e.detail)||void 0===i?void 0:i.mediaIndexPosition),this.reRender=!this.reRender)}async notifyAddMultiMediaContentSelectionHandler(e){if(e.stopPropagation(),this.closePopupPopovers.emit(),e.detail.guid===this.guid){const t=e.detail.content,[i,s,o,a]=await(0,n.l)(["esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue"]);let l;t===w.images?l=new i({title:"",caption:"",altText:"",value:new o({sourceURL:"",linkURL:""})}):t===w.charts&&(l=new s({title:"",caption:"",altText:"",value:new a({fields:[]})})),this.multimediaContent.mediaInfos.push(l),this.reRender=!this.reRender,this.openMediaPopover(l,this.multimediaContent.mediaInfos.length-1)}}setActiveMediaInfoIndex(e,t){this.multimediaContent.activeMediaInfoIndex=e||0,t&&this.internalPopupUpdated.emit()}findChartIndexPosition(e){const t=this.hostElement.shadowRoot.getElementById("list_Id").getElementsByTagName("calcite-list-item");for(let i=0;i<t.length;i++)if(t[i].id===e)return i}getMultiMediaText(e){return e===T.image?this.strings.image:e===T.barChart||e===T.columnChart?this.strings.barChart:e===T.lineChart?this.strings.lineChart:e===T.pieChart?this.strings.pieChart:this.strings.image}openMediaPopover(e,t){e.type===T.image?(this.imagePopover=document.createElement("arcgis-popup-image"),this.imagePopover.guid=this.guid,this.imagePopover.refElement=this.popupFlowItem,this.imagePopover.imageMediaInfo=e,this.imagePopover.mediaIndexPosition=t,document.body.appendChild(this.imagePopover)):(this.chartPopover=document.createElement("arcgis-popup-chart"),this.chartPopover.guid=this.guid,this.chartPopover.refElement=this.popupFlowItem,this.chartPopover.chartMediaInfo=e,this.chartPopover.mediaContent=this.multimediaContent,this.chartPopover.mediaIndexPosition=t,document.body.appendChild(this.chartPopover)),this.disablePopupPanel.emit(!0)}getSummartText(){return this.multimediaContent.mediaInfos.length>1?`${this.strings.multiple} (${this.multimediaContent.mediaInfos.length})`:this.getMultiMediaText(this.multimediaContent.mediaInfos[0].type)}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=P(this.contentTitle,i),this.contentTitle.setFocus(),this.multimediaContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=P(this.contentDescription,i),this.contentDescription.setFocus(),this.multimediaContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}render(){return(0,s.h)(s.H,{key:"bcd3f4cd58d2898c1a7c7711dcf40d3994b15fac"},(0,s.h)("calcite-block",{key:"afc8dbbed6d76adee0c30aca093d0d4db4492412",dir:(0,c.g)(this.hostElement),heading:this.multimediaContent.mediaInfos.length>1?this.strings.mediaGroup:this.strings.media,description:this.multimediaContent.title&&`${this.multimediaContent.title.substring(0,25)}${this.multimediaContent.title.length>25?"...":""}`||this.getSummartText(),collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"646ba01e08744e29b9065589e215fec8419bc2f5",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"05a8c7102590e2311331a4318cd9a7d5bdf549e3",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"7e1c691d505ed50618eb1f3ef3f44911d87b8441",slot:"icon"},(0,s.h)("calcite-icon",{key:"410987c38c6edf63a1209882241f8d2ef9ac66a2",scale:"m",icon:"images"})),(0,s.h)("div",{key:"9e1536b9ba42f172e05dc21879e00e24f0c05f27",class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.multimediaContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.multimediaContent.description,this.strings.enterDescription),(0,s.h)("calcite-label",{key:"9660994e7c0f765f8405942d1dd3c072e6ceb054",class:ke,scale:"s"},this.strings.mediaContent),(0,s.h)("calcite-list",{key:"e8d9736f1999de0dc6496ff34adf5f978d152d5e",id:"list_Id","drag-enabled":!0},this.pickList),(0,s.h)("calcite-button",{key:"bf373ff8615b1b394e88e07b90bda29ad46b76e3",ref:e=>this.addMediaBtn=e,title:this.strings.addMedia,appearance:"outline-fill",round:!0,scale:"s",class:Pe,iconStart:"plus",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.multimediaContentPopover||(this.multimediaContentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.multimediaContentPopover.contentPopoverRefElement=this.addMediaBtn,this.multimediaContentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,this.multimediaContentPopover.isMultimediaContent=!0,this.multimediaContentPopover.guid=this.guid,document.body.appendChild(this.multimediaContentPopover),this.addMediaBtn.disabled=!0,this.disablePopupPanel.emit(!0))}}))))}get hostElement(){return(0,s.d)(this)}};Ie.style=".add-media-button{display:flex;justify-content:center;padding:var(--arcgis-app-cap-spacing-half) 0 0 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.disable-spacing{--calcite-label-margin-bottom:0}";const Fe=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.maxPreviewCount=11,this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.relatedRecordsContent.orderByFields[0].field=s,this.reRender=!this.reRender),this.closePopupPopovers.emit()},this.formInput=(e,t,i,o,a)=>{var l;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,disabled:!this.hasRelationshipLayer,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.relatedRecordsContent.title=i:this.relatedRecordsContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(l=this.popupTemplate.fieldInfos)||void 0===l?void 0:l.length)&&(0,s.h)("calcite-action",{text:this.strings.attributes,disabled:!this.hasRelationshipLayer,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.relatedRecordsContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0,this.hasRelationshipLayer=!0}async componentWillLoad(){this.strings=d.p.strings,this.layer=d.p.layer,this.view=d.p.mapView,this.popupTemplate=d.p.popupTemplate,await this.loadAllModules(),this.hasRelationshipLayer=await this.checkIfRelationshipExists(),this.relatedRecordsContent.title||(this.relatedRecordsContent.title=""),this.relatedRecordsContent.description||(this.relatedRecordsContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus()),this.watchForChangesToLayersList()}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e;null===(e=this.watchLayersTables)||void 0===e||e.remove(),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList)}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1)),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,this.disablePopupPanel.emit(!1))}async loadAllModules(){[this.RelatedRecordsInfoFieldOrder,this.reactiveUtils]=await(0,n.l)(["esri/popup/support/RelatedRecordsInfoFieldOrder","esri/core/reactiveUtils"])}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=P(this.contentTitle,i),this.contentTitle.setFocus(),this.relatedRecordsContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=P(this.contentDescription,i),this.contentDescription.setFocus(),this.relatedRecordsContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}async openPickList(e){var t,i,s;this.closePopupPopovers.emit(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.arcgisFieldPickList.fields=e.fields.filter((e=>e.visible)),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=this.view,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!0,this.arcgisFieldPickList.selectedFields=[null===(s=null===(i=null===(t=this.relatedRecordsContent)||void 0===t?void 0:t.orderByFields)||void 0===i?void 0:i[0])||void 0===s?void 0:s.field],this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.disablePopupPanel.emit(!0))}async checkIfRelationshipExists(){var e;for(const t of null===(e=this.layer)||void 0===e?void 0:e.relationships)if(t.id===this.relatedRecordsContent.relationshipId){const e=x(this.view);for(const i of e){const e=i;if("subtype-sublayer"!==e.type&&"subtype-group"!==e.type&&await F(this.layer,e,t))return await e.load(),Promise.resolve(!0)}return Promise.resolve(!1)}return Promise.resolve(!1)}watchForChangesToLayersList(){this.watchLayersTables=this.reactiveUtils.watch((()=>[this.view.map.allLayers.length,this.view.map.allTables.length]),(async()=>{this.hasRelationshipLayer=await this.checkIfRelationshipExists()}))}render(){var e,t,i,o,a,l,n;const r=(0,s.h)("calcite-label",null,this.strings.relationship,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed",class:"dropdown"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name||this.strings.relationship;return this.strings.relationship})()),(0,s.h)("calcite-dropdown-group",null,this.layer.relationships.map((e=>{const t=x(this.view);for(const i of t){const t=i;if(L(this.layer,t,e))return(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.relationshipId===e.id,onClick:async()=>{var i;await t.load(),this.relatedRecordsContent.relationshipId=e.id,this.relatedRecordsContent.orderByFields=[new this.RelatedRecordsInfoFieldOrder({field:t.fields.find((e=>e.visible)).name,order:(null===(i=this.relatedRecordsContent.orderByFields)||void 0===i?void 0:i[0].order)||"asc"})],this.reRender=!this.reRender}},e.name||this.strings.relationship)}}))))),p=(0,s.h)("calcite-label",null,this.strings.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m",disabled:!this.hasRelationshipLayer,onClick:async()=>{this.layer.relationships.map((async e=>{const t=x(this.view);for(const i of t){const t=i;this.relatedRecordsContent.relationshipId===e.id&&L(this.layer,t,e)&&this.openPickList(t)}}))}},(null===(i=null===(t=null===(e=this.relatedRecordsContent)||void 0===e?void 0:e.orderByFields)||void 0===t?void 0:t[0])||void 0===i?void 0:i.field)||this.strings.default)),d=(0,s.h)("calcite-label",null,this.strings.sortOrder,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},"desc"===(null===(o=this.relatedRecordsContent.orderByFields)||void 0===o?void 0:o[0].order)?this.strings.descending:this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"asc"===(null===(a=this.relatedRecordsContent.orderByFields)||void 0===a?void 0:a[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="asc",this.reRender=!this.reRender}},this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"desc"===(null===(l=this.relatedRecordsContent.orderByFields)||void 0===l?void 0:l[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="desc",this.reRender=!this.reRender}},this.strings.descending))),h=(0,s.h)("calcite-label",null,this.strings.previewCount,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},null!==(n=0===this.relatedRecordsContent.displayCount?this.strings.none:this.relatedRecordsContent.displayCount)&&void 0!==n?n:1),(0,s.h)("calcite-dropdown-group",null,[...Array(this.maxPreviewCount).keys()].map((e=>(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.displayCount===e,onClick:()=>{this.relatedRecordsContent.displayCount=e,this.reRender=!this.reRender}},0===e?this.strings.none:e))))));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,c.g)(this.hostElement),heading:this.strings.relatedRecords,description:this.relatedRecordsContent.title&&`${this.relatedRecordsContent.title.substring(0,25)}${this.relatedRecordsContent.title.length>25?"...":""}`||(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name;return this.strings.selectTable})(),collapsible:!0,open:this.blockOpen,dragHandle:!0,onCalciteBlockOpen:()=>this.closePopupPopovers.emit(),onCalciteBlockClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:this.hasRelationshipLayer}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:this.hasRelationshipLayer?"link":"exclamation-mark-triangle"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.relatedRecordsContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.relatedRecordsContent.description,this.strings.enterDescription),r,p,d,h)))}get hostElement(){return(0,s.d)(this)}};Fe.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.dropdown{width:100%}";const Le=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.richTextChangedReRender=(0,s.c)(this,"richTextChangedReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.arcadeExpMap=new Map,this.guid=void 0,this.fieldExpressionData=void 0,this.arcgisColorPickerData=void 0,this.richtextContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.popupTemplate=d.p.popupTemplate}componentDidLoad(){if(this.ckEditorMentionFieldsSetup(),this.blockOpen){this.hostElement.shadowRoot.getElementById("content_Id").scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),this.showRichTextEditor()}}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.arcgisCkeditor5Popover&&document.body.removeChild(this.arcgisCkeditor5Popover)}richTextChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closeAllPopoversHandler(){this.arcgisCkeditor5Popover&&(document.body.removeChild(this.arcgisCkeditor5Popover),this.arcgisCkeditor5Popover=null,this.disablePopupPanel.emit(!1))}ckEditorPopoverClosedHandler(e){var t,i,s,o,a;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(e.stopPropagation(),((null===(s=null===(i=e.detail)||void 0===i?void 0:i.data)||void 0===s?void 0:s.length)||0===(null===(a=null===(o=e.detail)||void 0===o?void 0:o.data)||void 0===a?void 0:a.length))&&(this.richtextContent.text=e.detail.data,this.reRender=!this.reRender,this.richTextChangedReRender.emit()),this.closePopupPopovers.emit())}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}arcadeChangeNotificationHandler(){this.ckEditorMentionFieldsSetup()}ckEditorMentionFieldsSetup(){var e;this.arcadeExpMap=(0,l.f)(this.popupTemplate),this.ckEditorMentionFields=[],null===(e=this.popupTemplate.fieldInfos)||void 0===e||e.forEach((e=>{e.fieldName&&this.ckEditorMentionFields.push({id:"{"+e.fieldName+"}",name:(0,l.c)(e,this.arcadeExpMap)})}))}getTextFromHtml(e){var t;const i=null!==(t=this.richtextContent.text)&&void 0!==t?t:"",s=document.createElement("div");s.innerHTML=i;const o=s.textContent||s.innerText||"";return`${o.substring(0,e)}${o.length>e?"...":""}`}showRichTextEditor(){var e,t;this.closePopupPopovers.emit(),this.arcgisCkeditor5Popover=document.createElement("arcgis-ckeditor5-popover"),this.arcgisCkeditor5Popover.guid=this.guid,this.arcgisCkeditor5Popover.refElement=this.popupFlowItem,this.arcgisCkeditor5Popover.intlOk=this.strings.ok,this.arcgisCkeditor5Popover.intlCancel=this.strings.cancel;const i=document.createElement("arcgis-ckeditor5");i.customConfig={FieldExpression:Object.assign(Object.assign({},this.fieldExpressionData),{layer:void 0,mapView:void 0}),ArcgisColorPicker:Object.assign(Object.assign({},this.arcgisColorPickerData),{enableFields:!(!this.arcgisColorPickerData.data||!this.arcgisColorPickerData.data.length)})},i.textData=null!==(e=this.richtextContent.text)&&void 0!==e?e:"",i.mentionFields=this.ckEditorMentionFields,i.intlTextPlaceHolder=(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0?this.strings.textPlaceHolder:this.strings.textPlaceHolderLabel,i.currentLanguage=this.currentLanguage,i.setFocus(),this.arcgisCkeditor5Popover.appendChild(i),document.body.appendChild(this.arcgisCkeditor5Popover),this.disablePopupPanel.emit(!0)}render(){return(0,s.h)(s.H,{key:"2d628fe97b1b9eb746bd765cb8b8da7a0bf8a710"},(0,s.h)("calcite-block",{key:"7241cea931f75f821ad85d1bea97dd28c12240f8",dir:(0,c.g)(this.hostElement),id:"richText_Id",heading:this.strings.text,description:this.getTextFromHtml(25),open:this.blockOpen,collapsible:!0,dragHandle:!0},(0,s.h)("div",{key:"d3a230699e62d728e3c3f6f62f51fb88424fd5f3",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"5d26e688f96cf2f5453d93cf7cabbc79c6674d9a",guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"5c00e8b5fc0d2f12ecde811b0d620ed92bd7e3df",slot:"icon"},(0,s.h)("calcite-icon",{key:"17e1422238e1e95ddf1c2a6c4ecb47bd02958b31",scale:"m",icon:"text"})),(0,s.h)("div",{key:"ab87ecc45bdeae92d73c565594b09c01c604b2b9",class:"ignore-elements-sortable",id:"content_Id"},(0,s.h)("calcite-button",{key:"241e9eefc2baedd6bb75ebb388f18fa9a1fa4e88",appearance:"transparent",width:"full",onClick:()=>this.showRichTextEditor()},this.strings.editText))))}get hostElement(){return(0,s.d)(this)}},xe="form-input-button",we=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.titleChangedReRender=(0,s.c)(this,"titleChangedReRender",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.changeTitle=()=>{this.popupTemplate.title=this.titleInput.value,this.internalPopupUpdated.emit(),this.titleChangedReRender.emit()},this.openAttributesList=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",this.popupFieldSelectionPickListChanges),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},this.popupFieldSelectionPickListChanges=e=>{const t=e.detail.selectedFields[0];this.titleInput.value=P(this.titleInput,t),this.titleInput.setFocus(),this.popupTemplate.title=this.titleInput.value,this.changeTitle(),this.closePopupPopovers.emit()},this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate}componentDidLoad(){this.guidForSelection=(0,r.g)()}titleChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.titleInput.setFocus(),this.disablePopupPanel.emit(!1))}render(){var e;const t=this.popupTemplate.title;return(0,s.h)(s.H,{key:"65e15ee0e9846d353021a6e6a6f23c4abdcd9aa2"},(0,s.h)("calcite-block",{key:"b0ce587ed3944a3258e79c0f37589c6ccb5a544f",dir:(0,c.g)(this.hostElement),heading:this.strings.popupTitle,description:t&&`${t.substring(0,25)}${t.length>25?"...":""}`,collapsible:!0},(0,s.h)("div",{key:"40431da82a517c5cc6ecd70f18b5ada847218f36",slot:"icon"},(0,s.h)("calcite-icon",{key:"73ad7dd5983e33d6bdbcc67bc057b921305c4151",scale:"m",icon:"title"})),(0,s.h)("div",{key:"324e2203fc50cddddae0c73fc96c4674dfa95df0",class:xe},(0,s.h)("calcite-input",{key:"db90e3857b04c80fd815b3ece64dd6552431f15e",type:"text",autofocus:!0,ref:e=>{this.titleInput=e},value:t,onCalciteInputInput:e=>{e.stopPropagation(),this.changeTitle()},onClick:()=>this.closePopupPopovers.emit()}),(null===(e=this.popupTemplate.fieldInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-action",{key:"bc353fc32bbcf7cf485c7a8638cb88d3ddbffe40",scale:"s",text:this.strings.attributes,onClick:this.openAttributesList,icon:"brackets-curly"}))))}get hostElement(){return(0,s.d)(this)}};we.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}"},46227:(e,t,i)=>{i.d(t,{g:()=>s});const s=()=>[2,1,1,1,3].map((e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t})).join("-")},15368:(e,t,i)=>{i.d(t,{c:()=>s,p:()=>o});function s(e){e.layer=null,e.mapView=null,e.portal=null,e.config=null,e.strings=null,e.currentLanguage=null,e.currentLanguageIntl=null,e.serviceType=null,e.popupTemplate=null,e.layerHasAttachment=null,e.layerHasET=null,e.layerHasAttributes=null,e.layerHasCharts=null,e.layerHasImages=null,e.layerHasText=null,e.layerDisplayType=null,e.supportsArcade=null,e.blockFeatureReductionArcade=!1,e.layerHasRelatedRecords=!1}const o=(0,i(10699).c)({layer:null,mapView:null,portal:null,config:null,strings:null,currentLanguage:null,currentLanguageIntl:null,serviceType:null,popupTemplate:null,layerHasAttachment:null,layerHasET:null,layerHasAttributes:null,layerHasCharts:null,layerHasImages:null,layerHasText:null,layerDisplayType:null,supportsArcade:null,blockFeatureReductionArcade:!1,layerHasRelatedRecords:!1}).state}}]);