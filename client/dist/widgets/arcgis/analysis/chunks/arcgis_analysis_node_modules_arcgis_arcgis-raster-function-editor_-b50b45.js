"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-b50b45"],{60567:(e,t,a)=>{a.d(t,{F:()=>i,N:()=>n,R:()=>o});const i={Mosaic:0,Item:1,ItemGroup:2},o={CORE:"CORE",STANDARD:"STANDARD"},n={INTEGER:"integer",FLOAT:"float"}},45045:(e,t,a)=>{function i(e){void 0!==e&&(e.open=!1,e.remove())}function o(e,t){!1===e.body.contains(t)&&(e.body.appendChild(t),t.open=!0)}function n(e,t){const{helpUrl:a,helpId:n,heading:s,referenceElement:r,portal:l,helpSrcdoc:d,helpFileName:c,learnMoreUrl:h,offsetDistance:m,offsetSkidding:p}=t;return void 0!==e&&(i(e),e=void 0),e=function(e){const{helpUrl:t,helpId:a,heading:i,referenceElement:o,portal:n,helpSrcdoc:s,learnMoreUrl:r,placement:l,offsetDistance:d,offsetSkidding:c}=e,h=document.createElement("rfx-help-popover");return h.helpUrl=t,h.helpId=a,h.heading=i,h.referenceElement=o,h.placement=l??"leading-start",h.portal=n,h.helpSrcdoc=s,h.learnMoreUrl=r,void 0!==d&&(h.offsetDistance=d),void 0!==c&&(h.offsetSkidding=c),h}({helpUrl:a,helpId:n,heading:s,referenceElement:r,portal:l,helpSrcdoc:d,helpFileName:c,learnMoreUrl:h,offsetDistance:m,offsetSkidding:p}),o(document,e),e}function s(e,t){const{referenceElement:a,label:n,direction:s,offsetDistance:r,offsetSkidding:l,showPropertiesAction:d,showRenameAction:c,handleNodeDuplicate:h,handleNodeRename:m,handleNodeDelete:p,handleNodeEditProperties:u}=t;void 0!==e&&(i(e),e=void 0),e=document.createElement("calcite-popover");const f={overlayPositioning:"absolute",autoClose:!0,dir:s,focusTrapDisabled:!0,triggerDisabled:!0,pointerDisabled:!0,placement:"bottom",closable:!1,open:!0,referenceElement:a,label:n,offsetDistance:r,offsetSkidding:l,style:"z-index: 650;"};Object.assign(e,f);const v=document.createElement("rfx-node-interaction-toolbar"),g={showPropertiesAction:d,showRenameAction:c,handleNodeDuplicate:h,handleNodeRename:m,handleNodeDelete:p,handleNodeEditProperties:u};return Object.assign(v,g),e.append(v),o(document,e),setTimeout((()=>requestAnimationFrame((()=>{e.open=!0}))),1),e}a.d(t,{c:()=>s,r:()=>i,s:()=>n})},81790:(e,t,a)=>{a.d(t,{R:()=>i});const i={header:"header",content:"content"}},17242:(e,t,a)=>{a.d(t,{E:()=>i});const i={newTemplate:"new-template",openTemplate:"open-template",addFunction:"add-function",addConstant:"add-constant",addRaster:"add-raster",deleteSelected:"delete-selected"}},23700:(e,t,a)=>{a.r(t),a.d(t,{rfx_editor_app:()=>L});var i=a(17002),o=a(33752),n=a(17242),s=a(10259),r=a(95730),l=a(15195),d=a(40320),c=a(54667),h=(a(23795),a(17902),a(56451),a(33355)),m=a(93210),p=a(68708),u=(a(588),a(71802),a(44345),a(32513),a(36596),a(96898)),f=a(45045),v=a(28004),g=a(60567),C=a(81790);function y(e,t){return(0,d.o)(t)?e:{...e,thumbnailEx:t.thumbnail,name:t.name,description:t.description,functionType:t.functionType,definition:t.definitionQuery,properties:t.properties}}function T(e){if((0,d.o)(e))return void console.warn("RFT Handler get RFT Blob: No model provided.");let t=JSON.stringify(e,null,2);t=t.replaceAll(/\??token=[^&"]+?\"/g,'"');return new Blob([t],{type:"text/json"})}const E="host",S="content",x="overlay-element",R="overlay-panel",I="list-wrapper",F="panel",w="arcgis--rtl",b="action-bar",L=class{constructor(e){(0,i.r)(this,e),this.analysisRFTLaunch=(0,i.c)(this,"analysisRFTLaunch",7),this.analysisTemplateSaved=(0,i.c)(this,"analysisTemplateSaved",7),this.analysisTemplateNameChanged=(0,i.c)(this,"analysisTemplateNameChanged",7),this.analysisRFTEditorClose=(0,i.c)(this,"analysisRFTEditorClose",7),this.analysisRFTFailedToLoad=(0,i.c)(this,"analysisRFTFailedToLoad",7),this.analysisRFTLoaded=(0,i.c)(this,"analysisRFTLoaded",7),this.analysisRFTItemCreated=(0,i.c)(this,"analysisRFTItemCreated",7),this.rfxCoreServices={diagramZoomInCommand:void 0,diagramZoomOutCommand:void 0,diagramAutoLayoutCommand:void 0,diagramStretchCommand:void 0,diagramPanCommand:void 0,diagramSelectCommand:void 0,addRFxFunctionCommand:void 0,addRasterNodeCommand:void 0,addScalarNodeCommand:void 0,addRFTPortalItemCommand:void 0,addRFTJSONCommand:void 0,getModelCommand:void 0,refreshDiagramViewCommand:void 0,deleteSelectedItemsCommand:void 0,getModelDisplayDataCommand:void 0},this.headerElement=null,this.overlayElementsConfig={leftToolBar:{slot:"left",visible:!0,builder:()=>(({handleDiagramZoomIn:e,handleDiagramZoomOut:t,handleDiagramAutoLayout:a,handleDiagramStretch:o,handleDiagramSelect:n,handleDiagramPan:s,handleDiagramDeleteSelected:r,slot:l})=>(0,i.h)("div",{slot:l},(0,i.h)("rfx-diagram-interaction-toolbar",{handleDiagramZoomIn:e,handleDiagramZoomOut:t,handleDiagramAutoLayout:a,handleDiagramStretch:o,handleDiagramSelect:n,handleDiagramPan:s,handleDiagramDeleteSelected:r})))({handleDiagramZoomIn:this.handleDiagramZoomIn,handleDiagramZoomOut:this.handleDiagramZoomOut,handleDiagramAutoLayout:this.handleDiagramAutoLayout,handleDiagramStretch:this.handleDiagramStretch,handleDiagramSelect:this.handleDiagramSelect,handleDiagramPan:this.handleDiagramPan,handleDiagramDeleteSelected:this.handleDiagramDeleteSelected,slot:"left"}),type:"static"},rightToolBar:{slot:"right",visible:!0,builder:()=>(({handleRFTLaunch:e,handleRFTSave:t,handleRFTSaveAs:a,handleOpenTemplateEditor:o,handleRFTShare:n,slot:s,templateId:r})=>(0,i.h)("div",{slot:s},(0,i.h)("rfx-rft-interaction-toolbar",{handleRFTLaunch:e,handleRFTSave:t,handleRFTSaveAs:a,handleOpenTemplateEditor:o,handleRFTShare:n,templateId:r})))({handleRFTLaunch:this.handleRFTLaunch,handleRFTSave:this.handleRFTSave,handleRFTSaveAs:this.handleRFTSaveAs,handleOpenTemplateEditor:this.handleOpenTemplateEditor,handleRFTShare:this.handleRFTShare,slot:"right",templateId:this.rftItemId}),type:"static"},rfxListView:{slot:"left",visible:!1,builder:({addRasterFunctionTitle:e})=>(({slot:e,handleTriggerSelectFunction:t,handlePanelClose:a,heading:o})=>(0,i.h)("div",{slot:e,class:I},(0,i.h)("rfx-panel",{heading:o,closable:!0,showFooter:!1,closed:!1,class:{[x]:!0,[R]:!0},onCalcitePanelClose:a},(0,i.h)("rfx-list-view",{mode:g.R.CORE,onTriggerSelectFunction:t}))))({slot:"left",heading:e,handleTriggerSelectFunction:this.handleRFxListViewTriggerSelectFunction,handlePanelClose:this.handleRFxListViewPanelClose}),type:"static"}},this.showUnsavedChangesDialog=e=>void 0!==this.closeWithoutSavingModalElement?Promise.resolve(!1):new Promise((t=>{const a=document.createElement("rfx-close-without-saving-modal");a.rftTitle=e.rftProperties?.name||this.strings.newTemplate,a.handleCancel=()=>{a.remove(),this.closeWithoutSavingModalElement=void 0,t(!1)},a.handleDontSave=()=>{a.remove(),this.closeWithoutSavingModalElement=void 0,this.clearState(),t(!0)},a.handleSave=async()=>{a.remove(),this.closeWithoutSavingModalElement=void 0,t(await this.handleRFTSaveAs())},this.closeWithoutSavingModalElement=a,document.body.appendChild(a)})),this.showCloseWithoutSavingModal=(e,t)=>{const a=this.getTemplateInfo(),i=document.createElement("rfx-close-without-saving-modal");i.rftTitle=a.rftProperties?.name||this.strings.newTemplate,i.handleCancel=()=>{i.remove(),this.closeWithoutSavingModalElement=void 0},i.handleDontSave=e??this.handleDontSaveClick,i.handleSave=t??this.handleRFTSaveOnClose,this.closeWithoutSavingModalElement=i,document.body.appendChild(i)},this.handleRFTSaveOnClose=()=>{this.handleRFTSaveAs(),this.closeWithoutSavingModalElement.remove(),this.closeWithoutSavingModalElement=void 0},this.initializeRFxEditorCore=e=>{const t=e;var a;this.rfxEditorCoreElement=e,this.rfxCoreServices.diagramZoomInCommand=(a=t,{execute:async()=>{await a.zoomIn()}}),this.rfxCoreServices.diagramZoomOutCommand=(e=>({execute:async()=>{await e.zoomOut()}}))(t),this.rfxCoreServices.diagramAutoLayoutCommand=(e=>({execute:async()=>{await e.autoLayout()}}))(t),this.rfxCoreServices.diagramStretchCommand=(e=>({execute:async()=>{await e.stretch()}}))(t),this.rfxCoreServices.diagramPanCommand=(e=>({execute:async()=>{await e.pan()}}))(t),this.rfxCoreServices.diagramSelectCommand=(e=>({execute:async()=>{await e.select()}}))(t),this.rfxCoreServices.addRFxFunctionCommand=(e=>({execute:async t=>{await e.addRFxFunction(t)}}))(t),this.rfxCoreServices.addRasterNodeCommand=(e=>({execute:async t=>{const{value:a}=t||{};await e.addRasterNode({value:a})}}))(t),this.rfxCoreServices.addScalarNodeCommand=(e=>({execute:async t=>{const{value:a}=t||{};await e.addScalarNode({value:a})}}))(t),this.rfxCoreServices.addRFTPortalItemCommand=(e=>({execute:async t=>await e.addRFTPortalItem(t)}))(t),this.rfxCoreServices.addRFTJSONCommand=(e=>({execute:async t=>await e.addRFTJSON(t)}))(t),this.rfxCoreServices.getModelCommand=(e=>({execute:async()=>await e.getModel()}))(t),this.rfxCoreServices.refreshDiagramViewCommand=(e=>({execute:async()=>{await e.refreshDiagramView()}}))(t),this.rfxCoreServices.deleteSelectedItemsCommand=(e=>({execute:async()=>{await e.deleteSelected()}}))(t),this.rfxCoreServices.getModelDisplayDataCommand=(e=>({execute:async()=>{const{displayData:t}=await e.getModelDisplayData()||{};return t}}))(t)},this.handleNewTemplateClick=()=>{if(!0===this.getTemplateInfo(this.rftItemId).hasUnsavedChanges){const e=()=>{this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0,this.clearState()};this.showCloseWithoutSavingModal(e)}else this.clearState()},this.handleOpenTemplateClick=()=>{const{portal:e}=this;this.itemBrowserElement=(0,u.b)({modalStrings:{header:this.strings.browseRFT},portal:e,user:e.user,filter:'(type: "Raster function template")',onClose:this.closeItemBrowser,onSelection:this.handleItemBrowserSelection}),document.body.appendChild(this.itemBrowserElement)},this.handleItemBrowserSelection=async e=>{if(null!==e.detail){const t=e.detail.id;await this.loadRFT(t)}},this.loadRFT=async e=>{try{const t=await this.rfxCoreServices.addRFTPortalItemCommand.execute(e),a=this.getTemplateInfo();if(void 0!==a.rftJSON||!1!==a.hasUnsavedChanges&&void 0!==a.hasUnsavedChanges||!this.isPortalItem())a.hasUnsavedChanges=!0;else{const i=t.toJSON();i.sourceItemId=e,a.rftJSON=i,a.rftProperties=function(e){if((0,d.o)(e))return;const{name:t,description:a,thumbnailEx:i,functionType:o,definition:n,properties:s}=e;return{name:t,description:a,thumbnail:i,functionType:o,definitionQuery:n,properties:s}}(a.rftJSON),void 0===a.portalItem&&await this.updateTemplateInfoPortalItem(a,e),this.analysisTemplateNameChanged.emit(a.rftProperties.name)}this.updateActiveRFTList(a),this.analysisRFTLoaded.emit({id:e,data:a.rftJSON})}catch(t){console.error("Unable to display selected Raster function template."),this.analysisRFTFailedToLoad.emit(e)}},this.addToActiveRFTList=e=>{void 0===h.m.activeRFxTemplates.find((t=>t.id===e.id))&&(h.m.activeRFxTemplates=[...h.m.activeRFxTemplates,e])},this.updateActiveRFTList=e=>{h.m.activeRFxTemplates=h.m.activeRFxTemplates.map((t=>t.id===e.id?e:t))},this.updateTemplateInfoPortalItem=async(e,t)=>{const a=new o.default({id:t});await a.load(),this.updateTemplateInfoWithPortalItem(e,a)},this.updateTemplateInfoWithPortalItem=(e,t)=>{e.portalItem=t,e.canUpdateItem="admin"===t.itemControl||"update"===t.itemControl,this.updateActiveRFTList(e)},this.createRfxDetailsEditor=({detailsEditorRfxTemplate:e,detailsEditorRfxSchema:t,detailsEditorRfxNode:a})=>{const i=(0,s.C)(e,this.translatedRFTNamesMap,!0)??e?.name,o=document.createElement("div");o.setAttribute("style","display: flex; width: 28rem; justify-content: space-between;"),o.slot="header",this.headerElement=o;const n=document.createElement("span");n.setAttribute("style","display: flex; align-items: center;"),n.innerHTML=i;const r=document.createElement("calcite-action");r.label="",r.text="",r.icon="information",r.onclick=this.handleRFxDetailsEditorHeadingHelpClick(e,i),o.appendChild(n),o.appendChild(r);const l=(({rfxTemplate:e,mapLayers:t,portal:a,schema:i,title:o,handlePanelClose:n,handlePanelOk:s,handlePanelCancel:r,createLayerBrowse:l,headerElementComponent:d,mapView:c})=>{const h=document.createElement("rfx-details-editor");h.rfxTemplate=e,h.schema=i,h.mapLayers=t,h.portal=a,h.mapView=c,h.addEventListener("rfxDetailsEditorBrowseLayerClick",l);const m=(0,u.a)("rfx-modal","",{open:!0});m.setAttribute("style","--calcite-modal-height: 32rem"),m.addEventListener("rfxModalClose",(()=>{n()})),m.addEventListener("rfxModalPrimaryClick",(async()=>{const e=await h.okClicked();s({rfxTemplate:e})})),m.addEventListener("rfxModalSecondaryClick",(()=>{r()})),m.appendChild(d);const p=document.createElement("div");return p.slot=C.R.content,p.appendChild(h),m.appendChild(p),m})({rfxTemplate:e,schema:t,title:i,mapLayers:this.mapLayers,portal:this.portal,mapView:this.mapView,createLayerBrowse:this.createLayerBrowse,handlePanelClose:()=>{l.remove()},handlePanelOk:e=>{const{rfxTemplate:t}=e;a?.read(t),l.remove()},handlePanelCancel:()=>{l.remove()},headerElementComponent:o});document.body.appendChild(l)},this.createLayerBrowse=e=>{const t=e.detail;let a=(0,u.b)({modalStrings:{header:this.strings.selectLayer},portal:this.portal,user:this.portal.user,filter:t.filter||'(type: "Image Service")',selectionMode:"multi"===t.selectionMode?"multiple-sublayer":"single-sublayer",hideFilters:!1,onClose:()=>{a.remove(),a=void 0},onSelection:e=>{this.updateLayerValue(t.isFeatureSelectElement,t.referenceElement,e)}});document.body.appendChild(a)},this.updateLayerValue=(e,t,a)=>{if(null!==a.detail&&void 0!==a.detail){const e=a.detail;t.updateBrowsedLayer(e)}},this.handleAddFunctionClick=()=>{this.visibilityReducer({key:"rfxListView",visible:!0})},this.handleAddConstantClick=e=>{const{value:t}=e||{},a=this.getTemplateInfo();this.rfxCoreServices.addScalarNodeCommand.execute({value:t}),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleAddRasterClick=e=>{const{value:t}=e||{},a=this.getTemplateInfo();this.rfxCoreServices.addRasterNodeCommand.execute({value:t}),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleDontSaveClick=()=>{this.handleCloseClick(),this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0},this.handleRunClick=()=>{},this.handleSaveClick=()=>{},this.handleCloseClick=()=>{this.clearState(),this.analysisRFTEditorClose.emit()},this.clearState=()=>{h.m.activeRFxTemplates=h.m.activeRFxTemplates.filter((e=>e.id!==this.rftItemId)),this.rfxEditorCoreElement.clearAll(),this.analysisTemplateNameChanged.emit()},this.handleDiagramZoomIn=()=>{this.rfxCoreServices.diagramZoomInCommand.execute()},this.handleDiagramZoomOut=()=>{this.rfxCoreServices.diagramZoomOutCommand.execute()},this.handleDiagramAutoLayout=()=>{this.rfxCoreServices.diagramAutoLayoutCommand.execute()},this.handleDiagramStretch=()=>{this.rfxCoreServices.diagramStretchCommand.execute()},this.handleDiagramPan=()=>{this.rfxCoreServices.diagramPanCommand.execute()},this.handleDiagramDeleteSelected=()=>{this.rfxCoreServices.deleteSelectedItemsCommand.execute()},this.handleRFTLaunch=async()=>{try{let e=await this.rfxCoreServices.getModelCommand.execute();const t=this.getTemplateInfo();e=(0,d.o)(t.rftProperties)?{...e,name:this.strings.defaultTemplateName,description:""}:y(e,t.rftProperties),void 0!==t.portalItem&&(e.sourceItemId=t.portalItem.id);const a=()=>{this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0,this.analysisRFTLaunch.emit(e)},i=()=>{this.handleRFTSaveOnClose()};void 0!==e&&(!0===t.hasUnsavedChanges?(this.showCloseWithoutSavingModal(a,i),t.rftJSON=e):this.analysisRFTLaunch.emit(e))}catch{this.showErrorModal()}},this.handleDiagramSelect=()=>{this.rfxCoreServices.diagramSelectCommand.execute()},this.handleRFTSave=async()=>{const e=this.getTemplateInfo();try{let t=await this.rfxCoreServices.getModelCommand.execute();t=y(t,e.rftProperties),e.rftJSON=t;const a=T(t),i=e.portalItem?.toJSON(),o=await(0,u.u)(e.portalItem,{itemProperties:{...i,title:e.rftProperties.name,snippet:e.rftProperties.description,thumbnail:e.rftProperties.thumbnail},itemData:a});o.success?(e.hasUnsavedChanges=!1,this.updateActiveRFTList(e),document.body.appendChild((0,u.d)({modalStrings:{content:this.strings.saveSuccess.replace("${template}",o.item.title)}})),this.analysisTemplateSaved.emit({portalItem:e.portalItem,template:t})):console.error("Failed to save the item",o.errors[0].message)}catch{this.showErrorModal()}},this.showErrorModal=()=>{const e=(0,u.e)({modalStrings:{header:this.strings.templateInvalidModalTitle,content:this.strings.templateInvalidModalMsg,cancel:this.strings.cancel}});!1===document.body.contains(e)&&(document.body.appendChild(e),e.open=!0)},this.closeSaveModal=()=>{void 0!==this.saveModalElement&&(this.saveModalElement.removeEventListener("cancelClick",this.closeSaveModal),this.saveModalElement.remove(),this.saveModalElement=void 0)},this.saveAsItem=async e=>{const t=e.detail.itemProperties,a={...this.getTemplateInfo()};a.rftProperties={...a.rftProperties,name:t.title,description:t.snippet};const i=y(a.rftJSON,a.rftProperties);a.rftJSON=i;const o=T(i);t.fileType="json";const n=await(0,u.c)({itemProperties:{...t,thumbnail:a.rftProperties.thumbnail},itemData:o},this.portal);n.success&&(a.hasUnsavedChanges=!1,this.updateTemplateInfoWithPortalItem(a,n.item),this.addToActiveRFTList({...a,hasUnsavedChanges:!1,portalItem:n.item,id:n.item.id}),console.log(h.m.activeRFxTemplates),document.body.appendChild((0,u.d)({modalStrings:{content:this.strings.saveSuccess.replace("${template}",n.item.title)}})),this.analysisTemplateSaved.emit({portalItem:n.item,template:i}),this.analysisRFTEditorClose.emit()),this.closeSaveModal()},this.closeItemBrowser=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("rfxItemBrowserClose",this.closeItemBrowser),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.handleRFTSaveAs=async()=>new Promise((async e=>{const t=this.getTemplateInfo(),{portal:a,closeSaveModal:i,saveAsItem:o}=this;this.saveModalElement?.remove();try{const n=await this.rfxEditorCoreElement.getModel();t.rftJSON=n,void 0!==n&&(this.saveModalElement=(0,u.f)({portal:a,portalItem:t.portalItem,itemProps:void 0!==t.rftProperties?{title:t.rftProperties.name,snippet:t.rftProperties.description}:void 0,onCancel:()=>{i(),e(!1)},onSave:t=>{o(t),e(!0)}}),document.body.appendChild(this.saveModalElement))}catch{this.showErrorModal(),e(!1)}})),this.handleRFxTemplateEditorPanelClose=()=>{void 0!==this.templateEditorElement&&(this.templateEditorElement.remove(),this.templateEditorElement=void 0)},this.handleRFxTemplateEditorPanelSave=e=>{const t=this.getTemplateInfo();t.rftProperties=e,t.hasUnsavedChanges=!0,this.updateActiveRFTList(t),this.templateEditorElement?.remove()},this.handleOpenTemplateEditor=()=>{const e=this.getTemplateInfo();this.templateEditorElement=(0,u.g)({templateProperties:e.rftProperties,modalStrings:{header:this.strings.templatePropertiesTitle},onCancel:this.handleRFxTemplateEditorPanelClose,onSave:this.handleRFxTemplateEditorPanelSave}),document.body.appendChild(this.templateEditorElement)},this.handleRFTShare=()=>{const e=this.getTemplateInfo(),{portal:t}=this;this.shareModalElement?.remove(),this.shareModalElement=(0,u.h)({portal:t,portalItem:e.portalItem}),this.shareModalElement.addEventListener("rfxShareSuccessful",(()=>{this.shareModalElement?.remove(),this.shareModalElement=void 0,document.body.appendChild((0,u.d)({modalStrings:{content:this.strings.shareSuccess.replace("${template}",e.portalItem.title)}}))})),document.body.appendChild(this.shareModalElement)},this.handleRFxListViewTriggerSelectFunction=async e=>{e.stopPropagation();const{detail:t}=e,a=this.getTemplateInfo(),i=await(0,s.b)(t);this.rfxCoreServices.addRFxFunctionCommand.execute(i),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleRFxListViewPanelClose=e=>{e.stopPropagation(),this.visibilityReducer({key:"rfxListView",visible:!1})},this.createRasterNodeEditor=(e,t)=>{const a=(0,u.i)({heading:this.strings.browseLayerDialogTitle,inputLayers:(0,c.t)(this.mapLayers).imageryLayers,layerValue:t,handlePanelOk:t=>{e.value=t.rasterValue,a?.remove()},handlePanelClose:()=>{a?.remove()},createLayerBrowse:this.createLayerBrowse});document.body.appendChild(a)},this.handlePopoverClose=()=>{(0,f.r)(this.toolHelpPopover)},this.handleRFxDetailsEditorHeadingHelpClick=(e,t)=>async()=>{const a=(0,s.e)(e),{helpTemplate:i,learnMoreUrl:o}=await(0,r.c)({rfxName:a,rfxTemplate:e,portal:this.portal,mode:l.a.EDITOR});this.toolHelpPopover=(0,f.s)(this.toolHelpPopover,{helpSrcdoc:i,helpId:"toolDescription",heading:t,referenceElement:this.headerElement,learnMoreUrl:o,offsetDistance:25,offsetSkidding:0}),this.toolHelpPopover.addEventListener("rfxHelpPopoverClose",this.handlePopoverClose)},this.showRfxList=!1,this.mapView=void 0,this.mapLayers=void 0,this.portal=void 0,this.rftItemId="rft-0",this.renderFlag=!1}onPortalChange(e){h.m.portal=e}async onRftItemIdChange(){if(void 0!==this.rftItemId){const e=this.getTemplateInfo(this.rftItemId)??{id:this.rftItemId};void 0!==e.portalItem&&await this.updateTemplateInfoPortalItem(e,this.rftItemId),this.addToActiveRFTList(e)}}handleActionBarClick(e){if(e.detail.templateId===this.rftItemId)switch(e.detail.actionId){case n.E.newTemplate:this.handleNewTemplateClick();break;case n.E.openTemplate:this.handleOpenTemplateClick();break;case n.E.addFunction:this.handleAddFunctionClick();break;case n.E.addConstant:this.handleAddConstantClick();break;case n.E.addRaster:this.handleAddRasterClick()}}async onPanelClose(e){return new Promise((async t=>{const a=this.getTemplateInfo(e);void 0!==a?!0===a.hasUnsavedChanges?t(await this.showUnsavedChangesDialog(a)):(this.handleCloseClick(),t(!0)):t(!0)}))}async canClose(e){return new Promise((t=>{const a=this.getTemplateInfo(e);!0===a.hasUnsavedChanges?t({canClose:!1,message:(0,h.f)(this.strings.unsavedChanges,{rftTitle:a.rftProperties.name})}):t({canClose:!0,message:""})}))}async closeWithoutConfirmation(){return this.handleCloseClick(),Promise.resolve()}async getModelJSON(){const e=await this.rfxCoreServices.getModelDisplayDataCommand.execute(),t=this.rfxEditorCoreElement.getBoundingClientRect(),a=t.left,i=t.top;return e.map((e=>({...e,x:a+e.x,y:i+e.y,points:e.points.map((e=>({...e,x:a+e.x,y:i+e.y})))})))}async componentWillLoad(){({strings:this.strings,dir:this.direction,locale:this.locale}=await(0,m.c)(this.hostElement,(0,i.g)("."))),void 0!==this.portal&&this.onPortalChange(this.portal),this.translatedRFTNamesMap=await async function(){const e=new Map,{rfxFunctions:t}=await(0,s.a)();for(const a of t)(0,d.o)(a)||("CellStatisticsFunction"===a.name&&e.set("LocalFunction__40",a.title),e.set(a.name,a.title));return e}(),this.onRftItemIdChange()}componentDidLoad(){if(void 0!==this.rftItemId){const e=this.getTemplateInfo(this.rftItemId);e.hasLoaded=!1,setTimeout((async()=>{this.isPortalItem()?void 0!==e.rftJSON?(await this.rfxCoreServices.addRFTJSONCommand.execute(e.rftJSON),this.analysisRFTLoaded.emit({id:this.rftItemId,data:e.rftJSON})):await this.loadRFT(this.rftItemId):(e.rftProperties={name:`${this.strings?.newRFT} ${this.rftItemId.split("-")[1]}`},this.updateActiveRFTList(e)),e.hasLoaded=!0}),1)}}disconnectedCallback(){(0,f.r)(this.toolHelpPopover)}isPortalItem(){return-1===this.rftItemId.indexOf("rft")}getTemplateInfo(e){return h.m.activeRFxTemplates.find((t=>t.id===(e??this.rftItemId)))}visibilityReducer({key:e,visible:t}){const a=this.overlayElementsConfig[e];if(a.visible!==t){if(!0===t){const e=Object.values(this.overlayElementsConfig).filter((e=>e.slot===a.slot));e.length>=2&&e.slice(1).forEach((e=>{e.visible=!1}))}a.visible=t,this.scheduleRenderer()}}scheduleRenderer(){this.renderFlag=!this.renderFlag}renderOverlayElements(){const e={addRasterFunctionTitle:this.strings.addRasterFunctionTitle,templatePropertiesTitle:this.strings.templatePropertiesTitle,browseLayerDialogTitle:this.strings.browseLayerDialogTitle},t=this.overlayElementsConfig;return Object.keys(t).map((a=>{const i=t[a];if(!i.visible)return[];const o=i?.builder?.(e);return o}))}_renderEditorCoreUI(){return(0,i.h)("rfx-editor-core",{ref:this.initializeRFxEditorCore,onRfxCoreNodeEditProperties:e=>{e.stopPropagation();const{detail:t}=e;switch(this.handlePopoverClose(),t.dataType){case p.d.raster:this.createRasterNodeEditor(t.node,t.json);break;case p.d.rfxtemplate:if(void 0===t.schema||(0,v.i)({category:t.schema?.category}))return;this.createRfxDetailsEditor({detailsEditorRfxTemplate:t.json,detailsEditorRfxSchema:t.schema,detailsEditorRfxNode:t.node})}},onRfxCoreNodeDuplicate:async e=>{e.stopPropagation();const{detail:t}=e;switch(t.dataType){case p.d.raster:this.handleAddRasterClick({value:t.value});break;case p.d.scalar:this.handleAddConstantClick({value:t.value.value});break;case p.d.rfxtemplate:const e=(0,s.e)(t.json),a=await(0,s.b)(e);this.rfxCoreServices.addRFxFunctionCommand.execute(a)}},onRfxCoreDeprecatedFunctionFound:e=>{e.stopPropagation();const t=this.portal?.isPortal,a=this.portal?.sourceJSON?.helpBase||s.F.learnMoreDocBaseURL,i=(0,m.f)(a,this.locale);let o;if(!0===t){const e=s.F.learnMoreDocDeprecatedEnterpriseHelpID,{restUrl:t}=this.portal;o=`${i}${(0,r.b)(e)}`,o=(0,m.a)(o,t)}else o=(0,r.f)(i,s.F.learnMoreDocDeprecatedHelpID);const{detail:n}=e,l=`${this.strings.deprecatedFunctions}${n}`;this.rfxEditorPanelElement.appendChild((0,u.j)({modalStrings:{content:(0,h.f)(this.strings.deprecatedFunctionAlertContent,{docLink:o}),header:this.strings.deprecatedFunctionAlertHeader,functionNames:l}}))},onRfxCoreNodeDelete:e=>{e.stopPropagation();const t=this.getTemplateInfo();t.hasUnsavedChanges=!0,this.updateActiveRFTList(t)},onRfxCoreNodeValueChange:e=>{e.stopPropagation();const t=this.getTemplateInfo();!0===t.hasLoaded&&(t.hasUnsavedChanges=!0),this.updateActiveRFTList(t)}},this.renderOverlayElements())}render(){return(0,i.h)(i.H,{key:"1287c57a97eaa0c5ca2d0cca73bf3d5c07278ef1",class:E},(0,i.h)("div",{key:"3a585c1764b1ff57051befa98e492ff371d1419b",class:{[S]:!0,[w]:"rtl"===this.direction}},(0,i.h)("slot",{key:"fcd57359eb04cea9dab58c7dceb07a27eeb80dd8",name:b}),(0,i.h)("calcite-panel",{key:"ddaa632ec18cac389392adc100fdf50771ae5e39",class:F,heading:"",ref:e=>this.rfxEditorPanelElement=e},this._renderEditorCoreUI())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.a)(this)}static get watchers(){return{portal:["onPortalChange"],rftItemId:["onRftItemIdChange"]}}};L.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.host{height:100%;width:100%}.content{height:100%;display:flex;overflow:hidden}.action-bar{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-color-border-2)}.menu-actions{display:inline-flex;justify-self:stretch}.header-actions{height:100%}.tooltip{white-space:nowrap}.arcgis--rtl .action-bar{border-width:0 0 0 1px}.editor-container{position:relative;}.overlay-element{z-index:3;box-shadow:0 0 5px rgba(0, 0, 0, 0.2);border-radius:0.25rem}.overlay-panel{max-height:90%;max-width:22rem;width:22rem}.list-wrapper{display:flex;height:100%}";a(5294),a(13661),a(18423),a(21255),a(35431),a(55448),a(2924),a(11840),a(52373),a(440),a(66744),a(19562)},19562:(e,t,a)=>{a.d(t,{C:()=>o,U:()=>i,a:()=>n});const i={Scale:"s",PopoverTimer:60},o={s:"s",m:"m",l:"l"},n={absolute:"absolute",fixed:"fixed"}},28004:(e,t,a)=>{a.d(t,{D:()=>l,J:()=>h,a:()=>u,b:()=>E,c:()=>f,d:()=>v,e:()=>x,f:()=>T,g:()=>S,h:()=>g,i:()=>d,j:()=>c,k:()=>p,l:()=>r,m:()=>I,n:()=>F,o:()=>w,s:()=>R});var i=a(5294),o=(a(13661),a(18423),a(21255),a(35431),a(68708)),n=a(40320),s=(a(588),a(55448),a(2924),a(11840),a(52373),a(33752),a(440),a(66744),a(44345),a(10259));a(33355),a(23795),a(17902),a(56451),a(71802),a(32513),a(36596);const r=[38,39,40,41,42,43,47,54,55,58,66,67,68,69,70,71,72,73,74,75,93,94],l="distanceLegacy",d=({category:e})=>!![l].includes(e),c={local:"LocalFunction",gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},h={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},m={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},p={name:"Raster",isDataset:!0,isPublic:!1,type:h.RASTER_FUNCTION_VARIABLE};function u(e){return null==e?"":e.name||e.datasetName&&e.datasetName.name}function f(e){return e.hasOwnProperty("EsriClassifierDefinitionFile")}function v(e){return e.type&&e.type.toLowerCase().indexOf(h.RECORD_SET.toLowerCase())>=0}function g(e,t){const a=t&&t.value;if(null==a)return;let i;return e.some((e=>{if(e.values&&e.values.indexOf(a)>-1)return i=e.inputArgs,!0})),i}function C(e,t){let a;if(!(0,n.o)(e)&&(a=e.rasterFunctionArguments,1===Object.keys(a).length&&!e.hasArgumentsObject))return!0;const i=t.arguments,o=i&&i.type;return!(!o||o!==h.RASTER_FUNCTION_TEMPLATE&&o!==h.RASTER_FUNCTION_VARIABLE)||void 0}function y(e,t,a){if((0,n.o)(t)||(0,n.o)(a))return;const i=e?.rasterFunctionArguments;return(0,n.o)(i)?void 0:(0,s.l)(t,i)}function T(e,t,a,i){if((0,n.o)(t)&&(0,n.o)(i))return!1;const s=y(e,i=i||t.key,a);if(!(0,n.o)(s)&&s.dataType===o.d.rasterArray)return!0;if(!t)return;const r=t.value;if(r&&r.elements){return r.elements.some((e=>e&&(e.isDataset||e.type===h.RASTER_FUNCTION_TEMPLATE||e.value&&e.value.type===h.RASTER_FUNCTION_TEMPLATE)))}r&&Array.isArray(r)&&r.some((e=>e&&e.name&&e.url))}function E(e,t,a){t.value||(t.value={elements:[],type:h.ARGUMENT_ARRAY});let i=t.value&&t.value.elements?t.value.elements:t.value;return i&&Array.isArray(i)?void 0!==a?i[a]=e:(i.push(e),a=i.length-1):(i=[e],a=0),t.value&&t.value.elements?t.value.elements=i:t.value=i,a}function S(e,t,a){let i,o;if("string"==typeof t?i=t:(i=t.key,o=t.index),(0,n.o)(i)||(0,n.o)(a))return;const s=a.arguments,r=s&&s.type,l=i&&i.toLowerCase();let d;if(C(e,a))return r!==h.RASTER_FUNCTION_TEMPLATE&&!s.isDataset||"raster"!==l?r===h.RASTER_FUNCTION_VARIABLE&&"rasters"===l&&(d=void 0!==o?function(e,t){if((0,n.o)(t)||void 0===e)return;const a=t.value&&t.value.elements?t.value.elements:t.value;return a&&a.length?a[e]:void 0}(o,s):s):d=s,d;if(d=s[i],void 0!==o&&T(e,d,a,i)){const e=d.value&&d.value.elements?d.value.elements:d.value;d=e&&e.length?e[o]:void 0}return d}function x(e,t){if((0,n.o)(t))return;const a=[],o=t.arguments,s=o&&o.type;if(C(e,t)){let e,t=i.clone(o);return e=s===h.RASTER_FUNCTION_TEMPLATE||t.isDataset?"Raster":"Rasters",(0,n.o)(t)?t={key:e}:t.key=e,a.push(t),a}return Object.keys(o).forEach((e=>{if(e===m.MATCH_VARIABLE||e===m.UNION_DIMENSION)return;let t=i.clone(o[e]);(0,n.g)(t)&&((0,n.o)(t)?t={key:e}:t.key=e,a.push(t))})),a}function R(e,t,a,i,o){if((0,n.o)(t)||(0,n.o)(a)||(0,n.o)(i))return;const s=t.arguments,r=T(e,s,t,i)&&void 0!==o;if(C(e,t))r?o=E(a,s,o):t.arguments=a;else{const e=s[i];r?o=E(a,e,o):s[i]=a}return a.value&&"Scalar"===a.value.type&&(0,n.o)(a.name)&&(a.name=r?t.function.type.toLowerCase()===c.local.toLowerCase()&&o>0?`InRaster${o+1}`:`Raster${o>0?o+1:""}`:y(e,i,t).displayName||i),{key:i,index:o}}function I(e){return e.dataType===o.d.raster||e.dataType===o.d.rfxtemplate}function F(e){return e.dataType===o.d.scalar}const w=(e,t,a)=>{let i=e;!function e(o){if(o>=t.length)return void a(i);const n=t[o];let s;if("shadowRoot"===n)s=i?.shadowRoot;else if(n.startsWith("children[")){const e=parseInt(n.match(/\d+/)[0],10);s=i.children[e]}s?(i=s,e(o+1)):requestAnimationFrame((()=>e(o)))}(0)}},96898:(e,t,a)=>{a.d(t,{I:()=>l,a:()=>T,b:()=>C,c:()=>m,d:()=>x,e:()=>S,f:()=>v,g:()=>y,h:()=>g,i:()=>I,j:()=>R,k:()=>u,l:()=>p,m:()=>f,u:()=>h});var i=a(33752),o=a(33355),n=a(40320),s=a(19562);const r={JSON:"json",XML:"xml"},l={RASTER_FUNCTION_TEMPLATE:"Raster function template"};function d(e){const t=new FormData,{itemProperties:a,itemData:i}=e,{title:o,description:s,tags:d,type:c,snippet:h,properties:m,categories:p}=a,u=a.fileType||r.JSON;if(t.append("title",o),(0,n.o)(i)){let e="";c===l.RASTER_FUNCTION_TEMPLATE&&(e="rft");const a=`${o}.${void 0!==e?e:""}${u}`;t.append("file",i,a),t.append("name",a)}return t.append("type",c),void 0!==s&&t.append("description",s),void 0!==h&&t.append("snippet",h),(0,n.o)(d)||t.append("tags",d.join(",")),void 0!==m&&t.append("properties",JSON.stringify(m)),(0,n.o)(p)||t.append("categories",p.join(",")),t.append("f","json"),t}async function c(e,t,a){const{thumbnail:o,shareOptions:s}=a,r={success:!0,errors:[]};if(e.data){const a=e.data.id,l=new i.default({id:a,portal:t});return r.item=l,l.load().then((()=>(void 0!==o&&l.updateThumbnail({thumbnail:o}),(0,n.o)(s),Promise.resolve(r))))}}function h(e,t){((0,n.o)(t)||(0,n.o)(e))&&Promise.reject(new Error("Item data or item not present"));const a=e.portal,i=e.userItemUrl??`${a.user.userContentUrl}/items/${e.id}`;return(0,o.r)(`${i}/update`,{body:d(t)}).then((e=>c(e,a,t.itemProperties)),(e=>({success:!1,errors:[e]})))}function m(e,t){((0,n.o)(e)||(0,n.o)(t))&&Promise.reject(new Error("Item data or portal not present"));const{itemProperties:a}=e,i=t.user;if((0,n.o)(i))return;const{ownerFolder:s}=a,r=void 0!==s&&s.id!==s.title?s.id:void 0,l=(0,n.o)(r)?`${i.userContentUrl}/addItem`:`${i.userContentUrl}/${r}/addItem`;return(0,o.r)(l,{body:d(e)}).then((e=>c(e,t,a)),(e=>({success:!1,errors:[e]})))}const p=({label:e,open:t})=>{const a=document.createElement("rfx-section");return a.label=e,a.open=t,a},u=({content:e,unsupportedWarningComponent:t,title:a,isFunctionChain:i})=>{const o=document.createElement("calcite-block");return o.open=!0,!0===i&&(o.heading=a,o.collapsible=!0,o.headingLevel=3),(0,n.o)(t)||o.appendChild(t),o.appendChild(e),o},f=({label:e,hideHelp:t=!1,onHelpActionClick:a})=>{const i=document.createElement("rfx-label");return i.label=e,i.hideHelp=t,i.addEventListener("rfxLabelHelpActionClick",a),i},v=({portal:e,portalItem:t,itemProps:a,onCancel:i,onSave:o})=>{const n=document.createElement("rfx-save-modal");return n.portal=e,n.portalItem=t,n.itemProps=a,n.addEventListener("cancelClick",i),n.addEventListener("saveClick",o),n},g=({portal:e,portalItem:t})=>{const a=document.createElement("rfx-share-modal");return a.portal=e,a.portalItem=t,a},C=({modalStrings:{header:e},portal:t,user:a,filter:i,hideFilters:o,selectionMode:n,onClose:s,onSelection:r})=>{const l=document.createElement("rfx-item-browser");return l.portal=t,l.user=a,l.header=e,l.filter=i,l.hideFilters=o,l.selectionMode=n??"single",l.addEventListener("rfxItemBrowserClose",s),l.addEventListener("rfxItemBrowserSelection",r),l},y=({templateProperties:e,modalStrings:{header:t},onCancel:a,onSave:i})=>{const o=document.createElement("rfx-modal"),n=document.createElement("div");n.innerHTML=t,n.slot="header",o.appendChild(n);const s=document.createElement("rfx-template-editor");s.value=e;const r=document.createElement("div");return r.slot="content",r.style.height="50vh",r.appendChild(s),o.appendChild(r),o.addEventListener("rfxModalSecondaryClick",a),o.addEventListener("rfxModalPrimaryClick",(()=>{i(s.value)})),o.addEventListener("rfxModalClose",a),o},T=(e,t,a)=>{const i=document.createElement(e);var o,n;return o=i,n=a,Object.keys(n).forEach((e=>{o.setAttribute(e,n[e])})),i.innerHTML=t,i},E={modal:{kind:"warning"},header:{slot:"header",style:"\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n    "},headerIcon:{icon:"exclamation-mark-triangle-f",style:"\n      margin: 0 1rem;\n      --calcite-ui-icon-color: var(--calcite-color-status-warning);\n    "},content:{slot:"content"}},S=({modalStrings:{header:e,content:t}})=>{const a=T("rfx-modal","",E.modal);a.showPrimaryButton=!1;const i=T("div","",E.header),o=T("div",e,{}),n=T("calcite-icon","",E.headerIcon);i.appendChild(n),i.appendChild(o);const s=T("div","",E.content);return s.appendChild(T("p",t,{})),a.appendChild(i),a.appendChild(s),a.addEventListener("rfxModalSecondaryClick",(()=>{a.remove(),a.open=!1})),a.addEventListener("rfxModalClose",(()=>{a.remove(),a.open=!1})),a},x=({modalStrings:{content:e}})=>{const t=T("calcite-alert",e,{kind:"success",scale:s.C.l,open:!0,label:"save success"});t.autoClose=!0;const a=T("div",e,{slot:"message"});return t.appendChild(a),t},R=({modalStrings:{content:e,header:t,functionNames:a}})=>{const i=T("calcite-alert",e,{kind:"warning",scale:s.C.m,open:!0,label:"deprecate function"});i.autoClose=!0;const o=T("div",t,{slot:"title"}),n=T("div",e,{slot:"message"}),r=T("p",a,{});return n.appendChild(r),i.appendChild(n),i.appendChild(o),i},I=({heading:e,handlePanelClose:t,handlePanelOk:a,inputLayers:i,layerValue:o,createLayerBrowse:n})=>{let s;const r=T("rfx-modal","",{open:!0});r.addEventListener("rfxModalClose",t),r.setAttribute("style","--calcite-modal-height: 32rem"),r.addEventListener("rfxModalPrimaryClick",(async()=>{const e=await(s?.getRasterValue());a({rasterValue:e})})),r.addEventListener("rfxModalSecondaryClick",t);const l=T("div",e,{slot:"header"}),d=T("div","",{slot:"content"});return r.appendChild(l),s=document.createElement("rfx-select-layer-panel"),s.value=o?.value,s.inputLayers=i,r.addEventListener("rfxlayerSelectBrowseLayerClick",n),d.appendChild(s),r.appendChild(d),r}}}]);