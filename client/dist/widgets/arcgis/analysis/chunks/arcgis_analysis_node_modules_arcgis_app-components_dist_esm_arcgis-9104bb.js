/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9104bb.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9104bb"],{68973:(e,t,i)=>{i.r(t),i.d(t,{arcgis_layer_view:()=>W,arcgis_layer_view_browse_layer:()=>G,arcgis_layer_view_create:()=>Y,arcgis_layer_view_definition:()=>re,arcgis_layer_view_join:()=>me,arcgis_layer_view_join_add_selection:()=>Ee,arcgis_layer_view_join_browse_layer:()=>Se,arcgis_layer_view_join_config:()=>qe,arcgis_layer_view_join_create:()=>Xe,arcgis_layer_view_join_target_selection:()=>st,arcgis_layer_view_msg:()=>rt,arcgis_layer_view_overview:()=>ht,arcgis_layer_view_selection:()=>yt,arcgis_layer_view_swap_source:()=>St});var s=i(20536),r=i(37568),a=i(98034),o=i(98072),n=i(91616),l=i(34752),d=i(38973),c=i(76776),h=i(79241);i(91102),i(73807),i(99004),i(74129),i(44090),i(10699);const p="panel",u="footer",g="error-content";var m,f;function y(e){if(!e||!e.filter)return!0;return!["geometry","distance","objectIds","timeExtent","where"].some((t=>e.filter.hasOwnProperty(t)))}function v(e,t,i){const{backgroundTheme:s}=i;let r="light"===s?100:65;e.featureEffect=new t({filter:{},excludedEffect:`grayscale(100%) opacity(30%) brightness(${r}%)`,excludedLabelsVisible:!0})}function w(e,t){return e===t||Math.round(1e6*e)/1e6==Math.round(1e6*t)/1e6}function b(e,t){const i=["oid","esriFieldTypeOID","global-id","esriFieldTypeGlobalID","geometry","esriFieldTypeGeometry"];let s;if(t)s=t.fields;else{const{definitionLayerId:t}=e,i=R(t,e);s=(null==i?void 0:i.fields)||S(t,e).fields}return s.filter((e=>i.indexOf(e.type)>-1||!e.nullable&&!(0,o.i)(e.defaultValue))).map((e=>e.name))}function I(e,t){const{viewProps:i}=t;return null==i?void 0:i.find((t=>e===t.layerId))}function L(e){const{viewProps:t}=e;t&&(e.viewProps=t.filter((e=>e.filter||e.aoi||e.fields)),e.viewProps.length||(e.viewProps=void 0))}function E(e,t,i){var s;let r=I(e,i);r||(r={layerId:e});const a=Object.assign(Object.assign({},r),t);i.viewProps=null===(s=i.viewProps)||void 0===s?void 0:s.filter((t=>t.layerId!==e)),i.viewProps=i.viewProps||[],i.viewProps.push(a)}function S(e,t){const{layer:i}=t;return"group"===i.type?O(i).find((t=>t.layerId===e)):i}async function N(e,t,i){const s=S(t,i);if(s.isTable)return new Promise((e=>{e()}));const[r]=await(0,a.l)(["esri/layers/support/FeatureEffect"]);if(e){let t=0;const a=setInterval((()=>{var o;(null===(o=s.featureEffect)||void 0===o?void 0:o.filter)||v(s,r,i),s.featureEffect.filter.where=e,t++,3===t&&clearInterval(a),s.featureEffect=s.featureEffect.clone()}),200)}else s.featureEffect.filter.where=null,y(s.featureEffect)&&(s.featureEffect=null),s.featureEffect=s.featureEffect.clone()}async function C(e,t,i){const s=S(t,i),[r,o,n]=await(0,a.l)(["esri/layers/support/FeatureEffect","esri/geometry/Polygon","esri/geometry/Extent"]);if(e){let t=0;const a=setInterval((()=>{var l;(null===(l=s.featureEffect)||void 0===l?void 0:l.filter)||v(s,r,i);const d="polygon"===e.type?o.fromJSON(e.toJSON()):n.fromJSON(e.toJSON());s.featureEffect.filter.geometry=d,t++,3===t&&clearInterval(a),s.featureEffect=s.featureEffect.clone()}),200)}else s.featureEffect.filter.geometry=null,y(s.featureEffect)&&(s.featureEffect=null),s.featureEffect=s.featureEffect.clone()}function k(e){var t;const{url:i}=e;if(!i)return"";const s=null===(t=["/FeatureServer","/MapServer"].filter((e=>i.toLowerCase().indexOf(e.toLowerCase())>-1)))||void 0===t?void 0:t[0];let r="";return s&&(r=i.substring(0,i.indexOf(s)),r=r.substring(r.lastIndexOf("/")+1,r.length)),r}function O(e){var t;const i=x(e);return(null==i?void 0:i.length)&&(null===(t=e.tables)||void 0===t?void 0:t.length)?i.concat(e.tables):(null==i?void 0:i.length)?i:e.tables}function x(e){var t;return null===(t=e.layers)||void 0===t?void 0:t.filter((e=>"catalog"!==e.type))}async function F(e){let{layer:t,layerIds:i,modules:s}=e;const{PortalItem:r}=s,{view:o,swapItem:n,swapLayer:l}=e,[d]=await(0,a.l)(["esri/request"]);try{await async function(e,t){var i,s;const{layer:r,viewItem:a,adminServiceInfo:o}=e,n=r.portalItem,l=[];null===(i=null==o?void 0:o.layers)||void 0===i||i.forEach((e=>{l.push(e.id)}));const d=[];if(null===(s=null==o?void 0:o.tables)||void 0===s||s.forEach((e=>{d.push(e.id)})),l.length||d.length){const e=`${a.url.replace("rest/services","rest/admin/services")}/deleteFromDefinition`;await M(e,{layers:null==l?void 0:l.map((e=>({id:e}))),tables:null==d?void 0:d.map((e=>({id:e})))},n,t)}return new Promise((e=>{e()}))}(e,d);const a=r.fromJSON(n);await a.load(),e.layerItem=a,e.layer=l,e.swapItem=e.swapLayer=void 0;const c=e.viewItem;if(e.viewItem=void 0,e.adminServiceInfo=void 0,await j(e),await $(e,{serviceurl:c.url},d),e.viewItem=c,e.adminServiceInfo=void 0,await j(e),o.map.remove(t),t=e.layer,"group"===t.type){const e=x(t);(null==e?void 0:e.length)&&(i&&e.forEach((e=>{e.visible=i.indexOf(e.layerId)>-1})),o.map.add(t)),null==e||e.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))}else t.isTable||o.map.add(t),t.popupTemplate=t.createPopupTemplate();O(e.adminServiceInfo).forEach((async t=>{var i,r,a,o;const n=t.viewDefinitionQuery;n&&N(n,t.id,e);const l=null===(o=null===(a=null===(r=null===(i=t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===r?void 0:r.table)||void 0===a?void 0:a.filter)||void 0===o?void 0:o.value;if(l){C(l.geometry.rings?s.Polygon.fromJSON(l.geometry):s.Extent.fromJSON(l.geometry),t.id,e)}}))}catch(e){return new Promise(((e,t)=>{t(new Error("swap source failed"))}))}}function T(e,t,i){const{strings:s}=i;return e.geometryType!==t.geometryType?(console.log("layer geometry type does not match"),s.msg.swapErrors.geometryType):JSON.stringify(e.spatialReference.toJSON())!==JSON.stringify(t.spatialReference.toJSON())?(console.log("layer spatial reference does not match"),s.msg.swapErrors.spatialReference):null}function P(e,t,i){const{strings:s}=i,r=b(i,e),a=I(e.layerId,i);let o;if(null==a?void 0:a.fields){const t=a.fields.concat(r);o=e.fields.filter((e=>t.indexOf(e.name)>-1))}else o=e.fields;for(let i=0;i<o.length;i++){const r=o[i],a=t.fields.find((e=>r.name===e.name));if(!a)return console.log("layer",e.layerId,e.title,": field",r.name,"missing in new source layer"),s.msg.swapErrors.missingField;if(r.type!==a.type)return console.log("layer",e.layerId,e.title,": field type of",r.name,"different in layers"),s.msg.swapErrors.fieldType}return null}async function j(e,t){const{layer:i,viewItem:s,adminServiceInfo:r}=e;if(r)return;let o=((null==s?void 0:s.url)||i.portalItem.url).replace("/rest/services","/rest/admin/services");t&&(o+=`${o.indexOf("?")>-1?"&":"?"}_ts=${(new Date).getTime()}`);try{const[t,i]=await(0,a.l)(["esri/identity/IdentityManager","esri/request"]);await t.getCredential(o);const s=await i(o,{query:{f:"json"}});e.adminServiceInfo=s.data}catch(e){return new Promise(((e,t)=>{t(new Error("could not get admin info"))}))}}function R(e,t){var i,s;const{adminServiceInfo:r}=t,a=null===(i=null==r?void 0:r.layers)||void 0===i?void 0:i.find((t=>t.id===e));return a||(null===(s=null==r?void 0:r.tables)||void 0===s?void 0:s.find((t=>t.id===e)))}function V(e){const{layer:t,layerIds:i,adminServiceInfo:s}=e;if("group"===t.type){const r=s&&O(s);return!(s&&r.length===i.length&&r.every((e=>i.indexOf(e.id)>-1)))||O(t).filter((e=>i.indexOf(e.layerId)>-1)).some((t=>D(t.layerId,e)))}return D(t.layerId,e)}function D(e,t){var i,s,r,a;const{viewItem:o}=t,n=S(e,t),l=I(e,t),d=R(e,t),c=o&&(null==d?void 0:d.fields)?d.fields.filter((e=>e.visible)):(null==d?void 0:d.fields)||n.fields;if(l){if(l.filter!==(null==d?void 0:d.viewDefinitionQuery)||l.fields&&l.fields.length!==c.length||!l.fields&&c.length!==n.fields.length||!n.isTable&&!function(e,t){var i,s,r,a;const o=null===(a=null===(r=null===(s=null===(i=null==t?void 0:t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===a?void 0:a.value;if(!(null==e?void 0:e.aoi)&&!o)return!0;if((null==e?void 0:e.aoi)&&!o||!(null==e?void 0:e.aoi)&&o)return!1;if(e.aoi.rings&&"esriGeometryPolygon"!==o.geometryType||e.aoi.xmin&&"esriGeometryEnvelope"!==o.geometryType)return!1;if(e.aoi.xmin){const t=e.aoi,i=o.geometry;return!!(w(t.xmin,i.xmin)&&w(t.xmax,i.xmax)&&w(t.ymin,i.ymin)&&w(t.ymax,i.ymax))}if(e.aoi.rings){if(e.aoi.rings[0].length!==o.geometry.rings[0].length)return!1;return e.aoi.rings[0].every((e=>o.geometry.rings[0].some((t=>w(e[0],t[0])&&w(e[1],t[1])))))}}(l,d))return!0}else if((null==d?void 0:d.viewDefinitionQuery)||c.length<n.fields.length||!n.isTable&&(null===(a=null===(r=null===(s=null===(i=null==d?void 0:d.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===a?void 0:a.value))return!0;return!1}async function _(e,t){const[i]=await(0,a.l)(["esri/request"]);try{const s=await async function(e,t,i){var s,r,a;const{layer:o,layerIds:n}=e,l=o.portalItem,d=l.portal;let c=S(n[0],e);const h=`${d.restUrl}/content/users/${l.owner}/createService`,p={name:t.title.replace(/ /g,"_"),isView:!0,sourceSchemaChangesAllowed:!0,isUpdatableView:!0,spatialReference:null===(s=c.sourceJSON.extent)||void 0===s?void 0:s.spatialReference,initialExtent:c.sourceJSON.extent,capabilities:"Query",preserveLayerIds:!0};if(d.isPortal){const t=function(e){var t,i,s,r;const{adminServiceInfo:a}=e,o=(null===(i=null===(t=null==a?void 0:a.adminServiceInfo)||void 0===t?void 0:t.database)||void 0===i?void 0:i.datasource)||{},n=(null===(s=null==o?void 0:o.name)||void 0===s?void 0:s.indexOf("/nosqlDatabases"))>-1?"spatiotemporal":(null===(r=null==o?void 0:o.name)||void 0===r?void 0:r.indexOf("/enterpriseDatabases"))>-1?"relational":null;return n}(e);t&&(p.options={dataSourceType:t})}let u={createParameters:JSON.stringify(p),outputType:"featureService",tags:(null===(r=t.tags)||void 0===r?void 0:r.length)?t.tags.toString():void 0,snippet:t.summary,categories:null===(a=t.categories)||void 0===a?void 0:a.join(","),isView:!0};try{return(await i(h,{query:Object.assign(Object.assign({},u),{f:"json",token:d.credential.token}),method:"post",responseType:"json"})).data}catch(e){return new Promise(((t,i)=>{e.message.indexOf(" already exists ")>-1?i(new Error("service name already exists")):i(new Error("create service failed"))}))}}(e,t,i);return await $(e,s,i),await async function(e,t,i,s){var r,a,o,n,l,d,c,h,p,u,g,m,f,y;const{layer:v,layerIds:w}=e,b=v.portalItem,I=b.portal,L=await v.portalItem.fetchData(),E=(null==L?void 0:L.layers)||(null==L?void 0:L.tables);E&&(L.layers=null===(r=L.layers)||void 0===r?void 0:r.filter((e=>w.indexOf(e.id)>-1)),L.tables=null===(a=L.tables)||void 0===a?void 0:a.filter((e=>w.indexOf(e.id)>-1)),"group"===v.type&&(null===(o=x(v))||void 0===o?void 0:o.length)&&(L.layers=L.layers||void 0),"group"===v.type&&(null===(n=v.tables)||void 0===n?void 0:n.length)&&(L.tables=L.tables||void 0),null===(l=L.layers)||void 0===l||l.forEach((e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)})),null===(d=L.tables)||void 0===d||d.forEach((e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)})));const S=`${I.restUrl}/content/users/${b.owner}/items/${t.itemId}/update`,N={title:i.title,tags:(null===(c=i.tags)||void 0===c?void 0:c.length)?i.tags.toString():void 0,snippet:i.summary,categories:null===(h=i.categories)||void 0===h?void 0:h.join(",")};E&&(N.text=JSON.stringify(L));("group"===v.type&&(null===(m=null===(g=null===(u=null===(p=x(v))||void 0===p?void 0:p.getItemAt(0))||void 0===u?void 0:u.fullExtent)||void 0===g?void 0:g.spatialReference)||void 0===m?void 0:m.wkt)||"feature"===v.type&&(null===(y=null===(f=v.fullExtent)||void 0===f?void 0:f.spatialReference)||void 0===y?void 0:y.wkt))&&setTimeout((()=>{const e={extent:`${b.extent.xmin},${b.extent.ymin},${b.extent.xmax},${b.extent.ymax}`};s(S,{query:Object.assign(Object.assign({},e),{f:"json",token:I.credential.token}),method:"post",responseType:"json"})}),7e3);return await s(S,{query:Object.assign(Object.assign({},N),{f:"json",token:I.credential.token}),method:"post",responseType:"json"})}(e,s,t,i),await async function(e,t,i,s){const{layer:r}=e,a=r.portalItem,{portal:o}=a;if(!i.folder||!i.folder.id||i.folder.id===a.owner)return;const n=`${o.restUrl}/content/users/${a.owner}/items/${t.itemId}/move`,l={folder:i.folder.id};return await s(n,{query:Object.assign(Object.assign({},l),{f:"json",token:o.credential.token}),method:"post",responseType:"json"})}(e,s,t,i),s.itemId}catch(e){return new Promise(((t,i)=>{"service name already exists"===e.message?i(e):i(new Error("createView failed"))}))}}async function A(e){const{viewItem:t}=e,[i]=await(0,a.l)(["esri/request"]);try{const{addLayerIds:s,deleteLayerIds:r}=await async function(e,t,i){var s,r,a,o;const{layer:n,layerIds:l,adminServiceInfo:d}=e,c=n.portalItem,{portal:h}=c,p=[],u=[];try{const g=t.url.replace("rest/services","rest/admin/services");if("group"===n.type){null===(s=null==d?void 0:d.layers)||void 0===s||s.forEach((e=>{-1===l.indexOf(e.id)&&p.push(e.id)}));const t=[];if(null===(r=null==d?void 0:d.tables)||void 0===r||r.forEach((e=>{-1===l.indexOf(e.id)&&t.push(e.id)})),p.length||t.length){const e=`${g}/deleteFromDefinition`;await M(e,{layers:null==p?void 0:p.map((e=>({id:e}))),tables:null==t?void 0:t.map((e=>({id:e})))},c,i);let s=[];if(O(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((async e=>{var i,r;if(null===(i=e.relationships)||void 0===i?void 0:i.length){const i=O(d).find((t=>t.id===e.layerId));if(null===(r=null==i?void 0:i.relationships)||void 0===r?void 0:r.length){const r=i.relationships.filter((e=>p.indexOf(e.relatedTableId)>-1||t.indexOf(e.relatedTableId)>-1));if(r.length){const t={};t.relationships=r;const i=`${g}/${e.layerId}/deleteFromDefinition`;s.push({delFromDefUrl:i,json:t})}}}})),s.length)if(h.isPortal)for(const e of s)await M(e.delFromDefUrl,e.json,c,i);else{const e=[];s.forEach((t=>{e.push(M(t.delFromDefUrl,t.json,c,i))})),await Promise.all(e)}}if(l.forEach((e=>{O(d).some((t=>t.id===e))||u.push(e)})),u.length){const t=null===(a=x(n))||void 0===a?void 0:a.filter((e=>u.indexOf(e.layerId)>-1)).map((t=>U(t,e))).toArray().reverse(),s=null===(o=n.tables)||void 0===o?void 0:o.filter((e=>u.indexOf(e.layerId)>-1)).map((t=>U(t,e))).toArray().reverse();await J(`${g}/addToDefinition`,{layers:t,tables:s},i,e);const r=[];if(O(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((async e=>{var t,i;if(null===(t=e.relationships)||void 0===t?void 0:t.length){const t=O(d).find((t=>t.id===e.layerId));if(t&&(null===(i=e.relationships)||void 0===i?void 0:i.length)!==t.relationships.length){const t={},i=e.relationships.filter((e=>u.indexOf(e.relatedTableId)>-1));t.relationships=i;const s=`${g}/${e.layerId}/addToDefinition`;r.push({addToDefUrl:s,json:t})}}})),r.length)if(h.isPortal)for(const t of r)await J(t.addToDefUrl,t.json,i,e);else{const t=[];r.forEach((s=>{t.push(J(s.addToDefUrl,s.json,i,e))})),await Promise.all(t)}}const m=[],f=[],y=async(t,i)=>{const s=`${g}/${i.layerId}/updateDefinition`,r=await q(i,e);return t.push({updateDefUrl:s,json:r}),Promise.resolve()};if(O(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((t=>{D(t.layerId,e)&&f.push(y(m,t))})),await Promise.all(f),m.length)if(h.isPortal)for(const t of m)await B(t.updateDefUrl,t.json,i,e);else{const t=[];m.forEach((s=>{t.push(B(s.updateDefUrl,s.json,i,e))})),await Promise.all(t)}}else if(D(n.layerId,e)){const t=await q(n,e),s=`${g}/${n.layerId}/updateDefinition`;await B(s,t,i,e)}return new Promise((e=>{e({addLayerIds:u,deleteLayerIds:p})}))}catch(e){return console.error(e),new Promise(((e,t)=>{t(new Error("updateDefinition failed"))}))}}(e,t,i);return await async function(e,t,i,s){var r,a,o,n,l,d,c,h;if(!t.length&&!i.length)return new Promise((e=>{e()}));const{layer:p,viewItem:u}=e,g=p.portalItem,m=g.portal,f=await p.portalItem.fetchData();let y=await u.fetchData();if(!(f&&(f.layers||f.tables)||y&&(y.layers||y.tables)))return new Promise((e=>{e()}));i.length&&((null===(r=null==y?void 0:y.layers)||void 0===r?void 0:r.length)&&(y.layers=y.layers.filter((e=>-1===i.indexOf(e.id)))),(null===(a=null==y?void 0:y.tables)||void 0===a?void 0:a.length)&&(y.tables=y.tables.filter((e=>-1===i.indexOf(e.id)))));const v=!!(null===(o=null==y?void 0:y.layers)||void 0===o?void 0:o.length)||!!(null===(n=null==y?void 0:y.tables)||void 0===n?void 0:n.length);if(t.length){const i=[],s=[];if(t.forEach((t=>{if(S(t,e).isTable){let e;(null==f?void 0:f.tables)&&(e=f.tables.find((e=>e.id===t)),(null==e?void 0:e.layerDefinition)&&(e.layerDefinition.definitionExpression=void 0)),!e&&v&&(e={id:t}),e&&s.push(e)}else{let e;(null==f?void 0:f.layers)&&(e=f.layers.find((e=>e.id===t)),(null==e?void 0:e.layerDefinition)&&(e.layerDefinition.definitionExpression=void 0)),!e&&v&&(e={id:t}),e&&i.push(e)}})),null==i?void 0:i.length){y=y||{},y.layers=(y.layers||[]).concat(i);const e=[];null===(l=p.layers)||void 0===l||l.forEach((t=>{e.unshift(t.layerId)})),y.layers.sort(((t,i)=>e.indexOf(t.id)<e.indexOf(i.id)?-1:1))}if(null==s?void 0:s.length){y=y||{},y.tables=(y.tables||[]).concat(s);const e=[];null===(d=p.tables)||void 0===d||d.forEach((t=>{e.unshift(t.layerId)})),y.tables.sort(((t,i)=>e.indexOf(t.id)<e.indexOf(i.id)?-1:1))}}const w=`${m.restUrl}/content/users/${g.owner}/items/${u.id}/update`,b={tags:(null===(c=u.tags)||void 0===c?void 0:c.length)?u.tags.toString():void 0,snippet:u.snippet,categories:null===(h=u.categories)||void 0===h?void 0:h.join(","),text:JSON.stringify(y)};return await s(w,{query:Object.assign(Object.assign({},b),{f:"json",token:m.credential.token}),method:"post",responseType:"json"})}(e,s,r,i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateView failed"))}))}}async function $(e,t,i){var s,r;const{layer:a,layerIds:o}=e;let n,l;"group"===a.type?(n=null===(s=x(a))||void 0===s?void 0:s.filter((e=>o.indexOf(e.layerId)>-1)).map((t=>U(t,e))).toArray().reverse(),l=null===(r=a.tables)||void 0===r?void 0:r.filter((e=>o.indexOf(e.layerId)>-1)).map((t=>U(t,e))).toArray().reverse()):a.isTable?l=[U(a,e)]:n=[U(a,e)];try{const s=t.serviceurl.replace("rest/services","rest/admin/services");return await J(`${s}/addToDefinition`,{layers:n,tables:l},i,e),await async function(e,t,i){const{layer:s,layerIds:r}=e,{portalItem:a}=s,{portal:o}=a,n=t.serviceurl.replace("rest/services","rest/admin/services");try{if("group"===s.type){const t=[],a=O(s).filter((e=>r.indexOf(e.layerId)>-1));for(let i=0;i<a.length;i++){const s=a.getItemAt(i);if(D(s.layerId,e)){const i=await q(s,e),r=`${n}/${s.layerId}/updateDefinition`;t.push({updateDefUrl:r,json:i})}}if(t.length)if(o.isPortal)for(const s of t)await B(s.updateDefUrl,s.json,i,e);else{const s=[];t.forEach((t=>{s.push(B(t.updateDefUrl,t.json,i,e))})),await Promise.all(s)}}else if(D(s.layerId,e)){const t=await q(s,e),r=`${n}/${s.layerId}/updateDefinition`;await B(r,t,i,e)}return new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateDefinitions failed"))}))}}(e,t,i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("initialAddToDefinition failed"))}))}}async function B(e,t,i,s,r=!1){var a;const{layer:o,viewItem:n}=s,l={updateDefinition:JSON.stringify(t)};try{const t=o.portalItem.portal,s=(null==n?void 0:n.typeKeywords.indexOf("IoTFeatureLayer"))>-1,r=await i(e,{query:Object.assign(Object.assign({},l),{f:"json",async:!t.isPortal&&!s,token:t.credential.token}),method:"post",responseType:"json"});if(t.isPortal||s)return new Promise((e=>{e()}));try{return await H(null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.statusURL,{f:"json",token:t.credential.token},i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateDefinition request failed (poll)"))}))}}catch(a){return r?new Promise(((e,t)=>{t(new Error("updateDefinition request failed"))})):B(e,t,i,s,!0)}}async function J(e,t,i,s,r=!1){var a;const{layer:o,viewItem:n}=s,l={addToDefinition:JSON.stringify(t)};try{const t=o.portalItem.portal,s=(null==n?void 0:n.typeKeywords.indexOf("IoTFeatureLayer"))>-1,r=await i(e,{query:Object.assign(Object.assign({},l),{f:"json",async:!t.isPortal&&!s,token:t.credential.token}),method:"post",responseType:"json"});if(t.isPortal||s)return new Promise((e=>{e()}));try{return await H(null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.statusURL,{f:"json",token:t.credential.token},i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition request failed (poll)"))}))}}catch(a){return r?new Promise(((e,t)=>{t(new Error("addToDefinition request failed"))})):J(e,t,i,s,!0)}}async function M(e,t,i,s,r=!1){const a={deleteFromDefinition:JSON.stringify(t)};try{return await s(e,{query:Object.assign(Object.assign({},a),{f:"json",token:i.portal.credential.token}),method:"post",responseType:"json"}),new Promise((e=>{e()}))}catch(a){return r?new Promise(((e,t)=>{t(new Error("deleteFromDefinition request failed"))})):M(e,t,i,s,!0)}}function U(e,t){const{layer:i,layerItem:s}=t,r=e.sourceJSON;return delete r.indexes,delete r.fields,delete r.serviceItemId,delete r.serverGens,delete r.relationships,r.url=`${e.url}/${e.layerId}?token=${i.portalItem.portal.credential.token}`,r.adminLayerInfo={viewLayerDefinition:{sourceServiceName:k(s),sourceLayerId:e.layerId,sourceLayerFields:"*"}},r}async function q(e,t){var i,s,r,a,n,l,d,c,h;const{modules:p}=t,u={},g=I(e.layerId,t);if(g){if(u.viewDefinitionQuery=g.filter||"",g.aoi){let t=g.aoi;if(m=t.spatialReference,f=e.spatialReference,y=[102113,102100,3857],!(m&&f&&(0,o.i)(m.wkid)&&(0,o.i)(f.wkid)&&y.indexOf(m.wkid)>-1&&y.indexOf(f.wkid)>-1||m&&f&&((0,o.i)(m.wkid)&&(0,o.i)(f.wkid)&&m.wkid==f.wkid||(0,o.i)(m.latestWkid)&&(0,o.i)(f.wkid)&&m.latestWkid==f.wkid||(0,o.i)(m.wkid)&&(0,o.i)(f.latestWkid)&&m.wkid==f.latestWkid||(0,o.i)(m.latestWkid)&&(0,o.i)(f.latestWkid)&&m.latestWkid==f.latestWkid)||m&&f&&(0,o.i)(m.wkt)&&(0,o.i)(f.wkt)&&m.wkt===f.wkt)){await p.projection.load();const s=t.rings?p.Polygon.fromJSON(t):p.Extent.fromJSON(t);t=null===(i=p.projection.project(s,e.spatialReference))||void 0===i?void 0:i.toJSON()}const s=t.rings?"esriGeometryPolygon":"esriGeometryEnvelope";u.viewLayerDefinition={filter:{operator:"esriSpatialRelIntersects",value:{geometryType:s,geometry:t}}}}else{const i=R(e.layerId,t);(null===(n=null===(a=null===(r=null===(s=null==i?void 0:i.adminLayerInfo)||void 0===s?void 0:s.viewLayerDefinition)||void 0===r?void 0:r.table)||void 0===a?void 0:a.filter)||void 0===n?void 0:n.value)&&(u.viewLayerDefinition={filter:null})}g.fields?u.fields=e.fields.map((e=>({name:e.name,visible:g.fields.indexOf(e.name)>-1}))):u.fields=e.fields.map((e=>({name:e.name,visible:!0})))}else{u.viewDefinitionQuery="",u.fields=e.fields.map((e=>({name:e.name,visible:!0})));const i=R(e.layerId,t);(null===(h=null===(c=null===(d=null===(l=null==i?void 0:i.adminLayerInfo)||void 0===l?void 0:l.viewLayerDefinition)||void 0===d?void 0:d.table)||void 0===c?void 0:c.filter)||void 0===h?void 0:h.value)&&(u.viewLayerDefinition={filter:null})}var m,f,y;return u}!function(e){e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.SELECTION=2]="SELECTION",e[e.OVERVIEW=3]="OVERVIEW",e[e.SWAP_SOURCE=4]="SWAP_SOURCE",e[e.BROWSE_LAYER=5]="BROWSE_LAYER",e[e.DEFINITION=6]="DEFINITION",e[e.FILTER=7]="FILTER",e[e.CREATE=8]="CREATE"}(m||(m={})),function(e){e[e.CANCEL=0]="CANCEL",e[e.CREATE=1]="CREATE"}(f||(f={}));const H=async(e,t,i)=>{var s;if(!e)throw new Error("pollForStatus: no status URL");const r=["processing","partial","Pending","InProgress"],a=["completed","Completed"];try{const o=await i(e,{query:t}),l=null===(s=null==o?void 0:o.data)||void 0===s?void 0:s.status;return r.includes(l)?(await(0,n.t)(500),H(e,t,i)):a.includes(l)?new Promise((e=>{e()})):new Promise(((e,t)=>{t()}))}catch(e){return new Promise(((t,i)=>{i(e)}))}},W=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewCancel=(0,s.c)(this,"arcgisLayerViewCancel",7),this.arcgisLayerViewStepChange=(0,s.c)(this,"arcgisLayerViewStepChange",7),this.arcgisLayerViewCreated=(0,s.c)(this,"arcgisLayerViewCreated",7),this.arcgisLayerViewChanged=(0,s.c)(this,"arcgisLayerViewChanged",7),this.status=m.LOADING,this.initialLoad=!0,this.goCancel=()=>{this.arcgisLayerViewCancel.emit()},this.view=void 0,this.itemId=void 0,this.config=void 0,this.props=void 0,this.reRender=!1}arcgisLayerViewStatusHandler(e){var t;const{props:i}=this,{detail:s}=e;this.status=s.status,(null===(t=s.layerIds)||void 0===t?void 0:t.length)&&(i.layerIds=[...s.layerIds]),this.status===m.SELECTION?(i.sourceItemId=i.layerItem.id,this.initialLoad=!1,this.arcgisLayerViewStepChange.emit(1)):this.status===m.OVERVIEW?this.arcgisLayerViewStepChange.emit(2):this.status===m.CREATE&&this.arcgisLayerViewStepChange.emit(3),this.reRender=!this.reRender}async arcgisLayerViewCreateDoneHandler(e){this.arcgisLayerViewCreated.emit(e.detail)}async arcgisLayerViewOverviewUpdatedHandler(){this.arcgisLayerViewChanged.emit(this.itemId)}arcgisLayerViewSelectionCancelHandler(){this.arcgisLayerViewCancel.emit()}arcgisLayerViewOverviewCancelHandler(){this.arcgisLayerViewCancel.emit()}arcgisLayerViewCreateCancelHandler(){this.arcgisLayerViewCancel.emit()}async setStep(e){const{props:t}=this,{viewItem:i}=t;switch(document.body.querySelectorAll(".js-app-flyout").forEach((e=>{document.body.removeChild(e)})),e){case 1:this.status=m.SELECTION,this.initialLoad=!1,this.reRender=!this.reRender;break;case 2:this.status=m.OVERVIEW,this.reRender=!this.reRender;break;case 3:i||(this.status=m.CREATE,this.reRender=!this.reRender)}}async componentWillLoad(){const{itemId:e,view:t,config:i}=this,[s]=await(0,r.g)(this.hostElement);this.strings=s,this.props={config:i,view:t,itemId:e,strings:s,layerIds:[],modules:{}}}async componentDidLoad(){var e,t,i;let{props:s}=this;const{itemId:r,view:o}=s;if(r)try{const[n,l,d,c,h,p,u]=await(0,a.l)(["esri/portal/PortalItem","esri/layers/Layer","esri/geometry/Extent","esri/geometry/projection","esri/views/support/colorUtils","esri/geometry/Polygon","esri/request"]);s.modules.PortalItem=n,s.modules.projection=c,s.modules.Polygon=p,s.modules.Extent=d,s.modules.Layer=l;const g=new n({id:r});if(await g.load(),"Feature Service"!==g.type)return void console.error("Only Feature Service items are allowed.");let f,y;if((null===(e=g.typeKeywords)||void 0===e?void 0:e.indexOf("View Service"))>-1?(f=g,await g.fetchRelatedItems({relationshipType:"Service2Data",direction:"forward"}).then((async e=>{e.length&&(y=e[0])}))):y=g,!y)return console.error("Could not find related item for view."),this.panelNode.loading=!1,this.status=m.ERROR,void(this.reRender=!this.reRender);s.sourceItemId=y.id;let v=y.portal.user;y.portal.user.username!==y.owner&&await u(`${y.portal.restUrl}/community/users/${y.owner}`,{query:{f:"json"}}).then((e=>{(null==e?void 0:e.data)&&(v=e.data)}));let w=(f||y).extent;if(w||(w=new d({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:4326})),4326!==o.spatialReference.wkid){await c.load();const e=c.project(w,o.spatialReference);o.goTo(e.expand(1.1))}else o.goTo(w.expand(1.1));const b=await h.getBackgroundColorTheme(o);y=new n({id:y.id}),await y.load();const I=await l.fromPortalItem({portalItem:y});if(this.props=Object.assign(Object.assign({},s),{layerItem:y,viewItem:f,layer:I,layerItemOwner:v,backgroundTheme:b}),s=this.props,"group"===I.type?(await I.loadAll(),(null===(t=x(I))||void 0===t?void 0:t.length)&&o.map.add(I),s.layerIds=O(I).map((e=>e.layerId)).toArray(),null===(i=x(I))||void 0===i||i.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))):(await I.load(),I.isTable||o.map.add(I),s.layerIds=[I.layerId],I.popupTemplate=I.createPopupTemplate()),await j(s),await async function(e){var t,i,s;const{viewItem:r,adminServiceInfo:a,layer:o}=e,{modules:n}=e;if(r){if(!a)return;e.layerIds=[],O(a).forEach((async t=>{var i,s,r,a;e.layerIds.push(t.id);const o=[];t.fields.forEach((e=>{!1!==e.visible&&o.push(e.name)})),o.length!==t.fields.length&&E(t.id,{fields:o},e);const l=t.viewDefinitionQuery;l&&(E(t.id,{filter:l},e),N(l,t.id,e));const d=null===(a=null===(r=null===(s=null===(i=t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===a?void 0:a.value;d&&(E(t.id,{aoi:JSON.parse(JSON.stringify(d.geometry))},e),C(d.geometry.rings?n.Polygon.fromJSON(d.geometry):n.Extent.fromJSON(d.geometry),t.id,e))})),"group"===o.type?(x(o).forEach((t=>{t.visible=e.layerIds.indexOf(t.layerId)>-1,t.definitionExpression=null})),null===(s=o.tables)||void 0===s||s.forEach((e=>{e.definitionExpression=null}))):(o.visible=e.layerIds.indexOf(o.layerId)>-1,o.definitionExpression=null)}else"group"===o.type?(null===(t=x(o))||void 0===t||t.forEach((t=>{t.definitionExpression&&(E(t.layerId,{filter:t.definitionExpression},e),N(t.definitionExpression,t.layerId,e),t.definitionExpression=null)})),null===(i=o.tables)||void 0===i||i.forEach((t=>{t.definitionExpression&&(E(t.layerId,{filter:t.definitionExpression},e),N(t.definitionExpression,t.layerId,e),t.definitionExpression=null)}))):o.definitionExpression&&(E(o.layerId,{filter:o.definitionExpression},e),N(o.definitionExpression,o.layerId,e),o.definitionExpression=null)}(s),s.derivativeLayers={hasAny:!1},f){const e=await g.fetchRelatedItems({relationshipType:"Service2Service",direction:"forward"});e.length&&(s.derivativeLayers={hasMS:e.find((e=>"Map Service"===e.type)),hasVTL:e.find((e=>"Vector Tile Service"===e.type)),hasWFS:e.find((e=>"WFS"===e.type)),hasScene:e.find((e=>"Scene Service"===e.type)),hasOGCFL:e.find((e=>"OGCFeatureServer"===e.type))},(s.derivativeLayers.hasMS||s.derivativeLayers.hasVTL||s.derivativeLayers.hasWFS||s.derivativeLayers.hasScene||s.derivativeLayers.hasOGCFL)&&(s.derivativeLayers.hasAny=!0))}if(f&&s.adminServiceInfo.capabilities.indexOf("Sync")>-1){const e=`${f.url}/replicas`;await u(e,{query:{f:"json"}}).then((e=>{var t;s.hasReplicas=(null===(t=e.data)||void 0===t?void 0:t.length)>0}))}this.status=m.SELECTION,this.reRender=!this.reRender,this.arcgisLayerViewStepChange.emit(1)}catch(e){console.error(e),this.status=m.ERROR,this.reRender=!this.reRender}else console.error("itemId is a required property.")}disconnectedCallback(){const{props:e}=this,{view:t,layer:i}=e;t.map.remove(i)}render(){const{status:e}=this;return(0,s.h)(s.H,{key:"5e016add710291e72e8027556ace284ce1f533be"},e===m.ERROR?this.renderError():null,e===m.LOADING?this.renderLoading():null,[m.SELECTION,m.SWAP_SOURCE,m.BROWSE_LAYER].includes(e)?this.renderLayerSelection():null,[m.OVERVIEW,m.DEFINITION,m.FILTER].includes(e)?this.renderLayerOverview():null,e===m.CREATE?this.renderCreateView():null)}renderError(){const{props:e}=this,{viewItem:t,layerItem:i,strings:r}=e;return(0,s.h)("calcite-flow-item",{loading:!1,heading:(null==t?void 0:t.title)||(null==i?void 0:i.title)||r.msg.error,description:(null==t?void 0:t.title)||(null==i?void 0:i.title)?r.general.sourceLayer:void 0,class:p,ref:e=>this.panelNode=e},(0,s.h)("div",{class:g},(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"exclamation-mark-triangle",kind:"danger"},(0,s.h)("div",{slot:"title"},r.msg.error),(0,s.h)("div",{slot:"message"},r.msg.initFailed))),(0,s.h)("div",{slot:"footer",class:u},(0,s.h)("calcite-button",{slot:"footer",onClick:this.goCancel,appearance:"transparent",width:"full",label:r.general.cancel},r.general.cancel)))}renderLoading(){const{props:e}=this,{viewItem:t,layerItem:i,strings:r}=e;return(0,s.h)("calcite-flow-item",{loading:!0,heading:(null==t?void 0:t.title)||(null==i?void 0:i.title),description:r.general.sourceLayer,class:p,ref:e=>this.panelNode=e})}renderLayerSelection(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-selection",{key:`selection-${t}`,props:e,status:t,ref:e=>!this.initialLoad&&(null==e?void 0:e.setFocus())})}renderLayerOverview(){const{props:e,status:t}=this,{definitionLayerId:i}=e;return(0,s.h)("arcgis-layer-view-overview",{key:`overview-${t}-${i}`,props:e,status:t})}renderCreateView(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-create",{key:`create-${t}`,props:e})}get hostElement(){return(0,s.d)(this)}};W.style=".sc-arcgis-layer-view-h{height:100%}.panel.sc-arcgis-layer-view{height:100%}.footer.sc-arcgis-layer-view{width:100%}.error-content.sc-arcgis-layer-view{margin:0.5rem}";const G=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.onBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SWAP_SOURCE})},this.goSwapLayer=async e=>{const{props:t,flowItemNode:i,hostElement:s}=this,{strings:r}=t,a=this.items.find((t=>t.id===e));this.loading=!0;const o=await async function(e,t){var i,s,r,a;const{layerItem:o,layer:n,adminServiceInfo:l,modules:d,strings:c}=t,{Layer:h,PortalItem:p}=d;if(t.swapItem=t.swapLayer=void 0,o.id===e.id)return Promise.resolve("");const u=p.fromJSON(e);await u.load();const g=await h.fromPortalItem({portalItem:u});if(n.type!==g.type)return console.log("layer type does not match,",n.type,"!=",g.type),Promise.resolve(c.msg.swapErrors.layerType);if("group"===n.type?await g.loadAll():await g.load(),"group"===n.type){const e=l.layers[0].capabilities.indexOf("Sync")>-1,t=x(g);if(e!==((null==t?void 0:t.length)?t:g.tables).getItemAt(0).sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),Promise.resolve(c.msg.swapErrors.sync)}else if(l.capabilities.indexOf("Sync")>-1!=g.sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),Promise.resolve(c.msg.swapErrors.sync);if("group"===n.type&&((null===(i=x(n))||void 0===i?void 0:i.length)!==(null===(s=x(g))||void 0===s?void 0:s.length)||(null===(r=n.tables)||void 0===r?void 0:r.length)!==(null===(a=g.tables)||void 0===a?void 0:a.length)))return console.log("layer sublayers count does not match"),Promise.resolve(c.msg.swapErrors.layerCount);if("group"===n.type){const e=O(n),i=O(g);for(let s=0;s<e.length;s++){const r=e.getItemAt(s),a=i.getItemAt(s);let o=T(r,a,t);if(o)return Promise.resolve(o);if(o=P(r,a,t),o)return Promise.resolve(o)}}else{let e=T(n,g,t);if(e)return Promise.resolve(e);if(e=P(n,g,t),e)return Promise.resolve(e)}return t.swapItem=e,t.swapLayer=g,Promise.resolve(null)}(a,this.props);if(o)this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.isError=!0,this.msgNode.message=`${r.msg.cannotSwap} ${o}`,s.appendChild(this.msgNode),this.msgNode.addEventListener("arcgisLayerViewMsgClosed",(()=>{var t;return null===(t=document.getElementById(`swap-action-${e}`))||void 0===t?void 0:t.setFocus()})),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{var t;this.timeoutHndl=void 0,this.msgNode&&(s.removeChild(this.msgNode),this.msgNode=void 0,null===(t=document.getElementById(`swap-action-${e}`))||void 0===t||t.setFocus())}),7e3);else try{await F(this.props),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.message=r.msg.successSwap.replace("${source}",a.title),this.msgNode.closeWithOK=!0,this.msgNode.addEventListener("arcgisLayerViewMsgClosed",(()=>{this.msgNode=void 0,this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})})),s.appendChild(this.msgNode)}catch(e){this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.isError=!0,this.msgNode.message=r.msg.swapFailed,s.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(s.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.props=void 0,this.reRender=!1,this.loading=!1,this.items=void 0,this.pagination=void 0,this.error=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t,hostElement:i}=this,{strings:r}=e,a="rtl"===(0,l.g)(i);return(0,s.h)(s.H,{key:"612271ab19ee0da410575a253f13984a84eb1ab3",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"2f346f8c9be5e0159b830e036a283d1c7c9b8e06",heading:r.swapSource.browseForLayerTitle,description:r.swapSource.subTitle,loading:t,class:{panel:!0,[l.C.rtl]:a},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderItemBrowser()))}renderItemBrowser(){const{props:e,pagination:t}=this,{layer:i,sourceItemId:r,strings:a}=e,{portalItem:o}=i,{portal:n}=o,l=n.user,c=`type:"Feature Service" typekeywords:"Hosted Service" -typekeywords:"View Service" owner:"${l.username}" -id:${r}`,h=`${(0,d.d)(n)}/home/`;return(0,s.h)("arcgis-item-browser",{onArcgisItemBrowserUpdate:e=>{const{results:t,num:i,start:s,total:r}=e.detail;this.items=t,this.pagination={start:s,num:i,total:r}},filter:c,portal:n,user:l,api:4,config:{baseUrl:h},selection:"none"},(0,s.h)("arcgis-item-browser-top-bar",{slot:"top-bar"},(0,s.h)("arcgis-item-browser-search",{slot:"search",term:""})),(0,s.h)("arcgis-item-browser-sort",{options:["modified","title","relevance"],slot:"sort"}),(0,s.h)("arcgis-item-browser-content",{slot:"content"},(this.items||[]).map((e=>(0,s.h)("arcgis-item-browser-card",{item:e,portal:n,baseUrl:h,key:e.id},(0,s.h)("calcite-action",{id:`swap-action-${e.id}`,icon:"arrow-right-left",text:"",scale:"s",slot:"actions-end",onClick:this.goSwapLayer.bind(this,e.id)},(0,s.h)("calcite-tooltip",{slot:"tooltip",label:a.general.swapSource,overlayPositioning:"fixed"},a.general.swapSource)))))),(0,s.h)("arcgis-item-browser-pagination",{total:null==t?void 0:t.total,start:null==t?void 0:t.start,num:null==t?void 0:t.num,slot:"pagination"}))}get hostElement(){return(0,s.d)(this)}};G.style=".panel.sc-arcgis-layer-view-browse-layer{height:100%}";const z="info",K="footer",Y=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewCreateDone=(0,s.c)(this,"arcgisLayerViewCreateDone",7),this.arcgisLayerViewCreateCancel=(0,s.c)(this,"arcgisLayerViewCreateCancel",7),this.goBack=()=>{const{props:e}=this;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder},this.arcgisLayerViewStatusChange.emit({status:m.OVERVIEW})},this.goCreate=async()=>{const{props:e,flowItemNode:t,hostElement:i}=this,{strings:s}=e;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};const r={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};this.loading=!0;try{this.viewItemId=await _(e,r),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=t,this.msgNode.message=s.msg.created,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewCreateDone.emit(this.viewItemId))}),7e3)}catch(e){const{props:t,flowItemNode:s}=this,{strings:r}=t;this.loading=!1,console.error("could not create view",e),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=s,this.msgNode.isError=!0,e.message,this.msgNode.message=r.msg.createFailed,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.goCancel=()=>{this.arcgisLayerViewCreateCancel.emit()},this.props=void 0,this.reRender=!1,this.loading=!1,this.title=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.viewItemId&&this.arcgisLayerViewCreateDone.emit(this.viewItemId)}async componentWillLoad(){const{props:e}=this;this.title=await async function(e){var t,i;const{layerItem:s,layer:r,strings:o}=e,[n]=await(0,a.l)(["esri/request"]),l=`${s.itemUrl}/relatedItems`,d=await n(l,{query:Object.assign(Object.assign({},{relationshipType:"Service2Service",direction:"forward"}),{f:"json",token:r.portalItem.portal.credential.token}),method:"post",responseType:"json"}),c=(null===(i=null===(t=null==d?void 0:d.data)||void 0===t?void 0:t.relatedItems)||void 0===i?void 0:i.filter((e=>"Feature Service"===e.type&&(e.title.indexOf(s.title)>-1||e.title.indexOf(s.title.replace(/ /g,"_"))>-1||e.title.replace(/ /g,"_").indexOf(s.title)>-1))))||[];return`${s.title}${c.length?` ${c.length+1}`:""} ${o.createView.view}`}(e)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t}=this,{viewItem:i,layerItem:r,strings:a}=e,o="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"75a459a5b4fdbb54fec61ab54bf60c5409dd5a82",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"f92dacc66a1f5fbec51c34cf0c9390e514aba7d4",heading:a.createView.create,description:(null==i?void 0:i.title)||(null==r?void 0:r.title),loading:t,class:{panel:!0,[l.C.rtl]:o},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo()))}renderFooterButtons(){return(0,s.h)("div",{slot:"footer",class:K},this.renderBack(),this.renderCreate(),(0,s.h)("br",null),this.renderCancel())}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",label:t.general.back,ref:e=>this.backButtonNode=e},t.general.back)}renderCreate(){const{props:e,title:t,titleError:i,summaryError:r}=this,{layer:a,layerIds:o,strings:n}=e,l=(null==a?void 0:a.loaded)&&o.length&&t&&!i&&!r;return(0,s.h)("calcite-button",{disabled:!l,onClick:l&&this.goCreate,appearance:"solid",width:"half","icon-start":"plus-square",label:n.createView.create,ref:e=>this.createButtonNode=e},n.createView.create)}renderCancel(){const{props:e}=this,{layer:t,layerIds:i,strings:r}=e,a=(null==t?void 0:t.loaded)&&i.length;return(0,s.h)("calcite-button",{disabled:!a,onClick:a&&this.goCancel,appearance:"transparent",width:"full",label:r.general.cancel},r.general.cancel)}renderInfo(){const{props:e,title:t}=this,{layer:i,layerItemOwner:r,savedItemProps:a}=e,{portalItem:o}=i,{portal:n}=o,l=n.user,d={portal:n,user:l,api:4};return a?(c.i.title=a.title,c.i.folder=a.folder,c.i.snippet=a.summary||"",c.i.categories=a.categories,c.i.tags=a.tags):(c.i.title=t,c.i.folder=o.ownerFolder&&{id:o.ownerFolder,username:o.owner},c.i.snippet=o.snippet||"",c.i.categories=o.categories,c.i.tags=o.tags),(0,s.h)("div",{class:z},(0,s.h)("arcgis-item-properties",{portal:n,user:l,api:4,config:d,type:"Feature Service",scale:"s"},(0,s.h)("arcgis-title-input",{enablePublishing:!0,onArcgisTitleInputChange:async e=>{const t=e.target,i=await t.validateTitle();(!this.titleError&&i||this.titleError&&!i)&&(this.reRender=!this.reRender),this.titleError=i}}),(0,s.h)("arcgis-folder-picker",{user:r}),(0,s.h)("arcgis-categories-picker",null),(0,s.h)("arcgis-tags-picker",null),(0,s.h)("arcgis-summary-input",{onArcgisSummaryInputChange:async e=>{const t=e.target,i=await t.getErrorMessage();(!this.summaryError&&i||this.summaryError&&!i)&&(this.reRender=!this.reRender),this.summaryError=i}})))}get hostElement(){return(0,s.d)(this)}};Y.style=".panel.sc-arcgis-layer-view-create{height:100%}.info.sc-arcgis-layer-view-create{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;padding:1rem 0.75rem}.footer.sc-arcgis-layer-view-create{width:100%}";const Q="notice",X="filter-block",Z="filter-chevron",ee="aoi-group",te="aoi-button",ie="text-center",se="select-fields",re=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewOverViewRefresh=(0,s.c)(this,"arcgisLayerViewOverViewRefresh",7),this.aoiSymbol={type:"simple-fill",style:"solid",color:[0,0,0,0],outline:{type:"simple-line",style:"solid",color:[255,0,0,255],width:2}},this.onBack=()=>{this.arcgisLayerViewOverViewRefresh.emit()},this.goFilter=()=>{var e;(null===(e=this.aoiBlockNode)||void 0===e?void 0:e.open)&&(this.aoiBlockNode.open=!1,this.onAOIToggle()),this.status=m.FILTER,this.reRender=!this.reRender},this.onBackFilter=()=>{this.status=m.DEFINITION,this.reRender=!this.reRender,setTimeout((()=>{var e;return null===(e=this.filterActionNode)||void 0===e?void 0:e.setFocus()}),200)},this.onPolygonClick=e=>{const{props:t}=this,{strings:i}=t,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("polygon"),s.active=!0,this.rectangleAction.active=!1,this.drawLabel.innerHTML=i.defineView.aoiPolygonDraw)},this.onRectangleClick=e=>{const{props:t}=this,{strings:i}=t,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("rectangle"),s.active=!0,this.polygonAction.active=!1,this.drawLabel.innerHTML=i.defineView.aoiRectangleDraw)},this.onDeleteAOIClick=()=>{const{props:e}=this,{definitionLayerId:t,strings:i}=e;this.sketchViewModel.cancel(),this.graphicsLayer.removeAll();const s=I(t,e);s&&(s.aoi=void 0),L(e),C(void 0,t,e),this.drawLabel.innerHTML=i.defineView.aoiSelect,this.polygonAction.disabled=!1,this.rectangleAction.disabled=!1,this.aoiBlockNode.description=i.defineView.aoiSubtext,this.reRender=!this.reRender},this.onGraphicUpdate=e=>{const{props:t}=this,{view:i,definitionLayerId:s}=t;if(i.closePopup(),"complete"===e.state){const i=e.graphics[0],r=i.geometry.extent,a=i.geometry.rings[0];let o=!1;5===a.length&&a.indexOf([r.xmin,r.ymin])>-1&&a.indexOf([r.xmax,r.ymax])>-1&&(o=!0),E(s,{aoi:this.rectangleAction.active&&o?r.toJSON():i.geometry.toJSON()},t),C(i.geometry,s,t),this.rectangleAction.active&&!o&&(this.reRender=!this.reRender)}},this.selectFields=e=>{const{props:t,totalFields:i,requiredFieldNames:s}=this,{view:r,definitionLayerId:a}=t,o=I(a,t);let n=[];n=(null==o?void 0:o.fields)?o.fields:i.filter((e=>-1===s.indexOf(e.name))).map((e=>e.name)),this.closeLayerViewDefinitionPopoversHandler();const l=this.flowItemNode.getBoundingClientRect().width;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"auto",offsetDistance:-1*(l?l-5:215),offsetSkidding:0,pointerDisabled:!0,popoverWidth:l?l+30:280,refElement:this.flowItemNode},this.arcgisFieldPickList.fields=this.createPickListFields(e),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=r,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=n,this.arcgisFieldPickList.multiple=!0,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.flowItemNode.disabled=!0},this.fieldPickListChanges=e=>{var t;e.stopPropagation();const{props:i,requiredFieldNames:s}=this,{definitionLayerId:r}=i,a=null===(t=e.detail)||void 0===t?void 0:t.selectedFields;if(this.removeFieldsPickList(),a){const e=R(r,i),t=(null==e?void 0:e.fields)||S(r,i).fields,o=t.filter((e=>s.indexOf(e.name)>-1||a.indexOf(e.name)>-1)).map((e=>e.name));if(o.length<t.length)E(r,{fields:o},i);else{let e=I(r,i);e&&(e.fields=void 0),L(i)}this.reRender=!this.reRender}},this.removeField=e=>{const{props:t,totalFields:i}=this,{definitionLayerId:s}=t;let r=I(s,t);r||(r={layerId:s},t.viewProps=t.viewProps||[],t.viewProps.push(r)),r.fields||(r.fields=i.map((e=>e.name))),r.fields.splice(r.fields.indexOf(e),1),this.reRender=!this.reRender},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}closeLayerViewDefinitionPopoversHandler(){this.removeFieldsPickList()}async componentWillLoad(){var e;const{props:t}=this,{definitionLayerId:i}=t;this.fl=S(i,t),this.adminLayerInfo=R(i,t),this.totalFields=(null===(e=this.adminLayerInfo)||void 0===e?void 0:e.fields)||S(i,t).fields,this.requiredFieldNames=b(t)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.removeSketchViewModel()}render(){const{props:e,status:t}=this,{definitionLayerId:i,strings:r}=e,a=S(i,e),o="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"c0761baa5ee0aa9c11304fd5712786a0dabe923d",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"8a26ba15322f4650571c4eef6c7a1209d5a36f53",heading:r.defineView.definitions,description:a.title,class:{panel:!0,[l.C.rtl]:o},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderInfo(),this.renderFilter(),this.renderAOI(),this.renderFields()),t===m.FILTER?this.renderLayerFilter():null)}renderInfo(){const{props:e}=this,{config:t,strings:i}=e,{helpBase:r,helpMap:a}=t;return(0,h.g)(h.l.ARCGIS_COMPONENT_NOTIFICATIONS,h.a.LAYER_VIEW_DEFINITION_DISMISSED)?null:(0,s.h)("calcite-notice",{class:Q,open:!0,closable:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{(0,h.s)(h.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:h.a.LAYER_VIEW_DEFINITION_DISMISSED,value:"true"})}},(0,s.h)("div",{slot:"title"},i.defineView.addDefinitions),(0,s.h)("div",{slot:"message"},i.defineView.addDefinitionsMsg),(0,s.h)("calcite-link",{slot:"link",title:i.defineView.moreAboutViews,target:"_blank",href:`${r}${a[120002839]}`},i.defineView.moreAboutViews))}renderFilter(){const{props:e}=this,{definitionLayerId:t,strings:i}=e,r=I(t,e),a="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-block",{heading:(null==r?void 0:r.filter)?i.defineView.editFilter:i.defineView.addFilter,collapsible:!1,class:X,tabIndex:0,onClick:this.goFilter},(0,s.h)("calcite-icon",{slot:"icon",icon:"filter",scale:"s"}),(0,s.h)("calcite-action",{slot:"control",icon:a?"chevron-left":"chevron-right",class:Z,scale:"s",text:(null==r?void 0:r.filter)?i.defineView.editFilter:i.defineView.addFilter,ref:e=>this.filterActionNode=e}))}renderAOI(){const{props:e,fl:t}=this,{definitionLayerId:i,strings:r}=e;if(t.isTable)return null;const a=I(i,e);return(0,s.h)("calcite-block",{heading:r.defineView.areaOfInterest,description:(null==a?void 0:a.aoi)?void 0:r.defineView.aoiSubtext,collapsible:!0,onCalciteBlockOpen:()=>this.onAOIToggle(),onCalciteBlockClose:()=>this.onAOIToggle(),ref:e=>this.aoiBlockNode=e},(0,s.h)("calcite-icon",{slot:"icon",icon:"polygon",scale:"s"}),this.renderAOIContent())}renderAOIContent(){const{props:e}=this,{definitionLayerId:t,layerIds:i,strings:r}=e,a=I(t,e),o=!!(null==a?void 0:a.aoi);return(0,s.h)("div",null,(0,s.h)("calcite-action-group",{layout:"grid",class:ee},(0,s.h)("calcite-action",{icon:"polygon",appearance:"solid",alignment:"center",active:!1,disabled:o,scale:"s",text:r.defineView.aoiSketchPolygonLabel,title:r.defineView.aoiSketchPolygonLabel,onClick:o?void 0:this.onPolygonClick,ref:e=>this.polygonAction=e}),(0,s.h)("calcite-action",{icon:"rectangle",appearance:"solid",alignment:"center",active:!1,disabled:o,scale:"s",text:r.defineView.aoiSketchRectangleLabel,title:r.defineView.aoiSketchRectangleLabel,onClick:o?void 0:this.onRectangleClick,ref:e=>this.rectangleAction=e}),(0,s.h)("calcite-action",{icon:"trash",appearance:"solid",alignment:"center",scale:"s",disabled:!o,text:r.defineView.aoiDeleteLabel,title:r.defineView.aoiDeleteLabel,onClick:o?this.onDeleteAOIClick:void 0})),(0,s.h)("div",{class:ie,ref:e=>this.drawLabel=e},o?r.defineView.aoiRestart:r.defineView.aoiSelect),i.length>1?(0,s.h)("calcite-button",{appearance:"transparent",width:"full",class:te,label:r.defineView.aoiApplyAll,onClick:()=>this.applyAOIToAll()},r.defineView.aoiApplyAll):null)}renderFields(){var e;const{props:t,totalFields:i}=this,{definitionLayerId:r,strings:a}=t,o=I(r,t),n=i.length,l=(null===(e=null==o?void 0:o.fields)||void 0===e?void 0:e.length)||n;return(0,s.h)("calcite-block",{heading:a.defineView.fields,description:`${l}/${n}`,collapsible:!0},(0,s.h)("calcite-icon",{slot:"icon",icon:"feature-details",scale:"s"}),this.renderFieldsContent())}renderFieldsContent(){const{props:e,fl:t,requiredFieldNames:i,totalFields:r}=this,{definitionLayerId:a,strings:o}=e,n=I(a,e);let l;l=(null==n?void 0:n.fields)?r.filter((e=>n.fields.indexOf(e.name)>-1||i.indexOf(e.name)>-1)):r;const d=i.length!==r.length,c=l.map((e=>(0,s.h)("calcite-list-item",{label:e.alias||e.name},-1===i.indexOf(e.name)?(0,s.h)("calcite-action",{icon:"x",scale:"s",text:o.general.remove,slot:"actions-end",onClick:()=>this.removeField(e.name)}):null)));return(0,s.h)("div",null,d&&(0,s.h)("calcite-button",{class:se,appearance:"outline-fill",round:!0,label:o.defineView.selectFields,scale:"s",width:"full",onClick:()=>this.selectFields(t),ref:e=>this.buttonNode=e},o.defineView.selectFields),(0,s.h)("calcite-list",null,c))}renderLayerFilter(){const{props:e,fl:t}=this,{view:i,definitionLayerId:r}=e,a=I(r,this.props);return(0,s.h)("arcgis-filter",{key:`filter-${r}`,view:i,layer:t,mode:"layer-view",viewFilter:null==a?void 0:a.filter,dismissible:!1,hideLayerTitle:!1,onArcgisFilterPanelBackClick:this.onBackFilter,onArcgisFilterWhereChange:e=>this.applyFilter(e.detail)})}async applyFilter(e){const{props:t}=this,{definitionLayerId:i}=t;if(e)E(i,{filter:e},t);else{const e=I(i,t);e&&(e.filter=void 0),L(t)}}async onAOIToggle(){if(this.aoiBlockNode.open){if(!this.SketchViewModel){this.aoiBlockNode.loading=!0;const[e,t,i,s,r]=await(0,a.l)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Extent"]);this.SketchViewModel=e,this.GraphicsLayer=t,this.Graphic=i,this.Polygon=s,this.Extent=r,this.aoiBlockNode.loading=!1}this.setupSketchViewModel()}else this.removeSketchViewModel()}setupSketchViewModel(){const{props:e,aoiSymbol:t}=this,{layer:i,view:s,definitionLayerId:r}=e;if(this.defaultAutoOpenEnabled=s.popupEnabled,s.popupEnabled=!1,this.graphicsLayer)return;this.graphicsLayer=new this.GraphicsLayer,s.map.add(this.graphicsLayer);const a=I(r,e);if(null==a?void 0:a.aoi){const e=a.aoi,i=e.rings?this.Polygon.fromJSON(e):new this.Polygon({rings:[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],spatialReference:a.aoi.spatialReference}),s=new this.Graphic({geometry:i,symbol:t});this.graphicsLayer.add(s)}this.sketchViewModel=new this.SketchViewModel({layer:this.graphicsLayer,view:s,polygonSymbol:t,updateOnGraphicClick:!0}),this.sketchViewModel.on("create",(e=>this.onGraphicCreate(e))),this.sketchViewModel.on("update",this.onGraphicUpdate);const o="group"===i.type?x(i).map((e=>({layer:e}))):[{layer:i}];this.sketchViewModel.snappingOptions.featureSources=o,this.sketchViewModel.snappingOptions.enabled=!0}removeSketchViewModel(){var e,t;const{props:i,defaultAutoOpenEnabled:s}=this,{view:r}=i;this.graphicsLayer&&r.map.remove(this.graphicsLayer),null===(e=this.graphicsLayer)||void 0===e||e.destroy(),this.graphicsLayer=void 0,null===(t=this.sketchViewModel)||void 0===t||t.destroy(),this.sketchViewModel=void 0,r.popupEnabled=s}onGraphicCreate(e){const{props:t}=this,{definitionLayerId:i,strings:s}=t;if("start"===e.state&&this.polygonAction.active&&(this.drawLabel.innerHTML=s.defineView.aoiPolygonEnd),"complete"===e.state){const r=e.graphic,a=r.geometry.extent;E(i,{aoi:this.polygonAction.active?r.geometry.toJSON():a.toJSON()},t),C(r.geometry,i,t),this.drawLabel.innerHTML=s.defineView.aoiRestart,this.polygonAction.active=!1,this.rectangleAction.active=!1,this.polygonAction.disabled=!0,this.rectangleAction.disabled=!0,this.aoiBlockNode.description=void 0,this.reRender=!this.reRender}}applyAOIToAll(){const{props:e}=this,{definitionLayerId:t,layer:i}=e;if("group"!==i.type)return;const s=I(t,e);x(i).map((i=>{if(i.layerId!==t){if(null==s?void 0:s.aoi)E(i.layerId,{aoi:JSON.parse(JSON.stringify(s.aoi))},e);else{const t=I(i.layerId,e);t&&(t.aoi=void 0),L(e)}if(null==s?void 0:s.aoi){C(s.aoi.rings?this.Polygon.fromJSON(s.aoi):this.Extent.fromJSON(s.aoi),i.layerId,e)}else C(void 0,i.layerId,e)}}))}createPickListFields(e){const{requiredFieldNames:t,props:i}=this,s=R(e.layerId,i);return((null==s?void 0:s.fields)||S(e.layerId,i).fields).filter((e=>-1===t.indexOf(e.name))).map((e=>({name:e.name,alias:e.alias||e.name,type:e.type})))}removeFieldsPickList(){this.flowItemNode.disabled=!1,this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{this.buttonNode.setFocus()}),1))}get hostElement(){return(0,s.d)(this)}};var ae;function oe(e,t){var i;const{fields:s,popupTemplate:r}=e,a=null==r?void 0:r.fieldInfos,o=s.find((e=>t===e.name));return o&&(null===(i=null==a?void 0:a.find((e=>e.fieldName===o.name)))||void 0===i?void 0:i.label)||(null==o?void 0:o.alias)||t}function ne(e,t){const{fields:i}=e,s=i.find((e=>t===e.name));return null==s?void 0:s.type}function le(e,t){const{strings:i}=t;return e.isTable?i.general.table:"point"===e.geometryType||"multipoint"===e.geometryType?i.join.pointLayer:"polyline"===e.geometryType?i.join.polylineLayer:"polygon"===e.geometryType?i.join.polygonLayer:""}async function de(e,t){const{targetItem:i,targetLayer:s,targetLayerId:r,addLayer:a,addLayerId:o}=e,n=i.portal.isPortal,l=Date.now(),d="group"===s.type?O(s).find((e=>e.layerId===r)):s,c="group"===a.type?O(a).find((e=>e.layerId===o)):a;try{await pe(e),n||await async function(e){const{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r,attributeRelationships:a}=e;let o="group"===t.type?O(t).find((e=>e.layerId===i)):t,n=a.map((e=>e.targetFieldName));await ue(o,n,e),o="group"===s.type?O(s).find((e=>e.layerId===r)):s,n=a.map((e=>e.addFieldName)),await ue(o,n,e)}(e);const i=await async function(e,t){const{targetItem:i,modules:s}=e,{esriRequest:r}=s,{folder:a}=t,o=!a||!a.id||a.id===i.owner,n=i.portal,l=`${n.restUrl}/content/users/${i.owner}${o?"":`/${a.id}`}/createService`,d={serviceDescription:"",hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!0,maxRecordCount:2e3,supportedQueryFormats:"JSON",capabilities:"Query",description:"",copyrightText:"",allowGeometryUpdates:!1,syncEnabled:!1,editorTrackingInfo:{enableEditorTracking:!1,enableOwnershipAccessControl:!1,allowOthersToUpdate:!0,allowOthersToDelete:!0},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},tables:[],name:t.title.replace(/ /g,"_")};if(n.isPortal){const t=await async function(e){var t,i,s,r;await pe(e);const{adminServiceInfo:a}=e,o=(null===(i=null===(t=null==a?void 0:a.adminServiceInfo)||void 0===t?void 0:t.database)||void 0===i?void 0:i.datasource)||{},n=(null===(s=null==o?void 0:o.name)||void 0===s?void 0:s.indexOf("/nosqlDatabases"))>-1?"spatiotemporal":(null===(r=null==o?void 0:o.name)||void 0===r?void 0:r.indexOf("/enterpriseDatabases"))>-1?"relational":null;return n}(e);t&&(d.options={dataSourceType:t})}let c={createParameters:JSON.stringify(d),outputType:"featureService"};try{return(await r(l,{query:Object.assign(Object.assign({},c),{f:"json",isView:!0,token:n.credential.token}),method:"post",responseType:"json"})).data}catch(e){return new Promise(((e,t)=>{t(new Error("create service failed"))}))}}(e,t),s={newItemProps:t,createServiceResponse:i,timeStamp:l,targetFL:d,addFL:c};return await async function(e,t){const{createServiceResponse:i,addFL:s,timeStamp:r}=t,{addLayerId:a,joinOperation:o,attributeRelationships:n}=e;if("one-to-one"!==o.type||"summarize"!==o.matchType)return;try{const t=i.serviceurl.replace("rest/services","rest/admin/services"),l=n.map((e=>{var t;return{name:e.addFieldName,alias:(null===(t=s.fields.find((t=>t.name===e.addFieldName)))||void 0===t?void 0:t.alias)||e.addFieldName,source:e.addFieldName}})),d=[];o.statisticsFields.forEach((e=>{e.types.forEach((t=>{const i=t.toLowerCase();d.push({name:`${e.fieldName}_${i}`,alias:`${e.fieldName}_${i}`,source:e.fieldName,statisticType:"mean"===i?"avg":i})}))}));const c={layers:[{name:`${he(s.url,e)}_StatsTable`,description:"tablestatsjoin",adminLayerInfo:{viewLayerDefinition:{table:{materialized:!1,name:`${he(s.url,e)}_${r}_StatsTable`,sourceServiceName:he(s.url,e),sourceLayerId:a,sourceLayerFields:[...l,{name:"join_count",alias:"join_count",source:o.statisticsFields[0].fieldName,statisticType:"count"},...d],groupBy:n.map((e=>e.addFieldName)).join(",")}}}}]};return await ce(`${t}/addToDefinition`,c,e),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition StatsTable failed"))}))}}(e,s),await async function(e,t){const{createServiceResponse:i,newItemProps:s,targetFL:r,addFL:a,timeStamp:o}=t;try{const t=i.serviceurl.replace("rest/services","rest/admin/services"),n=function(e,t,i,s,r){const{targetLayerId:a,addLayerId:o,joinOperation:n,attributeRelationships:l,adminServiceInfo:d}=e,c=l.map((e=>{var t;return{name:e.addFieldName,alias:(null===(t=s.fields.find((t=>t.name===e.addFieldName)))||void 0===t?void 0:t.alias)||e.addFieldName,source:e.addFieldName}}));let h;"one-to-one"===n.type&&"summarize"===n.matchType&&(h=[],n.statisticsFields.forEach((e=>{e.types.forEach((t=>{const i=t.toLowerCase();h.push({name:`${e.fieldName}_${i}`,alias:`${e.fieldName}_${i}`,source:`${e.fieldName}_${i}`})}))})));const p={};return p.name=t.title.replace(/ /g,"_"),p.displayField="",p.description="AttributeJoin",p.adminLayerInfo={viewLayerDefinition:{table:{name:`${he(i.url,e)}_${r}_target`,sourceServiceName:he(i.url,e),sourceLayerId:a,sourceLayerFields:i.fields.filter((e=>"oid"!==e.type)).map((e=>({name:e.name,alias:e.alias,source:e.name}))),relatedTables:["one-to-one"===n.type&&"summarize"===n.matchType?{name:`${he(s.url,e)}_StatsTable`,sourceServiceName:t.title.replace(/ /g,"_"),sourceLayerId:0,sourceLayerFields:[...c.filter((e=>!l.some((t=>e.name===t.addFieldName)))),{name:"join_count",alias:"join_count",source:"join_count"},...h],type:n.joinType,parentKeyFields:l.map((e=>e.targetFieldName)),keyFields:l.map((e=>e.addFieldName))}:{name:`${he(s.url,e)}_${r}_join`,sourceServiceName:he(s.url,e),sourceLayerId:o,sourceLayerFields:s.fields.filter((e=>"oid"!==e.type)).map((e=>({name:i.fields.find((t=>t.name.toLowerCase()===e.name.toLowerCase()))?`${e.name}_${r}`:e.name,alias:e.alias,source:e.name}))),type:n.joinType,parentKeyFields:l.map((e=>e.targetFieldName)),keyFields:l.map((e=>e.addFieldName)),topFilter:"one-to-one"===n.type&&"first"===n.matchType?{groupByFields:l.map((e=>e.addFieldName)).join(","),orderByFields:`${n.sortByFieldName} ${n.sortOrder}`,topCount:1}:void 0}],materialized:!1}},geometryField:i.isTable?null:{name:`${he(i.url,e)}_${r}_target.${d.layers.find((e=>e.id===a)).adminLayerInfo.geometryField.name}`}},{layers:[p]}}(e,s,r,a,o);return await ce(`${t}/addToDefinition`,n,e),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition AttributeJoin failed"))}))}}(e,s),await async function(e,t){var i,s;const{createServiceResponse:r,newItemProps:a}=t,{targetItem:o,modules:n}=e,{esriRequest:l}=n,d=o.portal,c=`${d.restUrl}/content/users/${o.owner}/items/${r.itemId}/update`,h={title:a.title,tags:(null===(i=a.tags)||void 0===i?void 0:i.length)?a.tags.toString():void 0,snippet:a.summary,categories:null===(s=a.categories)||void 0===s?void 0:s.join(",")};d.isPortal&&(h.typeKeywords="Multi Services View");try{return await l(c,{query:Object.assign(Object.assign({},h),{f:"json",token:d.credential.token}),method:"post",responseType:"json"})}catch(e){return new Promise(((e,t)=>{t(new Error("item update request failed"))}))}}(e,s),i.itemId}catch(e){return new Promise(((e,t)=>{t(new Error("createJoinView failed"))}))}}async function ce(e,t,i,s=!1){const{modules:r}=i,{esriRequest:a,IdentityManager:o}=r,n=o.findCredential(e),l={addToDefinition:JSON.stringify(t)};try{return await a(e,{query:Object.assign(Object.assign({},l),{f:"json",token:n.token}),method:"post",responseType:"json"}),new Promise((e=>{e()}))}catch(r){return s?new Promise(((e,t)=>{t(new Error("addToDefinition request failed"))})):ce(e,t,i,!0)}}function he(e,t){const{targetItem:i}=t,{portal:s}=i,r=e.indexOf("/services/")+10;var a=e.substring(r,e.indexOf("/FeatureServer",r));return s.isPortal&&(a=a.replace("Hosted/","")),a}async function pe(e,t){const{targetLayer:i,adminServiceInfo:s,modules:r}=e,{IdentityManager:a,esriRequest:o}=r;if(s)return;let n=i.portalItem.url.replace("/rest/services","/rest/admin/services");t&&(n+=`${n.indexOf("?")>-1?"&":"?"}_ts=${(new Date).getTime()}`);try{await a.getCredential(n);const t=await o(n,{query:{f:"json"}});e.adminServiceInfo=t.data}catch(e){return new Promise(((e,t)=>{t(new Error("could not get admin info"))}))}}async function ue(e,t,i){const s={indexes:[]};e.sourceJSON.indexes=e.sourceJSON.indexes||[],t.forEach((t=>{e.sourceJSON.indexes.some((e=>e.fields===t))||s.indexes.push({name:`${t}_Index`,fields:t,isUnique:!1,isAscending:!0,description:`${t}_Index`})})),s.indexes.length&&await async function(e,t,i){var s;const{targetItem:r,modules:a}=i,{IdentityManager:o}=a,n=t.url.replace("/rest/services","/rest/admin/services"),l=`${n}/${t.layerId}/addToDefinition`,d=o.findCredential(l),c=r.portal.isPortal,h={f:"json",addToDefinition:JSON.stringify(e),async:!c,token:d.token},p=await a.esriRequest(l,{query:h,method:"post"});if(c)t.sourceJSON.indexes=t.sourceJSON.indexes||[],t.sourceJSON.indexes=t.sourceJSON.indexes.concat(e.indexes);else try{await ge(null===(s=null==p?void 0:p.data)||void 0===s?void 0:s.statusURL,{f:"json",token:d.token},i),t.sourceJSON.indexes=t.sourceJSON.indexes||[],t.sourceJSON.indexes=t.sourceJSON.indexes.concat(e.indexes)}catch(e){}}(s,e,i)}re.style=".panel.sc-arcgis-layer-view-definition{height:100%}.hook.sc-arcgis-layer-view-definition{height:1px}.notice.sc-arcgis-layer-view-definition{margin:8px}.filter-block.sc-arcgis-layer-view-definition{cursor:pointer}.filter-block.sc-arcgis-layer-view-definition:hover{background-color:var(--calcite-color-foreground-2)}.filter-chevron.sc-arcgis-layer-view-definition{margin-right:0.5rem}.arcgis--rtl.sc-arcgis-layer-view-definition .filter-chevron.sc-arcgis-layer-view-definition{margin-left:0.5rem;margin-right:auto}.aoi-group.sc-arcgis-layer-view-definition{width:100%;margin-bottom:0.75rem}.aoi-button.sc-arcgis-layer-view-definition{margin-top:0.75rem;border-top-width:1px;border-top-style:solid;border-top-color:var(--calcite-color-border-3)}.text-center.sc-arcgis-layer-view-definition{text-align:center}.select-fields.sc-arcgis-layer-view-definition{margin:0 0 5px 0}",function(e){e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.TARGET_SELECTION=2]="TARGET_SELECTION",e[e.ADD_SELECTION=3]="ADD_SELECTION",e[e.BROWSE_LAYER=4]="BROWSE_LAYER",e[e.CONFIG=5]="CONFIG",e[e.CREATE=6]="CREATE"}(ae||(ae={}));const ge=async(e,t,i)=>{var s;const{modules:r}=i;if(!e)throw new Error("pollForStatus: no status URL");const a=["processing","partial","Pending","InProgress"],o=["completed","Completed"];try{const l=await r.esriRequest(e,{query:t}),d=null===(s=null==l?void 0:l.data)||void 0===s?void 0:s.status;if(a.includes(d))return await(0,n.t)(500),ge(e,t,i);if(o.includes(d))return l;throw l}catch(e){throw console.error(e),e}},me=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinCancel=(0,s.c)(this,"arcgisLayerViewJoinCancel",7),this.arcgisLayerViewJoinTableClick=(0,s.c)(this,"arcgisLayerViewJoinTableClick",7),this.arcgisLayerViewJoinStepChange=(0,s.c)(this,"arcgisLayerViewJoinStepChange",7),this.arcgisLayerViewJoinCreated=(0,s.c)(this,"arcgisLayerViewJoinCreated",7),this.status=ae.LOADING,this.goCancel=()=>{this.arcgisLayerViewJoinCancel.emit()},this.view=void 0,this.itemId=void 0,this.config=void 0,this.showTableOption=!1}arcgisLayerViewStatusHandler(e){const{detail:t}=e;this.status=t.status,this.status===ae.TARGET_SELECTION?this.arcgisLayerViewJoinStepChange.emit(1):this.status===ae.ADD_SELECTION?this.arcgisLayerViewJoinStepChange.emit(2):this.status===ae.CONFIG?this.arcgisLayerViewJoinStepChange.emit(3):this.status===ae.CREATE&&this.arcgisLayerViewJoinStepChange.emit(4),(0,s.f)(this.hostElement)}async arcgisLayerViewJoinCreateDoneHandler(e){this.arcgisLayerViewJoinCreated.emit(e.detail)}arcgisLayerViewJoinCreateCancelHandler(){this.arcgisLayerViewJoinCancel.emit()}async setStep(e){var t,i;const{props:r}=this,{targetLayerId:a,addLayerId:n,attributeRelationships:l,joinOperation:d}=r,c=(0,o.i)(a),h=(0,o.i)(n),p=(null==l?void 0:l.find((e=>e.targetFieldName&&e.addFieldName)))&&d&&("first"===d.matchType&&d.sortByFieldName&&d.sortOrder||"summarize"===d.matchType&&(null===(t=d.statisticsFields)||void 0===t?void 0:t.length)&&(null===(i=d.statisticsFields)||void 0===i?void 0:i[0].fieldName));switch(document.body.querySelectorAll(".js-app-flyout").forEach((e=>{document.body.removeChild(e)})),e){case 1:return this.status=ae.TARGET_SELECTION,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));case 2:if(c)return this.status=ae.ADD_SELECTION,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));break;case 3:if(h)return this.status=ae.CONFIG,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));break;case 4:if(p)return this.status=ae.CREATE,(0,s.f)(this.hostElement),new Promise((e=>e(!0)))}return new Promise((e=>e(!1)))}async componentWillLoad(){var e,t;const{itemId:i,view:s,showTableOption:o,config:n}=this,[l]=await(0,r.g)(this.hostElement,"arcgis-layer-view");this.strings=l,this.props={config:n,view:s,itemId:i,showTableOption:o,strings:l,modules:{}};let{props:d}=this;if(i)try{const[r,o,n,l,c,h,p]=await(0,a.l)(["esri/portal/PortalItem","esri/layers/Layer","esri/geometry/Extent","esri/geometry/projection","esri/geometry/Polygon","esri/request","esri/identity/IdentityManager"]);d.modules={PortalItem:r,projection:l,Polygon:c,Extent:n,Layer:o,esriRequest:h,IdentityManager:p};const u=new r({id:i});if(await u.load(),d.targetItemOwner=u.portal.user,u.portal.user.username!==u.owner&&await h(`${u.portal.restUrl}/community/users/${u.owner}`,{query:{f:"json"}}).then((e=>{(null==e?void 0:e.data)&&(d.targetItemOwner=e.data)})),"Feature Service"!==u.type)return console.error("Only Feature Service items are allowed."),void(this.status=ae.ERROR);if(-1===(null===(e=u.typeKeywords)||void 0===e?void 0:e.indexOf("Hosted Service")))return console.error("Only hosted Feature Service items are allowed."),void(this.status=ae.ERROR);if(u.portal.user.username!==u.owner&&"admin"!==u.itemControl)return console.error("Only owners and admins are allowed."),void(this.status=ae.ERROR);if((null===(t=u.typeKeywords)||void 0===t?void 0:t.indexOf("View Service"))>-1)return console.error("View items are not allowed."),void(this.status=ae.ERROR);if((null==u?void 0:u.typeKeywords.indexOf("IoTFeatureLayer"))>-1)return console.error("Velocity items are not allowed."),void(this.status=ae.ERROR);let g=u.extent;if(g||(g=new n({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:4326})),4326!==s.spatialReference.wkid){await l.load();const e=l.project(g,s.spatialReference);s.goTo(e.expand(1.1))}else s.goTo(g.expand(1.1));const m=await o.fromPortalItem({portalItem:u});if("group"===m.type){await m.loadAll();const e=x(m);(null==e?void 0:e.length)&&s.map.add(m),null==e||e.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))}else await m.load(),m.isTable||s.map.add(m),m.popupTemplate=m.createPopupTemplate();d.targetItem=u,d.targetLayer=m,this.status=ae.TARGET_SELECTION}catch(e){console.error(e),this.status=ae.ERROR}else console.error("itemId is a required property.")}async componentDidLoad(){this.arcgisLayerViewJoinStepChange.emit(1)}disconnectedCallback(){const{props:e}=this,{view:t,targetLayer:i,addLayer:s}=e;t.map.remove(i),t.map.remove(s)}render(){const{status:e}=this;return(0,s.h)(s.H,{key:"07329cabe4206dd9fa0caeada53a622fbeb7ff0f"},e===ae.ERROR?this.renderError():null,e===ae.LOADING?this.renderLoading():null,[ae.TARGET_SELECTION].includes(e)?this.renderTargetLayerSelection():null,[ae.ADD_SELECTION,ae.BROWSE_LAYER].includes(e)?this.renderAddLayerSelection():null,[ae.CONFIG].includes(e)?this.renderConfig():null,e===ae.CREATE?this.renderCreateJoin():null)}renderError(){const{props:e}=this,{targetItem:t,strings:i}=e;return(0,s.h)("calcite-flow-item",{loading:!1,heading:(null==t?void 0:t.title)||i.msg.error,description:(null==t?void 0:t.title)?i.join.targetLayer:void 0,class:p,ref:e=>this.flowItemNode=e},(0,s.h)("div",{class:g},(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"exclamation-mark-triangle",kind:"danger"},(0,s.h)("div",{slot:"title"},i.msg.error),(0,s.h)("div",{slot:"message"},i.msg.initFailed))),(0,s.h)("div",{slot:"footer",class:u},(0,s.h)("calcite-button",{slot:"footer",onClick:this.goCancel,appearance:"transparent",width:"full",label:i.general.cancel},i.general.cancel)))}renderLoading(){const{props:e}=this,{targetItem:t,strings:i}=e;return(0,s.h)("calcite-flow-item",{loading:!0,heading:null==t?void 0:t.title,description:i.join.targetLayer,class:p,ref:e=>this.flowItemNode=e})}renderTargetLayerSelection(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-target-selection",{key:`target-selection-${t}`,props:e,status:t})}renderAddLayerSelection(){const{props:e,status:t}=this,{addItem:i}=e;return(0,s.h)("arcgis-layer-view-join-add-selection",{key:`add-${t}-${null==i?void 0:i.id}`,props:e,status:t})}renderConfig(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-config",{key:`create-${t}`,props:e,onArcgisLayerViewJoinConfigTableClick:e=>this.arcgisLayerViewJoinTableClick.emit(e.detail)})}renderCreateJoin(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-create",{key:`create-${t}`,props:e})}get hostElement(){return(0,s.d)(this)}};me.style=":host{height:100%}.panel{height:100%}.footer{width:100%}.error-content{margin:0.5rem}";const fe="flow",ye="footer",ve="info",we="list-header",be="text",Ie="footer-button",Le="browse",Ee=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.goBrowse=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.BROWSE_LAYER})},this.goBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.TARGET_SELECTION})},this.goNext=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.CONFIG})},this.onSelectionChange=()=>{const{props:e}=this;this.listNode.querySelectorAll("calcite-list-item").forEach((t=>{t.selected&&(e.addLayerId=t.value,(0,s.f)(this.hostElement))})),e.attributeRelationships=void 0,e.joinOperation=void 0},this.props=void 0,this.status=void 0}componentWillLoad(){const{props:e}=this,{addItem:t,targetItem:i,targetLayer:s}=e;t||"group"!==s.type||(e.addItem=i,e.addLayer=s),e.addLayer&&"group"!==e.addLayer.type&&!(0,o.i)(e.addLayerId)&&(e.addLayerId=e.addLayer.layerId)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}componentDidRender(){const{props:e}=this,{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r}=e;"group"===t.type&&O(t).forEach((e=>{e.layerId!==i&&(e.visible=!1)})),s&&"group"===s.type&&(0,o.i)(r)?O(s).forEach((e=>{t.id===s.id&&i===e.layerId||(e.visible=e.layerId===r)})):s&&"group"!==s.type&&(s.visible=!0)}render(){const{props:e,status:t}=this,{strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"0552cbceacce20720ff69ec0d2b23a6d85ddc143",class:"calcite-match-height"},(0,s.h)("calcite-flow",{key:"c6e5034a00c163e0eacce35223fe0de9264e5703",class:fe,dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:"d1205888bc9f9716f225e43d5f6eb546bcbcbe13",description:i.join.joinLayer,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderBrowse(),this.renderSublayers()),t===ae.BROWSE_LAYER&&this.renderBrowseLayer()))}renderFooterButtons(){const{props:e}=this,{addLayerId:t,addLayer:i,strings:r}=e,a="rtl"===(0,l.g)(this.hostElement),n=!i||!(0,o.i)(t);return(0,s.h)("div",{slot:"footer",class:ye},(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":a?"arrow-right":"arrow-left",label:r.general.back,ref:e=>this.backButtonNode=e},r.general.back),(0,s.h)("calcite-button",{disabled:n,onClick:!n&&this.goNext,appearance:"solid",width:"half",iconEnd:a?"arrow-left":"arrow-right",label:r.general.next,ref:e=>this.nextButtonNode=e},r.general.next))}renderBrowse(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",null,(0,s.h)("div",{class:ve},(0,s.h)("div",{class:be},t.join.selectAddLayerPanelDescription)),(0,s.h)("div",{class:Ie},(0,s.h)("calcite-button",{id:"arcgis-layer-view-join-browse",onClick:this.goBrowse,appearance:"outline-fill",width:"full",label:t.join.browseForLayer,ref:e=>this.browseButtonNode=e},t.join.browseForLayer)))}renderBrowseLayer(){const{props:e}=this;return(0,s.h)("arcgis-layer-view-join-browse-layer",{props:e,class:Le,onArcgisLayerViewJoinStatusChange:e=>{e.detail.status===ae.ADD_SELECTION&&setTimeout((()=>{var e;return null===(e=document.getElementById("arcgis-layer-view-join-browse"))||void 0===e?void 0:e.setFocus()}),400)}})}renderSublayers(){const{props:e}=this,{targetLayer:t,addItem:i,addLayer:r,targetLayerId:a,strings:o}=e;if(!r)return null;const n=[];"group"===r.type?O(r).forEach((e=>{t.id===r.id&&a===e.layerId||n.unshift(this.renderSublayer(e))})):n.push(this.renderSublayer(r));const l=o.join.selectFromItem;return(0,s.h)(s.F,null,(0,s.h)("div",{class:we},(0,s.h)("div",{class:be},l.substring(0,l.indexOf("${")),(0,s.h)("b",null,i.title),l.substring(l.indexOf("}")+1))),(0,s.h)("calcite-list",{selectionMode:"single",onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},n))}renderSublayer(e){const{props:t}=this,{addLayerId:i}=t;return(0,s.h)("calcite-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:le(e,t),selected:i===e.layerId})}get hostElement(){return(0,s.d)(this)}};Ee.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.info{pointer-events:none;padding:1rem 0.75rem}.list-header{pointer-events:none;padding:1rem 0.75rem 0.3rem}.text{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-color-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none;word-wrap:break-word;word-break:break-word}.footer-button{margin:0 10px 5px 10px}.notice{margin:8px}.browse{width:100%}";const Se=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.onBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.ADD_SELECTION})},this.goUseLayer=async e=>{const{props:t}=this,{addLayer:i,targetLayer:s,view:r,modules:a}=t;this.loading=!0,i&&i.id!==s.id&&r.map.remove(i);const o=new a.PortalItem({id:e});await o.load();const n=await a.Layer.fromPortalItem({portalItem:o});if("group"===n.type){await n.loadAll();const e=x(n);(null==e?void 0:e.length)&&r.map.add(n),null==e||e.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))}else await n.load(),n.isTable||r.map.add(n),n.popupTemplate=n.createPopupTemplate();t.addItem=o,t.addLayer=n,t.addLayerId=void 0,t.joinOperation=void 0,this.arcgisLayerViewJoinStatusChange.emit({status:ae.ADD_SELECTION})},this.props=void 0,this.loading=!1,this.items=void 0,this.pagination=void 0,this.error=void 0}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t,hostElement:i}=this,{strings:r}=e,a="rtl"===(0,l.g)(i);return(0,s.h)(s.H,{key:"0c155e4d7d082cd65b0602449b41059ed612102c",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"3cabbd734e2efdcca7d537306bdd5cefce300c2d",heading:r.join.browseForLayerTitle,description:r.join.browseForLayerSubTitle,loading:t,class:{panel:!0,[l.C.rtl]:a},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderItemBrowser()))}renderItemBrowser(){const{props:e,pagination:t}=this,{targetItem:i,targetLayer:r,itemId:a,strings:o}=e,{portalItem:n}=r,{portal:l}=n,c=l.user,h=`type:"Feature Service" typekeywords:"Hosted Service" -typekeywords:"View Service" -typekeywords:"Spatiotemporal" owner:"${i.owner}" -id:${a}`,p=`${(0,d.d)(l)}/home/`;return(0,s.h)("arcgis-item-browser",{onArcgisItemBrowserUpdate:e=>{const{results:t,num:i,start:s,total:r}=e.detail;this.items=t,this.pagination={start:s,num:i,total:r}},filter:h,portal:l,user:c,api:4,config:{baseUrl:p},selection:"none"},(0,s.h)("arcgis-item-browser-top-bar",{slot:"top-bar"},(0,s.h)("arcgis-item-browser-search",{slot:"search",term:""})),(0,s.h)("arcgis-item-browser-sort",{options:["modified","title","relevance"],slot:"sort"}),(0,s.h)("arcgis-item-browser-content",{slot:"content"},(this.items||[]).map((e=>(0,s.h)("arcgis-item-browser-card",{item:e,portal:l,baseUrl:p,key:e.id},(0,s.h)("calcite-action",{id:`join-action-${e.id}`,icon:"plus-circle",text:"",scale:"s",slot:"actions-end",onClick:this.goUseLayer.bind(this,e.id)},(0,s.h)("calcite-tooltip",{slot:"tooltip",label:o.join.select,overlayPositioning:"fixed"},o.join.select)))))),(0,s.h)("arcgis-item-browser-pagination",{total:null==t?void 0:t.total,start:null==t?void 0:t.start,num:null==t?void 0:t.num,slot:"pagination"}))}get hostElement(){return(0,s.d)(this)}};Se.style=".panel.sc-arcgis-layer-view-join-browse-layer{height:100%}";const Ne="flow",Ce="footer",ke="layer-section",Oe="target-layer",xe="add-layer",Fe="layer-header",Te="layer-title",Pe="layer-icon",je="attribute-relationship",Re="remove-attribute-relationship",Ve="sort-by-section",De="join-match-type-section",_e="chip",Ae="separator",$e="stats-section",Be="stats-field-header",Je="stats-button",Me="select",Ue="disabled-text",qe=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.arcgisLayerViewJoinConfigTableClick=(0,s.c)(this,"arcgisLayerViewJoinConfigTableClick",7),this.goBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.ADD_SELECTION})},this.goNext=()=>{const{props:e}=this,{attributeRelationships:t}=e;e.attributeRelationships=t.filter((e=>e.targetFieldName&&e.addFieldName)),this.arcgisLayerViewJoinStatusChange.emit({status:ae.CREATE})},this.onTargetFieldSelect=e=>{const{props:t,targetFL:i}=this,{strings:r}=t,{targetFieldName:a}=e,o=i.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:i,fieldName:a,multiple:!1,heading:r.join.targetFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","string","guid","global-id"],excludedFields:o.map((e=>e.name)),buttonNode:this.targetFieldNode,onChange:t=>{e.targetFieldName=t[0],(0,s.f)(this.hostElement)}})},this.onJoinFieldSelect=e=>{const{props:t,addFL:i}=this,{strings:r}=t,{addFieldName:a}=e,o=i.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:i,fieldName:a,multiple:!1,heading:r.join.joinFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","string","guid","global-id"],excludedFields:o.map((e=>e.name)),buttonNode:this.addFieldNode,onChange:t=>{e.addFieldName=t[0],(0,s.f)(this.hostElement)}})},this.onSortByFieldSelect=()=>{const{props:e,addFL:t}=this,{joinOperation:i,strings:r}=e,{sortByFieldName:a}=i,o=t.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:t,fieldName:a,multiple:!1,heading:r.join.joinFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","oid"],excludedFields:o.map((e=>e.name)),buttonNode:this.sortByFieldNode,onChange:e=>{i.sortByFieldName=e[0],(0,s.f)(this.hostElement)}})},this.onStatsFieldSelect=()=>{const{props:e,addFL:t}=this,{joinOperation:i,strings:r}=e,{statisticsFields:a}=i,o=t.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:t,fieldName:"",multiple:!0,heading:r.join.selectFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset"],excludedFields:a.map((e=>e.fieldName)).concat(o.map((e=>e.name))),buttonNode:this.statsButtonNode,onChange:e=>{e.forEach((e=>{const i=["date","date-only","time-only","timestamp-offset"].indexOf(ne(t,e))>-1;a.push({fieldName:e,types:[i?"MIN":"SUM"]})})),(0,s.f)(this.hostElement)}})},this.props=void 0,this.status=void 0,this.showTableOption=!1}async componentWillLoad(){var e;const{props:t}=this,{targetLayer:i,targetLayerId:s,addLayer:r,addLayerId:a,attributeRelationships:o,joinOperation:n}=t;if(this.targetFL="group"===i.type?O(i).find((e=>e.layerId===s)):i,this.addFL="group"===r.type?O(r).find((e=>e.layerId===a)):r,!(null==o?void 0:o.length)){t.attributeRelationships=[];const{targetFL:i,addFL:r}=this;if(i.relationships&&r.relationships){const e=i.relationships.filter((e=>e.relatedTableId===a)),o=r.relationships.filter((e=>e.relatedTableId===s));e.length&&o.length&&e.forEach((e=>{const i=o.find((t=>e.id===t.id));i&&t.attributeRelationships.push({targetFieldName:e.keyField,addFieldName:i.keyField})}))}(null===(e=t.attributeRelationships)||void 0===e?void 0:e.length)||t.attributeRelationships.push({})}n||(t.joinOperation={type:"one-to-one",matchType:"first",sortByFieldName:this.addFL.objectIdField,sortOrder:"ASC",joinType:"INNER",statisticsFields:[]})}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.removeInfoPopover()}render(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"e78ec693678c6efb075c92f1e0fd58f6562bab31",class:"calcite-match-height"},(0,s.h)("calcite-flow",{key:"15d7b419a831f593076b20724c0f66a01dc02ec6",class:Ne,dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:"f3d68d0ead285c1fefa658db8a9c8b20993f282a",heading:t.join.configureJoin,class:{panel:!0,[l.C.rtl]:i},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderContent())))}renderFooterButtons(){var e,t;const{props:i}=this,{attributeRelationships:r,joinOperation:a,strings:o}=i,n="rtl"===(0,l.g)(this.hostElement),d=!!r.find((e=>e.targetFieldName&&e.addFieldName))&&("one-to-many"===a.type||"first"===a.matchType&&a.sortByFieldName&&a.sortOrder||"summarize"===a.matchType&&(null===(e=a.statisticsFields)||void 0===e?void 0:e.length)&&(null===(t=a.statisticsFields)||void 0===t?void 0:t[0].fieldName));return(0,s.h)("div",{slot:"footer",class:Ce},(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":n?"arrow-right":"arrow-left",label:o.general.back,ref:e=>this.backButtonNode=e},o.general.back),(0,s.h)("calcite-button",{disabled:!d,onClick:d&&this.goNext,appearance:"solid",width:"half",iconEnd:n?"arrow-left":"arrow-right",label:o.general.next,ref:e=>this.nextButtonNode=e},o.general.next))}renderContent(){return(0,s.h)(s.F,null,this.renderLayers(),this.renderAttributeRelationships(),this.renderJoinOperation())}renderLayers(){const{props:e,targetFL:t,addFL:i}=this,{targetItem:r,targetLayer:a,targetLayerId:o,addItem:n,addLayer:d,addLayerId:c,showTableOption:h,strings:p}=e,u="rtl"===(0,l.g)(this.hostElement),g="group"===a.type?u?`${t.title} / ${r.title}`:`${r.title} / ${t.title}`:a.title,m="group"===d.type?u?`${i.title} / ${n.title}`:`${n.title} / ${i.title}`:d.title;return(0,s.h)("div",{class:ke},(0,s.h)("div",{class:Oe},(0,s.h)("div",null,(0,s.h)("div",{class:Fe},p.join.targetLayer),(0,s.h)("div",{class:Te},g)),h&&(0,s.h)("calcite-action",{scale:"s",icon:"table",class:Pe,text:p.join.showTable,textEnabled:!1,onClick:()=>{var e,t;"group"===a.type?(null===(e=a.tables)||void 0===e||e.forEach((e=>{e.layerId===o&&this.arcgisLayerViewJoinConfigTableClick.emit(e)})),null===(t=x(a))||void 0===t||t.forEach((e=>{e.layerId===o&&this.arcgisLayerViewJoinConfigTableClick.emit(e)}))):this.arcgisLayerViewJoinConfigTableClick.emit(a)}})),(0,s.h)("div",{class:xe},(0,s.h)("div",null,(0,s.h)("div",{class:Fe},p.join.joinLayer),(0,s.h)("div",{class:Te},m)),h&&(0,s.h)("calcite-action",{scale:"s",icon:"table",class:Pe,text:p.join.showTable,textEnabled:!1,onClick:()=>{var e,t;"group"===d.type?(null===(e=d.tables)||void 0===e||e.forEach((e=>{e.layerId===c&&this.arcgisLayerViewJoinConfigTableClick.emit(e)})),null===(t=x(d))||void 0===t||t.forEach((e=>{e.layerId===c&&this.arcgisLayerViewJoinConfigTableClick.emit(e)}))):this.arcgisLayerViewJoinConfigTableClick.emit(d)}})))}renderAttributeRelationships(){const{props:e}=this,{attributeRelationships:t,strings:i}=e;return(0,s.h)("calcite-block",{heading:i.join.attributeJoin,description:i.join.attributeJoinMsg,open:!0,collapsible:!0,ref:e=>this.attrBlockNode=e},t.map(((e,t)=>this.renderAttributeRelationship(e,t))),(0,s.h)("calcite-button",{onClick:()=>{t.push({}),(0,s.f)(this.hostElement)},appearance:"outline-fill",width:"full",label:i.join.fields,ref:e=>this.fieldButtonNode=e},i.join.fields))}renderAttributeRelationship(e,t){const{targetFL:i,addFL:r,props:a}=this,{attributeRelationships:o,strings:n}=a;return(0,s.h)("div",{class:je},o.length>1&&(0,s.h)("div",{class:Re},(0,s.h)("calcite-action",{scale:"s",icon:"trash",text:n.general.remove,onClick:()=>{o.splice(t,1),(0,s.f)(this.hostElement)}})),(0,s.h)("calcite-label",null,n.join.targetField,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",label:e.targetFieldName?oe(i,e.targetFieldName):n.join.selectField,onClick:()=>this.onTargetFieldSelect(e),ref:e=>this.targetFieldNode=e},e.targetFieldName?oe(i,e.targetFieldName):n.join.selectField)),(0,s.h)("calcite-label",null,n.join.joinField,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",label:e.addFieldName?oe(r,e.addFieldName):n.join.selectField,onClick:()=>this.onJoinFieldSelect(e),ref:e=>this.addFieldNode=e},e.addFieldName?oe(r,e.addFieldName):n.join.selectField)))}renderJoinOperation(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-block",{heading:i.join.joinSettings,description:i.join.joinSettingsMsg,open:!0,collapsible:!0,ref:e=>this.operationBlockNode=e},this.renderJoinOperationType(),"one-to-one"===t.type&&this.renderMatchType(),"one-to-one"===t.type&&"first"===t.matchType&&this.renderJoinOperationSortBy(),"one-to-one"===t.type&&"summarize"===t.matchType&&this.renderJoinOperationStatistics(),(0,s.h)("div",{class:Ae}),this.renderJoinType())}renderJoinOperationType(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"info-label"},i.join.joinOperation),(0,s.h)("calcite-action",{class:"link-info",tabindex:"0",scale:"s",icon:"information",onClick:e=>this.handleInfoClick(e,"join-operation"),text:i.join.moreInfo,ref:e=>{this.joinOperationInfoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e,"join-operation")})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}))}})),(0,s.h)("div",null,(0,s.h)("calcite-chip",{label:i.join.oneToOne,value:"one-to-one",appearance:"one-to-one"===t.type?"solid":"outline-fill",kind:"brand",class:`${_e} ${"one-to-many"===t.type?Me:""}`,onClick:"one-to-many"===t.type?()=>{t.type="one-to-one",(0,s.f)(this.hostElement)}:void 0},i.join.oneToOne),"\xa0",(0,s.h)("calcite-chip",{label:i.join.oneToMany,value:"one-to-many",appearance:"one-to-many"===t.type?"solid":"outline-fill",kind:"brand",class:`${_e} ${"one-to-one"===t.type?Me:""}`,onClick:"one-to-one"===t.type?()=>{t.type="one-to-many",(0,s.f)(this.hostElement)}:void 0},i.join.oneToMany)))}renderMatchType(){const{props:e}=this,{addItem:t,addLayerId:i,addLayer:r,joinOperation:a,strings:n}=e;let l=!1;if(t.portal.isPortal){let e;r&&"group"===r.type&&(0,o.i)(i)?O(r).forEach((t=>{i===t.layerId&&(e=t)})):r&&"group"!==r.type&&(e=r),l=(d=e).sourceJSON.ownershipBasedAccessControlForFeatures&&(!1===(null===(c=d.sourceJSON.ownershipBasedAccessControlForFeatures)||void 0===c?void 0:c.allowAnonymousToQuery)||!1===(null===(h=d.sourceJSON.ownershipBasedAccessControlForFeatures)||void 0===h?void 0:h.allowOthersToQuery))}var d,c,h;return(0,s.h)("calcite-radio-button-group",{name:"matchType",layout:"vertical",class:De},(0,s.h)("calcite-label",{layout:"inline",class:Me,onClick:()=>{a.matchType="first",(0,s.f)(this.hostElement)}},(0,s.h)("calcite-radio-button",{checked:"first"===a.matchType,value:"first",onClick:()=>{a.matchType="first",(0,s.f)(this.hostElement)}}),n.join.onlyFirst),(0,s.h)("calcite-label",{layout:"inline",class:l?"":Me,onClick:l?null:()=>{a.matchType="summarize",(0,s.f)(this.hostElement)}},(0,s.h)("calcite-radio-button",{checked:"summarize"===a.matchType,value:"summarize",disabled:l,onClick:()=>{a.matchType="summarize",(0,s.f)(this.hostElement)}}),(0,s.h)("span",{class:l?Ue:""},n.join.summarizeMatching)))}renderJoinOperationSortBy(){const{addFL:e,props:t}=this,{joinOperation:i,strings:r}=t;return(0,s.h)("div",{class:Ve},(0,s.h)("calcite-label",null,r.join.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",label:oe(e,i.sortByFieldName),onClick:()=>this.onSortByFieldSelect(),ref:e=>this.sortByFieldNode=e},oe(e,i.sortByFieldName))),(0,s.h)("calcite-label",null,r.join.sortOrder,(0,s.h)("calcite-select",{width:"full",onCalciteSelectChange:e=>{const t=e.target;i.sortOrder=t.value,(0,s.f)(this.hostElement)},label:r.join.sortOrder},(0,s.h)("calcite-option",{label:r.join.asc,selected:"ASC"===i.sortOrder,value:"ASC"},r.join.asc),(0,s.h)("calcite-option",{label:r.join.desc,selected:"DESC"===i.sortOrder,value:"DESC"},r.join.desc))))}renderJoinOperationStatistics(){var e;const{props:t,addFL:i}=this,{joinOperation:r,strings:a}=t,{statisticsFields:o}=r,n=o.map((e=>e.fieldName)),l=["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset"],d=!i.fields.filter((e=>-1===n.indexOf(e.name))).filter((e=>l.indexOf(e.type)>-1)).length;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",{scale:"l"},a.join.fieldStats),null===(e=r.statisticsFields)||void 0===e?void 0:e.map(((e,t)=>this.renderJoinOperationStatistic(e,t))),(0,s.h)("calcite-button",{onClick:!d&&this.onStatsFieldSelect,appearance:"outline-fill","icon-start":"plus",width:"full",disabled:d,class:Je,label:a.join.addStats,ref:e=>this.statsButtonNode=e},a.join.addStats))}renderJoinOperationStatistic(e,t){const{props:i,addFL:r}=this,{joinOperation:a,strings:o}=i,n=["date","date-only","time-only","timestamp-offset"].indexOf(ne(r,e.fieldName))>-1,l=n?e.types.indexOf("MIN")>-1&&e.types.indexOf("MAX")>-1:e.types.indexOf("SUM")>-1&&e.types.indexOf("MIN")>-1&&e.types.indexOf("MAX")>-1&&e.types.indexOf("MEAN")>-1&&e.types.indexOf("STDDEV")>-1;return(0,s.h)("div",{class:$e},(0,s.h)("calcite-label",{class:Be,layout:"inline-space-between"},oe(r,e.fieldName),(0,s.h)("calcite-action",{scale:"s",icon:"trash",text:o.general.remove,onClick:()=>{a.statisticsFields.splice(t,1),(0,s.f)(this.hostElement)}})),(0,s.h)("div",null,!n&&(0,s.h)(s.F,null,(0,s.h)("calcite-chip",{label:o.join.sum,value:"SUM",appearance:e.types.indexOf("SUM")>-1?"solid":"outline-fill",kind:"brand",class:`${_e} ${e.types.length>1||-1===e.types.indexOf("SUM")?Me:""}`,onClick:()=>{-1===e.types.indexOf("SUM")?e.types.push("SUM"):e.types.length>1&&e.types.splice(e.types.indexOf("SUM"),1),(0,s.f)(this.hostElement)}},o.join.sum),"\xa0"),(0,s.h)("calcite-chip",{label:o.join.min,value:"MIN",appearance:e.types.indexOf("MIN")>-1?"solid":"outline-fill",kind:"brand",class:`${_e} ${e.types.length>1||-1===e.types.indexOf("MIN")?Me:""}`,onClick:()=>{-1===e.types.indexOf("MIN")?e.types.push("MIN"):e.types.length>1&&e.types.splice(e.types.indexOf("MIN"),1),(0,s.f)(this.hostElement)}},o.join.min),"\xa0",(0,s.h)("calcite-chip",{label:o.join.max,value:"MAX",appearance:e.types.indexOf("MAX")>-1?"solid":"outline-fill",kind:"brand",class:`${_e} ${e.types.length>1||-1===e.types.indexOf("MAX")?Me:""}`,onClick:()=>{-1===e.types.indexOf("MAX")?e.types.push("MAX"):e.types.length>1&&e.types.splice(e.types.indexOf("MAX"),1),(0,s.f)(this.hostElement)}},o.join.max),!n&&(0,s.h)(s.F,null,"\xa0",(0,s.h)("calcite-chip",{label:o.join.mean,value:"MEAN",appearance:e.types.indexOf("MEAN")>-1?"solid":"outline-fill",kind:"brand",class:`${_e} ${e.types.length>1||-1===e.types.indexOf("MEAN")?Me:""}`,onClick:()=>{-1===e.types.indexOf("MEAN")?e.types.push("MEAN"):e.types.length>1&&e.types.splice(e.types.indexOf("MEAN"),1),(0,s.f)(this.hostElement)}},o.join.mean),"\xa0",(0,s.h)("calcite-chip",{label:o.join.stdDev,value:"STDDEV",appearance:e.types.indexOf("STDDEV")>-1?"solid":"outline-fill",kind:"brand",class:`${_e} ${e.types.length>1||-1===e.types.indexOf("STDDEV")?Me:""}`,onClick:()=>{-1===e.types.indexOf("STDDEV")?e.types.push("STDDEV"):e.types.length>1&&e.types.splice(e.types.indexOf("STDDEV"),1),(0,s.f)(this.hostElement)}},o.join.stdDev)),!l&&(0,s.h)(s.F,null,"\xa0",(0,s.h)("calcite-button",{appearance:"transparent",label:o.join.selectAll,onClick:()=>{!n&&-1===e.types.indexOf("SUM")&&e.types.push("SUM"),-1===e.types.indexOf("MIN")&&e.types.push("MIN"),-1===e.types.indexOf("MAX")&&e.types.push("MAX"),!n&&-1===e.types.indexOf("MEAN")&&e.types.push("MEAN"),!n&&-1===e.types.indexOf("STDDEV")&&e.types.push("STDDEV"),(0,s.f)(this.hostElement)}},o.join.selectAll))))}renderJoinType(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"info-label"},i.join.joinType),(0,s.h)("calcite-action",{class:"link-info",tabindex:"0",scale:"s",icon:"information",onClick:e=>this.handleInfoClick(e,"join-type"),text:i.join.moreInfo,ref:e=>{this.joinTypeInfoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e,"join-type")})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}))}})),(0,s.h)("div",null,(0,s.h)("calcite-chip",{label:i.join.innerJoin,value:"inner-join",appearance:"INNER"===t.joinType?"solid":"outline-fill",kind:"brand",class:`${_e} ${"LEFT"===t.joinType?Me:""}`,onClick:"LEFT"===t.joinType?()=>{t.joinType="INNER",(0,s.f)(this.hostElement)}:void 0},i.join.innerJoin),"\xa0",(0,s.h)("calcite-chip",{label:i.join.leftJoin,value:"left-join",appearance:"LEFT"===t.joinType?"solid":"outline-fill",kind:"brand",class:`${_e} ${"INNER"===t.joinType?Me:""}`,onClick:"INNER"===t.joinType?()=>{t.joinType="LEFT",(0,s.f)(this.hostElement)}:void 0},i.join.leftJoin)))}openFieldPickList({layer:e,fieldName:t,multiple:i,heading:s,fieldTypes:r,excludedFields:a,buttonNode:o,onChange:n}){const{props:l,fieldPickListSortBy:d,flowItemNode:c}=this,{view:h}=l,p=c.getBoundingClientRect().width||215;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"auto",offsetDistance:-1*(p-2),offsetSkidding:0,pointerDisabled:!0,popoverWidth:p+7,refElement:c},this.arcgisFieldPickList.fields=this.createPickListFields(e,r,a),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=h,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=t?[t]:[],this.arcgisFieldPickList.sortBy=d,this.arcgisFieldPickList.multiple=i,this.arcgisFieldPickList.heading=s,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",(e=>{var t;e.stopPropagation();const i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields;c.disabled=!1,this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{o.setFocus()}),1)),(null==i?void 0:i.length)&&n(i)})),this.arcgisFieldPickList.addEventListener("arcgisFieldPickListSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),c.disabled=!0}createPickListFields(e,t,i){const{fields:s,popupTemplate:r}=e;return s.filter((e=>-1===i.indexOf(e.name))).filter((e=>t.indexOf(e.type)>-1)).map((e=>{var t,i;return{name:e.name,alias:(null===(i=null===(t=null==r?void 0:r.fieldInfos)||void 0===t?void 0:t.find((t=>t.fieldName===e.name)))||void 0===i?void 0:i.label)||e.alias,type:e.type}}))}handleInfoClick(e,t){e.stopPropagation(),this.removeInfoPopover();const{props:i}=this,s="join-operation"===t?this.joinOperationInfoIconNode:this.joinTypeInfoIconNode;this.infoPopoverNode=document.createElement("arcgis-layer-view-join-info-popover"),this.infoPopoverNode.props=i,this.infoPopoverNode.type=t,this.infoPopoverNode.referenceElement=s,this.infoPopoverNode.addEventListener("arcgisLayerViewJoinInfoPopoverClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>s.setFocus()),200)})),this.infoPopoverNode.addEventListener("arcgisLayerViewJoinInfoPopoverDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),this.infoPopoverNode.setOpen(!0),setTimeout((()=>this.infoPopoverNode.setFocus()),100)}removeInfoPopover(){var e;this.infoPopoverNode&&(null===(e=this.infoPopoverNode.parentNode)||void 0===e||e.removeChild(this.infoPopoverNode),this.infoPopoverNode=null)}get hostElement(){return(0,s.d)(this)}};qe.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.layer-section{border:1px solid var(--calcite-color-border-3);background-color:white;margin:10px}.target-layer{padding:10px;border-bottom:1px solid var(--calcite-color-border-3);display:flex;justify-content:space-between}.add-layer{padding:10px;display:flex;justify-content:space-between}.layer-header{padding-bottom:3px;overflow-wrap:anywhere}.layer-title{font-weight:bold;overflow-wrap:anywhere}.layer-icon{align-self:center;cursor:pointer}.attribute-relationship{border:1px solid var(--calcite-color-border-3);padding:10px 10px 0 10px;margin-bottom:10px}.remove-attribute-relationship{display:flex;justify-content:flex-end}.join-match-type-section{padding:10px 0}.info{display:flex;justify-content:space-between}.info-label{display:flex;align-items:center}.chip{margin-bottom:5px}.sort-by-section{border:1px solid var(--calcite-color-border-3);padding:10px 10px 0 10px;margin:10px 0}.separator{border-bottom:1px solid var(--calcite-color-border-3);margin:10px 0 15px 0}.stats-section{border:1px solid var(--calcite-color-border-3);padding:10px 10px 0 10px;margin-bottom:10px}.stats-field-header{overflow-wrap:anywhere;width:100%}.stats-button{margin-bottom:10px}.select{cursor:pointer}.disabled-text{color:var(--calcite-color-border-1)}";const He="info",We="footer",Ge="layer-section",ze="target-layer",Ke="add-layer",Ye="layer-header",Qe="layer-title",Xe=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.arcgisLayerViewJoinCreateDone=(0,s.c)(this,"arcgisLayerViewJoinCreateDone",7),this.arcgisLayerViewJoinCreateCancel=(0,s.c)(this,"arcgisLayerViewJoinCreateCancel",7),this.goBack=()=>{const{props:e}=this;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder},this.arcgisLayerViewJoinStatusChange.emit({status:ae.CONFIG})},this.goCreate=async()=>{const{props:e,flowItemNode:t,hostElement:i}=this,{strings:s}=e;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};const r={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};this.loading=!0;try{this.viewItemId=await de(e,r),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=t,this.msgNode.message=s.msg.created,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewJoinCreateDone.emit(this.viewItemId))}),7e3)}catch(e){const{props:t,flowItemNode:s}=this,{strings:r}=t;this.loading=!1,console.error("could not create join view",e),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=s,this.msgNode.isError=!0,this.msgNode.message=r.msg.createFailed,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.goCancel=()=>{this.arcgisLayerViewJoinCreateCancel.emit()},this.props=void 0,this.loading=!1,this.title=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.viewItemId&&this.arcgisLayerViewJoinCreateDone.emit(this.viewItemId)}async componentWillLoad(){const{props:e}=this,{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r}=e;this.targetFL="group"===t.type?O(t).find((e=>e.layerId===i)):t,this.addFL="group"===s.type?O(s).find((e=>e.layerId===r)):s,this.title=await async function(e){var t,i;const{targetItem:s,targetLayer:r,strings:a,modules:o}=e,{esriRequest:n}=o,l=`${s.itemUrl}/relatedItems`,d=await n(l,{query:Object.assign(Object.assign({},{relationshipType:"Service2Service",direction:"forward"}),{f:"json",token:r.portalItem.portal.credential.token}),method:"post",responseType:"json"}),c=(null===(i=null===(t=null==d?void 0:d.data)||void 0===t?void 0:t.relatedItems)||void 0===i?void 0:i.filter((e=>"Feature Service"===e.type&&(e.title.indexOf(s.title)>-1||e.title.indexOf(s.title.replace(/ /g,"_"))>-1||e.title.replace(/ /g,"_").indexOf(s.title)>-1))))||[];return a.join.joinFeaturesTo.replace("${name}",s.title)+`${c.length?` ${c.length+1}`:""} ${a.createView.view}`}(e)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t}=this,{strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"525b82c1f3684ce1c66f6dc171f89bab4f510d37",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"29b3f7c1810b015d3d3a932cc06c75d10a33a98d",heading:i.join.create,loading:t,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderNotice(),this.renderLayers(),this.renderInfo()))}renderFooterButtons(){return(0,s.h)("div",{slot:"footer",class:We},this.renderBack(),this.renderCreate(),(0,s.h)("br",null),this.renderCancel())}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",label:t.general.back,ref:e=>this.backButtonNode=e},t.general.back)}renderCreate(){const{props:e,title:t,titleError:i,summaryError:r}=this,{strings:a}=e,o=t&&!i&&!r;return(0,s.h)("calcite-button",{disabled:!o,onClick:o&&this.goCreate,appearance:"solid",width:"half","icon-start":"plus-square",label:a.createView.create,ref:e=>this.createButtonNode=e},a.createView.create)}renderCancel(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{onClick:this.goCancel,appearance:"transparent",width:"full",label:t.general.cancel},t.general.cancel)}renderNotice(){}renderLayers(){const{props:e,targetFL:t,addFL:i}=this,{targetItem:r,targetLayer:a,addItem:o,addLayer:n,strings:d}=e,c="rtl"===(0,l.g)(this.hostElement),h="group"===a.type?c?`${t.title} / ${r.title}`:`${r.title} / ${t.title}`:a.title,p="group"===n.type?c?`${i.title} / ${o.title}`:`${o.title} / ${i.title}`:n.title;return(0,s.h)("div",{class:Ge},(0,s.h)("div",{class:ze},(0,s.h)("div",{class:Ye},d.join.targetLayer),(0,s.h)("div",{class:Qe},h)),(0,s.h)("div",{class:Ke},(0,s.h)("div",{class:Ye},d.join.joinLayer),(0,s.h)("div",{class:Qe},p)))}renderInfo(){const{props:e,title:t}=this,{targetItem:i,targetItemOwner:r,savedItemProps:a}=e,{portal:o}=i,n=o.user,l={portal:o,user:n,api:4};return a?(c.i.title=a.title,c.i.folder=a.folder,c.i.snippet=a.summary||"",c.i.categories=a.categories,c.i.tags=a.tags):(c.i.title=t,c.i.folder=i.ownerFolder&&{id:i.ownerFolder,username:i.owner},c.i.snippet=i.snippet||"",c.i.categories=i.categories,c.i.tags=i.tags),(0,s.h)("div",{class:He},(0,s.h)("arcgis-item-properties",{portal:o,user:n,api:4,config:l,type:"Feature Service",scale:"s"},(0,s.h)("arcgis-title-input",{enablePublishing:!0,onArcgisTitleInputChange:async e=>{const t=e.target,i=await t.validateTitle();(!this.titleError&&i||this.titleError&&!i)&&(0,s.f)(this.hostElement),this.titleError=i}}),(0,s.h)("arcgis-folder-picker",{user:r}),(0,s.h)("arcgis-categories-picker",null),(0,s.h)("arcgis-tags-picker",null),(0,s.h)("arcgis-summary-input",{onArcgisSummaryInputChange:async e=>{const t=e.target,i=await t.getErrorMessage();(!this.summaryError&&i||this.summaryError&&!i)&&(0,s.f)(this.hostElement),this.summaryError=i}})))}get hostElement(){return(0,s.d)(this)}};Xe.style=".panel.sc-arcgis-layer-view-join-create{height:100%}.info.sc-arcgis-layer-view-join-create{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;padding:0 0.75rem}.footer.sc-arcgis-layer-view-join-create{width:100%}.layer-section.sc-arcgis-layer-view-join-create{border:1px solid var(--calcite-color-border-3);background-color:white;margin:10px}.target-layer.sc-arcgis-layer-view-join-create{padding:10px;border-bottom:1px solid var(--calcite-color-border-3)}.add-layer.sc-arcgis-layer-view-join-create{padding:10px}.layer-header.sc-arcgis-layer-view-join-create{padding-bottom:3px}.layer-title.sc-arcgis-layer-view-join-create{font-weight:bold}.notice.sc-arcgis-layer-view-join-create{margin:8px}";const Ze="flow",et="footer",tt="info",it="text",st=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.goNext=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:ae.ADD_SELECTION})},this.onSelectionChange=()=>{const{props:e}=this,{targetLayer:t}=e;this.listNode.querySelectorAll("calcite-list-item").forEach((i=>{i.selected&&(e.targetLayerId=i.value,(0,s.f)(this.hostElement)),"group"===t.type?O(t).find((e=>e.layerId===i.value)).visible=i.selected:t.visible=i.selected})),e.attributeRelationships=void 0,e.joinOperation=void 0},this.props=void 0,this.status=void 0}async componentWillLoad(){const{props:e}=this,{targetLayer:t}=e;"group"!==t.type&&(e.targetLayerId=t.layerId)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.listNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e}=this,{targetItem:t,strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"cf24efab26fc1e154b7730928029e978d176148a",class:"calcite-match-height"},(0,s.h)("calcite-flow",{key:"81f7ae92b44e5047ae8831ceea3aeb15912bd823",class:Ze,dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:"1f67a4044e02f23baeaa1fe44af9229a2c6e164a",heading:null==t?void 0:t.title,description:i.join.targetLayer,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo(),this.renderSublayers())))}renderFooterButtons(){const{props:e}=this,{targetLayerId:t,strings:i}=e,r="rtl"===(0,l.g)(this.hostElement),a=!(0,o.i)(t);return(0,s.h)("div",{slot:"footer",class:et},(0,s.h)("calcite-button",{disabled:a,onClick:!a&&this.goNext,appearance:"solid",width:"full",iconEnd:r?"arrow-left":"arrow-right",label:i.general.next,ref:e=>this.nextButtonNode=e},i.general.next))}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:tt},(0,s.h)("div",{class:it},t.join.selectTargetLayerPanelDescription))}renderSublayers(){var e,t;const{props:i}=this,{targetLayer:r}=i,a=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{a.unshift(this.renderSublayer(e))})),null===(t=x(r))||void 0===t||t.forEach((e=>{a.unshift(this.renderSublayer(e))}))):a.push(this.renderSublayer(r)),(0,s.h)("calcite-list",{selectionMode:"single",onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},a)}renderSublayer(e){const{props:t}=this,{targetLayerId:i}=t;return(0,s.h)("calcite-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:le(e,t),selected:i===e.layerId})}get hostElement(){return(0,s.d)(this)}};st.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.info{pointer-events:none;padding:1rem 0.75rem}.text{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-color-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.notice{margin:8px}";const rt=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewMsgClosed=(0,s.c)(this,"arcgisLayerViewMsgClosed",7),this.props=void 0,this.flowItemElement=void 0,this.isError=!1,this.isWarning=!1,this.message=void 0,this.closeWithOK=void 0}async componentDidLoad(){this.flowItemElement&&(this.flowItemElement.disabled=!0),requestAnimationFrame((()=>{var e;return this.closeWithOK?null===(e=this.okNode)||void 0===e?void 0:e.setFocus():setTimeout((()=>{var e;null===(e=this.noticeNode)||void 0===e||e.setFocus()}),200)}))}disconnectedCallback(){this.flowItemElement&&(this.flowItemElement.disabled=!1)}render(){const{props:e,hostElement:t,flowItemElement:i,isError:r,isWarning:a,message:o,closeWithOK:n}=this,{strings:d}=e,c=(0,l.g)(t),h=Math.round(i.getBoundingClientRect().width);return(0,s.h)(s.H,{key:"61511dfe5152321d40483c4f1985a8931a3ee8d1",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"c8c2cdcd68b45b49a7a912b5fffd4c75a9e04131",dir:c,placement:"trailing-start",open:!0,pointerDisabled:!0,referenceElement:i,offsetDistance:-1*(h-10),offsetSkidding:200,label:o,style:{zIndex:"100",width:h-20+"px"}},(0,s.h)("calcite-notice",{key:"92617942f4e392d31fa70c5e855545f1fe00db23",scale:"s",width:"full",open:!0,closable:!n,icon:r||a?"exclamation-mark-triangle":"check-circle",kind:r?"danger":a?"warning":"success",onCalciteNoticeClose:()=>{this.arcgisLayerViewMsgClosed.emit()},ref:e=>this.noticeNode=e},(0,s.h)("div",{key:"a4c555015a1ea86709153604473c4ca691b8dfe2",slot:"title"},r?d.msg.error:a?d.msg.warning:d.msg.success),(0,s.h)("div",{key:"f2d05bc838759b7e2ea6929ddece74f803e2066f",slot:"message",ref:e=>{e.innerHTML=o}}),n&&(0,s.h)("calcite-button",{key:"90548507f34cf1b9d4501228870e3278e416e97b",appearance:"transparent",slot:"actions-end",label:d.msg.ok,onClick:()=>{this.arcgisLayerViewMsgClosed.emit()},ref:e=>this.okNode=e},d.msg.ok))))}get hostElement(){return(0,s.d)(this)}},at="flow",ot="info-description",nt="has-definition-icon",lt="definition-icon",dt="footer",ct="footer-top",ht=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewOverviewUpdated=(0,s.c)(this,"arcgisLayerViewOverviewUpdated",7),this.arcgisLayerViewOverviewCancel=(0,s.c)(this,"arcgisLayerViewOverviewCancel",7),this.listItemNodes=[],this.goBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})},this.goNext=()=>{this.arcgisLayerViewStatusChange.emit({status:m.CREATE})},this.goUpdate=async()=>{const{props:e,hostElement:t}=this,{strings:i}=e,s=()=>{this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.message=i.msg.updated,t.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewOverviewUpdated.emit())}),7e3)};if(V(e)){this.loading=!0;try{if(await A(this.props),await this.getLatestAdminServiceInfo(),V(this.props)){let e=1e3;const t=async()=>{var i,s;await this.getLatestAdminServiceInfo(),!V(this.props)||e>3e4?null===(s=null===(i=this.props.adminServiceInfo)||void 0===i?void 0:i.layers)||void 0===s||s.forEach((async e=>{var t,i,s,r;const a=null===(r=null===(s=null===(i=null===(t=e.adminLayerInfo)||void 0===t?void 0:t.viewLayerDefinition)||void 0===i?void 0:i.table)||void 0===s?void 0:s.filter)||void 0===r?void 0:r.value;a&&E(e.id,{aoi:JSON.parse(JSON.stringify(a.geometry))},this.props)})):(e*=2,setTimeout(t,e))};setTimeout(t,e)}this.loading=!1,s()}catch(i){const{strings:s}=e;this.loading=!1,console.error("could not create view",i),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.isError=!0,this.msgNode.message=s.msg.updateFailed,t.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}}else s()},this.goCancel=()=>{this.arcgisLayerViewOverviewCancel.emit()},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}arcgisLayerViewOverviewRefreshHandler(){this.status=m.OVERVIEW,this.reRender=!this.reRender}arcgisLayerViewMsgClosedHandler(){const{props:e}=this,{strings:t}=e;this.msgNode&&(this.msgNode.message===t.msg.updated&&this.arcgisLayerViewOverviewUpdated.emit(),this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}async componentWillLoad(){}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,status:t,loading:i}=this,{viewItem:r,layerItem:a,strings:o}=e,n="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"37beb7123e2d7cfbfac855d3c2fb1da47d140904",class:"calcite-match-height"},(0,s.h)("calcite-flow",{key:"a0e1c4073d26aa6f74c9acef31af82152ba1df7f",class:at,dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:t,heading:o.general.includedLayerPanelTitle,description:(null==r?void 0:r.title)||(null==a?void 0:a.title),loading:i,class:{panel:!0,[l.C.rtl]:n},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo(),this.renderSublayers()),[m.DEFINITION,m.FILTER].includes(t)?this.renderLayerDefinition():null))}renderFooterButtons(){const{props:e}=this,{viewItem:t}=e;return(0,s.h)("div",{slot:"footer",class:dt},(0,s.h)("div",{class:ct},this.renderBack(),t?this.renderUpdate():this.renderNext()),t?this.renderCancel():null)}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",label:t.general.back,ref:e=>this.backButtonNode=e},t.general.back)}renderNext(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goNext,appearance:"solid",width:"half",iconEnd:i?"arrow-left":"arrow-right",label:t.general.next,ref:e=>this.nextButtonNode=e},t.general.next)}renderUpdate(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goUpdate,appearance:"solid",width:"half","icon-start":"plus-square",label:t.general.update,ref:e=>this.nextButtonNode=e},t.general.update)}renderCancel(){const{props:e}=this,{layer:t,layerIds:i,strings:r}=e,a=(null==t?void 0:t.loaded)&&i.length;return(0,s.h)("calcite-button",{disabled:!a,onClick:a&&this.goCancel,appearance:"transparent",width:"full",label:r.general.close},r.general.close)}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:ot},t.general.includedLayerPanelDescription))}renderSublayers(){var e,t;const{props:i}=this,{layer:r,layerIds:a}=i,o=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{a.includes(e.layerId)&&o.unshift(this.renderSublayer(e))})),null===(t=x(r))||void 0===t||t.forEach((e=>{a.includes(e.layerId)&&o.unshift(this.renderSublayer(e))}))):o.push(this.renderSublayer(r)),(0,s.h)("calcite-list",{ref:e=>this.listNode=e},o)}renderSublayer(e){const{props:t}=this,{strings:i}=t,r="rtl"===(0,l.g)(this.hostElement),a=I(e.layerId,t);return(0,s.h)("calcite-list-item",{key:e.layerId,label:e.title,description:e.isTable?i.general.table:i.general.layer,onClick:this.goDefinition.bind(this,e.layerId),ref:t=>{t&&(this.listItemNodes[e.layerId]=t)}},a?(0,s.h)("calcite-icon",{class:nt,slot:"content-end",icon:"sliders",scale:"s"}):null,(0,s.h)("calcite-icon",{class:lt,slot:"content-end",icon:r?"chevron-left":"chevron-right",scale:"s"}))}renderLayerDefinition(){const{props:e,status:t}=this,{definitionLayerId:i}=e;return(0,s.h)("arcgis-layer-view-definition",{key:`definition-${i}`,props:e,status:t,class:"calcite-match-height",onArcgisLayerViewOverViewRefresh:()=>setTimeout((()=>{var e;return null===(e=this.listItemNodes[i])||void 0===e?void 0:e.setFocus()}),200)})}goDefinition(e){const{props:t}=this;this.status=m.DEFINITION,t.definitionLayerId=e,this.reRender=!this.reRender}async getLatestAdminServiceInfo(){this.props.adminServiceInfo=void 0,await j(this.props,!0),this.reRender=!this.reRender}get hostElement(){return(0,s.d)(this)}};ht.style=".flow.sc-arcgis-layer-view-overview{height:100%}.panel.sc-arcgis-layer-view-overview{height:100%}.info.sc-arcgis-layer-view-overview{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;pointer-events:none;padding:1rem 0.75rem}.info-description.sc-arcgis-layer-view-overview{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-color-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.has-definition-icon.sc-arcgis-layer-view-overview{color:var(--calcite-color-border-1);cursor:pointer}.definition-icon.sc-arcgis-layer-view-overview{color:var(--calcite-color-text-2);cursor:pointer}.footer.sc-arcgis-layer-view-overview{width:100%}.footer-top.sc-arcgis-layer-view-overview{display:flex}";const pt="flow",ut="info",gt="info-heading",mt="info-description",ft="fixed-list-item",yt=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewSelectionCancel=(0,s.c)(this,"arcgisLayerViewSelectionCancel",7),this.goNext=()=>{const{props:e}=this,{layerIds:t}=e;this.arcgisLayerViewStatusChange.emit({status:m.OVERVIEW,layerIds:t})},this.goSwapSource=()=>{const{props:e}=this,{layerIds:t}=e;this.arcgisLayerViewStatusChange.emit({status:m.SWAP_SOURCE,layerIds:t})},this.onSelectionChange=()=>{const{props:e,hostElement:t}=this,{layer:i,strings:s}=e,r=[];if(this.listNode.querySelectorAll("calcite-list-item").forEach((e=>{e.selected&&r.push(e.value),"group"===i.type?O(i).find((t=>t.layerId===e.value)).visible=e.selected:i.visible=e.selected})),r.length)this.props.layerIds=r;else{this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.message=s.msg.atLeastOne,this.msgNode.isWarning=!0,t.appendChild(this.msgNode);const i=()=>{this.listNode.querySelectorAll("calcite-list-item").forEach((t=>{e.layerIds.indexOf(t.value)>-1&&t.setFocus()}))};this.msgNode.addEventListener("arcgisLayerViewMsgClosed",(()=>i())),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0,i())}),7e3),this.listNode.querySelectorAll("calcite-list-item").forEach((t=>{e.layerIds.indexOf(t.value)>-1&&(t.selected=!0)}))}this.reRender=!this.reRender},this.props=void 0,this.status=void 0,this.reRender=!1}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.reRender=!this.reRender}async setFocus(){const{props:e}=this,{derivativeLayers:t}=e;t.hasAny?requestAnimationFrame((()=>{var e;return null===(e=this.swapButtonNode)||void 0===e?void 0:e.setFocus()})):requestAnimationFrame((()=>{var e;return null===(e=this.listNode)||void 0===e?void 0:e.setFocus()}))}async componentDidLoad(){}render(){const{props:e,status:t}=this,{viewItem:i,layerItem:r,strings:a}=e,o="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"2f66ca33c1928bc73a8df49cfe274eac6900ee95",class:"calcite-match-height"},(0,s.h)("calcite-flow",{key:"6f04a252d2ac8b780cf269b5f5d4b9e371f15e6a",class:pt,dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:"12043895c5f69990a29da20b6311980a2348c471",heading:(null==i?void 0:i.title)||(null==r?void 0:r.title),description:a.general.sourceLayer,class:{panel:!0,[l.C.rtl]:o},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo(),this.renderSublayers()),[m.SWAP_SOURCE,m.BROWSE_LAYER].includes(t)?this.renderSwapSource():null))}renderFooterButtons(){const{props:e}=this,{layer:t,layerIds:i,viewItem:r,derivativeLayers:a,hasReplicas:o,strings:n}=e,d="rtl"===(0,l.g)(this.hostElement),c=!((null==r?void 0:r.typeKeywords.indexOf("IoTFeatureLayer"))>-1)&&["admin","update"].indexOf(null==r?void 0:r.itemControl)>-1,h=(null==t?void 0:t.loaded)&&i.length&&!a.hasAny;return c&&a.hasAny?(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{onClick:!o&&this.goSwapSource,disabled:o,appearance:"solid",width:"full",iconStart:"arrow-right-left",label:n.general.swapSource,ref:e=>this.swapButtonNode=e},n.general.swapSource),(0,s.h)("calcite-button",{onClick:()=>this.arcgisLayerViewSelectionCancel.emit(),appearance:"transparent",width:"full",label:n.general.close},n.general.close)):(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{disabled:!h,onClick:h&&this.goNext,appearance:"solid",width:"full",iconEnd:d?"arrow-left":"arrow-right",label:n.general.next,ref:e=>this.nextButtonNode=e},n.general.next),c&&(0,s.h)("div",null,(0,s.h)("calcite-button",{disabled:!h||o,onClick:h&&!o&&this.goSwapSource,appearance:"transparent",width:"full",iconStart:"arrow-right-left",label:n.general.swapSource,ref:e=>this.swapButtonNode=e},n.general.swapSource)))}renderInfo(){const{props:e}=this,{viewItem:t,derivativeLayers:i,hasReplicas:r,strings:a}=e,o=["admin","update"].indexOf(null==t?void 0:t.itemControl)>-1;return(0,s.h)("div",{class:"info"},i.hasAny?(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"information"},(0,s.h)("div",{slot:"message"},a.general.derivativeLayerNotice)):null,r&&o?(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"information"},(0,s.h)("div",{slot:"message"},a.general.selectLayerPanelReplicaNotice)):null,i.hasAny?null:(0,s.h)("div",null,(0,s.h)("div",{class:gt},a.general.selectLayerPanelTitle),(0,s.h)("div",{class:mt},a.general.selectLayerPanelDescription)))}renderSublayers(){const{props:e}=this,{derivativeLayers:t}=e;return t.hasAny?this.renderNonEditableSublayers():this.renderEditableSublayers()}renderNonEditableSublayers(){var e,t;const{props:i}=this,{layer:r,layerIds:a,strings:o}=i,n=[],l=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{a.indexOf(e.layerId)>-1&&l.unshift(this.renderNonEditableSublayer(e))})),null===(t=x(r))||void 0===t||t.forEach((e=>{a.indexOf(e.layerId)>-1&&n.unshift(this.renderNonEditableSublayer(e))}))):(r.isTable?l:n).push(this.renderNonEditableSublayer(r)),(0,s.h)("div",{class:ut},n.length>0?(0,s.h)("div",{class:gt},o.general.layers):null,n.length>0?(0,s.h)("ul",null,n):null,l.length>0?(0,s.h)("div",{class:gt},o.general.tables):null,l.length>0?(0,s.h)("ul",null,l):null)}renderNonEditableSublayer(e){return(0,s.h)("li",{class:ft},e.title)}renderEditableSublayers(){var e,t;const{props:i}=this,{layer:r}=i,a=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{a.unshift(this.renderEditableSublayer(e))})),null===(t=x(r))||void 0===t||t.forEach((e=>{a.unshift(this.renderEditableSublayer(e))}))):a.push(this.renderEditableSublayer(r)),(0,s.h)("calcite-list",{selectionMode:"multiple",onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},a)}renderEditableSublayer(e){const{props:t}=this,{layerIds:i,strings:r}=t;return(0,s.h)("calcite-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:e.isTable?r.general.table:r.general.layer,selected:i.indexOf(e.layerId)>-1})}renderSwapSource(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-swap-source",{props:e,status:t,onArcgisLayerViewStatusChange:()=>setTimeout((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}),200)})}get hostElement(){return(0,s.d)(this)}};yt.style=".flow.sc-arcgis-layer-view-selection{height:100%}.panel.sc-arcgis-layer-view-selection{height:100%}.footer.sc-arcgis-layer-view-selection{width:100%}.info.sc-arcgis-layer-view-selection{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;pointer-events:none;padding:1rem 0.75rem}.info-heading.sc-arcgis-layer-view-selection{font-size:var(--calcite-font-size--1);line-height:1.375;color:var(--calcite-color-text-2);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);font-weight:var(--calcite-font-weight-medium);pointer-events:none}.info-description.sc-arcgis-layer-view-selection{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-color-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.fixed-list-item.sc-arcgis-layer-view-selection{margin-bottom:10px}";const vt="browse",wt="info",bt="text",It="check",Lt="check-text",Et="footer-button",St=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.onBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})},this.goBrowse=()=>{this.arcgisLayerViewStatusChange.emit({status:m.BROWSE_LAYER})},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,status:t,loading:i}=this,{strings:r}=e,a="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{key:"abee9ab2a763c8b74837a2ffe65a04bed8f5e472",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:t,heading:r.swapSource.title,description:r.swapSource.subTitle,loading:i,class:{panel:!0,[l.C.rtl]:a},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderInfo(),this.renderDerivativeInfo(),this.renderBrowse()),t===m.BROWSE_LAYER&&this.renderBrowseLayer())}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:wt},(0,s.h)("div",{class:bt},t.swapSource.msg1),(0,s.h)("div",{class:bt},t.swapSource.msg2),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:It}),(0,s.h)("span",{class:Lt},t.swapSource.requirement1)),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:It}),(0,s.h)("span",{class:Lt},t.swapSource.requirement2)),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:It}),(0,s.h)("span",{class:Lt},t.swapSource.requirement3)),(0,s.h)("div",{class:bt},t.swapSource.msg3))}renderDerivativeInfo(){const{props:e}=this,{derivativeLayers:t,strings:i}=e;return t.hasMS||t.hasVTL||t.hasScene?(0,s.h)("div",{class:wt},(0,s.h)("div",{class:bt},i.swapSource.derivativeMsg)):null}renderBrowse(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:Et},(0,s.h)("calcite-button",{id:"arcgis-layer-view-swap-source-browse",onClick:this.goBrowse,appearance:"outline-fill",width:"full",label:t.swapSource.browseForLayer,ref:e=>this.browseButtonNode=e},t.swapSource.browseForLayer))}renderBrowseLayer(){const{props:e}=this;return(0,s.h)("arcgis-layer-view-browse-layer",{props:e,class:vt,onArcgisLayerViewStatusChange:e=>{e.detail.status===m.SWAP_SOURCE&&setTimeout((()=>{var e;return null===(e=document.getElementById("arcgis-layer-view-swap-source-browse"))||void 0===e?void 0:e.setFocus()}),400)}})}get hostElement(){return(0,s.d)(this)}};St.style=".panel.sc-arcgis-layer-view-swap-source{height:100%}.browse.sc-arcgis-layer-view-swap-source{width:100%}.info.sc-arcgis-layer-view-swap-source{margin:10px}.text.sc-arcgis-layer-view-swap-source{margin-bottom:8px}.check.sc-arcgis-layer-view-swap-source{color:green}.check-text.sc-arcgis-layer-view-swap-source{font-weight:bold}.footer-button.sc-arcgis-layer-view-swap-source{margin:0 10px 5px 10px}"},44090:(e,t,i)=>{i.d(t,{c:()=>r,o:()=>a});const s=(0,i(10699).c)({portal:null,user:null,api:4,scale:"m"}),r=s.state,a=s.onChange},91616:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>p,c:()=>r,d:()=>s,e:()=>a,f:()=>c,g:()=>g,h:()=>u,i:()=>o,m:()=>n,t:()=>l,u:()=>h});const s=(e,t)=>{let i,s="idle";const r=(...r)=>new Promise((a=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),a(e(...r))):a(null);break;case"invoked":clearTimeout(i),s="idle",a(e(...r));break;case"cancelled":clearTimeout(i),s="idle",a(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",a(e(...r)))),t)}}));return r.flush=function(...e){return s="flushed",r(...e)},r.invoke=function(...e){return s="invoked",r(...e)},r.cancel=function(...e){return s="cancelled",r(...e)},r.getStatus=function(){return s},r},r=(e,t)=>{let i;return(...s)=>new Promise((r=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,r(e(...s))}),t))}))};function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(e){return null!=e}async function n(e,t){return await Promise.all([e,l(t)]),e}function l(e){return new Promise((t=>setTimeout(t,e)))}const d=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function h(e,t){const i=[],s={};return e.forEach((e=>{const r=t(e);null==s[r]&&(s[r]=e,i.push(e))})),i}function p(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const u=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s))),g=(e,t)=>e.includes(t)},10699:(e,t,i)=>{i.d(t,{c:()=>l});var s=i(20536);const r=e=>!("isConnected"in e)||e.isConnected,a=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(r))}),2e3),o=e=>"function"==typeof e?e():e,n=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},l=(e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=o(e);let s=new Map(Object.entries(null!=i?i:{}));const r={dispose:[],get:[],set:[],reset:[]},a=()=>{var t;s=new Map(Object.entries(null!==(t=o(e))&&void 0!==t?t:{})),r.reset.forEach((e=>e()))},l=e=>(r.get.forEach((t=>t(e))),s.get(e)),d=(e,i)=>{const a=s.get(e);t(i,a,e)&&(s.set(e,i),r.set.forEach((t=>t(e,i,a))))},c="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>l(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(d(t,i),!0)}),h=(e,t)=>(r[e].push(t),()=>{n(r[e],t)});return{state:c,get:l,set:d,on:h,onChange:(t,i)=>{const s=h("set",((e,s)=>{e===t&&i(s)})),r=h("reset",(()=>i(o(e)[t])));return()=>{s(),r()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(h("set",t.set)),t.get&&e.push(h("get",t.get)),t.reset&&e.push(h("reset",t.reset)),t.dispose&&e.push(h("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{r.dispose.forEach((e=>e())),a()},reset:a,forceUpdate:e=>{const t=s.get(e);r.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.a)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.a)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),a(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),a(e)}}})()),i}},76776:(e,t,i)=>{i.d(t,{a:()=>s,i:()=>r});const s=(0,i(10699).c)({title:"",snippet:"",tags:[],categories:[]}),r=s.state},79241:(e,t,i)=>{var s,r;i.d(t,{a:()=>r,g:()=>n,l:()=>s,s:()=>o}),function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(s||(s={})),function(e){e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed"}(r||(r={}));const a=e=>JSON.parse((e=>localStorage.getItem(e))(e))||{},o=(e,t)=>{const i=a(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},n=(e,t)=>{const i=a(e);return(null==i?void 0:i.hasOwnProperty(t))?i[t]:null}},38973:(e,t,i)=>{i.d(t,{a:()=>m,b:()=>p,c:()=>b,d:()=>y,e:()=>I,f:()=>a,g:()=>w,h:()=>o,i:()=>v,j:()=>u,k:()=>g,p:()=>h,r:()=>l,s:()=>r,t:()=>f,v:()=>d});var s=i(44090);const r=/\+|\?|\/|\(|\)|\\|\!|\#|\"|\||\*|\:|<|>|\%|\$|\@|\'|\^|\[|\]|\,|\=|\;/gi,a=/(\.|outputFormat=)json|geojson$/i,o=/\/ags\//gi,n="MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer|SceneServer|VectorTileServer|StreamServer|WorkspaceServer|GeoenrichmentServer|VideoServer|KnowledgeGraphServer",l=new RegExp(`http.+/(${n})`),d="/arcgis/rest/services|/rest/services|/arcgis/services|/arcgis/rest",c=new RegExp(`(?<server>http.+(?:${d})(?:/?.*/(?<name>.*)/(?<type>${n})))(?!.*/${n})/?(?<soe>\\d+)?.*`,"i"),h=e=>{const t=e.match(c);if(!t){return e.match(o)?{baseServerUrl:e,serverName:null,serverType:"MapServer",index:null}:null}const[,i,s,r,a]=t,n=parseInt(a);return{baseServerUrl:i,serverName:s,serverType:r,index:isNaN(n)?null:n}},p=e=>{if(!e)return null;if(!e.match(d))return null;const t=e.split("/rest");return t.length<2?null:`${t[0]}/rest/`};function u(e){return new URLSearchParams(e).toString()}function g(e,t){return(null==e?void 0:e.includes("?"))?new URLSearchParams(e.substring(e.indexOf("?"))).get(t):""}const m=e=>e&&"/"!==e.charAt(e.length-1)?`${e}/`:e,f=({path:e,url:t})=>{const i=t.split("/"),s=e.split("/");return i.slice(0,i.length-s.length).join("/")};function y(e){const{customBaseUrl:t,portalHostname:i,urlKey:s}=e,{protocol:r}=window.location;return`${r}//${s?`${s}.${t}`:i}`}function v(e){var t,i;return null!==(t=null==e?void 0:e.isWebTierAuth)&&void 0!==t?t:null===(i=e.sourceJSON)||void 0===i?void 0:i.isWebTierAuth}function w(e){var t;const{portal:i,config:r}=s.c||{};return null!==(t=m(null==r?void 0:r.restBaseUrl))&&void 0!==t?t:b(e||i)}function b(e){var t;return m(null!==(t=e.restUrl)&&void 0!==t?t:e.portalUrl)}function I(e){var t,i,s;return(null===(i=null===(t=null==e?void 0:e.user)||void 0===t?void 0:t.sourceJSON)||void 0===i?void 0:i.culture)||(null===(s=null==e?void 0:e.sourceJSON)||void 0===s?void 0:s.culture)||navigator.language||"en-US"}}}]);