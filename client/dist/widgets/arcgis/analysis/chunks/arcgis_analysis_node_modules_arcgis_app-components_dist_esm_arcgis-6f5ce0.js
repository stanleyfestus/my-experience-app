/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0"],{99004:(e,i,t)=>{t.d(i,{c:()=>a,g:()=>r});var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},14188:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_append_upload:()=>w});var a=t(20536),r=t(44090),n=t(90230),o=t(76776),s=t(64243),l=t(52398),d=t(1391),c=t(67914),p=t(7459),u=t(19832),h=t(44069),v=t(34472),f=t(73567),m=t(63262),y=t(30554);t(10699),t(38973),t(27995),t(90079),t(4291),t(369),t(79717),t(25972),t(98034),t(99004),t(76246),t(16093),t(40883),t(86980),t(59377),t(68537),t(78231),t(60883),t(74129),t(10493),t(16808),t(27126),t(11163);async function g(){try{await(0,c.d)(d.a.id,{permanentDelete:!0}),d.a.id=null}catch(e){console.warn("Delete item failed",e)}}const w=class{constructor(e){(0,a.r)(this,e),this.fileSelect=(0,a.c)(this,"fileSelect",7),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.sourceName="",this.itemTypes=[{value:"File Geodatabase",icon:"data",publishable:!0},{value:"Shapefile",icon:"file-zip",publishable:!0}],this.insideModal=!0,this.fullHeight=!0,this.selectedZipFile="File Geodatabase",this.step="upload",this.loading=void 0,this.loaderMessage=void 0,this.loaderType="indeterminate",this.error=void 0,this.overwriteProcess=!1,this.file=void 0,this.header=void 0,this.description=void 0}async handlePrev(e){if(e.preventDefault(),!this.loading){if("analyzeZip"===this.step)return d.a.file=null,void(this.step="upload");d.a.appendOptions.layers.length>1&&(d.a.sourceDataLayer=null),this.newItemPrevPage.emit()}}async handleNext(){var e;if(this.overwriteProcess&&"overwrite"===d.a.addAppendSelectOption){const{addAppendSelectOption:i}=d.a,t=Object.assign({id:null===(e=this.publishResponse)||void 0===e?void 0:e.id,appendType:i,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus},this.publishResponse);this.workflowComplete.emit(t)}else if(d.a.file){if("zip"===d.a.extension)if(this.step="analyzeZip",d.a.type=v.a[this.selectedZipFile].type,"overwrite"===d.a.addAppendSelectOption)d.a.id=this.item.id,await this.handleOverwrite();else{await this.uploadAndAnalyzeFile()&&this.nextStep()}}else this.handleError({code:"providePath"})}async fileSelectHandler(e){var i;const t=e.detail.file;d.a.originalFileName=t.name;const{title:a,fileName:r,extension:l}=(0,n.s)(t,!0);if("overwrite"===d.a.addAppendSelectOption&&!(0,n.v)(d.a.originalFileName,this.sourceName))return void this.handleError({code:"useSameFileName"});if(o.i.title=a,d.a.file=t,d.a.fileName=r,d.a.newItemMode="file",d.a.extension=l,d.a.type="zip"===d.a.extension&&this.isEnterprise?"Shapefile":(0,f.f)(l,this.validTypes)[0].type,d.a.addAsUniqueFile=!0,"esriGeometryMultiPatch"===(null===(i=d.a.sourceDataLayer)||void 0===i?void 0:i.geometryType)&&"File Geodatabase"!==d.a.type&&"Shapefile"!==d.a.type&&"update"!==d.a.addAppendSelectOption)return this.step="upload",void this.handleError({code:"multiPatchRestriction"});const c=(null==t?void 0:t.size)>s.M&&"zip"===d.a.extension,p="overwrite"!==d.a.addAppendSelectOption&&!this.isEnterprise,u="overwrite"===d.a.addAppendSelectOption&&(null==t?void 0:t.size)>s.M;if("overwrite"!==d.a.addAppendSelectOption||c)if("zip"===d.a.extension&&(p||u))this.step="analyzeZip";else{this.step="analyze";await this.uploadAndAnalyzeFile()&&this.nextStep()}else await this.handleOverwrite()}async componentWillLoad(){var e,i;const{existingItem:t,addAppendSelectOption:a}=d.a,{config:n,portal:o}=r.c;this.item=t,this.sourceName=(null===(e=d.a.appendOptions.sourceData)||void 0===e?void 0:e.name)||this.item.name,this.i18n=u.u.i18n.appendUpload,this.config=n,this.isEnterprise=o.isPortal;const s=null===(i=d.a.appendOptions.sourceData)||void 0===i?void 0:i.type;this.allowedExtensions="overwrite"===a?(0,f.m)(["geojson"===s.toLowerCase()?"GeoJson":s]):o.isPortal?h.c:h.d,this.header=this.i18n.selectData,this.description="",this.validTypes=Object.values(v.a).filter((e=>e.appendUploadFormat)),"overwrite"===a&&this.validTypes.push(v.a["Service Definition"]),d.a.id&&await g(),d.a.file=null}async handleOverwrite(){const{existingItem:e,file:i,keepDescription:t,fileName:a,appendOptions:n}=d.a;u.u.nextText="proceed";const s=e;this.loading=!0,this.overwriteProcess=!0,this.newItemToggleNavigationEnabled.emit(!1),this.loaderMessage=u.u.i18n.append.appendLoadingMessages.overwriting;const l=(0,y.g)(await(0,y.f)(this.item.owner,r.c.portal),r.c.portal),{error:c}=await(0,p.f)(n.sourceData,l,{file:i,overwrite:!0,keepDescription:t,fileName:a,existingItemId:s.id});if(c)return this.handleError(c),this.loading=!1,!1;try{const{result:i,error:t}=await(0,p.p)(e,o.i.title,r.c.portal,r.c.user,d.a.appendOptions);if(t)throw t;this.publishResponse=i,this.updateAndCheckStatus(s)}catch(c){return this.handleError({code:"unhandledError"}),this.loading=!1,!1}}async updateAndCheckStatus(e){var i;const{result:t}=await(0,p.r)(e);this.newItemToggleNavigationEnabled.emit(!0);const a=await(0,s.g)(e.id,{success:null==t?void 0:t.success});this.overwriteStatus=null==a?void 0:a.status;const r=Object.assign({id:null===(i=this.publishResponse)||void 0===i?void 0:i.id,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus,appendType:d.a.addAppendSelectOption},this.publishResponse);if("completed"===(null==a?void 0:a.status.toLowerCase()))return r.overwriteStatus=null==a?void 0:a.status,void this.workflowComplete.emit(r);"failed"===(null==a?void 0:a.status.toLowerCase())&&(u.u.nextText="next",this.loading=!1,this.handleError({code:"unhandledError"}))}nextStep(){var e,i,t;let a="appendSelectLayer";const{analyzeResults:r}=d.a,n=r.publishParameters;if(1===(null===(e=r.publishParameters.layers)||void 0===e?void 0:e.length)||!r.publishParameters.layers){if(d.a.dataLayer=null!==(t=null===(i=null==n?void 0:n.layers)||void 0===i?void 0:i[0])&&void 0!==t?t:n,"update"!==d.a.addAppendSelectOption){if(!(0,m.c)(d.a.dataLayer,d.a.sourceDataLayer,d.a.type))return void this.handleError({code:"incompatibleGeometries"})}a="Microsoft Excel"!==d.a.type&&"CSV"!==d.a.type||"esriGeometryPoint"!==(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.geometryType)||"Table"===(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.type)?"add"!==d.a.addAppendSelectOption||d.a.backupLayerFields.some((e=>"esriFieldTypeDate"===e.type))&&!this.isEnterprise?"appendKeyPairSelect":"appendMatchFields":"csvLocationFields"}this.newItemToggleNavigationEnabled.emit(!0),this.newItemUpdatePage.emit(a)}updateLoader(e,i){this.loaderType=e,this.loaderMessage=i}async uploadAndAnalyzeFile(){const{file:e,originalFileName:i,type:t}=d.a,{portal:a,user:n,config:o,lang:c}=r.c;this.loading=!0,this.newItemToggleNavigationEnabled.emit(!1),this.updateLoader((null==e?void 0:e.size)>s.M?"determinate":"indeterminate",u.u.i18n.append.appendLoadingMessages.uploading.replace("${fileName}",i));let p=null;return({error:p}=await(0,s.C)()),p?(this.handleError(p),!1):(this.updateLoader("indeterminate",this.i18n.analyzing),({error:p}=await(0,l.a)({analyzeArgs:{type:"item",itemid:d.a.id,workflow:"append"},itemArgs:{itemType:t},configArgs:{portal:a,user:n,config:o,lang:c},initialize:!0})),p&&(this.handleError(p),d.a.id&&await g()),!p)}async handleError(e){this.newItemToggleNavigationEnabled.emit(!0);let i=u.u.i18n.error,t=this.i18n.errors.errorWhileUpload;switch(e.code){case"exceedsFileSize":t=this.i18n.errors.errorExceedFileSize;break;case"invalidFileGeodatabase":i=u.u.i18n.itemProperties.invalidGeodatabase.title,t=u.u.i18n.itemProperties.invalidGeodatabase.description;break;case"invalidShapefile":i=u.u.i18n.itemProperties.invalidShapefile.title,t=u.u.i18n.itemProperties.invalidShapefile.description;break;case"useSameFileName":t=this.i18n.errors.sameFileName.replace("${x}",this.sourceName);break;case"providePath":t=this.i18n.errors.providePath;break;case"incompatibleGeometries":i=u.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=u.u.i18n.appendSelectLayer.sameGeometryWarningDescription;break;case"multiPatchRestriction":i=u.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=this.i18n.errors.multiPatchErrorDescription;break;case"unhandledError":"overwrite"===d.a.addAppendSelectOption&&(t=this.i18n.errors.errorUpdate)}("incompatibleGeometries"===e.code||"multiPatchRestriction"===e.code&&d.a.id)&&(d.a.file=null,await g()),this.loading=!1,this.error={title:i,description:t}}renderPickZip(){const e=this.itemTypes.map((({value:e,icon:i})=>({optionTitle:this.i18n[e].title,value:e,description:this.i18n[e].description,icon:i})));return(0,a.h)("calcite-label",{class:"zip-select"},(0,a.h)("div",{class:"zip-select-heading"},this.i18n.itemType),(0,a.h)("calcite-tile-select-group",{layout:"vertical",class:"tile-select"},Object.keys(e).map((i=>{const{icon:t,value:r,optionTitle:n,description:o}=e[i];return(0,a.h)("calcite-tile-select",{key:r,checked:r===this.selectedZipFile,heading:n,description:o,icon:t,name:"select-zip-file-for-append","input-enabled":!0,width:"full",type:"radio",value:r,onCalciteTileSelectChange:e=>{this.selectedZipFile=e.target.value}})}))))}render(){const{i18n:e,error:i,loaderType:t,loaderMessage:r,step:n,loading:o,config:s,sourceName:l,validTypes:c,allowedExtensions:p,isEnterprise:u}=this,h="overwrite"===d.a.addAppendSelectOption;h&&(this.header=e.selectData,this.description=e.sameFileNameDescription.replace("${fileName}",l));const v=u&&h?"120004189":"120001300",f=`${s.helpBase}${s.helpMap[v]}`;return(0,a.h)(a.H,{key:"3491a86218cf5e5481450915bbf1187c1196315c",class:{"overflow-hidden":o}},(0,a.h)("arcgis-new-item-loader",{key:"77ee65d83c70489eb4d388925c91c46435baaa46",type:t,active:o,text:r}),"analyzeZip"!==n&&(0,a.h)("div",{key:"5757710c3eb90a1351c560b1feb3b793450bdcb5",class:{"upload-step":!0,"upload-step--header-with-description":h}},(0,a.h)("arcgis-new-item-description",{key:"10291d6864de001ab8c7c4345393e5e2309ce69b",header:this.header,content:this.description})),"analyzeZip"!==n&&(0,a.h)("div",{key:"065cfe5e9c69dde39e6fa8430a22a5434550eaad",class:{"file-browser-container":!0,"file-browser-container--has-description":h}},(0,a.h)("arcgis-file-browser",{key:"22b0e96e87f32d6850780fdeee34b74d3f177294",cloud:!1,validTypes:c,allowedExtensions:p,insideModal:!0,config:s,helpText:e.learnMore,helpLink:f,helpIdType:"append",fullHeight:!0})),"analyzeZip"===n&&(0,a.h)("div",{key:"a2183291771ae7893a2959de7beac13501f478fe",class:"analyze-step"},(0,a.h)("arcgis-new-item-input-readonly",{key:"bcc07c010667e3d8cb3ebfc49514368c21a3f80c",label:e.file}),"zip"===d.a.extension&&this.renderPickZip()),(0,a.h)("arcgis-new-item-alert",{key:"613b69266ae70b3bd50d17007435269b4ef2e751",heading:null==i?void 0:i.title,description:null==i?void 0:i.description,link:{href:null==i?void 0:i.link,title:null==i?void 0:i.linkText},active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.d)(this)}};w.style=":host{overflow:hidden}.file-browser-container{display:block;height:95%}.file-browser-container--has-description{display:block;height:90%}.upload-step{margin-bottom:0px;display:block}.upload-step--header-with-description{margin-bottom:0.75rem;display:block}.read-only{z-index:50;display:block}.zip-select-heading{font-weight:500}"},63262:(e,i,t)=>{function a(e){var i,t;const{dataLayer:a,type:r,sourceDataLayer:n}=e,o=null!==(i=null==a?void 0:a.geometryType)&&void 0!==i?i:null===(t=null==a?void 0:a.layerInfo)||void 0===t?void 0:t.geometryType;if("Microsoft Excel"===r||"CSV"===r){if(("address"===a.locationType&&a.addressFields||"coordinates"===a.locationType)&&"esriGeometryPoint"===(null==n?void 0:n.geometryType))return null;if(!o||"none"===a.locationType||"Table"===(null==n?void 0:n.type))return{title:"noGeometryMatchTitle",description:"noGeometryTableMessage"};if((null==n?void 0:n.geometryType)!==o)return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}else if((null==n?void 0:n.geometryType)!==(null==a?void 0:a.geometryType))return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}function r(e,i,t){return"Microsoft Excel"===t||"CSV"===t?"Table"===(null==i?void 0:i.type)||("esriGeometryPoint"===(null==i?void 0:i.geometryType)&&"none"===(null==e?void 0:e.locationType)||"esriGeometryPoint"===(null==i?void 0:i.geometryType)&&(!!e.addressFields||"none"!==e.locationType)):"Table"===(null==i?void 0:i.type)||(null==e?void 0:e.geometryType)===(null==i?void 0:i.geometryType)}t.d(i,{c:()=>r,v:()=>a})},73567:(e,i,t)=>{t.d(i,{a:()=>l,f:()=>n,i:()=>s,m:()=>o});var a=t(91616),r=t(34472);function n(e,i){let t;t=i?i.map((e=>e.type)):Object.keys(r.a);let a=[];return t.forEach((i=>{var t;(null===(t=r.a[i].fileExt)||void 0===t?void 0:t.indexOf(e))>=0&&a.push(r.a[i])})),a}function o(e){return e?(0,a.b)(e.flatMap((e=>{var i;return null===(i=r.a[e])||void 0===i?void 0:i.fileExt})).filter((e=>!!e))):null}const s=e=>e/1024/1024>50,l=e=>e/1024/1024>20},98034:(e,i,t)=>{t.d(i,{e:()=>n,l:()=>o});var a,r=t(99004),n={exports:{}};a=n.exports,r.c,function(e){var i={Promise:"undefined"!=typeof window?window.Promise:void 0},t="4.24",a="next";function r(e){if(e.toLowerCase()===a)return a;var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}function n(e){return void 0===e&&(e=t),"https://js.arcgis.com/".concat(e,"/")}function o(e){void 0===e&&(e=t);var i=n(e),o=r(e);if(o!==a&&3===o.major){var s=o.minor<=10?"js/":"";return"".concat(i).concat(s,"esri/css/esri.css")}return"".concat(i,"esri/themes/light/main.css")}function s(e){var i=document.createElement("link");return i.rel="stylesheet",i.href=e,i}function l(e,i){if(i){var t=document.querySelector(i);t.parentNode.insertBefore(e,t)}else document.head.appendChild(e)}function d(e){return document.querySelector('link[href*="'.concat(e,'"]'))}function c(e){return!e||r(e)?o(e):e}function p(e,i){var t=c(e),a=d(t);return a||l(a=s(t),i),a}var u={};function h(e){var i=document.createElement("script");return i.type="text/javascript",i.src=e,i.setAttribute("data-esri-loader","loading"),i}function v(e,i,t){var a;t&&(a=f(e,t));var r=function(){i(e),e.removeEventListener("load",r,!1),a&&e.removeEventListener("error",a,!1)};e.addEventListener("load",r,!1)}function f(e,i){var t=function(a){i(a.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",t,!1)};return e.addEventListener("error",t,!1),t}function m(e){void 0===e&&(e={}),u=e}function y(){return document.querySelector("script[data-esri-loader]")}function g(){var e=window.require;return e&&e.on}function w(e){void 0===e&&(e={});var t={};[u,e].forEach((function(e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}));var a=t.version,r=t.url||n(a);return new i.Promise((function(e,i){var n=y();if(n){var o=n.getAttribute("src");o!==r?i(new Error("The ArcGIS API for JavaScript is already loaded (".concat(o,")."))):g()?e(n):v(n,e,i)}else if(g())i(new Error("The ArcGIS API for JavaScript is already loaded."));else{var s=t.css;s&&p(!0===s?a:s,t.insertCssBefore),v(n=h(r),(function(){n.setAttribute("data-esri-loader","loaded"),e(n)}),i),document.body.appendChild(n)}}))}function b(e){return new i.Promise((function(i,t){var a=window.require.on("error",t);window.require(e,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.remove(),i(e)}))}))}function T(e,i){if(void 0===i&&(i={}),g())return b(e);var t=y(),a=t&&t.getAttribute("src");return!i.url&&a&&(i.url=a),w(i).then((function(){return b(e)}))}e.utils=i,e.loadModules=T,e.getScript=y,e.isLoaded=g,e.loadScript=w,e.setDefaultOptions=m,e.loadCss=p,Object.defineProperty(e,"__esModule",{value:!0})}(a);const o=async(e,i)=>(await n.exports.loadModules(e,i)).map((e=>e.__esModule&&e.default?e.default:e))}}]);