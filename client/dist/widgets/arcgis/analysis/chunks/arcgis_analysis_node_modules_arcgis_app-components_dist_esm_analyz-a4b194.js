/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_analyz-a4b194.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_analyz-a4b194"],{52398:(e,o,a)=>{a.d(o,{a:()=>y,g:()=>u,s:()=>p});var r=a(60883),l=(a(74129),a(98034),a(1391)),t=a(44069),i=a(10493),n=a(16808),s=a(38973),d=a(25972);function c(e,o,a,r){var l,t,i,n;const s=null!==(l=o.latitudeFieldName)&&void 0!==l?l:a.latitudeFieldName,d=null!==(t=o.longitudeFieldName)&&void 0!==t?t:a.longitudeFieldName,c=null!==(i=o.coordinateFieldName)&&void 0!==i?i:a.coordinateFieldName,u=null!==(n=o.coordinateFieldType)&&void 0!==n?n:a.coordinateFieldType;return r[e.name]?r[e.name]:e.name===c?null==u?void 0:u.toLowerCase():e.name===s?"latitude":e.name===d?"longitude":e.locationType||"unknown"}const u=(e,o)=>{if(!o)return e;const{layers:a,tables:r}=o;return"Map Service"===e&&!(null==a?void 0:a.length)&&(null==r?void 0:r.length)?"Feature Service":e};async function y({analyzeArgs:e,configArgs:o,itemArgs:a,initialize:u}){var y,m,g,f;const{config:b,lang:S,portal:w,user:F}=o,{itemType:h,ignoreV2FieldTypesVersion:C}=a;if(u&&(0,n.o)(F)){const e=(0,i.b)(null!==(m=null===(y=w.helperServices)||void 0===y?void 0:y.geocode)&&void 0!==m?m:[],F,w.isPortal);if(e&&(l.a.allowGeocode=e.allowGeocode,l.a.isAgoWorldGeocodeServer=e.isAgoWorldGeocodeServer,l.a.isServiceProxyAgoWorldGeocodeServer=e.isServiceProxyAgoWorldGeocodeServer,l.a.isWorldGeocodeServer=e.isWorldGeocodeServer,l.a.geocodeServers=e.geocodeServers,l.a.geocodeServiceUrl=e.geocodeServiceUrl),l.a.geocodeServers){l.a.sourceCountry=(0,i.d)(F.region,w.ipCntryCode);try{l.a.countryCodes=await async function(e,o,a){const r=(0,i.f)(e,a);let l;if(null==r?void 0:r.itemId){const e=`${o}/content/items/${r.itemId}`,a=await(0,d.r)(e),t=a.proxyFilter&&JSON.parse(a.proxyFilter).sourceCountry;t&&(l=t.split(",").map((e=>e.toLowerCase())),l.push("world"))}return Object.keys(i.c).map((e=>({label:i.c[e],value:e}))).filter((({value:e})=>!l||l.includes(e.toLowerCase()))).sort(((e,o)=>e.label<o.label?-1:e.label>o.label?1:0))}(l.a.geocodeServiceUrl,b.restBaseUrl,l.a.geocodeServers),l.a.standardizedFieldNames=await v(l.a.geocodeServiceUrl,S)}catch(e){return console.error("Geocoder unavailable",e),{error:{code:"unavailableGeocoder"}}}}}const{locationType:T,isWorldGeocodeServer:z,geocodeServiceUrl:x,geocodeServers:G,isServiceProxyAgoWorldGeocodeServer:N,sourceCountry:P,analyzeResults:L,analyzedLocationTypes:U}=l.a,k=`${b.restBaseUrl}content/features/analyze`,{isPortal:O}=w;let j,A=!1;"item"===(null==e?void 0:e.type)&&"append"===e.workflow?(j=t.a[h],A=!0):j="Microsoft Excel"===h?"excel":h.toLowerCase();const E="file"===(null==e?void 0:e.type)&&e.analyze3DData;let _={filetype:j};switch(null==e?void 0:e.type){case"url":_.sourceUrl=e.sourceUrl;break;case"item":_.itemid=e.itemid;break;case"file":_=new FormData,_.append("file",e.file),_.append("filetype",E&&"File Geodatabase"===a.itemType?"fileGeodatabase":j);break;case"text":_.text=e.text}if(!E)if(O&&x||!O){const e={enableGlobalGeocoding:!0,sourceLocale:S,locationType:T,returnEstimatedRowCount:!0,returnSize:!0};if(C||(e.fieldTypesVersion="V2"),(O||!O&&(null==G?void 0:G.length))&&(e.geocodeServiceUrl=encodeURI(x)),L||O){const o="address"===T?"addressTypes":"locationTypes";-1===U.indexOf(o)&&U.push(o),e.locationType=T||"coordinates"}(!w.isPortal&&z||w.isPortal&&N)&&(e.sourceCountryHint=L?"":P.toLowerCase(),e.sourceCountry=L?P.toLowerCase():"");const o=JSON.stringify(e);_ instanceof FormData?_.append("analyzeParameters",o):_.analyzeParameters=o}else C||(_ instanceof FormData?_.append("analyzeParameters",JSON.stringify({fieldTypesVersion:"V2"})):_.analyzeParameters=JSON.stringify({fieldTypesVersion:"V2"}));try{const e=await(_ instanceof FormData?(0,d.a)(k,_,{},"post"):(0,d.r)(k,_,{},"post"));if(E){if(!function(e){var o;const a=null==e?void 0:e.publishParameters,r=null===(o=null==a?void 0:a.layers)||void 0===o?void 0:o[0],l=null==r?void 0:r.infoFor3D,t="esriGeometryMultiPatch"===(null==r?void 0:r.geometryType);return l&&t}(e))return{error:{code:"invalid3DObjectFeatureClass"}}}else!async function({response:e,analyzeSelectedLayer:o,initialize:a,geocodeServiceUrl:t,lang:n,portal:u,itemType:y}){var v,m,g,f,b,S;const w=l.a,F=u.isPortal,h="Microsoft Excel"===y,C=h?null!==(m=null===(v=e.publishParameters.layers)||void 0===v?void 0:v[w.selectedSheet])&&void 0!==m?m:null===(g=e.publishParameters.layers)||void 0===g?void 0:g[0]:e.publishParameters;let T;if(!F&&w.isWorldGeocodeServer||F&&w.isServiceProxyAgoWorldGeocodeServer){const e=(0,r.d)(C.sourceCountry);T=w.sourceCountry||C.sourceCountry||"world",T="wo"===T?"world":T,l.a.isWorldGeocodeServer=e,l.a.sourceCountry=T}w.allowGeocode||"address"!==C.locationType||(l.a.locationType="none");!function(e){var o,a,r,t,i,n;const{selectedSheet:s}=l.a,{publishParameters:d}=e,u=null!==(t=null!==(a=null===(o=d.layers)||void 0===o?void 0:o[s])&&void 0!==a?a:null===(r=d.layers)||void 0===r?void 0:r[0])&&void 0!==t?t:d.layerInfo;if(!u)return e;const y=null!==(n=null!==(i=u.addressFields)&&void 0!==i?i:d.addressFields)&&void 0!==n?n:{},p=Object.keys(y).reduce(((e,o)=>Object.assign(Object.assign({},e),{[y[o]]:o})),{});u.fields=u.fields.map((e=>Object.assign(Object.assign({},e),{locationType:c(e,u,d,p)}))),l.a.selectedFields&&(l.a.selectedFields=Object.keys(l.a.selectedFields).reduce(((e,o)=>{const a=l.a.selectedFields[o];return e[o]=Object.assign(Object.assign({},a),{locationType:c(a,u,d,p)}),e}),{}))}(e);const z=function(e){return function(e,o){var a,r,l,t;const{selectedFields:i,type:n,selectedSheet:s}=o;if(!i)return e;const d=e.publishParameters;let c=null==d?void 0:d.layerInfo;switch(n){case"Microsoft Excel":c=null!==(r=null===(a=null==d?void 0:d.layers)||void 0===a?void 0:a[s])&&void 0!==r?r:null===(l=null==d?void 0:d.layers)||void 0===l?void 0:l[0];break;case"GeoJson":c=null===(t=null==d?void 0:d.layers)||void 0===t?void 0:t[0]}return c.fields=c.fields.reduce(((e,o)=>{const a=i[o.name];return a&&(o.alias=a.alias,e.push(o)),e}),[]),e}(e,l.a)}(e);l.a.analyzeResults=z,(null===(f=null==z?void 0:z.publishParameters)||void 0===f?void 0:f.layers)&&(l.a.excelLayers=null===(b=null==z?void 0:z.publishParameters)||void 0===b?void 0:b.layers);const x=(0,i.a)(e,o);a?l.a.backupLayerFields=JSON.parse(JSON.stringify(x.fields)):C.standardizedFieldNames?l.a.standardizedFieldNames=C.standardizedFieldNames:p({lang:n,geocodeServiceUrl:t,locationType:l.a.locationType});"address"===l.a.locationType||"address"===x.locationType||"address"===(null===(S=null==e?void 0:e.publishParameters)||void 0===S?void 0:S.locationType)?l.a.geocodeCost=await(G=x.estimatedRecordCount,(0,d.r)(`${(0,s.g)()}portals/self/cost`,{geocodeCount:G})):l.a.geocodeCost=null;var G}({response:e,initialize:u,analyzeSelectedLayer:A,geocodeServiceUrl:x,lang:S,portal:w,itemType:h});return{}}catch(e){console.error(e);const o=(null==e?void 0:e.message)||e||"";switch(!0){case o.includes("specify data to be analyzed"):return{error:{code:"emptyFile"}};case o.includes("duplicate field names are not allowed"):return{error:{code:"duplicateFieldNames"}};case o.toLowerCase().includes("timeout"):return{error:{code:"timeout"}};case o.toLowerCase().includes("unable to analyze"):if(null===(f=null===(g=null==e?void 0:e.details)||void 0===g?void 0:g.messages[0])||void 0===f?void 0:f.toLowerCase().includes("file exceeds the max size allowed of 10mb."))return{error:{code:"exceedsFileSize"}};case o.toLowerCase().includes("error in analyzing filegeodatabase"):return{error:{code:"invalidFileGeodatabase"}}}return{error:{code:"unhandledError"}}}}async function p({lang:e,geocodeServiceUrl:o,locationType:a}){"address"===a&&(l.a.standardizedFieldNames=await v(o,e))}async function v(e,o){return(await(0,d.r)(e,{},{addTokenManually:!1})).addressFields.reduce(((e,a)=>{var r;return"unknown"!==a.name&&(e[a.name]=(null===(r=null==a?void 0:a.localizedNames)||void 0===r?void 0:r[`${o}`])||a.alias||a.name),e}),{})}},60883:(e,o,a)=>{a.d(o,{C:()=>r,a:()=>l,b:()=>i,c:()=>d,d:()=>n,i:()=>s,r:()=>c,s:()=>t});const r={host:"host",content:"content",manager:"manager",actionBar:"action-bar",menuActions:"menu-actions",table:"table",tooltip:"tooltip"};var l;!function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(l||(l={}));const t=["feature","oriented-imagery"],i=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint"];function n(e){return null!=e}function s(e,o){for(;e;){if(e.nodeName===o.toUpperCase())return!0;e=e.parentElement}return!1}function d(e,o){const a=document.createElement("calcite-tooltip");a.className="table-tooltip",a.referenceElement=e,a.placement="trailing-start",a.open=!0;const l=document.createElement("div");l.className=r.tooltip,l.innerHTML=o,a.append(l),document.body.append(a)}function c(){document.querySelectorAll(".table-tooltip").forEach((e=>{var o;return null===(o=e.parentNode)||void 0===o?void 0:o.removeChild(e)}))}},74129:(e,o,a)=>{var r,l,t,i,n,s;a.d(o,{L:()=>s,a:()=>n,f:()=>l,i:()=>r,l:()=>t,s:()=>i}),function(e){e.sourceUrl="sourceUrl",e.title="title",e.caption="caption",e.linkUrl="linkUrl",e.altText="altText"}(r||(r={})),function(e){e.expression="expression/",e.relationship="relationships/",e.raster="Raster."}(l||(l={})),function(e){e.feature="feature",e.cluster="cluster",e.mapNotes="mapNotes"}(t||(t={})),function(e){e.feature="feature",e.mapImage="map-image",e.scene="scene",e.ogcFeature="ogc-feature",e.imagery="imagery",e.wfs="wfs",e.wms="wms",e.csv="csv",e.geojson="geojson",e.stream="stream",e.imageryTile="imagery-tile",e.tile="tile",e.subtype="subtype",e.orientedImagery="oriented-imagery",e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.knowledgeGraphSublayer="knowledge-graph-sublayer"}(i||(i={})),function(e){e.integer="integer",e.smallInteger="small-integer",e.bigInteger="big-integer",e.single="single",e.double="double",e.long="long",e.string="string",e.date="date",e.dateOnly="date-only",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e.oid="oid",e.guid="guid",e.globalId="global-id",e.number="number"}(n||(n={})),function(e){e.default="default",e.display="display",e.type="type",e.field="field"}(s||(s={}))}}]);