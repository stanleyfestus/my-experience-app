/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-28551f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-28551f"],{13945:(e,t,r)=>{r.r(t),r.d(t,{arcgis_restore_items:()=>v});var s=r(20536),i=r(30554),n=r(37568),o=r(91616),l=r(78231),a=r(25972);r(44090),r(10699),r(38973),r(91102),r(73807),r(34752),r(98034),r(99004),r(369);const d=async(e,t)=>{const r=[],s=[],i=[],n=t=>e.find((e=>e.id===t)),o=async(e,t)=>{if(!e)return!1;try{return await c(e,t),!0}catch(e){const r=Object.assign({},e.details.raw);if("CONT_00486"===(null==r?void 0:r.messageCode)){const{offendingItems:e}=r;return await o(n(null==e?void 0:e[0].itemId),t)}}return!1};return await Promise.all(e.map((async e=>{try{await c(e,t),s.push({item:e})}catch(s){const l=Object.assign({},s.details.raw);if("CONT_00486"===l.messageCode){const{offendingItems:s}=l,a=null==s?void 0:s[0];await o(n(null==a?void 0:a.itemId),t)?r.push({item:e}):0===s.length?(console.warn("Composite restore: offending items are not yet provided"),i.push({item:e,error:l})):i.push({item:e,error:l})}else i.push({item:e,error:l})}}))),{restorableItems:r,sourceItems:s,unrestorableItems:i}},c=(e,t)=>{const r=`${(0,l.e)(e.owner,t)}/items/${e.id}/canRestore`;return(0,a.r)(r)},u=(e,t,r)=>{const s=`${(0,l.e)(e.owner,t)}/items/${e.id}/restore`;return(0,a.r)(s,r?{folder:r===e.owner?"/":r}:{},{},"post")},m=async e=>{var t;null!==(t=e.restoredItems)&&void 0!==t||(e.restoredItems=[]);const{items:r,folder:s,portal:i,restoredItems:n}=e,{restorableItems:l,sourceItems:a}=await d(r,i);return l.length<=0&&a.length<=0?n:(a.length>0&&(n.push(...await h({items:a.map((e=>e.item)),portal:i,folder:s})),await(0,o.t)(500)),m({items:l.map((e=>e.item)),folder:s,portal:i,restoredItems:n}))},h=async e=>{const{items:t,portal:r,folder:s}=e,i=(0,o.h)(t,20),n=[];for(const e of i)n.push(await Promise.all(e.map((e=>u(e,r,null==s?void 0:s.id)))));return n.flat()},v=class{constructor(e){(0,s.r)(this,e),this.arcgisRestoreItemsRestore=(0,s.c)(this,"arcgisRestoreItemsRestore",7),this.arcgisRestoreItemsError=(0,s.c)(this,"arcgisRestoreItemsError",7),this.arcgisRestoreItemsClose=(0,s.c)(this,"arcgisRestoreItemsClose",7),this.headerTitle="",this.restoredItems=[],this.renderContent=()=>this.tooManyItems?(0,s.h)("span",null,this.i18n.cannotBulkRestoreXItems.replace("${number}","60")):this.allSameOwner?(0,s.h)(s.F,null,(0,s.h)("slot",{name:"message"}),this.restoreItemsBuckets.unrestorableItems.length>=1&&this.renderUnrestorableItems(),this.allRestorableItems.length>=1&&this.renderRestorableItems()):(0,s.h)("span",null,this.i18n.cannotBulkRestoreMultipleOwners),this.renderUnrestorableItems=()=>{const{i18n:e,restoreItemsBuckets:t}=this,{unrestorableItems:r}=t;return(0,s.h)(s.F,null,(0,s.h)("arcgis-items-summary",null,(0,s.h)("div",{slot:"title"},(0,s.h)("span",null,e.cannotRestore),(0,s.h)("arcgis-items-summary-bucket",{disableLinks:!0,popoverId:"restore-bucket",summaryGroups:[{items:r}]})),(0,s.h)("div",{slot:"description",innerHTML:(()=>{var t,s,i,n,l,a,d,c;if(r.length>1){const n=1===(0,o.b)(r.map((e=>{var t,r,s;return null===(s=null===(r=null===(t=e.error)||void 0===t?void 0:t.offendingItems)||void 0===r?void 0:r[0])||void 0===s?void 0:s.itemId}))).filter((e=>!!e)).length;return n?e.dependentItems.multipleSameSource.replace("${parent}",`${null===(i=null===(s=null===(t=r[0].error)||void 0===t?void 0:t.offendingItems)||void 0===s?void 0:s[0])||void 0===i?void 0:i.title}`):e.dependentItems.multiple}return 1!==r.length||(null===(l=null===(n=r[0].error)||void 0===n?void 0:n.offendingItems)||void 0===l?void 0:l[0])?e.dependentItems.single.replace("${parent}",`${null===(c=null===(d=null===(a=r[0].error)||void 0===a?void 0:a.offendingItems)||void 0===d?void 0:d[0])||void 0===c?void 0:c.title}`):(console.warn("Composite restore: offending items are not yet provided"),e.dependentItems.singleUnknown)})()})),this.allRestorableItems.length>0&&(0,s.h)("hr",{class:"divider"}))},this.renderRestorableItems=()=>{const{i18n:e}=this;return(0,s.h)(s.F,null,(0,s.h)("arcgis-items-summary",null,(0,s.h)("div",{slot:"title"},(0,s.h)("span",null,e.toRestore[1===this.allRestorableItems.length?"single":"multiple"]),(0,s.h)("arcgis-items-summary-bucket",{disableLinks:!0,popoverId:"restore-bucket",summaryGroups:[{items:this.allRestorableItems}]}))),(0,s.h)("arcgis-folder-picker",{ref:e=>this.folderPickerRef=e,class:"folder-picker",label:this.i18n.restoreTo,user:this.contentUser,onArcgisFolderPickerChange:e=>this.folder=e.detail,overlayPositioning:"fixed"}),(0,s.h)("calcite-notice",{open:!0,class:"leader-1",width:"full"},(0,s.h)("div",{slot:"message"},this.i18n.noticeMessage)))},this.handleRestore=async()=>{this.isLoading=!0;try{const e=await this.folderPickerRef.saveActiveFolder();if(!e||"string"==typeof e)return void(this.isLoading=!1);const{items:t,portal:r,folder:s}=this;this.restoredItems=await m({items:t,portal:r,folder:s}),this.arcgisRestoreItemsRestore.emit({restoredItems:this.restoredItems.flat(),folder:s}),this.active=!1}catch(e){this.arcgisRestoreItemsError.emit({messageCode:e.details.messageCode,folder:this.folder}),this.isLoading=!1}},this.user=void 0,this.portal=void 0,this.items=[],this.active=!1,this.showSelectedItemsCount=!0,this.restoreItemsBuckets={restorableItems:[],sourceItems:[],unrestorableItems:[]},this.isLoading=!1,this.contentUser=void 0}async componentWillLoad(){var e;const t=await(0,n.g)(this.el);this.i18n=t[0],this.contentUser=await(0,i.f)(null===(e=this.items)||void 0===e?void 0:e[0].owner,this.portal),this.folder=(0,i.d)(this.contentUser.username),this.determineRestoreState()}async determineRestoreState(e={fetch:!0}){const{fetch:t}=e;t&&(this.isLoading=!0,this.restoreItemsBuckets=Object.assign({},await d(this.items,this.portal)),this.isLoading=!1);const{restorableItems:r,sourceItems:s}=this.restoreItemsBuckets;this.allRestorableItems=[...r,...s],this.tooManyItems=this.items.length>60,this.allSameOwner=this.items.every((e=>e.owner===this.contentUser.username)),this.canRestore=!this.tooManyItems&&this.allSameOwner&&this.allRestorableItems.length>0,this.headerTitle=this.i18n[this.items.length>1?"restoreItems":"restoreItem"]}render(){const{i18n:e,active:t,isLoading:r,headerTitle:i,renderContent:n}=this;return(0,s.h)("calcite-modal",{key:"acaf52deb3b0fb54dd762d56719a3ac9a4c67c20",open:t,widthScale:"s",kind:"brand",outsideCloseDisabled:!0,onCalciteModalClose:()=>{this.arcgisRestoreItemsClose.emit(),this.active=!1}},(0,s.h)("span",{key:"5bb146aeed377291d017e6e12f5eb3f8da16bcbe",slot:"header",class:"header"},(0,s.h)("slot",{key:"8fb14acc18964fa249a425ae9a3a576af6867969",name:"header"},i)),(0,s.h)("div",{key:"9c6ac90666b3107c1cf0401ef768786e17776294",slot:"content",class:"content"},r?(0,s.h)("calcite-scrim",{loading:!0}):n()),!r&&(0,s.h)(s.F,{key:"29ab40207fd6ac1ae4af7808c5656ae8c18555f1"},(0,s.h)("calcite-button",{key:"7ffad79d5ba58e02eb0e42b8c1e132dfbc719c61",slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisRestoreItemsClose.emit(),this.active=!1},width:"full"},e.cancel),this.canRestore&&(0,s.h)("calcite-button",{key:"69e98d9e3c34dd70cfc7d2358ea1f78685c6f1ca",slot:"primary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:()=>this.handleRestore(),width:"full",disabled:r},e.restore)))}get el(){return(0,s.d)(this)}static get watchers(){return{items:["determineRestoreState"]}}};v.style=".content{display:flex;min-height:72px;flex-direction:column;justify-content:center}::slotted([slot=message]){margin-bottom:1rem}:host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}.folder-picker{margin-top:1rem}.divider{margin-left:0px;margin-right:0px;margin-top:1rem;margin-bottom:0px;border-style:none;border-top:1px solid #ccc}arcgis-items-summary:not(:first-of-type){margin-top:2rem}"},78231:(e,t,r)=>{r.d(t,{a:()=>l,b:()=>o,c:()=>c,d:()=>u,e:()=>m,f:()=>f,g:()=>R,h:()=>p,i:()=>a,j:()=>I,k:()=>w,l:()=>g,m:()=>k,n:()=>b,o:()=>v,p:()=>y,q:()=>h,u:()=>d});var s=r(98034),i=r(38973);function n(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function o(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function l(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function a(e,t){return e.owner===t.username}function d(e,t){return a(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const s=e.owner,i="admin"===e.itemControl,n=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!a(e,t)&&i&&s.includes("esri_")&&!n.includes(s))return!1;return i}(e,t)}const c=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),u=(e,t)=>`${(0,i.a)(t)}item.html?id=${e}`,m=(e,t)=>`${(0,i.g)(t)}/content/users/${e}`,h=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{});function v(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Spatiotemporal")}function f(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("View Service")}function p(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Hosted Service")}function g(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Multi Services View")}function y(e){return(null==e?void 0:e.hasViews)&&!e.sourceSchemaChangesAllowed}async function I(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const n=r.portal,[o]=await(0,s.l)(["esri/request"]);if(null==n?void 0:n.user){return o(`${(0,i.g)(n)}community/users/${n.user.username}`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r;const s=null!==(r=null===(t=e.data)||void 0===t?void 0:t.groups)&&void 0!==r?r:[];return Promise.resolve(s)}),(()=>Promise.reject()))}return Promise.resolve(null)}async function w(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const n=r.portal,[o]=await(0,s.l)(["esri/request"]);return o(`${(0,i.g)(n)}content/items/${r.id}/groups`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r,s,i,n,o;const l=[...null!==(r=null===(t=e.data)||void 0===t?void 0:t.admin)&&void 0!==r?r:[],...null!==(i=null===(s=e.data)||void 0===s?void 0:s.member)&&void 0!==i?i:[],...null!==(o=null===(n=e.data)||void 0===n?void 0:n.other)&&void 0!==o?o:[]];return Promise.resolve(l)}),(()=>Promise.reject()))}async function b(e,t,{relationshipType:r,direction:n}){const o=`${(0,i.g)(t)}content/items/${e}/relatedItems`,[l]=await(0,s.l)(["esri/request"]);return await l(o,{query:{f:"json",relationshipType:r,direction:n},method:"get",responseType:"json"})}function k(e,t){return null==e?void 0:e.some((e=>null==t?void 0:t.some((t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))))}const R=(e,t)=>`${t}/content/items/${e}`},30554:(e,t,r)=>{r.d(t,{a:()=>m,b:()=>h,c:()=>f,d:()=>v,e:()=>d,f:()=>l,g:()=>u,h:()=>c,u:()=>p});var s=r(25972),i=r(44090),n=r(78231),o=r(38973);async function l(e,t){return(0,s.r)(`${(0,o.g)(t)}/community/users/${e}`)}async function a(){return(0,s.r)(`${(0,o.g)()}/community/self`)}async function d(e,t){var r;if(null!=e||(e=null===i.c||void 0===i.c?void 0:i.c.user),!e)return[];const n=await(0,s.f)((()=>a()),"communitySelf",e.username);return(null!==(r=null==n?void 0:n.groups)&&void 0!==r?r:[]).sort(((e,r)=>{var s;return null===(s=e.title)||void 0===s?void 0:s.localeCompare(r.title,t||"en",{sensitivity:"base"})}))}async function c(){const e=null===i.c||void 0===i.c?void 0:i.c.user;if(!e)return null;return(await(0,s.f)((()=>a()),"communitySelf",e.username)).favGroupId}function u(e,t){var r;return null!==(r=null==e?void 0:e.userContentUrl)&&void 0!==r?r:`${(0,o.g)(t)}content/users/${e.username}`}async function m(e){var t;const r=null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,n=await async function(e){var t;const r=u(null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,i.c.portal);try{return await(0,s.r)(r,{num:1})}catch(e){return null}}(r);if(!n)return null;const{folders:o}=n,{username:l}=r;return[{username:l,id:l,title:l,created:"now"},...o.sort(((e,t)=>e.title.localeCompare(t.title)))]}async function h(e,t){var r;if(!(0,n.u)(e,i.c.portal.user))return null;const s=e.folderId||e.ownerFolder,o=null!==(r=null!=t?t:i.c.user)&&void 0!==r?r:i.c.portal.user,l=await m(o);return null==l?void 0:l.find((e=>e.id===s))}function v(e){return{username:e,id:e,title:e,created:"now"}}async function f(e,t){var r,n;try{const n=`${u(null!==(r=null!=t?t:i.c.user)&&void 0!==r?r:i.c.portal.user,i.c.portal)}/createFolder`;return{result:await(0,s.r)(n,{title:e},{},"post")}}catch(e){return console.error(e),(null===(n=e.details)||void 0===n?void 0:n.messages).some((e=>e.includes("not available")))?{error:{code:"folderNameExists"}}:{error:{code:"unhandledError"}}}}async function p(e,t,r){var n;const o=`${u(null!==(n=null!=r?r:i.c.user)&&void 0!==n?n:i.c.portal.user,i.c.portal)}/${e}/updateFolder`;try{const e=await(0,s.r)(o,{newTitle:t},{},"post");return e.error?{error:{code:"unhandledError"}}:{result:e}}catch(e){return{error:{code:"unhandledError"}}}}}}]);