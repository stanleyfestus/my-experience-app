/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a"],{85640:(i,t,a)=>{a.r(t),a.d(t,{arcgis_item_classification:()=>r});var e=a(20536),s=a(37568),l=a(28250),n=a(44090),o=a(38973);a(91102),a(73807),a(34752),a(98034),a(99004),a(25972),a(369),a(10699);const r=class{constructor(i){(0,e.r)(this,i),this.retrieveClassificationSchema=async()=>{var i,t;const a=`${n.c.config.restBaseUrl}portals/self/classification/classificationSchema`,{result:e,error:s}=await(0,l.r)(a);e?(l.i.itemClassificationSchema=e,this.classificationCategoryArr=null===(t=null===(i=e.classificationMetadata)||void 0===i?void 0:i.classificationValueProperties)||void 0===t?void 0:t.map((({value:i,textColor:t,backgroundColor:a})=>({value:i,label:i,textColor:t,backgroundColor:a}))),e.attributeCategories&&this.setAttributeCategory(e.attributeCategories[0]),this.primaryAttribute=e.classificationMetadata.primaryAttribute,this.retrieveItemClassificationValue()):this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==s?void 0:s.message})},this.retrieveItemClassificationValue=async()=>{const{itemClassificationSchema:i}=l.i,t=`${(0,o.g)(n.c.portal)}content/items/${this.itemId}`,{result:a,error:e}=await(0,l.a)(t);if(e)console.error(e),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==e?void 0:e.message});else{if(null==a?void 0:a.banner){const{error:i}=await(0,l.v)(a);i&&this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:i.messages.join(", ")})}l.i.itemClassificationValueWithDefaults=(0,l.d)(a,this.primaryAttribute,i),l.i.itemClassificationValue=(0,l.b)(a,this.primaryAttribute,i),this.classificationType=(0,l.c)({value:l.i.itemClassificationValueWithDefaults[this.primaryAttribute]},i)}},this.generateBannerText=async()=>{const{itemClassificationSchema:i,itemClassificationValue:t}=l.i;if(!(null==t?void 0:t.banner)&&!this.hasCreatedBannerForDefaultValues)return this.hasCreatedBannerForDefaultValues=!0,void this.displayClassificationVal("UNCLASSIFIED");const a=await(0,l.g)(i,t);l.i.itemClassificationValue.banner=a,this.displayClassificationVal(a)},this.setClassificationType=i=>{this.classificationType=i},this.setAttributeCategory=i=>{this.attributeCategory=i},this.closeClassificationEditModal=i=>{"cancel"===i&&(l.i.classificationErrors={requiredError:[],conflictsError:[]},this.hasCreatedBannerForDefaultValues=!1,this.classificationType=null,this.retrieveClassificationSchema()),this.setIsDisplayModal(!1)},this.saveEditInfo=i=>{const t=structuredClone(i),a=n.c.user.username,e=Date.now();t.lastEditedUser=a,t.lastEditedDate=e;const{createdUser:s,createdDate:l}=t;return s||l||(t.createdUser=a,t.createdDate=e),t},this.handleItemClassificationChange=async()=>{const{itemClassificationSchema:i,itemClassificationValueWithDefaults:t,classificationErrors:a,activeAttributeId:e}=l.i;this.currSelectionText=await(0,l.e)(i,"UNCLASSIFIED"===t[this.primaryAttribute]?Object.assign(Object.assign({},t),{[this.primaryAttribute]:i.classificationMetadata.defaultValue}):t),this.generateBannerText(),this.isEnableAttribute=await(0,l.f)(i,t);const s=await(0,l.h)(i,t,a,e);l.i.classificationErrors.conflictsError=s;const n=(0,l.j)({isEnableAttribute:this.isEnableAttribute,i18n:this.i18n,itemClassificationSchema:i,itemClassificationValue:t,classificationErrors:a,activeAttributeId:e});l.i.classificationErrors.requiredError=n,this.hasError=!!s.length||!!n.length},this.saveItemClassificationValue=async()=>{const{itemClassificationSchema:i,itemClassificationValueWithDefaults:t,classificationErrors:a}=l.i,e=(0,l.k)(this.isEnableAttribute,this.i18n,i,t,a);let s=await(0,l.l)(i,t);if(e){this.isSaving=!0,this.hasError=!1;const t=`${n.c.config.restBaseUrl}content/users/${this.itemOwner}/items/${this.itemId}/update`;s=this.saveEditInfo(s),s.banner=await(0,l.g)(i,s);const{error:a}=await(0,l.s)(t,s);a?(this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:a.details.join(", ")})):(this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"success",alertIndicatorIcon:"check-circle",alertIndicatorInfo:this.i18n.classificationValueSaved}),this.closeClassificationEditModal("save"),this.retrieveClassificationSchema())}else this.isSaving=!1,this.hasError=!0},this.resetClassificationValue=()=>{const{itemClassificationSchema:i}=l.i,t=i.classificationMetadata.defaultValue;this.classificationType=(0,l.c)({value:t},i),this.setItemClassificationValue(t)},this.setItemClassificationValue=i=>{const{itemClassificationSchema:t}=l.i,a=(0,l.m)(i,l.i.itemClassificationValueWithDefaults,this.primaryAttribute);l.i.itemClassificationValueWithDefaults=(0,l.n)(t,a),l.i.itemClassificationValue=a},this.renderHeader=()=>{var i,t;const a=null===(i=l.i.itemClassificationSchema)||void 0===i?void 0:i.helpUrl,s=null===(t=l.i.itemClassificationSchema)||void 0===t?void 0:t.helpTooltip;return(0,e.h)("h3",{slot:"header"},this.i18n.itemClassificationEditLabel,!!s&&(0,e.h)("arcgis-item-classification-header-help-tooltip",{helpUrl:a,helpTooltip:s}))},this.renderContent=()=>{const{itemClassificationSchema:i,itemClassificationValue:t,itemClassificationValueWithDefaults:a}=l.i;return(0,e.h)("div",{slot:"content",class:"portal-item-classification-content"},(0,e.h)("item-classification-info",{i18n:this.i18n,primaryAttribute:this.primaryAttribute,currSelectionText:this.currSelectionText}),!!this.classificationType&&(0,e.h)("item-classification-category",{i18n:this.i18n,primaryAttribute:this.primaryAttribute,classificationCategoryArr:this.classificationCategoryArr,classificationType:this.classificationType,onClassificationTypeChange:i=>{this.setClassificationType(i.detail)},onClassificationValueChange:i=>{this.setItemClassificationValue(i.detail)}}),!!i&&!!a&&(0,e.h)("item-classification-content",{i18n:this.i18n,primaryAttribute:this.primaryAttribute,itemClassificationValue:t,itemClassificationValueWithDefaults:a,attributeCategory:this.attributeCategory,onAttributeCategoryChange:i=>{this.setAttributeCategory(i.detail)},onArcgisItemClassificationContentDisplayNotification:i=>this.handleDisplayNotificationModal(i.detail),hasError:this.hasError,isSaving:this.isSaving}))},this.renderContentBottom=()=>(0,e.h)("div",{slot:"content-bottom"},(0,e.h)("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid",class:"item-classification-error"},(0,l.o)(this.i18n,l.i.classificationErrors))),this.renderFooter=()=>{const{i18n:i}=this,t=this.isSaving;return(0,e.h)(e.F,null,(0,e.h)("calcite-button",{"aria-label":i.reset,scale:"l",slot:"back",width:"full",appearance:"outline",disabled:t,onClick:()=>this.resetClassificationValue()},this.isResetting?(0,e.h)("div",{class:"reset-indicator"},(0,e.h)("calcite-loader",{label:"resettingClassification",scale:"m",inline:!0}),(0,e.h)("span",{class:"reset-indicator"},i.resetting)):(0,e.h)("div",null,i.reset)),(0,e.h)("calcite-button",{"aria-label":i.save,scale:"l",slot:"primary",width:"full",disabled:this.hasError,onClick:()=>this.saveItemClassificationValue()},t?(0,e.h)("div",{class:"save-indicator"},(0,e.h)("calcite-loader",{label:"savingClassification",scale:"m",inline:!0}),(0,e.h)("span",{class:"saving-indicator"},i.saving)):(0,e.h)("div",null,i.save)),(0,e.h)("calcite-button",{"aria-label":i.cancel,scale:"l",slot:"secondary",width:"full",appearance:"outline",onClick:()=>this.closeClassificationEditModal("cancel"),disabled:t},(0,e.h)("div",null,i.cancel)))},this.renderModal=()=>(0,e.h)(e.F,null,this.renderHeader(),this.renderContent(),this.hasError&&this.renderContentBottom(),this.renderFooter()),this.handleDisplayNotificationModal=i=>{this.alertIndicator=i,this.isNotificationModalActive=!0},this.handleCloseNotificationModal=()=>this.isNotificationModalActive=!1,this.itemId=void 0,this.itemOwner=void 0,this.user=void 0,this.config=void 0,this.isDisplayModal=void 0,this.setIsDisplayModal=void 0,this.displayClassificationVal=void 0,this.api=void 0,this.classificationCategoryArr=[],this.classificationType=void 0,this.attributeCategory=void 0,this.primaryAttribute=void 0,this.currSelectionText=void 0,this.isEnableAttribute=[],this.hasError=!1,this.isSaving=!1,this.isResetting=!1,this.isNotificationModalActive=!1,this.hasCreatedBannerForDefaultValues=!1,this.alertIndicator={alertIndicatorActive:!1,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:""}}async componentWillLoad(){var i,t,a;const e=await(0,s.g)(this.el);null!==(i=n.c.api)&&void 0!==i||(n.c.api=this.api),null!==(t=n.c.user)&&void 0!==t||(n.c.user=this.user),null!==(a=n.c.config)&&void 0!==a||(n.c.config=this.config),this.i18n=e[0],this.retrieveClassificationSchema(),l.p.onChange("itemClassificationValue",(()=>{this.handleItemClassificationChange()}))}async handleAttributeValueChange(i){const t=i.detail;l.i.activeAttributeId=t.attributeId,l.i.itemClassificationValueWithDefaults=t.classificationWithDefaults,l.i.itemClassificationValue=t.classification}render(){return(0,e.h)(e.F,{key:"8889487dd5071d54f11dcc0463fc54db2fe8bc08"},(0,e.h)("calcite-modal",{key:"809ddd774b8c6fc51396001ae79fc72d2d7a81d2",class:"portal-item-classification-viewer",open:this.isDisplayModal,scale:"m",widthScale:"m",outsideCloseDisabled:!0,onCalciteModalClose:()=>this.closeClassificationEditModal("cancel")},this.renderModal()),this.isNotificationModalActive&&(0,e.h)("item-classification-notification",{key:"9d723dbfaa34c5ed9fc2a9a5b36161f70e8cc649",i18n:this.i18n,alertIndicator:this.alertIndicator,onArcgisItemClassificationNotificationClose:()=>{this.handleCloseNotificationModal()}}))}get el(){return(0,e.d)(this)}};r.style=".portal-item-classification-viewer{--calcite-modal-content-padding:0;--calcite-modal-z-index:1000}.save-indicator{display:inline-flex;width:100%;align-items:center;justify-content:center}.saving-indicator{margin:0 10px}.portal-item-classification-content{margin:1rem}"}}]);