/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_popup--565cd4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_popup--565cd4"],{88492:(e,t,a)=>{a.d(t,{a:()=>c,b:()=>E,c:()=>s,d:()=>S,e:()=>x,f:()=>o,g:()=>p,h:()=>f,i:()=>v,p:()=>L,u:()=>R,v:()=>O});var n=a(10699),r=a(98072),i=a(20536),l=a(91102);const o=(0,n.c)({totalFeatureCount:null,layer:null,mapView:null,originalField:null,numRecords:null,modules:null,strings:null,arcadeExecutor:null,filteredFeatureCount:null,currentScript:null,registeredResultId:null,arcadeSupported:null,invalidScript:null,isTable:null,autoPreviewEnabled:null,selectedLanguage:null,features:null,sqlEngine:null}).state;function s(e){e.totalFeatureCount=void 0,e.mapView=void 0,e.numRecords=void 0,e.layer=void 0,e.originalField=void 0,e.arcadeExecutor=void 0,e.filteredFeatureCount=void 0,e.currentScript=void 0,e.registeredResultId=void 0,e.arcadeSupported=void 0,e.invalidScript=void 0,e.isTable=void 0,e.autoPreviewEnabled=void 0,e.selectedLanguage=void 0,e.features=void 0,e.sqlEngine=void 0}async function c(e){const{isTable:t,layer:a,mapView:n}=o;if(!("fields"in a))return Promise.reject("getOneFeature: wrong layer type");if(t)return d(e);{const t=await n.whenLayerView(a),r="hasM"in a&&a.hasM,i="hasZ"in a&&a.hasZ,l=t.availableFields.length===a.fields.length&&!r&&!i;if("createQuery"in a&&l){const n=a.createQuery();n.start=0,n.num=5,n.outFields=["*"],n.returnGeometry=!0,n.outSpatialReference=a.spatialReference;const r=await t.queryFeatures(n);return r.features&&r.features.length?Promise.resolve(r):await d(e)}return await d(e)}}async function d(e){const{layer:t,modules:a}=o;if(!("queryFeatures"in t))return Promise.resolve(m(t,a));try{const n=await u(e);return n?Promise.resolve(n):Promise.resolve(m(t,a))}catch(e){}}async function u(e){var t,a;const{layer:n,modules:r}=o,i=new r.Query({outFields:["*"],where:e||"1=1",outSpatialReference:n.spatialReference,returnGeometry:!0,returnM:"hasM"in n&&n.hasM,returnZ:"hasZ"in n&&n.hasZ});return(null===(a=null===(t=n.sourceJSON)||void 0===t?void 0:t.advancedQueryCapabilities)||void 0===a?void 0:a.supportsPagination)&&(i.num=1),await n.queryFeatures(i)}function m(e,t){const a={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?a[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?a[e.name]=0:"date-only"===e.type?a[e.name]=null:a[e.name]=""}));const n=new t.Graphic({geometry:void 0,symbol:void 0,attributes:a});return new t.FeatureSet({features:[n],fields:[],geometryType:e.geometryType,spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}async function p(e="1=1"){const{layer:t,modules:a}=o,n=new a.Query({where:e});return await t.queryFeatureCount(n)}function g(e,t){const{modules:a}=o;return null!=e?y(e,t,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):null}function f(e,t=o.originalField){if(null===e)return e;const{domain:a}=t,n=["date-only","time-only","timestamp-offset"];if(t.domain){const r=function(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const a=t.codedValues.filter((t=>t.hasOwnProperty("code")&&t.code===e));return a&&a.length?a[0].name:e}return null}(e,t.domain);return"date"===t.type&&"range"===a.type?g(r,t):F(t)&&"range"===a.type?b(e,t):n.includes(t.type)&&"range"===a.type?y(r,t):r}return"date"===t.type||n.includes(t.type)||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e.isLuxonDateTime?g(e,t):F(t)?b(e,t):e}function y(e,t,a){const{selectedLanguage:n}=o;return"Arcade"===n?function(e,t,a){const{modules:n}=o;switch(t.type){case"date":return"esri.arcade.arcadedate"===e.declaredRootClass?n.intl.formatDate(e.toJSDate(),Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):n.intl.formatDate(e,a);case"date-only":return"esri.core.sql.dateonly"===e.declaredRootClass?n.intl.formatDateOnly(e.toStorageFormat(),a):n.intl.formatDateOnly(e,a);case"time-only":return"esri.core.sql.timeonly"===e.declaredRootClass?n.intl.formatTimeOnly(e.toStorageString(),a):n.intl.formatTimeOnly(e,a);case"timestamp-offset":return"esri.arcade.arcadedate"===e.declaredRootClass?n.intl.formatTimestamp(e.toISOString(),Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):n.intl.formatTimestamp(e,a);default:return null}}(e,t,a):function(e,t){const{currentScript:a,modules:n}=o;let r=Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"});if("esri.core.sql.timeonly"===e.declaredRootClass&&"time-only"!==t.type)if(a.includes("CURRENT_TIME")){const{day:t,month:a,year:n}=function(e=!0){const t=new Date;return{day:e?t.getDate():t.getUTCDate(),month:(e?t.getMonth():t.getUTCMonth())+1,year:e?t.getFullYear():t.getUTCFullYear()}}();e=e.toUTCDateTime().set({day:t,month:a,year:n})}else e=e.toUTCDateTime().set({year:1900});let i="esri.core.sql.dateonly"===e.declaredRootClass?e.toUTCDateTime().toLocal():e._timeStampOffset?e.toDateTime():(e.isLuxonDateTime||t.type,e);switch(t.type){case"date":return i.isLuxonDateTime&&(i=i.ts),n.intl.formatDate(i,r);case"date-only":return i.isLuxonDateTime&&(i=i.toString()),n.intl.formatDateOnly(i,r);case"time-only":return i.isLuxonDateTime?i.toFormat("h:mm a"):n.intl.formatTimeOnly(i,r);case"timestamp-offset":return n.intl.formatTimestamp(i,r);case"string":return r=Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"UTC"}),"esri.core.sql.dateonly"===e.declaredRootClass?n.intl.formatDateOnly(e.toString(),r):"esri.core.sql.timeonly"===e.declaredRootClass?e.toStorageString():e.isLuxonDateTime?e.toFormat("LLL d yyyy h:mm a"):n.intl.formatDate(i,r)}}(e,t)}function b(e,t){const{modules:a}=o;return["single","double","long"].includes(t.type)?a.intl.formatNumber(parseFloat(e),a.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:2})):["integer","small-integer","big-integer"].includes(t.type)?a.intl.formatNumber(parseFloat(e),a.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:0})):void 0}function F(e){return["integer","small-integer","big-integer","single","double"].includes(e.type)}const h={double:{min:-Infinity,max:Infinity},integer:{min:-2147483648,max:2147483647},single:{min:-3402823e32,max:3402823e32},"small-integer":{min:-32768,max:32767},"big-integer":{min:-9007199254740991,max:9007199254740991}};function v(e){return(0,r.i)(e)&&(e instanceof Date||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e._timeStampOffset||e.isLuxonDateTime)}function T(e,t,a){return a>=e&&a<=t}function w(e){const{originalField:t,strings:a}=o;return["esri.arcade.arcadedate","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e.isLuxonDateTime||e._timeStampOffset?{isFieldValid:e.isValid}:{isFieldValid:!1,errorMessage:a.invalidFieldType.replace("${fieldType}",`${t.type}`)}}function V(e){const{originalField:t}=o;return(!["integer","small-integer","big-integer"].includes(t.type)||e===parseInt(e,10))&&("number"==typeof e&&!isNaN(e)&&e!==1/0&&e!==-1/0)}function C(e){const{originalField:t,strings:a}=o,n=h[t.type];return V(e)?T(n.min,n.max,e)?function(e){var t;const{originalField:a}=o;return"range"!==(null===(t=a.domain)||void 0===t?void 0:t.type)||T(a.domain.minValue,a.domain.maxValue,e)}(e)?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:a.domainOutOfRange.replace("${min}",`${t.domain.minValue}`).replace("${max}",`${t.domain.maxValue}`)}:{isFieldValid:!1,errorMessage:a.outOfRange.replace("${fieldType}",t.type).replace("${min}",`${n.min}`).replace("${max}",`${n.max}`)}:{isFieldValid:!1,errorMessage:a.invalidFieldType.replace("${fieldType}",`${t.type}`)}}function E(e){const{originalField:t}=o;return null===e?t.nullable:void 0!==e}function O(e){const{strings:t,originalField:a}=o;if(null===e&&!isNaN(e))return a.nullable?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:t.nullNotAllowed};if(function(e){return null!==e&&!v(e)&&("function"==typeof e||"object"==typeof e)}(e))return{isFieldValid:!1,errorMessage:t.cannotInsertObject.replace("${fieldType}",`${a.type||t.commonUndefined}`)};switch(a.type){case"string":return function(e){const{originalField:t,strings:a}=o;return(w(e)||V(e))&&e.toString().length<=t.length||"string"==typeof e&&e.length<=t.length?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:a.stringLengthError.replace("${maxStringLength}",`${t.length}`)}}(e);case"double":case"integer":case"single":case"small-integer":case"big-integer":return C(e);case"date":case"timestamp-offset":return w(e);case"date-only":case"time-only":return function(e){const{originalField:t,strings:a}=o;let n=!1;return"date-only"===t.type?n="esri.core.sql.dateonly"===e.declaredRootClass?e.isValid:/[1-9][0-9][0-9]{2}-([0][1-9]|[1][0-2])-([1-2][0-9]|[0][1-9]|[3][0-1])/gm.test(e):"time-only"===t.type&&(n="esri.core.sql.timeonly"===e.declaredRootClass||/^(([0-1][0-9])|([2][0-3])):([0-5][0-9])(:[0-5][0-9](?:[.]\d{1,3})?)?$/gm.test(e)),{isFieldValid:n,errorMessage:n?null:a.invalidFieldType.replace("${fieldType}",`${t.type}`)}}(e);default:return{isFieldValid:!1,errorMessage:t.unexpectedValue}}}function x(e){const{features:t,layer:a,selectedLanguage:n,strings:r}=o,i=e.attributes[a.objectIdField];try{if("Arcade"===n)return function(e,t){const{arcadeExecutor:a,features:n,layer:r}=o;try{let i=a.execute({$feature:e,$datastore:r.url},{spatialReference:r.spatialReference,rawOutput:!0});const o=O(i);return/<\/?[a-z][\s\S]*>/i.test(i)&&(i=(0,l.s)(i)),n[t].calculatedValue=i,n[t].passed=o.isFieldValid,o.isFieldValid?n[t].error=null:n[t].error=o.errorMessage,i}catch(e){throw e}}(e,i);if("SQL"===n)return function(e,t){const{features:a,sqlEngine:n}=o;try{let r=n.calculateValue(e);const i=O(r);return/<\/?[a-z][\s\S]*>/i.test(r)&&(r=(0,l.s)(r)),a[t].calculatedValue=r,a[t].passed=i.isFieldValid,i.isFieldValid?a[t].error=null:a[t].error=i.errorMessage,r}catch(e){throw e}}(e,i)}catch(e){t[i].calculatedValue=null,t[i].error=r.calculationErrorGeneral,t[i].passed=!1}}async function S(e){const{arcadeExecutor:t,features:a,layer:n,strings:r}=o,i=e.attributes[n.objectIdField];try{let r=await t.executeAsync({$feature:e,$datastore:n.url},{spatialReference:n.spatialReference,rawOutput:!0});const o=O(r);return/<\/?[a-z][\s\S]*>/i.test(r)&&(r=(0,l.s)(r)),a[i].calculatedValue=r,a[i].passed=o.isFieldValid,o.isFieldValid?a[i].error=null:a[i].error=o.errorMessage,r}catch(e){a[i].calculatedValue=null,a[i].error=r.calculationErrorGeneral,a[i].passed=!1}}async function L(e){const{arcadeExecutor:t,features:a,invalidScript:n,layer:r,sqlEngine:l}=o,s=(e.attributes||e.graphic.attributes)[r.objectIdField];if(!a[s]){const e=await u(`${r.objectIdField} = ${s}`);a[s]={feature:e.features[0],tableFeature:!1,calculatedValue:void 0,passed:!1}}return!t&&!l||E(a[s].calculatedValue)||a[s].error||((null==t?void 0:t.isAsync)?await S(a[s].feature):await x(a[s].feature)),n?function(){const{strings:e}=o,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.g)("././assets/arcgis-field-calculate-icons/alert-48.svg")}></img>\n  <calcite-label>${e.popupError}</calcite-label>`,t}():E(a[s].calculatedValue)||a[s].error?function(e){const{arcadeExecutor:t,features:a,layer:n,originalField:r,strings:i,sqlEngine:l}=o,s={};for(const t in e)s[t.toLowerCase()]=e[t];const c=document.createElement("div"),d=e[n.objectIdField];if(a[d].error){const e=document.createElement("calcite-label");e.layout="inline";const t=document.createElement("calcite-icon");t.classList.add("popup-error-icon"),t.icon="exclamation-mark-triangle",e.append(t),e.append(a[d].error),c.append(e)}const u=E(a[d].calculatedValue)&&!a[d].error||v(a[d].calculatedValue)?f(a[d].calculatedValue):a[d].calculatedValue,m=document.createElement("calcite-table");m.caption=u;const p=document.createElement("calcite-table-row"),g=document.createElement("calcite-table-header");g.heading=r.alias,p.appendChild(g),m.appendChild(p);const y=document.createElement("calcite-table-row"),b=document.createElement("calcite-table-cell");b.innerHTML=u,y.appendChild(b),m.appendChild(y),c.appendChild(m),c.appendChild(document.createElement("br"));let F=[];const h=t?t.fieldsUsed:l?l.fieldNames:[];if(h.forEach((e=>{if(!Object.keys(s).includes(e.toLowerCase()))return;const t=document.createElement("calcite-table-row"),a=document.createElement("calcite-table-cell");a.innerHTML=e;const r=document.createElement("calcite-table-cell");r.innerHTML=f(s[e.toLowerCase()],n.fields.find((t=>t.name.toLowerCase()===e.toLowerCase()))),t.append(a,r),F.push(t)})),F.length){const e=document.createElement("calcite-label");e.innerHTML=i.fieldsInCalculation;const t=document.createElement("calcite-table");t.bordered=!0,t.append(...F),e.append(t),c.append(e)}return c}(a[s].feature.attributes):function(){const{strings:e}=o,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.g)("././assets/arcgis-field-calculate-icons/edit-48.svg")}></img>\n  <calcite-label>${e.popupPreview}</calcite-label>`,t}()}function R(){var e;const{layer:t,mapView:a,modules:n}=o;(null===(e=null==a?void 0:a.popup)||void 0===e?void 0:e.visible)&&(t.popupTemplate=new n.PopupTemplate({title:t.displayField?`{${t.displayField}}`:`{${t.objectIdField}}`,content:L,lastEditInfoEnabled:!1}))}}}]);