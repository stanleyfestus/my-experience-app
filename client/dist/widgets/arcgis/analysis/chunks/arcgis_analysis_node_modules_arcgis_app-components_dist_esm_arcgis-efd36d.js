/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-efd36d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-efd36d"],{81635:(e,i,r)=>{r.r(i),r.d(i,{arcgis_privileges_picker:()=>d});var t=r(20536),s=r(37568),n=r(79717),o=r(65206),a=r(54717),l=r(44090),c=r(69117);r(91102),r(73807),r(34752),r(98034),r(99004),r(25972),r(38973),r(369),r(10699);const d=class{constructor(e){(0,t.r)(this,e),this.arcgisPrivilegesPickerSelectChange=(0,t.c)(this,"arcgisPrivilegesPickerSelectChange",7),this.orgCapabilities=[],this.notebookServerConfigured=!1,this.handleSwitchChange=e=>{const i=e.target,r=this.privilegesRecords[i.value];if(i.checked&&!this.value.includes(i.value)){const e=[i.value],t=this.getAllDependencies(r);null==t||t.forEach((i=>{this.value.includes(i)||e.push(i)})),this.value=[...this.value,...e]}else{const e=this.getAllDependencies(r,!0);this.value=this.value.filter((r=>r!==i.value&&!(null==e?void 0:e.includes(r))))}this.arcgisPrivilegesPickerSelectChange.emit(this.value)},this.handleToggleAll=(e,i,r)=>{const t=[];if(this.configs.forEach((s=>{(s.key===e||r)&&s.sections.forEach((s=>{s.readonly||r&&s.key!==e||s.privileges.forEach((e=>{if(!e.hidden&&!e.readonly&&!t.includes(e.privilege)){t.push(e.privilege);const r=this.getAllDependencies(e,i);null==r||r.forEach((e=>{t.includes(e)||t.push(e)}))}}))}))})),i)this.value=this.value.filter((e=>!t.includes(e)));else{const e=[...this.value];t.forEach((i=>{e.includes(i)||e.push(i)})),this.value=e}this.arcgisPrivilegesPickerSelectChange.emit(this.value)},this.portalConfig=void 0,this.portal=void 0,this.user=void 0,this.limitToUserPrivileges=!1,this.value=[],this.maxContentHeight="",this.mode="member",this.isPersonalAPIToken=!1,this.readonly=!1,this.privilegesToShow=[],this.searchTerm=""}async componentWillLoad(){var e,i;const r=await(0,s.g)(this.el);this.strings=r[0];const{portalConfig:t,user:a,portal:l}=this,c=l.isPortal;let d;this.servers=await(0,n.b)(a,l),c||(d=await(0,o.a)(l),this.orgCapabilities=(null==d?void 0:d.orgCapabilities)||[]);const h=Boolean(l&&(l.supportsHostedNotebooks||(null===(e=l.sourceJSON)||void 0===e?void 0:e.supportsHostedNotebooks))),u=l&&(l.allowedBetaFeatures||(null===(i=l.sourceJSON)||void 0===i?void 0:i.allowedBetaFeatures));if(c)this.notebookServerConfigured=Boolean(t.notebookServerEnabled&&h);else{const e=["Trial Developer","Trial","Trial Press","Developer Subscription"],i=(null==d?void 0:d.type)&&-1!==e.indexOf(d.type);this.notebookServerConfigured=Boolean(t.notebookServerEnabled&&(!i||(null==u?void 0:u.includes("notebooks"))))}this.portal.isPortal||"app"!==this.mode||this.value.includes("premium:user:basemaps")||(this.value=[...this.value,"premium:user:basemaps"]),this.initConfig()}initConfig(){const e=this.portal.isPortal,i=e?this.checkServerFunction("VelocityServer"):this.orgCapabilities.some((e=>"velocity"===e.id)),r=this.checkServerFunction("KnowledgeServer"),t=this.checkServerFunction("VideoServer"),s=this.value.includes("portal:user:shareGroupToPublic");this.configs=(0,a.g)(this.strings,this.portal,e,this.portalConfig,this.notebookServerConfigured,i,r,t,s,this.user,this.limitToUserPrivileges,this.mode,this.isPersonalAPIToken,this.privilegesToShow),this.privilegesRecords=this.configs.reduce(((e,i)=>Object.assign(Object.assign({},e),i.sections.reduce(((e,i)=>i.privileges.reduce(((e,i)=>Object.assign(Object.assign({},e),{[i.privilege]:i})),e)),{}))),{})}filterBySearchTerm(){const e=this.searchTerm.trim().toLowerCase();this.configs.forEach((i=>{i.sections.forEach((i=>{this.sectionMatchesTerm(i,e)})),i.found=i.heading.toLowerCase().includes(e)||i.sections.some((e=>e.found))}))}sectionMatchesTerm(e,i){var r;e.privileges&&e.privileges.forEach((e=>{this.privilegesMatchesTerm(e,i)})),e.found=!e.hidden&&(e.heading.toLowerCase().includes(i)||Boolean(null===(r=e.privileges)||void 0===r?void 0:r.some((e=>e.found))))}privilegesMatchesTerm(e,i){var r,t;if(e.privilege){const s=(0,a.a)(this.strings,e.privilege,this.mode,this.portal.isPortal),n=(null===(r=s.label)||void 0===r?void 0:r.toLowerCase())||"",o=(null===(t=s.description)||void 0===t?void 0:t.toLowerCase())||"";e.found=!e.hidden&&(n.includes(i)||o.includes(i)||e.privilege.includes(i))}}checkServerFunction(e){var i;return null===(i=this.servers)||void 0===i?void 0:i.some((i=>{var r;return null===(r=i.serverFunction)||void 0===r?void 0:r.includes(e)}))}getAllDependencies(e,i,r=[]){const t=i?e.removeDependencies:e.dependencies;return e&&(null==t?void 0:t.length)?(t.forEach((e=>{const t=this.privilegesRecords[e];t&&!t.hidden&&(r.includes(e)||r.push(e),r=this.getAllDependencies(t,i,r))})),r):r}render(){this.configs.forEach((e=>{e.enabled=0,e.sections.forEach((i=>{i.enabled=0,i.privileges.forEach((r=>{!r.hidden&&this.value.includes(r.privilege)&&(i.enabled++,e.enabled++)}))}))})),this.filterBySearchTerm();const e=Boolean(this.searchTerm);return(0,t.h)("div",{key:"7a60a4e0261fff30a626d9b34024fef0ab3a653d"},!this.readonly&&(0,t.h)("calcite-input",{key:"f6b4fe1d6bf5050712689945f0e4f5b30ffb481b",type:"search",icon:"search",placeholder:this.strings.searchPrivileges,onCalciteInputInput:e=>{this.searchTerm=e.target.value}}),(0,t.h)("calcite-accordion",{key:"c590f544289755180ab1fec10ca6bdbba8b1f3b4",class:"main-wrapper",appearance:this.readonly?"solid":"transparent",iconPosition:"start",style:{"max-height":this.maxContentHeight||"auto"}},this.configs.filter((e=>e.found)).map((i=>{const r=this.isPersonalAPIToken&&("general-privileges"===i.key||"admin-privileges"===i.key);return(0,t.h)("calcite-accordion-item",{key:i.key,heading:i.heading,description:e?"":`${this.strings.enabledLabel} ${i.enabled}${this.readonly?"":`/${i.total}`}`,expanded:!0},(0,t.h)("div",{slot:"actions-end",class:{"actions-end-container":r}},r&&(0,t.h)("arcgis-item-badge",{scale:"s",portal:l.c.portal,user:l.c.user,badgeType:"Personal credential"}),!e&&!this.readonly&&(0,t.h)("calcite-switch",{class:"title-action",checked:i.enabled===i.total,onCalciteSwitchChange:e=>{const r=e.target.checked;this.handleToggleAll(i.key,!r)}})),(0,t.h)("calcite-accordion",{class:"main-section-container",appearance:"transparent",iconPosition:"start"},i.sections.filter((e=>!e.hidden&&e.found)).map((i=>(0,t.h)("calcite-accordion-item",{key:i.key,heading:i.heading,description:e?"":`${this.strings.enabledLabel} ${i.enabled}${this.readonly?"":`/${i.total}`}`,class:"accordion-section-item",expanded:this.readonly},i.readonly&&(0,t.h)("arcgis-information",{slot:"actions-end",class:"read-only-tooltip",label:this.strings.readOnlyBasemapsTooltip,heading:this.strings.readOnlyBasemapsTooltip,overlayPositioning:"fixed"}),!e&&!this.readonly&&(0,t.h)("calcite-switch",{slot:"actions-end",class:"section-action",checked:i.enabled===i.total,disabled:i.readonly,onCalciteSwitchChange:e=>{const r=e.target.checked;this.handleToggleAll(i.key,!r,!0)}}),(0,t.h)("div",{class:"privileges-container"},i.privileges.filter((e=>!e.hidden&&e.found)).map((e=>{const i=(0,a.a)(this.strings,e.privilege,this.mode,this.portal.isPortal);return(0,t.h)("calcite-label",{key:e.privilege,class:"privilege-row",layout:"inline-space-between"},(0,t.h)("div",null,(0,t.h)("div",{class:"privilege-title"},i.label,this.isPersonalAPIToken&&(!e.privilege.includes("premium")||c.p.includes(e.privilege))&&(0,t.h)("arcgis-item-badge",{scale:"s",portal:l.c.portal,user:l.c.user,badgeType:"Personal credential"})),(0,t.h)("div",{class:"privilege-desc"},i.description,"\xa0",e.learnMoreLink&&(0,t.h)("calcite-link",{href:e.learnMoreLink,target:"_blank"},this.strings.learnMore))),!this.readonly&&(0,t.h)("calcite-switch",{value:e.privilege,checked:this.value.includes(e.privilege),onCalciteSwitchChange:this.handleSwitchChange,disabled:e.readonly}))}))))))))}))))}get el(){return(0,t.d)(this)}};d.style=".main-wrapper{margin-top:1rem;overflow-y:auto}.main-section-container{margin-top:1rem}.title-action{margin-inline-start:1rem;margin-inline-end:1.5rem}.section-action{margin-inline-end:0.75rem}.accordion-section-item{margin-bottom:1rem;border-width:1px;border-style:solid;border-color:var(--calcite-color-border-2);background-color:var(--calcite-color-foreground-1)}.enabled-label{margin-inline-end:0.5rem}.privileges-container{padding-top:0.5rem}.privilege-content-end{display:flex;align-items:center;gap:0.75rem}.privilege-row{margin-inline-start:1.75rem;padding-top:0.75rem;padding-bottom:0.75rem}.privilege-title{margin-bottom:0.25rem;display:flex;align-items:center;gap:0.75rem;font-weight:500}.privilege-desc{font-size:0.75rem}.sub-section{margin-inline-start:1.75rem;padding-bottom:0.5rem}.sub-section-heading{display:flex;padding-bottom:1rem}.sub-section-title{flex:1 1 0%}.read-only-tooltip{margin-inline-end:0.75rem}.actions-end-container{display:flex;align-items:center}::-webkit-scrollbar{width:14px}::-webkit-scrollbar-track{background-color:transparent}::-webkit-scrollbar-thumb{background-color:var(--calcite-color-border-1);border-radius:14px;border:4px solid transparent;background-clip:content-box}::-webkit-scrollbar-thumb:hover{background-color:var(--calcite-color-text-3)}"},79717:(e,i,r)=>{r.d(i,{a:()=>u,b:()=>d,c:()=>a,d:()=>l,e:()=>g,f:()=>n,g:()=>h,h:()=>o,i:()=>p,q:()=>c});var t=r(25972),s=r(38973);function n(e){var i;return"ArcGISEnterpriseOnKubernetes"===(e.portalDeploymentType||(null===(i=e.sourceJSON)||void 0===i?void 0:i.portalDeploymentType))}function o(e){var i,r;return e.isPortal?"modern"===(null===(r=e.portalProperties)||void 0===r?void 0:r.homePage)||function(e){var i;return e.isPortal&&"modernOnly"===(null===(i=e.portalProperties)||void 0===i?void 0:i.homePage)}(e):"modern"===(null===(i=e.portalProperties)||void 0===i?void 0:i.homePage)||function(e){const i=new Date("June 30, 2020").getTime();return!e.isPortal&&e.created>=i}(e)}async function a(e){try{return{result:await(0,t.f)((()=>(0,t.r)(`${(0,s.g)(e)}portals/self/resources/home.page.json`)),"homePageConfig",e.id)}}catch(e){return{result:void 0}}}async function l(e){return(0,t.f)((()=>(0,t.r)(`${(0,s.g)(e)}portals/self/userDefaultSettings`)),"memberDefaults",e.id)}async function c(e={},i){return(0,t.r)(`${(0,s.g)(i)}/community/groups`,e)}const d=async(e,i)=>{var r;if(!e)return[];const n=`${(0,s.a)(null!==(r=i.restUrl)&&void 0!==r?r:i.portalUrl)}portals/self/servers`,o=await(0,t.f)((()=>(0,t.r)(n)),"selfServers",i.id);return null==o?void 0:o.servers},h=e=>u((0,s.c)(e)),u=e=>{var i;const r=`${(0,s.a)(null!==(i=(0,s.b)(e))&&void 0!==i?i:e)}info`;return(0,t.f)((()=>(0,t.r)(r,{},{addTokenManually:!1})),"portalInfo",r)};async function g(e,i){return!e.isPortal||await p(e,i)}async function p(e,i){if(!i||!e)return!1;if(!e.isPortal)return!0;const{result:r,error:s}=await(0,t.f)((()=>v(e,i)),"isPortalBackedBySDS",e.id);return!s&&r}const v=async(e,i)=>{if(e.isBackedBySDS)return{result:!0};if(!e.isPortal)return{result:!0};try{return{result:!!await m(i,e)}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)},result:!1}}},m=async(e,i)=>{var r;return(null!==(r=await d(e,i))&&void 0!==r?r:[]).filter((e=>e.isHosted))[0]}},65206:(e,i,r)=>{r.d(i,{a:()=>o,g:()=>a});var t=r(25972),s=r(38973),n=r(84873);const o=async e=>{try{return{result:await(0,t.r)(`${(0,s.g)(e)}portals/self/subscriptionInfo`)}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},a=async(e,i)=>await(0,t.f)((()=>o(e)),"subscriptionType",(0,n.g)(i))}}]);