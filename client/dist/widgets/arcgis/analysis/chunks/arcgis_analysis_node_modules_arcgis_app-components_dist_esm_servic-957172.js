/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-957172.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-957172"],{68537:(e,r,t)=>{t.d(r,{a:()=>o,b:()=>i,c:()=>l,d:()=>m,e:()=>y,f:()=>p,g:()=>v,h:()=>f,i:()=>u,j:()=>h,k:()=>P,l:()=>s,m:()=>g,n:()=>d,o:()=>A,p:()=>b,q:()=>T,r:()=>E,s:()=>S,t:()=>w,u:()=>L,v:()=>D,w:()=>c,x:()=>G});var a=t(78231);const n=e=>{var r,t,a;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(t=null!==(r=null==e?void 0:e.roleId)&&void 0!==r?r:null==e?void 0:e.id)&&void 0!==t?t:null===(a=null==e?void 0:e.sourceJSON)||void 0===a?void 0:a.id};function i(e){return e&&!e.orgId}function l(e,r){return(0,a.u)(e,r)||"update"===e.itemControl||(0,a.c)([e],r)&&y(r)}function o(e,r){const t=(0,a.c)([e],r),n=(0,a.u)(e,r)||y(r)&&t,i=v(r)&&I(r);return!!(n||t&&i)}const s=e=>{var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:manageLicenses"))};function u(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function c(e){return["Developer Subscription"].includes(null==e?void 0:e.type)}function d(e){return["Geoanalytics Engine","GeoAnalytics MS Fabric"].includes(null==e?void 0:e.type)}const p=e=>{var r;return null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.includes("Developer")};function y(e){return"org_admin"===n(e)||"account_admin"===n(e)}function m(e){return["org_admin","account_admin"].includes(n(e))&&!(null==e?void 0:e.roleId)}function v(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function h(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:updateItemCategorySchema"))}function f(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:updateGroups"))}function g(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:assignToGroups"))}const I=e=>{var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:deleteItems"))};function b(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function T(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function w(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function S(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function L(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function E(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function P(e,r,t,a){const n=a&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(a.type),i=((null==r?void 0:r.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!r||!y(r)&&!i||!(null==t?void 0:t.isPortal)&&!n)}function G(e){return!!e&&(!v(e)||v(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const D=({items:e,user:r,portal:t})=>{const n=e[0],i=n.owner;if(t.isPortal&&i!==r.username&&i.includes("esri_")&&!["esri_livingatlas"].includes(i))return!1;const o=(0,a.u)(n,r),s=v(r),u=j(r),c=l(n,r)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(r)&&!s&&(function(e,r){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(r)||b(e)||T(e)||!!r.canSharePublic&&w(e)}(r,t)||j(r));return o||c||(0,a.c)(e,r)&&u};function j(e){return E(e)||S(e)||L(e)}function A(e){const r=["portal:user:createItem","portal:user:viewOrgItems","premium:publisher:createNotebooks","portal:publisher:createDataPipelines","features:user:edit","features:user:fullEdit","portal:admin:viewItems","portal:admin:updateItems","portal:admin:deleteItems"];return e.some((e=>r.includes(e)))}},85877:(e,r,t)=>{t.d(r,{a:()=>_,b:()=>h,c:()=>f,d:()=>N,e:()=>m,s:()=>$,u:()=>v});var a=t(67914),n=t(25972),i=t(78231),l=t(38973),o=t(85781),s=t(91616),u=t(68537),c=t(67324),d=t(53841),p=t(68616),y=t(5479);const m=async(e,r,t,s,u=!1)=>{const{portal:c,user:d}=s,p=`${(0,l.g)(c)}content/users/${d.username}/shareItems`;let y=[];const m=r?function(e){switch(e){case"public":return{org:!1,everyone:!0};case"org":return{org:!0,everyone:!1};case"private":case"shared":return{org:!1,everyone:!1};default:return{}}}(r):{};if(e.every((e=>(0,i.i)(e,d))))try{y=(await(0,o.r)(p,c,{body:Object.assign({items:e.map((e=>e.id)).join(","),groups:(null==t?void 0:t.length)?t.join(","):void 0,confirmItemControl:!0},m),usePost:!0})).results}catch(e){return console.error(e),{error:{code:"unhandledError"}}}else y=(await Promise.all(e.map((({id:e})=>async function(e,r,t,i,l=!1){try{const s=`${(0,a.g)(e,i)}/share`,u=Object.assign({groups:(null==t?void 0:t.length)?t.join(","):null,confirmItemControl:!0},r);let c;return c=l?await(0,o.r)(s,i,{body:u,usePost:!0}):await(0,n.r)(s,u,{},"post"),{result:c}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}(e,m,t,c,u))))).map((e=>e.result));return{result:y}},v=async(e,r,t)=>{const{portal:a,user:n}=t,i=`${(0,l.g)(a)}content/users/${n.username}/unshareItems`;try{return{result:(await(0,o.r)(i,a,{body:{items:e.join(","),groups:(null==r?void 0:r.length)?r.join(","):null},usePost:!0})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};function h(e){const{typeKeywords:r,type:t,url:a}=e,n=r&&g.some((e=>r.includes(e))),i="Image Service"===t&&(null==a?void 0:a.includes("://iservices"))&&a.includes("arcgis.com"),l="Geoprocessing Service"===t&&(null==r?void 0:r.includes("Notebook Web Tool")),o=I.includes(t);return n||i||o||l}function f(e){var r;const t=null===(r=e.typeKeywords)||void 0===r?void 0:r.includes("Hosted Service");return["Vector Tile Service","Map Service","Scene Service","Feature Service"].includes(e.type)&&t}const g=["Location Tracking Service","Location Tracking View","IoTFeed","IoTFeatureLayer","IoTMapImageLayer","IoTStreamLayer","Administrative Report","EditExtensionIndoorsSpaces","ArcgisWorkflowJobLocation"],I=["Knowledge Graph","Pro Project","Data Store","Workflow"],b=async(e,r)=>{const t=e.id;let a,n={items:[],layers:[]};switch(e.type){case"Group Layer":({result:n,error:a}=await T(t,r));break;case"Web Map":case"Web Scene":({result:n,error:a}=await w(t,r));break;case"Web Mapping Application":({result:n,error:a}=await S(t,r));break;case"Web Experience":case"Web Experience Template":({result:n,error:a}=await E(t,e.typeKeywords,r))}return{result:n,error:a}},T=async(e,r)=>{try{const t=await(0,d.g)(e,r);return{result:{items:[],layers:[Object.assign({},t)]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},w=async(e,r)=>{var t,a;try{const n=await(0,d.g)(e,r),{operationalLayers:i,baseMap:l,tables:o,ground:s,mapIPSInfo:u}=n,c=[...null!=i?i:[],...null!==(t=null==l?void 0:l.baseMapLayers)&&void 0!==t?t:[],...null!==(a=null==s?void 0:s.layers)&&void 0!==a?a:[],...null!=o?o:[]];return u&&c.push({itemId:u.positioningService.itemId,layerType:"Indoor Positioning Data Service"}),{result:{items:[],layers:c}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},S=async(e,r)=>{var t;try{const t=await(0,d.g)(e,r);if(!t)return{result:{items:[],layers:[]}};const a=L(t),n=(await Promise.all(a.map((e=>(0,d.a)(e,r))))).map((({result:e})=>e)).filter((e=>e)),i=await Promise.all(n.map((e=>b(e,r)))),{items:l,layers:o}=P(i.map((({result:e})=>e)).flat().filter((e=>e)));return{result:{items:[...n,...l],layers:o}}}catch(e){return(0,c.i)(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")?{result:{items:[],layers:[]}}:(console.error(e),{error:{code:"unhandledError"}})}},L=e=>{var r,t,a,n,i,l,o,s,u,c;return[...(null===(r=null==e?void 0:e.map)||void 0===r?void 0:r.itemId)?[e.map.itemId]:[],...null!==(n=null===(a=null===(t=e.values)||void 0===t?void 0:t.itemCollection)||void 0===a?void 0:a.map((e=>e.id)))&&void 0!==n?n:[],...null!==(o=null===(l=null===(i=e.values)||void 0===i?void 0:i.webmap)||void 0===l?void 0:l.split(","))&&void 0!==o?o:[],...null!==(c=null===(u=null===(s=e.values)||void 0===s?void 0:s.webscene)||void 0===u?void 0:u.split(","))&&void 0!==c?c:[]]},E=async(e,r,t)=>{const n=`${(0,a.g)(e,t)}/resources/config/config.json`,i=(0,d.b)(e,t),l=[];r.includes("status: Draft")?l.push(n):r.includes("status: Changed")?l.push(n,i):l.push(i);try{const e=[],r=[],a=[];return await Promise.all(l.map((async n=>{const i=await(0,o.r)(n,t);if(!(null==i?void 0:i.dataSources)&&!(null==i?void 0:i.utilities))return;const l=(await Promise.all(function(e){const r=e.dataSources||{},t=e.utilities||{};return[...Object.values(r),...Object.values(t)].map((e=>e.itemId)).filter((e=>e))}(i).map((e=>(0,d.a)(e,t))))).map((({result:e})=>e)).filter((e=>e)),s=await Promise.all(l.map((e=>b(e,t)))),{items:u,layers:c}=P(s.flatMap((({result:e})=>e)).filter((e=>e)));a.push(...c),e.push(...u),r.push(...l)}))),{result:{items:[...r,...e],layers:a}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const P=e=>({items:e.flatMap((e=>e.items)),layers:e.flatMap((e=>e.layers))});async function G(e,r,t=!1){try{const{result:a}=await(0,d.c)(e,r);return{result:[...a.admin,...a.member,...a.other].filter((e=>t||!e.isFav)).map((e=>e.id))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const D=e=>!("layerType"in e)&&e.url&&e.popupInfo,j={needsGroupUpdate:!1,needsShareLevelUpdate:!1,canEditShareLevel:!0,premium:!1},A=async(e,r)=>{var t;const a=e.filter((e=>{return!!(null==e?void 0:e.url)&&(r={layerType:e.layerType},["table","ArcGISFeatureLayer","ArcGISTiledMapServiceLayer","VectorTileLayer","GroupLayer","ArcGISImageServiceLayer","ArcGISTiledImageServiceLayer","SubtypeGroupLayer","ArcGISStreamLayer"].includes(r.layerType));var r})),n=await k(a.map((e=>e.url)),r),{result:i}=await(0,y.g)(n,r);return null!==(t=i.map((e=>e.item)))&&void 0!==t?t:[]},k=async(e,r)=>{const t=e.filter((e=>!!e&&!!(0,l.p)(e))),a=e.filter((e=>!e||!(0,l.p)(e)));return[...await(0,y.f)(r,t),...a]},O=async(e,r)=>{const t=[],a=e=>{if((e=>"layerType"in e&&"Indoor Positioning Data Service"===e.layerType)(e))t.push({id:e.itemId,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if(D(e))t.push({id:e.id,url:e.url,layerType:"table",getType:"normal"});else{if("GroupLayer"===e.layerType)return e.itemId&&t.push({id:e.id,itemId:e.itemId,layerType:"GroupLayer",getType:"normal"}),void e.layers.forEach((e=>{if(D(e)||"GroupLayer"===e.layerType)return void a(e);const r=e.url;if(!r)return void a(e);const t=(0,l.p)(r);a(Object.assign(Object.assign({},e),{url:null!=(null==t?void 0:t.index)?t.baseServerUrl:e.url}))}));if((e=>"VectorTileLayer"===e.layerType&&"styleUrl"in e)(e))t.push({id:e.id,url:e.styleUrl,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if((e=>"ArcGISTiledMapServiceLayer"===e.layerType)(e)){const r=(e=>"ArcGISTiledMapServiceLayer"===e.layerType&&"layers"in e&&!1===e.layers[0].disablePopup)(e);if(r){const r=e.layers[0];t.push({id:r.id,url:r.layerUrl,getType:"normal",layerType:e.layerType,itemId:r.layerItemId})}t.push({id:e.id,getType:r?"normal":"tile-layer-with-no-popup",itemId:e.itemId,layerType:e.layerType,url:e.url})}else(e.itemId||e.url)&&t.push({id:e.id,url:e.url,itemId:e.itemId,layerType:e.layerType,getType:"normal"})}};e.forEach(a);const i=(0,s.a)(t,(e=>e.itemId?{key:e.itemId,data:{searchType:"item-id",layerType:e.layerType}}:{key:e.url,data:{searchType:"url",layerType:e.layerType}})),o=Object.keys(i).filter((e=>"item-id"===i[e].searchType));try{const e=(await Promise.all(o.map((e=>(0,d.d)(e,r))))).filter((e=>!!e)),a=t.filter((({getType:e,itemId:r})=>"tile-layer-with-no-popup"===e&&!!r)),l=(await Promise.all(a.map((e=>(async(e,r)=>{try{const t=e.itemId,a=await(0,n.f)((()=>(0,d.g)(t,r)),"itemData",t),{layerItemId:i}=null==a?void 0:a.layers[0];return i?{result:await(0,d.d)(i,r)}:{error:{code:"unhandledError"}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,r))))).map((({result:e})=>e)),u=e.filter((e=>!(0,p.i)(e.typeKeywords,e.type))),c=await A(u.map((e=>{const{url:r,id:t}=e,a=i[t];return a&&"Indoor Positioning Data Service"!==(null==a?void 0:a.layerType)?{layerType:a.layerType,url:r}:null})),r),y=(0,s.a)(c,(e=>({key:e.url,data:e}))),m=Object.keys(i).map((e=>{const r=i[e];return r&&"url"===r.searchType&&"Indoor Positioning Data Service"!==r.layerType?{layerType:r.layerType,url:e}:null})).filter((e=>e)),v=await A(m,r),h=[];return e.filter((e=>e)).forEach((e=>{const r=e.url;h.push({sourceItem:e});const t=y[r];t&&e.id!==t.id&&h.push({sourceItem:t})})),[...l,...v].forEach((e=>{e&&h.push({layer:null,sourceItem:e})})),{result:h}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},U={private:0,shared:1,org:2,public:3},_=async(e,r,t,a={clearDataCacheOnDone:!0})=>{if("private"===e.access)return{result:{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needAuthentication:[]}};const{result:i,error:l}=await C(e,r,t);if(l)return{error:l};const o={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needAuthentication:x(e)?[{sourceItem:e,detail:{canEditShareLevel:!0,needsGroupUpdate:!1,needsShareLevelUpdate:!1,premium:!1}}]:[]};return await Promise.all(null==i?void 0:i.map((async t=>{const a=await F({mainItem:e,sharingDetailResult:t,portal:r});a&&o[a].push(t)}))),a.clearDataCacheOnDone&&N.forEach((e=>(0,n.c)(e))),{result:o}},C=async(e,r,t)=>{let a,n=[],l=[...t||[]];if(!(null==l?void 0:l.length)){const{error:t,result:i}=await b(e,r);a=t,l=i.layers,n=i.items}if(a)return{error:a};if(l.length<=0&&n.length<=0)return{error:{code:"dataNotAvailable"}};try{if("Data Store"!==e.type){const{result:e,error:t}=await O(l,r);if(t)return{error:t};n.push(...e.map((({sourceItem:e})=>e)))}const{result:t,error:a}=await G(e.id,r);if(a)return{error:a};const o=(0,s.u)(n,(e=>e.id)),u=await Promise.all(o.map((async a=>{const n=await async function({mainItemAccess:e,mainItemSharingGroups:r,portal:t,sourceItem:a}){const{access:n,itemControl:l}=a,o=Object.assign({},j),s="public"===e;if(h(a)&&s)return Object.assign(Object.assign({},o),{needsShareLevelUpdate:!0,canEditShareLevel:!1});"public"!==n?(o.canEditShareLevel=M(l),o.needsGroupUpdate=await K({sourceItem:a,isMainItemSharingToPublic:s,mainItemSharingGroups:r,portal:t}),o.needsShareLevelUpdate=W({mainItemAccess:e,sourceItemAccess:n})):o.premium=function(e){return(0,i.a)(e)||(0,i.b)(e)}(a);return o}({sourceItem:a,mainItemAccess:e.access,mainItemSharingGroups:t,portal:r});return{sourceItem:a,detail:n}})));return{result:u}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const M=e=>"admin"===e||"update"===e,x=e=>e.typeKeywords.includes("DeveloperBasemap"),K=async({sourceItem:e,isMainItemSharingToPublic:r,portal:t,mainItemSharingGroups:a})=>{if(r)return!1;const{result:n}=await G(e.id,t);return!function(e,r){if(null==e?void 0:e.length){return e.filter((e=>!(r||[]).includes(e))).length<=0}return!0}(a,n)},W=({mainItemAccess:e,sourceItemAccess:r})=>!("private"===r&&"shared"===e)&&U[e]>U[r];async function $(e,r,t,a,n=!0){const{user:i}=a,l=n?await Promise.all(r.map((async e=>{const{result:r}=await G(e.id,a);return r}))):[],o=l.flat(1);return m(e,t,o,{portal:a,user:i},!0)}const F=async({mainItem:e,sharingDetailResult:r,portal:t})=>{var a;const{sourceItem:n,detail:i}=r,{canEditShareLevel:l,needsGroupUpdate:o,needsShareLevelUpdate:s,premium:c}=i;if(!o&&!s&&!c)return null;if(!l&&!c)return"notEditableLayers";switch(e.access){case"public":if(c)return"premiumLayers";if("public"!==n.access){if((0,u.i)(t.subscriptionInfo||(null===(a=t.sourceJSON)||void 0===a?void 0:a.subscriptionInfo))&&f(n))return"notEditableLayers";if(await(0,d.i)(n,t)){return n.typeKeywords.includes("Public Data Collection")?"needEditableLayers":"needDataCollectionLayers"}}return"needsShareLevelUpdateLayers";case"org":case"shared":case"private":return c?null:"needsShareLevelUpdateLayers";default:V(e.access)}},N=["itemData","itemMetadata"],V=e=>{throw new Error(`Unexpected share level ${e}`)}}}]);