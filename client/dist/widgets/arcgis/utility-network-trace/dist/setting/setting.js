System.register(["jimu-core","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme"],(function(e,t){var a={},s={},i={},l={},o={},r={},n={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.JimuMapViewStatus=e.JimuMapViewStatus,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){s.BaseWidgetSetting=e.BaseWidgetSetting},function(e){i.Alert=e.Alert,i.Checkbox=e.Checkbox,i.Label=e.Label,i.NumericInput=e.NumericInput,i.Option=e.Option,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages},function(e){l.MapWidgetSelector=e.MapWidgetSelector,l.MultipleJimuMapConfig=e.MultipleJimuMapConfig,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection},function(e){o.MapViewManager=e.MapViewManager,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.ThemeColorPicker=e.ThemeColorPicker},function(e){n.colorUtils=e.colorUtils,n.getAppThemeVariables=e.getAppThemeVariables,n.getTheme2=e.getTheme2}],execute:function(){e((()=>{var e={45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a},4108:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=l},54337:e=>{"use strict";e.exports=r}},t={};function u(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,u),i.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>C,default:()=>j});var e=u(79244),t=u(4108),a=u(14321),s=u(79298);const i={selectMapWidgetHint:"The Map widget must have maps that contain a utility network (version 5 or later) and shared trace configurations (ArcGIS Enterprise 10.9 or later)",dataConfigLabel:"Trace Results",mapSettingsHintMsg:"Customize the trace result options for each map",resultAreaLabel:"Result area",resultAreaTooltip:"Generate a result area polygon with an information popup around the trace result elements.",createResultAreaLabel:"Create result area",colorLabel:"Color",showWhenTraceCompleteLabel:"Show when trace completes",shapeLabel:"Shape",convexHullLabel:"Convex Hull",convexHullTooltip:"The smallest convex polygon enclosing all input features. If a distance is defined, it will be applied as a buffer to the convex hull.",bufferLabel:"Buffer",bufferTooltip:"Polygon generated from an offset at each feature's vertices. The distance value will be used to buffer the features.",distanceLabel:"Distance",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",mAreaUnit:"m",ftAreaUnit:"ft",kiAreaUnit:"ki",miAreaUnit:"mi",warningMsgToSelectMap:"A Map widget must be selected to configure this widget.",warningNoMap:"This Map widget does not have any maps.",warningNoTraces:"This map cannot be used with this widget. A utility network or trace configurations are missing.",widgetDeprecationOnline:"The Utility Network Trace tool is deprecated in ArcGIS Online as of November 2024 and will not be supported in future releases. This tool will continue to work in ArcGIS Enterprise.",traceId:"Trace Id",traceName:"Trace name",traceDescription:"Trace description",startingPoints:"Starting points",barriers:"Barriers",username:"User",version:"Version",traceDate:"Date",elementCount:"Count of features",functionResult:"Trace functions",areaStatistic:"Area statistic"};var l=u(62686);function o(t){return e.css`
    .layer-item-panel {
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)}
          ${e.polished.rem(16)};
      }
      .setting-title {
        font-size: ${e.polished.rem(16)};
        .layer-item-label {
          color: ${t.ref.palette.neutral[1e3]};
        }
      }
      .setting-container {
        height: calc(100% - ${e.polished.rem(50)});
        overflow: auto;

        .title-desc {
          color: ${t.ref.palette.neutral[800]};
        }
      }
    }
  `}var r=u(45508),n=u.n(r),p=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(a[s[i]]=e[s[i]])}return a};const h=t=>{const a=window.SVG,{className:s}=t,i=p(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:l,src:n()},i)):e.React.createElement("svg",Object.assign({className:l},i))},d={traceResultAreaSettings:{enableResultArea:!1,resultAreaProperties:{type:"convexhull",distance:10,unit:"",areaUnit:"",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1}}},g=[{value:"meters"},{value:"feet"},{value:"kilometers"},{value:"miles"}],m=[{value:"traceId",label:i.traceId},{value:"traceName",label:i.traceName},{value:"traceDescription",label:i.traceDescription},{value:"startingPoints",label:i.startingPoints},{value:"barriers",label:i.barriers},{value:"version",label:i.version},{value:"username",label:i.username},{value:"date",label:i.traceDate},{value:"elementCount",label:i.elementCount},{value:"functionResult",label:i.functionResult},{value:"areaStatistic",label:i.areaStatistic}];var f,v=u(54337),S=u(1888),b=function(e,t,a,s){return new(a||(a=Promise))((function(i,l){function o(e){try{n(s.next(e))}catch(e){l(e)}}function r(e){try{n(s.throw(e))}catch(e){l(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}n((s=s.apply(e,t||[])).next())}))};!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(f||(f={}));const w=e=>{switch(e){case"feet":return f.Feet;case"miles":return f.Miles;case"kilometers":return f.Kilometers;case"meters":return f.Meters;default:return 1e3}},x=()=>{const t=(0,e.getAppStore)().getState().portalSelf;return"english"===(null==t?void 0:t.units)?"feet":"meters"},y=t=>b(void 0,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const a=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==a?void 0:a.isDataSourceSet())&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then((()=>a)).catch((e=>a)):Promise.resolve(a)}));var A=function(e,t,a,s){return new(a||(a=Promise))((function(i,l){function o(e){try{n(s.next(e))}catch(e){l(e)}}function r(e){try{n(s.throw(e))}catch(e){l(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}n((s=s.apply(e,t||[])).next())}))};class M extends e.React.PureComponent{constructor(t){super(t),this.nls=t=>{const s=Object.assign({},i,a.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.componentDidMount=()=>{this.state.apiLoaded||this.loadAPIModule()},this.loadAPIModule=()=>A(this,void 0,void 0,(function*(){if(this.state.apiLoaded)return Promise.resolve();yield(0,l.loadArcGISJSAPIModules)(["esri/Color"]).then((e=>{[this.EsriColor]=e,this.setState({apiLoaded:!0})}))})),this.onEnableResultAreaChange=e=>{this.setState({enableResultArea:e.target.checked},(()=>{this.props.onResultAreaSettingsUpdated("enableResultArea",this.state.enableResultArea)}))},this.updateResultAreaProperty=()=>{const e=new this.EsriColor(S.colorUtils.getThemeColorVariableValue(this.state.resultAreaColor,(0,S.getAppThemeVariables)()));e.a=.5;const t={type:this.state.resultAreaShapeType,distance:this.state.shapeDistanceInput,unit:this.state.shapeUnit,areaUnit:"square-"+this.state.shapeUnit,color:{color:e.toRgba(),haloOpacity:d.traceResultAreaSettings.resultAreaProperties.color.haloOpacity,hex:S.colorUtils.getThemeColorVariableValue(this.state.resultAreaColor,(0,S.getAppThemeVariables)())},show:this.state.showWhenTraceComplete};this.props.onResultAreaSettingsUpdated("resultAreaProperties",t)},this.onResultAreaColorChange=e=>{this.setState({resultAreaColor:e},(()=>{this.updateResultAreaProperty()}))},this.onShowWhenTraceCompleteSwitchChange=e=>{this.setState({showWhenTraceComplete:e.target.checked},(()=>{this.updateResultAreaProperty()}))},this.handleShapeChange=e=>{this.setState({resultAreaShapeType:e},(()=>{this.updateResultAreaProperty()}))},this.onShapeDistanceChange=e=>{this.setState({shapeDistanceInput:e})},this.onShapeDistanceAcceptValue=e=>{this.setState({shapeDistanceInput:null!=e?e:10},(()=>{this.updateResultAreaProperty()}))},this.onShapeUnitsChange=e=>{const t=((e,t)=>{const a=w(t);return e>a?a:e})(this.state.shapeDistanceInput,e.target.value);this.setState({shapeUnit:e.target.value,shapeDistanceInput:t},(()=>{this.updateResultAreaProperty()}))},this.state={apiLoaded:!1,enableResultArea:this.props.config.enableResultArea,resultAreaColor:this.props.config.resultAreaProperties.color.hex?this.props.config.resultAreaProperties.color.hex:"#ffa500",showWhenTraceComplete:this.props.config.resultAreaProperties.show,resultAreaShapeType:this.props.config.resultAreaProperties.type,shapeUnit:this.props.config.resultAreaProperties.unit?this.props.config.resultAreaProperties.unit:x(),shapeDistanceInput:this.props.config.resultAreaProperties.distance}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:"5px"},css:(this.props.theme,e.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .shapeTypeWidth {
      width: calc(100% - 16px);
    }
  `)},(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Label,{"aria-label":this.nls("resultAreaLabel"),title:this.nls("resultAreaLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"w-100 text-truncate flex-grow-1 title2 hint-paper"},this.nls("resultAreaLabel"))),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("resultAreaTooltip"),title:this.nls("resultAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(h,null)))),(0,e.jsx)(s.SettingRow,{label:this.nls("createResultAreaLabel")},(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("createResultAreaLabel"),title:this.nls("createResultAreaLabel"),checked:this.state.enableResultArea,onChange:this.onEnableResultAreaChange})),this.state.enableResultArea&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,{label:this.nls("colorLabel")},(0,e.jsx)(v.ThemeColorPicker,{"aria-label":this.nls("colorLabel"),specificTheme:(0,S.getTheme2)(),value:this.state.resultAreaColor?this.state.resultAreaColor:"#ffa500",onChange:e=>{this.onResultAreaColorChange(e)}})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("showWhenTraceCompleteLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showWhenTraceComplete,onChange:this.onShowWhenTraceCompleteSwitchChange.bind(this)}),this.nls("showWhenTraceCompleteLabel"))),(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("shapeLabel"),title:this.nls("shapeLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 text-default"},this.nls("shapeLabel")))),(0,e.jsx)(s.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(a.Label,{className:"m-0 shapeTypeWidth",centric:!0},(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("convexHullLabel"),className:"cursor-pointer",value:this.nls("convexHullLabel"),onChange:()=>{this.handleShapeChange("convexhull")},checked:"convexhull"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")}},this.nls("convexHullLabel"))),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("convexHullTooltip"),title:this.nls("convexHullTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(h,null)))),(0,e.jsx)(s.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(a.Label,{className:"m-0 shapeTypeWidth",centric:!0},(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("bufferLabel"),className:"cursor-pointer",value:this.nls("bufferLabel"),onChange:()=>{this.handleShapeChange("buffer")},checked:"buffer"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")}},this.nls("bufferLabel"))),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("bufferTooltip"),title:this.nls("bufferTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(h,null)))),(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("distanceLabel"),title:this.nls("distanceLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 text-default"},this.nls("distanceLabel")))),(0,e.jsx)("div",{className:"pt-1"},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.NumericInput,{style:{width:103},"aria-label":this.state.shapeDistanceInput+"",title:this.state.shapeDistanceInput+"",size:"sm",defaultValue:this.state.shapeDistanceInput,min:0,max:w(this.state.shapeUnit),value:this.state.shapeDistanceInput,showHandlers:!1,onChange:this.onShapeDistanceChange,onAcceptValue:this.onShapeDistanceAcceptValue}),(0,e.jsx)(a.Select,{menuRole:"menu","aria-label":this.state.shapeUnit.toString(),style:{width:129},className:"pl-2",size:"sm",name:"shapeUnits",value:this.state.shapeUnit.toString(),onChange:this.onShapeUnitsChange},g.map(((t,s)=>(0,e.jsx)(a.Option,{role:"option","aria-label":t.value,key:s,value:t.value},this.nls(t.value))))))))))}}var I=function(e,t,a,s){return new(a||(a=Promise))((function(i,l){function o(e){try{n(s.next(e))}catch(e){l(e)}}function r(e){try{n(s.throw(e))}catch(e){l(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}n((s=s.apply(e,t||[])).next())}))};class j extends t.BaseWidgetSetting{constructor(t){var s;super(t),this.dsRef=e.React.createRef(),this.mvManager=l.MapViewManager.getInstance(),this.dataSourceOptions=[],this._mapLoadedTimer=null,this.nls=t=>{const s=Object.assign({},i,a.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.resetConfig=t=>{const a=this.props.config.set("configInfo",{}),s={id:this.props.id,useMapWidgetIds:(null==t?void 0:t.length)>0?t:null,config:a};s.useDataSources=(0,e.Immutable)([]),this.props.onSettingChange(s,[])},this.componentDidUpdate=e=>{if(e.label!==this.props.label){const e=[this.getInitOutDataSource()];setTimeout((()=>{this.props.onSettingChange({id:this.props.id},e)}),100)}},this.onMapWidgetSelected=e=>I(this,void 0,void 0,(function*(){let t;(null==e?void 0:e.length)>0?(t=!1,yield this.getAvailableDataSources(e)):(this.resetConfig(e),t=!0),this.updateConfigForMapWidget(t)})),this.getInitSchema=(t="",a)=>{const s={},i=[];return i.push({alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"}),m.forEach((t=>{var s,l,o,r;const n=(null===(r=null===(o=null===(l=null===(s=null==a?void 0:a.configInfo)||void 0===s?void 0:s[this.state.activeDataSource])||void 0===l?void 0:l.traceResultAreaSettings)||void 0===o?void 0:o.resultAreaProperties)||void 0===r?void 0:r.areaUnit)||"square-feet";"areaStatistic"===t.value?"square-miles"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareMiles")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-meters"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareMeters")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-feet"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareFeet")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-kilometers"===n&&i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareKilometers")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"version"===t.value||"elementCount"===t.value?i.push({alias:this.nls(t.value),type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):i.push({alias:this.nls(t.value),type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),null==i||i.forEach(((e,t)=>{s[null==e?void 0:e.jimuName]=e,0===t&&(s.OBJECTID=e)})),{label:t,idField:"OBJECTID",fields:s}},this.getInitOutDataSource=t=>{const s=Object.assign({},a.defaultMessages),i=this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:s.outputStatistics},{name:this.props.label+" "+this.nls("resultAreaLabel")}),l=`${this.props.widgetId}-output`;const o=this.getInitSchema(i,t||this.props.config);return{id:l,type:e.DataSourceTypes.FeatureLayer,label:i,geometryType:"esriGeometryPolygon",originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:o}},this.updateConfigForMapWidget=e=>{this.setState({isNoMapSelected:e})},this.getAvailableDataSources=t=>I(this,void 0,void 0,(function*(){const a=this.mvManager.getJimuMapViewGroup(t);this.dataSourceOptions=[];let s=this.props.config?this.props.config:this.props.config.set("configInfo",{});const i=[this.getInitOutDataSource()];if(a&&a.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);for(const o in a.jimuMapViews){const r=a.jimuMapViews[o];if(r.dataSourceId)if(r.status===e.JimuMapViewStatus.Loaded){(r.isActive||void 0===r.isActive)&&this.setState({activeDataSource:r.dataSourceId});const a=l.MapViewManager.getInstance().getJimuMapViewById(r.id);yield y(a).finally((()=>I(this,void 0,void 0,(function*(){const a=yield this.checkIfMapViewHasTraces(r);this.dataSourceOptions.push({label:this.getDataSourceLabel(r.dataSourceId),value:r.dataSourceId,isValid:a,dataSource:r});const l=[];if(a){const t=e.DataSourceManager.getInstance(),a=null==t?void 0:t.getDataSource(r.dataSourceId),i=(null==a?void 0:a.isDataSourceSet())&&(null==a?void 0:a.getChildDataSources());null==i||i.forEach((e=>{var t;let a;if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{var t;"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(a={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:r.dataSourceId},l.push(a))}))}else"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(a={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:r.dataSourceId},l.push(a))}));(yield this.getTracesInMapView(r)).length>0&&(s=this.setConfigForSelectedDs(r.dataSourceId,s))}const o={id:this.props.id,useMapWidgetIds:(null==t?void 0:t.length)>0?t:null,config:s,useDataSources:l.length>0?l:[]};this.props.onSettingChange(o,i)}))))}else this._mapLoadedTimer=setTimeout((()=>{this.getAvailableDataSources(t)}),50);else{const e={id:this.props.id,useMapWidgetIds:(null==t?void 0:t.length)>0?t:null,config:s,useDataSources:[]};this.props.onSettingChange(e,i)}}}else this._mapLoadedTimer=setTimeout((()=>{this.getAvailableDataSources(t)}),50)})),this.checkIfMapViewHasTraces=e=>{let t=!1,a=!0;const s=e.view;return s.when().then((()=>{const e=s.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const s=e.utilityNetworks.getItemAt(0);s.load().catch((()=>{a=!1})),a&&s.hasOwnProperty("sharedNamedTraceConfigurations")&&s.sharedNamedTraceConfigurations.length>0&&(t=!0)}return t}))},this.getTracesInMapView=e=>I(this,void 0,void 0,(function*(){const t=e.view;let a=[];return t.when().then((()=>I(this,void 0,void 0,(function*(){const e=t.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const t=e.utilityNetworks.getItemAt(0);return yield t.load(),t.hasOwnProperty("sharedNamedTraceConfigurations")&&(a=t.sharedNamedTraceConfigurations),a}return a}))))})),this.getDataSourceLabel=t=>{if(!t)return"";return e.DataSourceManager.getInstance().getDataSource(t).getLabel()||t},this.setConfigForSelectedDs=(e,t)=>{if(!t.configInfo.hasOwnProperty(e)){const a=d;return a.traceResultAreaSettings.resultAreaProperties.unit=x(),a.traceResultAreaSettings.resultAreaProperties.areaUnit="square-"+x(),t.setIn(["configInfo",e],a)}return t},this.isDataSourceValid=e=>{var t,a,s,i;return 0===this.dataSourceOptions.length?{isValid:!1}:(null===(t=this.dataSourceOptions[0])||void 0===t?void 0:t.value)===e?{isValid:null===(a=this.dataSourceOptions[0])||void 0===a?void 0:a.isValid}:this.dataSourceOptions.length>0&&(null===(s=this.dataSourceOptions[1])||void 0===s?void 0:s.value)===e?{isValid:null===(i=this.dataSourceOptions[1])||void 0===i?void 0:i.isValid}:{isValid:!1}},this.showDsPanel=e=>{this.setState({activeDataSource:e,showTraceItemPanel:!1},(()=>{this.setState({showTraceItemPanel:!0})}))},this.updateResultAreaSettings=(e,t)=>{const a=this.props.config.setIn(["configInfo",this.state.activeDataSource,"traceResultAreaSettings",e],t),s=[this.getInitOutDataSource(a)];this.props.onSettingChange({id:this.props.id,config:a},s)},this.state={activeDataSource:null,isNoMapSelected:0===(null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length),showTraceItemPanel:!1}}componentDidMount(){var t,a;let s;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const i=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];(null===(a=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===a?void 0:a[i])?(s=!1,this.getAvailableDataSources(this.props.useMapWidgetIds)):(this.resetConfig(this.props.useMapWidgetIds),s=!0)}else s=!0;this.updateConfigForMapWidget(s)}render(){var t,i,l,r,n;return(0,e.jsx)("div",{css:(n=this.props.theme,e.css`
    .widget-setting-utility-trace {
      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .warningMsg {
        padding: 0.25rem !important;
        margin-top: -7px;
      }

      .warningMsg .left-part {
        margin-right: 0 !important;
      }

      .color-label {
        color: ${n.ref.palette.neutral[900]};
      }
    }
  `)},(0,e.jsx)("div",{className:"widget-setting-utility-trace"},(0,e.jsx)(s.SettingSection,{className:(0,e.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected&&0===(null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)})},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("selectMapWidget"),title:this.nls("selectMapWidget"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("selectMapWidget"))),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectMapWidgetHint"),title:this.nls("selectMapWidgetHint"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline ep-tooltip"},(0,e.jsx)(h,{size:"m"})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(s.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds}))),(null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i.length)>0&&(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 text-paper"},this.nls("dataConfigLabel")))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("mapSettingsHintMsg")))),(0,e.jsx)(s.SettingRow,null,this.dataSourceOptions.length>0&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(s.MultipleJimuMapConfig,{mapWidgetId:null===(l=this.props.useMapWidgetIds)||void 0===l?void 0:l[0],onClick:this.showDsPanel,disableSwitchMap:!0,isDataSourceValid:this.isDataSourceValid,sidePopperContent:this.state.showTraceItemPanel&&(0,e.jsx)(e.React.Fragment,null,this.state.activeDataSource&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsx)("div",{className:"w-100 h-100",css:o(this.props.theme)},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(M,{intl:this.props.intl,theme:this.props.theme,config:this.props.config.configInfo[this.state.activeDataSource].traceResultAreaSettings,onResultAreaSettingsUpdated:this.updateResultAreaSettings})))))}))),(null===(r=this.props.useMapWidgetIds)||void 0===r?void 0:r.length)>0&&0===this.dataSourceOptions.length&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(a.Alert,{tabIndex:0,className:"warningMsg",onClose:function(){},open:!0,text:this.nls("warningNoMap"),type:"warning"})))))}}function C(e){u.p=e}})(),c})())}}}));