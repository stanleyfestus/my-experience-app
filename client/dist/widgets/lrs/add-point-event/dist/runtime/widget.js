System.register(["jimu-core","jimu-ui","jimu-arcgis","widgets/shared-code/lrs","calcite-components","jimu-core/react","esri/layers/GraphicsLayer"],(function(e,t){var a={},n={},o={},i={},s={},r={},c={};return{setters:[function(e){a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.React=e.React,a.RecordSetChangeType=e.RecordSetChangeType,a.WidgetState=e.WidgetState,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.utils=e.utils},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,n.Label=e.Label,n.Select=e.Select,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.AttributeTable=e.AttributeTable,i.CopyAttributeTool=e.CopyAttributeTool,i.GetUnits=e.GetUnits,i.InlineEditableDropdown=e.InlineEditableDropdown,i.Intellisense=e.Intellisense,i.LockAction=e.LockAction,i.LockManagerComponent=e.LockManagerComponent,i.LrsApplyEdits=e.LrsApplyEdits,i.LrsLayerType=e.LrsLayerType,i.QueryMeasureOnRoute=e.QueryMeasureOnRoute,i.QueryRouteMeasures=e.QueryRouteMeasures,i.RoutePicker=e.RoutePicker,i.RoutePickerPopup=e.RoutePickerPopup,i.SearchMethod=e.SearchMethod,i.convertStationToNumber=e.convertStationToNumber,i.getCalciteBasicTheme=e.getCalciteBasicTheme,i.getDateToUTC=e.getDateToUTC,i.getDateWithTZOffset=e.getDateWithTZOffset,i.getDateWithoutTZOffset=e.getDateWithoutTZOffset,i.getGeometryGraphic=e.getGeometryGraphic,i.getInitialRouteInfoState=e.getInitialRouteInfoState,i.getIntialLocksInfo=e.getIntialLocksInfo,i.getNetworkOutFields=e.getNetworkOutFields,i.getRouteFromEndMeasures=e.getRouteFromEndMeasures,i.getSimpleLineGraphic=e.getSimpleLineGraphic,i.getSimplePointGraphic=e.getSimplePointGraphic,i.getSuggestions=e.getSuggestions,i.isDate=e.isDate,i.isDefined=e.isDefined,i.isInWidgetController=e.isInWidgetController,i.isNumber=e.isNumber,i.queryRouteIdOrName=e.queryRouteIdOrName,i.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,i.validateContingencyConstraints=e.validateContingencyConstraints,i.validateField=e.validateField,i.validateRangeDomain=e.validateRangeDomain},function(e){s.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){r.useImperativeHandle=e.useImperativeHandle},function(e){c.default=e.default}],execute:function(){e((()=>{var e={40643:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M2 4h15a1 1 0 0 1 1 1v6h1V5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h9v-1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1"></path><path fill="#000" d="M5.5 7.5v-2h-1v2H3v1h10.5v2h1v-2H16v-1z"></path><path fill="#000" fill-rule="evenodd" d="M7 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0m-1 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path fill="#000" d="M16 19v-3h-3v-1h3v-3h1v3h3v1h-3v3z"></path></svg>'},99037:e=>{"use strict";e.exports=s},59620:e=>{"use strict";e.exports=c},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=n},47626:e=>{"use strict";e.exports=i}},t={};function l(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>Rn,default:()=>wn});var e,t=l(79244);!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(e||(e={}));const a={_widgetLabel:"Add Point Event",typeLabel:"Type",eventLayerLabel:"Event",networkLabel:"Network",methodLabel:"Method",routeNameRequiredLabel:"Route Name *",routeIdRequiredLabel:"Route Id *",measureWithUnits:"Measure ({units}) *",startDateRequiredLabel:"Start Date *",endDateLabel:"End Date",nextLabel:"Next",singleOperation:"Single Point",multipleOperation:"Multiple Point",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",routeAndMeasure:"Route and Measure",coordinate:"Coordinate",locationOffset:"Location Offset",backLabel:"Back",saveLabel:"Save",selectAllLabel:"Select All",attributeLabel:"Attribute",valueLabel:"Value",resetForm:"Reset",attributeError:"{fieldValue}: {message}",eventCreated:"Event Created",routeNotFound:"Route not found",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",noResult:"No results",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Inches",attributeSetLabel:"Attribute Set",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field"};var n=l(14321),o=l(40643),i=l.n(o),s=l(62686),r=l(47626);function c(){const e=t.hooks.useTranslation(a);return(0,t.jsx)("div",{className:"add-point-event-form-header"},(0,t.jsx)("div",{className:"add-single-point-event-form-header__header pt-3 px-3 align-items-center"},(0,t.jsx)("div",{className:"add-single-point-event_title d-flex align-items-center text-truncate",css:t.css`font-weight: 500; font-size: 14px;`},(0,t.jsx)("div",{className:"text-truncate"},e("_widgetLabel")))))}const d=function(){this.__data__=[],this.size=0};const f=function(e,t){return e===t||e!=e&&t!=t};const p=function(e,t){for(var a=e.length;a--;)if(f(e[a][0],t))return a;return-1};var v=Array.prototype.splice;const h=function(e){var t=this.__data__,a=p(t,e);return!(a<0)&&(a==t.length-1?t.pop():v.call(t,a,1),--this.size,!0)};const m=function(e){var t=this.__data__,a=p(t,e);return a<0?void 0:t[a][1]};const b=function(e){return p(this.__data__,e)>-1};const D=function(e,t){var a=this.__data__,n=p(a,e);return n<0?(++this.size,a.push([e,t])):a[n][1]=t,this};function g(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}g.prototype.clear=d,g.prototype.delete=h,g.prototype.get=m,g.prototype.has=b,g.prototype.set=D;const y=g;const S=function(){this.__data__=new y,this.size=0};const w=function(e){var t=this.__data__,a=t.delete(e);return this.size=t.size,a};const R=function(e){return this.__data__.get(e)};const j=function(e){return this.__data__.has(e)};const I="object"==typeof global&&global&&global.Object===Object&&global;var k="object"==typeof self&&self&&self.Object===Object&&self;const x=I||k||Function("return this")();const N=x.Symbol;var A=Object.prototype,C=A.hasOwnProperty,O=A.toString,_=N?N.toStringTag:void 0;const T=function(e){var t=C.call(e,_),a=e[_];try{e[_]=void 0;var n=!0}catch(e){}var o=O.call(e);return n&&(t?e[_]=a:delete e[_]),o};var L=Object.prototype.toString;const M=function(e){return L.call(e)};var E=N?N.toStringTag:void 0;const F=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":E&&E in Object(e)?T(e):M(e)};const P=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const G=function(e){if(!P(e))return!1;var t=F(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const V=x["__core-js_shared__"];var U,B=(U=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"";const z=function(e){return!!B&&B in e};var W=Function.prototype.toString;const q=function(e){if(null!=e){try{return W.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Q=/^\[object .+?Constructor\]$/,$=Function.prototype,Z=Object.prototype,J=$.toString,H=Z.hasOwnProperty,K=RegExp("^"+J.call(H).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!P(e)||z(e))&&(G(e)?K:Q).test(q(e))};const X=function(e,t){return null==e?void 0:e[t]};const ee=function(e,t){var a=X(e,t);return Y(a)?a:void 0};const te=ee(x,"Map");const ae=ee(Object,"create");const ne=function(){this.__data__=ae?ae(null):{},this.size=0};const oe=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var ie=Object.prototype.hasOwnProperty;const se=function(e){var t=this.__data__;if(ae){var a=t[e];return"__lodash_hash_undefined__"===a?void 0:a}return ie.call(t,e)?t[e]:void 0};var re=Object.prototype.hasOwnProperty;const ce=function(e){var t=this.__data__;return ae?void 0!==t[e]:re.call(t,e)};const le=function(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=ae&&void 0===t?"__lodash_hash_undefined__":t,this};function ue(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}ue.prototype.clear=ne,ue.prototype.delete=oe,ue.prototype.get=se,ue.prototype.has=ce,ue.prototype.set=le;const de=ue;const fe=function(){this.size=0,this.__data__={hash:new de,map:new(te||y),string:new de}};const pe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ve=function(e,t){var a=e.__data__;return pe(t)?a["string"==typeof t?"string":"hash"]:a.map};const he=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t};const me=function(e){return ve(this,e).get(e)};const be=function(e){return ve(this,e).has(e)};const De=function(e,t){var a=ve(this,e),n=a.size;return a.set(e,t),this.size+=a.size==n?0:1,this};function ge(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}ge.prototype.clear=fe,ge.prototype.delete=he,ge.prototype.get=me,ge.prototype.has=be,ge.prototype.set=De;const ye=ge;const Se=function(e,t){var a=this.__data__;if(a instanceof y){var n=a.__data__;if(!te||n.length<199)return n.push([e,t]),this.size=++a.size,this;a=this.__data__=new ye(n)}return a.set(e,t),this.size=a.size,this};function we(e){var t=this.__data__=new y(e);this.size=t.size}we.prototype.clear=S,we.prototype.delete=w,we.prototype.get=R,we.prototype.has=j,we.prototype.set=Se;const Re=we;const je=function(e,t){for(var a=-1,n=null==e?0:e.length;++a<n&&!1!==t(e[a],a,e););return e};const Ie=function(){try{var e=ee(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const ke=function(e,t,a){"__proto__"==t&&Ie?Ie(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a};var xe=Object.prototype.hasOwnProperty;const Ne=function(e,t,a){var n=e[t];xe.call(e,t)&&f(n,a)&&(void 0!==a||t in e)||ke(e,t,a)};const Ae=function(e,t,a,n){var o=!a;a||(a={});for(var i=-1,s=t.length;++i<s;){var r=t[i],c=n?n(a[r],e[r],r,a,e):void 0;void 0===c&&(c=e[r]),o?ke(a,r,c):Ne(a,r,c)}return a};const Ce=function(e,t){for(var a=-1,n=Array(e);++a<e;)n[a]=t(a);return n};const Oe=function(e){return null!=e&&"object"==typeof e};const _e=function(e){return Oe(e)&&"[object Arguments]"==F(e)};var Te=Object.prototype,Le=Te.hasOwnProperty,Me=Te.propertyIsEnumerable,Ee=_e(function(){return arguments}())?_e:function(e){return Oe(e)&&Le.call(e,"callee")&&!Me.call(e,"callee")};const Fe=Ee;const Pe=Array.isArray;const Ge=function(){return!1};var Ve="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ue=Ve&&"object"==typeof module&&module&&!module.nodeType&&module,Be=Ue&&Ue.exports===Ve?x.Buffer:void 0;const ze=(Be?Be.isBuffer:void 0)||Ge;var We=/^(?:0|[1-9]\d*)$/;const qe=function(e,t){var a=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==a||"symbol"!=a&&We.test(e))&&e>-1&&e%1==0&&e<t};const Qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var $e={};$e["[object Float32Array]"]=$e["[object Float64Array]"]=$e["[object Int8Array]"]=$e["[object Int16Array]"]=$e["[object Int32Array]"]=$e["[object Uint8Array]"]=$e["[object Uint8ClampedArray]"]=$e["[object Uint16Array]"]=$e["[object Uint32Array]"]=!0,$e["[object Arguments]"]=$e["[object Array]"]=$e["[object ArrayBuffer]"]=$e["[object Boolean]"]=$e["[object DataView]"]=$e["[object Date]"]=$e["[object Error]"]=$e["[object Function]"]=$e["[object Map]"]=$e["[object Number]"]=$e["[object Object]"]=$e["[object RegExp]"]=$e["[object Set]"]=$e["[object String]"]=$e["[object WeakMap]"]=!1;const Ze=function(e){return Oe(e)&&Qe(e.length)&&!!$e[F(e)]};const Je=function(e){return function(t){return e(t)}};var He="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ke=He&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Ke&&Ke.exports===He&&I.process;const Xe=function(){try{var e=Ke&&Ke.require&&Ke.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var et=Xe&&Xe.isTypedArray;const tt=et?Je(et):Ze;var at=Object.prototype.hasOwnProperty;const nt=function(e,t){var a=Pe(e),n=!a&&Fe(e),o=!a&&!n&&ze(e),i=!a&&!n&&!o&&tt(e),s=a||n||o||i,r=s?Ce(e.length,String):[],c=r.length;for(var l in e)!t&&!at.call(e,l)||s&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||qe(l,c))||r.push(l);return r};var ot=Object.prototype;const it=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ot)};const st=function(e,t){return function(a){return e(t(a))}};const rt=st(Object.keys,Object);var ct=Object.prototype.hasOwnProperty;const lt=function(e){if(!it(e))return rt(e);var t=[];for(var a in Object(e))ct.call(e,a)&&"constructor"!=a&&t.push(a);return t};const ut=function(e){return null!=e&&Qe(e.length)&&!G(e)};const dt=function(e){return ut(e)?nt(e):lt(e)};const ft=function(e,t){return e&&Ae(t,dt(t),e)};const pt=function(e){var t=[];if(null!=e)for(var a in Object(e))t.push(a);return t};var vt=Object.prototype.hasOwnProperty;const ht=function(e){if(!P(e))return pt(e);var t=it(e),a=[];for(var n in e)("constructor"!=n||!t&&vt.call(e,n))&&a.push(n);return a};const mt=function(e){return ut(e)?nt(e,!0):ht(e)};const bt=function(e,t){return e&&Ae(t,mt(t),e)};var Dt="object"==typeof exports&&exports&&!exports.nodeType&&exports,gt=Dt&&"object"==typeof module&&module&&!module.nodeType&&module,yt=gt&&gt.exports===Dt?x.Buffer:void 0,St=yt?yt.allocUnsafe:void 0;const wt=function(e,t){if(t)return e.slice();var a=e.length,n=St?St(a):new e.constructor(a);return e.copy(n),n};const Rt=function(e,t){var a=-1,n=e.length;for(t||(t=Array(n));++a<n;)t[a]=e[a];return t};const jt=function(e,t){for(var a=-1,n=null==e?0:e.length,o=0,i=[];++a<n;){var s=e[a];t(s,a,e)&&(i[o++]=s)}return i};const It=function(){return[]};var kt=Object.prototype.propertyIsEnumerable,xt=Object.getOwnPropertySymbols;const Nt=xt?function(e){return null==e?[]:(e=Object(e),jt(xt(e),(function(t){return kt.call(e,t)})))}:It;const At=function(e,t){return Ae(e,Nt(e),t)};const Ct=function(e,t){for(var a=-1,n=t.length,o=e.length;++a<n;)e[o+a]=t[a];return e};const Ot=st(Object.getPrototypeOf,Object);const _t=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ct(t,Nt(e)),e=Ot(e);return t}:It;const Tt=function(e,t){return Ae(e,_t(e),t)};const Lt=function(e,t,a){var n=t(e);return Pe(e)?n:Ct(n,a(e))};const Mt=function(e){return Lt(e,dt,Nt)};const Et=function(e){return Lt(e,mt,_t)};const Ft=ee(x,"DataView");const Pt=ee(x,"Promise");const Gt=ee(x,"Set");const Vt=ee(x,"WeakMap");var Ut="[object Map]",Bt="[object Promise]",zt="[object Set]",Wt="[object WeakMap]",qt="[object DataView]",Qt=q(Ft),$t=q(te),Zt=q(Pt),Jt=q(Gt),Ht=q(Vt),Kt=F;(Ft&&Kt(new Ft(new ArrayBuffer(1)))!=qt||te&&Kt(new te)!=Ut||Pt&&Kt(Pt.resolve())!=Bt||Gt&&Kt(new Gt)!=zt||Vt&&Kt(new Vt)!=Wt)&&(Kt=function(e){var t=F(e),a="[object Object]"==t?e.constructor:void 0,n=a?q(a):"";if(n)switch(n){case Qt:return qt;case $t:return Ut;case Zt:return Bt;case Jt:return zt;case Ht:return Wt}return t});const Yt=Kt;var Xt=Object.prototype.hasOwnProperty;const ea=function(e){var t=e.length,a=new e.constructor(t);return t&&"string"==typeof e[0]&&Xt.call(e,"index")&&(a.index=e.index,a.input=e.input),a};const ta=x.Uint8Array;const aa=function(e){var t=new e.constructor(e.byteLength);return new ta(t).set(new ta(e)),t};const na=function(e,t){var a=t?aa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)};var oa=/\w*$/;const ia=function(e){var t=new e.constructor(e.source,oa.exec(e));return t.lastIndex=e.lastIndex,t};var sa=N?N.prototype:void 0,ra=sa?sa.valueOf:void 0;const ca=function(e){return ra?Object(ra.call(e)):{}};const la=function(e,t){var a=t?aa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)};const ua=function(e,t,a){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return aa(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return na(e,a);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return la(e,a);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return ia(e);case"[object Symbol]":return ca(e)}};var da=Object.create;const fa=function(){function e(){}return function(t){if(!P(t))return{};if(da)return da(t);e.prototype=t;var a=new e;return e.prototype=void 0,a}}();const pa=function(e){return"function"!=typeof e.constructor||it(e)?{}:fa(Ot(e))};const va=function(e){return Oe(e)&&"[object Map]"==Yt(e)};var ha=Xe&&Xe.isMap;const ma=ha?Je(ha):va;const ba=function(e){return Oe(e)&&"[object Set]"==Yt(e)};var Da=Xe&&Xe.isSet;const ga=Da?Je(Da):ba;var ya="[object Arguments]",Sa="[object Function]",wa="[object Object]",Ra={};Ra[ya]=Ra["[object Array]"]=Ra["[object ArrayBuffer]"]=Ra["[object DataView]"]=Ra["[object Boolean]"]=Ra["[object Date]"]=Ra["[object Float32Array]"]=Ra["[object Float64Array]"]=Ra["[object Int8Array]"]=Ra["[object Int16Array]"]=Ra["[object Int32Array]"]=Ra["[object Map]"]=Ra["[object Number]"]=Ra[wa]=Ra["[object RegExp]"]=Ra["[object Set]"]=Ra["[object String]"]=Ra["[object Symbol]"]=Ra["[object Uint8Array]"]=Ra["[object Uint8ClampedArray]"]=Ra["[object Uint16Array]"]=Ra["[object Uint32Array]"]=!0,Ra["[object Error]"]=Ra[Sa]=Ra["[object WeakMap]"]=!1;const ja=function e(t,a,n,o,i,s){var r,c=1&a,l=2&a,u=4&a;if(n&&(r=i?n(t,o,i,s):n(t)),void 0!==r)return r;if(!P(t))return t;var d=Pe(t);if(d){if(r=ea(t),!c)return Rt(t,r)}else{var f=Yt(t),p=f==Sa||"[object GeneratorFunction]"==f;if(ze(t))return wt(t,c);if(f==wa||f==ya||p&&!i){if(r=l||p?{}:pa(t),!c)return l?Tt(t,bt(r,t)):At(t,ft(r,t))}else{if(!Ra[f])return i?t:{};r=ua(t,f,c)}}s||(s=new Re);var v=s.get(t);if(v)return v;s.set(t,r),ga(t)?t.forEach((function(o){r.add(e(o,a,n,o,t,s))})):ma(t)&&t.forEach((function(o,i){r.set(i,e(o,a,n,i,t,s))}));var h=d?void 0:(u?l?Et:Mt:l?mt:dt)(t);return je(h||t,(function(o,i){h&&(o=t[i=o]),Ne(r,i,e(o,a,n,i,t,s))})),r};const Ia=function(e){return ja(e,5)};var ka=function(e,t,a,n){return new(a||(a=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};const xa=()=>t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-point-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-point-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-point-event-edit-attributes__action {
      height: auto;
    }
    .add-point-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `;let Na=[];function Aa(e){var o;const i=t.hooks.useTranslation(a),{intl:s,widgetId:c,networkDS:l,network:u,eventDS:d,eventLayer:f,routeInfo:p,reset:v,jimuMapView:h,hoverGraphic:m,conflictPreventionEnabled:b,onNavBack:D}=e,[g,y]=t.React.useState(),[S,w]=t.React.useState(!1),[R,j]=t.React.useState(),[I,k]=t.React.useState(""),[x,N]=t.React.useState(!1),[A,C]=t.React.useState(!1),[O,_]=t.React.useState();t.React.useEffect((()=>{v&&y(T())}),[v]),t.React.useEffect((()=>{y(T())}),[d,f]),t.React.useEffect((()=>{if(b){const e=Object.assign({},O);(0,r.isDefined)(u)&&(e.networkId=[u.networkInfo.lrsNetworkId]),(0,r.isDefined)(f)&&(e.eventServiceLayerIds=[f.serviceId]),(0,r.isDefined)(p)&&(e.routeInfo=p),_(e)}}),[l,u,f,p]);const T=()=>{const e=[];if((0,r.isDefined)(f)&&(0,r.isDefined)(d)&&(0,r.isDefined)(f.eventInfo)&&(0,r.isDefined)(f.eventInfo.attributeFields)){const t=d,a=(null==t?void 0:t.layer).fields;f.eventInfo.attributeFields.forEach((t=>{if(t.enabled){const n=a.find((e=>e.name===t.field.name));if(n){let a;a=(0,r.isDate)(n.type)?(0,r.isDefined)(n.defaultValue)?new Date(n.defaultValue):null:n.defaultValue;const o={index:e.length,name:n.name,alias:n.alias,type:n.type,hasDomain:(0,r.isDefined)(n.domain),value:a,error:"",nullable:n.nullable,default:"number"==typeof a?Number(a).toString():a,length:n.length,editable:t.editable};e.push(o)}}}))}return e},L=e=>e.findIndex((e=>e.error.length>0))>-1,M=(e,t)=>{const a=Ia(e);y(a),N(L(a))},E=e=>{D(e)},F=e=>ka(this,void 0,void 0,(function*(){const a=d,n=a.getPopupInfo(),o=a.getLayerDefinition(),i=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==n?void 0:n.fieldInfos)||[]).filter((e=>e.visible)));let s=null;yield(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{[s]=e})).then((()=>{const t=new s({geometry:e.edits[0].adds[0].geometry,attributes:e.edits[0].adds[0].attributes}),n=a.buildRecord(t);a.afterAddRecord(n)})),a.updateQueryParams({returnGeometry:!0},c);const r=new t.DataRecordSetChangeMessage(c,t.RecordSetChangeType.CreateUpdate,[{records:a.getRecords(),fields:i.map((e=>e.fieldName)),dataSource:a,name:a.id}]);t.MessageManager.getInstance().publishMessage(r)})),P=e=>ka(this,void 0,void 0,(function*(){const a={edits:[]};if((()=>{const e=Ia(g);let t=!1;return e.forEach(((a,n)=>{let o;if(o=a.hasDomain?(0,r.validateRangeDomain)(a.value,a.name,d):((0,r.isDate)(a.type),(0,r.validateField)(a.value,a.name,d)),(0,r.isDefined)(Na)){let t=[];const i=(0,r.validateContingencyConstraints)(a.value,"",n,e,Na);(null==i?void 0:i.length)>0&&(i.forEach((e=>{var a;const n=null===(a=null==e?void 0:e.fieldGroup)||void 0===a?void 0:a.fields;t.push(n)})),t=t.flat(),t.includes(a.name)&&(C(!0),o={hasError:!0,message:"contingentValueError"}))}if(o.hasError){let e;if("contingentValueError"===o.message){const t=[];Na.forEach((e=>{t.push(e.name)}));let a=i("invalidContingentValues");a=a.replace("{groupNames}",t.join(",")),e=a}else{const t=f.useFieldAlias?a.alias:a.name;e=i("attributeError",{fieldValue:t,message:i(o.message)})}j("error"),k(e),w(!0),setTimeout((()=>{w(!1)}),5e3),t=!0,a.error=i(o.message)}})),t&&M(e),t})())return;let n=d.getGDBVersion();if(n||(n=""),(0,r.isDefined)(f)){const e={},n=f.eventInfo.eventIdFieldName;e[n]="{"+t.utils.getUUID()+"}";const o=f.eventInfo.routeIdFieldName;e[o]=p.routeId;const i=f.eventInfo.fromMeasureFieldName;e[i]=p.selectedMeasure;const s=f.eventInfo.fromDateFieldName;if((0,r.isDefined)(p.selectedFromDate)){const t=(0,r.getDateWithoutTZOffset)(p.selectedFromDate.valueOf(),l);e[s]=(0,r.getDateToUTC)(t)}else e[s]=p.selectedFromDate;const c=f.eventInfo.toDateFieldName;if((0,r.isDefined)(p.selectedToDate)){const t=(0,r.getDateWithoutTZOffset)(p.selectedToDate.valueOf(),l);e[c]=(0,r.getDateToUTC)(t)}else e[c]=p.selectedToDate;if(f.eventInfo.routeNameFieldName&&f.eventInfo.routeNameFieldName.length>0){const t=f.eventInfo.routeNameFieldName;e[t]=p.routeName}g.forEach((t=>{const a=t.name;if((0,r.isDefined)(t.value)&&(0,r.isDate)(t.type)){const n=(0,r.getDateWithoutTZOffset)(t.value.valueOf(),l);e[a]=(0,r.getDateToUTC)(n)}else(0,r.isNumber)(t.type)?!(0,r.isDefined)(t.value)||""===t.value||isNaN(Number(t.value))?e[a]=null:e[a]=Number(t.value):e[a]=t.value})),(0,r.isDefined)(p.selectedPoint.spatialReference.wkid)||(p.selectedPoint.spatialReference.wkid=h.view.spatialReference.wkid);const u=[],d={attributes:e,geometry:p.selectedPoint};u.push(d);const v={id:f.serviceId,adds:u,allowMerge:!1,retireMeasureOverlap:!1,retireByEventId:!1};a.edits.push(v)}yield(0,r.LrsApplyEdits)(f.lrsUrl,a,n).then((t=>ka(this,void 0,void 0,(function*(){t.success?(j("success"),k(i("eventCreated")),w(!0),F(a),setTimeout((()=>ka(this,void 0,void 0,(function*(){if(w(!1),b&&(0,r.isDefined)(e)){yield(0,r.tryReleaseLockOnDefault)(l,e);const t=Object.assign(Object.assign({},O),{lockAction:r.LockAction.Clear});_(t)}else E(!0)}))),5e3)):(j("error"),k(`${t.message} \n ${t.details}`),w(!0),setTimeout((()=>{w(!1)}),5e3))}))))}));return(0,t.jsx)("div",{className:"h-100",css:xa()},(0,t.jsx)("div",{className:"add-point-event-edit-attributes__content"},b&&(0,t.jsx)(r.LockManagerComponent,{intl:s,featureDS:l,lockInfo:O,showAlert:!0,networkName:null===(o=null==u?void 0:u.networkInfo)||void 0===o?void 0:o.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,a)=>{_(e),a&&P(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},O),{lockAction:r.LockAction.None});_(e),E(!0)}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:l,eventDataSources:[d],jimuMapView:h,hoverGraphic:m,onAttributesCopied:e=>{const t=Ia(g);e.forEach((e=>{e.layerId===f.serviceId.toString()&&e.fieldValuePair.forEach((e=>{const a=t.findIndex((t=>t.name===e.name));if(a>-1){let n=e.value;(0,r.isDate)(t[a].type)&&(n=(0,r.isDefined)(e.value)?new Date(e.value):null),t[a].value=n}}))})),y(t)}}))),(0,t.jsx)("div",{className:"h-100"},A&&(0,t.jsx)(n.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){C(!1)},open:A,text:I,type:"warning",closable:!0,withIcon:!0}),(0,t.jsx)(r.AttributeTable,{tableIndex:0,eventDS:d,eventLayer:f,fieldInfos:g,collapable:!1,useAlias:!(0,r.isDefined)(f)||f.useFieldAlias,onUpdateItem:(e,t,a,n)=>{const o=Ia(g);o[a].value=e,o[a].error=t,y(o),N(L(o))},onUpdateAll:M,isReset:v,onFieldGrpUpdated:(e,t)=>{Na=e,Na&&0!==(null==Na?void 0:Na.length)||C(!1)}})),S&&(0,t.jsx)("div",{className:"add-point-event-edit-attributes__toast-container px-3 w-100"},(0,t.jsx)(n.Alert,{className:"add-point-event-edit-attributes__toast w-100",type:R,text:I,closable:!0,withIcon:!0,open:S,onClose:()=>{w(!1)}}))),(0,t.jsx)("div",{className:"add-point-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-point-event-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(n.Button,{"aria-label":i("backLabel"),size:"sm",type:"secondary",onClick:()=>{E(!1)}},i("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(n.Button,{className:"active","aria-label":i("saveLabel"),size:"sm",disabled:x||A,onClick:()=>{if(b){const e=Object.assign(Object.assign({},O),{lockAction:r.LockAction.QueryAndAcquire});_(e)}else P()}},i("saveLabel"))))))}function Ca(e){const{network:a,event:n,dataSourcesReady:o,onCreateNetworkDs:i,onCreateEventDs:s}=e,[r,c]=t.React.useState(null!=a?a:null),[l,u]=t.React.useState(null!=n?n:null),[d,f]=t.React.useState(!1),[p,v]=t.React.useState(!1);t.React.useEffect((()=>{a&&c(a)}),[a]),t.React.useEffect((()=>{n&&u(n)}),[n]),t.React.useEffect((()=>{o(d&&p)}),[o,p,d]);const h=t.React.useCallback((e=>{i(e)}),[i]),m=t.React.useCallback((e=>{s(e)}),[s]),b=t.React.useCallback((e=>{if(e){const{status:a,instanceStatus:n}=e;n===t.DataSourceStatus.NotCreated||n===t.DataSourceStatus.CreateError||a===t.DataSourceStatus.LoadError||a===t.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),D=t.React.useCallback((e=>{if(e){const{status:a,instanceStatus:n}=e;n===t.DataSourceStatus.NotCreated||n===t.DataSourceStatus.CreateError||a===t.DataSourceStatus.LoadError||a===t.DataSourceStatus.NotReady?v(!1):v(!0)}}),[v]),g=t.React.useCallback((()=>{f(!1)}),[f]),y=t.React.useCallback((()=>{v(!1)}),[v]);return(0,t.jsx)("div",null,r&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:r.useDataSource,onDataSourceInfoChange:()=>b,onCreateDataSourceFailed:g,onDataSourceCreated:h}),l&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:l.useDataSource,onDataSourceInfoChange:D,onCreateDataSourceFailed:y,onDataSourceCreated:m}))}const Oa=function(){return x.Date.now()};var _a=/\s/;const Ta=function(e){for(var t=e.length;t--&&_a.test(e.charAt(t)););return t};var La=/^\s+/;const Ma=function(e){return e?e.slice(0,Ta(e)+1).replace(La,""):e};const Ea=function(e){return"symbol"==typeof e||Oe(e)&&"[object Symbol]"==F(e)};var Fa=/^[-+]0x[0-9a-f]+$/i,Pa=/^0b[01]+$/i,Ga=/^0o[0-7]+$/i,Va=parseInt;const Ua=function(e){if("number"==typeof e)return e;if(Ea(e))return NaN;if(P(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=P(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ma(e);var a=Pa.test(e);return a||Ga.test(e)?Va(e.slice(2),a?2:8):Fa.test(e)?NaN:+e};var Ba=Math.max,za=Math.min;const Wa=function(e,t,a){var n,o,i,s,r,c,l=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var a=n,i=o;return n=o=void 0,l=t,s=e.apply(i,a)}function v(e){var a=e-c;return void 0===c||a>=t||a<0||d&&e-l>=i}function h(){var e=Oa();if(v(e))return m(e);r=setTimeout(h,function(e){var a=t-(e-c);return d?za(a,i-(e-l)):a}(e))}function m(e){return r=void 0,f&&n?p(e):(n=o=void 0,s)}function b(){var e=Oa(),a=v(e);if(n=arguments,o=this,c=e,a){if(void 0===r)return function(e){return l=e,r=setTimeout(h,t),u?p(e):s}(c);if(d)return clearTimeout(r),r=setTimeout(h,t),p(c)}return void 0===r&&(r=setTimeout(h,t)),s}return t=Ua(t)||0,P(a)&&(u=!!a.leading,i=(d="maxWait"in a)?Ba(Ua(a.maxWait)||0,t):i,f="trailing"in a?!!a.trailing:f),b.cancel=function(){void 0!==r&&clearTimeout(r),l=0,n=c=o=r=void 0},b.flush=function(){return void 0===r?s:m(Oa())},b};var qa=1/0;const Qa=function(e){return e?(e=Ua(e))===qa||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const $a=function(e){var t=Qa(e),a=t%1;return t==t?a?t-a:t:0};const Za=function(e,t){for(var a=-1,n=null==e?0:e.length,o=Array(n);++a<n;)o[a]=t(e[a],a,e);return o};var Ja=N?N.prototype:void 0,Ha=Ja?Ja.toString:void 0;const Ka=function e(t){if("string"==typeof t)return t;if(Pe(t))return Za(t,e)+"";if(Ea(t))return Ha?Ha.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a};const Ya=function(e){return null==e?"":Ka(e)};var Xa=x.isFinite,en=Math.min;const tn=function(e){var t=Math[e];return function(e,a){if(e=Ua(e),(a=null==a?0:en($a(a),292))&&Xa(e)){var n=(Ya(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+a));return+((n=(Ya(o)+"e").split("e"))[0]+"e"+(+n[1]-a))}return t(e)}}("round");var an=function(e,t,a,n){return new(a||(a=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};function nn(e){const o=t.hooks.useTranslation(a),{intl:i,widgetId:s,isReady:c,network:l,networkDS:u,routeInfo:d,jimuMapView:f,hoverGraphic:p,reset:v,routeInfoFromDataAction:h,revalidateRouteFromDataAction:m,onResetDataAction:b,clearPickedGraphic:D,onRouteInfoUpdated:g}=e,[y,S]=t.React.useState(!1),[w,R]=t.React.useState(!1),[j,I]=t.React.useState(""),[k,x]=t.React.useState(!1),[N,A]=t.React.useState([]),[C,O]=t.React.useState(),_=t.React.useRef(null),T=t.React.useRef((e=>{})),L=t.React.useRef(null),M=t.React.useRef(null),E=t.React.useRef(null),F=t.React.useRef(null),P=t.React.useRef(null),G=t.React.useRef(!1),V=t.React.useRef(!1),[U,B]=t.React.useState(null),[z,W]=t.React.useState(!1),[q,Q]=t.React.useState([]);t.React.useEffect((()=>{T.current=Wa($,400)}),[]),t.React.useEffect((()=>{v&&X()}),[v]);const $=t.hooks.useEventCallback((e=>{const t=l.useRouteName?l.routeNameFieldSchema.jimuName:l.routeIdFieldSchema.jimuName,a=(0,r.getSuggestions)(t,e,u);Promise.all([a]).then((e=>{const t=null==e?void 0:e[0];t&&Q(t),L.current&&W(!0)})).catch((e=>{}))})),Z=e=>{B(e),L.current=e},J=()=>{var e;null===(e=M.current)||void 0===e||e.focus(),H(!0,!1)},H=(e=!1,t=!0)=>{e||(V.current=!1)};t.React.useEffect((()=>{m&&(Z(l.useRouteName?h.routeName:h.routeId),isNaN(h.selectedMeasure)||I(h.selectedMeasure.toString()),g(h),X(),b())}),[m]),t.React.useEffect((()=>{(0,r.isDefined)(l)&&(B(""),I(""),S(!1),R(!1),D())}),[l]),t.React.useEffect((()=>{(0,r.isDefined)(f)&&O(null==f?void 0:f.view.popupEnabled)}),[f]),t.React.useEffect((()=>{(0,r.isDefined)(l)&&l.useRouteName?B(d.routeName):B(d.routeId),isNaN(d.selectedMeasure)?I(""):I(d.selectedMeasure.toString())}),[l,d]),t.React.useEffect((()=>{isNaN(d.selectedMeasure)?I(""):I(d.selectedMeasure.toString())}),[l,d.selectedMeasure]);const K=(e,t)=>an(this,void 0,void 0,(function*(){const t=(0,r.getNetworkOutFields)(l),a=l.useRouteName?e.attributes[t.routeNameFieldName]:"",n=e.attributes[t.routeIdFieldName],o=e.attributes[t.fromDateFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,c=(0,r.getRouteFromEndMeasures)(s),f=e.attributes[t.lineIdFieldName],p=e.attributes[t.lineNameFieldName];let v=new Date(Date.now());(0,r.isDefined)(i)&&v>i?v=(0,r.getDateWithTZOffset)(o,u):v.setHours(0,0,0,0);let h=new Date(Date.now());return(0,r.isDefined)(i)&&h>i?h=(0,r.getDateWithTZOffset)(i,u):h.setHours(0,0,0,0),(0,r.isDefined)(i)||(h=null),yield(0,r.QueryRouteMeasures)(u,l,c,o,n).then((e=>an(this,void 0,void 0,(function*(){const t=Math.min(...e),c=Math.max(...e);return Object.assign(Object.assign({},d),{routeName:a,routeId:n,fromDate:(0,r.isDefined)(o)?(0,r.getDateWithTZOffset)(o,u):null,toDate:(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,u):null,selectedPolyline:s,fromMeasure:tn(t,l.measurePrecision),toMeasure:tn(c,l.measurePrecision),validRoute:!0,selectedFromDate:v,selectedToDate:h,lineName:p,lineId:f})}))))})),Y=(e,t)=>(0,r.QueryMeasureOnRoute)(u,l,e.routeId,e.fromDate,j).then((a=>{if(a){return Object.assign(Object.assign({},e),{selectedPoint:a,selectedMeasure:parseFloat(t?e.selectedMeasure.toString():j)})}return Object.assign(Object.assign({},e),{selectedPoint:null})})),X=()=>{setTimeout((()=>{M.current.select(),M.current.focus(),M.current.blur(),E.current.select(),E.current.focus(),E.current.blur()}),200)},ee=t.React.useCallback(((e,t=!1)=>{g(e,t),P.current=null,X()}),[g]),te=e=>{I(e)},ae=t.React.useCallback((e=>{e.length&&(x(!0),A(e))}),[]),ne=t.React.useCallback((e=>{(0,r.isDefined)(e)&&(g(e,!0),X()),x(!1)}),[g]),oe=t.React.useCallback((()=>{x(!1)}),[]);return(0,t.jsx)("div",{className:"route-and-measure-form d-flex w-100 px-3"},l&&(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)(n.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},l.useRouteName?o("routeNameRequiredLabel"):o("routeIdRequiredLabel")),(0,t.jsx)("div",{ref:_,className:"d-flex w-100"},(0,t.jsx)(n.TextInput,{"aria-label":l.useRouteName?o("routeNameRequiredLabel"):o("routeIdRequiredLabel"),type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!c,onBlur:()=>{F.current=setTimeout((()=>{G.current||W(!1),V.current||H(!1)}),200)},value:U||"",ref:M,onChange:e=>{var t;P.current=null;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==a?void 0:a.length)>2;if(Z(a),!n)return W(!1),!1;T.current(a)},checkValidityOnAccept:(e,t=!1)=>new Promise((a=>{setTimeout((()=>{P.current&&(e=P.current);const n=[],i=(0,r.queryRouteIdOrName)(e.trim(),l,u).then((a=>an(this,void 0,void 0,(function*(){if((0,r.isDefined)(a)){if(!t&&(v||e===d.routeId||e===d.routeName))return{valid:!0};if(yield Promise.all(a.features.map((t=>an(this,void 0,void 0,(function*(){const a=K(t,e);n.push(yield a)}))))),n.length>1&&!t)ae(n);else{if(j.length>0||t&&!isNaN(d.selectedMeasure))return Y(n[0],t).then((e=>(g(e,!0),{valid:!0})));g(n[0],!0)}return{valid:!0}}})))).catch((t=>{if(l.useRouteName){const t=Object.assign(Object.assign({},d),{routeName:e,validRoute:!1});g(t)}else{const t=Object.assign(Object.assign({},d),{routeId:e,validRoute:!1});g(t)}return e.length?{valid:!1,msg:o("routeNotFound")}:{valid:!0}}));a(i)}),200)}))}),U&&(0,t.jsx)(r.Intellisense,{isOpen:(z||(G.current=!1),z),reference:_,searchText:U,searchSuggestion:q,onRecordItemClick:(e,t)=>{if(t)return J(),!1;P.current=e,Z(e)},id:s,searchInputRef:M}),(0,t.jsx)(r.RoutePicker,{type:"route-measure",active:y,networkDs:u,network:l,routeInfo:d,disabled:!c,jimuMapView:f,symbolColor:null,hoverGraphic:p,isFrom:!0,onActiveChange:()=>{const e=!y;S(e),e?(R(!1),f.view.popupEnabled=!1):setTimeout((()=>{f.view.popupEnabled=C&&!w}),800)},onRouteInfoUpdated:ee,onMultiRouteSelect:ae})),(0,t.jsx)(n.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},o("measureWithUnits",{units:(0,r.GetUnits)(l.unitsOfMeasure,i)})),(0,t.jsx)("div",{className:"d-flex w-100"},(0,t.jsx)(n.TextInput,{ref:E,"aria-label":o("measureWithUnits",{units:(0,r.GetUnits)(l.unitsOfMeasure,i)}),className:"w-100",size:"sm",value:j,disabled:!c,onChange:e=>{te(e.target.value)},checkValidityOnAccept:e=>an(this,void 0,void 0,(function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),te(""),{valid:!0}}if(t=isNaN(Number(e))?(0,r.convertStationToNumber)(e):Number(e),isNaN(t)){D();const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),te(""),{valid:!0}}if((0,r.isDefined)(d.selectedPolyline)){t=tn(t,l.measurePrecision);let e=Object.assign(Object.assign({},d),{selectedMeasure:t});if(t<d.fromMeasure)return g(e),{valid:!1,msg:o("measureLessError")};if(t>d.toMeasure)return g(e),{valid:!1,msg:o("measureGreaterError")};if((0,r.isDefined)(d.selectedPoint)&&!isNaN(d.selectedMeasure)&&t===d.selectedMeasure)return{valid:!0};e.routeId.length?yield(0,r.QueryMeasureOnRoute)(u,l,e.routeId,e.fromDate,t.toString()).then((t=>{(0,r.isDefined)(t)&&(e=Object.assign(Object.assign({},e),{selectedPoint:t}),g(e))})):g(e)}return{valid:!0}}))}),(0,t.jsx)(r.RoutePicker,{type:"measure",active:w,networkDs:u,network:l,routeInfo:d,disabled:!c,jimuMapView:f,symbolColor:null,hoverGraphic:p,isFrom:!0,onActiveChange:()=>{const e=!w;R(e),e?S(!1):setTimeout((()=>{f.view.popupEnabled=C&&!y}),800)},onRouteInfoUpdated:ee,onMultiRouteSelect:ae})),(0,t.jsx)(r.RoutePickerPopup,{isOpen:k,routeInfos:N,useRouteName:l.useRouteName,onRouteSelect:ne,onRouteSelectCancel:oe,measurePrecision:l.measurePrecision,isFrom:!0,jimuMapView:f,graphicLayer:p})))}var on=l(99037);function sn(e){const o=t.hooks.useTranslation(a),{routeInfo:i,reset:s,hideDates:c,useRouteStartEndDate:l,onUpdateRouteInfo:u}=e,[d,f]=t.React.useState(!1),[p,v]=t.React.useState(!1),[h,m]=t.React.useState("idle"),[b,D]=t.React.useState("idle"),[g,y]=t.React.useState(""),[S,w]=t.React.useState("");t.React.useEffect((()=>{s&&(f(!1),v(!1),m("idle"),D("idle"),y(""),w(""))}),[s]),t.React.useEffect((()=>{f(l),v(l)}),[c]),t.React.useEffect((()=>{let e=!1;const t=Object.assign({},i);"idle"===h&&y(""),"idle"===b&&w(""),(0,r.isDefined)(i.selectedFromDate)&&d&&i.selectedFromDate!==i.fromDate&&(t.selectedFromDate=i.fromDate,e=!0),p&&i.selectedToDate!==i.toDate&&(t.selectedToDate=i.toDate,e=!0),e&&u(t)}),[u,i,d,p]);const R=(e,t)=>{const a=e;if(!(0,r.isDefined)(a))return t?m("idle"):D("idle"),t?y(""):w(""),!0;let n=!0;return(0,r.isDefined)(i.fromDate)&&a<i.fromDate?(t?m("invalid"):D("invalid"),t?y(o("invalidFromDateBefore")):w(o("invalidToDateBefore")),n=!1,!1):(0,r.isDefined)(i.toDate)&&a>i.toDate?(t?m("invalid"):D("invalid"),t?y(o("invalidFromDateAfter")):w(o("invalidToDateAfter")),n=!1,!1):((0,r.isDefined)(i.selectedToDate)&&t&&(a>i.selectedToDate&&(m("invalid"),t?y(o("invalidDatesOrder")):w(o("invalidDatesOrder")),n=!1),S===o("invalidDatesOrder")?a<i.selectedToDate&&(D("idle"),w("")):S===o("invalidDatesSameDay")&&a!==i.selectedFromDate&&(D("idle"),w(""))),(0,r.isDefined)(i.selectedToDate)&&t&&a.getTime()===i.selectedToDate.getTime()&&(m("invalid"),t?y(o("invalidDatesSameDay")):w(o("invalidDatesSameDay")),n=!1),(0,r.isDefined)(i.selectedFromDate)&&(t||(a<i.selectedFromDate&&(D("invalid"),t?y(o("invalidDatesOrder")):w(o("invalidDatesOrder")),n=!1),g===o("invalidDatesOrder")?a>i.selectedFromDate&&(m("idle"),y("")):g===o("invalidDatesSameDay")&&a!==i.selectedFromDate&&(m("idle"),y("")))),(0,r.isDefined)(i.selectedFromDate)&&(t||a.getTime()!==i.selectedFromDate.getTime()||(D("invalid"),t?y(o("invalidDatesSameDay")):w(o("invalidDatesSameDay")),n=!1)),n&&(t?m("idle"):D("idle"),t?y(""):w("")),!0)};return(0,t.jsx)("div",{className:"add-point-event-date-form px-3 w-100",css:(0,r.getCalciteBasicTheme)()},!c&&(0,t.jsx)("div",null,(0,t.jsx)(n.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-3",style:{width:100,textOverflow:"ellipsis",fontWeight:500}},o("startDateRequiredLabel")),(0,t.jsx)(n.Tooltip,{title:g},(0,t.jsx)(on.CalciteInputDatePicker,{scale:"s",disabled:!!d||void 0,valueAsDate:i.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;R(a,!0);const n=Object.assign(Object.assign({},i),{selectedFromDate:a});u(n)}},status:h,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(n.Label,{size:"sm",className:"text-truncate w-100 pt-2",centric:!0,check:!0,style:{textOverflow:"ellipsis"}},(0,t.jsx)(n.Checkbox,{checked:d,className:"mr-2",onChange:(e,t)=>{R(i.fromDate,!0),f(t)}}),o("useStartDateLabel")),(0,t.jsx)(n.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100",style:{textOverflow:"ellipsis",fontWeight:500}},o("endDateLabel")),(0,t.jsx)(n.Tooltip,{title:S},(0,t.jsx)(on.CalciteInputDatePicker,{scale:"s",disabled:!!p||void 0,valueAsDate:i.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;R(a,!1);const n=Object.assign(Object.assign({},i),{selectedToDate:a});u(n)}},status:b,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(n.Label,{size:"sm",className:"text-truncate w-100 pt-2",centric:!0,check:!0,style:{textOverflow:"ellipsis"}},(0,t.jsx)(n.Checkbox,{checked:p,className:"mr-2",onChange:(e,t)=>{R(i.toDate,!1),v(t)}}),o("useEndDateLabel"))))}var rn=l(68972),cn=function(e,t,a,n){return new(a||(a=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};const ln=t.React.forwardRef(((e,a)=>{const{intl:n,widgetId:o,network:i,isReady:s,networkDS:c,routeInfoFromDataAction:l,method:u,reset:d,jimuMapView:f,hoverGraphic:p,pickedGraphic:v,flashGraphic:h,lockAquired:m,hideDates:b,useRouteStartEndDate:D,revalidateRouteFromDataAction:g,onResetDataAction:y,onsubmit:S,onRouteInfoUpdate:w,onValidationChanged:R}=e,[j,I]=t.React.useState((0,r.getInitialRouteInfoState)());(0,rn.useImperativeHandle)(a,(()=>({handleNextClicked:k}))),t.React.useEffect((()=>{(0,r.isDefined)(i)&&!g&&(I((0,r.getInitialRouteInfoState)()),x())}),[i]),t.React.useEffect((()=>{d&&(I((0,r.getInitialRouteInfoState)()),x())}),[d]);const k=()=>{S(j)},x=()=>{(0,r.isDefined)(v)&&v.removeAll()},N=(e,t)=>cn(void 0,void 0,void 0,(function*(){var a;(0,r.isDefined)(e.selectedPolyline)&&t&&(a=yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF"),(0,r.isDefined)(a)&&(h.add(a),setTimeout((()=>{h.removeAll(),setTimeout((()=>{h.add(a),setTimeout((()=>{h.removeAll(),setTimeout((()=>{h.add(a),setTimeout((()=>{h.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,r.isDefined)(e.selectedPoint)?(e=>{(0,r.isDefined)(e)?(v.removeAll(),v.add(e)):x()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),"#008000")):x(),(0,r.isDefined)(f)&&setTimeout((()=>{f.clearSelectedFeatures()}),100)})),A=(e,t=!1)=>{I(e),w(e),N(e,t)},C=t.React.useCallback((()=>{var e;if(!m)return!1;if(!j.validRoute)return!1;if(0===(null===(e=j.routeId)||void 0===e?void 0:e.length))return!1;if(isNaN(j.selectedMeasure))return!1;if(isNaN(j.fromMeasure))return!1;if(j.selectedMeasure<j.fromMeasure)return!1;if(isNaN(j.toMeasure))return!1;if(j.selectedMeasure>j.toMeasure)return!1;if(!(0,r.isDefined)(j.selectedFromDate)&&!(0,r.isDefined)(j.selectedToDate))return!1;if((0,r.isDefined)(j.selectedFromDate)&&!(0,r.isDefined)(j.selectedToDate)){if((0,r.isDefined)(j.fromDate)&&j.selectedFromDate<j.fromDate)return!1;if((0,r.isDefined)(j.toDate)&&j.selectedFromDate>j.toDate)return!1}if(!(0,r.isDefined)(j.selectedFromDate)&&(0,r.isDefined)(j.selectedToDate)){if((0,r.isDefined)(j.fromDate)&&j.selectedToDate<j.fromDate)return!1;if((0,r.isDefined)(j.toDate)&&j.selectedToDate>j.toDate)return!1}if((0,r.isDefined)(j.selectedFromDate)&&(0,r.isDefined)(j.selectedToDate)){if(j.selectedFromDate>j.selectedToDate)return!1;if((0,r.isDefined)(j.fromDate)&&j.selectedFromDate<j.fromDate)return!1;if((0,r.isDefined)(j.toDate)&&j.selectedToDate>j.toDate)return!1}return!0}),[j,m]);return t.React.useEffect((()=>{R(C()&&s)}),[s,C,R]),(0,t.jsx)("div",{className:"add-single-point-event-route-selection-form__content h-100 d-flex",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-single-point-event-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-single-point-event-route-selection-form__actions {
      height: 100%;
    }
  `},(0,t.jsx)("div",{className:"d-flex w-100"},u===r.SearchMethod.Measure&&(0,t.jsx)(nn,{intl:n,widgetId:o,isReady:s,network:i,networkDS:c,routeInfo:j,jimuMapView:f,hoverGraphic:p,reset:d,routeInfoFromDataAction:l,revalidateRouteFromDataAction:g,onResetDataAction:y,clearPickedGraphic:x,onRouteInfoUpdated:A}),u===r.SearchMethod.Coordinate&&(0,t.jsx)("div",null),u===r.SearchMethod.LocationOffset&&(0,t.jsx)("div",null)),(0,t.jsx)("div",{className:"d-flex w-100 h-100"},(0,t.jsx)(sn,{hideDates:b,useRouteStartEndDate:D,routeInfo:j,reset:d,onUpdateRouteInfo:A})))}));function un(o){const i=t.hooks.useTranslation(a),{operationType:s,onOperationTypeChanged:r}=o,c=t.React.useMemo((()=>s),[s]);return(0,t.jsx)("div",{className:"add-point-event-operation-type"},(0,t.jsx)(n.Label,{size:"default",className:"pt-2 mb-0 px-3",style:{fontWeight:500,width:100,alignItems:"center"}},i("typeLabel")),(0,t.jsx)(n.Select,{"aria-label":i("typeLabel"),className:"w-100 px-3",size:"sm",value:c,onChange:e=>{r(e.target.value)}},(0,t.jsx)("option",{value:e.single}," ",i("singleOperation")),(0,t.jsx)("option",{value:e.multiple}," ",i("multipleOperation"))))}function dn(e){var o;const i=t.hooks.useTranslation(a),{intl:s,widgetId:l,lrsLayers:u,eventLayers:d,networkLayers:f,defaultEvent:p,defaultMethod:v,JimuMapView:h,operationType:m,hoverGraphic:b,pickedGraphic:D,flashGraphic:g,conflictPreventionEnabled:y,hideEvent:S,hideNetwork:w,hideType:R,hideMethod:j,hideDates:I,hideTitle:k,useRouteStartEndDate:x,networkDataSourceFromDataAction:N,routeInfoFromDataAction:A,onResetDataAction:C,onClearGraphic:O,onOperationTypeChanged:_}=e,[T,L]=t.React.useState(0),[M,E]=t.React.useState(null),[F,P]=t.React.useState(null),[G,V]=t.React.useState(null),[U,B]=t.React.useState(null),[z,W]=t.React.useState(!1),[q,Q]=t.React.useState(v),[$,Z]=t.React.useState(!1),[J,H]=t.React.useState((0,r.getInitialRouteInfoState)()),[K,Y]=t.React.useState((0,r.getIntialLocksInfo)()),[X,ee]=t.React.useState(!y),[te,ae]=t.React.useState(!1),ne=t.React.useRef(null),[oe,ie]=t.React.useState(!0),[se,re]=t.React.useState(!1),ce=t.React.useRef(null),le=t.React.useCallback((e=>{E(e)}),[E]),ue=t.React.useCallback((e=>{P(e)}),[P]),de=t.React.useCallback((()=>{W(!0)}),[W]);t.React.useEffect((()=>{var e;null===(e=ne.current)||void 0===e||e.focus()}),[]),t.React.useEffect((()=>{if(U){const e=u.find((e=>(0,r.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===U.eventInfo.parentNetworkId));e&&e.layerType===r.LrsLayerType.network&&V((0,t.Immutable)(e))}else{const e=u.find((e=>e.name===p.name));B((0,t.Immutable)(e))}}),[p,u,U]),t.React.useEffect((()=>{if((0,r.isDefined)(N)&&N.id!==(null==G?void 0:G.id)){E(N);let e,t=N;(N.id.includes("output_point")||N.id.includes("output_line"))&&(t=N.getOriginDataSources()[0]),u.forEach((a=>{a.id===t.id&&(0,r.isDefined)(a.networkInfo)&&(e=a)}));const a=u.find((t=>t.eventInfo.parentNetworkId===(null==e?void 0:e.networkInfo.lrsNetworkId)));(0,r.isDefined)(a)&&pe(a.name)}}),[N]),t.React.useEffect((()=>{ae((0,r.isDefined)(A))}),[A]),t.React.useEffect((()=>{fe(r.LockAction.None)}),[M,U,G]);const fe=t.React.useCallback(((e=r.LockAction.None,t)=>{if(y){const a=Object.assign({},K);(0,r.isDefined)(G)&&(a.networkId=[G.networkInfo.lrsNetworkId]),(0,r.isDefined)(U)&&(a.eventServiceLayerIds=[U.serviceId]),(0,r.isDefined)(t)&&(a.routeInfo=t),a.lockAction=e,Y(a)}}),[y,K,U,G]),pe=t.React.useCallback((e=>{const a=u.find((t=>t.name===e));if(a){const e=u.find((e=>(0,r.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===a.eventInfo.parentNetworkId));e&&e.layerType===r.LrsLayerType.network&&V((0,t.Immutable)(e)),re(!0),B((0,t.Immutable)(a))}}),[u]),ve=t.React.useCallback((e=>{const a=u.find((t=>t.name===e));(0,r.isDefined)(a)&&V((0,t.Immutable)(a))}),[u]),he=t.React.useCallback((e=>{Q(e)}),[]),me=t.React.useCallback((e=>{H(e),re(!1),L(1)}),[]),be=t.React.useCallback((()=>{const e=(0,r.getInitialRouteInfoState)();H(e),fe(r.LockAction.Clear,e),ae(!1),Z(!0),setTimeout((()=>{Z(!1)}),800)}),[fe]),De=t.React.useCallback((e=>{e&&(O(),be()),L(0),ne.current&&ne.current.focus()}),[be,O]),ge=t.React.useCallback((e=>{H(e),fe(r.LockAction.QueryAndAcquire,e)}),[fe]),ye=t.React.useMemo((()=>!(!z||!(0,r.isDefined)(null==h?void 0:h.view))),[null==h?void 0:h.view,z]),Se=t.React.useCallback(((e,t,a)=>{ee(!!a),Y(e)}),[]),we=t.React.useCallback((()=>{var e;null===(e=ce.current)||void 0===e||e.handleNextClicked()}),[]),Re=t.React.useCallback((e=>{ie(e)}),[]);return(0,t.jsx)("div",{className:"add-single-point-event h-100 d-flex",ref:ne,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-single-point-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(Ca,{network:G,event:U,dataSourcesReady:de,onCreateNetworkDs:le,onCreateEventDs:ue}),!k&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-point-event__content",{"d-none":1===T,[n.FOCUSABLE_CONTAINER_CLASS]:1!==T})},y&&(0,t.jsx)(r.LockManagerComponent,{intl:s,featureDS:M,showAlert:!0,lockInfo:K,networkName:null===(o=null==G?void 0:G.networkInfo)||void 0===o?void 0:o.datasetName,conflictPreventionEnabled:y,onQueryAndAcquireComplete:Se,onMessageClear:()=>{fe(r.LockAction.None)}}),!R&&(0,t.jsx)(un,{operationType:m,onOperationTypeChanged:_}),!S&&(0,t.jsx)("div",null,(0,t.jsx)(n.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},i("eventLayerLabel")),(0,t.jsx)(n.Select,{"aria-label":i("eventLayerLabel"),className:"w-100 px-3",size:"sm",value:U?U.name:"",disabled:1===d.length,onChange:e=>{pe(e.target.value)}},d.map(((e,a)=>(0,t.jsx)("options",{key:a,value:e},e))))),!w&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:!0,defaultItem:(0,r.isDefined)(G)?G.name:"",listItems:f,onSelectionChanged:ve}),!j&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("methodLabel"),isDisabled:!0,defaultItem:q,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:he}),(0,t.jsx)(ln,{ref:ce,intl:s,widgetId:l,network:G?G.networkInfo:null,routeInfoFromDataAction:A,isReady:ye,networkDS:M,method:q,reset:$,jimuMapView:h,hoverGraphic:b,pickedGraphic:D,flashGraphic:g,lockAquired:X,hideDates:I,useRouteStartEndDate:x,revalidateRouteFromDataAction:te,onResetDataAction:C,onsubmit:me,onRouteInfoUpdate:ge,onValidationChanged:Re})),(0,t.jsx)("div",{className:(0,t.classNames)("add-point-footer w-100",{"d-none":1===T,[n.FOCUSABLE_CONTAINER_CLASS]:1!==T})},(0,t.jsx)(n.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--sys-color-primary-main)"},onClick:be},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(n.Button,{className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!oe,onClick:we},i("nextLabel")))),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-point-event__content",{"d-none":1!==T,[n.FOCUSABLE_CONTAINER_CLASS]:1===T})},(0,t.jsx)(Aa,{intl:s,widgetId:l,networkDS:M,network:G,eventDS:F,eventLayer:U,routeInfo:J,reset:$||se,jimuMapView:h,hoverGraphic:b,conflictPreventionEnabled:y,onNavBack:De})))}var fn=function(e,t,a,n){return new(a||(a=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};const pn=()=>t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-multiple-point-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-point-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-multiple-point-events-edit-attributes__action {
      height: auto;
    }
    .add-point-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `;let vn=[];function hn(e){var o;const i=t.hooks.useTranslation(a),{intl:s,widgetId:c,networkDS:l,network:u,eventLayers:d,routeInfo:f,attributeSet:p,reset:v,isReady:h,jimuMapView:m,hoverGraphic:b,conflictPreventionEnabled:D,onNavBack:g}=e,[y,S]=t.React.useState([]),[w,R]=t.React.useState([]),[j,I]=t.React.useState([]),[k,x]=t.React.useState([]),[N,A]=t.React.useState(!1),[C,O]=t.React.useState(),[_,T]=t.React.useState(""),[L,M]=t.React.useState(!1),[E,F]=t.React.useState(!1),[P,G]=t.React.useState(!0),[V,U]=t.React.useState((0,r.getIntialLocksInfo)()),[B,z]=t.React.useState(!1),[W,q]=t.React.useState(!1);t.React.useEffect((()=>{v&&$(d)}),[v]),t.React.useEffect((()=>{(0,r.isDefined)(p)&&(0,r.isDefined)(d)&&h&&$(d)}),[p,d,h]),t.React.useEffect((()=>{Q()}),[l,u,d,f]);const Q=(e=r.LockAction.None,t,a)=>{if(D){const n=Object.assign({},V);if((0,r.isDefined)(u)&&(n.networkId=[u.networkInfo.lrsNetworkId]),(0,r.isDefined)(d)){const e=(0,r.isDefined)(a)?a:k,t=[];j.forEach(((a,n)=>{e[n]&&t.push(a.serviceId)})),n.eventServiceLayerIds=t}(0,r.isDefined)(t)&&(n.routeInfo=t),n.lockAction=e,U(n)}},$=e=>{if((0,r.isDefined)(e)){const t=[],a=[],n=[],o=[];e.forEach((e=>{const i=Z(e),s=J(e,i);t.push(i),a.push(s),n.push(e.asMutable({deep:!0})),o.push(!0)})),S(t),R(a),I(n),x(o),Q(r.LockAction.None,f,o),G(!0),0===o.length?F(!0):F(!1)}},Z=e=>{if((0,r.isDefined)(e)&&(0,r.isDefined)(e.useDataSource)){const a=t.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);if((0,r.isDefined)(a))return a}},J=(e,t)=>{const a=[];if((0,r.isDefined)(t)){const n=t,o=(null==n?void 0:n.layer).fields,i=p.layers.find((t=>t.layerId===e.serviceId));(0,r.isDefined)(i)&&i.fields.forEach((e=>{const t=o.find((t=>t.name===e.name));if(t){let n;""!==e.value&&(n=(0,r.isDate)(t.type)?(0,r.isDefined)(e.value)?new Date(e.value):null:(0,r.isNumber)(t.type)?Number(e.value):e.value);const o={index:a.length,name:t.name,alias:t.alias,type:t.type,hasDomain:(0,r.isDefined)(t.domain),value:n,error:"",nullable:t.nullable,default:"number"==typeof n?Number(n).toString():n,length:t.length,editable:t.editable};a.push(o)}}))}return a},H=e=>e.findIndex((e=>e.error.length>0))>-1,K=(e,t,a,n)=>{const o=Ia(w),i=Ia(o[n]);i[a].value=e,i[a].error=t,o[n]=i,R(o),M(H(o[n]))},Y=(e,t)=>{const a=Ia(w);a[t]=e,R(a),M(H(e))},X=(e,t)=>{var a;if(void 0===t)return;const n=Object.assign(vn);n[t]=e,vn=n,vn[t]&&0!==(null===(a=vn[t])||void 0===a?void 0:a.length)||q(!1)},ee=(e,t)=>{const a=k;a[t]=e,x(a),oe(a),Q(r.LockAction.None,f,a),a.every((e=>!e))?F(!0):F(!1)},te=e=>{D?(z(!1),Q(r.LockAction.Clear)):g(e)},ae=()=>fn(this,void 0,void 0,(function*(){y.forEach((e=>fn(this,void 0,void 0,(function*(){var a;const n=e,o=n.getPopupInfo(),i=n.getLayerDefinition(),s=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==o?void 0:o.fieldInfos)||[]).filter((e=>e.visible))),r=n.mergeQueryParams(null!==(a=n.getCurrentQueryParams())&&void 0!==a?a:{},{where:"1=1",sqlExpression:null}),l=Object.assign({returnGeometry:!0},r);yield n.load(l,{widgetId:c});const u=new t.DataRecordSetChangeMessage(c,t.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:s.map((e=>e.fieldName)),dataSource:n,name:n.id}]);t.MessageManager.getInstance().publishMessage(u)}))))})),ne=e=>fn(this,void 0,void 0,(function*(){const a={edits:[]};if((()=>{const e=Ia(w);let t=!1;return e.forEach(((a,n)=>{if(k[n]){const o=Ia(a);o.forEach(((s,c)=>{let l;if(l=s.hasDomain?(0,r.validateRangeDomain)(s.value,s.name,y[n]):((0,r.isDate)(s.type),(0,r.validateField)(s.value,s.name,y[n])),(0,r.isDefined)(vn[n])){const e=(0,r.validateContingencyConstraints)(s.value,"",c,a,vn[n]);if((null==e?void 0:e.length)>0){let t=[];e.forEach((e=>{var a;const n=null===(a=null==e?void 0:e.fieldGroup)||void 0===a?void 0:a.fields;t.push(n)})),t=t.flat(),t.includes(s.name)&&(q(!0),l={hasError:!0,message:"contingentValueError"})}}if(l.hasError){let a;if("contingentValueError"===l.message){const e=[];vn[n].forEach((t=>{e.push(t.name)}));let t=i("invalidContingentValues");t=t.replace("{groupNames}",e.join(",")),a=t}else{const e=j[n].useFieldAlias?s.alias:s.name;a=i("attributeError",{fieldValue:e,message:i(l.message)})}O("error"),T(a),A(!0),setTimeout((()=>{A(!1)}),5e3),t=!0,s.error=i(l.message),e[n]=o}}))}})),t&&R(e),t})())return;let n=y[0].getGDBVersion();n||(n="");const o=j[0].lrsUrl;j.forEach(((e,n)=>{if(k[n]&&(0,r.isDefined)(e)){const o={},i=e.eventInfo.eventIdFieldName;o[i]="{"+t.utils.getUUID()+"}";const s=e.eventInfo.routeIdFieldName;o[s]=f.routeId;const c=e.eventInfo.fromMeasureFieldName;o[c]=f.selectedMeasure;const u=e.eventInfo.fromDateFieldName;if((0,r.isDefined)(f.selectedFromDate)){const e=(0,r.getDateWithoutTZOffset)(f.selectedFromDate.valueOf(),l);o[u]=(0,r.getDateToUTC)(e)}else o[u]=f.selectedFromDate;const d=e.eventInfo.toDateFieldName;if((0,r.isDefined)(f.selectedToDate)){const e=(0,r.getDateWithoutTZOffset)(f.selectedToDate.valueOf(),l);o[d]=(0,r.getDateToUTC)(e)}else o[d]=f.selectedToDate;if(e.eventInfo.routeNameFieldName&&e.eventInfo.routeNameFieldName.length>0){const t=e.eventInfo.routeNameFieldName;o[t]=f.routeName}w[n].forEach((e=>{const t=e.name;if((0,r.isDefined)(e.value)&&(0,r.isDate)(e.type)){const a=(0,r.getDateWithoutTZOffset)(e.value.valueOf(),l);o[t]=(0,r.getDateToUTC)(a)}else(0,r.isNumber)(e.type)?!(0,r.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?o[t]=null:o[t]=Number(e.value):o[t]=e.value})),(0,r.isDefined)(f.selectedPoint.spatialReference.wkid)||(f.selectedPoint.spatialReference.wkid=m.view.spatialReference.wkid);const p=[],v={attributes:o,geometry:f.selectedPoint};p.push(v);const h={id:e.serviceId,adds:p,allowMerge:!1,retireMeasureOverlap:!1,retireByEventId:!1};a.edits.push(h)}})),yield(0,r.LrsApplyEdits)(o,a,n).then((t=>fn(this,void 0,void 0,(function*(){t.success?(O("success"),T(i("eventCreated")),A(!0),ae(),setTimeout((()=>fn(this,void 0,void 0,(function*(){if(A(!1),D){z(!0),yield(0,r.tryReleaseLockOnDefault)(l,e);const t=Object.assign(Object.assign({},e),{lockAction:r.LockAction.Clear});U(t)}else te(!0)}))),5e3)):(O("error"),T(`${t.message} \n ${t.details}`),A(!0),setTimeout((()=>{A(!1)}),5e3))}))))})),oe=e=>{e.every((e=>e))?G(!0):(e.every((e=>!e)),G(!1))};return(0,t.jsx)("div",{className:"h-100",css:pn()},(0,t.jsx)("div",{className:"add-multiple-point-events-edit-attributes__content"},D&&(0,t.jsx)(r.LockManagerComponent,{intl:s,featureDS:l,lockInfo:V,showAlert:!0,networkName:null===(o=null==u?void 0:u.networkInfo)||void 0===o?void 0:o.datasetName,conflictPreventionEnabled:D,onQueryAndAcquireComplete:(e,t,a)=>{U(e),a&&ne(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},V),{lockAction:r.LockAction.None});U(e),g(B),z(!1)}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"mr-auto"},(0,t.jsx)(n.Label,{size:"sm",className:"text-truncate w-100 pt-2",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,t.jsx)(n.Checkbox,{checked:P,className:"mr-2",onChange:e=>{const t=e.target.checked,a=k;a.forEach(((e,n)=>{a[n]=t})),Q(r.LockAction.None,f,a),x(a),oe(a),a.every((e=>!e))?F(!0):F(!1)}}),i("selectAllLabel"))),(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:l,eventDataSources:y,jimuMapView:m,hoverGraphic:b,onAttributesCopied:e=>{const t=Ia(w);e.forEach((e=>{const a=d.findIndex((t=>t.serviceId.toString()===e.layerId));if(a>-1){const n=Ia(t[a]);e.fieldValuePair.forEach((e=>{const t=n.findIndex((t=>t.name===e.name));if(t>-1){let a=e.value;(0,r.isDate)(n[t].type)&&(a=(0,r.isDefined)(e.value)?new Date(e.value):null),n[t].value=a}})),t[a]=n}})),R(t)}}))),W&&(0,t.jsx)(n.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){q(!1)},open:W,text:_,type:"warning",closable:!0,withIcon:!0}),(0,r.isDefined)(w)&&w.map(((e,a)=>(0,t.jsx)("div",null,(0,t.jsx)(r.AttributeTable,{key:a,tableIndex:a,eventDS:y[a],eventLayer:(0,t.Immutable)(j[a]),fieldInfos:e,useAlias:!0,collapable:!0,isExpanded:k[a],onItemChecked:ee,onUpdateItem:K,onUpdateAll:Y,onFieldGrpUpdated:X})))),N&&(0,t.jsx)("div",{className:"add-point-event-edit-attributes__toast-container px-3 w-100"},(0,t.jsx)(n.Alert,{className:"add-point-event-edit-attributes__toast w-100",type:C,text:_,closable:!0,withIcon:!0,open:N,onClose:()=>{A(!1)}}))),(0,t.jsx)("div",{className:"add-point-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-multiple-point-events-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(n.Button,{"aria-label":i("backLabel"),size:"sm",type:"secondary",onClick:()=>{te(!1)}},i("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(n.Button,{className:"active","aria-label":i("saveLabel"),size:"sm",disabled:L||E||W,onClick:()=>{D?Q(r.LockAction.QueryAndAcquire,f,k):ne()}},i("saveLabel"))))))}function mn(e){const{events:a,dataSourcesReady:n}=e,[o,i]=t.React.useState(null!=a?a:null),[s,c]=t.React.useState([]);t.React.useEffect((()=>{if(a&&a.length>0){i(a);const e=Array(a.length).fill(!1);c(e)}else i(null),c([]),n(!0)}),[n,a]);const l=t.React.useCallback(((e,t)=>{const a=s;a[e]=t,c(a),n(a.every((e=>e)))}),[n,s]),u=t.React.useCallback(((e,t)=>{l(t,!0)}),[l]),d=t.React.useCallback(((e,a)=>{if(e){const{status:n,instanceStatus:o}=e;o===t.DataSourceStatus.NotCreated||o===t.DataSourceStatus.CreateError||n===t.DataSourceStatus.LoadError||n===t.DataSourceStatus.NotReady?l(a,!1):l(a,!0)}}),[l]),f=t.React.useCallback((e=>{l(e,!1)}),[l]);return(0,t.jsx)("div",null,(0,r.isDefined)(o)&&o.map(((e,a)=>(0,t.jsx)(t.DataSourceComponent,{key:a,useDataSource:e.useDataSource,onDataSourceInfoChange:e=>{d(e,a)},onCreateDataSourceFailed:e=>{f(a)},onDataSourceCreated:e=>{u(e,a)}}))))}function bn(e){var o;const i=t.hooks.useTranslation(a),{intl:s,widgetId:l,lrsLayers:u,jimuMapView:d,operationType:f,networkLayers:p,defaultNetwork:v,defaultMethod:h,defaultAttributeSet:m,attributeSets:b,hoverGraphic:D,pickedGraphic:g,flashGraphic:y,conflictPreventionEnabled:S,hideNetwork:w,hideMethod:R,hideType:j,hideAttributeSet:I,hideDates:k,hideTitle:x,useRouteStartEndDate:N,networkDataSourceFromDataAction:A,routeInfoFromDataAction:C,onResetDataAction:O,onClearGraphic:_,onOperationTypeChanged:T}=e,[L,M]=t.React.useState(0),[E,F]=t.React.useState(null),[P,G]=t.React.useState(null),[V,U]=t.React.useState(null),[B,z]=t.React.useState(!1),[W,q]=t.React.useState(!1),[Q,$]=t.React.useState(h),[Z,J]=t.React.useState(m),[H,K]=t.React.useState(null),[Y,X]=t.React.useState(!1),[ee,te]=t.React.useState(null),[ae,ne]=t.React.useState(!1),[oe,ie]=t.React.useState((0,r.getIntialLocksInfo)()),se=t.React.useRef(null),[re,ce]=t.React.useState(!0),le=t.React.useRef(null),ue=t.React.useCallback((e=>{F(e)}),[F]),de=t.React.useCallback((()=>{z(!0)}),[z]),fe=t.React.useCallback((()=>{q(!0)}),[q]),pe=t.React.useCallback((e=>{const a=u.find((t=>t.name===e));(0,r.isDefined)(a)&&G((0,t.Immutable)(a))}),[u]);t.React.useEffect((()=>{var e;null===(e=se.current)||void 0===e||e.focus()}),[]),t.React.useEffect((()=>{ne((0,r.isDefined)(C))}),[C]),t.React.useEffect((()=>{if((0,r.isDefined)(A)&&A.id!==(null==P?void 0:P.id)){F(A);let e,t=A;(A.id.includes("output_point")||A.id.includes("output_line"))&&(t=A.getOriginDataSources()[0]),u.forEach((a=>{a.id===t.id&&(0,r.isDefined)(a.networkInfo)&&(e=a)}));const a=e.name;pe(a)}}),[A]),t.React.useEffect((()=>{ne((0,r.isDefined)(C))}),[C]),t.React.useEffect((()=>{if(!(0,r.isDefined)(P))if((0,r.isDefined)(v)){const e=u.find((e=>e.name===v.name));G((0,t.Immutable)(e))}else{const e=u.find((e=>e.layerType===r.LrsLayerType.network));e&&G((0,t.Immutable)(e))}if(!(0,r.isDefined)(H)){const e=b.attributeSet.find((e=>e.title===Z));e&&K(e)}}),[u,v]),t.React.useEffect((()=>{S&&ve()}),[E,H,P]);const ve=t.React.useCallback(((e=r.LockAction.None,t)=>{const a=Object.assign({},oe);if((0,r.isDefined)(P)&&(a.networkId=[P.networkInfo.lrsNetworkId]),(0,r.isDefined)(H)){const e=H.layers.map((e=>e.layerId));a.eventServiceLayerIds=e}(0,r.isDefined)(t)&&(a.routeInfo=t),a.lockAction=e,ie(a)}),[P,H,oe]);t.React.useEffect((()=>{if((0,r.isDefined)(H)&&(0,r.isDefined)(P)){const e=[];H.layers.forEach((t=>{const a=u.find((e=>e.serviceId===t.layerId));a&&P.networkInfo.lrsNetworkId===a.eventInfo.parentNetworkId&&e.push(a)})),U((0,t.Immutable)(e))}}),[H,P]);const he=t.React.useCallback((e=>{const t=b.attributeSet.find((t=>t.title===e));t&&K(t),J(e)}),[]),me=t.React.useCallback((e=>{$(e)}),[]),be=t.React.useMemo((()=>!!(B&&W&&(0,r.isDefined)(d)&&(0,r.isDefined)(null==d?void 0:d.view)&&(null==d?void 0:d.view.ready))),[B,W,d]),De=t.React.useCallback((e=>{te(e),M(1)}),[]),ge=t.React.useCallback((e=>{e&&(_(),ye()),M(0),se.current&&se.current.focus()}),[]),ye=t.React.useCallback((()=>{const e=(0,r.getInitialRouteInfoState)();te(e),ve(r.LockAction.Clear,e),X(!0),setTimeout((()=>{X(!1)}),800)}),[ve]),Se=t.React.useCallback((e=>{te(e),ve(r.LockAction.Release,e)}),[ve]),we=t.React.useCallback(((e,t)=>{ie(e)}),[]),Re=t.React.useCallback((()=>{var e;null===(e=le.current)||void 0===e||e.handleNextClicked()}),[]),je=t.React.useCallback((e=>{ce(e)}),[]);return(0,t.jsx)("div",{className:"add-multiple-point-event h-100 d-flex",ref:se,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-multiple-point-event-form {
      height: 100%;
    }
    .add-multiple-point-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(Ca,{network:P,dataSourcesReady:de,onCreateNetworkDs:ue}),(0,t.jsx)(mn,{events:V,dataSourcesReady:fe}),!x&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-point-event__content",{"d-none":1===L,[n.FOCUSABLE_CONTAINER_CLASS]:1!==L})},S&&(0,t.jsx)(r.LockManagerComponent,{intl:s,showAlert:!1,featureDS:E,lockInfo:oe,networkName:null===(o=null==P?void 0:P.networkInfo)||void 0===o?void 0:o.datasetName,conflictPreventionEnabled:S,onQueryAndReleaseComplete:we,onMessageClear:()=>{ve(r.LockAction.None)}}),!j&&(0,t.jsx)(un,{operationType:f,onOperationTypeChanged:T}),!w&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:1===p.length,defaultItem:(0,r.isDefined)(P)?P.name:"",listItems:p,onSelectionChanged:pe}),!I&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("attributeSetLabel"),isDisabled:1===b.attributeSet.length,defaultItem:Z,listItems:(()=>{const e=[];return b.attributeSet.forEach((t=>{e.push(t.title)})),e})(),onSelectionChanged:he}),!R&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("methodLabel"),isDisabled:!0,defaultItem:Q,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:me}),(0,t.jsx)(ln,{ref:le,intl:s,widgetId:l,network:P?P.networkInfo:null,routeInfoFromDataAction:C,isReady:be,networkDS:E,method:Q,reset:Y,jimuMapView:d,hoverGraphic:D,pickedGraphic:g,flashGraphic:y,lockAquired:!0,hideDates:k,useRouteStartEndDate:N,revalidateRouteFromDataAction:ae,onResetDataAction:O,onsubmit:De,onRouteInfoUpdate:Se,onValidationChanged:je})),(0,t.jsx)("div",{className:(0,t.classNames)("add-point-footer w-100",{"d-none":1===L,[n.FOCUSABLE_CONTAINER_CLASS]:1!==L})},(0,t.jsx)("div",{className:"add-point-footer__action w-100 d-flex"},(0,t.jsx)(n.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--sys-color-primary-main)"},onClick:ye},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(n.Button,{className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!re,onClick:Re},i("nextLabel"))))),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-point-event__content",{"d-none":1!==L,[n.FOCUSABLE_CONTAINER_CLASS]:1===L})},(0,t.jsx)(hn,{intl:s,widgetId:l,networkDS:E,network:P,eventLayers:V,attributeSet:H,routeInfo:ee,reset:Y,isReady:be,jimuMapView:d,hoverGraphic:D,conflictPreventionEnabled:S,onNavBack:ge})))}var Dn=l(59620),gn=function(e,t,a,n){return new(a||(a=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};const yn=t.css`
  background-color: var(--ref-palette-white);
`;class Sn extends t.React.PureComponent{constructor(o){super(o),this.onActiveViewChange=e=>gn(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=e=>gn(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const a=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==a?void 0:a.isDataSourceSet())&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then((()=>a)).catch((e=>a)):Promise.resolve(a)})),this.handleOperationTypeChange=e=>{this.setState({operationType:e}),this.clearGraphics()},this.getI18nMessage=(e,t)=>{const o=Object.assign({},a,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.state={hideTitle:!1,jimuMapView:void 0,operationType:e.single,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedRouteInfo)&&this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo});const a=(0,r.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:a}),this.setState({operationType:this.props.config.defaultType})}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,a){var n,o,i,s,c,l,u,d,f,p;a.jimuMapView!==this.state.jimuMapView&&(0,r.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const v=null===(i=null===(o=null===(n=(0,t.getAppStore)())||void 0===n?void 0:n.getState())||void 0===o?void 0:o.widgetsRuntimeInfo[this.props.id])||void 0===i?void 0:i.state;if((v===t.WidgetState.Opened||!v)&&((null===(s=this.props)||void 0===s?void 0:s.selectedNetworkDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(c=null==e?void 0:e.mutableStatePropsVersion)||void 0===c?void 0:c.selectedNetworkDataSource)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(u=this.props)||void 0===u?void 0:u.selectedRouteInfo)){!(null===(d=this.props)||void 0===d?void 0:d.selectedRouteInfo)||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedRouteInfo&&(null===(f=null==e?void 0:e.mutableStatePropsVersion)||void 0===f?void 0:f.selectedRouteInfo)===(null===(p=this.props.mutableStatePropsVersion)||void 0===p?void 0:p.selectedRouteInfo)||this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo})}}removeGraphicLayers(){(0,r.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,r.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,r.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,r.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const a=new Dn.default({listMode:"hide"}),n=new Dn.default({listMode:"hide"}),o=new Dn.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([n,o,a]),this.setState({hoverGraphic:a}),this.setState({pickedGraphic:n}),this.setState({flashGraphic:o})}}clearGraphics(){(0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,r.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,r.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}resetDataAction(){this.setState({routeInfoFromDataAction:null}),this.setState({networkDataSourceFromDataAction:null})}render(){var a;const{config:o,id:r,intl:c}=this.props,{lrsLayers:l,networkLayers:u,eventLayers:d,intersectionLayers:f,defaultEvent:p,defaultNetwork:v,defaultMethod:h,attributeSets:m,defaultAttributeSet:b,hideMethod:D,hideEvent:g,hideNetwork:y,hideType:S,hideAttributeSet:w,hideDates:R,useRouteStartEndDate:j,conflictPreventionEnabled:I}=o,{jimuMapView:k,operationType:x}=this.state;return(null==u?void 0:u.length)&&(null==d?void 0:d.length)?(0,t.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-add-point-event surface-1 border-0",css:yn},(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0],onActiveViewChange:this.onActiveViewChange}),x===e.single&&(0,t.jsx)(dn,{intl:c,widgetId:r,lrsLayers:l,JimuMapView:k,operationType:x,onOperationTypeChanged:this.handleOperationTypeChange,eventLayers:d,networkLayers:u,instersectionLayers:f,defaultEvent:p,defaultMethod:h,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:I,hideEvent:g,hideNetwork:y,hideType:S,hideMethod:D,hideDates:R,hideTitle:this.state.hideTitle,useRouteStartEndDate:j,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphic:this.clearGraphics.bind(this)}),x===e.multiple&&(0,t.jsx)(bn,{intl:c,widgetId:r,lrsLayers:l,jimuMapView:this.state.jimuMapView,operationType:x,onOperationTypeChanged:this.handleOperationTypeChange,networkLayers:u,defaultNetwork:v,defaultMethod:h,defaultAttributeSet:b,attributeSets:m,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:I,hideNetwork:y,hideMethod:D,hideType:S,hideAttributeSet:w,hideDates:R,hideTitle:this.state.hideTitle,useRouteStartEndDate:j,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphic:this.clearGraphics.bind(this)})):(0,t.jsx)(n.WidgetPlaceholder,{icon:i(),widgetId:r,message:this.getI18nMessage("_widgetLabel")})}}Sn.mapExtraStateProps=(e,t)=>{var a,n;return{selectedRouteInfo:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedRouteInfo,selectedNetworkDataSource:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedNetworkDataSource}};const wn=Sn;function Rn(e){l.p=e}})(),u})())}}}));