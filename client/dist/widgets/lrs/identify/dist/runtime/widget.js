System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","esri/TimeExtent","esri/geometry/geometryEngine","calcite-components","esri/Graphic"],(function(e,t){var i={},l={},o={},n={},a={},d={},r={},u={},s={};return{setters:[function(e){i.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.MessageManager=e.MessageManager,i.React=e.React,i.ReactRedux=e.ReactRedux,i.RecordSetChangeType=e.RecordSetChangeType,i.css=e.css,i.hooks=e.hooks,i.jsx=e.jsx},function(e){l.Button=e.Button,l.CollapsablePanel=e.CollapsablePanel,l.DataActionList=e.DataActionList,l.DataActionListStyle=e.DataActionListStyle,l.FloatingPanel=e.FloatingPanel,l.Icon=e.Icon,l.Label=e.Label,l.Pagination=e.Pagination,l.Select=e.Select,l.WidgetPlaceholder=e.WidgetPlaceholder,l.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){a.GetUnits=e.GetUnits,a.QueryRouteMeasures=e.QueryRouteMeasures,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getHoverGraphic=e.getHoverGraphic,a.getRouteFromEndMeasures=e.getRouteFromEndMeasures,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.isDefined=e.isDefined},function(e){d.default=e.default},function(e){r.default=e.default},function(e){u.CalciteTable=e.CalciteTable,u.CalciteTableHeader=e.CalciteTableHeader,u.CalciteTableRow=e.CalciteTableRow},function(e){s.default=e.default}],execute:function(){e((()=>{var e={66454:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3.5 4.5H1v1h12.5V10h1V5.5H17v-1H4.5V0h-1zM6 11v-1H5v1zM6 14v-2H5v2H4v1h3v-1z"></path><path fill="#000" fill-rule="evenodd" d="M5 17.978A5.5 5.5 0 1 1 10.793 14H20v6H5zm5-5.478a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m.4 2.5a5.5 5.5 0 0 1-4.407 2.978H6V19h3.5v-1h1v1h2v-4zm6.1 2h-1v2h-2v-4H19v4h-2.5z" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=u},22089:e=>{"use strict";e.exports=s},46678:e=>{"use strict";e.exports=d},77958:e=>{"use strict";e.exports=r},59620:e=>{"use strict";e.exports=n},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=l},47626:e=>{"use strict";e.exports=a}},t={};function v(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,v),o.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var c={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(c),v.d(c,{__set_webpack_public_path__:()=>fe,default:()=>ce});var e=v(79244);const t={_widgetLabel:"LRS Identify",method:"Method",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",network:"Network",referent:"Referent",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidRouteField:"Route could not be found with provided value",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",typeStr:"Type:",routeStr:"Route",measureLabel:"Measure:",startMeasure:"Start Measure:",endMeasure:"End Measure:",dateStr:"Date:",networkLabel:"Network:",routeId:"Route ID:",routeName:"Route Name:",identifyResults:"Identify Routes",eventInformation:"Event Information",attr:"Attribute",val:"Value",toStr:"to",layerField:"{layerName}.{fieldName}",identifyWidget:"LRS Identify",routePicker:"Route Picker",nullStr:"null",lineEvent:"Line Events",pointEvent:"Point Events"};var i=v(14321),l=v(66454),o=v.n(l),n=v(62686),a=v(59620),d=v(47626);const r=[];function u(t){const{lrsLayers:i,selectedNetwork:l,dataSourcesReady:o,onCreatePointDs:n,handleSetDataSources:a}=t,[u,s]=e.React.useState(null!=i?i:null),[v,c]=e.React.useState([]),[f,h]=e.React.useState();e.React.useEffect((()=>{if(i){s(i);const e=Array(i.length).fill(!1);c(e)}}),[i]);const p=e.React.useCallback(((e,t)=>{const i=v;i[e]=t,c(i),i.every((e=>e))&&o(!0)}),[o,v]),m=e.React.useCallback(((e,t)=>{r.push(e),h(r),(null==i?void 0:i.length)===r.length&&a(r),p(t,!0)}),[null==i?void 0:i.length,p,f,a]),y=e.React.useCallback(((t,i)=>{if(t){const{status:l,instanceStatus:o}=t;o===e.DataSourceStatus.NotCreated||o===e.DataSourceStatus.CreateError||l===e.DataSourceStatus.LoadError||l===e.DataSourceStatus.NotReady?p(i,!1):p(i,!0)}}),[p]),g=e.React.useCallback((e=>{p(e,!1)}),[p]),w=e=>{n(e)},S=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:null==l?void 0:l.outputPointDsId,mainDataSourceId:null==l?void 0:l.outputPointDsId})),[null==l?void 0:l.outputPointDsId]);return(0,e.jsx)("div",null,(0,d.isDefined)(u)&&u.map(((t,i)=>{var l;const o=null===(l=null==t?void 0:t.layerType)||void 0===l?void 0:l.toLocaleLowerCase();return(0,e.jsx)("div",null,"network"===o&&(0,d.isDefined)(S)&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:S,onDataSourceCreated:w}),(0,e.jsx)(e.DataSourceComponent,{key:i,useDataSource:t.useDataSource,onDataSourceInfoChange:e=>{y(e,i)},onCreateDataSourceFailed:e=>{g(i)},onDataSourceCreated:e=>{m(e,i)}}))})))}var s,f;!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(s||(s={})),function(e){e.measure="ROUTEANDMEASURE",e.coordinate="COORDINATE",e.locationOffset="LOCATIONOFFSET"}(f||(f={}));var h=v(46678),p=v(77958);const m="object"==typeof global&&global&&global.Object===Object&&global;var y="object"==typeof self&&self&&self.Object===Object&&self;const g=m||y||Function("return this")();var w=/\s/;const S=function(e){for(var t=e.length;t--&&w.test(e.charAt(t)););return t};var b=/^\s+/;const D=function(e){return e?e.slice(0,S(e)+1).replace(b,""):e};const I=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const x=g.Symbol;var j=Object.prototype,R=j.hasOwnProperty,k=j.toString,M=x?x.toStringTag:void 0;const C=function(e){var t=R.call(e,M),i=e[M];try{e[M]=void 0;var l=!0}catch(e){}var o=k.call(e);return l&&(t?e[M]=i:delete e[M]),o};var L=Object.prototype.toString;const G=function(e){return L.call(e)};var N=x?x.toStringTag:void 0;const F=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":N&&N in Object(e)?C(e):G(e)};const P=function(e){return null!=e&&"object"==typeof e};const T=function(e){return"symbol"==typeof e||P(e)&&"[object Symbol]"==F(e)};var E=/^[-+]0x[0-9a-f]+$/i,O=/^0b[01]+$/i,A=/^0o[0-7]+$/i,V=parseInt;const U=function(e){if("number"==typeof e)return e;if(T(e))return NaN;if(I(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=I(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=D(e);var i=O.test(e);return i||A.test(e)?V(e.slice(2),i?2:8):E.test(e)?NaN:+e};var W=1/0;const H=function(e){return e?(e=U(e))===W||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const z=function(e){var t=H(e),i=t%1;return t==t?i?t-i:t:0};const B=function(e,t){for(var i=-1,l=null==e?0:e.length,o=Array(l);++i<l;)o[i]=t(e[i],i,e);return o};const _=Array.isArray;var Z=x?x.prototype:void 0,Q=Z?Z.toString:void 0;const J=function e(t){if("string"==typeof t)return t;if(_(t))return B(t,e)+"";if(T(t))return Q?Q.call(t):"";var i=t+"";return"0"==i&&1/t==-1/0?"-0":i};const K=function(e){return null==e?"":J(e)};var $=g.isFinite,q=Math.min;const Y=function(e){var t=Math[e];return function(e,i){if(e=U(e),(i=null==i?0:q(z(i),292))&&$(e)){var l=(K(e)+"e").split("e"),o=t(l[0]+"e"+(+l[1]+i));return+((l=(K(o)+"e").split("e"))[0]+"e"+(+l[1]-i))}return t(e)}}("round");var X=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};const ee=e.css`
    .route-picker-btn {
      background-color: var(--primary);
      color: var(--light);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--light);
      }
    }
    .route-picker-btn-disabled {
      color: var(--dark);
      background-color: var(--light);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--primary);
      }
    }
  `;function te(t){const{intl:l,isReady:n,active:a,jimuMapView:r,hoverGraphic:u,allDataSources:v,lrsLayers:c,config:f,onActiveChange:m,clearFlashGraphic:y,clearPickedGraphic:g,handleShowPp:w}=t;let{eventDataRecords:S}=t;const b=e.React.useRef(null),D=e.React.useRef(null),I=e.React.useRef(!1),x=e.React.useRef(!1),[j,R]=e.React.useState(!1);e.React.useEffect((()=>{a?k():M()}),[a]);const k=()=>{n&&(b.current=null==r?void 0:r.view.on("pointer-move",G),D.current=null==r?void 0:r.view.on("pointer-down",N))},M=()=>{(0,d.isDefined)(b.current)&&(b.current.remove(),b.current=null),(0,d.isDefined)(D.current)&&(D.current.remove(),D.current=null),x.current&&(x.current=!1),I.current&&(I.current=!1)},C=()=>{(0,d.isDefined)(u)&&u.removeAll()},L=e=>{C(),(0,d.isDefined)(e)&&u.add(e)},G=e=>X(this,void 0,void 0,(function*(){I.current||(yield Promise.all(v.map((t=>X(this,void 0,void 0,(function*(){const i=t,l=null==i?void 0:i.layer,o=c.find((e=>e.serviceId===l.layerId));if((0,d.isDefined)(o)&&o.layerType.toLocaleLowerCase()===s.network.toLocaleLowerCase()&&(0,d.isDefined)(l)){I.current=!0;const t=l.spatialReference,o=l.createQuery(),n=null==r?void 0:r.view.toMap(e),a="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);o.geometry=n,o.units="meters",o.returnM=!0,o.distance=(null==r?void 0:r.view.resolution)*a,o.spatialRelationship="intersects",o.returnGeometry=!0;const u=i.getCurrentQueryParams();(null==u?void 0:u.time)&&(o.timeExtent=new h.default({start:u.time[0],end:u.time[1]})),o.gdbVersion=u.gdbVersion,o.outFields=["*"],l.queryFeatures(o).then((e=>X(this,void 0,void 0,(function*(){if(e&&e.features.length>0&&I.current){const t=e.features[0].geometry,i=p.default.nearestCoordinate(t,n),l=p.default.nearestVertex(t,n);l.distance<3*o.distance&&(i.coordinate=l.coordinate),L(yield(0,d.getHoverGraphic)(yield(0,d.getSimplePointGraphic)(i.coordinate))),I.current=!1}else L(null),I.current=!1}))))}}))))))})),N=e=>X(this,void 0,void 0,(function*(){if(e.stopPropagation(),x.current)return;const i=[],o=[];let n;S=[],yield Promise.all(v.map((t=>X(this,void 0,void 0,(function*(){const a=t,u=null==a?void 0:a.layer,v=(e=>{const t={routeIdFieldName:null,routeNameFieldName:null,layer:null};for(let i=0;i<c.length;i++){const l=c[i];if((null==l?void 0:l.serviceId)===(null==e?void 0:e.layerId)){const e=null==l?void 0:l.layerType;if(e.toLocaleLowerCase()===s.event.toLocaleLowerCase()){const e=null==l?void 0:l.eventInfo;t.routeIdFieldName=e.routeIdFieldName,t.routeNameFieldName=null==e?void 0:e.routeNameFieldName,t.layer=l}else if(e.toLocaleLowerCase()===s.network.toLocaleLowerCase()){const e=null==l?void 0:l.networkInfo,i=null==e?void 0:e.routeIdFieldSchema;t.routeIdFieldName=null==i?void 0:i.jimuName,t.layer=l}break}}return t})(u);if((0,d.isDefined)(u)){const c=u.popupEnabled;u.popupEnabled=!1,x.current=!0;const m=u.spatialReference,y=u.createQuery(),g=null==r?void 0:r.view.toMap(e),w="degrees"===m.unit?4:Math.max(3*m.metersPerUnit,3);y.geometry=g,y.units="meters",y.distance=(null==r?void 0:r.view.resolution)*w,y.spatialRelationship="intersects",y.returnGeometry=!0,y.returnM=!0,y.returnZ=!0,y.outFields=["*"];const b=a.getCurrentQueryParams();(null==b?void 0:b.time)&&(y.timeExtent=new h.default({start:b.time[0],end:b.time[1]})),y.gdbVersion=b.gdbVersion;const D=[];yield u.queryFeatures(y).then((e=>X(this,void 0,void 0,(function*(){var r;yield Promise.all(null===(r=null==e?void 0:e.features)||void 0===r?void 0:r.map((e=>X(this,void 0,void 0,(function*(){var r,c,h,m,w,b,I,x,j,R,k,M,C,L,G,N,F,P;const T=(0,d.getRouteFromEndMeasures)(e.geometry),E=e.geometry,O=p.default.nearestCoordinate(E,g),A=p.default.nearestVertex(E,g);A.distance<3*y.distance&&(O.coordinate=A.coordinate),n||(n=O.coordinate,n.hasZ=!0);const V=null==e?void 0:e.attributes;if((null===(c=null===(r=null==v?void 0:v.layer)||void 0===r?void 0:r.layerType)||void 0===c?void 0:c.toLocaleLowerCase())===s.network.toLocaleLowerCase()){const r=null===(h=null==v?void 0:v.layer)||void 0===h?void 0:h.networkInfo;yield((e,t,i)=>{if(e)return new Promise(((l,o)=>{var n,a,d,r,u,s;const v=e.getCurrentQueryParams();if(!(null===(a=null===(n=null==i?void 0:i.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.supportsLines))return l([]),[];{const o=null===(r=null===(d=null==i?void 0:i.layer)||void 0===d?void 0:d.networkInfo)||void 0===r?void 0:r.lineIdFieldName,n=null===(s=null===(u=null==i?void 0:i.layer)||void 0===u?void 0:u.networkInfo)||void 0===s?void 0:s.lineOrderFieldName,a={where:`${o} LIKE '%${t[o]}'`,outFields:["*"],orderByFields:[n]};(null==v?void 0:v.time)&&(a.time=[v.time[0],v.time[1]]),a.gdbVersion=v.gdbVersion,e.query(a).then((e=>(l(e),e)))}}))})(a,V,v).then((s=>X(this,void 0,void 0,(function*(){var s,c,f,h,p,m;yield(0,d.QueryRouteMeasures)(a,r,T,V[null===(f=null===(c=null===(s=null==v?void 0:v.layer)||void 0===s?void 0:s.networkInfo)||void 0===c?void 0:c.fromDateFieldSchema)||void 0===f?void 0:f.name],V[null===(m=null===(p=null===(h=null==v?void 0:v.layer)||void 0===h?void 0:h.networkInfo)||void 0===p?void 0:p.routeIdFieldSchema)||void 0===m?void 0:m.name]).then((s=>X(this,void 0,void 0,(function*(){var c,f,h,p,m,y;const g=Math.min(...s),w=Math.max(...s);yield(0,d.QueryRouteMeasures)(a,r,[O.coordinate],V[null===(h=null===(f=null===(c=null==v?void 0:v.layer)||void 0===c?void 0:c.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===h?void 0:h.name],V[null===(y=null===(m=null===(p=null==v?void 0:v.layer)||void 0===p?void 0:p.networkInfo)||void 0===m?void 0:m.routeIdFieldSchema)||void 0===y?void 0:y.name]).then((r=>{var s,c,f,h,p,m,y,S,b,I,x,j,R,k,M,C,L,G,N,F,P,T,E,O,A,U,W,H,z,B,_,Z,Q,J,K,$,q,X,ee,te,ie,le,oe,ne,ae,de,re,ue,se;const ve=[];r.forEach((e=>{var t,i;ve.push(Y(e,null===(i=null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.networkInfo)||void 0===i?void 0:i.measurePrecision))}));const ce={objectIdFieldName:null===(c=null===(s=null==v?void 0:v.layer)||void 0===s?void 0:s.networkInfo)||void 0===c?void 0:c.objectIdFieldName,ds:t,featureDS:a,supportsLines:null===(h=null===(f=null==v?void 0:v.layer)||void 0===f?void 0:f.networkInfo)||void 0===h?void 0:h.supportsLines,routeId:V[null===(y=null===(m=null===(p=null==v?void 0:v.layer)||void 0===p?void 0:p.networkInfo)||void 0===m?void 0:m.routeIdFieldSchema)||void 0===y?void 0:y.name],routeIdFieldName:null===(I=null===(b=null===(S=null==v?void 0:v.layer)||void 0===S?void 0:S.networkInfo)||void 0===b?void 0:b.routeIdFieldSchema)||void 0===I?void 0:I.name,routeName:V[null===(R=null===(j=null===(x=null==v?void 0:v.layer)||void 0===x?void 0:x.networkInfo)||void 0===j?void 0:j.routeNameFieldSchema)||void 0===R?void 0:R.name],routeNameFieldName:null===(C=null===(M=null===(k=null==v?void 0:v.layer)||void 0===k?void 0:k.networkInfo)||void 0===M?void 0:M.routeNameFieldSchema)||void 0===C?void 0:C.name,lineOrderFieldName:null===(G=null===(L=null==v?void 0:v.layer)||void 0===L?void 0:L.networkInfo)||void 0===G?void 0:G.lineOrderFieldName,fromDate:V[null===(P=null===(F=null===(N=null==v?void 0:v.layer)||void 0===N?void 0:N.networkInfo)||void 0===F?void 0:F.fromDateFieldSchema)||void 0===P?void 0:P.name],toDate:V[null===(O=null===(E=null===(T=null==v?void 0:v.layer)||void 0===T?void 0:T.networkInfo)||void 0===E?void 0:E.toDateFieldSchema)||void 0===O?void 0:O.name],selectedPoint:n,selectedPolyline:e.geometry,validRoute:!0,measureUnit:(0,d.GetUnits)(null===(U=null===(A=null==v?void 0:v.layer)||void 0===A?void 0:A.networkInfo)||void 0===U?void 0:U.unitsOfMeasure,l),timeDependedInfo:[{objectId:V[null===(H=null===(W=null==v?void 0:v.layer)||void 0===W?void 0:W.networkInfo)||void 0===H?void 0:H.objectIdFieldName],fromDate:V[null===(_=null===(B=null===(z=null==v?void 0:v.layer)||void 0===z?void 0:z.networkInfo)||void 0===B?void 0:B.fromDateFieldSchema)||void 0===_?void 0:_.name],toDate:V[null===(J=null===(Q=null===(Z=null==v?void 0:v.layer)||void 0===Z?void 0:Z.networkInfo)||void 0===Q?void 0:Q.toDateFieldSchema)||void 0===J?void 0:J.name],fromMeasure:Y(g,null===($=null===(K=null==v?void 0:v.layer)||void 0===K?void 0:K.networkInfo)||void 0===$?void 0:$.measurePrecision),toMeasure:Y(w,null===(X=null===(q=null==v?void 0:v.layer)||void 0===q?void 0:q.networkInfo)||void 0===X?void 0:X.measurePrecision),selectedMeasures:ve,attributes:V}],fieldInfos:null==u?void 0:u.fields};if(null==i?void 0:i.includes(null===(ee=null==v?void 0:v.layer)||void 0===ee?void 0:ee.serviceId)){const e=o.find((e=>{var t;return e.id===(null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.serviceId)})),t=null==e?void 0:e.routes;let i=!1;t.forEach((e=>{var t,o,n,a,r,u,s,c,f,h,p,m,y,S;if((null==e?void 0:e.routeId)===V[null==v?void 0:v.routeIdFieldName]){i=!0;const b=e;b.timeDependedInfo.push({objectId:V[null===(o=null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.networkInfo)||void 0===o?void 0:o.objectIdFieldName],measureUnit:(0,d.GetUnits)(null===(a=null===(n=null==v?void 0:v.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.unitsOfMeasure,l),fromMeasure:Y(g,null===(u=null===(r=null==v?void 0:v.layer)||void 0===r?void 0:r.networkInfo)||void 0===u?void 0:u.measurePrecision),toMeasure:Y(w,null===(c=null===(s=null==v?void 0:v.layer)||void 0===s?void 0:s.networkInfo)||void 0===c?void 0:c.measurePrecision),selectedMeasures:ve,fromDate:V[null===(p=null===(h=null===(f=null==v?void 0:v.layer)||void 0===f?void 0:f.networkInfo)||void 0===h?void 0:h.fromDateFieldSchema)||void 0===p?void 0:p.name],toDate:V[null===(S=null===(y=null===(m=null==v?void 0:v.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.toDateFieldSchema)||void 0===S?void 0:S.name],attributes:V}),b.timeDependedInfo.sort(((e,t)=>e.fromDate-t.fromDate))}})),i||null===(te=null==e?void 0:e.routes)||void 0===te||te.push(ce)}else{const e={id:null===(ie=null==v?void 0:v.layer)||void 0===ie?void 0:ie.serviceId,networkId:null===(oe=null===(le=null==v?void 0:v.layer)||void 0===le?void 0:le.networkInfo)||void 0===oe?void 0:oe.lrsNetworkId,layerName:null===(ne=null==v?void 0:v.layer)||void 0===ne?void 0:ne.name,configFields:null===(de=null===(ae=null==v?void 0:v.layer)||void 0===ae?void 0:ae.networkInfo)||void 0===de?void 0:de.attributeFields,useFieldAlias:null===(ue=null===(re=null==v?void 0:v.layer)||void 0===re?void 0:re.networkInfo)||void 0===ue?void 0:ue.useFieldAlias,routes:[ce]};o.push(e),i.push(null===(se=null==v?void 0:v.layer)||void 0===se?void 0:se.serviceId)}D.push(ce)}))}))))}))))}else(null===(w=null===(m=null==v?void 0:v.layer)||void 0===m?void 0:m.layerType)||void 0===w?void 0:w.toLocaleLowerCase())===s.event.toLocaleLowerCase()&&S.push({parentNetworkId:null===(I=null===(b=null==v?void 0:v.layer)||void 0===b?void 0:b.eventInfo)||void 0===I?void 0:I.parentNetworkId,attributes:V,attributeSets:null==f?void 0:f.attributeSets,defaultLineAttributeSet:null==f?void 0:f.defaultLineAttrbuteSet,defaultPointAttributeSet:null==f?void 0:f.defaultPointAttributeSet,eventLayerId:null===(x=null==v?void 0:v.layer)||void 0===x?void 0:x.serviceId,fromDate:null===(R=null===(j=null==v?void 0:v.layer)||void 0===j?void 0:j.eventInfo)||void 0===R?void 0:R.fromDateFieldName,toDate:null===(M=null===(k=null==v?void 0:v.layer)||void 0===k?void 0:k.eventInfo)||void 0===M?void 0:M.toDateFieldName,fieldInfos:null==u?void 0:u.fields,routeIdFieldName:null===(L=null===(C=null==v?void 0:v.layer)||void 0===C?void 0:C.eventInfo)||void 0===L?void 0:L.routeIdFieldName,toRouteIdFieldName:null===(N=null===(G=null==v?void 0:v.layer)||void 0===G?void 0:G.eventInfo)||void 0===N?void 0:N.toRouteIdFieldName,canSpanRoutes:null===(P=null===(F=null==v?void 0:v.layer)||void 0===F?void 0:F.eventInfo)||void 0===P?void 0:P.canSpanRoutes})})))))})))).finally((()=>{c&&(u.popupEnabled=!1),x.current=!1})).catch((e=>{console.error(e)}))}}))))).then((()=>{t.setRouteDetails(o),t.setEventDetails(S)}))}));return(0,e.jsx)("div",{css:ee},(0,e.jsx)(i.Button,{className:a?"route-picker-btn":"route-picker-btn-disabled",size:"sm",tabIndex:-1,type:"tertiary",icon:!0,disabled:!n,onClick:()=>{m(),g(),y(),C(),w(!j),R(!j),j||(t.setRouteDetails([]),t.setEventDetails([]))}},(0,e.jsx)(i.Icon,{size:"m",icon:o(),className:"border-0"})))}const ie="#008000";var le=v(99037),oe=v(22089);const ne=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}];var ae=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};function de(l){var o;const{intl:n,widgetId:a,config:r,outputDS:u,networkLayers:s,selectedLocationInfo:v,eventDetails:c,jimuMapView:f,allDataSources:h,measuresOids:p,isNetworkChange:m,onRouteInfoUpdated:y,clearPickedGraphic:g,handleSelectedNetworkChange:w}=l,S=e.React.useRef(null),[b,D]=e.React.useState(!0),[I,x]=e.React.useState({x:0,y:0}),[j,R]=e.React.useState({width:400,height:500}),[k,M]=e.React.useState(null),[C,L]=e.React.useState(),[G,N]=e.React.useState(),[F,P]=e.React.useState(0),[T,E]=e.React.useState(null),[O,A]=e.React.useState(null),[V,U]=e.React.useState(null),W=C&&(null==C?void 0:C[F]),H=null==r?void 0:r.lineEventToggle,z=null==r?void 0:r.pointEventToggle,B=e.hooks.useTranslation(t);e.React.useEffect((()=>{var e,t,i,o;const n=v,a=null==f?void 0:f.view.toScreen(n.routes[0].selectedPoint);if(v&&(D(!0),S.current=n,a&&!m)){const e=I;e.x=a.x+16,e.y=a.y+16;const t=q(a.x,a.y,null==f?void 0:f.view);t&&(e.x=t.x+16,e.y=t.y+16),x(e)}(()=>{ae(this,void 0,void 0,(function*(){var e,t,i,o,n,d,r,c,f,h;const m=null===(t=null===(e=null==v?void 0:v.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.objectIdFieldName;try{const e=l.dataRecords,t=[];e.forEach(((e,i)=>{var l;const o=null===(l=s[i])||void 0===l?void 0:l.id;t[o]=e})),U(t);const y=[].concat.apply([],t[null==v?void 0:v.id]),g=[];u&&(null==y||y.forEach((e=>{var t,i;const l=p[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[m]],o=_(a,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);g.push(n)})));const w=null===(n=null===(o=null===(i=null==v?void 0:v.routes)||void 0===i?void 0:i[0])||void 0===o?void 0:o.timeDependedInfo)||void 0===n?void 0:n[0].objectId,S=null===(f=null===(c=null===(r=null===(d=null==v?void 0:v.routes)||void 0===d?void 0:d[0])||void 0===r?void 0:r.timeDependedInfo)||void 0===c?void 0:c[0])||void 0===f?void 0:f.selectedMeasures[0];E([].concat.apply([],e));const b=Q(y,w,m),D=_(a,null===(h=null==b?void 0:b.feature)||void 0===h?void 0:h.attributes,S),I=null==u?void 0:u.buildRecord(D);A(I),Z(g,I,w)}catch(e){console.error("Error fetching data:",e)}}))})(),P(0),M(n),w(n,!1),L(null==n?void 0:n.routes),N(null===(i=null===(t=null===(e=null==n?void 0:n.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.timeDependedInfo)||void 0===i?void 0:i[0]),y(null===(o=null==n?void 0:n.routes)||void 0===o?void 0:o[0],!0)}),[null==f?void 0:f.view,v,s,u]);const _=(e,t,i)=>{i&&(t[ne.at(0).value]=i);return new oe.default({geometry:f.view.toMap(e),attributes:t})},Z=(t,i,l)=>{null==u||u.clearRecords(),null==u||u.clearSelection(),null==u||u.setCountStatus(e.DataSourceStatus.NotReady),null==u||u.setStatus(e.DataSourceStatus.NotReady),null==u||u.setStatus(e.DataSourceStatus.Unloaded),null==u||u.setCountStatus(e.DataSourceStatus.Unloaded),null==u||u.setSourceRecords(t),null==u||u.setRecords(t),null==u||u.selectRecordById(l),$(u,a)},Q=(e,t,i)=>{for(let l=0;l<(null==e?void 0:e.length);l++){if(e[l].getData()[i]===t)return e[l]}},J=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[a].enableDataAction)||void 0===t||t})),K=e.React.useMemo((()=>({dataSource:u,type:"selected",records:[O],name:null==k?void 0:k.layerName})),[u,O,k]),$=(t,i)=>{if(!t)return;const l=t.getOriginDataSources()[0],o=l.getPopupInfo(),n=l.getLayerDefinition(),a=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==o?void 0:o.fieldInfos)||[]).filter((e=>e.visible))),d=new e.DataRecordSetChangeMessage(i,e.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:a.map((e=>e.fieldName)),dataSource:t,name:t.id}]);e.MessageManager.getInstance().publishMessage(d)},q=(e,t,i)=>{if(!i)return;const l=j.width,o=j.height;return e>=0&&t>=0&&e+l<=window.innerWidth&&t+o<=window.innerHeight?null:(e+l>window.innerWidth&&(e=window.innerWidth-l),t+o>window.innerHeight&&(t=window.innerHeight-o),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},Y=e.React.useCallback((e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,l=null==s?void 0:s.find((e=>e.id===i)),o=V[i];null==s||s.forEach(((e,t)=>ae(this,void 0,void 0,(function*(){var t,n,a,d,r,s,c,h,m,g,S,b,D,I,x,j;if((null==e?void 0:e.id)===i){const R=null===(d=null===(a=null===(n=null===(t=null==e?void 0:e.routes)||void 0===t?void 0:t[0])||void 0===n?void 0:n.timeDependedInfo)||void 0===a?void 0:a[0])||void 0===d?void 0:d.objectId,k=null===(m=null===(h=null===(c=null===(s=null===(r=null==e?void 0:e.routes)||void 0===r?void 0:r[0])||void 0===s?void 0:s.timeDependedInfo)||void 0===c?void 0:c[0])||void 0===h?void 0:h.selectedMeasure)||void 0===m?void 0:m[0],C=null===(S=null===(g=null==e?void 0:e.routes)||void 0===g?void 0:g[0])||void 0===S?void 0:S.objectIdFieldName,G=Q(T,R,C),F=_(null==f?void 0:f.view.toScreen(null==e?void 0:e.routes[0].selectedPoint),null===(b=null==G?void 0:G.feature)||void 0===b?void 0:b.attributes,k),E=null==u?void 0:u.buildRecord(F);M(l),w(l,!0),L(null==e?void 0:e.routes),N(null===(x=null===(I=null===(D=null==e?void 0:e.routes)||void 0===D?void 0:D[0])||void 0===I?void 0:I.timeDependedInfo)||void 0===x?void 0:x[0]),P(0),y(null===(j=null==e?void 0:e.routes)||void 0===j?void 0:j[0],!0),A(E);const O=[].concat.apply([],o),V=[],U=null==f?void 0:f.view.toScreen(v.routes[0].selectedPoint);u&&(null==O||O.forEach((e=>{var t,i;const l=p[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[C]],o=_(U,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);V.push(n)}))),Z(V,E,i)}}))))}),[T,w,V,y,u,v,a]),X=e.React.useCallback((e=>{x(e)}),[]),ee=e.React.useCallback(((e,t)=>{R(e),x(t)}),[]),te=(e,t,i)=>{const l=null==i?void 0:i.find((t=>t.name===e));if((0,d.isDefined)(l)&&(0,d.isDefined)(l.domain)&&"coded-value"===l.domain.type){const e=l.domain.codedValues.find((e=>"string"==typeof e.code&&"string"==typeof t?e.code.toLowerCase()===t.toLowerCase():e.code===t));if(e)return`${e.code} - ${e.name}`}},ie=e=>{if(!k)return;const t=864e13,i=-864e13,l=[],o=null==k?void 0:k.networkId,n=null!==(null==G?void 0:G.fromDate)?null==G?void 0:G.fromDate:i,a=null!==(null==G?void 0:G.toDate)?null==G?void 0:G.toDate:t;return c.sort(((e,t)=>{const i=null==e?void 0:e.attributes,l=null==t?void 0:t.attributes;return i[e.fromDate]-l[t.fromDate]})),null==c||c.forEach((r=>{var u,s,v,c,f,p,m,y,g,w;const S=null==r?void 0:r.fieldInfos,b=null==r?void 0:r.attributes,D=null==r?void 0:r.fromDate,I=null==r?void 0:r.toDate,x=b[null==r?void 0:r.routeIdFieldName],j=b[D],R=(0,d.isDefined)(j)?(0,d.getDateWithTZOffset)(j,k.routes[F].ds).toLocaleDateString():B("nullStr"),M=b[I],L=(0,d.isDefined)(M)?(0,d.getDateWithTZOffset)(M,k.routes[F].ds).toLocaleDateString():B("nullStr");let N=null==r?void 0:r.defaultLineAttributeSet;"point"===e&&(N=null==r?void 0:r.defaultPointAttributeSet);let P=!1;if((null==r?void 0:r.parentNetworkId)===o)if("line"===e&&k&&(null===(u=C[F])||void 0===u?void 0:u.supportsLines)&&(null==r?void 0:r.canSpanRoutes)){const e=null===(v=null===(s=null==k?void 0:k.routes)||void 0===s?void 0:s[F])||void 0===v?void 0:v.routeIdFieldName,t=r.routeIdFieldName,i=r.toRouteIdFieldName,l=null===(f=null===(c=null==k?void 0:k.routes)||void 0===c?void 0:c[F])||void 0===f?void 0:f.lineOrderFieldName,o=null===(y=null===(m=null===(p=null==k?void 0:k.routes)||void 0===p?void 0:p[F])||void 0===m?void 0:m.records)||void 0===y?void 0:y.records;if(o){const n=null==G?void 0:G.attributes[l],a=o.find((i=>i.feature.attributes[e]===r.attributes[t]));o.find((t=>t.feature.attributes[e]===r.attributes[i])).feature.attributes[l]>=n&&n>=a.feature.attributes[l]&&(P=!0)}}else(null==r?void 0:r.parentNetworkId)===o&&(null===(g=C[F])||void 0===g?void 0:g.routeId)===x&&(P=!0);if(P){const e=null===(w=r.attributeSets)||void 0===w?void 0:w.attributeSet.find((e=>e.title===N)),o=null==e?void 0:e.layers;null==o||o.forEach((e=>{const o=[],u=(e=>{const t=h.find((t=>{var i,l;return(null===(l=null===(i=null==t?void 0:t.getLayerDefinition)||void 0===i?void 0:i.call(t))||void 0===l?void 0:l.id)===(null==e?void 0:e.layerId)}));return t})(e);if(u){const s=(null==u?void 0:u.layer).fields,v=null!==b[D]?b[D]:i,c=null!==b[I]?b[I]:t;if((null==e?void 0:e.layerId)===r.eventLayerId&&(n<=v<=a||n<=c<=a)){(null==e?void 0:e.fields).forEach((t=>{const i=s.find((e=>e.name===t.name)),l=null==t?void 0:t.name,n=null==i?void 0:i.type,a=te(l,b[l],S);let r;a?r=a:(r=b[l],"date"===(null==n?void 0:n.toLowerCase())&&(r=(0,d.isDefined)(r)?(0,d.getDateWithTZOffset)(r,k.routes[F].ds).toLocaleDateString():null)),"date"===(null==n?void 0:n.toLowerCase())&&(r=(0,d.isDefined)(r)?(0,d.getDateWithTZOffset)(r,k.routes[F].ds).toLocaleDateString():null),o.push({name:l,val:r,layerName:null==e?void 0:e.layerName,fromDate:R,toDate:L})})),l.push(re(o)),l.push(de())}}else;}))}})),l},de=()=>(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}}),re=t=>{var l,o,a;const r=null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.fromDate,u=null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.toDate,s=(null===(a=null==t?void 0:t[0])||void 0===a?void 0:a.layerName)+" ("+r+" - "+u+")";return(0,e.jsx)(i.CollapsablePanel,{label:s,level:0,type:"default"},(0,e.jsx)(le.CalciteTable,{className:"w-100 h-100",caption:B("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)(le.CalciteTableRow,null,(0,e.jsx)(le.CalciteTableHeader,{heading:(0,d.formatMessage)(n,"attribute")}),(0,e.jsx)(le.CalciteTableHeader,{heading:(0,d.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(le.CalciteTableRow,null,(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))},ue=()=>{var t;return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("dateStr"))),(0,e.jsx)("div",null,(0,e.jsx)(i.Select,{size:"sm",value:G,onChange:e=>{(e=>{var t,i,l,o,n;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;N(a);const d=null==a?void 0:a.objectId,r=null===(l=null===(i=null==v?void 0:v.routes)||void 0===i?void 0:i[F])||void 0===l?void 0:l.objectIdFieldName,s=Q(T,d,r),c=null===(o=null==a?void 0:a.selectedMeasures)||void 0===o?void 0:o[0],h=_(null==f?void 0:f.view.toScreen(null==v?void 0:v.routes[F].selectedPoint),null===(n=null==s?void 0:s.feature)||void 0===n?void 0:n.attributes,c),p=null==u?void 0:u.buildRecord(h);A(p)})(e)}},null===(t=null==W?void 0:W.timeDependedInfo)||void 0===t?void 0:t.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.fromDate,value:t,label:t.fromDate},(0,e.jsx)("span",null,(0,d.isDefined)(t.fromDate)?(0,d.getDateWithTZOffset)(t.fromDate,k.routes[F].ds).toLocaleDateString():B("nullStr")),(0,e.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"}},B("toStr")),(0,e.jsx)("span",null,(0,d.isDefined)(t.toDate)?(0,d.getDateWithTZOffset)(t.toDate,k.routes[F].ds).toLocaleDateString():B("nullStr"))))))))},se=e=>ie(e);return(0,e.jsx)("div",{style:{position:"relative"}},b&&v&&(0,e.jsx)(i.FloatingPanel,{headerTitle:B("identifyResults"),size:j,defaultPosition:I,position:I,disableActivateOverlay:!1,dragBounds:"body",onDrag:X,onResize:ee,onHeaderClose:()=>{g(),D(!1)}},(0,e.jsx)("div",{css:(0,d.getCalciteBasicTheme)()},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"10px",overflowY:"scroll",height:"inherit"}},J&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(i.DataActionList,{widgetId:a,dataSets:[K],listStyle:i.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"}))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("networkLabel"))),(0,e.jsx)("div",{style:{width:"50%"}},k&&(0,e.jsx)(i.Select,{size:"sm",value:k.id,onChange:Y},s.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.layerName,value:t.id,label:t.layerName},t.layerName)))))),W&&(t=>{var l,o;const a=((e,t,i)=>{if(!k)return;const l=[null==i?void 0:i.routeIdFieldName,null==i?void 0:i.routeNameFieldName],o=k?k.configFields:null,n=k?k.useFieldAlias:null,a=[];return(null==o?void 0:o.length)>0&&e&&o.forEach((i=>{var o,r,u,s,v;const c=null==i?void 0:i.enabled;let f=null===(o=null==i?void 0:i.field)||void 0===o?void 0:o.name;if(c&&!l.includes(f)){const l=te(f,e[null===(r=null==i?void 0:i.field)||void 0===r?void 0:r.name],t);n&&(f=null===(u=null==i?void 0:i.field)||void 0===u?void 0:u.alias);const o=null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.type;let c;l?c=l:(c=e[null===(v=null==i?void 0:i.field)||void 0===v?void 0:v.name],"date"===(null==o?void 0:o.toLowerCase())&&(c=(0,d.isDefined)(c)?(0,d.getDateWithTZOffset)(c,k.routes[F].ds).toLocaleDateString():null)),f&&a.push({name:f,val:c})}})),a})(null==G?void 0:G.attributes,null==t?void 0:t.fieldInfos,t),r=se("line"),u=se("point"),s=(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},t.routeId&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingTop:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%",flex:"none"}},(0,e.jsx)(i.Label,null,B("routeId"))),(0,e.jsx)("div",{title:t.routeId,style:{width:"fitContent",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},t.routeId)),t.routeName&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("routeName"))),(0,e.jsx)("div",null,t.routeName)),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("measureLabel"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,null===(l=G.selectedMeasures)||void 0===l?void 0:l[0]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),(null===(o=G.selectedMeasures)||void 0===o?void 0:o.length)>1&&(()=>{const t=null==G?void 0:G.selectedMeasures,i=[];for(let l=1;l<t.length;l++)i.push((0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%"}}),(0,e.jsx)("span",null,t[l]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit)));return i})(),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("startMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,G.fromMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,B("endMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null," ",G.toMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),ue(),a&&(null==a?void 0:a.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},(t=>(0,e.jsx)(le.CalciteTable,{className:"w-100 h-100",caption:B("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)("calcite-table-row",{slot:"table-header"},(0,e.jsx)("calcite-table-header",{heading:(0,d.formatMessage)(n,"attribute")}),(0,e.jsx)("calcite-table-header",{heading:(0,d.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(le.CalciteTableRow,{key:i},(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))(a)),H&&(null==r?void 0:r.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"1.5rem"}},B("lineEvent"),r),z&&(null==u?void 0:u.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},B("pointEvent"),u));return s})(W)),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",paddingBottom:"0.5rem",paddingTop:"0.5rem"}},(0,e.jsx)(i.Pagination,{current:F+1,onChangePage:e=>{(e=>{var t,i,l,o,n,a,d,r,s,c,h,p,m,w,S,b;g();const D=e-1,I=null===(o=null===(l=null===(i=null===(t=null==v?void 0:v.routes)||void 0===t?void 0:t[D])||void 0===i?void 0:i.timeDependedInfo)||void 0===l?void 0:l[0])||void 0===o?void 0:o.objectId,x=null===(a=null===(n=null==v?void 0:v.routes)||void 0===n?void 0:n[0])||void 0===a?void 0:a.objectIdFieldName,j=Q(T,I,x),R=null===(h=null===(c=null===(s=null===(r=null===(d=null==v?void 0:v.routes)||void 0===d?void 0:d[D])||void 0===r?void 0:r.timeDependedInfo)||void 0===s?void 0:s[0])||void 0===c?void 0:c.selectedMeasures)||void 0===h?void 0:h[0],k=_(null==f?void 0:f.view.toScreen(null==v?void 0:v.routes[D].selectedPoint),null===(p=null==j?void 0:j.feature)||void 0===p?void 0:p.attributes,R),M=null==u?void 0:u.buildRecord(k);P(D),N(null===(S=null===(w=null===(m=null==v?void 0:v.routes)||void 0===m?void 0:m[D])||void 0===w?void 0:w.timeDependedInfo)||void 0===S?void 0:S[0]),A(M),y(null===(b=null==v?void 0:v.routes)||void 0===b?void 0:b[D],!0)})(e)},simple:!0,size:"sm",totalPage:null===(o=null==k?void 0:k.routes)||void 0===o?void 0:o.length})))))}var re=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};var ue=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};function se(t){const{widgetId:i,intl:l,lrsLayers:o,JimuMapView:n,defaultShowPp:a,hoverGraphic:r,config:s,onClearFlashGraphics:v,onClearPickedGraphics:c,onUpdateGraphics:f,flashSelectedGeometry:h}=t,[p,m]=e.React.useState(!1),[y,g]=e.React.useState(!1),[w,S]=e.React.useState(null),[b,D]=e.React.useState(null),[I,x]=e.React.useState(null),[j,R]=e.React.useState(null),[k,M]=e.React.useState(null),[C,L]=e.React.useState(null),[G,N]=e.React.useState(!1),[F,P]=e.React.useState(null),[T,E]=e.React.useState(!0),[O,A]=e.React.useState(null),V=e.React.useCallback((e=>{m(e)}),[m]),U=e.React.useCallback((e=>{R(e)}),[R]),W=(e,...t)=>ue(this,[e,...t],void 0,(function*(e,t=!1){const i=s.highlightStyle.routeColor,l=s.highlightStyle.width;(0,d.isDefined)(e.selectedPolyline)&&t&&h(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),i,l)),(0,d.isDefined)(e.selectedPoint)?f(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),ie)):c(),n.clearSelectedFeatures()}));return(0,e.jsx)("div",null,(0,e.jsx)(u,{selectedNetwork:b,onCreatePointDs:e=>{S(e)},lrsLayers:o,dataSourcesReady:V,handleSetDataSources:U}),(0,e.jsx)(te,{intl:l,isReady:p,active:G,allDataSources:j,lrsLayers:o,jimuMapView:n,symbolColor:null,hoverGraphic:r,onActiveChange:()=>{var e;const t=!G;N(t),t?((null===(e=null==n?void 0:n.view)||void 0===e?void 0:e.popupEnabled)&&(n.view.popupEnabled=!1),v(),c()):n.view.popupEnabled=a},onRouteInfoUpdated:W,clearPickedGraphic:c,clearFlashGraphic:v,setRouteDetails:e=>ue(this,void 0,void 0,(function*(){const t=[],i={};e.forEach((e=>ue(this,void 0,void 0,(function*(){var l,o,n,a,d;const r=[];null===(l=null==e?void 0:e.routes)||void 0===l||l.forEach((e=>{var t;null===(t=null==e?void 0:e.timeDependedInfo)||void 0===t||t.forEach((e=>{var t;const l=null==e?void 0:e.objectId;r.push(l),i[l]=null===(t=null==e?void 0:e.selectedMeasures)||void 0===t?void 0:t[0]}))})),t.push(function(e,t,i){return re(this,void 0,void 0,(function*(){var l;if(!e||0===e.length||!t)return[];const o={where:t+" IN ("+e.join(",")+")",outFields:["*"],returnGeometry:!0},n=yield i.query(o);return 0===(null===(l=null==n?void 0:n.records)||void 0===l?void 0:l.length)?[]:null==n?void 0:n.records}))}(r,null===(n=null===(o=null==e?void 0:e.routes)||void 0===o?void 0:o[0])||void 0===n?void 0:n.objectIdFieldName,null===(d=null===(a=null==e?void 0:e.routes)||void 0===a?void 0:a[0])||void 0===d?void 0:d.featureDS))}))));const l=yield Promise.all(t);A(i),P(l),(e=>{let t=e.find((e=>(null==s?void 0:s.defaultNetworkLayer)===(null==e?void 0:e.id)));t||(t=e[0]);const i=o.find((e=>{var i;return(null===(i=null==e?void 0:e.layerInfo)||void 0===i?void 0:i.serviceId)===(null==t?void 0:t.id)}));x(t),D(null==i?void 0:i.networkInfo),g(!1)})(e),M(e)})),setEventDetails:e=>{L(e)},eventDataRecords:[],config:s,handleShowPp:e=>{E(e)}}),k&&k.length>0&&F.length>0&&T&&(0,e.jsx)(de,{intl:l,allDataSources:j,eventDetails:C,jimuMapView:n,onRouteInfoUpdated:W,clearPickedGraphic:c,config:s,isNetworkChange:y,widgetId:i,outputDS:w,dataRecords:F,measuresOids:O,selectedLocationInfo:I||k[0],networkLayers:k,handleSelectedNetworkChange:(e,t)=>{const i=o.find((t=>{var i;return(null===(i=null==t?void 0:t.layerInfo)||void 0===i?void 0:i.serviceId)===(null==e?void 0:e.id)})),l=k.find((t=>t.id===(null==e?void 0:e.id)));x(l),D(null==i?void 0:i.networkInfo),g(t)}}))}var ve=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};class ce extends e.React.PureComponent{constructor(l){super(l),this.clearPickedGraphics=()=>{(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll()},this.clearFlashGraphic=()=>{(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()},this.updatePickedGraphic=e=>{(0,d.isDefined)(e)?(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.add(e)):this.clearPickedGraphics()},this.flashSelectedGeometry=e=>{(0,d.isDefined)(e)&&(this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll()}),800)}),800)}),800)}),800)}),800))},this.updateGraphics=(e,t)=>ve(this,void 0,void 0,(function*(){(0,d.isDefined)(e.selectedPolyline)&&t&&this.flashSelectedGeometry(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF")),(0,d.isDefined)(e.selectedPoint)?this.updatePickedGraphic(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),ie)):this.clearPickedGraphics()})),this.onActiveViewChange=e=>ve(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>ve(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const i=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==i?void 0:i.isDataSourceSet())&&!i.areChildDataSourcesCreated()?i.childDataSourcesReady().then((()=>i)).catch((e=>i)):Promise.resolve(i)})),this.getI18nMessage=(e,l)=>{const o=Object.assign({},t,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},l)},this.state={jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,t){t.jimuMapView!==this.state.jimuMapView&&(0,d.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,d.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,d.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,d.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,d.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const i=new a.default({listMode:"hide"}),l=new a.default({listMode:"hide"}),o=new a.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([l,o,i]),this.setState({hoverGraphic:i}),this.setState({pickedGraphic:l}),this.setState({flashGraphic:o})}}clearGraphics(){(0,d.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}render(){var t,l;const{config:a,id:d}=this.props,{lrsLayers:r,networkLayers:u}=a,{jimuMapView:s}=this.state;return u&&0!==(null==u?void 0:u.length)?(0,e.jsx)("div",{css:e.css`
    min-width: 32px;
    min-height: 32px;
  `},(0,e.jsx)(n.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(se,{intl:this.props.intl,widgetId:d,lrsLayers:r,config:a,JimuMapView:s,hoverGraphic:this.state.hoverGraphic,onClearPickedGraphics:this.clearPickedGraphics.bind(this),onClearFlashGraphics:this.clearFlashGraphic.bind(this),onUpdateGraphics:this.updatePickedGraphic.bind(this),flashSelectedGeometry:this.flashSelectedGeometry.bind(this),defaultShowPp:null===(l=null==s?void 0:s.view)||void 0===l?void 0:l.popupEnabled})):(0,e.jsx)(i.WidgetPlaceholder,{icon:o(),widgetId:d,message:this.getI18nMessage("_widgetLabel")})}}function fe(e){v.p=e}})(),c})())}}}));