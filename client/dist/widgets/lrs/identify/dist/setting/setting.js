System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-core/react","widgets/shared-code/lrs","jimu-ui/basic/color-picker"],(function(e,t){var i={},n={},o={},a={},r={},s={},l={};return{setters:[function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.SessionManager=e.SessionManager,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.NumericInput=e.NumericInput,n.Select=e.Select,n.Switch=e.Switch,n.TextInput=e.TextInput,n.defaultMessages=e.defaultMessages},function(e){o.MapWidgetSelector=e.MapWidgetSelector,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection,o.SidePopper=e.SidePopper,o.getOutputJsonOriginDs=e.getOutputJsonOriginDs},function(e){a.List=e.List,a.TreeItemActionType=e.TreeItemActionType},function(e){r.Fragment=e.Fragment},function(e){s.errorMessageDelay=e.errorMessageDelay,s.formatMessage=e.formatMessage,s.getFeatureLayer=e.getFeatureLayer,s.isDefined=e.isDefined,s.requestService=e.requestService},function(e){l.ColorPicker=e.ColorPicker}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=o},54337:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=a},47626:e=>{"use strict";e.exports=s}},t={};function d(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,d),o.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>j,default:()=>D});var e,t,i=d(79244),n=d(14321);!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(e||(e={})),function(e){e.measure="ROUTEANDMEASURE",e.coordinate="COORDINATE",e.locationOffset="LOCATIONOFFSET"}(t||(t={}));const o={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer configuration",importAll:"Import all",selectMap:"Select Map",noNetworksTips:"The Map does not contain any LRS networks.",networkConfig:"Network Configuration",networkLabel:"Label",routeIdentifier:"Identifier",routeId:"Route ID",routeName:"Route name",multiField:"Multi field",searchMethod:"Search methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection Settings",results:"Results",sortResults:"Sort results by:",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",showEventInfo:"Show Event Information",eventAttrSet:"Event Attribute Set",configureFields:"Configure Fields",useFieldAlias:"Use field alias",loadLayers:"Load Layers",clearLayers:"Clear Layers",defaultNetwork:"Default Network",missingParentNetwork:"Missing Parent Network",lineAttributeToggle:"Show Line Events",lineAttributeSet:"Line Attribute Set",pointAttributeToggle:"Show Point Events",pointAttributeSet:"Point Attribute Set"};var a=d(79298),r=d(98640),s=d(68972),l=d(28996),c=d.n(l),p=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const g=e=>{const t=window.SVG,{className:n}=e,o=p(e,["className"]),a=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:a,src:c()},o)):i.React.createElement("svg",Object.assign({className:a},o))};var m=d(31027),h=d.n(m),f=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const v=e=>{const t=window.SVG,{className:n}=e,o=f(e,["className"]),a=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:a,src:h()},o)):i.React.createElement("svg",Object.assign({className:a},o))};function y(t){var s;const{widgetId:l,index:d,lrsLayer:u,onLayerChanged:c}=t,[p,g]=i.React.useState(null==u?void 0:u.name),m=function(e){const{widgetId:t,useDataSourceId:n}=e;return i.ReactRedux.useSelector((e=>{var i;let o;return o=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(i=o.widgets[t].useDataSources)&&void 0!==i?i:[]).some((e=>e.dataSourceId===n))}))}({widgetId:l,useDataSourceId:null===(s=null==u?void 0:u.useDataSource)||void 0===s?void 0:s.dataSourceId}),h=i.hooks.useTranslation(o);i.React.useEffect((()=>{(null==u?void 0:u.name)&&p!==(null==u?void 0:u.name)&&g(null==u?void 0:u.name)}),[null==u?void 0:u.name]);const f=i.React.useCallback(((e,t,i=!1)=>{let n;n=null==t?u.without(e):u.set(e,t),c(d,n,i)}),[c,d,u]),v=i.React.useCallback(((e,t,i=!1)=>{const n=u.eventInfo.set(e,t),o=u.set("eventInfo",n);c(d,o,i)}),[c,d,u]),y=i.React.useCallback(((e,t,i=!1)=>{const n=u.networkInfo.set(e,t),o=u.set("networkInfo",n);c(d,o,i)}),[c,d,u]),S=i.React.useCallback((e=>{g(e.target.value)}),[]),I=i.React.useCallback((e=>{e.trim().length>0?f("name",e,!0):g(null==u?void 0:u.name)}),[null==u?void 0:u.name,f]),b=(t,i)=>{f("useFieldAlias",i,!1),u.layerType===e.network&&y("useFieldAlias",i)},w=t=>u.layerType===e.network?u.networkInfo.attributeFields[t].enabled:u.layerType===e.event?u.eventInfo.attributeFields[t].enabled:void 0,N=t=>{if(u.layerType===e.event){const e=u.eventInfo.attributeFields.asMutable({deep:!0});e[t].enabled=!e[t].enabled,v("attributeFields",e,!0)}else if(u.layerType===e.network){const e=u.networkInfo.attributeFields.asMutable({deep:!0});e[t].enabled=!e[t].enabled,y("attributeFields",e,!0)}},L={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:r.TreeItemActionType.RenderOverrideItem,children:[{name:r.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:r.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemBody,children:[{name:r.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:r.TreeItemActionType.RenderOverrideItemDragHandle},{name:r.TreeItemActionType.RenderOverrideItemDetailToggle},{name:r.TreeItemActionType.RenderOverrideItemTitle},{name:r.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},x=()=>(0,i.jsx)("div",{css:i.css`height: 100%; overflow:auto;`},u&&m&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(a.SettingSection,{role:"group"},(0,i.jsx)(a.SettingRow,null,(0,i.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:S,onAcceptValue:I})),(0,i.jsx)(a.SettingRow,{flow:"no-wrap",label:h("useFieldAlias")},(0,i.jsx)(n.Switch,{"aria-label":h("useFieldAlias"),checked:u.networkInfo.useFieldAlias,onChange:b}))),(0,i.jsx)(a.SettingSection,{role:"group"},(0,i.jsx)(a.SettingRow,{flow:"wrap",label:h("configureFields")},(0,i.jsx)(r.List,Object.assign({className:"list-routeid-fields pt-2 w-100",itemsJson:Array.from(u.networkInfo.attributeFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:w(t),itemStateTitle:u.networkInfo.useFieldAlias?e.field.alias:e.field.name}))),renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:o,itemJsons:[{itemStateDetailVisible:a,itemStateDetailContent:r}]}=t.props,[s]=o,l=+s.itemKey;return r?(0,i.jsx)(n.Checkbox,{"aria-expanded":!!a,className:"jimu-tree-item__detail-toggle mr-2",checked:u.networkInfo.attributeFields[l].enabled,onClick:e=>{N(l)}}):null},dndEnabled:!0,onUpdateItem:(t,i)=>{const{itemJsons:n}=i.props,[,o]=n;var a;a=o.map((e=>e.itemStateDetailContent)),u.layerType===e.event?v("attributeFields",a,!0):u.layerType===e.network&&y("attributeFields",a,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;N(+i.itemKey)}},L))))));return u.layerType===e.event?(0,i.jsx)("div",{className:"h-100"},(0,i.jsx)("div",{css:i.css`height: 100%; overflow:auto;`},u&&m&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(a.SettingSection,{role:"group"},(0,i.jsx)(a.SettingRow,null,(0,i.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:S,onAcceptValue:I})))))):u.layerType===e.network?(0,i.jsx)("div",{className:"h-100"},x()):void 0}var S=d(47626),I=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};const b=d(62838);function w(t){const{runningQuery:l,widgetId:d,layers:u=[],mapWidgetIds:c,portalUrl:p,theme:m,intl:h,onLayersAdded:f,setRunningQuery:w,onLayerRemoved:N,onClearAll:L,onLayerChanged:x,onLayerOrderChanged:F,onMapWidgetedChanged:D,updateAttributeSets:j}=t,R=i.hooks.useTranslation(o),C=i.React.useRef(null),[k,T]=i.React.useState(!1),[M,A]=i.React.useState(!1),[O,E]=i.React.useState(!1),[P,U]=i.React.useState(!1),[B,J]=i.React.useState(-1);let _=l;const W=()=>{const e=null==c?void 0:c[0],t=z(e),i=[];return t.forEach((e=>{var t;const n=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,o=G(n);i.includes(o)||i.push(o)})),i},z=e=>{var t,n,o,a,r;let s=[];if(!e)return s;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(n=(0,i.getAppStore)().getState())||void 0===n?void 0:n.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(a=(0,i.getAppStore)().getState())||void 0===a?void 0:a.appConfig;if(!l)return s;const d=null===(r=l.widgets[e])||void 0===r?void 0:r.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((e=>{const t=i.DataSourceManager.getInstance().getDataSource(e),n=null==t?void 0:t.getDataSourcesByType(i.DataSourceTypes.FeatureLayer);n&&(s=s.concat(n))}))}return s},H=(e,t)=>I(this,void 0,void 0,(function*(){_=!0,w(!0);let n=!1;const o=e[t];let a=null;const r=i.SessionManager.getInstance().getSessionByUrl(p),s=r&&r.token?r.token:"";return a=s?{f:"json",token:s}:{f:"json"},n=yield(0,S.requestService)({method:"GET",url:o,params:a}).then((e=>{if(e.hasOwnProperty("lrs")){const t=$(e);return q(o),t}return T(!0),setTimeout((()=>{T(!1)}),S.errorMessageDelay),!1})).catch((e=>!1)),n})),$=e=>{var t,i;const n=null==c?void 0:c[0],o=z(n),a=[],r=[],s=[],l=[],d=[],p=[];return o.forEach((e=>{p.push(e)})),p.forEach((e=>{})),null===(t=null==e?void 0:e.networkLayers)||void 0===t||t.forEach((e=>{p.forEach((t=>{var i;(null===(i=null==t?void 0:t.getLayerDefinition())||void 0===i?void 0:i.id)===e.id&&(s.push(e.id),r.push(e.id))}))})),null===(i=null==e?void 0:e.eventLayers)||void 0===i||i.forEach((e=>{p.forEach((t=>{var i;(null===(i=null==t?void 0:t.getLayerDefinition())||void 0===i?void 0:i.id)===e.id&&(l.push(e.id),r.push(e.id),"esriLRSPointEventLayer"===e.type&&d.push(e))}))})),o.forEach((e=>{var t,i;const n=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,o=null==e?void 0:e.getLayerDefinition(),s=-1===u.findIndex((t=>t.id===e.id)),l=r.findIndex((e=>e===o.id))>-1;n&&s&&l&&a.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id})})),0===r.length?(T(!0),setTimeout((()=>{T(!1)}),S.errorMessageDelay),!1):0===s.length?(A(!0),setTimeout((()=>{A(!1)}),S.errorMessageDelay),!1):a.length>0?(K(a,s,l),!0):0===a.length&&r.length>0||void 0},q=e=>I(this,void 0,void 0,(function*(){const t=e+"/attributeSets",n=i.SessionManager.getInstance().getSessionByUrl(p),o=n&&n.token?n.token:"";let a=null;a=o?{f:"json",token:o}:{f:"json"};const r={attributeSet:[]};yield(0,S.requestService)({method:"GET",url:t,params:a}).then((e=>{const t=null==e?void 0:e.attributeSets;(0,S.isDefined)(t)&&t.forEach((e=>{const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};r.attributeSet.push(t)})),j(r)}))})),K=(e,t,n)=>I(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const o=yield(()=>I(this,void 0,void 0,(function*(){let o=[];const a=[];return e.forEach((e=>{a.push(i.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,i.Immutable)(e)).then((a=>I(this,void 0,void 0,(function*(){const r=null==a?void 0:a.getLayerDefinition(),s=t.findIndex((e=>e===r.id))>-1,l=n.findIndex((e=>e===r.id))>-1,d=null==a?void 0:a.url,u=G(d);let c="";s?c=u+"/networkLayers/"+r.id:l&&(c=u+"/eventLayers/"+r.id),c.length>0&&(yield V(a,e,c,u,s,l).then((e=>(e&&(o=o.concat([(0,i.Immutable)(e)])),o))))})))))})),yield Promise.all(a),o})))();f(o)})),V=(t,n,o,a,r,s)=>(0,S.getFeatureLayer)(t).then((l=>{const u=i.SessionManager.getInstance().getSessionByUrl(p),c=u&&u.token?u.token:"";let g=null;return g=c?{f:"json",token:c}:{f:"json"},new Promise(((u,c)=>{(0,S.requestService)({method:"POST",url:o,params:g}).then((c=>{c||u(null);const p=c.type;if("esriLRSNetworkLayer"===p||"esriLRSPointEventLayer"===p||"esriLRSLinearEventLayer"===p){const p={},g={},m=null==t?void 0:t.getSchema(),h=(null==m?void 0:m.fields)?Object.values(null==m?void 0:m.fields):[],f=c.id;let v=e.nonLrs;if(r){const t=`${Math.random()}`.slice(2);v=e.network,p.networkUrl=o;const i=c.routeIdFieldName;p.routeIdFieldSchema=h.find((e=>i===e.name));const n=c.routeNameFieldName;p.routeNameFieldSchema=h.find((e=>n===e.name));const a=c.fromDateFieldName;p.fromDateFieldSchema=h.find((e=>a===e.name));const r=c.toDateFieldName;p.toDateFieldSchema=h.find((e=>r===e.name)),p.measurePrecision=c.measurePrecision,p.unitsOfMeasure=c.unitsOfMeasure,p.supportsLines=c.supportsLines,p.lineIdFieldName=c.lineIdFieldName,p.lineNameFieldName=c.lineNameFieldName,p.lineOrderFieldName=c.lineOrderFieldName;const s=null==l?void 0:l.objectIdField,u=null==l?void 0:l.globalIdField,g=null==l?void 0:l.editFieldsInfo,m=h.find((e=>"Shape__Length"===e.name)),f=[];h.forEach((e=>{var t,i,n,o,a,r;let l=!0;const d=null===(t=null==e?void 0:e.name)||void 0===t?void 0:t.toLocaleLowerCase();d!==(null==u?void 0:u.toLocaleLowerCase())&&d!==(null==s?void 0:s.toLocaleLowerCase())&&d!==(null===(i=g.creationDateField)||void 0===i?void 0:i.toLocaleLowerCase())&&d!==(null===(n=g.creatorField)||void 0===n?void 0:n.toLocaleLowerCase())&&d!==(null===(o=g.editDateField)||void 0===o?void 0:o.toLocaleLowerCase())&&d!==(null===(a=g.editorField)||void 0===a?void 0:a.toLocaleLowerCase())&&d!==(null===(r=null==m?void 0:m.name)||void 0===r?void 0:r.toLocaleLowerCase())||(l=!1);const c={field:e,enabled:l,editable:!0,description:""};f.push(c)})),p.attributeFields=f;const y=[],S=c.eventLayers;S.length>0&&S.forEach((e=>{y.push(e.name)})),p.lrsNetworkId=c.lrsNetworkId,p.eventLayers=y,p.objectIdFieldName=s,p.outputPointDsId=`${d}_output_point_${t}`}else if(s){v=e.event,g.eventUrl=o,g.fromDateFieldName=c.fromDateFieldName,g.toDateFieldName=c.toDateFieldName,g.derivedFromMeasureFieldName=c.derivedFromMeasureFieldName,g.derivedRouteIdFieldName=c.derivedRouteIdFieldName,g.derivedRouteNameFieldName=c.derivedRouteNameFieldName,g.derivedToMeasureFieldName=c.derivedToMeasureFieldName,g.fromReferentLocationFieldName=c.fromReferentLocationFieldName,g.fromReferentMethodFieldName=c.fromReferentMethodFieldName,g.fromReferentOffsetFieldName=c.fromReferentOffsetFieldName,g.toReferentLocationFieldName=c.toReferentLocationFieldName,g.toReferentMethodFieldName=c.toReferentMethodFieldName,g.toReferentOffsetFieldName=c.toReferentOffsetFieldName,g.locErrorFieldName=c.locErrorFieldName,g.eventIdFieldName=c.eventIdFieldName,g.routeIdFieldName=c.routeIdFieldName,g.routeNameFieldName=c.routeNameFieldName,g.fromMeasureFieldName=c.fromMeasureFieldName,g.toRouteIdFieldName=c.toRouteIdFieldName,g.toRouteNameFieldName=c.toRouteNameFieldName,g.toMeasureFieldName=c.toMeasureFieldName,g.canSpanRoutes=c.canSpanRoutes;const t=[g.fromDateFieldName,g.toDateFieldName,g.derivedFromMeasureFieldName,g.derivedRouteIdFieldName,g.derivedRouteNameFieldName,g.derivedToMeasureFieldName,g.fromReferentLocationFieldName,g.fromReferentMethodFieldName,g.fromReferentOffsetFieldName,g.toReferentLocationFieldName,g.toReferentMethodFieldName,g.toReferentOffsetFieldName,g.locErrorFieldName,g.eventIdFieldName,g.routeIdFieldName,g.routeNameFieldName,g.fromMeasureFieldName,g.toRouteIdFieldName,g.toRouteNameFieldName,g.toMeasureFieldName],i=null==l?void 0:l.objectIdField,n=null==l?void 0:l.globalIdField,a=null==l?void 0:l.editFieldsInfo,r=[i,n];a&&(r.push(a.creationDateField),r.push(a.creatorField),r.push(a.editDateField),r.push(a.editorField));const s=t.map((e=>(0,S.isDefined)(e)?e.toLowerCase():e)),d=r.map((e=>(0,S.isDefined)(e)?e.toLowerCase():e));g.lrsFields=h.filter((e=>s.includes(e.name.toLowerCase())));const u=h.filter((e=>!s.includes(e.name.toLowerCase())&&!d.includes(e.name.toLowerCase()))),p=[];u.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};p.push(t)})),g.attributeFields=p,g.parentNetworkId=c.lrsNetworkId}const y={id:t.id,serviceId:f,name:t.getLabel(),lrsUrl:a,useDataSource:n,layerType:v,networkInfo:p||void 0,eventInfo:g||void 0,useFieldAlias:!0},I=(0,i.Immutable)(Object.assign({},y,{layerInfo:y}));u(I)}else u(null)}))}))})),G=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},Q=i.React.useCallback((()=>{J(-1)}),[]),X=i.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${m.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${m.ref.palette.neutral[1e3]};
          font-size: ${i.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${m.ref.palette.neutral[800]};
        }
      }
    }
  `,Y={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:r.TreeItemActionType.RenderOverrideItem,children:[{name:r.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:r.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemBody,children:[{name:r.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:r.TreeItemActionType.RenderOverrideItemDragHandle},{name:r.TreeItemActionType.RenderOverrideItemTitle},{name:r.TreeItemActionType.RenderOverrideItemDetailToggle},{name:r.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,i.jsx)("div",{ref:C,css:X,className:(0,i.classNames)("d-flex flex-column",{"h-100":0===u.length})},(0,i.jsx)(a.SettingSection,{className:"border-0"},(0,i.jsx)(s.Fragment,null,(0,i.jsx)(a.SettingRow,{label:R("selectMap")}),(0,i.jsx)(a.SettingRow,null,(0,i.jsx)(a.MapWidgetSelector,{onSelect:e=>{D(e)},useMapWidgetIds:c})),(0,i.jsx)(a.SettingRow,null,(0,i.jsx)(n.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:()=>{if(T(!1),U(!1),A(!1),E(!1),void 0===(null==c?void 0:c[0]))E(!0),setTimeout((()=>{E(!1)}),S.errorMessageDelay);else{const e=W();e.length>1?(U(!0),setTimeout((()=>{U(!1)}),S.errorMessageDelay)):e.length>0?_||H(e,0).then((e=>{e||(T(!0),setTimeout((()=>{T(!1)}),S.errorMessageDelay))})).catch((e=>{_=!1,w(!1),console.error(e)})):(T(!0),setTimeout((()=>{T(!1)}),S.errorMessageDelay))}},title:R("loadLayers"),"aria-label":R("loadLayers")},R("loadLayers"))),u&&u.length>0&&(0,i.jsx)(a.SettingRow,null,(0,i.jsx)(n.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:L,title:R("clearLayers"),"aria-label":R("clearLayers")},R("clearLayers"))),k&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(s.Fragment,null,(0,i.jsx)(g,{color:m.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(h,"noLrsLayersTips")))),O&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(s.Fragment,null,(0,i.jsx)(g,{color:m.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(h,"noMapSelectedTips")))),M&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(s.Fragment,null,(0,i.jsx)(g,{color:m.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(h,"noNetworkLayersTips")))),P&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(s.Fragment,null,(0,i.jsx)(g,{color:m.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(h,"multipleServicesTips")))))),(0,i.jsx)(a.SettingSection,{className:(0,i.classNames)("pt-0 border-0",{"h-100":0===u.length})},(0,i.jsx)(a.SettingRow,null,(0,i.jsx)("div",{className:"setting-ui-unit-list w-100"},(0,i.jsx)(r.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:u.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:B===t,itemStateTitle:e.name,itemStateCommands:[{label:"remove",iconProps:()=>({icon:b,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,i=+t.itemKey;i===B&&Q(),N(i)}}]}))),renderOverrideItemDetailToggle:(t,o)=>{const{itemJsons:a}=o.props,[r]=a;return(t=>{const i=u.at(t);return!(0,S.isDefined)(i)||!(0,S.isDefined)(i.eventInfo)||i.layerType!==e.event||u.findIndex((e=>(0,S.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===i.eventInfo.parentNetworkId))>-1})(+r.itemKey)?"":(0,i.jsx)(n.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:R("missingParentNetwork")})},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,n]=i;F(n.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;var n;n=+i.itemKey,J(n===B?-1:n)}},Y)),u.length===B&&(0,i.jsx)(r.List,Object.assign({className:"setting-ui-unit-list-new",css:i.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${B}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},Y)))),0===u.length&&(0,i.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,i.jsx)("div",{className:"empty-placeholder-inner"},(0,i.jsx)("div",{className:"empty-placeholder-icon"},(0,i.jsx)(v,{size:48})),(0,i.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:R("blankStatus")}}))),(0,i.jsx)(a.SidePopper,{isOpen:B>=0&&!i.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:Q,position:"right",trigger:null==C?void 0:C.current,title:R("layerConfig")},(0,i.jsx)(y,{widgetId:d,index:B,total:u.length,lrsLayer:u[B],onLayerChanged:x}))))}var N=d(54337);const L=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],x="#00FFFF";let F;class D extends i.React.PureComponent{constructor(t){super(t),this.componentDidMount=()=>{F=!1;const e=this.props.config.lrsLayers,t=this.getNetworkLayers(e);this.setState({defaultNetworkLayer:this.getDefaultNetwork(t)})},this.getInitSchema=(e="",t)=>{const n={},o=i.DataSourceManager.getInstance().getDataSource(t.useDataSource.dataSourceId),a=null==o?void 0:o.getSchema().fields.asMutable({deep:!0}),r=[];return Object.keys(a).forEach((e=>{r.push(a[e])})),r.push({alias:L[0].value,type:i.JimuFieldType.Number,jimuName:L[0].value,name:L[0].value}),null==r||r.forEach((e=>{n[null==e?void 0:e.jimuName]=e})),{label:e,idField:"OBJECTID",fields:n}},this.getInitOutDataSource=(e,t,i,n)=>{var o;const a=this.getI18nMessage("outputDsLabelPoint",{label:`${i.name}`}),r=null===(o=null==i?void 0:i.networkInfo)||void 0===o?void 0:o.outputPointDsId,s=this.getInitSchema(a,i);return{id:r,type:null==t?void 0:t.type,label:a,originDataSources:[i.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:s,geometryType:n?"esriGeometryPoint":"esriGeometryPolyline"}},this.getDefaultNetwork=(e,t)=>{var i;let n=null===(i=e[0])||void 0===i?void 0:i.serviceId;return this.props.config.defaultNetworkLayer&&t&&(n=this.props.config.defaultNetworkLayer),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetworkLayer",n)})}),2e3),n},this.updateWidgetJson=(...e)=>{const[t,...i]=e,n=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(n,...i)},this.updateConfigForOptions=(...t)=>{let i=null,n=t.reduce(((e,[t,n,o])=>("lrsLayers"===t&&(null==o?void 0:o.dsUpdateRequired)&&(i=this.getAllDataSources(n)),e.set(t,n))),this.props.config);const o=[],a=[];if(n.lrsLayers.forEach((t=>{t.layerType===e.network?o.push(t.name):t.layerType===e.event&&a.push(t.name)})),n=n.setIn(["networkLayers"],o),n=n.setIn(["eventLayers"],a),0===n.lrsLayers.length){const e={index:-1,name:""};n=n.setIn(["defaultEvent"],e)}i?this.updateWidgetJson({config:n,useDataSources:Object.values(i.useDataSourceMap)},i.outputDataSources):this.updateWidgetJson({config:n})},this.updateAttributeSets=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("attributeSets",e)})},this.getAllDataSources=e=>(0,i.Immutable)(e).asMutable({deep:!0}).reduce(((e,t)=>{var n,o,r;const s=t.useDataSource,l=s.dataSourceId;if(e.useDataSourceMap[l]=e.useDataSourceMap[l]||s,e.useDataSourceMap[l].fields=s.fields,"network"===(null===(n=null==t?void 0:t.layerType)||void 0===n?void 0:n.toLocaleLowerCase())){const n=i.DataSourceManager.getInstance().getDataSource(null===(o=t.useDataSource)||void 0===o?void 0:o.dataSourceId);if(n){const i=null===(r=(0,a.getOutputJsonOriginDs)(n))||void 0===r?void 0:r.getDataSourceJson(),o=this.getInitOutDataSource(this.props.widgetId,i,t,!0);e.outputDataSources.push(o)}}return e}),{useDataSourceMap:{},outputDataSources:[]}),this.addLayers=(e,t=!0)=>{var n,o,a;let r=null!==(n=this.props.config.lrsLayers)&&void 0!==n?n:(0,i.Immutable)([]),s=null!==(a=null===(o=this.props.config.lrsLayers)||void 0===o?void 0:o.length)&&void 0!==a?a:0;e.forEach((e=>{r=i.Immutable.set(r,s,e),s++})),this.updateConfigForOptions(["lrsLayers",r,{dsUpdateRequired:t}])},this.updateLayerItem=(e,t,n=!1)=>{var o;let a=null!==(o=this.props.config.lrsLayers)&&void 0!==o?o:(0,i.Immutable)([]);a=i.Immutable.set(a,e,t),this.updateConfigForOptions(["lrsLayers",a,{dsUpdateRequired:n}])},this.reOrderLayers=e=>{this.updateConfigForOptions(["lrsLayers",e])},this.removeAllLayers=(e=!1)=>{this.setRunningQuery(!1);const t={dsUpdateRequired:e};this.updateConfigForOptions(["lrsLayers",[],t])},this.removeLayer=(e,t=!1)=>{const i={dsUpdateRequired:t},n=this.props.config.lrsLayers.asMutable({deep:!0});n.splice(e,1),this.updateConfigForOptions(["lrsLayers",n,i]);const o=n.find((e=>(null==e?void 0:e.serviceId)===this.state.defaultNetworkLayer));let a=null;const r=this.getNetworkLayers(n);a=o?this.getDefaultNetwork(r):this.getDefaultNetwork(r,!1),o||this.setState({defaultNetworkLayer:a})},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.getI18nMessage=(e,t)=>{const i=Object.assign({},o,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.handleHighlishStyleChange=e=>{const t=this.props.config.highlightStyle.asMutable({deep:!0});"string"==typeof e&&(t.routeColor=e),"number"==typeof e&&(t.width=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",t)})},this.handleLineEventToggleChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("lineEventToggle",t)})},this.handlePointEventToggleChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("pointEventToggle",t)})},this.handleDefaultAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultAttributeSet",e)})},this.handleDefaultNetworkChange=e=>{this.setState({defaultNetworkLayer:e}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetworkLayer",e)})},this.handleDefaultLineAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultLineAttrbuteSet",e)})},this.handleDefaultPointAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultPointAttributeSet",e)})},this.getDefaultLineAttributeSet=()=>{if(this.props.config.defaultLineAttrbuteSet)return this.props.config.defaultLineAttrbuteSet;{const e=this.getLineAttributeSet();return this.handleDefaultLineAttributeSetChanged(null==e?void 0:e[0].title),null==e?void 0:e[0].title}},this.getDefaultPointAttributeSet=()=>{if(this.props.config.defaultPointAttributeSet)return this.props.config.defaultPointAttributeSet;{const e=this.getPointAttributeSet();return this.handleDefaultPointAttributeSetChanged(null==e?void 0:e[0].title),null==e?void 0:e[0].title}},this.getNetworkLayers=e=>{const t=[];return e.forEach((e=>{var i;(null==e?void 0:e.networkInfo)&&(null===(i=null==e?void 0:e.networkInfo)||void 0===i?void 0:i.networkUrl)&&t.push(e)})),t},this.getLineAttributeSet=()=>{const e=this.props.config.attributeSets.attributeSet,t=[];return null==e||e.forEach((e=>{e.isPoint||t.push(e)})),t},this.getPointAttributeSet=()=>{const e=this.props.config.attributeSets.attributeSet,t=[];return null==e||e.forEach((e=>{e.isPoint&&t.push(e)})),t},this.setRunningQuery=e=>{F=e},this.state={showLayerPanel:!1,dsToRemove:null,defaultNetworkLayer:null}}componentDidUpdate(e,t,i){if(!this.state.defaultNetworkLayer){const e=this.props.config.lrsLayers,t=this.getNetworkLayers(e);this.setState({defaultNetworkLayer:this.getDefaultNetwork(t)})}}getHighlightStyleConfig(){if(this.props.config.highlightStyle)return this.props.config.highlightStyle;{const e=this.getDefaultStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",e)}),e}}getDefaultStyleConfig(){return{routeColor:x,width:3}}render(){var e,t,o,r;const{config:s}=this.props,l=this.props.config.lrsLayers,d=this.getNetworkLayers(l),u=this.getLineAttributeSet(),c=this.getPointAttributeSet();return(0,i.jsx)("div",{className:"setting-add-point-event h-100"},(0,i.jsx)("div",{className:"jimu-widget-setting setting-add-point-event__setting-content h-100"},(0,i.jsx)(w,{runningQuery:F,setRunningQuery:this.setRunningQuery,intl:this.props.intl,widgetId:this.props.id,layers:this.props.config.lrsLayers,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onLayersAdded:this.addLayers,onLayerChanged:this.updateLayerItem,onClearAll:this.removeAllLayers,onLayerRemoved:this.removeLayer,onLayerOrderChanged:this.reOrderLayers,onMapWidgetedChanged:this.mapWidgetIdUpdated,updateAttributeSets:this.updateAttributeSets}),(null==d?void 0:d.length)>0&&(0,i.jsx)(a.SettingSection,{role:"group",title:this.getI18nMessage("defaultNetwork"),"aria-label":this.getI18nMessage("defaultNetwork")},(0,i.jsx)(n.Select,{defaultValue:this.state.defaultNetworkLayer,value:this.state.defaultNetworkLayer,onChange:e=>{this.handleDefaultNetworkChange(e.target.value)},"aria-label":this.getI18nMessage("defaultNetwork")},null==d?void 0:d.map((e=>(0,i.jsx)("option",{value:e.serviceId},e.name))))),(null===(e=null==s?void 0:s.lrsLayers)||void 0===e?void 0:e.length)>0&&(0,i.jsx)("div",null,(0,i.jsx)(a.SettingSection,{role:"group",title:this.getI18nMessage("selectionSettings"),"aria-label":this.getI18nMessage("selectionSettings")},(0,i.jsx)(a.SettingRow,{label:this.getI18nMessage("selectionHighlight")},(0,i.jsx)(N.ColorPicker,{color:(null===(o=null===(t=this.props.config)||void 0===t?void 0:t.highlightStyle)||void 0===o?void 0:o.routeColor)?this.props.config.highlightStyle.routeColor:x,value:this.getHighlightStyleConfig().routeColor||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("selectionHighlight")})),(0,i.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("graphicWidth")},(0,i.jsx)(n.NumericInput,{size:"sm",value:this.getHighlightStyleConfig().width||3,precision:1,min:0,max:15,step:.1,onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("graphicWidth"),className:"w-100"}))),(null==s?void 0:s.eventLayers)&&(null===(r=null==s?void 0:s.eventLayers)||void 0===r?void 0:r.length)>0&&(0,i.jsx)(a.SettingSection,null,(0,i.jsx)(a.SettingRow,{flow:"no-wrap",label:this.getI18nMessage("lineAttributeToggle")},(0,i.jsx)(n.Switch,{"aria-label":this.getI18nMessage("lineAttributeToggle"),checked:this.props.config.lineEventToggle,onChange:this.handleLineEventToggleChange})),this.props.config.lineEventToggle&&(0,S.isDefined)(u)&&(0,i.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("lineAttributeSet")},(0,i.jsx)(n.Select,{"aria-label":this.getI18nMessage("lineAttributeSet"),size:"sm",value:this.getDefaultLineAttributeSet(),onChange:e=>{this.handleDefaultLineAttributeSetChanged(e.target.value)}},null==u?void 0:u.map(((e,t)=>(0,i.jsx)("option",{key:t,value:e.title},e.title))))),(0,i.jsx)(a.SettingRow,{flow:"no-wrap",label:this.getI18nMessage("pointAttributeToggle")},(0,i.jsx)(n.Switch,{"aria-label":this.getI18nMessage("pointAttributeToggle"),checked:this.props.config.pointEventToggle,onChange:this.handlePointEventToggleChange})),this.props.config.pointEventToggle&&(0,S.isDefined)(c)&&(0,i.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("pointAttributeSet")},(0,i.jsx)(n.Select,{"aria-label":this.getI18nMessage("pointAttributeSet"),size:"sm",value:this.getDefaultPointAttributeSet(),onChange:e=>{this.handleDefaultPointAttributeSetChanged(e.target.value)}},null==c?void 0:c.map(((e,t)=>(0,i.jsx)("option",{key:t,value:e.title},e.title)))))))))}}function j(e){d.p=e}})(),u})())}}}));