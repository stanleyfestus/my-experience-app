System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","calcite-components","jimu-core/react","esri/Graphic","jimu-theme","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"],(function(e,t){var a={},i={},o={},n={},r={},s={},l={},u={},d={},c={};return{setters:[function(e){a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.MessageManager=e.MessageManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.RecordSetChangeType=e.RecordSetChangeType,a.SessionManager=e.SessionManager,a.classNames=e.classNames,a.css=e.css,a.hooks=e.hooks,a.injectIntl=e.injectIntl,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.ConvertUnits=e.ConvertUnits,i.GetUnits=e.GetUnits,i.InlineEditableDropdown=e.InlineEditableDropdown,i.Intellisense=e.Intellisense,i.IntellisenseTextInput=e.IntellisenseTextInput,i.SearchMethod=e.SearchMethod,i.convertStationToNumber=e.convertStationToNumber,i.createLabelLayer=e.createLabelLayer,i.formatMessage=e.formatMessage,i.getCalciteBasicTheme=e.getCalciteBasicTheme,i.getDateWithTZOffset=e.getDateWithTZOffset,i.getGeometryGraphic=e.getGeometryGraphic,i.getPolylineMidPoint=e.getPolylineMidPoint,i.getSimplePointGraphic=e.getSimplePointGraphic,i.getSuggestions=e.getSuggestions,i.isDefined=e.isDefined,i.isInWidgetController=e.isInWidgetController,i.removeLabelLayer=e.removeLabelLayer,i.requestService=e.requestService},function(e){o.Alert=e.Alert,o.Button=e.Button,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,o.Label=e.Label,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.NumericInput=e.NumericInput,o.Pagination=e.Pagination,o.Select=e.Select,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.geometryUtils=e.geometryUtils,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.CalciteSegmentedControl=e.CalciteSegmentedControl,r.CalciteSegmentedControlItem=e.CalciteSegmentedControlItem},function(e){s.useImperativeHandle=e.useImperativeHandle},function(e){l.default=e.default},function(e){u.withTheme=e.withTheme},function(e){d.default=e.default},function(e){c.default=e.default}],execute:function(){e((()=>{var e={37264:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M5 4.5h3.5V0h1v4.5H20v1h-4.5V10h-1V5.5H5z"></path><path fill="#000" fill-rule="evenodd" d="M8.682 9.318a4.5 4.5 0 0 1 .334 5.991l3.97 3.97-.708.706-3.969-3.969a4.5 4.5 0 1 1 .373-6.698m-.707 5.657a3.5 3.5 0 1 0-4.95-4.95 3.5 3.5 0 0 0 4.95 4.95" clip-rule="evenodd"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},99037:e=>{"use strict";e.exports=r},22089:e=>{"use strict";e.exports=l},77958:e=>{"use strict";e.exports=c},59620:e=>{"use strict";e.exports=d},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=u},14321:e=>{"use strict";e.exports=o},47626:e=>{"use strict";e.exports=i}},t={};function m(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,m),o.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var a in t)m.o(t,a)&&!m.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var f={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(f),m.d(f,{__set_webpack_public_path__:()=>gt,default:()=>pt});var e=m(79244),t=m(47626);const a={_widgetLabel:"Search By Route",method:"Method *",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",lineAndMeasure:"Line And Measure",network:"Network *",referent:"Referent",referentRequired:"Referent *",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidCoordinate:"Invalid coordinate value",invalidRouteField:"Route could not be found with provided value",measureWithUnits:"Measure ({units})",measuresWithUnits:"Measures ({units})",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",coordinateSearchDisabled:"Provide coordinate",lineMeasureSearchDisabled:"Provide line",xCoordinateRequiredLabel:"X Coordinate *",yCoordinateRequiredLabel:"Y Coordinate *",zCoordinateLabel:"Z Coordinate",searchRadiusResultsError:"No routes found in search radius.",offsetlabel:"Offset ({unit})",invalidOffset:"Invalid Offset",invalidReferent:"Invalid Referent",searchReferentTooltip:"Search By Referent",referentDisplayName:"{displayName} *",noResultReferent:"No routes found for the given offset value",addAnotherMeasure:"Add another measure",range:"Range",noResults:"No results with provided values",noResultsMeasure:"No results found with provided measure(s)",fieldNameRequired:"{field} *",measureType:"Measure Type"};var i,o,n,r,s,l=m(14321),u=m(37264),d=m.n(u),c=m(62686);function h(i){var o;const n=e.hooks.useTranslation(a),{config:r,defaultReferent:s,networkConfig:u,onMethodChanged:d,onNetworkChanged:c,onReferentChanged:m}=i,[f,h]=e.React.useState(u[0]),[v,p]=e.React.useState(null===(o=null==r?void 0:r.resultConfig)||void 0===o?void 0:o.defaultReferentLayer),[g,y]=e.React.useState(f.defaultMethod),[S,N]=e.React.useState([]);e.React.useEffect((()=>{p(s)}),[s]),e.React.useEffect((()=>{for(let a=0;a<u.length;a++){const a=u.find((e=>e.name===r.defaultNetwork));if((0,t.isDefined)(a)&&!(null==a?void 0:a.referent)){h((0,e.Immutable)(a)),y(a.defaultMethod);break}}}),[r.defaultNetwork,u]);const I=(e,t)=>{const a=u.findIndex((t=>t.name===e));"network"===t?(h(u[a]),c(u[a])):(p(u[a]),m(u[a])),y(u[a].defaultMethod),d(u[a].defaultMethod)};e.React.useEffect((()=>{const e=u.filter((e=>!e.referent)).map((e=>e.name)).asMutable();N(e)}),[u]);const R=e.React.useMemo((()=>{let e=0;return f.useMeasure&&e++,f.useCoordinate&&e++,f.useReferent&&e++,f.useLineAndMeasure&&e++,e}),[f]);return(0,e.jsx)("div",{className:"search-method-form"},!r.hideMethod&&(0,e.jsx)(t.InlineEditableDropdown,{label:n("method"),isDisabled:1===R,defaultItem:g,altItemDescriptions:(()=>{const e=[];return f.useMeasure&&e.push(n("measure")),f.useCoordinate&&e.push(n("coordinate")),f.useReferent&&e.push(n("referent")),f.useLineAndMeasure&&e.push(n("lineAndMeasure")),e})(),listItems:(()=>{const e=[];return f.useMeasure&&e.push(t.SearchMethod.Measure),f.useCoordinate&&e.push(t.SearchMethod.Coordinate),f.useReferent&&e.push(t.SearchMethod.Referent),f.useLineAndMeasure&&e.push(t.SearchMethod.LineAndMeasure),e})(),onSelectionChanged:e=>{let a=t.SearchMethod.Measure;e===t.SearchMethod.Coordinate?a=t.SearchMethod.Coordinate:e===t.SearchMethod.Referent?a=t.SearchMethod.Referent:e===t.SearchMethod.LineAndMeasure&&(a=t.SearchMethod.LineAndMeasure),y(a),d(a)}}),!r.hideNetwork&&(0,e.jsx)(t.InlineEditableDropdown,{label:n("network"),isDisabled:1===u.length,defaultItem:(0,t.isDefined)(f)?f.name:"",listItems:S,onSelectionChanged:e=>{I(e,"network")}}),g===t.SearchMethod.Referent&&(0,e.jsx)("div",{className:"search-method-form__network-label px-3",style:{paddingTop:"12px"}},(0,e.jsx)(l.Label,{size:"default",className:"mb-1",style:{width:100,alignItems:"center",fontWeight:"500"}},n("referentRequired")),(0,e.jsx)(l.Select,{"aria-label":n("referent"),className:"w-100",size:"sm",disabled:1===u.length,value:v.name,onChange:e=>{I(e.target.value,"point")}},u.map(((t,a)=>(null==t?void 0:t.referent)?(0,e.jsx)("option",{key:a,value:t.name},t.name):null)))))}!function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(i||(i={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(o||(o={})),function(e){e.Map="MAP",e.Lrs="LRS"}(n||(n={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(r||(r={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(s||(s={}));const v=e.React.memo((n=>{const{intl:r,config:s,reset:u,widgetId:d,type:c,networkItem:m,dataSource:f,isDataSourceReady:h,routeAndMeasureRequest:v,onChange:p,onAccept:g}=n,{routeIdField:y,routeNameField:S,routeIdFields:N}=m,I=e.hooks.useTranslation(a),R=e.React.useMemo((()=>f),[f]),b=(e,t)=>{j(e,t)},w=(e,t,a)=>{D(e,t,a)},D=(e,t,a)=>{const o=v;m.defaultIdentifer===i.RouteId&&"string"==typeof e?(o.routeId=e,g(o,t)):m.defaultIdentifer===i.RouteName&&"string"==typeof e?(o.routeName=e,g(o,t)):(o.routeIdFields[a]=e,g(o,t,a))},x=(e,t)=>{C(e,t)},M=(e,t,a)=>{F(e,t,a)},F=(e,t,a)=>{const i=v;m.defaultLineIdentifier===o.LineId&&"string"==typeof e?(i.lineId=e,g(i,t)):m.defaultLineIdentifier===o.LineName&&"string"==typeof e&&(i.lineName=e,g(i,t))},j=(e,t)=>{const a=v;m.defaultIdentifer===i.RouteId&&"string"==typeof e?(a.routeId=e,p(a)):m.defaultIdentifer===i.RouteName&&"string"==typeof e?(a.routeName=e,p(a)):(a.routeIdFields[t]=e,p(a,t))},C=(e,t)=>{const a=v;m.defaultLineIdentifier===o.LineId&&"string"==typeof e?(a.lineId=e,p(a)):m.defaultLineIdentifier===o.LineName&&"string"==typeof e&&(a.lineName=e,p(a))},O=e.React.useMemo((()=>{const e={};return N&&N.length>1&&R&&N.forEach(((t,a)=>{const i=null==R?void 0:R.getFieldCodedValueList(t.field.jimuName);i&&(e[a]=i)})),e}),[R,N]),L={paddingTop:"0px"};return"lineMeasure"===c&&(L.paddingTop="12px"),(0,e.jsx)("div",{className:"route-input-control"},"lineMeasure"===c&&m.defaultLineIdentifier===o.LineId&&(0,e.jsx)("div",{className:"search-by-measure-form__route-id-label px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},I("fieldNameRequired",{field:m.lineIdField.alias})),(0,e.jsx)(t.IntellisenseTextInput,{reset:u,widgetId:d,fieldName:m.lineIdField.name,fieldType:m.lineIdField.type,dataSource:f,isDataSourceReady:h,onChange:x,onAccept:M})),"lineMeasure"===c&&m.defaultLineIdentifier===o.LineName&&(0,e.jsx)("div",{className:"search-by-measure-form__route-id-label px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},I("fieldNameRequired",{field:m.lineNameField.alias})),(0,e.jsx)(t.IntellisenseTextInput,{reset:u,widgetId:d,fieldName:m.lineNameField.name,fieldType:m.lineNameField.type,dataSource:f,isDataSourceReady:h,onChange:x,onAccept:M})),m.defaultIdentifer===i.RouteId&&(m.supportsLines&&!(null==s?void 0:s.hideRoute)&&"lineMeasure"===c||"lineMeasure"!==c)&&(0,e.jsx)("div",{className:"search-by-measure-form__route-id-label px-3",style:L},"lineMeasure"!==c?(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},I("fieldNameRequired",{field:y.alias})):(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},y.alias),(0,e.jsx)(t.IntellisenseTextInput,{reset:u,widgetId:d,fieldName:m.routeIdField.name,fieldType:m.routeIdField.type,dataSource:f,isDataSourceReady:h,onChange:b,onAccept:w})),m.defaultIdentifer===i.RouteName&&(m.supportsLines&&!(null==s?void 0:s.hideRoute)&&"lineMeasure"===c||"lineMeasure"!==c)&&(0,e.jsx)("div",{className:"search-by-measure-form__route-name-label px-3",style:L},"lineMeasure"!==c?(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},I("fieldNameRequired",{field:S.alias})):(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},S.alias),(0,e.jsx)(t.IntellisenseTextInput,{reset:u,widgetId:d,fieldName:m.routeNameField.name,fieldType:m.routeNameField.type,dataSource:f,isDataSourceReady:h,onChange:b,onAccept:w})),m.defaultIdentifer===i.MultiField&&N.filter((e=>e.enabled)).map(((a,i)=>{var o,n;return(0,e.jsx)("div",{key:i,className:"search-by-measure-form__multi-field-id px-3"},O[i]&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__coded-domain-label",{"pt-2":i>0})},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(l.Select,{"aria-label":a.field.name,size:"sm",style:{width:"100%"},value:null===(o=null==v?void 0:v.routeIdFields)||void 0===o?void 0:o[i],onChange:e=>{((e,t)=>{D(e.target.value,!0,t)})(e,i)}},(0,e.jsx)("option",{key:-1,value:""},(0,t.formatMessage)(r,"nullLabel")),O[i].map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.value},`${t.value} - ${t.label}`))))),!O[i]&&a.field.type===e.JimuFieldType.Number&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__numeric-label",{"pt-2":i>0})},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(l.NumericInput,{value:null===(n=null==v?void 0:v.routeIdFields)||void 0===n?void 0:n[i],"aria-label":a.field.name,size:"sm",style:{width:"100%"},step:1,disabled:!h,onAcceptValue:e=>{((e,t)=>{D(e,!0,t)})(e,i)}})),!O[i]&&a.field.type===e.JimuFieldType.String&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__text-label",{"pt-2":i>0})},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(t.IntellisenseTextInput,{reset:u,widgetId:d,fieldName:a.field.name,fieldType:a.field.type,dataSource:f,isDataSourceReady:h,onChange:e=>{b(e,i)},onAccept:(e,t)=>{w(e,t,i)}})))})))}));var p=m(99037);const g=e.React.memo((i=>{const{networkItem:o,searchMeasureBy:n,onChange:r}=i,u=e.hooks.useTranslation(a);return(0,e.jsx)("div",{className:"measures-segment-control"},(()=>{let e=0;return o.searchSingle&&e++,o.searchMultiple&&e++,o.searchRange&&e++,e>1})()&&(0,e.jsx)("div",{className:"w-100 px-3 pt-2",css:(0,t.getCalciteBasicTheme)()},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},u("measureType")),(0,e.jsx)(p.CalciteSegmentedControl,{width:"full",value:n,appearance:"outline-fill",scale:"s",onCalciteSegmentedControlChange:e=>{r(e.target.value)}},o.searchSingle&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:n===s.Single||void 0,value:s.Single},u("single")),o.searchMultiple&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:n===s.Multiple||void 0,value:s.Multiple},u("multiple")),o.searchRange&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:n===s.Range||void 0,value:s.Range},u("range")))))}));var y=m(62838),S=m.n(y),N=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(a[i[o]]=e[i[o]])}return a};const I=t=>{const a=window.SVG,{className:i}=t,o=N(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:S()},o)):e.React.createElement("svg",Object.assign({className:n},o))};function R(i){const{reset:o,networkItem:n,isDataSourceReady:r,searchMeasureBy:u,routeAndMeasureRequest:d,intl:c,onChange:m}=i,f=e.hooks.useTranslation(a),h=(0,t.GetUnits)(n.unitsOfMeasure,c),[v,p]=e.React.useState(null),[g,y]=e.React.useState(null),[S,N]=e.React.useState(null),[R,b]=e.React.useState(new Array(1).fill(""));e.React.useEffect((()=>{p(null),y(null),N(null),b(new Array(1).fill(""))}),[o]);const w=(e,a,i)=>{if(isNaN(Number(e))){const o=(0,t.convertStationToNumber)(e);return isNaN(o)?(D(NaN,a,!1,i,""),{valid:!1,msg:f("invalidMeasure")}):(D(o,a,!0,i,e),{valid:!0})}return D(Number(""===e?NaN:e),a,!0,i,""),{valid:!0}},D=(e,t,a,i,o)=>{const n=d;n.searchMeasureBy===s.Single?(n.measure=e,n.station=o):n.searchMeasureBy===s.Multiple?(n.measures[i]=e,n.stations[i]=o):n.searchMeasureBy===s.Range&&(t?(n.fromMeasure=e,n.fromStation=o):(n.toMeasure=e,n.toStation=o)),m(n,a)};return(0,e.jsx)("div",{className:"measure-input-control"},(0,e.jsx)("div",{className:"measure-input-control__content pt-2"},u===s.Single&&(0,e.jsx)("div",{className:"measure-input-control__single px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},f("measureWithUnits",{units:h})),(0,e.jsx)(l.TextInput,{"aria-label":f("measureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!r,allowClear:!0,value:v,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;p(a)},checkValidityOnAccept:e=>w(e,!0)})),u===s.Multiple&&(0,e.jsx)("div",{className:"measure-input-control__multiple"},(0,e.jsx)("div",{className:"measure-input-control__multiple-measure px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},f("measuresWithUnits",{units:h})),R&&R.map(((t,a)=>(0,e.jsx)("div",{key:a,className:"d-flex w-100"},(0,e.jsx)(l.TextInput,{"aria-label":f("measuresWithUnits",{units:h}),type:"text",className:"mb-1",size:"sm",style:{width:"93%",float:"left"},disabled:!r,allowClear:!0,checkValidityOnAccept:e=>w(e,!0,a),onChange:e=>{((e,t)=>{R[t]=e.target.value;const a=[];R.forEach(((e,t)=>{a.push(e)})),b(a)})(e,a)},value:t}),a>0&&(0,e.jsx)(l.Button,{className:"text-input-clear clear-content",style:{float:"left",width:"7%"},type:"tertiary","aria-label":f("clear"),title:f("clear"),icon:!0,size:"sm",onClick:()=>{(e=>{d.measures.splice(e,1),d.stations.splice(e,1),R.splice(e,1);const t=[];R.forEach(((e,a)=>{t.push(e)})),b(t)})(a)}},(0,e.jsx)(I,{size:"s"})))))),(0,e.jsx)("div",{className:"measure-input-control__multiple-add-input pt-2 px-3"},(0,e.jsx)(l.Button,{type:"secondary",size:"sm",style:{width:"93%"},onClick:()=>{let e=[];e.push(""),R&&(e=R.concat(e)),d.measures.push(Number(NaN)),d.stations.push(""),b(e)}},f("addAnotherMeasure")))),u===s.Range&&(0,e.jsx)("div",{className:"measure-input-control__range"},(0,e.jsx)("div",{className:"measure-input-control__range-from-measure px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},f("fromMeasureWithUnits",{units:h})),(0,e.jsx)(l.TextInput,{"aria-label":f("fromMeasureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!r,allowClear:!0,value:g,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;y(a)},checkValidityOnAccept:e=>w(e,!0)})),(0,e.jsx)("div",{className:"measure-input-control__range-to-measure pt-2 px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},f("toMeasureWithUnits",{units:h})),(0,e.jsx)(l.TextInput,{"aria-label":f("toMeasureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!r,allowClear:!0,value:S,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;N(a)},checkValidityOnAccept:e=>w(e,!1)})))))}var b=m(68972);const w=e.React.forwardRef(((t,a)=>{var o;const{widgetId:n,config:r,reset:l,networkItem:u,dataSource:d,isDataSourceReady:c,intl:m,onSubmit:f,onValidationChanged:h}=t,[p,y]=e.React.useState({}),[S,N]=e.React.useState(!1),[I,w]=e.React.useState(new Array(null===(o=null==u?void 0:u.routeIdFields)||void 0===o?void 0:o.length).fill(!0)),[D,x]=e.React.useState(!0),[M,F]=e.React.useState(s.Single);(0,b.useImperativeHandle)(a,(()=>({submitForm:j}))),e.React.useEffect((()=>{var e;let t=s.Single;u.searchSingle?t=s.Single:u.searchMultiple?t=s.Multiple:u.searchRange&&(t=s.Range),F(t);const a={routeId:"",routeName:"",routeIdFields:new Array(null===(e=null==u?void 0:u.routeIdFields)||void 0===e?void 0:e.length).fill(""),measure:NaN,station:"",fromMeasure:NaN,fromStation:"",toMeasure:NaN,toStation:"",measures:[NaN],stations:[""],isPoint:!1,searchMeasureBy:t};y(a)}),[u,l]);const j=()=>{const e=Object.assign({},p);e.isMeasureToGeometryOperation=!1,e.isPoint=!1,e.searchMeasureBy===s.Single?isNaN(e.measure)||(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):e.searchMeasureBy===s.Multiple?e.measures.some((e=>!isNaN(e)))&&(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):(e.isPoint=!1,isNaN(e.fromMeasure)&&isNaN(e.toMeasure)||(isNaN(e.fromMeasure)&&!isNaN(e.toMeasure)&&(e.fromMeasure=e.toMeasure,e.toMeasure=NaN,e.isPoint=!0),!isNaN(e.fromMeasure)&&isNaN(e.toMeasure)&&(e.isPoint=!0),e.fromMeasure===e.toMeasure&&(e.toMeasure=NaN,e.isPoint=!0),e.isMeasureToGeometryOperation=!0)),f(e)},C=e.React.useMemo((()=>c&&S&&D),[c,S,D]);e.React.useEffect((()=>{h(C)}),[C,h]);const O=e.React.useCallback(((e,t)=>{y(e)}),[]),L=e.React.useCallback(((e,t,a)=>{if(y(e),u.defaultIdentifer===i.RouteId&&""===e.routeId)N(!1);else if(u.defaultIdentifer===i.RouteName&&""===e.routeName)N(!1);else if(u.defaultIdentifer===i.MultiField&&a>-1){let i=!0;const o=I;o[a]=t,o.forEach(((t,a)=>{t||""===e.routeIdFields[a]||(i=!1),e.routeIdFields.every((e=>""===e))&&(i=!1)})),N(i),w(o)}else N(t)}),[I,u.defaultIdentifer]),k=e.React.useCallback((e=>{const t=p;t.searchMeasureBy=e,y(t),F(e)}),[p]),P=e.React.useCallback(((e,t)=>{y(e),x(t)}),[]);return(0,e.jsx)("div",{className:"search-by-measure-form",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-measure-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-measure-form__content pt-3"},(0,e.jsx)(v,{reset:l,intl:m,widgetId:n,config:r,networkItem:u,dataSource:d,routeAndMeasureRequest:p,isDataSourceReady:c,onChange:O,onAccept:L}),(0,e.jsx)(g,{networkItem:u,searchMeasureBy:M,onChange:k}),(0,e.jsx)(R,{reset:l,intl:m,networkItem:u,dataSource:d,isDataSourceReady:c,searchMeasureBy:M,routeAndMeasureRequest:p,onChange:P})))})),D=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],x=[{value:"DerivedRouteName",label:"Derived Route Name"},{value:"DerivedRouteID",label:"Derived Route ID"},{value:"DerivedRouteMeasure",label:"Derived Route Measure"},{value:"DerivedRouteToMeasure",label:"Derived Route ToMeasure"}],M={value:"Distance",label:"Distance"},F=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],j={value:"Network_OBJECTID",label:"Network OBJECTID"},C=[{value:"ToRouteID",label:"To RouteID"},{value:"ToRouteName",label:"To Route Name"},{value:"ToRouteLineOrder",label:"To Route Line Order"},{value:"ToRouteFromDate",label:"To Route From Date"},{value:"ToRouteToDate",label:"To Route To Date"}];function O(e,a,o,n,r,l,u){const d=o.getSchema(),c=(null==d?void 0:d.fields)?Object.values(d.fields).map((e=>e.alias)):[],m=n.lrsNetworkId,f=u.networkItems.find((e=>m===e.derivedFromNetworkId&&e.isDerived));let h;n.showAdditionalFields?(h=function(e,a,o,n){var r,s,l,u,d;const c=[],m=e.lrsFields,f=e.additionalFields,h=e.layerFields;if(!m||!f)return"additionalFieldsNotConfig";m.includes(e.routeIdField.jimuName)&&c.push(e.routeIdField.alias);e.useRouteName&&m.includes(e.routeNameField.jimuName)&&c.push(e.routeNameField.alias);const v=[e.lineIdFieldName,e.lineNameFieldName,e.lineOrderFieldName];h.forEach((e=>{const t=e.jimuName;v.includes(t)||!m.includes(t)||c.includes(e.alias)||c.push(e.alias)})),e.defaultIdentifer===i.MultiField&&e.routeIdFields.forEach((e=>{const t=e.field.jimuName;m.includes(t)&&c.push(e.field.alias)}));const p=a.attributes[D.at(1).value],g=a.attributes[F.at(0).value],y=a.attributes[F.at(1).value],S=a.attributes[F.at(2).value],N=a.attributes[M.value],I=a.attributes[C.at(0).value];f.includes(D.at(0).value)&&c.push(D.at(0).value);!isNaN(p)&&null!=p&&f.includes(D.at(1).value)&&c.push(D.at(1).value);null!=g&&f.includes(F.at(0).value)&&c.push(F.at(0).value);null!=y&&f.includes(F.at(1).value)&&c.push(F.at(1).value);null!=S&&f.includes(F.at(2).value)&&c.push(F.at(2).value);null!=N&&f.includes(M.value)&&c.push(M.value);(0,t.isDefined)(n)&&(f.includes(x.at(0).value)&&c.push(x.at(0).value),f.includes(x.at(1).value)&&c.push(x.at(1).value),f.includes(x.at(2).value)&&c.push(x.at(2).value),f.includes(x.at(3).value)&&c.push(x.at(3).value));o===t.SearchMethod.LineAndMeasure&&(e.lineIdFieldName&&m.includes(e.lineIdFieldName)&&c.push(e.lineIdField.alias),e.lineNameFieldName&&m.includes(e.lineNameFieldName)&&c.push(e.lineNameField.alias),e.lineOrderFieldName&&m.includes(e.lineOrderFieldName)&&c.push(e.lineOrderField.alias),null!=I&&(f.includes(C.at(0).value)&&c.push(null===(r=C.at(0))||void 0===r?void 0:r.value),f.includes(C.at(1).value)&&c.push(null===(s=C.at(1))||void 0===s?void 0:s.value),f.includes(C.at(2).value)&&c.push(null===(l=C.at(2))||void 0===l?void 0:l.value),f.includes(C.at(3).value)&&c.push(null===(u=C.at(3))||void 0===u?void 0:u.value),f.includes(C.at(4).value)&&c.push(null===(d=C.at(4))||void 0===d?void 0:d.value)));return c}(n,a,r,f),0===h.length&&(h=function(e){const t=[],a=e.routeNameField.alias,i=e.routeIdField.alias;a?t.push(a):t.push(i);return t}(n))):h=function(e,a,o){var n,r,s,l,u;const d=[];d.push(e.routeIdField.alias),e.useRouteName&&d.push(e.routeNameField.alias);e.defaultIdentifer===i.MultiField&&e.routeIdFields.forEach((e=>{d.push(e.field.alias)}));const c=a.attributes[D.at(1).value],m=a.attributes[F.at(0).value],f=a.attributes[F.at(1).value],h=a.attributes[F.at(2).value],v=a.attributes[M.value],p=a.attributes[C.at(0).value];d.push(D.at(0).value),null===p&&(isNaN(c)||null==c||d.push(D.at(1).value));null!=m&&d.push(F.at(0).value);null!=f&&d.push(F.at(1).value);null!=h&&d.push(F.at(2).value);null!=v&&d.push(M.value);e.fromDateFieldName&&d.push(e.fromDateField.alias);e.toDateFieldName&&d.push(e.toDateField.alias);o===t.SearchMethod.LineAndMeasure&&(e.lineIdFieldName&&d.push(e.lineIdField.alias),e.lineNameFieldName&&d.push(e.lineNameField.alias),e.lineOrderFieldName&&d.push(e.lineOrderField.alias),null!=p&&(d.push(null===(n=C.at(0))||void 0===n?void 0:n.value),isNaN(c)||null==c||d.push(D.at(1).value),d.push(null===(r=C.at(1))||void 0===r?void 0:r.value),d.push(null===(s=C.at(2))||void 0===s?void 0:s.value),d.push(null===(l=C.at(3))||void 0===l?void 0:l.value),d.push(null===(u=C.at(4))||void 0===u?void 0:u.value)));return d}(n,a,r);const v=C.at(0).value;let p=`{${function(e){if(e.defaultIdentifer===i.RouteName)return e.routeNameField.jimuName;return e.routeIdField.jimuName}(n)}}`;if(r===t.SearchMethod.LineAndMeasure&&l===s.Range&&a.attributes[v]&&(p=function(e,t){const a=t.attributes[C.at(0).value],o=t.attributes[C.at(1).value],n=e.routeNameField&&t.attributes[e.routeNameField.jimuName],r=e.routeIdField&&t.attributes[e.routeIdField.jimuName];if(e.defaultIdentifer===i.RouteName&&n&&o)return n+" - "+o;return r+" - "+a}(n,a)),c){const a=[];return h.forEach((i=>{var n,r;const s=c.find((e=>e===i));if(s)if(i===M.value){const i=o.getOriginDataSources()[0],l=null===(r=null===(n=null==i?void 0:i.layerDefinition)||void 0===n?void 0:n.geometryProperties)||void 0===r?void 0:r.units,u="esriDecimalDegrees"===l;a.push({fieldName:s,label:s+(u?" ("+(0,t.GetUnits)("esriMeters",e)+")":(0,t.isDefined)(l)?" ("+(0,t.GetUnits)(l,e)+")":"")})}else a.push({fieldName:s,label:s})})),{fieldInfos:a,content:[{type:"fields"}],title:p}}return null}function L(e,t){let a="";return a=t?e.useRouteName?`'${e.routeNameField.alias}: ' + $feature.${e.routeNameField.name} + textformatting.NewLine + \n                    '${D.at(0).label}: ' + $feature.Measure`:`'${e.routeIdField.alias}: ' + $feature.${e.routeIdField.name} + textformatting.NewLine + \n                    '${D.at(0).label}: ' + $feature.Measure`:e.useRouteName?`'${e.routeNameField.alias}: ' + $feature.${e.routeNameField.name} + textformatting.NewLine +\n                    '${D.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${D.at(1).label}: ' + $feature.ToMeasure`:`'${e.routeIdField.alias}: ' + $feature.${e.routeIdField.name} + textformatting.NewLine +\n                    '${D.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${D.at(1).label}: ' + $feature.ToMeasure`,a}function k(e){if(!e||0===e.length)return e;const a=[...e],i=a.find((e=>e.name===D.at(0).value));if(!(0,t.isDefined)(i)){const t=e.at(0).clone();t.name=D.at(0).value,t.alias=D.at(0).label,t.type="double",t.nullable=!0,t.editable=!0,a.push(t)}const o=a.find((e=>e.name===D.at(1).value));if(!(0,t.isDefined)(o)){const t=e.at(0).clone();t.name=D.at(1).value,t.alias=D.at(1).label,t.type="double",t.nullable=!0,t.editable=!0,a.push(t)}return a}function P(e){const t=new Set;e.forEach((e=>{0!==e.valueOf()&&(t.has(e.valueOf())||t.add(e.valueOf()))}));const a=Array.from(t).map((e=>new Date(e)));return Array.from(a).sort(((e,t)=>e.getTime()-t.getTime()))}const T=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const E="object"==typeof global&&global&&global.Object===Object&&global;var A="object"==typeof self&&self&&self.Object===Object&&self;const G=E||A||Function("return this")();const _=function(){return G.Date.now()};var z=/\s/;const V=function(e){for(var t=e.length;t--&&z.test(e.charAt(t)););return t};var B=/^\s+/;const $=function(e){return e?e.slice(0,V(e)+1).replace(B,""):e};const W=G.Symbol;var U=Object.prototype,J=U.hasOwnProperty,q=U.toString,Z=W?W.toStringTag:void 0;const K=function(e){var t=J.call(e,Z),a=e[Z];try{e[Z]=void 0;var i=!0}catch(e){}var o=q.call(e);return i&&(t?e[Z]=a:delete e[Z]),o};var Q=Object.prototype.toString;const H=function(e){return Q.call(e)};var Y=W?W.toStringTag:void 0;const X=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Y&&Y in Object(e)?K(e):H(e)};const ee=function(e){return null!=e&&"object"==typeof e};const te=function(e){return"symbol"==typeof e||ee(e)&&"[object Symbol]"==X(e)};var ae=/^[-+]0x[0-9a-f]+$/i,ie=/^0b[01]+$/i,oe=/^0o[0-7]+$/i,ne=parseInt;const re=function(e){if("number"==typeof e)return e;if(te(e))return NaN;if(T(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=T(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=$(e);var a=ie.test(e);return a||oe.test(e)?ne(e.slice(2),a?2:8):ae.test(e)?NaN:+e};var se=Math.max,le=Math.min;const ue=function(e,t,a){var i,o,n,r,s,l,u=0,d=!1,c=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var a=i,n=o;return i=o=void 0,u=t,r=e.apply(n,a)}function h(e){var a=e-l;return void 0===l||a>=t||a<0||c&&e-u>=n}function v(){var e=_();if(h(e))return p(e);s=setTimeout(v,function(e){var a=t-(e-l);return c?le(a,n-(e-u)):a}(e))}function p(e){return s=void 0,m&&i?f(e):(i=o=void 0,r)}function g(){var e=_(),a=h(e);if(i=arguments,o=this,l=e,a){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),d?f(e):r}(l);if(c)return clearTimeout(s),s=setTimeout(v,t),f(l)}return void 0===s&&(s=setTimeout(v,t)),r}return t=re(t)||0,T(a)&&(d=!!a.leading,n=(c="maxWait"in a)?se(re(a.maxWait)||0,t):n,m="trailing"in a?!!a.trailing:m),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,i=l=o=s=void 0},g.flush=function(){return void 0===s?r:p(_())},g},de=e.React.forwardRef(((i,o)=>{var n;const[r,s]=e.React.useState({}),[u,d]=e.React.useState(!1),[c,m]=e.React.useState(!0),[f,h]=e.React.useState(),v=e.hooks.useTranslation(a),{config:p,widgetId:g,referentItem:y,isDataSourceReady:S,onSubmit:N,onValidationChanged:I,intl:R,reset:w}=i,D=null==y?void 0:y.displayName,x=e.React.useRef(null),M=e.React.useRef((e=>{}));(0,b.useImperativeHandle)(o,(()=>({submitForm:ae})));const F=e.React.useMemo((()=>S&&c&&u),[S,c,u]);e.React.useEffect((()=>{W()}),[w]),e.React.useEffect((()=>{I(F)}),[F,I]);const j=e.React.useRef(null),C=e.React.useRef(null),O=e.React.useRef(null),L=e.React.useRef(null),k=e.React.useRef(null),P=e.React.useRef(!1),T=e.React.useRef(!1),[E,A]=e.React.useState(null),[G,_]=e.React.useState(null),[z,V]=e.React.useState(!1),[B,$]=e.React.useState([]);e.React.useEffect((()=>{W(),M.current=ue(U,400)}),[y]);const W=()=>{A(null),_(null),setTimeout((()=>{C.current.select(),C.current.focus(),C.current.blur(),O.current.select(),O.current.focus(),O.current.blur()}),200)},U=e.hooks.useEventCallback((e=>{const a=null==y?void 0:y.displayName,i=f,o=(0,t.getSuggestions)(a,e,i);Promise.all([o]).then((e=>{const t=null==e?void 0:e[0];t&&$(t),j.current&&V(!0)})).catch((e=>{}))})),J=e=>{A(e),j.current=e},q=()=>{var e;null===(e=C.current)||void 0===e||e.focus(),Z(!0,!1)},Z=(e=!1,t=!0)=>{e||(T.current=!1)},K=e=>{if(isNaN(Number(e))){const t=function(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let i=100*parseInt(a[0],10);return isNaN(i)?i=NaN:2===a.length&&(t?i-=parseFloat(a[1]):i+=parseFloat(a[1])),i}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let i=1e3*parseInt(a[0],10);return isNaN(i)?i=NaN:2===a.length&&(t?i-=parseFloat(a[1]):i+=parseFloat(a[1])),i}return NaN}(e);return isNaN(t)?(H(NaN,!1),{valid:!1,msg:v("invalidOffset")}):(H(t,!0),{valid:!0})}return H(Number(""===e?NaN:e),!0),{valid:!0}},Q=e=>e?new Promise((t=>{setTimeout((()=>{const a=[];k.current&&(e=k.current);const i=f,o={},n=ee(y.displayName),r=te(e);r&&(e=r),"NUMBER"===n?o.where=`${y.displayName} = ${e}`:"STRING"===n&&(o.where=`${y.displayName} = '${e}'`);const s=i.query(o).then((e=>{const t=null==e?void 0:e.records,o=[],n=i.getLayerDefinition(),r=null==n?void 0:n.objectIdField,s=null==y?void 0:y.fromDateFieldName;return(null==t?void 0:t.length)>0&&t.forEach((e=>{const t=null==e?void 0:e.getFieldValue(r);o.push(t)})),(null==t?void 0:t.length)>0&&(t.forEach((e=>{const t=null==e?void 0:e.getFieldValue(r),i=null==e?void 0:e.getFieldValue(s);a[t]=i})),X(a)),(null==o?void 0:o.length)>0?(Y(o,!0),{valid:!0}):(Y(o,!1),{valid:!1,msg:v("invalidReferent")})})).catch((e=>(console.error(e),{valid:!1,msg:v("invalidReferent")})));t(s)}),200)})):(d(!1),{valid:!0}),H=(e,t)=>{const a=r;a.offset=e,m(t),s(a)},Y=(e,t)=>{const a=r;a.objectId=e,d(t),s(a)},X=e=>{const t=r;t.objectIdFromDt=e,s(t)},ee=e=>{const t=null==y?void 0:y.layerFields;for(let a=0;a<t.length;a++)if(t[a].name===e)return t[a].type},te=e=>{const t=null==y?void 0:y.allFields;let a,i=[];return(null==t?void 0:t.length)>0&&t.forEach((e=>{var t,a;(null==e?void 0:e.name)===D&&"codedValue"===(null===(t=null==e?void 0:e.domain)||void 0===t?void 0:t.type)&&(i=null===(a=null==e?void 0:e.domain)||void 0===a?void 0:a.codedValues)})),(null==i?void 0:i.length)>0&&i.forEach((t=>{t.name===e&&(a=t.code)})),a||null},ae=()=>{(()=>{const e=G||0,t=E;setTimeout((()=>{K(e),setTimeout((()=>{Q(t),setTimeout((()=>{const e=[],t=null==r?void 0:r.objectId,a=null==y?void 0:y.layerId,i=(null==r?void 0:r.offset)||0,o=null==r?void 0:r.objectIdFromDt;null==t||t.forEach((t=>{e.push({layerId:a,offset:i,objectId:t})})),N(e,o)}),200)}),200)}),200)})()},ie=(0,t.GetUnits)(null===(n=null==p?void 0:p.resultConfig)||void 0===n?void 0:n.defaultOffsetUnit,R),oe=v("offsetlabel",{unit:ie}),ne=v("referentDisplayName",{displayName:D});return(0,e.jsx)("div",{className:"search-method-form h-100",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-referent-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-referent-form__content"},(0,e.jsx)(e.DataSourceComponent,{useDataSource:null==y?void 0:y.useDataSource,onDataSourceCreated:e=>{h(e)}}),(0,e.jsx)("div",{className:"search-method-form__method-label px-3 pt-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-1",style:{alignItems:"center",fontWeight:"500"}},ne),(0,e.jsx)("div",{ref:x},(0,e.jsx)(l.TextInput,{"aria-label":ne,size:"sm",type:"text",style:{width:"100%"},ref:C,allowClear:!!E,value:E||"",onChange:e=>{var t;k.current=null;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,i=(null==a?void 0:a.length)>2;if(J(a),!i)return V(!1),!1;M.current(a)},onBlur:()=>{L.current=setTimeout((()=>{P.current||V(!1),T.current||Z(!1)}),200)},disabled:!S,checkValidityOnAccept:e=>Q(e)}),E&&(0,e.jsx)(t.Intellisense,{isOpen:(z||(P.current=!1),z),reference:x,searchText:E,searchSuggestion:B,onRecordItemClick:(e,t)=>{if(t)return q(),!1;k.current=e,J(e)},id:g,searchInputRef:C}))),(0,e.jsx)("div",{className:"search-method-form__method-label px-3 pt-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-1 w-100",style:{fontWeight:"500"}},oe),(0,e.jsx)(l.TextInput,{"aria-label":oe,size:"sm",type:"text",style:{width:"100%"},ref:O,allowClear:G,value:G||"",onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;_(a)},disabled:!S,checkValidityOnAccept:e=>K(e)}))))}));var ce=function(e,t,a,i){return new(a||(a=Promise))((function(o,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const me=e.React.forwardRef(((i,o)=>{const{reset:s,isDataSourceReady:u,onSubmit:d,networkItem:c,onValidationChanged:m,coordinateGraphic:f}=i,[h,v]=e.React.useState({}),[p,g]=e.React.useState(!1),[y,S]=e.React.useState(!1),[N,I]=e.React.useState(!0),[R,w]=e.React.useState(null),[D,x]=e.React.useState(null),[M,F]=e.React.useState(null),j=e.React.useRef(null),C=e.React.useRef(null),O=e.React.useRef(null),L=e.hooks.useTranslation(a);(0,b.useImperativeHandle)(o,(()=>({submitForm:k})));const k=()=>{d(h)},P=e.React.useMemo((()=>p&&y&&N),[p,y,N]);e.React.useEffect((()=>{m(P)}),[P,m]),e.React.useEffect((()=>{w(""),x(""),F("");v({xCoordinate:NaN,yCoordinate:NaN,zCoordinate:NaN})}),[c,s]),e.React.useEffect((()=>{setTimeout((()=>{j.current.select(),j.current.focus(),j.current.blur(),C.current.select(),C.current.focus(),C.current.blur(),O.current.select(),O.current.focus(),O.current.blur()}),200)}),[s]);const T=(a,i)=>{if(isNaN(Number(a)))return G(NaN,!1,i),A(),{valid:!1,msg:L("invalidCoordinate")};""===a?G(Number(NaN),i===r.Z,i):G(Number(a),!0,i);let o=null,s=null;return(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[o,s]=e})).then((()=>ce(void 0,void 0,void 0,(function*(){const e=new o;e.x=Number(R),e.y=Number(D),e.z=M?Number(M):0,c.defaultSpatialReferenceFrom===n.Map?e.spatialReference=new s({wkid:102100}):e.spatialReference=new s({wkid:c.spatialReferenceInfo.wkid,wkt:c.spatialReferenceInfo.wkt}),E(yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e),"#FFFF00"))})))),{valid:!0}},E=e=>{(0,t.isDefined)(e)?(0,t.isDefined)(f)&&(f.removeAll(),f.add(e)):A()},A=()=>{(0,t.isDefined)(f)&&f.removeAll()},G=(e,t,a)=>{const i=h;switch(a){case r.X:i.xCoordinate=e,g(t);break;case r.Y:i.yCoordinate=e,S(t);break;case r.Z:i.zCoordinate=e,I(t)}v(i)},_=(e,t)=>{var a;const i=null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.value;switch(t){case r.X:w(i);break;case r.Y:x(i);break;case r.Z:F(i)}};return(0,e.jsx)("div",{className:"search-by-coordinates-form",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-coordinates-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-coordinates-form__content my-2"},(0,e.jsx)("div",{className:"search-by-coordinates-form__x-coordinate-label pt-2 px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-1",style:{width:"100%"}},L("xCoordinateRequiredLabel")),(0,e.jsx)(l.TextInput,{"aria-label":L("xCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:j,disabled:!u,allowClear:!!R,value:R||"",onChange:e=>{_(e,r.X)},checkValidityOnAccept:e=>T(e,r.X)})),(0,e.jsx)("div",{className:"search-by-coordinates-form__y-coordinate-label pt-2 px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-1",style:{width:"100%"}},L("yCoordinateRequiredLabel")),(0,e.jsx)(l.TextInput,{"aria-label":L("yCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:C,disabled:!u,allowClear:!!D,value:D||"",onChange:e=>{_(e,r.Y)},checkValidityOnAccept:e=>T(e,r.Y)})),(0,e.jsx)("div",{className:"search-by-coordinates-form__z-coordinate-label pt-2 px-3"},(0,e.jsx)(l.Label,{size:"default",className:"mb-1",style:{width:"100%"}},L("zCoordinateLabel")),(0,e.jsx)(l.TextInput,{"aria-label":L("zCoordinateLabel"),type:"text",size:"sm",style:{width:"100%"},ref:O,disabled:!u,allowClear:!!M,value:M||"",onChange:e=>{_(e,r.Z)},checkValidityOnAccept:e=>T(e,r.Z)}))))}));var fe=m(23001),he=m.n(fe),ve=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(a[i[o]]=e[i[o]])}return a};const pe=t=>{const a=window.SVG,{className:i}=t,o=ve(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:he()},o)):e.React.createElement("svg",Object.assign({className:n},o))};var ge=m(35737),ye=m.n(ge),Se=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(a[i[o]]=e[i[o]])}return a};const Ne=t=>{const a=window.SVG,{className:i}=t,o=Se(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:ye()},o)):e.React.createElement("svg",Object.assign({className:n},o))},Ie=e.css`
  border: 1px solid var(--ref-palette-neutral-300);
  .esri-widget__heading {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    color: var(--ref-palette-black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`;class Re extends e.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{expanded:t=!1}=this.props;this.state={showContent:t}}componentDidMount(){this.createFeature()}componentDidUpdate(){this.feature&&(this.feature.graphic.popupTemplate=this.props.popupTemplate,this.feature.visibleElements=this.getVisibleElements())}destoryFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,c.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then((e=>{[this.Feature]=e})),e.then((()=>{var e,t,a;const i=document&&document.createElement("div");i.className="jimu-widget",this.refs.featureContainer.appendChild(i);const o=this.props.dataSource.getOriginDataSources(),n=null===(e=null==o?void 0:o[0])||void 0===e?void 0:e.getRootDataSource();this.destoryFeature(),this.props.graphic.popupTemplate=this.props.popupTemplate,this.feature=new this.Feature({container:i,defaultPopupTemplateEnabled:!0,spatialReference:(null===(a=null===(t=this.props.dataSource)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,map:(null==n?void 0:n.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})}))}render(){const{togglable:t=!1,intl:a}=this.props,{showContent:i}=this.state;return(0,e.jsx)("div",{className:"item-feature-info-component d-flex align-items-center p-2",css:Ie},t&&(0,e.jsx)(l.Button,{"aria-label":a.formatMessage({id:i?"collapse":"expand"}),className:(0,e.classNames)("p-0 jimu-outline-inside",{expanded:i}),type:"tertiary",icon:!0,size:"sm",onClick:this.toggleExpanded},i?(0,e.jsx)(Ne,{size:"s"}):(0,e.jsx)(pe,{size:"s",autoFlip:!0})),(0,e.jsx)("div",{className:"flex-grow-1",ref:"featureContainer"}))}}const be=(0,e.injectIntl)(Re);var we=m(22089),De=1/0;const xe=function(e){return e?(e=re(e))===De||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Me=function(e){var t=xe(e),a=t%1;return t==t?a?t-a:t:0};const Fe=function(e,t){for(var a=-1,i=null==e?0:e.length,o=Array(i);++a<i;)o[a]=t(e[a],a,e);return o};const je=Array.isArray;var Ce=W?W.prototype:void 0,Oe=Ce?Ce.toString:void 0;const Le=function e(t){if("string"==typeof t)return t;if(je(t))return Fe(t,e)+"";if(te(t))return Oe?Oe.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a};const ke=function(e){return null==e?"":Le(e)};var Pe=G.isFinite,Te=Math.min;const Ee=function(e){var t=Math[e];return function(e,a){if(e=re(e),(a=null==a?0:Te(Me(a),292))&&Pe(e)){var i=(ke(e)+"e").split("e"),o=t(i[0]+"e"+(+i[1]+a));return+((i=(ke(o)+"e").split("e"))[0]+"e"+(+i[1]-a))}return t(e)}}("round");var Ae=function(e,t,a,i){return new(a||(a=Promise))((function(o,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function Ge(a,i,o,n){return Ae(this,void 0,void 0,(function*(){var r,s,l;const u=[];let d="";if((null==o?void 0:o.lineName)||(null==o?void 0:o.lineId)?((null===(r=o.lineName)||void 0===r?void 0:r.length)>0?d=`LOWER(${i.lineNameField.jimuName}) LIKE LOWER('${o.lineName}')`:(null===(s=null==o?void 0:o.lineId)||void 0===s?void 0:s.length)>0&&(d=`LOWER(${i.lineIdField.jimuName}) LIKE LOWER('${o.lineId}')`),o.routeId.length>0?d+=` AND LOWER(${i.routeIdField.jimuName}) LIKE LOWER('${o.routeId}')`:o.routeName.length>0?d+=` AND LOWER(${i.routeNameField.jimuName}) LIKE LOWER('${o.routeName}')`:o.routeIdFields.forEach(((t,a)=>{t&&(i.routeIdFields[a].field.type===e.JimuFieldType.Number?(d.length>0&&(d+=" AND "),d+=`${i.routeIdFields[a].field.name} LIKE ${o.routeIdFields[a]}`):t.length>0&&(d.length>0&&(d+=" AND "),d+=`LOWER(${i.routeIdFields[a].field.name}) LIKE LOWER('${o.routeIdFields[a]}')`))}))):o.routeId.length>0?d=`LOWER(${i.routeIdField.jimuName}) LIKE LOWER('${o.routeId}')`:o.routeName.length>0?d=`LOWER(${i.routeNameField.jimuName}) LIKE LOWER('${o.routeName}')`:o.routeIdFields.forEach(((t,a)=>{t&&(i.routeIdFields[a].field.type===e.JimuFieldType.Number?(d.length>0&&(d+=" AND "),d+=`${i.routeIdFields[a].field.name} LIKE ${o.routeIdFields[a]}`):t.length>0&&(d.length>0&&(d+=" AND "),d+=`LOWER(${i.routeIdFields[a].field.name}) LIKE LOWER('${o.routeIdFields[a]}')`))})),(0,t.isDefined)(a&&(0,t.isDefined)(a.layer)))return yield(0,e.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((e=>{var o;let r=null;r=e[0];const s=a.layer.createQuery();s.spatialRelationship="intersects",s.outSpatialReference=n.view.spatialReference,s.returnGeometry=!0,s.outFields=["*"],s.returnM=!0,s.returnZ=!0,s.where=d,s.orderByFields=[];const l=null===(o=null==i?void 0:i.sortOptions)||void 0===o?void 0:o.filter((e=>(0,t.isDefined)(e.jimuFieldName)));(null==l?void 0:l.length)>0&&Object.assign(s.orderByFields,i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`)));const c=a.getCurrentQueryParams();return(null==c?void 0:c.time)&&(s.timeExtent=new r({start:c.time[0],end:c.time[1]})),a.layer.queryFeatures(s).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features.map((e=>a.buildRecord(e))):u})).catch((e=>u))}));{const e=a.getCurrentQueryParams(),o={returnGeometry:!0,returnM:!0,returnZ:!0,where:d,time:null==e?void 0:e.time,outFields:["*"],notAddFieldsToClient:!0},n=null===(l=null==i?void 0:i.sortOptions)||void 0===l?void 0:l.filter((e=>(0,t.isDefined)(e.jimuFieldName)));return(null==n?void 0:n.length)>0&&Object.assign(o,{orderByFields:i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))}),a.query(o).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:u})).catch((e=>u))}}))}function _e(a,i,o,n,r,s,l,u,d){return Ae(this,void 0,void 0,(function*(){return new Promise(((c,m)=>{try{const m=l.routeIdFieldName,f=l.routeNameFieldName,h=l.fromDateFieldName,v=[];if(!i||!i.layer)return void c(null);const p=i.layer.createQuery();p.geometry=a,p.units="meters",p.spatialRelationship="intersects",p.outFields=[m,f,h],p.timeExtent=new r({start:o,end:n});let g=0;i.layer.queryFeatures(p).then((i=>Ae(this,void 0,void 0,(function*(){const o=[],n=[];i.features.forEach((e=>{const t=e.attributes[m],i=e.attributes[f],r=s.getData()[d],l=e.attributes[h];o.includes(t)||r!==t||(l>g&&(g=l),v[t]=i,o.push(t),n.push({routeId:t,geometry:a}))}));const r=a.spatialReference.wkid;if(!n||0===n.length)return void c(null);const p=yield function(a,i,o,n,r){return Ae(this,void 0,void 0,(function*(){const s=i.networkUrl,l={f:"json",token:yield e.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:a,inSR:n,gdbVersion:o,temporalViewDate:(0,t.isDefined)(r)&&0!==r.valueOf()?r:""};o&&(l.gdbVersion=o),r&&(l.temporalViewDate=r);const u=`${s}/geometryToMeasure`;return yield(0,t.requestService)({method:"POST",url:u,params:l})}))}(n,l,u,r,g),y=p.locations;y&&0!==y.length||c(null),y.forEach((e=>{const t=e.status;if("esriLocatingOK"===t||"esriLocatingMultipleLocation"===t){e.results.forEach((e=>{const t={routeId:e.routeId,routeName:v[e.routeId],measure:e.measure};return c(t),t}))}})),c(null)}))))}catch(e){console.error(e)}}))}))}function ze(a,i,o,n,r){return Ae(this,void 0,void 0,(function*(){const s=i.networkUrl,l={f:"json",token:yield e.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:a,offsetUnit:o};n&&(l.gdbVersion=n),r&&(l.temporalViewDate=r);const u=`${s}/referentToGeometry`;return yield(0,t.requestService)({method:"POST",url:u,params:l})}))}function Ve(e,t){const a=e.getData(),i=a[t.fromDateFieldName],o=a[t.toDateFieldName]||null,n=a[C.at(3).value],r=a[C.at(4).value]||null;return i<=n&&(n<o||null===o)||n<=i&&(i<r||null===r)}function Be(a,i,o,n,r,s,l,u,d,c,m,f,h){return Ae(this,void 0,void 0,(function*(){const l=[],u=n.getOriginDataSources()[0],h=yield $e(u);let v=null,p=null;return(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic"]).then((e=>{[v,p]=e})).then((()=>Ae(this,void 0,void 0,(function*(){return yield Promise.all(o.map(((e,a)=>Ae(this,void 0,void 0,(function*(){const o=e.getData(),u=e.getGeometry(),h=new v(u),g=h.getPoint(0,0),y=h.paths[h.paths.length-1].length-1,S=h.getPoint(h.paths.length-1,y);o[D.at(0).value]=Ee(g.m,r),o[D.at(1).value]=Ee(S.m,r),o[j.value]=e.getId(),o.OBJECTID=a+1;const N=o[i.fromDateFieldName],I=o[i.toDateFieldName],R=i.lineIdFieldName;if((0,t.isDefined)(c)){const t=yield _e(g,m,N,I,d,e,c,f,R),a=yield _e(S,m,N,I,d,e,c,f,R);t&&(o[x.at(0).value]=t.routeName,o[x.at(1).value]=t.routeId,o[x.at(2).value]=Ee(t.measure,r)),a&&(o[x.at(3).value]=Ee(a.measure,r))}I&&(o[i.toDateFieldName]=(0,t.getDateWithTZOffset)(I,n.getOriginDataSources()[0]).valueOf()),N&&(o[i.fromDateFieldName]=(0,t.getDateWithTZOffset)(N,n.getOriginDataSources()[0]).valueOf());const b=new p({geometry:h,attributes:o});if((0,t.isDefined)(s)){const e=yield(0,t.getPolylineMidPoint)(h),a=new p({geometry:e,attributes:o});yield s.applyEdits({addFeatures:[a.clone()]})}const w=n.buildRecord(b);l.push(w)}))))),l.forEach((e=>{const t=e.feature;t.sourceLayer=h.associatedLayer||h,t.layer=t.sourceLayer})),n.setSourceRecords(l),n.setStatus(e.DataSourceStatus.Unloaded),n.setCountStatus(e.DataSourceStatus.Unloaded),We(n,a),yield Ue(n,l,i)}))))}))}function $e(e){return Ae(this,void 0,void 0,(function*(){if(null==e?void 0:e.layer)return yield e.layer.load(),e.layer;{const t=yield e.createJSAPILayerByDataSource();return yield t.load(),t}}))}function We(t,a){if(!t)return;const i=t.getOriginDataSources()[0],o=i.getPopupInfo(),n=i.getLayerDefinition(),r=(e=>{return e.length?e:[{fieldName:null!==(t=null==n?void 0:n.objectIdField)&&void 0!==t?t:"objectid",label:"OBJECTID",tooltip:"",visible:!0}];var t})(((null==o?void 0:o.fieldInfos)||[]).filter((e=>e.visible))),s=new e.DataRecordSetChangeMessage(a,e.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:t,name:t.id}]);e.MessageManager.getInstance().publishMessage(s)}const Ue=(e,a,i)=>Ae(void 0,void 0,void 0,(function*(){var o;const n={returnGeometry:!0,where:"1=1",outFields:["*"],notAddFieldsToClient:!0},r=null===(o=null==i?void 0:i.sortOptions)||void 0===o?void 0:o.filter((e=>(0,t.isDefined)(e.jimuFieldName)));return(null==r?void 0:r.length)>0?(Object.assign(n,{orderByFields:i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))}),yield e.query(n).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:a})).catch((e=>a))):a}));function Je(e,t){const a={};t.allFieldsDetails.forEach((e=>{a[e.jimuName]=e.alias}));return Object.keys(e).forEach((t=>{const i=a[t];e[i]=e[t],delete e.key})),e}const qe=e.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    .item-feature-info-component {
      border-color: var(--sys-color-primary-main);
      border-width: 2px;
    }
  }
`,Ze=a=>{const{config:i,measureType:o,widgetId:n,autoSelect:r,network:s,data:l,outputDS:u,inputDS:d,highlightGraphicLayer:m,flashGraphicsLayer:f,highlightStyle:h,jimuMapView:v,intl:p,selectedMethod:g}=a,y=e.ReactRedux.useSelector((e=>{var t,a,i;return null===(i=null===(a=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[u.id])||void 0===a?void 0:a.selectedIds)||void 0===i?void 0:i.includes(l.getId())}));e.React.useEffect((()=>{r&&b()}),[r]);const S=e.React.useCallback((e=>{const a=e;(0,t.getGeometryGraphic)(null==a?void 0:a.getFeature(),"#FFFF00",h.size,!0).then((e=>{f&&e&&(f.removeAll(),f.add(e),setTimeout((()=>{f.removeAll(),setTimeout((()=>{f.add(e),setTimeout((()=>{f.removeAll()}),800)}),800)}),800))}))}),[f,h.size]),N=e.React.useCallback((e=>{c.geometryUtils.projectToSpatialReference([e.geometry],v.view.spatialReference).then((t=>{const a=new we.default({geometry:t[0],symbol:e.symbol});"point"===a.geometry.type?null==v||v.view.goTo({target:t,zoom:100}):null==v||v.view.goTo({center:a.geometry.extent.expand(1.25)})}))}),[v.view]),I=e.React.useCallback((e=>{(function(e,a,i,o){return Ae(this,void 0,void 0,(function*(){const n=e.getFieldValue(i.routeIdField.name),r=`${i.routeIdField.name} = '${n}'`;if((0,t.isDefined)(a&&(0,t.isDefined)(a.layer))){const t=a.layer.createQuery();t.spatialRelationship="intersects",t.outSpatialReference=o.view.spatialReference,t.returnGeometry=!0,t.outFields=["*"],t.returnM=!0,t.returnZ=!0,t.where=r;const i=e.getFieldValue(j.value);return a.layer.queryFeatures(t).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features.map((e=>a.buildRecord(e))).find((e=>e.getId()===i)):null})).catch((e=>null))}{const t={returnGeometry:!0,returnM:!0,returnZ:!0,where:r,spatialRel:"esriSpatialRelIntersects"},i=e.getFieldValue(j.value);return a.query(t).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records.find((e=>e.getId()===i)):null})).catch((e=>null))}}))})(e,d,s,v).then((a=>{(0,t.isDefined)(a)&&S(a);const i=e;(0,t.getGeometryGraphic)(null==i?void 0:i.getFeature(),h.color,h.size,!0).then((e=>{m&&e&&(m.removeAll(),m.add(e),N(e))}))}))}),[S,m,h.color,h.size,d,v,s,N]),R=e.React.useCallback((()=>{m&&m.removeAll()}),[m]),b=e.React.useCallback((()=>{var t,a;const i=u.id,o=l.getId(),r=(null!==(t=u.getSelectedRecordIds())&&void 0!==t?t:[]).includes(o)?[]:[l];i&&(null==r?void 0:r.length)>0?(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(n,r,[i])),null===(a=u.selectRecordsByIds)||void 0===a||a.call(u,r.map((e=>e.getId()))),I(l)):R()}),[l,u,n,I,R]);return(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-result-item",{selected:y}),onClick:b,css:qe,role:"option","aria-selected":y,tabIndex:0},(0,e.jsx)(be,{graphic:l.feature,togglable:!0,dataSource:u,popupTemplate:O(p,l.feature,u,s,g,o,i),expanded:s.expandByDefault,selectedMethod:g}))};var Ke,Qe=m(1888);!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(Ke||(Ke={}));(0,Qe.withTheme)((t=>{const{theme:a,className:i,title:o,statusType:n}=t;return n&&(0,e.jsx)("div",{className:`${null!=i?i:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${n}`,title:o,css:e.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(s=null===(r=null==a?void 0:a.ref.palette)||void 0===r?void 0:r.neutral)||void 0===s?void 0:s[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(l=null==a?void 0:a.sys.color)||void 0===l?void 0:l.primary)||void 0===u?void 0:u.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var r,s,l,u}));var He=function(e,t,a,i){return new(a||(a=Promise))((function(o,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const{useRef:Ye,useState:Xe}=e.React,et=t=>e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 auto;
      max-height: auto;
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .search-by-route-result-item + .search-by-route-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.list {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .search-by-route-result-item + .search-by-route-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
  `;function tt(t){const{config:a,widgetId:i,networkItem:o,selectedMethod:n,outputDS:r,inputDS:s,resultCount:u,records:d,highlightGraphicsLayer:c,flashGraphicsLayer:m,highlightStyle:f,jimuMapView:h,onRenderDone:v,intl:p,measureType:g,defaultPageSize:y=25}=t,[S,N]=Xe(d),[I,R]=Xe(Ke.Init),b=Ye(1),w=Ye(y),[D,x]=Xe(y);e.React.useEffect((()=>{b.current=1,N(d),x(w.current)}),[d]);const M=e.React.useCallback(((e,t)=>He(this,void 0,void 0,(function*(){b.current=e,R(Ke.Loading);const a=r.getRecordsByPage(e,t);N(a),null==v||v({dataItems:a,pageSize:t,page:b.current}),R(Ke.Loaded)}))),[v,r]);return e.React.useEffect((()=>{y!==w.current&&(y<w.current?N(S.slice(0,y)):M(1,y),w.current=y,x(y))}),[y,S,M]),(0,e.jsx)("div",{className:"list",css:et(!0)},(0,e.jsx)("div",{className:"list_items mb-2 px-3",role:"listbox"},null==S?void 0:S.map(((t,l)=>(0,e.jsx)(Ze,{config:a,key:t.getId()+l,autoSelect:1===d.length,network:o,data:t,outputDS:r,inputDS:s,widgetId:i,highlightGraphicLayer:c,flashGraphicsLayer:m,highlightStyle:f,jimuMapView:h,intl:p,selectedMethod:n,measureType:g})))),I===Ke.Loading&&(0,e.jsx)(l.Loading,{type:l.LoadingType.Donut}),u>0&&(0,e.jsx)("div",{className:"d-flex justify-content-s align-items-center px-3 pb-3",style:{justifyContent:"space-evenly"}},(0,e.jsx)(l.Pagination,{className:"d-flex justify-content-end",disabled:I===Ke.Loading,current:b.current,totalPage:Math.ceil(u/D),onChangePage:e=>M(e,D),pageSize:D,showQuickJumper:Math.ceil(u/D)>1})))}var at=m(96300),it=m.n(at),ot=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(a[i[o]]=e[i[o]])}return a};const nt=t=>{const a=window.SVG,{className:i}=t,o=ot(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:it()},o)):e.React.createElement("svg",Object.assign({className:n},o))};var rt=m(59620);const st=e.css`
  display: flex;
  flex-direction: column;

  .search-by-route-result__header {
    color: var(--ref-palette-neutral-1100);
    font-weight: 500;
    font-size: 14px;
    line-height: 18px;
  }

  .search-by-route-result-container {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    overflow: auto
  }

  .search-by-route-result-info {
    height: 18px;
  }
`;function lt(t){var i,o;const{config:n,currentNetwork:r,selectedMethod:s,resultCount:u,maxPerPage:d,records:c,routeRecords:m,defaultPageSize:f,widgetId:h,outputDS:v,inputDS:p,isPoint:g,jimuMapView:y,highlightStyle:S,intl:N,measureType:I,onNavBack:R}=t,b=e.hooks.useTranslation(a),[w,D]=e.React.useState(null),[x,M]=e.React.useState([]),[F,C]=e.React.useState(null),[O,L]=e.React.useState(null),k=e.React.useRef(),P=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[h].enableDataAction)||void 0===t||t})),T=e.React.useMemo((()=>{const e=null==v?void 0:v.getOriginDataSources()[0],t=null==e?void 0:e.getLayerDefinition();let a=!1;const i=[];return null==m||m.forEach((e=>{const o=e.clone();o.getFieldValue(j.value)&&o.getFieldValue(j.value).length>0&&(o.getData()[t.objectIdField]=o.getFieldValue(j.value),a=!0),i.push(o)})),{dataSource:a?null==v?void 0:v.getOriginDataSources()[0]:v,type:(null==x?void 0:x.length)>0?"selected":"loaded",records:a?i:(null==x?void 0:x.length)>0?x:null==w?void 0:w.records,name:null==v?void 0:v.getLabel()}}),[m,x,v,w]);e.hooks.useEffectOnce((()=>{k.current.focus()})),e.React.useEffect((()=>{var e,t;if(D({records:c,pageSize:f,page:1}),(!F||!O)&&y){const a=new rt.default({listMode:"hide"}),i=new rt.default({listMode:"hide"});null===(t=null===(e=null==y?void 0:y.view)||void 0===e?void 0:e.map)||void 0===t||t.addMany([a,i]),C(a),L(i)}}),[c,f,null===(i=null==y?void 0:y.view)||void 0===i?void 0:i.map,F,O,y]);const E=e.React.useCallback((({dataItems:e,pageSize:t,page:a})=>{D({records:e,pageSize:t,page:a})}),[]),A=e.React.useCallback((()=>{if(w){const e=(w.page-1)*w.pageSize+1,t=e+w.pageSize-1;return u>0?`${b("resultsDisplay")} ${e} - ${Math.min(t,u)} / ${u}`:`${b("resultsDisplay")}: 0 - 0 / 0`}return""}),[w,u,b]),G=e.React.useCallback((e=>{var t;"Escape"===e.key&&(e.stopPropagation(),null===(t=k.current)||void 0===t||t.focus())}),[]),_=()=>{F&&(F.removeAll(),F.destroy(),C(null)),O&&(O.removeAll(),O.destroy(),L(null))},z=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:g?r.outputPointDsId:r.outputLineDsId,mainDataSourceId:g?r.outputPointDsId:r.outputLineDsId})),[r.outputLineDsId,r.outputPointDsId,g]),V=e.React.useCallback((()=>{var t;const a=e.DataSourceManager.getInstance().getDataSource(null==v?void 0:v.id),i=null==a?void 0:a.getSelectedRecords(),o=null!==(t=null==a?void 0:a.getSelectedRecordIds())&&void 0!==t?t:[];let n=!1;n=o.length!==x.length||o.some((e=>null==x.find((t=>t.getId()===e)))),n&&M(i)}),[null==v?void 0:v.id,x]);return(0,e.jsx)("div",{className:"search-by-route-result h-100 pt-3",onKeyUp:G,css:st,role:"listbox","aria-label":b("results")},(0,e.jsx)(e.DataSourceComponent,{useDataSource:z,onDataSourceInfoChange:V}),(0,e.jsx)("div",{className:"search-by-route-result__header d-flex align-items-center px-3"},(0,e.jsx)(l.Tooltip,{title:b("backLabel")},(0,e.jsx)(l.Button,{ref:k,className:"p-0 mr-2",size:"sm",type:"tertiary",icon:!0,onClick:()=>{_(),R(),D(null)}},(0,e.jsx)(nt,{autoFlip:!0}))),r.name,(null===(o=null==w?void 0:w.records)||void 0===o?void 0:o.length)>0&&P&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(l.DataActionList,{widgetId:h,dataSets:[T],listStyle:l.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"})))),(0,e.jsx)("div",{className:"search-by-route-result-container mt-1"},(0,e.jsx)("div",{className:"search-by-route-result-info mb-2 px-3",role:"alert","aria-live":"polite"},A()),u>0&&(0,e.jsx)(tt,{config:n,widgetId:h,networkItem:r,selectedMethod:s,measureType:I,outputDS:v,inputDS:p,resultCount:u,maxPerPage:d,records:c,highlightGraphicsLayer:F,flashGraphicsLayer:O,highlightStyle:S,jimuMapView:y,onRenderDone:E,defaultPageSize:f,intl:N})))}function ut(t){const{networkItem:a,dataSourceReady:i,onCreateDs:o,onCreatePointDs:n,onCreateLineDs:r}=t,[s,l]=e.React.useState(null!=a?a:null);e.React.useEffect((()=>{a&&l(a)}),[a]);const u=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:s.outputLineDsId,mainDataSourceId:s.outputLineDsId})),[s.outputLineDsId]),d=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:s.outputPointDsId,mainDataSourceId:s.outputPointDsId})),[s.outputPointDsId]),c=e.React.useCallback((e=>{o(e)}),[o]),m=e.React.useCallback((t=>{if(t){const{status:a,instanceStatus:o}=t;o===e.DataSourceStatus.NotCreated||o===e.DataSourceStatus.CreateError||a===e.DataSourceStatus.LoadError||a===e.DataSourceStatus.NotReady?i(!1):i(!0)}}),[i]),f=e.React.useCallback((()=>{i(!1)}),[i]);return(0,e.jsx)("div",null,(0,e.jsx)(e.DataSourceComponent,{useDataSource:u,onDataSourceCreated:e=>{r(e)}}),(0,e.jsx)(e.DataSourceComponent,{useDataSource:d,onDataSourceCreated:e=>{n(e)}}),(0,e.jsx)(e.DataSourceComponent,{useDataSource:s.useDataSource,onDataSourceInfoChange:m,onCreateDataSourceFailed:f,onDataSourceCreated:c}))}var dt=m(77958);const ct=e.React.forwardRef(((t,a)=>{const{widgetId:i,config:n,reset:r,networkItem:l,dataSource:u,isDataSourceReady:d,intl:c,onSubmit:m,onValidationChanged:f}=t,[h,p]=e.React.useState({}),[y,S]=e.React.useState(!1),[N,I]=e.React.useState(!0),[w,D]=e.React.useState(s.Single);(0,b.useImperativeHandle)(a,(()=>({submitForm:x}))),e.React.useEffect((()=>{var e;let t=s.Single;l.searchSingle?t=s.Single:l.searchMultiple?t=s.Multiple:l.searchRange&&(t=s.Range),D(t);const a={routeId:"",routeName:"",lineId:"",lineName:"",routeIdFields:new Array(null===(e=null==l?void 0:l.routeIdFields)||void 0===e?void 0:e.length).fill(""),measure:NaN,station:"",fromMeasure:NaN,fromStation:"",toMeasure:NaN,toStation:"",measures:[NaN],stations:[""],isPoint:!1,searchMeasureBy:t};p(a)}),[l,r]);const x=()=>{const e=Object.assign({},h);e.isMeasureToGeometryOperation=!1,e.isPoint=!1,e.searchMeasureBy===s.Single?isNaN(e.measure)||(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):e.searchMeasureBy===s.Multiple?e.measures.some((e=>!isNaN(e)))&&(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):(e.isPoint=!1,isNaN(e.fromMeasure)&&isNaN(e.toMeasure)||(isNaN(e.fromMeasure)&&!isNaN(e.toMeasure)&&(e.fromMeasure=e.toMeasure,e.toMeasure=NaN,e.isPoint=!0),!isNaN(e.fromMeasure)&&isNaN(e.toMeasure)&&(e.isPoint=!0),e.isMeasureToGeometryOperation=!0)),m(e)},M=e.React.useMemo((()=>d&&y&&N),[d,y,N]);e.React.useEffect((()=>{f(M)}),[M,f]);const F=e.React.useCallback(((e,t)=>{p(e)}),[]),j=e.React.useCallback(((e,t,a)=>{p(e),l.defaultLineIdentifier===o.LineId&&""===e.lineId||l.defaultLineIdentifier===o.LineName&&""===e.lineName?S(!1):S(t)}),[l.defaultLineIdentifier]),C=e.React.useCallback((e=>{const t=h;t.searchMeasureBy=e,p(t),D(e)}),[h]),O=e.React.useCallback(((e,t)=>{p(e),I(t)}),[]);return(0,e.jsx)("div",{className:"search-by-measure-form",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-measure-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-measure-form__content pt-3"},(0,e.jsx)(v,{reset:r,intl:c,widgetId:i,config:n,networkItem:l,dataSource:u,routeAndMeasureRequest:h,isDataSourceReady:d,onChange:F,onAccept:j,type:"lineMeasure"}),(0,e.jsx)(g,{networkItem:l,searchMeasureBy:w,onChange:C}),(0,e.jsx)(R,{reset:r,intl:c,networkItem:l,dataSource:u,isDataSourceReady:d,searchMeasureBy:w,routeAndMeasureRequest:h,onChange:O})))}));var mt=function(e,t,a,i){return new(a||(a=Promise))((function(o,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function ft(i){var o,r,u,d;const c=e.hooks.useTranslation(a),{widgetId:m,jimuMapView:f,config:v,intl:p,hideTitle:g,coordinateGraphic:y}=i,[S,N]=e.React.useState((0,e.Immutable)(null===(o=v.networkItems)||void 0===o?void 0:o.find((e=>!(null==e?void 0:e.referent))))),[I,R]=e.React.useState((0,e.Immutable)(null===(r=v.networkItems)||void 0===r?void 0:r.find((e=>null==e?void 0:e.referent)))||null),[b,O]=e.React.useState(t.SearchMethod.Measure),[T,E]=e.React.useState(0),[A,G]=e.React.useState(0),[_,z]=e.React.useState(null),[V,B]=e.React.useState(null),[$,W]=e.React.useState(!1),[U,J]=e.React.useState(null),[q,Z]=e.React.useState(!1),[K,Q]=e.React.useState(!1),[H,Y]=e.React.useState(!1),[X,ee]=e.React.useState(),[te,ae]=e.React.useState(""),[ie,oe]=e.React.useState(!1),[ne,re]=e.React.useState(null),[se,le]=e.React.useState(null),ue=e.React.useRef(null),ce=e.React.useRef(null),fe=function(t){const{widgetId:a,useDataSourceId:i}=t;return e.ReactRedux.useSelector((e=>{var t;let o;return o=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=o.widgets[a].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===i))}))}({widgetId:i.widgetId,useDataSourceId:null===(u=null==S?void 0:S.useDataSource)||void 0===u?void 0:u.dataSourceId}),he="search-by-route-layer-",[ve,pe]=e.React.useState(!0),ge=e.React.useRef(null),ye=e.React.useRef(null),Se=e.React.useRef(null),Ne=e.React.useRef(null);e.React.useEffect((()=>{var t,a,i;if((null===(t=v.networkItems)||void 0===t?void 0:t.length)>0){const t=null===(i=null===(a=null==v?void 0:v.resultConfig)||void 0===a?void 0:a.defaultReferentLayer)||void 0===i?void 0:i.layerId,o=v.networkItems.find((e=>(null==e?void 0:e.layerId)===t));R((0,e.Immutable)(o)),re((0,e.Immutable)(o));for(let e=0;e<v.networkItems.length;e++){const t=v.networkItems[e];if(!(null==t?void 0:t.referent)){N(t);break}}}}),[]),e.React.useEffect((()=>{K&&(ee("error"),ae(te),Y(!0),setTimeout((()=>{Y(!1),Q(!1)}),5e3))}),[K,c,te]),e.React.useEffect((()=>{for(let a=0;a<v.networkItems.length;a++){const a=v.networkItems.find((e=>(null==e?void 0:e.name)===v.defaultNetwork));if((0,t.isDefined)(a)&&!(null==a?void 0:a.referent)){N((0,e.Immutable)(a)),(null==a?void 0:a.defaultMethod)&&O(a.defaultMethod);break}}}),[v.defaultNetwork,v.networkItems]),e.React.useEffect((()=>{if((0,t.isDefined)(v.resultConfig.defaultReferentLayer)){const a=v.networkItems.find((e=>e.name===v.resultConfig.defaultReferentLayer.name));(0,t.isDefined)(a)&&R((0,e.Immutable)(a))}}),[v.resultConfig.defaultReferentLayer]);const Ie=()=>{(0,t.isDefined)(y)&&y.removeAll()},Re=e.React.useCallback((()=>{if(_&&V){const t=$?V.id:_.id,a=new e.DataRecordSetChangeMessage(m,e.RecordSetChangeType.Remove,[t]);e.MessageManager.getInstance().publishMessage(a)}}),[_,V,$,m]),be=e.React.useCallback((a=>mt(this,void 0,void 0,(function*(){let i=null,o=null;const n=U;let r,l;if(a.isPoint?(W(!0),r=V):(W(!1),r=_),v.labelStyle.size>0){const e=k(((null==n?void 0:n.layer)||(yield n.createJSAPILayerByDataSource())).fields),i=L(S,a.isPoint);l=yield(0,t.createLabelLayer)(e,f,i,he,v.labelStyle.color,v.labelStyle.size)}Re(),ue.current=null,yield(0,e.loadArcGISJSAPIModules)(["esri/TimeExtent","esri/geometry/Point"]).then((e=>{[i,o]=e})).then((()=>mt(this,void 0,void 0,(function*(){Ge(n,S,a,f).then((o=>{(function(a,i,o,n,r,l,u,d,c){return Ae(this,void 0,void 0,(function*(){const u=o.lrsNetworkId,m=d.networkItems.find((e=>u===e.derivedFromNetworkId&&e.isDerived)),f=e.DataSourceManager.getInstance(),h=(0,t.isDefined)(m)&&f.getDataSource(m.useDataSource.dataSourceId),v=i.getOriginDataSources()[0],p=yield $e(v);let g=v.getGDBVersion();if(g||(g=""),!r.isMeasureToGeometryOperation)return Be(a,o,n,i,o.measurePrecision,l,0,0,c,m,h,g);const y=o.networkUrl,S=`${y}/measureToGeometry`,N=yield e.SessionManager.getInstance().getSessionByUrl(y).getToken(y),I=[];for(const e of n){const a=e.getData()[o.fromDateFieldName],i=(0,t.isDefined)(a)?new Date(a):new Date(0);I.push(i)}const R=P(I);let b=0;const w=[];return yield Promise.all(R.map((a=>Ae(this,void 0,void 0,(function*(){const u=[],d=[];n.forEach((e=>{const i=e.getData()[o.fromDateFieldName],n=(0,t.isDefined)(i)?new Date(i):new Date(0);if(a.valueOf()===n.valueOf()){const t=e.getFieldValue(o.routeIdField.jimuName);u.push(t),r.searchMeasureBy===s.Single?d.push({routeId:t,measure:Ee(r.measure,o.measurePrecision),station:r.station}):r.searchMeasureBy===s.Multiple?r.measures.forEach(((e,a)=>{d.push({routeId:t,measure:Ee(e,o.measurePrecision),station:r.stations.at(a)})})):isNaN(r.toMeasure)?d.push({routeId:t,measure:Ee(r.fromMeasure,o.measurePrecision),station:r.fromStation}):d.push({routeId:t,fromMeasure:Ee(r.fromMeasure,o.measurePrecision),toMeasure:Ee(r.toMeasure,o.measurePrecision),fromStation:r.fromStation,toStation:r.toStation})}}));const c={f:"json",token:N,locations:d,gdbVersion:g,temporalViewDate:(0,t.isDefined)(a)&&0!==a.valueOf()?a:""};yield(0,t.requestService)({method:"POST",url:S,params:c}).then((r=>Ae(this,void 0,void 0,(function*(){if(!r||!r.locations)return w;let s=null,u=null,d=null,f=null,v=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/Graphic","esri/TimeExtent"]).then((e=>{[s,u,d,f,v]=e})).then((()=>Ae(this,void 0,void 0,(function*(){yield Promise.all(r.locations.map(((e,p)=>Ae(this,void 0,void 0,(function*(){var y;if(e&&e.geometry){const S=n.findIndex((t=>t.getFieldValue(o.routeIdField.jimuName)===e.routeId&&t.getFieldValue(o.fromDateFieldName)===c.temporalViewDate.valueOf())),N=n[S].clone(!0).getData(),I=new d({wkid:r.spatialReference.wkid}),R=o.lineIdFieldName;if("esriGeometryPoint"===e.geometryType){const r=new s(e.geometry);r.spatialReference=I,N[D.at(0).value]=Ee(r.m,o.measurePrecision),N[j.value]=n[S].getId(),N.OBJECTID=b+1,b++;const u=N[o.fromDateFieldName],d=N[o.toDateFieldName];if((0,t.isDefined)(m)){const e=yield _e(r,h,a,d,v,n[S],m,g,R);e&&(N[x.at(0).value]=e.routeName,N[x.at(1).value]=e.routeId,N[x.at(2).value]=Ee(e.measure,o.measurePrecision))}d&&(N[o.toDateFieldName]=(0,t.getDateWithTZOffset)(d,i.getOriginDataSources()[0]).valueOf()),u&&(N[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(u,i.getOriginDataSources()[0]).valueOf()),c.locations[p].station&&(N[F.at(0).value]=c.locations[p].station);const y=new f({geometry:r,attributes:N});(0,t.isDefined)(l)&&(yield l.applyEdits({addFeatures:[y.clone()]}));const M=i.buildRecord(y);w.push(M)}else{const r=new u(e.geometry);if(r.spatialReference=I,(null===(y=r.paths)||void 0===y?void 0:y.length)>0){const e=r.getPoint(0,0),s=r.paths[r.paths.length-1].length-1,l=r.getPoint(r.paths.length-1,s);N[D.at(0).value]=Ee(e.m,o.measurePrecision),N[D.at(1).value]=Ee(l.m,o.measurePrecision),N[j.value]=n[S].getId(),N.OBJECTID=b+1,b++;const u=N[o.fromDateFieldName],d=N[o.toDateFieldName];if((0,t.isDefined)(m)){const t=yield _e(e,h,a,d,v,n[S],m,g,R),i=yield _e(l,h,a,d,v,n[S],m,g,R);t&&(N[x.at(0).value]=t.routeName,N[x.at(1).value]=t.routeId,N[x.at(2).value]=Ee(t.measure,o.measurePrecision)),i&&(N[x.at(3).value]=Ee(i.measure,o.measurePrecision))}d&&(N[o.toDateFieldName]=(0,t.getDateWithTZOffset)(d,i.getOriginDataSources()[0]).valueOf()),u&&(N[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(u,i.getOriginDataSources()[0]).valueOf()),c.locations[p].fromStation&&(N[F.at(1).value]=c.locations[p].fromStation),c.locations[p].toStation&&(N[F.at(2).value]=c.locations[p].toStation)}const s=new f({geometry:r,attributes:N});if((0,t.isDefined)(l)){const e=yield(0,t.getPolylineMidPoint)(r),a=new f({geometry:e,attributes:N});yield l.applyEdits({addFeatures:[a.clone()]})}const d=i.buildRecord(s);w.push(d)}}})))))}))))}))))}))))),w.forEach((e=>{const t=e.feature;t.sourceLayer=p.associatedLayer||p,t.layer=t.sourceLayer})),i.setSourceRecords(w),i.setStatus(e.DataSourceStatus.Unloaded),i.setCountStatus(e.DataSourceStatus.Unloaded),We(i,a),R.length>1?yield Ue(i,w,o):w}))})(m,r,S,o,a,l,0,v,i).then((e=>{(null==e?void 0:e.length)>0?(e.forEach((e=>{Je(e.getData(),S)})),r.setRecords(e),E(null==e?void 0:e.length),ue.current=r.getRecordsByPage(1,v.resultConfig.pageSize),Q(!1),G(1)):(Q(!0),ae(a.isMeasureToGeometryOperation?c("noResultsMeasure"):c("noResults")))})).finally((()=>{}))}))}))))}))),[U,S,f,v,Re,V,_,m,c]),we=e.React.useCallback((a=>mt(this,void 0,void 0,(function*(){const i=U;let o,n,r=null,l=null;if(a.isPoint?(W(!0),o=V):(W(!1),o=_),v.labelStyle.size>0){const e=k(((null==i?void 0:i.layer)||(yield i.createJSAPILayerByDataSource())).fields),o=L(S,a.isPoint);n=yield(0,t.createLabelLayer)(e,f,o,he,v.labelStyle.color,v.labelStyle.size)}Re(),ue.current=null,yield(0,e.loadArcGISJSAPIModules)(["esri/TimeExtent","esri/geometry/Point"]).then((e=>{[r,l]=e})).then((()=>mt(this,void 0,void 0,(function*(){Ge(i,S,a,f).then((i=>{(function(a,i,o,n,r,l,u,d,c){return Ae(this,void 0,void 0,(function*(){const u=o.lrsNetworkId,m=d.networkItems.find((e=>u===e.derivedFromNetworkId&&e.isDerived)),f=e.DataSourceManager.getInstance(),h=(0,t.isDefined)(m)&&f.getDataSource(m.useDataSource.dataSourceId),v=i.getOriginDataSources()[0],p=yield $e(v);let g=v.getGDBVersion();if(g||(g=""),!r.isMeasureToGeometryOperation)return Be(a,o,n,i,o.measurePrecision,l,0,0,c,m,h,g);const y=o.networkUrl,S=`${y}/measureToGeometry`,N=yield e.SessionManager.getInstance().getSessionByUrl(y).getToken(y),I=[];n=n.sort(((e,t)=>e.getData()[o.lineOrderFieldName]-t.getData()[o.lineOrderFieldName]));for(const e of n){const a=e.getData()[o.fromDateFieldName],i=(0,t.isDefined)(a)?new Date(a):new Date(0);I.push(i)}const R=P(I);let b=0;const w=[],M=[],O=[],L=[],k=[],T=[];yield Promise.all(R.map((a=>Ae(this,void 0,void 0,(function*(){var u,d,c,f;const v=[],p=[];if(r.searchMeasureBy===s.Range){const e=n,i=[];for(let n=0;n<e.length;n++){const s=e[n].getData()[o.fromDateFieldName],l=(0,t.isDefined)(s)?new Date(s):new Date(0),m=e[n].getData()[o.toDateFieldName],h=(0,t.isDefined)(m)?new Date(m):new Date(864e13);if(l.valueOf()<=a.valueOf()&&a.valueOf()<=h.valueOf()){const s=e[n].getFieldValue(o.routeIdField.jimuName);v.push(s);for(let s=n;s<e.length;s++){const l=e[s].getData()[o.fromDateFieldName],m=(0,t.isDefined)(l)?new Date(l):new Date(0),h=e[s].getData()[o.toDateFieldName],v=(0,t.isDefined)(h)?new Date(h):new Date(864e13);if(m.valueOf()<=a.valueOf()&&a.valueOf()<=v.valueOf()){const t=null===(d=null===(u=e[n])||void 0===u?void 0:u.feature)||void 0===d?void 0:d.attributes,a=null===(f=null===(c=e[s])||void 0===c?void 0:c.feature)||void 0===f?void 0:f.attributes;if(!M[a[o.routeIdField.jimuName]]){const e=a[o.routeIdField.jimuName];M[e]=a}isNaN(r.toMeasure)?i.includes(t[o.routeIdField.jimuName])||(i.push(t[o.routeIdField.jimuName]),p.push({routeId:t[o.routeIdField.jimuName],measure:Ee(r.fromMeasure,o.measurePrecision)})):p.push({routeId:t[o.routeIdField.jimuName],toRouteId:a[o.routeIdField.jimuName],fromMeasure:Ee(r.fromMeasure,o.measurePrecision),toMeasure:Ee(r.toMeasure,o.measurePrecision)})}}}}}else n.forEach((e=>{const i=e.getData()[o.fromDateFieldName],n=(0,t.isDefined)(i)?new Date(i):new Date(0);if(a.valueOf()===n.valueOf()){const t=e.getFieldValue(o.routeIdField.jimuName);v.push(t),r.searchMeasureBy===s.Single?p.push({routeId:t,measure:Ee(r.measure,o.measurePrecision),station:r.station}):r.searchMeasureBy===s.Multiple?r.measures.forEach(((e,a)=>{p.push({routeId:t,measure:Ee(e,o.measurePrecision),station:r.stations.at(a)})})):isNaN(r.toMeasure)?p.push({routeId:t,measure:Ee(r.fromMeasure,o.measurePrecision),station:r.fromStation}):p.push({routeId:t,fromMeasure:Ee(r.fromMeasure,o.measurePrecision),toMeasure:Ee(r.toMeasure,o.measurePrecision),fromStation:r.fromStation,toStation:r.toStation})}}));const y={f:"json",token:N,locations:p,gdbVersion:g,temporalViewDate:(0,t.isDefined)(a)&&0!==a.valueOf()?a:""};yield(0,t.requestService)({method:"POST",url:S,params:y}).then((r=>Ae(this,void 0,void 0,(function*(){if(!r||!r.locations)return w;let s=null,u=null,d=null,c=null,f=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/Graphic","esri/TimeExtent"]).then((e=>{[s,u,d,c,f]=e})).then((()=>Ae(this,void 0,void 0,(function*(){yield Promise.all(r.locations.map(((e,v)=>Ae(this,void 0,void 0,(function*(){var p;const S={};if(r.locations.forEach((e=>{const t=e.status,a=e.routeId;a in S?"esriLocatingOK"!==S[a]&&(S[a]=t):S[a]=t})),e&&e.geometry&&("esriLocatingOK"===e.status||"esriLocatingToPartialMatch"===e.status||"esriLocatingFromPartialMatch"===e.status)){const S=n.findIndex((t=>t.getFieldValue(o.routeIdField.jimuName)===e.routeId));if(!n[S])return;const N=n[S].clone(!0).getData();let I=e.routeId;if(e.toRouteId&&(I+=e.toRouteId),O[I]){const t=O[I];if(t.fromDate===N[o.fromDateFieldName]&&t.toDate===N[o.toDateFieldName]&&t.measure===e.geometry.m)return}O[I]={fromDate:N[o.fromDateFieldName],toDate:N[o.toDateFieldName],measure:e.geometry.m};const R=new d({wkid:r.spatialReference.wkid});if(e.toRouteId&&"esriLocatingOK"===e.status){N[C.at(0).value]=e.toRouteId,o.useRouteName&&(N[C.at(1).value]=M[e.toRouteId][o.routeNameField.jimuName]),N[C.at(2).value]=M[e.toRouteId][o.lineOrderFieldName];const a=M[e.toRouteId][o.fromDateFieldName],n=M[e.toRouteId][o.toDateFieldName];a&&(N[C.at(3).value]=(0,t.getDateWithTZOffset)(a,i.getOriginDataSources()[0]).valueOf()),n&&(N[C.at(4).value]=(0,t.getDateWithTZOffset)(n,i.getOriginDataSources()[0]).valueOf())}const P=o.lineIdFieldName;if("esriGeometryPoint"===e.geometryType){const r=new s(e.geometry);r.spatialReference=R,N[D.at(0).value]=Ee(r.m,o.measurePrecision),N[j.value]=n[S].getId(),N.OBJECTID=b+1,b++;const u=N[o.fromDateFieldName],d=N[o.toDateFieldName];if((0,t.isDefined)(m)){const e=yield _e(r,h,a,d,f,n[S],m,g,P);e&&(N[x.at(0).value]=e.routeName,N[x.at(1).value]=e.routeId,N[x.at(2).value]=Ee(e.measure,o.measurePrecision))}d&&(N[o.toDateFieldName]=(0,t.getDateWithTZOffset)(d,i.getOriginDataSources()[0]).valueOf()),u&&(N[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(u,i.getOriginDataSources()[0]).valueOf()),y.locations[v].station&&(N[F.at(0).value]=y.locations[v].station);const p=new c({geometry:r,attributes:N});(0,t.isDefined)(l)&&(yield l.applyEdits({addFeatures:[p.clone()]}));const I=i.buildRecord(p);"esriLocatingOK"!==e.status||e.toRouteId?"esriLocatingOK"===e.status&&e.toRouteId?Ve(I,o)&&T.push(I):L.push(I):k.push(I),w.push(I)}else{const r=new u(e.geometry);if(r.spatialReference=R,(null===(p=r.paths)||void 0===p?void 0:p.length)>0){const e=r.getPoint(0,0),s=r.paths[r.paths.length-1].length-1,l=r.getPoint(r.paths.length-1,s);N[D.at(0).value]=Ee(e.m,o.measurePrecision),N[D.at(1).value]=Ee(l.m,o.measurePrecision),N[j.value]=n[S].getId(),N.OBJECTID=b+1,b++;const u=N[o.fromDateFieldName],d=N[o.toDateFieldName];if((0,t.isDefined)(m)){const t=yield _e(e,h,a,d,f,n[S],m,g,P),i=yield _e(l,h,a,d,f,n[S],m,g,P);t&&(N[x.at(0).value]=t.routeName,N[x.at(1).value]=t.routeId,N[x.at(2).value]=Ee(t.measure,o.measurePrecision)),i&&(N[x.at(3).value]=Ee(i.measure,o.measurePrecision))}d&&(N[o.toDateFieldName]=(0,t.getDateWithTZOffset)(d,i.getOriginDataSources()[0]).valueOf()),u&&(N[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(u,i.getOriginDataSources()[0]).valueOf()),y.locations[v].fromStation&&(N[F.at(1).value]=y.locations[v].fromStation),y.locations[v].toStation&&(N[F.at(2).value]=y.locations[v].toStation)}const s=new c({geometry:r,attributes:N});if((0,t.isDefined)(l)){const e=yield(0,t.getPolylineMidPoint)(r),a=new c({geometry:e,attributes:N});yield l.applyEdits({addFeatures:[a.clone()]})}const d=i.buildRecord(s);"esriLocatingOK"!==e.status||e.toRouteId?"esriLocatingOK"===e.status&&e.toRouteId?Ve(d,o)&&T.push(d):L.push(d):k.push(d),w.push(d)}}})))))}))))}))))})))));const E={},A=[];return k.forEach((e=>{var t;const a=e.feature.attributes[o.routeIdFieldName],i=null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[C.at(0).value];E[a]=i})),L.forEach((e=>{const t=e.feature.attributes[o.routeIdFieldName];t in E?(E[t]&&k.push(e),A.push(t)):A.includes(t)||(k.push(e),A.push(t))})),T.forEach((e=>{k.push(e)})),k.forEach((e=>{const t=e.feature;t.sourceLayer=p.associatedLayer||p,t.layer=t.sourceLayer})),i.setSourceRecords(k),i.setStatus(e.DataSourceStatus.Unloaded),i.setCountStatus(e.DataSourceStatus.Unloaded),We(i,a),R.length>1?yield Ue(i,k,o):k}))})(m,o,S,i,a,n,0,v,r).then((e=>{(null==e?void 0:e.length)>0?(e.forEach((e=>{Je(e.getData(),S)})),o.setRecords(e),E(null==e?void 0:e.length),ue.current=o.getRecordsByPage(1,v.resultConfig.pageSize),Q(!1),G(1)):(Q(!0),ae(a.isMeasureToGeometryOperation?c("noResultsMeasure"):c("noResults"))),le(a.searchMeasureBy)})).finally((()=>{}))}))}))))}))),[U,S,f,v,Re,V,_,m,c]),De=e.React.useCallback((a=>mt(this,void 0,void 0,(function*(){const i=U;W(!0);const o=V;let r;if(v.labelStyle.size>0){const e=k(((null==i?void 0:i.layer)||(yield i.createJSAPILayerByDataSource())).fields),a=L(S,!0);r=yield(0,t.createLabelLayer)(e,f,a,he,v.labelStyle.color,v.labelStyle.size)}Re(),ue.current=null,function(a,i,o){return Ae(this,void 0,void 0,(function*(){const r=[];let s,l=null,u=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[l,u]=e})).then((()=>{var e,r,d;const c=new l;c.x=o.xCoordinate,c.y=o.yCoordinate,o.zCoordinate?c.z=o.zCoordinate:c.z=0,i.defaultSpatialReferenceFrom===n.Map?c.spatialReference=new u({wkid:102100}):c.spatialReference=new u({wkid:i.spatialReferenceInfo.wkid,wkt:i.spatialReferenceInfo.wkt});let m=null!==(r=null===(e=a.getTimeInfo())||void 0===e?void 0:e.timeExtent)&&void 0!==r?r:0;const f=a.getCurrentQueryParams();(null==f?void 0:f.time)&&(m=[f.time[0],f.time[1]]),s={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:c.toJSON?c.toJSON():c,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",time:m,outFields:["*"]};const h=null===(d=null==i?void 0:i.sortOptions)||void 0===d?void 0:d.filter((e=>(0,t.isDefined)(e.jimuFieldName)));(null==h?void 0:h.length)>0&&Object.assign(s,{orderByFields:i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))})})),a.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:r})).catch((e=>r))}))}(i,S,a).then((s=>mt(this,void 0,void 0,(function*(){s.length>0?function(a,i,o,r,s,l,u){return Ae(this,void 0,void 0,(function*(){const d=o.networkUrl,c=`${d}/geometryToMeasure`,m=yield e.SessionManager.getInstance().getSessionByUrl(d).getToken(d),f=[],h=[];let v=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{[v]=e})).then((()=>{const e=new v;e.x=s.xCoordinate,e.y=s.yCoordinate,s.zCoordinate?e.z=s.zCoordinate:e.z=0,r.forEach((t=>{const a=t.getFieldValue(o.routeIdField.jimuName);f.push(a),h.push({routeId:a,geometry:e.toJSON?e.toJSON():e})}))}));const p=i.getOriginDataSources()[0],g=yield $e(p);let y=p.getGDBVersion();y||(y="");const S=p.getCurrentQueryParams();let N=null;(null==S?void 0:S.time)&&(N=null==S?void 0:S.time[0]);const I={f:"json",token:m,locations:h,inSR:o.defaultSpatialReferenceFrom===n.Map?102100:null,gdbVersion:y,temporalViewDate:(0,t.isDefined)(N)&&0!==N.valueOf()?N:""},R=[];return(0,t.requestService)({method:"POST",url:c,params:I}).then((n=>Ae(this,void 0,void 0,(function*(){if(!n||!n.locations)return R;let d=null,c=null,m=null,f=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/TimeExtent"]).then((e=>{[d,c,m,f]=e})).then((()=>Ae(this,void 0,void 0,(function*(){const h=new d;h.x=s.xCoordinate,h.y=s.yCoordinate,s.zCoordinate?h.z=s.zCoordinate:h.z=0;const v=o.lrsNetworkId,p=u.networkItems.find((e=>v===e.derivedFromNetworkId&&e.isDerived)),S=e.DataSourceManager.getInstance(),N=(0,t.isDefined)(p)&&S.getDataSource(p.useDataSource.dataSourceId);yield Promise.all(n.locations.map(((e,a)=>Ae(this,void 0,void 0,(function*(){e&&(yield Promise.all(e.results.map(((e,a)=>Ae(this,void 0,void 0,(function*(){if(e){const a=r.findIndex((t=>t.getFieldValue(o.routeIdField.jimuName)===e.routeId)),s=r[a].getData()[o.fromDateFieldName],u=r[a].getData()[o.toDateFieldName],h=r[a].getData(),v=o.lineIdFieldName;if(h[D.at(0).value]=Ee(e.measure,o.measurePrecision),h[M.value]=Ee(e.distance,o.measurePrecision),h[j.value]=r[a].getId(),(0,t.isDefined)(p)){let t;n.spatialReference.wkid?t=new c({wkid:n.spatialReference.wkid}):n.spatialReference.wkt&&(t=new c({wkt:n.spatialReference.wkt}));const i=new d(e.geometry);i.spatialReference=t;const l=yield _e(i,N,s,u,f,r[a],p,y,v);l&&(h[x.at(0).value]=l.routeName,h[x.at(1).value]=l.routeId,h[x.at(2).value]=Ee(l.measure,o.measurePrecision))}const g=h[o.fromDateFieldName],S=h[o.toDateFieldName];let I;S&&(h[o.toDateFieldName]=(0,t.getDateWithTZOffset)(S,i.getOriginDataSources()[0]).valueOf()),g&&(h[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(g,i.getOriginDataSources()[0]).valueOf()),n.spatialReference.wkid?I=new c({wkid:n.spatialReference.wkid}):n.spatialReference.wkt&&(I=new c({wkt:n.spatialReference.wkt}));const b=new d(e.geometry);b.spatialReference=I;const w=new m({geometry:b,attributes:h});(0,t.isDefined)(l)&&l.applyEdits({addFeatures:[w.clone()]});const F=i.buildRecord(w);R.push(F)}}))))))}))))),R.forEach((e=>{const t=e.feature;t.sourceLayer=g.associatedLayer||g,t.layer=t.sourceLayer})),i.setSourceRecords(R),i.setStatus(e.DataSourceStatus.Unloaded),i.setCountStatus(e.DataSourceStatus.Unloaded),We(i,a)})))),R}))))}))}(m,o,S,s,a,r,v).then((e=>{o.setRecords(e),E(null==e?void 0:e.length)})).finally((()=>{ue.current=o.getRecordsByPage(1,v.resultConfig.pageSize),G(1)})):yield function(a,i,o){return Ae(this,void 0,void 0,(function*(){const r=[];let s,l=null,u=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[l,u]=e})).then((()=>{var e,r,d,c,m,f,h,v;const p=new l;p.x=o.xCoordinate,p.y=o.yCoordinate,o.zCoordinate?p.z=o.zCoordinate:p.z=0,i.defaultSpatialReferenceFrom===n.Map?p.spatialReference=new u({wkid:102100}):p.spatialReference=new u({wkid:i.spatialReferenceInfo.wkid,wkt:i.spatialReferenceInfo.wkt});let g=null!==(r=null===(e=a.getTimeInfo())||void 0===e?void 0:e.timeExtent)&&void 0!==r?r:0;const y=a.getCurrentQueryParams();(null==y?void 0:y.time)&&(g=[y.time[0],y.time[1]]);const S=a.getOriginDataSources()[0],N=i.unitsOfMeasure;let I="esriMeters";(null===(d=null==S?void 0:S.layerDefinition)||void 0===d?void 0:d.hasGeometryProperties)&&(null===(m=null===(c=null==S?void 0:S.layerDefinition)||void 0===c?void 0:c.geometryProperties)||void 0===m?void 0:m.units)&&(I=null===(h=null===(f=null==S?void 0:S.layerDefinition)||void 0===f?void 0:f.geometryProperties)||void 0===h?void 0:h.units);const R=(0,t.ConvertUnits)(i.searchRadius,N,I);s={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:p.toJSON?p.toJSON():p,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",distance:R,units:"esriSRUnit_Meter",time:g,outFields:[i.routeIdFieldName],notAddFieldsToClient:!0};const b=null===(v=null==i?void 0:i.sortOptions)||void 0===v?void 0:v.filter((e=>(0,t.isDefined)(e.jimuFieldName)));(null==b?void 0:b.length)>0&&Object.assign(s,{orderByFields:i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))})})),a.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:r})).catch((e=>r))}))}(i,S,a).then((s=>mt(this,void 0,void 0,(function*(){if(s.length>0){let l,u=[];yield Promise.all(s.map((i=>mt(this,void 0,void 0,(function*(){yield function(a,i,o,r){return Ae(this,void 0,void 0,(function*(){var s,l,u,d,c;const m=i.getOriginDataSources()[0];let f=m.getGDBVersion();f||(f="");const h=o.unitsOfMeasure;let v=o.unitsOfMeasure;(null===(s=null==m?void 0:m.layerDefinition)||void 0===s?void 0:s.hasGeometryProperties)&&(null===(u=null===(l=null==m?void 0:m.layerDefinition)||void 0===l?void 0:l.geometryProperties)||void 0===u?void 0:u.units)&&(v=null===(c=null===(d=null==m?void 0:m.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===c?void 0:c.units);const p=(0,t.ConvertUnits)(o.searchRadius,h,v),g=[];let y=null,S=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[y,S]=e})).then((()=>{const e=new y;e.x=r.xCoordinate,e.y=r.yCoordinate,r.zCoordinate?e.z=r.zCoordinate:e.z=0,o.defaultSpatialReferenceFrom===n.Map?e.spatialReference=new S({wkid:102100}):e.spatialReference=new S({wkid:o.spatialReferenceInfo.wkid,wkt:o.spatialReferenceInfo.wkt}),g.push({routeId:a.getFieldValue(o.routeIdFieldName),geometry:e.toJSON?e.toJSON():e})}));const N=o.networkUrl,I={f:"json",token:yield e.SessionManager.getInstance().getSessionByUrl(N).getToken(N),locations:g,inSR:o.defaultSpatialReferenceFrom===n.Map?102100:null,gdbVersion:f,tolerance:p,temporalViewDate:a.getFieldValue(o.fromDateFieldName)},R=`${N}/geometryToMeasure`;return(0,t.requestService)({method:"POST",url:R,params:I}).then((e=>Ae(this,void 0,void 0,(function*(){return e&&e.locations?{resultLocations:e.locations,resultWkid:e.spatialReference.wkid}:{resultLocations:[],resultWkid:NaN}}))))}))}(i,o,S,a).then((({resultLocations:e,resultWkid:t})=>{u=u.concat(e),l=t}))})))));let d=null,f=null;(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[d,f]=e})).then((()=>{let s=-1;const l=new d;l.x=a.xCoordinate,l.y=a.yCoordinate,a.zCoordinate?l.z=a.zCoordinate:l.z=0,S.defaultSpatialReferenceFrom===n.Map?l.spatialReference=new f({wkid:102100}):S.spatialReferenceInfo.wkid?l.spatialReference=new f({wkid:S.spatialReferenceInfo.wkid}):S.spatialReferenceInfo.wkt&&(l.spatialReference=new f({wkt:S.spatialReferenceInfo.wkt}));let h=[],p=[];u.forEach((e=>{e&&e.results.forEach((e=>{if(e){const t=dt.default.nearestCoordinate(new d(e.geometry),l).distance;(-1===s||t<=s)&&((-1===s||t<s)&&(h=[],p=[],s=t),h.push(e),p.push(e.routeId))}}))})),function(a,i,o,n,r,s,l,u,d,c){return Ae(this,void 0,void 0,(function*(){var s,d,m;const f=o.getOriginDataSources()[0],h=yield $e(f),v=[];let p=null,g=a.getGDBVersion();g||(g="");let y="";if(!(r.length>0))return{newRecords:v};y=i.routeIdField.jimuName+" IN ('"+r.join("','")+"')";let S=null!==(d=null===(s=a.getTimeInfo())||void 0===s?void 0:s.timeExtent)&&void 0!==d?d:0;const N=a.getCurrentQueryParams();(null==N?void 0:N.time)&&(S=[N.time[0],N.time[1]]);const I={returnGeometry:!0,returnM:!0,returnZ:!0,where:y,time:S,outFields:["*"],notAddFieldsToClient:!0},R=null===(m=null==i?void 0:i.sortOptions)||void 0===m?void 0:m.filter((e=>(0,t.isDefined)(e.jimuFieldName)));(null==R?void 0:R.length)>0&&Object.assign(I,{orderByFields:i.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))});const b=i.lrsNetworkId,w=c.networkItems.find((e=>b===e.derivedFromNetworkId&&e.isDerived)),F=e.DataSourceManager.getInstance(),C=(0,t.isDefined)(w)&&F.getDataSource(w.useDataSource.dataSourceId);return a.query(I).then((a=>Ae(this,void 0,void 0,(function*(){var r;if((null===(r=a.records)||void 0===r?void 0:r.length)>0){const r=a.records;let s=null,d=null,c=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/TimeExtent"]).then((e=>{[s,d,c,p]=e})).then((()=>Ae(this,void 0,void 0,(function*(){yield Promise.all(n.map((e=>Ae(this,void 0,void 0,(function*(){const a=r.findIndex((t=>t.getFieldValue(i.routeIdField.jimuName)===e.routeId));if(a>-1){const n=r[a].getData(),l=r[a].getData()[i.fromDateFieldName],m=r[a].getData()[i.toDateFieldName],f=i.lineIdFieldName;let h;if(i.spatialReferenceInfo.wkid?h=new d({wkid:i.spatialReferenceInfo.wkid}):i.spatialReferenceInfo.wkt&&(h=new d({wkt:i.spatialReferenceInfo.wkt})),(0,t.isDefined)(w)){const t=new s(e.geometry);t.spatialReference=h;const o=yield _e(t,C,l,m,p,r[a],w,g,f);o&&(n[x.at(0).value]=o.routeName,n[x.at(1).value]=o.routeId,n[x.at(2).value]=Ee(o.measure,i.measurePrecision))}n[D.at(0).value]=Ee(e.measure,i.measurePrecision),n[M.value]=Ee(e.distance,i.measurePrecision),n[j.value]=r[a].getId();const y=n[i.fromDateFieldName],S=n[i.toDateFieldName];S&&(n[i.toDateFieldName]=(0,t.getDateWithTZOffset)(S,o.getOriginDataSources()[0]).valueOf()),y&&(n[i.fromDateFieldName]=(0,t.getDateWithTZOffset)(y,o.getOriginDataSources()[0]).valueOf());const N=new s(e.geometry);N.spatialReference=h;const I=new c({geometry:N,attributes:n});(0,t.isDefined)(u)&&u.applyEdits({addFeatures:[I.clone()]});const R=o.buildRecord(I);v.push(R)}})))))})))),v.forEach((e=>{const t=e.feature;t.sourceLayer=h.associatedLayer||h,t.layer=t.sourceLayer})),o.setSourceRecords(v),o.setStatus(e.DataSourceStatus.Unloaded),o.setCountStatus(e.DataSourceStatus.Unloaded),We(o,l),{newRecords:v}}return{newRecords:v}})))).catch((e=>({newRecords:v})))}))}(i,S,o,h,p,0,m,r,0,v).then((({newRecords:e})=>{o.setRecords(e),E(null==e?void 0:e.length),(null==e?void 0:e.length)>0?(e.forEach((e=>{Je(e.getData(),S)})),ue.current=o.getRecordsByPage(1,v.resultConfig.pageSize),G(1),Q(!1)):(Q(!0),ae(c("searchRadiusResultsError")))}))}))}else Q(!0),ae(c("searchRadiusResultsError"))}))))}))))}))),[U,V,S,f,v,Re,m,c]),xe=e.React.useCallback((()=>{ue.current=null,$?(null==V||V.clearSelection(),null==V||V.clearRecords(),null==V||V.setCountStatus(e.DataSourceStatus.NotReady),null==V||V.setStatus(e.DataSourceStatus.NotReady)):(null==_||_.clearSelection(),null==_||_.clearRecords(),null==_||_.setCountStatus(e.DataSourceStatus.NotReady),null==_||_.setStatus(e.DataSourceStatus.NotReady)),(0,t.removeLabelLayer)(f,he),E(0),Re(),G(0)}),[f,$,_,V,Re]),Me=e.React.useCallback((()=>{var e,a,i,o;b===t.SearchMethod.Measure?null===(e=ge.current)||void 0===e||e.submitForm():b===t.SearchMethod.Referent?null===(a=ye.current)||void 0===a||a.submitForm():b===t.SearchMethod.Coordinate?null===(i=Se.current)||void 0===i||i.submitForm():b===t.SearchMethod.LineAndMeasure&&(null===(o=Ne.current)||void 0===o||o.submitForm())}),[b]),Fe=e.React.useCallback((e=>{pe(e)}),[]),je=e.React.useMemo((()=>b===t.SearchMethod.Measure?c(ve?"search":"searchDisabled"):b===t.SearchMethod.Referent?c(ve?"search":"searchReferentTooltip"):b===t.SearchMethod.Coordinate?c(ve?"search":"coordinateSearchDisabled"):b===t.SearchMethod.LineAndMeasure?c(ve?"search":"lineMeasureSearchDisabled"):void 0),[c,ve,b]);return(0,e.jsx)("div",{className:"search-by-route-task h-100 d-flex",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .search-by-route-form {
      height: 100%;
    }
    .search-by-route-task__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .toast {
      position: relative;
      top: 4%;
    }
    .search-by-route-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-form__header px-3 pt-3 align-items-center",{"d-none":1===A,[l.FOCUSABLE_CONTAINER_CLASS]:1!==A})},!g&&(0,e.jsx)("div",{className:"search-by-route_title d-flex align-items-center text-truncate",css:e.css`font-weight: 500; font-size: 14px;`},(0,e.jsx)("div",{className:"text-truncate"},c("_widgetLabel")))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-task__content",{"d-none":1===A,[l.FOCUSABLE_CONTAINER_CLASS]:1!==A})},(0,e.jsx)(ut,{networkItem:S,dataSourceReady:e=>{Z(e)},onCreateDs:e=>{J(e)},onCreateLineDs:e=>{z(e)},onCreatePointDs:e=>{B(e)}}),(0,e.jsx)(h,{config:v,networkConfig:v.networkItems,onMethodChanged:e=>{O(e),Ie()},onNetworkChanged:e=>{Z(!1),N(e),Ie()},onReferentChanged:e=>{Z(!1),R(e)},defaultReferent:I}),q&&fe&&b===t.SearchMethod.Measure&&(0,e.jsx)(w,{config:v,ref:ge,intl:p,widgetId:m,networkItem:S,dataSource:U,isDataSourceReady:null!=U,onSubmit:be,onValidationChanged:Fe,reset:ie}),q&&fe&&b===t.SearchMethod.LineAndMeasure&&(0,e.jsx)(ct,{config:v,ref:Ne,intl:p,widgetId:m,networkItem:S,dataSource:U,isDataSourceReady:null!=U,onSubmit:we,onValidationChanged:Fe,reset:ie}),b===t.SearchMethod.Coordinate&&(0,e.jsx)(me,{ref:Se,networkItem:S,dataSource:U,isDataSourceReady:null!=U,onSubmit:De,onValidationChanged:Fe,coordinateGraphic:y,reset:ie}),b===t.SearchMethod.Referent&&(0,e.jsx)(de,{ref:ye,networkItem:S,referentItem:I,dataSource:U,isDataSourceReady:null!=U,onSubmit:(a,i)=>mt(this,void 0,void 0,(function*(){const o=U,n=V;let r;if(v.labelStyle.size>0){const e=k(((null==o?void 0:o.layer)||(yield o.createJSAPILayerByDataSource())).fields),a=L(S,!0);r=yield(0,t.createLabelLayer)(e,f,a,he,v.labelStyle.color,v.labelStyle.size)}W(!0),Re(),ue.current=null,yield function(a,i,o,n,r,s,l,u,d,c){return Ae(this,void 0,void 0,(function*(){var m;const f=[],h=[],v=null===(m=null==d?void 0:d.resultConfig)||void 0===m?void 0:m.defaultOffsetUnit,p=n.lineIdFieldName;let g=null,y=null,S=null,N=null,I=i.getGDBVersion();I||(I=""),yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/TimeExtent"]).then((e=>{[g,y,S,N]=e}));const R=yield ze(o,n,v,I,null);if(!R||!(null==R?void 0:R.locations)||0===(null==R?void 0:R.locations.length))return[];if(R.locations.forEach((e=>{const t=e.results;if("esriLocatingMultipleLocation"===(null==e?void 0:e.status))t.forEach((e=>{const t=e.routeId;f.includes(t)||f.push(t)}));else if("esriLocatingOK"===(null==e?void 0:e.status)){const t=e.results[0].routeId;f.includes(t)||f.push(t)}})),!f||0===f.length)return[];const b=(e,t)=>{const a=new S({geometry:t,attributes:e}),i=s.buildRecord(a);h.push(i),l++},w=(a,o,r)=>Ae(this,void 0,void 0,(function*(){const u=i.getLayerDefinition(),m=null==a?void 0:a.results,f=new y({wkid:R.spatialReference.wkid}),h=n.lrsNetworkId,v=d.networkItems.find((e=>h===e.derivedFromNetworkId&&e.isDerived)),w=e.DataSourceManager.getInstance(),M=(0,t.isDefined)(v)&&w.getDataSource(v.useDataSource.dataSourceId),F=o.getData()[n.fromDateFieldName],C=o.getData()[n.toDateFieldName];if("esriLocatingMultipleLocation"===(null==a?void 0:a.status))for(const e of m){const a=null==o?void 0:o.getData();if(!a)return;if((null==e?void 0:e.routeId)!==a[n.routeIdFieldName]);else{r.push(e);let i=null==e?void 0:e.measure,d=null;if("esriGeometryPoint"===(null==e?void 0:e.geometryType)&&(d=new g(e.geometry),d.spatialReference=R.spatialReference),(0,t.isDefined)(v)){const e=yield _e(d,M,F,C,N,o,v,I,p);e&&(a[x.at(0).value]=e.routeName,a[x.at(1).value]=e.routeId,a[x.at(2).value]=Ee(e.measure,n.measurePrecision))}i=i<0?0:Ee(i,n.measurePrecision),a[D.at(0).value]=i,a[u.objectIdField]=l,a[j.value]=o.getId();const m=a[n.fromDateFieldName],f=a[n.toDateFieldName];if(m||f){const e=(0,t.isDefined)(m)?(0,t.getDateWithTZOffset)(m,s.getOriginDataSources()[0]).valueOf():null,i=(0,t.isDefined)(f)?(0,t.getDateWithTZOffset)(f,s.getOriginDataSources()[0]).valueOf():null;if(a[n.fromDateFieldName]=e,a[n.toDateFieldName]=i,(0,t.isDefined)(c)){const e=new S({geometry:d,attributes:a});yield c.applyEdits({addFeatures:[e.clone()]})}b(a,d)}else{if((0,t.isDefined)(c)){const e=new S({geometry:d,attributes:a});yield c.applyEdits({addFeatures:[e.clone()]})}b(a,d)}}}else if("esriLocatingOK"===(null==a?void 0:a.status)){const e=a.results[0];let i=e.measure;const d=o.getData();let m=null;if(!r.some((t=>JSON.stringify(t)===JSON.stringify(e)))&&(null==e?void 0:e.routeId)===d[n.routeIdFieldName]){if(r.push(e),"esriGeometryPoint"===e.geometryType&&(m=new g(e.geometry),m.spatialReference=f),(0,t.isDefined)(v)){const e=yield _e(m,M,F,C,N,o,v,I,p);e&&(d[x.at(0).value]=e.routeName,d[x.at(1).value]=e.routeId,d[x.at(2).value]=Ee(e.measure,n.measurePrecision))}i=i<0?0:Ee(i,n.measurePrecision),d[D.at(0).value]=i,d[u.objectIdField]=l,d[j.value]=o.getId();const a=d[n.fromDateFieldName],h=d[n.toDateFieldName];if(a||h){const e=(0,t.isDefined)(a)?(0,t.getDateWithTZOffset)(a,s.getOriginDataSources()[0]).valueOf():null,i=(0,t.isDefined)(h)?(0,t.getDateWithTZOffset)(h,s.getOriginDataSources()[0]).valueOf():null;if(d[n.fromDateFieldName]=e,d[n.toDateFieldName]=i,(0,t.isDefined)(c)){const e=new S({geometry:m,attributes:d});yield c.applyEdits({addFeatures:[e.clone()]})}b(d,m)}else{if((0,t.isDefined)(c)){const e=new S({geometry:m,attributes:d});yield c.applyEdits({addFeatures:[e.clone()]})}b(d,m)}}}}));yield(()=>Ae(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Ae(this,void 0,void 0,(function*(){var t;const a=null==n?void 0:n.routeIdFieldName,s=[],l=[];let d="";f.length>0&&(d=a+" IN ('"+f.join("','")+"')");const c={where:d,outFields:["*"]},m=yield i.query(c);if(0===(null===(t=null==m?void 0:m.records)||void 0===t?void 0:t.length))return[];m.records.forEach((e=>{l.push(e);const t=e.getData()[null==r?void 0:r.fromDateFieldName];null==o||o.forEach((e=>{const a=e.objectId;let i=u[a];"eventLayers"!==(null==r?void 0:r.type)&&(i=t),s.push(ze(o,n,v,I,i))}))}));const h=yield Promise.all(s),p=[];yield Promise.all(h.map(((e,t)=>Ae(this,void 0,void 0,(function*(){const a=null==e?void 0:e.locations;if((null==a?void 0:a.length)>0){const e=l[t];for(const t of a)yield w(t,e,p)}}))))),e("finish")}))))})))(),s.setSourceRecords(h),s.setStatus(e.DataSourceStatus.Unloaded),s.setCountStatus(e.DataSourceStatus.Unloaded),We(s,a);const M=yield $e(i);return h.forEach((e=>{const t=e.feature;t.sourceLayer=M.associatedLayer||M,t.layer=t.sourceLayer})),h}))}(m,o,a,S,I,n,1,i,v,r).then((e=>{(null==e?void 0:e.length)>0?(e.forEach((e=>{Je(e.getData(),S)})),n.setSourceRecords(e),n.setRecords(e),E(null==e?void 0:e.length),ue.current=n.getRecordsByPage(1,v.resultConfig.pageSize),G(1),Q(!1)):(Q(!0),ae(c("noResultReferent")))})).finally((()=>{}))})),config:v,id:m,intl:p,widgetId:m,onValidationChanged:Fe,reset:ie}),H&&(0,e.jsx)("div",{className:"toast-container px-3 w-100"},(0,e.jsx)(l.Alert,{className:"toast w-100",type:X,text:te,closable:!0,withIcon:!0,open:H,onClose:()=>{Y(!1),Q(!1)}}))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-footer_action w-100",{"d-none":1===A,[l.FOCUSABLE_CONTAINER_CLASS]:1!==A})},(0,e.jsx)("div",{className:"search-by-route-footer d-flex"},(0,e.jsx)(l.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--sys-color-primary-main)"},onClick:()=>{oe(!ie),R(ne)}},"Reset"),(0,e.jsx)(l.Tooltip,{title:je},(0,e.jsx)("div",{className:"mt-auto ml-auto"},(0,e.jsx)(l.Button,{className:"active","aria-label":c("searchLabel"),size:"sm",disabled:!ve,onClick:Me},c("searchLabel")))))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-task__content",{"d-none":1!==A,[l.FOCUSABLE_CONTAINER_CLASS]:1===A})},(0,e.jsx)(lt,{config:v,widgetId:m,currentNetwork:S,selectedMethod:b,isPoint:$,resultCount:T,maxPerPage:null===(d=null==U?void 0:U.getMaxRecordCount)||void 0===d?void 0:d.call(U),records:ue.current,routeRecords:ce.current,defaultPageSize:v.resultConfig.pageSize,outputDS:$?V:_,inputDS:U,jimuMapView:f,highlightStyle:v.highlightStyle,onNavBack:xe,intl:p,measureType:se})))}var ht=function(e,t,a,i){return new(a||(a=Promise))((function(o,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const vt=e.css`
  background-color: var(--ref-palette-white);
`;class pt extends e.React.PureComponent{constructor(t){super(t),this.onActiveViewChange=e=>ht(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>ht(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const a=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==a?void 0:a.isDataSourceSet())&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then((()=>a)).catch((e=>a)):Promise.resolve(a)})),this.state={coordinateGraphic:null,jimuMapView:void 0,hideTitle:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){const e=(0,t.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:e})}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,a){a.jimuMapView!==this.state.jimuMapView&&(0,t.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,t.isDefined)(this.state.coordinateGraphic)&&(this.state.coordinateGraphic.removeAll(),this.state.coordinateGraphic.destroy(),this.setState({coordinateGraphic:null}))}createGraphicLayers(){var e,a;if((0,t.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const t=new rt.default({listMode:"hide"});null===(a=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===a||a.map.addMany([t]),this.setState({coordinateGraphic:t})}}render(){var t,i;const{config:o,id:n,intl:r}=this.props,s=this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:a._widgetLabel});return(null===(t=o.networkItems)||void 0===t?void 0:t.filter((e=>!e.referent)).length)?(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-search-by-route surface-1 border-0",css:vt},(0,e.jsx)(c.JimuMapViewComponent,{useMapWidgetId:null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(ft,{widgetId:n,jimuMapView:this.state.jimuMapView,config:o,intl:r,hideTitle:this.state.hideTitle,coordinateGraphic:this.state.coordinateGraphic})):(0,e.jsx)(l.WidgetPlaceholder,{icon:d(),widgetId:n,message:s})}}function gt(e){m.p=e}})(),f})())}}}));