System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/basic/color-picker","widgets/shared-code/lrs","jimu-ui/basic/list-tree","jimu-core/react","jimu-ui/advanced/sql-expression-builder","jimu-ui/advanced/data-source-selector"],(function(e,t){var a={},i={},s={},n={},o={},r={},l={},u={},d={},c={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.OrderRule=e.OrderRule,a.React=e.React,a.ReactRedux=e.ReactRedux,a.SessionManager=e.SessionManager,a.classNames=e.classNames,a.css=e.css,a.esri=e.esri,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished,a.urlUtils=e.urlUtils},function(e){i.Button=e.Button,i.Checkbox=e.Checkbox,i.NumericInput=e.NumericInput,i.Select=e.Select,i.Switch=e.Switch,i.TextInput=e.TextInput,i.defaultMessages=e.defaultMessages},function(e){s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper,s.getOutputJsonOriginDs=e.getOutputJsonOriginDs},function(e){n.getAppConfigAction=e.getAppConfigAction},function(e){o.ColorPicker=e.ColorPicker},function(e){r.GetEsriUnits=e.GetEsriUnits,r.GetUnits=e.GetUnits,r.SearchMethod=e.SearchMethod,r.colorBlack=e.colorBlack,r.errorMessageDelay=e.errorMessageDelay,r.formatMessage=e.formatMessage,r.highlightColor=e.highlightColor,r.isDefined=e.isDefined,r.messages=e.messages},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){u.Fragment=e.Fragment},function(e){d.Sort=e.Sort},function(e){c.DataSourceRemoveWaringReason=e.DataSourceRemoveWaringReason,c.DataSourceRemoveWarningPopup=e.DataSourceRemoveWarningPopup,c.dataComponentsUtils=e.dataComponentsUtils}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=u},4108:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=i},13089:e=>{"use strict";e.exports=c},79298:e=>{"use strict";e.exports=s},71442:e=>{"use strict";e.exports=d},54337:e=>{"use strict";e.exports=o},98640:e=>{"use strict";e.exports=l},47626:e=>{"use strict";e.exports=r}},t={};function g(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,g),s.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var a in t)g.o(t,a)&&!g.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var h={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(h),g.d(h,{__set_webpack_public_path__:()=>K,default:()=>q});var e=g(79244),t=g(14321),a=g(79298),i=g(4108);const s={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer Configuration",importAll:"Import all",selectMap:"Select Map",networkConfig:"Network Configuration",referentConfig:"Referent Configuration",networkLabel:"Label",defaultIdentifier:"Default Identifier",routeIdentifier:"Route",lineIdentifier:"Line",spatialReference:"Spatial Reference",routeId:"Route ID",routeName:"Route name",lineId:"Line ID",lineName:"Line Name",multiField:"Multi field",searchMethod:"Search Methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",lineAndMeasure:"Line and Measure",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result Settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",defaultReferent:"Default Referent",defaultOffsetUnit:"Default Offset Units",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection Settings",results:"Results",sortResults:"Sort results by:",radiusWithUnits:"Radius ({units})",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",lrs:"LRS",defaultStr:"Default",configureFields:"Configure Fields",defaultNetwork:"Default Network",searchMeasures:"Search Measures",singleLabel:"Single",multipleLabel:"Multiple",rangeLabel:"Range",expandByDefault:"Expand by default",loadLayers:"Load layers",clearLayers:"Clear layers",labelColor:"Label color",labelSize:"Label size",advancedFieldDisplay:"Advanced field display",networkFields:"Network fields",additionalFields:"Additional fields"};var n,o,r,l,u,d=g(54337),c=g(47626),p=g(98640);!function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(n||(n={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(o||(o={})),function(e){e.Map="MAP",e.Lrs="LRS"}(r||(r={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(l||(l={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(u||(u={}));var m=g(68972),f=g(28996),v=g.n(f),S=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const I=t=>{const a=window.SVG,{className:i}=t,s=S(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:v()},s)):e.React.createElement("svg",Object.assign({className:n},s))};function w(i){const{networkItem:n,onPropertyChanged:o,onPropertiesChanged:r}=i,l=e.hooks.useTranslation(s),u=Object.assign({},{},n),d=(e,t)=>{if(e.target)if(g(t)){const a=[],i=[];a.push(t),i.push(e.target.checked),a.push("defaultMethod"),i.push(h(t)),r(a,i,!0)}else o(t,e.target.checked,!0)},g=e=>{let t=!1;switch(e){case"useMeasure":t=u.defaultMethod===c.SearchMethod.Measure;break;case"useCoordinate":t=u.defaultMethod===c.SearchMethod.Coordinate;break;case"useReferent":t=u.defaultMethod===c.SearchMethod.Referent;break;case"useLineAndMeasure":t=u.defaultMethod===c.SearchMethod.LineAndMeasure}return t},h=e=>"useMeasure"!==e&&u.useMeasure&&u.defaultMethod!==c.SearchMethod.Measure?c.SearchMethod.Measure:"useCoordinate"!==e&&u.useCoordinate&&u.defaultMethod!==c.SearchMethod.Coordinate?c.SearchMethod.Coordinate:"useLineAndMeasure"!==e&&u.useLineAndMeasure&&u.defaultMethod!==c.SearchMethod.LineAndMeasure?c.SearchMethod.LineAndMeasure:c.SearchMethod.Referent,p=()=>{let e=0;return u.useMeasure&&e++,u.useCoordinate&&e++,u.useReferent&&e++,u.useLineAndMeasure&&e++,e};return(0,e.jsx)(a.SettingSection,{role:"group","aria-label":l("searchMethod"),title:l("searchMethod")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:l("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":l("defaultStr"),className:"w-100",size:"sm",value:u.defaultMethod,disabled:1===p(),onChange:e=>{o("defaultMethod",e.target.value,!0)}},u.useMeasure&&(0,e.jsx)("option",{value:c.SearchMethod.Measure},l("measure")),u.useCoordinate&&(0,e.jsx)("option",{value:c.SearchMethod.Coordinate},l("coordinate")),u.useReferent&&(0,e.jsx)("option",{value:c.SearchMethod.Referent},l("referent")),u.useLineAndMeasure&&(0,e.jsx)("option",{value:c.SearchMethod.LineAndMeasure},l("lineAndMeasure")))),(0,e.jsx)(a.SettingRow,{label:l("measure")},(0,e.jsx)(t.Switch,{"aria-label":l("measure"),checked:u.useMeasure,disabled:1===p()&&u.useMeasure,onChange:e=>{d(e,"useMeasure")}})),(0,e.jsx)(a.SettingRow,{label:l("coordinate")},(0,e.jsx)(t.Switch,{"aria-label":l("coordinate"),checked:u.useCoordinate,disabled:1===p()&&u.useCoordinate,onChange:e=>{d(e,"useCoordinate")}})),(0,e.jsx)(a.SettingRow,{label:l("referent")},(0,e.jsx)(t.Switch,{"aria-label":l("referent"),checked:u.useReferent,disabled:1===p()&&u.useReferent,onChange:e=>{d(e,"useReferent")}})),u.showLineAndMeasure&&(0,e.jsx)(a.SettingRow,{label:l("lineAndMeasure")},(0,e.jsx)(t.Switch,{"aria-label":l("lineAndMeasure"),checked:u.useLineAndMeasure,disabled:1===p()&&u.useLineAndMeasure,onChange:e=>{d(e,"useLineAndMeasure")}})))}function b(i){const{networkItem:r,onPropertyChanged:l}=i,u=e.hooks.useTranslation(s),d=Object.assign({},{},r),c=()=>{let e=0;return d.useRouteId&&e++,d.useRouteName&&e++,d.useMultiField&&e++,e},g=e=>d.routeIdFields[e].enabled,h=e=>{const t=d.routeIdFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,l("routeIdFields",t,!0)},m={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)(a.SettingSection,{title:u("defaultIdentifier")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:u("routeIdentifier")},(0,e.jsx)(t.Select,{"aria-label":u("routeIdentifier"),className:"w-100",size:"sm",value:d.defaultIdentifer,disabled:1===c(),onChange:e=>{l("defaultIdentifer",e.target.value,!0)}},d.useRouteId&&(0,e.jsx)("option",{value:n.RouteId},u("routeId")),d.useRouteName&&(0,e.jsx)("option",{value:n.RouteName},u("routeName")),d.useMultiField&&(0,e.jsx)("option",{value:n.MultiField},u("routeFields")))),d.defaultIdentifer===n.MultiField&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(p.List,Object.assign({className:"list-routeid-fields pt-2",showCheckbox:!0,dndEnabled:!0,itemsJson:Array.from(d.routeIdFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:g(t),itemStateTitle:e.field.alias,itemStateCommands:[]}))),onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;var s;s=i.map((e=>e.itemStateDetailContent)),l("routeIdFields",s,!0)},renderOverrideItemDetailToggle:(a,i)=>{const{itemJsons:s,itemJsons:[{itemStateDetailVisible:n,itemStateDetailContent:o}]}=i.props,[r]=s,l=+r.itemKey;return o?(0,e.jsx)(t.Checkbox,{"aria-expanded":!!n,className:"jimu-tree-item__detail-toggle mr-2",checked:g(l),onClick:e=>{h(l)}}):null},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;h(+a.itemKey)}},m))),d.supportsLines&&(0,e.jsx)("div",{style:{marginTop:"12px"}},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:u("lineIdentifier")},(0,e.jsx)(t.Select,{"aria-label":u("lineIdentifier"),className:"w-100",size:"sm",value:d.defaultLineIdentifier,disabled:1===c(),onChange:e=>{l("defaultLineIdentifier",e.target.value,!0)}},d.useLineId&&(0,e.jsx)("option",{value:o.LineId},u("lineId")),d.useLineName&&(0,e.jsx)("option",{value:o.LineName},u("lineName"))))))}function y(t){const{widgetId:a,useDataSourceId:i}=t;return e.ReactRedux.useSelector((e=>{var t;let s;s=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(t=s.widgets[a].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===i))}))}var x=g(71442);function R(i){const{networkItem:n,onPropertyChanged:o,onQueryItemChanged:r}=i,l=e.hooks.useTranslation(s);return(0,e.jsx)("div",null,(null==n?void 0:n.sortOptions)&&(0,e.jsx)(a.SettingSection,{role:"group","aria-label":l("results"),title:l("results")},(0,e.jsx)(a.SettingRow,{"aria-label":l("sortResults"),flow:"wrap",label:l("sortResults")},(0,e.jsx)(x.Sort,{onChange:e=>{const{dataSourceId:t,mainDataSourceId:a,dataViewId:i,rootDataSourceId:s}=n.useDataSource,o={dataSourceId:t,mainDataSourceId:a,dataViewId:i,rootDataSourceId:s,fields:n.useDataSource.fields};let l=n.set("sortOptions",e);l=l.set("useDataSource",o),r(l,!0)},value:(0,e.Immutable)(n.sortOptions),useDataSource:n.useDataSource})),(0,e.jsx)(a.SettingRow,{flow:"no-wrap",label:l("expandByDefault")},(0,e.jsx)(t.Switch,{"aria-label":l("expandByDefault"),checked:n.expandByDefault,onChange:e=>{o("expandByDefault",e.target.checked,!0)}}))))}function k(i){const{networkItem:n,onPropertyChanged:o}=i,r=e.hooks.useTranslation(s),l=Object.assign({},{},n),u=(e,t)=>{e.target&&o(t,e.target.checked,!0)},d=()=>{let e=0;return l.searchSingle&&e++,l.searchMultiple&&e++,l.searchRange&&e++,e};return(0,e.jsx)(a.SettingSection,{role:"group","aria-label":r("searchMeasures"),title:r("searchMeasures")},(0,e.jsx)(a.SettingRow,{label:r("singleLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("singleLabel"),checked:l.searchSingle,disabled:1===d()&&l.searchSingle,onChange:e=>{u(e,"searchSingle")}})),(0,e.jsx)(a.SettingRow,{label:r("multipleLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("multipleLabel"),checked:l.searchMultiple,disabled:1===d()&&l.searchMultiple,onChange:e=>{u(e,"searchMultiple")}})),(0,e.jsx)(a.SettingRow,{label:r("rangeLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("rangeLabel"),checked:l.searchRange,disabled:1===d()&&l.searchRange,onChange:e=>{u(e,"searchRange")}})))}function M(i){const{networkItem:n,onPropertyChanged:o}=i,l=e.hooks.useTranslation(s),u=Object.assign({},{},n);return(0,e.jsx)(a.SettingSection,{title:l("spatialReference")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:l("Default")},(0,e.jsx)(t.Select,{"aria-label":l("Default"),className:"w-100",size:"sm",value:u.defaultSpatialReferenceFrom,onChange:e=>{o("defaultSpatialReferenceFrom",e.target.value,!0)}},(0,e.jsx)("option",{value:r.Map},l("map")),(0,e.jsx)("option",{value:r.Lrs},l("lrs")))))}function C(i){const{networkItem:n,intl:o,onPropertyChanged:r}=i,l=e.hooks.useTranslation(s),u=Object.assign({},{},n);return(0,e.jsx)(a.SettingSection,{title:l("search")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:l("radiusWithUnits",{units:(0,c.GetUnits)(u.unitsOfMeasure,o)})},(0,e.jsx)(t.NumericInput,{size:"sm",value:u.searchRadius,precision:3,onAcceptValue:e=>{r("searchRadius",e,!0)},"aria-label":l("radius"),className:"w-100"})))}const j=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],D=[{value:"DerivedRouteName",label:"Derived Route Name"},{value:"DerivedRouteID",label:"Derived Route ID"},{value:"DerivedRouteMeasure",label:"Derived Route Measure"},{value:"DerivedRouteToMeasure",label:"Derived Route ToMeasure"}],N={value:"Distance",label:"Distance"},L=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],F="Network_OBJECTID",O=[{value:"ToRouteID",label:"To RouteID"},{value:"ToRouteName",label:"To Route Name"},{value:"ToRouteLineOrder",label:"To Route Line Order"},{value:"ToRouteFromDate",label:"To Route From Date"},{value:"ToRouteToDate",label:"To Route To Date"}];let T=[],A=[],P=[];function U(i){const{networkItem:n,networkItems:o,onPropertyChanged:r,onPropertiesChanged:l}=i,u=e.hooks.useTranslation(s),[d,c]=e.React.useState(),[g,h]=e.React.useState(!1),[p,m]=e.React.useState();e.React.useEffect((()=>{const e=n.lrsNetworkId,t=o.find((t=>e===t.derivedFromNetworkId&&t.isDerived));(null==t?void 0:t.isDerived)?m(!0):m(!1),T=[],A=[],P=[];const a=n.lrsFields,i=n.additionalFields;if(a)a.forEach((e=>{T[e]=!0,A.push(e)}));else{const e=n.defaultChecked;if(!e)return;e.forEach((e=>{T[e]=!0,A.push(e)}))}if(i)i.forEach((e=>{T[e]=!0,P.push(e)}));else{const e=f();if(!e)return;e.forEach((e=>{T[e.value]=!0,P.push(e.value)}))}c(T),h(n.showAdditionalFields);l(["lrsFields","additionalFields"],[A,P],!0)}),[n.name]);const f=()=>{const e=[];return e.push({label:j.at(0).label,value:j.at(0).value}),e.push({label:j.at(1).label,value:j.at(1).value}),p&&(e.push({label:D.at(0).label,value:D.at(0).value}),e.push({label:D.at(1).label,value:D.at(1).value}),e.push({label:D.at(2).label,value:D.at(2).value}),e.push({label:D.at(3).label,value:D.at(3).value})),e.push({label:N.label,value:N.value}),e.push({label:L.at(0).label,value:L.at(0).value}),e.push({label:L.at(1).label,value:L.at(1).value}),e.push({label:L.at(2).label,value:L.at(2).value}),(null==n?void 0:n.supportsLines)&&(e.push({label:O.at(0).label,value:O.at(0).value}),e.push({label:O.at(1).label,value:O.at(1).value}),e.push({label:O.at(2).label,value:O.at(2).value}),e.push({label:O.at(3).label,value:O.at(3).value}),e.push({label:O.at(4).label,value:O.at(4).value})),e},v=(()=>{const a=n.layerFields;if(!a)return;const i=[];return a.forEach((a=>{i.push((0,e.jsx)("div",null,(0,e.jsx)(t.Checkbox,{checked:null==d?void 0:d[a.jimuName],onClick:e=>{((e,t)=>{if(e)if(t&&!A.includes(e))A.push(e);else if(!t&&A.includes(e)){const t=A.indexOf(e);-1!==t&&A.splice(t,1)}T[e]=t,c(T),r("lrsFields",A,!0)})(a.jimuName,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"}},a.alias)))})),i})(),S=(()=>{const a=[];return f().forEach((i=>{a.push((0,e.jsx)("div",null,(0,e.jsx)(t.Checkbox,{checked:null==d?void 0:d[i.value],onClick:e=>{((e,t)=>{if(e)if(t&&!P.includes(e))P.push(e);else if(!t&&P.includes(e)){const t=P.indexOf(e);-1!==t&&P.splice(t,1)}T[e]=t,c(T),r("additionalFields",P,!0)})(i.value,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"}},i.label)))})),a})();return(0,e.jsx)(a.SettingSection,{role:"group"},(0,e.jsx)(a.SettingRow,{"aria-label":u("advancedFieldDisplay"),flow:"no-wrap",label:u("advancedFieldDisplay")},(0,e.jsx)(t.Switch,{checked:g,onChange:e=>{r("showAdditionalFields",e.target.checked,!0),h(e.target.checked)}})),g&&(0,e.jsx)("div",{style:{paddingTop:"1rem"}},(0,e.jsx)(a.SettingRow,{"aria-label":u("networkFields"),flow:"wrap",label:u("networkFields")},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginLeft:"0.7rem"}},v)),(0,e.jsx)(a.SettingRow,{"aria-label":u("additionalFields"),flow:"wrap",label:u("additionalFields")},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginLeft:"0.7rem"}},S))))}function E(i){var n;const{intl:o,widgetId:r,index:l,networkItem:u,networkItems:d,onNetworkItemChanged:c}=i,g=e.hooks.useTranslation(s),[h,p]=e.React.useState(null==u?void 0:u.name),m=y({widgetId:r,useDataSourceId:null===(n=null==u?void 0:u.useDataSource)||void 0===n?void 0:n.dataSourceId});e.React.useEffect((()=>{(null==u?void 0:u.name)&&h!==(null==u?void 0:u.name)&&p(null==u?void 0:u.name)}),[null==u?void 0:u.name]);const f=e.React.useCallback(((e,t,a=!1)=>{let i;i=null==t?u.without(e):u.set(e,t),c(l,i,a)}),[c,l,u]),v=e.React.useCallback(((e,t,a=!1)=>{if(e.length!==t.length)return;let i;e.forEach(((e,a)=>{i=null==t[a]?null==i?u.without(e):i.without(e):null==i?u.set(e,t[a]):i.set(e,t[a])})),c(l,i,a)}),[c,l,u]),S=e.React.useCallback((e=>{p(e.target.value)}),[]),I=e.React.useCallback((e=>{e.trim().length>0?f("name",e,!0):p(null==u?void 0:u.name)}),[null==u?void 0:u.name,f]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},u&&m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(a.SettingSection,{role:"group","aria-label":g("networkLabel"),title:g("networkLabel")},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:h,onChange:S,onAcceptValue:I,"aria-label":g("networkLabel")}))),(0,e.jsx)(w,{widgetId:r,networkItem:u,onPropertyChanged:f,onPropertiesChanged:v}),(u.useMeasure||u.useLineAndMeasure)&&(0,e.jsx)(k,{networkItem:u,onPropertyChanged:f}),(0,e.jsx)(b,{widgetId:r,networkItem:u,onPropertyChanged:f}),u.useCoordinate&&(0,e.jsx)(M,{networkItem:u,onPropertyChanged:f}),u.useCoordinate&&(0,e.jsx)(C,{intl:o,networkItem:u,onPropertyChanged:f}),(0,e.jsx)(R,{networkItem:u,onPropertyChanged:f,onQueryItemChanged:(e,t=!1)=>{c(l,e,t)}}),(0,e.jsx)(U,{networkItem:u,networkItems:d,onPropertyChanged:f,onPropertiesChanged:v}))))}var z=g(31027),B=g.n(z),W=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const J=t=>{const a=window.SVG,{className:i}=t,s=W(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:n,src:B()},s)):e.React.createElement("svg",Object.assign({className:n},s))};function H(i){var n,o;const{widgetId:r,index:l,referentItem:u,onReferentItemChanged:d}=i,c=e.hooks.useTranslation(s),[g,h]=e.React.useState(null==u?void 0:u.name),[p,m]=e.React.useState(null===(n=null==u?void 0:u.layerFields[0])||void 0===n?void 0:n.name),f=y({widgetId:r,useDataSourceId:null===(o=null==u?void 0:u.useDataSource)||void 0===o?void 0:o.dataSourceId});e.React.useEffect((()=>{var e;(null==u?void 0:u.name)&&g!==(null==u?void 0:u.name)&&(h(null==u?void 0:u.name),m(null===(e=null==u?void 0:u.layerFields[0])||void 0===e?void 0:e.name)),(null==u?void 0:u.displayName)&&m(null==u?void 0:u.displayName)}),[null==u?void 0:u.name]);const v=e.React.useCallback(((e,t,a=!1)=>{let i;i=null==t?u.without(e):u.set(e,t),d(l,i,a)}),[d,l,u]),S=e.React.useCallback((e=>{h(e.target.value)}),[]),I=e.React.useCallback((e=>{e.trim().length>0?v("name",e,!0):h(null==u?void 0:u.name)}),[null==u?void 0:u.name,v]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},u&&f&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(a.SettingSection,{role:"group","aria-label":c("networkLabel"),title:c("networkLabel")},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:S,onAcceptValue:I,"aria-label":c("networkLabel")}))),(0,e.jsx)(a.SettingSection,{role:"group","aria-label":c("configureFields"),title:c("configureFields")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:c("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":c("defaultStr"),className:"w-100",size:"sm",value:p,onChange:e=>{(e=>{m(e);const t=u.set("displayName",e);d(l,t,!1)})(e.target.value)}},(()=>{const t=null==u?void 0:u.layerFields;if(0===(null==t?void 0:t.length))return[];const a=[];return t.forEach(((t,i)=>{a.push((0,e.jsx)("option",{key:i,value:t.name},t.name))})),a})()))))))}var _=function(e,t,a,i){return new(a||(a=Promise))((function(s,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function r(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};const G=g(62838);function $(i){var l,u;const{intl:d,widgetId:g,networkItems:h=[],mapWidgetIds:f,portalUrl:v,theme:S,runningQuery:w,setRunningQuery:b,onNewNetworkItemsAdded:y,onNetworkItemRemoved:x,onClearAll:R,onNetworkItemChanged:k,onNetworkOrderChanged:M,onMapWidgetChanged:C}=i,D=e.React.useRef(null),[N,L]=e.React.useState(!1),[F,O]=e.React.useState(!1),[T,A]=e.React.useState(!1),[P,U]=e.React.useState(-1),[z,B]=e.React.useState(!1),W=e.hooks.useTranslation(s,c.messages);let $=w;const V=()=>{const e=null==f?void 0:f[0],t=Q(e),a=[];return t.forEach((e=>{var t;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,s=ae(i);a.includes(s)||a.push(s)})),a},Q=t=>{var a,i,s,n,o;let r=[];if(!t)return r;const l=(null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?null===(s=null===(i=(0,e.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===s?void 0:s.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig;if(!l)return r;const u=null===(o=l.widgets[t])||void 0===o?void 0:o.useDataSources;if(void 0!==u){u.map((e=>e.dataSourceId)).forEach((t=>{const a=e.DataSourceManager.getInstance().getDataSource(t),i=null==a?void 0:a.getDataSourcesByType(e.DataSourceTypes.FeatureLayer);i&&(r=r.concat(i))}))}return r},q=(t,a)=>_(this,void 0,void 0,(function*(){$=!0,b(!0);let i=!1;const s=t[a];let n=null;const o=e.SessionManager.getInstance().getSessionByUrl(v),r=o&&o.token?o.token:"";return n=r?{f:"json",token:r}:{f:"json"},i=yield K({method:"GET",url:s,params:n}).then((e=>{if(e.hasOwnProperty("lrs")){if(e.hasOwnProperty("networkLayers")||e.hasOwnProperty("eventLayers")||e.hasOwnProperty("calibrationPointLayers")||e.hasOwnProperty("intersectionLayers")||e.hasOwnProperty("nonLRSLayers")){return["networkLayers","eventLayers","calibrationPointLayers","intersectionLayers","nonLRSLayers"].forEach((t=>_(this,void 0,void 0,(function*(){if(e.hasOwnProperty(t)){if("eventLayers"===t){const a=e[t];e[t]=a.filter((e=>"esriLRSPointEventLayer"===e.type))}const a=e[t];(null==a?void 0:a.length)>0&&(yield Y(e[t],t))}})))),!0}return O(!0),setTimeout((()=>{O(!1)}),c.errorMessageDelay),!1}return L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay),!1})).catch((e=>!1)),i})),K=t=>new Promise((function(a,i){const s={params:t.params,httpMethod:t.method};e.esri.restRequest.request(t.url,s).then((e=>{a(e)})).catch((e=>{a(e)}))})),Y=(e,t)=>_(this,void 0,void 0,(function*(){const a=null==f?void 0:f[0],i=Q(a),s=[],n=[];e.forEach((e=>{n.push(e.id)}));const o=[];i.forEach((e=>{var t,a;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,r=null==e?void 0:e.getLayerDefinition(),l=-1===h.findIndex((t=>t.id===e.id)),u=n.findIndex((e=>e===r.id))>-1,d=-1===o.findIndex((e=>e===r.id));i&&l&&u&&d&&(o.push(r.id),s.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(a=e.getRootDataSource())||void 0===a?void 0:a.id}))})),"networkLayers"===t&&0===n.length?(O(!0),setTimeout((()=>{O(!1)}),c.errorMessageDelay)):s.length>0&&(yield X(s,t))})),X=(t,a)=>_(this,void 0,void 0,(function*(){if(0===(null==t?void 0:t.length)||!a)return;const i=yield(()=>_(this,void 0,void 0,(function*(){let i=[];const s=[];return t.forEach((t=>{s.push(e.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,e.Immutable)(t)).then((s=>_(this,void 0,void 0,(function*(){const n=te(s);n||Promise.reject(Error(""));const o=null==s?void 0:s.getLayerDefinition(),r=null==n?void 0:n.url;let l;"networkLayers"===a?l=ae(r)+"/networkLayers/"+o.id:"eventLayers"===a?l=ae(r)+"/eventLayers/"+o.id:"calibrationPointLayers"===a?l=ae(r)+"/calibrationPointLayers/"+o.id:"intersectionLayers"===a?l=ae(r)+"/intersectionLayers/"+o.id:"nonLRSLayers"===a&&(l=ae(r)+"/nonLRSLayers/"+o.id),"networkLayers"===a?yield Z(s,t,n,l,r).then((t=>(t&&(i=i.concat([(0,e.Immutable)(t)])),i))):yield ee(s,t,n,l,a).then((t=>(t&&(i=i.concat([(0,e.Immutable)(t)])),i)))})))))})),yield Promise.all(s),i})))();y(i)})),Z=(t,a,i,s,l)=>{const u=e.SessionManager.getInstance().getSessionByUrl(v),d=u&&u.token?u.token:"";let h=null;return h=d?{f:"json",token:d}:{f:"json"},new Promise(((l,u)=>{K({method:"POST",url:s,params:h}).then((u=>_(this,void 0,void 0,(function*(){var d;if(!u)return;const h=u.routeIdFieldName,p=u.routeNameFieldName,m=u.fromDateFieldName,f=u.toDateFieldName,v=u.routeIdFields,S=!!h&&h.length>0,I=!!p&&p.length>0,w=!!v&&v.length>1,b=u.supportsLines;let y,x,R,k,M,C;const D=[],N=u.measurePrecision,L=u.isDerived,F=u.derivedFromNetworkId;let O=n.RouteId;b?O=n.RouteName:(null==v?void 0:v.length)>1&&(O=n.MultiField),b&&(x=u.lineIdFieldName,y=!!x&&x.length>0,M=u.lineNameFieldName,k=!!M&&M.length>0,R=u.lineOrderFieldName,k?C=o.LineName:y&&(C=o.LineId));const T=[];v&&v.forEach((e=>{h!==e&&p!==e&&T.push(e)}));const A=null==t?void 0:t.getSchema(),P=(null==A?void 0:A.fields)?Object.values(null==A?void 0:A.fields):[],U=P.find((e=>h===e.name)),E=P.find((e=>p===e.name)),z=P.find((e=>x===e.name)),B=P.find((e=>M===e.name)),W=P.filter((e=>T.includes(e.name))),J=P.find((e=>R===e.name)),H=P.find((e=>m===e.name)),_=P.find((e=>f===e.name));O===n.RouteName&&null==E&&(O=n.RouteId,(null==v?void 0:v.length)>1&&(O=n.MultiField)),U&&D.push(U.alias),E&&D.push(E.alias),W.length>1&&W.forEach((e=>{D.push(e.alias)})),D.push(j.at(0).value),D.push(j.at(1).value);const G=[];W.forEach((e=>{const t={field:e,enabled:!0};G.push(t)}));let $="";$=b?null==E?void 0:E.jimuName:null==U?void 0:U.jimuName;const V=[],Q={jimuFieldName:$,order:e.OrderRule.Asc};V.push(Q);const q=`${Math.random()}`.slice(2),K=null==i?void 0:i.getLabel();let Y=1e3;if("esriMeters"!==u.unitsOfMeasure)switch(u.unitsOfMeasure){case"esriDecimalDegrees":Y=.009;break;case"esriNauticalMiles":case"esriIntNauticalMiles":Y=.54;break;case"esriMiles":case"esriIntMiles":Y=.62;break;case"esriKilometers":Y=1;break;case"esriYards":case"esriIntYards":Y=5468;break;case"esriFeet":case"esriIntFeet":Y=1093.6;break;case"esriDecimeters":Y=1e4;break;case"esriInches":case"esriIntInches":Y=39370;break;case"esriCentimeters":Y=1e5;break;case"esriMillimeters":Y=1e6;break;case"esriPoints":Y=2834640}const X=[],Z=null==t?void 0:t.getLayerDefinition(),ee=[null==Z?void 0:Z.globalIdField,null==Z?void 0:Z.objectIdField],te=null==Z?void 0:Z.editFieldsInfo;te&&(ee.push(te.creationDateField),ee.push(te.creatorField),ee.push(te.editDateField),ee.push(te.editorField));const ae=null==Z?void 0:Z.fields,ie=null===(d=null==t?void 0:t.getSchema())||void 0===d?void 0:d.fields;for(const e in ie)ee.includes(e)||X.push(ie[e]);const se=[],ne=ae.find((e=>h===e.name)),oe=ae.find((e=>p===e.name)),re=ae.find((e=>m===e.name)),le=ae.find((e=>f===e.name)),ue=ae.find((e=>x===e.name)),de=ae.find((e=>M===e.name)),ce=ae.find((e=>R===e.name));se.push(ne.name),I&&se.push(oe.name),se.push(re.name),se.push(le.name),ue&&se.push(ue.name),de&&se.push(de.name),ce&&se.push(ce.name);const ge={id:t.id,name:K,configId:q,lrsNetworkId:u.lrsNetworkId,outputLineDsId:`${g}_output_line_${q}`,outputPointDsId:`${g}_output_point_${q}`,networkUrl:s,useRouteId:S,useRouteName:I,useLineId:y,useLineName:k,useMultiField:w,useMeasure:!0,useCoordinate:!0,useReferent:!0,useLineAndMeasure:b,showLineAndMeasure:b,useDataSource:a,defaultMethod:c.SearchMethod.Measure,enabledMethods:[c.SearchMethod.Measure],defaultIdentifer:O,defaultLineIdentifier:C,routeIdFieldName:h,routeNameFieldName:p,lineIdFieldName:x,lineNameFieldName:M,lineOrderFieldName:R,routeIdFields:G,routeIdField:U||void 0,routeNameField:E||void 0,lineIdField:z||void 0,lineNameField:B||void 0,lineOrderField:J||void 0,routeIdFieldNames:v,supportsLines:b,unitsOfMeasure:u.unitsOfMeasure,sortOptions:V,measurePrecision:N,defaultSpatialReferenceFrom:r.Lrs,searchRadius:Y,referent:!1,fromDateField:H,toDateField:_,fromDateFieldName:null==u?void 0:u.fromDateFieldName,toDateFieldName:null==u?void 0:u.toDateFieldName,searchSingle:!0,searchMultiple:!0,searchRange:!0,expandByDefault:!1,spatialReferenceInfo:{wkid:u.spatialReferenceInfo.wkid,wkt:u.spatialReferenceInfo.wkt},isDerived:L,derivedFromNetworkId:F,layerFields:X,defaultChecked:se,showAdditionalFields:!1,allFieldsDetails:P},he=(0,e.Immutable)(Object.assign({},ge,{networkInfo:ge}));l(he)}))))}))},ee=(t,a,i,s,n)=>{const o=e.SessionManager.getInstance().getSessionByUrl(v),r=o&&o.token?o.token:"";let l=null;return l=r?{f:"json",token:r}:{f:"json"},new Promise(((o,r)=>{K({method:"POST",url:s,params:l}).then((r=>_(this,void 0,void 0,(function*(){var l,u;if(!r)return;const d=null==i?void 0:i.getLabel(),g=[],h=null==t?void 0:t.getLayerDefinition(),p=[null==h?void 0:h.globalIdField],m=null==h?void 0:h.editFieldsInfo;m&&(p.push(m.creationDateField),p.push(m.creatorField),p.push(m.editDateField),p.push(m.editorField));const f=null==h?void 0:h.fields;(null==f?void 0:f.length)>0&&f.forEach((e=>{"esriFieldTypeDate"===(null==e?void 0:e.type)&&p.push(null==e?void 0:e.name)}));const v=null===(l=null==t?void 0:t.getSchema())||void 0===l?void 0:l.fields;for(const e in v)p.includes(e)||g.push(v[e]);const S={id:t.id,layerId:r.id,name:d,networkUrl:s,type:n,useDataSource:a,referent:!0,defaultMethod:c.SearchMethod.Referent,displayName:null===(u=g[0])||void 0===u?void 0:u.name,layerFields:g,routeIdFieldName:null==r?void 0:r.routeIdFieldName,fromDateFieldName:null==r?void 0:r.fromDateFieldName,toDateFieldName:null==r?void 0:r.toDateFieldName,dateFormat:null==r?void 0:r.dateFormat,allFields:null==r?void 0:r.fields},I=(0,e.Immutable)(Object.assign({},S,{networkInfo:S}));o(I)}))))}))},te=t=>t?t.type===e.DataSourceTypes.SceneLayer?t.getAssociatedDataSource():t:null,ae=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},ie=e.React.useCallback((()=>{U(-1)}),[]),se=e.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${S.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${S.ref.palette.neutral[1e3]};
          font-size: ${e.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${S.ref.palette.neutral[800]};
        }
      }
    }
  `,ne={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};let oe=W("networkConfig");return(null===(l=h[P])||void 0===l?void 0:l.referent)&&(oe=W("referentConfig")),(0,e.jsx)("div",{ref:D,css:se,className:(0,e.classNames)("d-flex flex-column",{"h-100":0===h.length})},(0,e.jsx)(a.SettingSection,{className:"border-0"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(a.SettingRow,{label:W("selectMap")}),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(a.MapWidgetSelector,{onSelect:e=>{C(e)},useMapWidgetIds:f})),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",type:"primary",className:"w-100 text-dark",onClick:()=>{if(L(!1),B(!1),O(!1),A(!1),void 0===(null==f?void 0:f[0]))A(!0),setTimeout((()=>{A(!1)}),c.errorMessageDelay);else{const e=V();e.length>1?(B(!0),setTimeout((()=>{B(!1)}),c.errorMessageDelay)):e.length>0?$||q(e,0).then((e=>{e||(L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay))})).catch((e=>{$=!1,b(!1),console.error(e)})):(L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay))}},title:W("importAll"),"aria-label":W("importAll")},W("loadLayers"))),h&&h.length>0&&(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:R,title:W("clearLayers"),"aria-label":W("clearLayers")},W("clearLayers"))),N&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(d,"noLrsLayersTips")))),T&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(d,"noMapSelectedTips")))),F&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(d,"noNetworkLayersTips")))),z&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(d,"multipleServicesTips")))))),(0,e.jsx)(a.SettingSection,{className:(0,e.classNames)("pt-0 border-0",{"h-100":0===h.length})},(0,e.jsx)("div",{className:"setting-ui-unit-list"},(0,e.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:h.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:P===t,itemStateTitle:e.name,itemStateCommands:[{label:W("removeNetwork"),iconProps:()=>({icon:G,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,a=+t.itemKey;a===P&&ie(),x(a)}}]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;M(i.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;var i;i=+a.itemKey,U(i===P?-1:i)}},ne)),h.length===P&&(0,e.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-new",css:e.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${P}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},ne))),0===h.length&&(0,e.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,e.jsx)("div",{className:"empty-placeholder-inner"},(0,e.jsx)("div",{className:"empty-placeholder-icon"},(0,e.jsx)(J,{size:48})),(0,e.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:W("blankStatus")}}))),(0,e.jsx)(a.SidePopper,{isOpen:P>=0&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:ie,position:"right",trigger:null==D?void 0:D.current,title:oe},!1===(null===(u=h[P])||void 0===u?void 0:u.referent)?(0,e.jsx)(E,{intl:d,widgetId:g,index:P,total:h.length,networkItems:h,networkItem:h[P],onNetworkItemChanged:k}):(0,e.jsx)(H,{widgetId:g,index:P,total:h.length,referentItem:h[P],onReferentItemChanged:k}))))}var V=g(13089);let Q;class q extends e.React.PureComponent{constructor(n){super(n),this.updateWidgetJson=(...e)=>{const[t,...a]=e,i=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(i,...a)},this.updateConfigForOptions=(...e)=>{let t=null;const a=e.reduce(((e,[a,i,s])=>("networkItems"===a&&(null==s?void 0:s.dsUpdateRequired)&&(t=this.getAllDataSources(i)),e.set(a,i))),this.props.config);t?this.updateWidgetJson({config:a,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:a})},this.tryRemoveNetworkItem=e=>{const t=this.props.config.networkItems[e],a=(0,i.getAppConfigAction)().appConfig;0===V.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t.outputLineDsId,a.widgets).length?this.doRemoveNetworkItem(e,!0):this.setState({showRemoveNetworkItemWarning:!0,indexOfNetworkItemToRemove:e,dsToRemove:t.outputLineDsId})},this.beforeRemovingDataSource=()=>{this.doRemoveNetworkItem(this.state.indexOfNetworkItemToRemove)},this.doRemoveNetworkItem=(e,t=!1)=>{const a={dsUpdateRequired:t},i=this.props.config.networkItems.asMutable({deep:!0});i.splice(e,1),this.updateConfigForOptions(["networkItems",i,a])},this.afterRemovingDataSource=()=>{this.setState({showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null})},this.addNetworkItems=(t,a=!0)=>{var i,s,n;let o=null!==(i=this.props.config.networkItems)&&void 0!==i?i:(0,e.Immutable)([]),r=null!==(n=null===(s=this.props.config.networkItems)||void 0===s?void 0:s.length)&&void 0!==n?n:0;t.forEach((t=>{o=e.Immutable.set(o,r,t),r++})),this.updateConfigForOptions(["networkItems",o,{dsUpdateRequired:a}])},this.updateNetworkItem=(t,a,i=!1)=>{var s;let n=null!==(s=this.props.config.networkItems)&&void 0!==s?s:(0,e.Immutable)([]);n=e.Immutable.set(n,t,a),this.updateConfigForOptions(["networkItems",n,{dsUpdateRequired:i}])},this.reOrderNetworkItems=e=>{this.updateConfigForOptions(["networkItems",e])},this.getAllDataSources=t=>(0,e.Immutable)(t).asMutable({deep:!0}).reduce(((t,i)=>{var s,n;const o=i.useDataSource,r=o.dataSourceId;if(t.useDataSourceMap[r]=t.useDataSourceMap[r]||o,t.useDataSourceMap[r].fields=o.fields,!i.referent){const o=e.DataSourceManager.getInstance().getDataSource(null===(s=i.useDataSource)||void 0===s?void 0:s.dataSourceId);if(o){const e=null===(n=(0,a.getOutputJsonOriginDs)(o))||void 0===n?void 0:n.getDataSourceJson(),s=this.getInitOutDataSource(this.props.widgetId,e,i,!0),r=this.getInitOutDataSource(this.props.widgetId,e,i,!1);t.outputDataSources.push(s),t.outputDataSources.push(r)}}return t}),{useDataSourceMap:{},outputDataSources:[]}),this.getInitOutDataSource=(e,t,a,i)=>{const s=i?this.getI18nMessage("outputDsLabelPoint",{label:`${a.name}`}):this.getI18nMessage("outputDsLabelLine",{label:`${a.name}`}),n=i?a.outputPointDsId:a.outputLineDsId,o=this.getInitSchema(s,a);return{id:n,type:null==t?void 0:t.type,label:s,originDataSources:[a.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:o,geometryType:i?"esriGeometryPoint":"esriGeometryPolyline"}},this.getInitSchema=(t="",a)=>{const i={},s=e.DataSourceManager.getInstance().getDataSource(a.useDataSource.dataSourceId),n=null==s?void 0:s.getSchema().fields.asMutable({deep:!0}),o=[];return Object.keys(n).forEach((e=>{o.push(n[e])})),j.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.Number,jimuName:t.value,name:t.value})})),o.push({alias:N.value,type:e.JimuFieldType.String,jimuName:N.value,name:N.value}),L.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),D.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),o.push({alias:O.at(0).value,type:e.JimuFieldType.String,jimuName:O.at(0).value,name:O.at(0).value}),o.push({alias:O.at(1).value,type:e.JimuFieldType.String,jimuName:O.at(1).value,name:O.at(1).value}),o.push({alias:O.at(2).value,type:e.JimuFieldType.String,jimuName:O.at(2).value,name:O.at(2).value}),o.push({alias:O.at(3).value,type:e.JimuFieldType.Date,jimuName:O.at(3).value,name:O.at(3).value}),o.push({alias:O.at(4).value,type:e.JimuFieldType.Date,jimuName:O.at(4).value,name:O.at(4).value}),o.push({alias:F,type:e.JimuFieldType.String,jimuName:F,name:F}),null==o||o.forEach((e=>{i[null==e?void 0:e.jimuName]=e})),{label:t,idField:"OBJECTID",fields:i}},this.hideRemovePopup=()=>{this.setState({showRemoveNetworkItemWarning:!1})},this.getI18nMessage=(e,a)=>{const i=Object.assign({},s,t.defaultMessages,c.messages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},a)},this.handleHighlishStyleChange=e=>{const t=this.props.config.highlightStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",t)})},this.handleLabelStyleChange=e=>{const t=this.props.config.labelStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",t)})},this.handleDefaultOffsetUnitChange=e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,i=this.props.config.resultConfig.asMutable({deep:!0});i.defaultOffsetUnit=a,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",i)})},this.handleDefaultReferentChange=t=>{var a;const i=null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.value,s=this.props.config.networkItems.find((e=>e.layerId===i)),n=this.props.config.resultConfig.asMutable({deep:!0});n.defaultReferentLayer=(0,e.Immutable)(s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",n)})},this.handlePageSizeChange=e=>{const t=this.props.config.resultConfig.asMutable({deep:!0});t.pageSize=e,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})},this.handleHideMethodChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideMethod",t)})},this.handleHideNetworkChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideNetwork",t)})},this.handleHideRouteSearchByLine=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideRoute",t)})},this.handleDefaultNetworkChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})},this.removeAllLayers=(e=!1)=>{this.setRunningQuery(!1);const t={dsUpdateRequired:e};this.updateConfigForOptions(["networkItems",[],t])},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.networkSupportsLine=e=>{const{config:t}=this.props;if(!t.networkItems||0===t.networkItems.length)return;const a=t.networkItems.find((t=>t.name===e));return null==a?void 0:a.supportsLines},this.setRunningQuery=e=>{Q=e},this.state={showLayerPanel:!1,noLrsLayers:!1,showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null}}componentDidMount(){Q=!1}getUnits(){return[this.getI18nMessage("inches"),this.getI18nMessage("points"),this.getI18nMessage("feet"),this.getI18nMessage("yards"),this.getI18nMessage("miles"),this.getI18nMessage("nauticalMiles"),this.getI18nMessage("millimeters"),this.getI18nMessage("centimeters"),this.getI18nMessage("meters"),this.getI18nMessage("kilometers"),this.getI18nMessage("decimalDegrees"),this.getI18nMessage("decimeters"),this.getI18nMessage("intFeet")]}getUnit(e){const t=this.getUnits();return e?(0,c.GetEsriUnits)(t[e],this.props.intl):(0,c.GetEsriUnits)(t[0],this.props.intl)}getHighlightStyleConfig(){if(this.props.config.highlightStyle)return this.props.config.highlightStyle;{const e=this.getDefaultHighlightStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",e)}),e}}getDefaultHighlightStyleConfig(){return{color:c.highlightColor,size:3}}getLabelStyleConfig(){if(this.props.config.labelStyle)return this.props.config.labelStyle;{const e=this.getDefaultLabelStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",e)}),e}}getDefaultLabelStyleConfig(){return{color:c.colorBlack,size:12}}getResultConfig(){if(this.props.config.resultConfig)return this.props.config.resultConfig;{const e=this.getDefaultResultsConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",e)}),e}}getDefaultResultsConfig(){return{pageSize:25}}getDefaultOffsetUnitsConfig(){let t=this.props.config.resultConfig.asMutable({deep:!0});return(0,c.isDefined)(t)||(t=this.getDefaultResultsConfig()),(0,c.isDefined)(t.defaultOffsetUnit)&&""!==t.defaultOffsetUnit||(t.defaultOffsetUnit=this.getUnit(),(0,c.isDefined)(t.defaultReferentLayer)||(t.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent)))),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})),t.defaultOffsetUnit}getDefaultReferentConfig(){const t=this.props.config;let a=this.props.config.resultConfig.asMutable({deep:!0});return(0,c.isDefined)(a)||(a=this.getDefaultResultsConfig()),a&&(0,c.isDefined)(a.defaultReferentLayer)&&t.networkItems.findIndex((e=>e.layerId===a.defaultReferentLayer.layerId))>-1||(a.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent))),""===a.defaultOffsetUnit&&(a.defaultOffsetUnit=this.getUnit()),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",a)})}),200)),a.defaultReferentLayer.layerId}getHideMethodConfig(){return this.props.config.hideMethod}getHideNetworkConfig(){return this.props.config.hideNetwork}getHideRouteSearchByLineConfig(){return this.props.config.hideRoute}getDefaultNetworkConfig(){const e=this.props.config;if(this.props.config.defaultNetwork&&""!==e.defaultNetwork&&this.props.config.networkItems.findIndex((t=>t.name===e.defaultNetwork))>-1)return this.props.config.defaultNetwork;if(this.props.config.networkItems.filter((e=>!e.referent)).length>0){const e=this.props.config.networkItems.find((e=>!e.referent)).name;return setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})}),200),e}}render(){var i,s;const{config:n}=this.props,o=this.networkSupportsLine(this.getDefaultNetworkConfig());return(0,e.jsx)("div",{className:"setting-search-by-route h-100"},(0,e.jsx)("div",{className:"jimu-widget-setting setting-search-by-route__setting-content h-100"},(0,e.jsx)($,{runningQuery:Q,setRunningQuery:this.setRunningQuery,intl:this.props.intl,widgetId:this.props.id,networkItems:this.props.config.networkItems,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onNewNetworkItemsAdded:this.addNetworkItems,onNetworkItemChanged:this.updateNetworkItem,onClearAll:this.removeAllLayers,onNetworkItemRemoved:this.tryRemoveNetworkItem,onNetworkOrderChanged:this.reOrderNetworkItems,onMapWidgetChanged:this.mapWidgetIdUpdated}),0!==n.networkItems.length&&(0,e.jsx)("div",null,(0,e.jsx)(a.SettingSection,{role:"group",title:this.getI18nMessage("selectionSettings"),"aria-label":this.getI18nMessage("selectionSettings")},(0,e.jsx)(a.SettingRow,{label:this.getI18nMessage("selectionHighlight")},(0,e.jsx)(d.ColorPicker,{color:this.props.config.highlightStyle.color?this.props.config.highlightStyle.color:c.highlightColor,value:this.getHighlightStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("selectionHighlight")})),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("graphicWidth")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getHighlightStyleConfig().size||3,precision:1,min:0,max:15,step:.1,onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("graphicWidth"),className:"w-100"})),(0,e.jsx)(a.SettingRow,{label:this.getI18nMessage("labelColor")},(0,e.jsx)(d.ColorPicker,{color:this.props.config.labelStyle.color?this.props.config.labelStyle.color:c.colorBlack,value:this.getLabelStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelColor")})),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("labelSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getLabelStyleConfig().size,precision:1,min:0,max:30,step:.1,onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelSize"),className:"w-100"}))),(0,e.jsx)(a.SettingSection,{role:"group",title:this.getI18nMessage("resultSettings"),"aria-label":this.getI18nMessage("resultSettings")},(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("resultsPageSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getResultConfig().pageSize,precision:0,min:5,max:500,onChange:this.handlePageSizeChange,"aria-label":this.getI18nMessage("resultsPageSize"),className:"w-100"}))),(0,e.jsx)(a.SettingSection,{role:"group",title:(0,c.formatMessage)(this.props.intl,"displaySettings"),"aria-label":(0,c.formatMessage)(this.props.intl,"displaySettings")},(0,e.jsx)(a.SettingRow,{label:(0,c.formatMessage)(this.props.intl,"hideMethod")},(0,e.jsx)(t.Switch,{"aria-label":(0,c.formatMessage)(this.props.intl,"hideMethod"),checked:this.getHideMethodConfig(),onChange:this.handleHideMethodChange})),(0,e.jsx)(a.SettingRow,{label:(0,c.formatMessage)(this.props.intl,"hideNetwork")},(0,e.jsx)(t.Switch,{"aria-label":(0,c.formatMessage)(this.props.intl,"hideNetwork"),checked:this.getHideNetworkConfig(),onChange:this.handleHideNetworkChange})),o&&(0,e.jsx)(a.SettingRow,{label:(0,c.formatMessage)(this.props.intl,"hideRoute")},(0,e.jsx)(t.Switch,{"aria-label":(0,c.formatMessage)(this.props.intl,"hideRoute"),checked:this.getHideRouteSearchByLineConfig(),onChange:this.handleHideRouteSearchByLine})),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultNetwork")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultNetwork"),className:"w-100",size:"sm",value:this.getDefaultNetworkConfig(),disabled:1===n.networkItems.length,onChange:e=>{this.handleDefaultNetworkChange(e.target.value)}},n.networkItems.filter((e=>!e.referent)).map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.name},t.name))))),this.props.config.networkItems&&(null===(i=this.props.config.networkItems.filter((e=>e.referent)))||void 0===i?void 0:i.length)>0&&(0,e.jsx)(m.Fragment,null,(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultReferent")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultReferent"),value:this.getDefaultReferentConfig(),onChange:this.handleDefaultReferentChange},null===(s=this.props.config.networkItems.filter((e=>e.referent)))||void 0===s?void 0:s.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.layerId},t.name))))),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultOffsetUnit")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultOffsetUnit"),value:this.getDefaultOffsetUnitsConfig(),onChange:this.handleDefaultOffsetUnitChange},this.getUnits().map(((t,a)=>(0,e.jsx)("option",{key:a,value:(0,c.GetEsriUnits)(t,this.props.intl)},t)))))))),(0,e.jsx)(V.DataSourceRemoveWarningPopup,{dataSourceId:this.state.dsToRemove,isOpen:this.state.showRemoveNetworkItemWarning,toggle:this.hideRemovePopup,reason:V.DataSourceRemoveWaringReason.DataSourceRemoved,afterRemove:this.afterRemovingDataSource,beforeRemove:this.beforeRemovingDataSource})))}}function K(e){g.p=e}})(),h})())}}}));