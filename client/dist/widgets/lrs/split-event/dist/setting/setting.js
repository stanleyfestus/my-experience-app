System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-core/react"],(function(e,t){var a={},i={},n={},s={},r={},o={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.ReactRedux=e.ReactRedux,a.SessionManager=e.SessionManager,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished,a.urlUtils=e.urlUtils},function(e){i.LrsLayerType=e.LrsLayerType,i.errorMessageDelay=e.errorMessageDelay,i.formatMessage=e.formatMessage,i.getFeatureLayer=e.getFeatureLayer,i.isConflictPreventionEnabled=e.isConflictPreventionEnabled,i.isDefined=e.isDefined,i.isParentNetworkAvailable=e.isParentNetworkAvailable,i.requestService=e.requestService},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.Select=e.Select,n.Switch=e.Switch,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){o.Fragment=e.Fragment}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=s},98640:e=>{"use strict";e.exports=r},47626:e=>{"use strict";e.exports=i}},t={};function l(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var d={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(d),l.d(d,{__set_webpack_public_path__:()=>R,default:()=>w});var e=l(79244),t=l(47626),a=l(14321);const i={blankStatus:"Select a map to import LRS networks",defaultSettings:"Default Settings",defaultEvent:"Event",defaultMethod:"Method",defaultType:"Type",methodMeasure:"Route and Measure",methodCoordinate:"Coordinate",methodLocationOffset:"Location Offset",operationTypeSingle:"Single Point",operationTypeMultiple:"Multiple Point",loadLayers:"Load Layers",clearLayers:"Clear Layers",useFieldAlias:"Use field alias",configureFields:"Configure Fields",layerConfig:"Layer Configuration",selectMap:"Select Map",noNetworkLayersTips:"No Network layers in the map",noLineEventLayersTips:"No Line event layers in the map",missingParentNetwork:"Parent network is missing",attributeEditable:"Editable",attributeNotEditable:"Not editable"};var n=l(79298),s=l(98640),r=l(68972),o=l(28996),c=l.n(o),u=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const m=t=>{const a=window.SVG,{className:i}=t,n=u(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:s,src:c()},n)):e.React.createElement("svg",Object.assign({className:s},n))};var p=l(31027),g=l.n(p),h=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const f=t=>{const a=window.SVG,{className:i}=t,n=h(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",i);return a?e.React.createElement(a,Object.assign({className:s,src:g()},n)):e.React.createElement("svg",Object.assign({className:s},n))};const v=l(8547),y=l(51334);function S(r){var o;const{widgetId:l,index:d,lrsLayer:c,onLayerChanged:u}=r,m=e.hooks.useTranslation(i),[p,g]=e.React.useState(null==c?void 0:c.name),h=function(t){const{widgetId:a,useDataSourceId:i}=t;return e.ReactRedux.useSelector((e=>{var t;let n;return n=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=n.widgets[a].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===i))}))}({widgetId:l,useDataSourceId:null===(o=null==c?void 0:c.useDataSource)||void 0===o?void 0:o.dataSourceId});e.React.useEffect((()=>{(null==c?void 0:c.name)&&p!==(null==c?void 0:c.name)&&g(null==c?void 0:c.name)}),[null==c?void 0:c.name]);const f=e.React.useCallback(((e,t,a=!1)=>{let i;i=null==t?c.without(e):c.set(e,t),u(d,i,a)}),[u,d,c]),S=e.React.useCallback(((e,t,a=!1)=>{const i=c.eventInfo.set(e,t),n=c.set("eventInfo",i);u(d,n,a)}),[u,d,c]),x=e.React.useCallback((e=>{g(e.target.value)}),[]),L=e.React.useCallback((e=>{e.trim().length>0?f("name",e,!0):g(null==c?void 0:c.name)}),[null==c?void 0:c.name,f]),I=e=>c.eventInfo.attributeFields[e].enabled,N=e=>{const t=c.eventInfo.attributeFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,S("attributeFields",t,!0)},b={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:s.TreeItemActionType.RenderOverrideItem,children:[{name:s.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:s.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:s.TreeItemActionType.RenderOverrideItemBody,children:[{name:s.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:s.TreeItemActionType.RenderOverrideItemDragHandle},{name:s.TreeItemActionType.RenderOverrideItemDetailToggle},{name:s.TreeItemActionType.RenderOverrideItemTitle},{name:s.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},c&&h&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(n.SettingSection,{role:"group","aria-label":m("label"),title:m("label")},(0,e.jsx)(n.SettingRow,null,(0,e.jsx)(a.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:x,onAcceptValue:L,"aria-label":m("label")})),c.layerType===t.LrsLayerType.event&&(0,e.jsx)(n.SettingRow,{flow:"no-wrap",label:m("useFieldAlias")},(0,e.jsx)(a.Switch,{"aria-label":m("useFieldAlias"),checked:c.useFieldAlias,onChange:(e,t)=>{f("useFieldAlias",t,!1)}}))),c.layerType===t.LrsLayerType.event&&(0,e.jsx)(n.SettingSection,{role:"group"},(0,e.jsx)(n.SettingRow,{flow:"wrap",label:m("configureFields")},(0,e.jsx)(s.List,Object.assign({className:"list-routeid-fields pt-2 w-100",showCheckbox:!0,itemsJson:Array.from(c.eventInfo.attributeFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:I(t),itemStateTitle:c.useFieldAlias?e.field.alias:e.field.name,itemStateCommands:[{label:e.editable?m("attributeEditable"):m("attributeNotEditable"),iconProps:()=>({icon:e.editable?y:v,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;(e=>{const t=c.eventInfo.attributeFields.asMutable({deep:!0});t[e].editable=!t[e].editable,S("attributeFields",t,!0)})(+t.itemKey)}}]}))),renderOverrideItemDetailToggle:(t,i)=>{const{itemJsons:n,itemJsons:[{itemStateDetailVisible:s,itemStateDetailContent:r}]}=i.props,[o]=n,l=+o.itemKey;return r?(0,e.jsx)(a.Checkbox,{"aria-expanded":!!s,className:"jimu-tree-item__detail-toggle mr-2",checked:c.eventInfo.attributeFields[l].enabled,onClick:e=>{N(l)}}):null},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;var n;n=i.map((e=>e.itemStateDetailContent)),S("attributeFields",n,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;N(+a.itemKey)}},b)))))))}var x=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};const L=l(62838);function I(o){const{runningQuery:l,widgetId:d,layers:c=[],mapWidgetIds:u,portalUrl:p,theme:g,setRunningQuery:h,onLayersAdded:v,onLayerRemoved:y,onClearAll:I,onLayerChanged:N,onLayerOrderChanged:b,onMapWidgetedChanged:w,intl:R}=o,F=e.React.useRef(null),[j,T]=e.React.useState(!1),[D,C]=e.React.useState(!1),[M,O]=e.React.useState(!1),[k,E]=e.React.useState(!1),[A,P]=e.React.useState(!1),[U,B]=e.React.useState(-1),H=e.hooks.useTranslation(i);let _=l;const J=()=>{const e=null==u?void 0:u[0],t=W(e),a=[];return t.forEach((e=>{var t;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,n=Q(i);a.includes(n)||a.push(n)})),a},W=t=>{var a,i,n,s,r;let o=[];if(!t)return o;const l=(null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?null===(n=null===(i=(0,e.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig:null===(s=(0,e.getAppStore)().getState())||void 0===s?void 0:s.appConfig;if(!l)return o;const d=null===(r=l.widgets[t])||void 0===r?void 0:r.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((t=>{const a=e.DataSourceManager.getInstance().getDataSource(t),i=null==a?void 0:a.getDataSourcesByType(e.DataSourceTypes.FeatureLayer);i&&(o=o.concat(i))}))}return o},z=(a,i)=>x(this,void 0,void 0,(function*(){_=!0,h(!0);let n=!1;const s=a[i];let r=null;const o=e.SessionManager.getInstance().getSessionByUrl(p),l=o&&o.token?o.token:"";return r=l?{f:"json",token:l}:{f:"json"},n=yield(0,t.requestService)({method:"GET",url:s,params:r}).then((e=>{if(!e.hasOwnProperty("lrs"))return T(!0),setTimeout((()=>{T(!1)}),t.errorMessageDelay),!1;V(e)})).catch((e=>!1)),n})),V=e=>{const a=null==u?void 0:u[0],i=W(a),n=[],s=[],r=[],o=[],l=[],d=[],m=[],p=[];i.forEach((e=>{p.push(e)})),e.networkLayers.forEach((e=>{p.findIndex((t=>t.layerId===e.id.toString()))>-1&&(o.push(e.id),s.push(e.id),r.push(e.name))})),e.eventLayers.forEach((e=>{p.findIndex((t=>t.layerId===e.id.toString()))>-1&&(l.push(e.id),s.push(e.id),r.push(e.name),"esriLRSLinearEventLayer"===e.type&&m.push(e))})),e.intersectionLayers.forEach((e=>{p.findIndex((t=>t.layerId===e.id.toString()))>-1&&(d.push(e.id),s.push(e.id),r.push(e.name))})),i.forEach((e=>{var t,a;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,r=null==e?void 0:e.getLayerDefinition(),o=-1===c.findIndex((t=>t.id===e.id)),l=s.findIndex((e=>e===r.id))>-1;i&&o&&l&&n.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(a=e.getRootDataSource())||void 0===a?void 0:a.id})})),0===c.length&&0===n.length?(T(!0),setTimeout((()=>{T(!1)}),t.errorMessageDelay)):0===o.length?(O(!0),setTimeout((()=>{O(!1)}),t.errorMessageDelay)):0===m.length?(E(!0),setTimeout((()=>{E(!1)}),t.errorMessageDelay)):n.length>0&&q(n,o,l,d)},q=(t,a,i,n)=>x(this,void 0,void 0,(function*(){if(0===(null==t?void 0:t.length))return;const s=yield(()=>x(this,void 0,void 0,(function*(){let s=[];const r=[];return t.forEach((t=>{r.push(e.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,e.Immutable)(t)).then((r=>x(this,void 0,void 0,(function*(){const o=null==r?void 0:r.getLayerDefinition(),l=a.findIndex((e=>e===o.id))>-1,d=i.findIndex((e=>e===o.id))>-1,c=n.findIndex((e=>e===o.id))>-1,u=null==r?void 0:r.url,m=Q(u);let p="";l?p=m+"/networkLayers/"+o.id:d?p=m+"/eventLayers/"+o.id:c&&(p=m+"/intersectionLayers/"+o.id),p.length>0&&(yield K(r,t,p,m,l,d,c).then((t=>(t&&(s=s.concat([(0,e.Immutable)(t)])),s))))})))))})),yield Promise.all(r),s})))();v(s)})),K=(a,i,n,s,r,o,l)=>(0,t.getFeatureLayer)(a).then((l=>{const d=e.SessionManager.getInstance().getSessionByUrl(p),c=d&&d.token?d.token:"";let u=null;return u=c?{f:"json",token:c}:{f:"json"},new Promise(((d,c)=>{(0,t.requestService)({method:"POST",url:n,params:u}).then((c=>{var u,m,p,g,h;c||d(null);const f=c.type;if("esriLRSNetworkLayer"===f||"esriLRSLinearEventLayer"===f){const f={},v={},y=null==a?void 0:a.getSchema(),S=(null==y?void 0:y.fields)?Object.values(null==y?void 0:y.fields):[],x=c.id;let L=t.LrsLayerType.nonLrs;if(r){L=t.LrsLayerType.network,f.networkUrl=n,f.datasetName=c.datasetName,f.lrsNetworkId=c.lrsNetworkId;const e=c.routeIdFieldName;f.routeIdFieldSchema=S.find((t=>e===t.name));const a=c.routeNameFieldName;f.routeNameFieldSchema=S.find((e=>a===e.name));const i=c.fromDateFieldName;f.fromDateFieldSchema=S.find((e=>i===e.name));const s=c.toDateFieldName;if(f.toDateFieldSchema=S.find((e=>s===e.name)),f.useRouteName=c.supportsLines,(0,t.isDefined)(a)&&e.length&&(f.useRouteName=!0),f.supportsLines=c.supportsLines,f.supportsLines){const e=null==c?void 0:c.lineIdFieldName;f.lineIdFieldSchema=S.find((t=>e===t.name));const t=null==c?void 0:c.lineNameFieldName;f.lineNameFieldSchema=S.find((e=>t===e.name));const a=null==c?void 0:c.lineOrderFieldName;f.lineOrderFieldSchema=S.find((e=>a===e.name))}f.measurePrecision=c.measurePrecision,f.unitsOfMeasure=c.unitsOfMeasure,f.mTolerance=c.spatialReferenceInfo.mTolerance,f.xyTolerance=c.spatialReferenceInfo.xyTolerance;const r=[],o=c.eventLayers;(0,t.isDefined)(o)&&o.length>0&&o.forEach((e=>{r.push(e.name)})),f.eventLayers=r;const l=[],d=c.intersectionLayers;d&&d.length>0&&d.forEach((e=>{l.push(e.name)})),f.intersectionLayers=l}else if(o){L=t.LrsLayerType.event,v.datasetName=c.datasetName,v.eventUrl=n,v.fromDateFieldName=c.fromDateFieldName,v.toDateFieldName=c.toDateFieldName,v.derivedFromMeasureFieldName=c.derivedFromMeasureFieldName,v.derivedRouteIdFieldName=c.derivedRouteIdFieldName,v.derivedRouteNameFieldName=c.derivedRouteNameFieldName,v.derivedToMeasureFieldName=c.derivedToMeasureFieldName,v.fromReferentLocationFieldName=c.fromReferentLocationFieldName,v.fromReferentMethodFieldName=c.fromReferentMethodFieldName,v.fromReferentOffsetFieldName=c.fromReferentOffsetFieldName,v.toReferentLocationFieldName=c.toReferentLocationFieldName,v.toReferentMethodFieldName=c.toReferentMethodFieldName,v.toReferentOffsetFieldName=c.toReferentOffsetFieldName,v.locErrorFieldName=c.locErrorFieldName,v.eventIdFieldName=c.eventIdFieldName,v.routeIdFieldName=c.routeIdFieldName,v.routeNameFieldName=c.routeNameFieldName,v.fromMeasureFieldName=c.fromMeasureFieldName,v.toRouteIdFieldName=c.toRouteIdFieldName,v.toRouteNameFieldName=c.toRouteNameFieldName,v.toMeasureFieldName=c.toMeasureFieldName;const e=[v.fromDateFieldName,v.toDateFieldName,v.derivedFromMeasureFieldName,v.derivedRouteIdFieldName,v.derivedRouteNameFieldName,v.derivedToMeasureFieldName,v.fromReferentLocationFieldName,v.fromReferentMethodFieldName,v.fromReferentOffsetFieldName,v.toReferentLocationFieldName,v.toReferentMethodFieldName,v.toReferentOffsetFieldName,v.locErrorFieldName,v.eventIdFieldName,v.routeIdFieldName,v.routeNameFieldName,v.fromMeasureFieldName,v.toRouteIdFieldName,v.toRouteNameFieldName,v.toMeasureFieldName],i=null==l?void 0:l.objectIdField,s=null==l?void 0:l.globalIdField,r=null==l?void 0:l.editFieldsInfo,o=[i,s],d=a;let f;(null===(u=null==d?void 0:d.layerDefinition)||void 0===u?void 0:u.hasGeometryProperties)&&(null===(p=null===(m=null==d?void 0:d.layerDefinition)||void 0===m?void 0:m.geometryProperties)||void 0===p?void 0:p.shapeLengthFieldName)&&(f=null===(h=null===(g=null==d?void 0:d.layerDefinition)||void 0===g?void 0:g.geometryProperties)||void 0===h?void 0:h.shapeLengthFieldName,o.push(f)),r&&(o.push(r.creationDateField),o.push(r.creatorField),o.push(r.editDateField),o.push(r.editorField));const y=e.map((e=>(0,t.isDefined)(e)?e.toLowerCase():e)),x=o.map((e=>(0,t.isDefined)(e)?e.toLowerCase():e));v.lrsFields=S.filter((e=>y.includes(e.name.toLowerCase())));const I=S.filter((e=>!y.includes(e.name.toLowerCase())&&!x.includes(e.name.toLowerCase()))),N=[];I.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};N.push(t)})),v.attributeFields=N,v.parentNetworkId=c.lrsNetworkId,v.canSpanRoutes=c.canSpanRoutes}const I={id:a.id,serviceId:x,name:a.getLabel(),originName:a.getLayerDefinition().name,lrsUrl:s,useDataSource:i,layerType:L,networkInfo:f||void 0,eventInfo:v||void 0,useFieldAlias:!0},N=(0,e.Immutable)(Object.assign({},I,{layerInfo:I}));d(N)}else d(null)}))}))})),Q=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},$=e.React.useCallback((()=>{B(-1)}),[]),G=e.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${g.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${g.ref.palette.neutral[1e3]};
          font-size: ${e.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${g.ref.palette.neutral[800]};
        }
      }
    }
  `,X={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:s.TreeItemActionType.RenderOverrideItem,children:[{name:s.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:s.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:s.TreeItemActionType.RenderOverrideItemBody,children:[{name:s.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:s.TreeItemActionType.RenderOverrideItemDragHandle},{name:s.TreeItemActionType.RenderOverrideItemTitle},{name:s.TreeItemActionType.RenderOverrideItemDetailToggle},{name:s.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)("div",{ref:F,css:G,className:(0,e.classNames)("d-flex flex-column",{"h-100":0===c.length})},(0,e.jsx)(n.SettingSection,{className:"border-0"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(n.SettingRow,{label:H("selectMap")}),(0,e.jsx)(n.SettingRow,null,(0,e.jsx)(n.MapWidgetSelector,{onSelect:e=>{w(e)},useMapWidgetIds:u})),(0,e.jsx)(n.SettingRow,null,(0,e.jsx)(a.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:()=>{if(T(!1),P(!1),O(!1),C(!1),void 0===(null==u?void 0:u[0]))C(!0),setTimeout((()=>{C(!1)}),t.errorMessageDelay);else{const e=J();e.length>1?(P(!0),setTimeout((()=>{P(!1)}),t.errorMessageDelay)):e.length>0?_||z(e,0):(T(!0),setTimeout((()=>{T(!1)}),t.errorMessageDelay))}},title:H("loadLayers"),"aria-label":H("loadLayers")},H("loadLayers"))),c&&c.length>0&&(0,e.jsx)(n.SettingRow,null,(0,e.jsx)(a.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:I,title:H("clearLayers"),"aria-label":H("clearLayers")},H("clearLayers"))),j&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(m,{color:g.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,t.formatMessage)(R,"noLrsLayersTips")))),D&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(m,{color:g.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,t.formatMessage)(R,"noMapSelectedTips")))),M&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(m,{color:g.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},H("noNetworkLayersTips")))),k&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(m,{color:g.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},H("noLineEventLayersTips")))),A&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(r.Fragment,null,(0,e.jsx)(m,{color:g.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,t.formatMessage)(R,"multipleServicesTips")))))),(0,e.jsx)(n.SettingSection,{className:(0,e.classNames)("pt-0 border-0",{"h-100":0===c.length})},(0,e.jsx)(n.SettingRow,null,(0,e.jsx)("div",{className:"setting-ui-unit-list w-100"},(0,e.jsx)(s.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:c.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:U===t,itemStateTitle:e.name,itemStateCommands:[{label:H("remove"),iconProps:()=>({icon:L,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,a=+t.itemKey;a===U&&$(),y(a)}}]}))),renderOverrideItemDetailToggle:(i,n)=>{const{itemJsons:s}=n.props,[r]=s;return(0,t.isParentNetworkAvailable)(+r.itemKey,c)?"":(0,e.jsx)(a.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:H("missingParentNetwork")})},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;b(i.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;var i;i=+a.itemKey,B(i===U?-1:i)}},X)),c.length===U&&(0,e.jsx)(s.List,Object.assign({className:"setting-ui-unit-list-new",css:e.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${U}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},X)))),0===c.length&&(0,e.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,e.jsx)("div",{className:"empty-placeholder-inner"},(0,e.jsx)("div",{className:"empty-placeholder-icon"},(0,e.jsx)(f,{size:48})),(0,e.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:H("blankStatus")}}))),(0,e.jsx)(n.SidePopper,{isOpen:U>=0&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:$,position:"right",trigger:null==F?void 0:F.current,title:H("layerConfig")},(0,e.jsx)(S,{widgetId:d,index:U,total:c.length,lrsLayer:c[U],onLayerChanged:N}))))}var N=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};let b;class w extends e.React.PureComponent{constructor(n){super(n),this.updateWidgetJson=(...e)=>{const[t,...a]=e,i=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(i,...a)},this.updateConfigForOptions=(...e)=>N(this,void 0,void 0,(function*(){let a=null,i=e.reduce(((e,[t,i,n])=>("lrsLayers"===t&&(null==n?void 0:n.dsUpdateRequired)&&(a=this.getAllDataSources(i)),e.set(t,i))),this.props.config);const n=[],s=[],r=[];if(i.lrsLayers.forEach((e=>{e.layerType===t.LrsLayerType.network?n.push(e.name):e.layerType===t.LrsLayerType.event?s.push(e.name):e.layerType===t.LrsLayerType.intersection&&r.push(e.name)})),i=i.setIn(["networkLayers"],n),i=i.setIn(["eventLayers"],s),i=i.setIn(["intersectionLayers"],r),0===i.lrsLayers.length){const e={index:-1,name:""};i=i.setIn(["defaultEvent"],e)}if(n.length>0){const e=i.lrsLayers.find((e=>e.layerType===t.LrsLayerType.network));if((0,t.isDefined)(e)){const a=yield(0,t.isConflictPreventionEnabled)(e.lrsUrl);i=i.setIn(["conflictPreventionEnabled"],a)}}a?this.updateWidgetJson({config:i,useDataSources:Object.values(a.useDataSourceMap)}):this.updateWidgetJson({config:i})})),this.updateLrsList=()=>{},this.getAllDataSources=t=>(0,e.Immutable)(t).asMutable({deep:!0}).reduce(((e,t)=>{const a=t.useDataSource,i=a.dataSourceId;return e.useDataSourceMap[i]=e.useDataSourceMap[i]||a,e.useDataSourceMap[i].fields=a.fields,e}),{useDataSourceMap:{}}),this.addLayers=(t,a=!0)=>{var i,n,s;let r=null!==(i=this.props.config.lrsLayers)&&void 0!==i?i:(0,e.Immutable)([]),o=null!==(s=null===(n=this.props.config.lrsLayers)||void 0===n?void 0:n.length)&&void 0!==s?s:0;t.forEach((t=>{r=e.Immutable.set(r,o,t),o++})),this.updateConfigForOptions(["lrsLayers",r,{dsUpdateRequired:a}])},this.updateLayerItem=(t,a,i=!1)=>{var n;let s=null!==(n=this.props.config.lrsLayers)&&void 0!==n?n:(0,e.Immutable)([]);s=e.Immutable.set(s,t,a),this.updateConfigForOptions(["lrsLayers",s,{dsUpdateRequired:i}])},this.reOrderLayers=e=>{this.updateConfigForOptions(["lrsLayers",e])},this.removeAllLayers=(e=!1)=>{this.setRunningQuery(!1);const t={dsUpdateRequired:e};this.updateConfigForOptions(["lrsLayers",[],t])},this.removeLayer=(e,t=!1)=>{const a={dsUpdateRequired:t},i=this.props.config.lrsLayers.asMutable({deep:!0});i.splice(e,1),this.updateConfigForOptions(["lrsLayers",i,a])},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.getI18nMessage=(e,t)=>{const n=Object.assign({},i,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.handleDefaultEventChanged=e=>{const t=this.props.config.lrsLayers.findIndex((t=>t.name===e)),a={index:t,name:this.props.config.lrsLayers[t].name};this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultEvent",a)})},this.handleHideEventChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideEvent",t)})},this.handleHideNetworkChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideNetwork",t)})},this.handleHideDateChange=(e,t)=>{t||this.props.config.useRouteStartDate&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useRouteStartDate",!1)}),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideDate",t)})}),200)},this.handleUseRouteStartDatesChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useRouteStartDate",t)})},this.setRunningQuery=e=>{b=e},this.state={showLayerPanel:!1,noLrsLayers:!1,noLrsEvents:!1,dsToRemove:null}}componentDidMount(){b=!1}getDefaultEvent(){const e=this.props.config;if(e.defaultEvent&&-1!==e.defaultEvent.index){const t=e.defaultEvent.index,a=e.defaultEvent.name;return a===e.lrsLayers[t].name?a:(this.handleDefaultEventChanged(e.lrsLayers[t].name),e.lrsLayers[t].name)}{const e=this.props.config.lrsLayers.find((e=>e.layerType===t.LrsLayerType.event));return this.handleDefaultEventChanged(e.name),e.name}}getHideEventConfig(){return this.props.config.hideEvent}getHideNetworkConfig(){return this.props.config.hideNetwork}getHideDateConfig(){return this.props.config.hideDate}getUseRouteStartDatesConfig(){return this.props.config.useRouteStartDate}render(){const{config:i}=this.props;return(0,e.jsx)("div",{className:"setting-split-event h-100"},(0,e.jsx)("div",{className:"jimu-widget-setting setting-split-event__setting-content h-100"},(0,e.jsx)(I,{runningQuery:b,setRunningQuery:this.setRunningQuery,intl:this.props.intl,widgetId:this.props.id,layers:this.props.config.lrsLayers,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onLayersAdded:this.addLayers,onLayerChanged:this.updateLayerItem,onClearAll:this.removeAllLayers,onLayerRemoved:this.removeLayer,onLayerOrderChanged:this.reOrderLayers,onMapWidgetedChanged:this.mapWidgetIdUpdated}),i.eventLayers&&0!==i.eventLayers.length&&(0,e.jsx)("div",null,(0,e.jsx)(n.SettingSection,{role:"group",title:this.getI18nMessage("defaultSettings"),"aria-label":this.getI18nMessage("defaultSettings")},(0,e.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultEvent")},(0,e.jsx)(a.Select,{"aria-label":this.getI18nMessage("defaultEvent"),className:"w-100",size:"sm",value:this.getDefaultEvent(),onChange:e=>{this.handleDefaultEventChanged(e.target.value)}},i.eventLayers.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t},t)))))),(0,e.jsx)(n.SettingSection,{role:"group","aria-label":(0,t.formatMessage)(this.props.intl,"displaySettings"),title:(0,t.formatMessage)(this.props.intl,"displaySettings")},(0,e.jsx)(n.SettingRow,{flow:"no-wrap",label:(0,t.formatMessage)(this.props.intl,"hideEvent")},(0,e.jsx)(a.Switch,{"aria-label":(0,t.formatMessage)(this.props.intl,"hideEvent"),checked:this.getHideEventConfig(),onChange:this.handleHideEventChange})),(0,e.jsx)(n.SettingRow,{flow:"no-wrap",label:(0,t.formatMessage)(this.props.intl,"hideNetwork")},(0,e.jsx)(a.Switch,{"aria-label":(0,t.formatMessage)(this.props.intl,"hideNetwork"),checked:this.getHideNetworkConfig(),onChange:this.handleHideNetworkChange})),(0,e.jsx)("div",{style:{display:"none"}},(0,e.jsx)(n.SettingRow,{label:"Hide Date"},(0,e.jsx)(a.Switch,{"aria-label":"Hide Date",checked:this.getHideDateConfig(),onChange:this.handleHideDateChange})),i.hideDate&&(0,e.jsx)(n.SettingRow,{label:"Use Route Start Date"},(0,e.jsx)(a.Tooltip,{title:"Route start date will be used for new events. If disabled, the current date will be used."},(0,e.jsx)(a.Switch,{"aria-label":"Use Route Start Date",checked:this.getUseRouteStartDatesConfig(),onChange:this.handleUseRouteStartDatesChange}))))))))}}function R(e){l.p=e}})(),d})())}}}));