System.register(["jimu-core","widgets/shared-code/lrs"],(function(e,t){var a={},r={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MutableStoreManager=e.MutableStoreManager,a.getAppStore=e.getAppStore},function(e){r.isDefined=e.isDefined}],execute:function(){e((()=>{"use strict";var e={79244:e=>{e.exports=a},47626:e=>{e.exports=r}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};n.r(o),n.d(o,{default:()=>s});var i=n(79244),u=n(47626),d=function(e,t,a,r){return new(a||(a=Promise))((function(n,o){function i(e){try{d(r.next(e))}catch(e){o(e)}}function u(e){try{d(r.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,u)}d((r=r.apply(e,t||[])).next())}))};class s extends i.AbstractDataAction{isSupported(e,t){return d(this,void 0,void 0,(function*(){var a;if(e.length>1)return!1;const r=e[0];if(1!==r.records.length)return!1;const{dataSource:n,records:o}=r,d=n.type===i.DataSourceTypes.FeatureLayer||n.type===i.DataSourceTypes.SceneLayer,s=n.isDataSourceSet(),l=t!==i.DataLevel.Records,p=r.dataSource,f=(null==p?void 0:p.supportSpatialInfo)&&(null==p?void 0:p.supportSpatialInfo()),v=t===i.DataLevel.Records&&0===(null==o?void 0:o.length),S=!n.isInAppConfig()&&!d;if(s||l||v||S||!f)return!1;if(!n||n.getStatus()===i.DataSourceStatus.NotReady)return!1;const g=n;if(!(0,u.isDefined)(g))return!1;const y=c();let D,I;return(null===(a=null==y?void 0:y.widgets)||void 0===a?void 0:a[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===g.id&&(I=e,D=e.eventInfo)})),(!(0,u.isDefined)(I)||"NETWORK"!==I.layerType)&&!!D}))}onExecute(e,t){return d(this,void 0,void 0,(function*(){var t;const a=e[0],r=a.dataSource,n=c();let o;return(null===(t=null==n?void 0:n.widgets)||void 0===t?void 0:t[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===r.id&&(o=e)})),setTimeout((()=>{i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventLyr",(0,i.Immutable)(o));const e=a.records[0].getData();i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventObjectId",e[a.dataSource.getSchema().idField]),i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventRouteId",e[o.eventInfo.routeIdFieldName]),i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventFromDate",new Date(e[o.eventInfo.fromDateFieldName]))}),1e3),!0}))}}function c(){var e,t,a;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,i.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(a=(0,i.getAppStore)().getState())||void 0===a?void 0:a.appConfig}return o})())}}}));