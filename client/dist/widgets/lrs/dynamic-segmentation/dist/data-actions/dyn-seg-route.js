System.register(["jimu-core","widgets/shared-code/lrs"],(function(e,t){var r={},n={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.DataSourceStatus=e.DataSourceStatus,r.DataSourceTypes=e.DataSourceTypes,r.MutableStoreManager=e.MutableStoreManager,r.getAppStore=e.getAppStore,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){n.isDefined=e.isDefined}],execute:function(){e((()=>{"use strict";var e={79244:e=>{e.exports=r},47626:e=>{e.exports=n}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{void 0!==S&&S.toStringTag&&Object.defineProperty(e,S.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};o.r(a),o.d(a,{default:()=>H});var i=o(79244),u=o(47626);const s="object"==typeof global&&global&&global.Object===Object&&global;var c="object"==typeof self&&self&&self.Object===Object&&self;const l=s||c||Function("return this")();var d=/\s/;const f=function(e){for(var t=e.length;t--&&d.test(e.charAt(t)););return t};var g=/^\s+/;const v=function(e){return e?e.slice(0,f(e)+1).replace(g,""):e};const p=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var S=l.Symbol;const y=S;var b=Object.prototype,h=b.hasOwnProperty,m=b.toString,D=y?y.toStringTag:void 0;const I=function(e){var t=h.call(e,D),r=e[D];try{e[D]=void 0;var n=!0}catch(e){}var o=m.call(e);return n&&(t?e[D]=r:delete e[D]),o};var M=Object.prototype.toString;const O=function(e){return M.call(e)};var j=y?y.toStringTag:void 0;const w=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":j&&j in Object(e)?I(e):O(e)};const A=function(e){return null!=e&&"object"==typeof e};const N=function(e){return"symbol"==typeof e||A(e)&&"[object Symbol]"==w(e)};var P=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,k=/^0o[0-7]+$/i,L=parseInt;const T=function(e){if("number"==typeof e)return e;if(N(e))return NaN;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=v(e);var r=x.test(e);return r||k.test(e)?L(e.slice(2),r?2:8):P.test(e)?NaN:+e};var F=1/0;const J=function(e){return e?(e=T(e))===F||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const C=function(e){var t=J(e),r=t%1;return t==t?r?t-r:t:0};const G=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o};const $=Array.isArray;var E=y?y.prototype:void 0,V=E?E.toString:void 0;const B=function e(t){if("string"==typeof t)return t;if($(t))return G(t,e)+"";if(N(t))return V?V.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};const R=function(e){return null==e?"":B(e)};var _=l.isFinite,q=Math.min;const U=function(e){var t=Math[e];return function(e,r){if(e=T(e),(r=null==r?0:q(C(r),292))&&_(e)){var n=(R(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(R(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");var z=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))};class H extends i.AbstractDataAction{isSupported(e,t){return z(this,void 0,void 0,(function*(){var r;if(e.length>1)return!1;const n=e[0];if(1!==n.records.length)return!1;const o=n.records[0].getData(),a=JSON.parse(JSON.stringify(o)),{dataSource:s,records:c}=n,l=s.type===i.DataSourceTypes.FeatureLayer||s.type===i.DataSourceTypes.SceneLayer,d=t!==i.DataLevel.Records,f=n.dataSource,g=(null==f?void 0:f.supportSpatialInfo)&&(null==f?void 0:f.supportSpatialInfo()),v=t===i.DataLevel.Records&&0===(null==c?void 0:c.length),p=!s.isInAppConfig()&&!l;if(d||v||p||!g)return!1;if(!s||s.getStatus()===i.DataSourceStatus.NotReady)return!1;const S=(0,u.isDefined)(s.getOriginDataSources()[0])?s.getOriginDataSources()[0]:s,y=K(),b=null===(r=null==y?void 0:y.widgets)||void 0===r?void 0:r[this.widgetId];if(!(0,u.isDefined)(S))return!1;let h;return b.config.lrsLayers.forEach((e=>{e.id===S.id&&(h=e.networkInfo)})),!!h&&!(!(0,u.isDefined)(a[h.routeIdFieldSchema.name])||""===a[h.routeIdFieldSchema.name])}))}onExecute(e,t){return z(this,void 0,void 0,(function*(){var t;const r=e[0],{records:n,dataSource:o}=r,a=K(),s=null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[this.widgetId],c=(0,u.isDefined)(o.getOriginDataSources()[0])?o.getOriginDataSources()[0]:o;let l;s.config.lrsLayers.forEach((e=>{e.id===c.id&&(l=e.networkInfo)}));const d=n[0].getData(),f=JSON.parse(JSON.stringify(d)),g={networkInfo:l,routeId:"",routeName:"",fromMeasure:null,toMeasure:null},v=Object.keys(f).find((e=>e===l.routeIdFieldSchema.name)),p=Object.keys(f).find((e=>{var t;return e===(null===(t=l.routeNameFieldSchema)||void 0===t?void 0:t.name)})),S=Object.keys(f).find((e=>"Measure"===e)),y=Object.keys(f).find((e=>"ToMeasure"===e));if(g.routeId=(0,u.isDefined)(v)?f[v]:null,g.routeName=(0,u.isDefined)(p)?f[p]:null,g.fromMeasure=(0,u.isDefined)(S)?f[S]:null,g.toMeasure=(0,u.isDefined)(y)?f[y]:null,isNaN(g.fromMeasure)||isNaN(g.toMeasure)||null===g.fromMeasure||null===g.toMeasure){const e=c.getIdField(),t=Object.keys(f).find((e=>"Network_OBJECTID"===e));let r=null;if(r=(0,u.isDefined)(t)?f[t]:f[e],null===r)return!1;const n=c,o={returnGeometry:!0,returnM:!0,where:`${c.getIdField()} = ${r}`};yield n.query(o).then((e=>z(this,void 0,void 0,(function*(){if(!(e.records.length>0))return!1;{let t=null;yield(0,i.loadArcGISJSAPIModules)(["esri/geometry/Polyline"]).then((r=>{t=r[0];const n=new t(e.records[0].getGeometry());if(!(0,u.isDefined)(n))return!1;const o=n.getPoint(0,0),a=n.paths[n.paths.length-1].length-1,s=n.getPoint(n.paths.length-1,a);g.fromMeasure=U(o.m,l.measurePrecision),g.toMeasure=U(s.m,l.measurePrecision),i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",c),i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",g)}))}}))))}else i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",c),i.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",g);return!0}))}}function K(){var e,t,r;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,i.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(r=(0,i.getAppStore)().getState())||void 0===r?void 0:r.appConfig}return a})())}}}));