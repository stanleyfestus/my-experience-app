/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","calcite-components","jimu-theme","esri/Graphic","jimu-core/react","esri/geometry/geometryEngine","esri/widgets/FeatureForm","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/inputs/DateTimePickerInput","esri/layers/FeatureLayer"],(function(e,t){var a={},n={},i={},r={},o={},s={},l={},c={},u={},d={},f={},p={},m={},g={},h={};return{setters:[function(e){a.DataActionManager=e.DataActionManager,a.DataLevel=e.DataLevel,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.React=e.React,a.SessionManager=e.SessionManager,a.WidgetState=e.WidgetState,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.polished=e.polished,a.utils=e.utils},function(e){n.AdvancedSelect=e.AdvancedSelect,n.Button=e.Button,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.Label=e.Label,n.Loading=e.Loading,n.Modal=e.Modal,n.ModalBody=e.ModalBody,n.ModalHeader=e.ModalHeader,n.NumericInput=e.NumericInput,n.Select=e.Select,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.geometryUtils=e.geometryUtils},function(e){r.default=e.default},function(e){o.GetUnits=e.GetUnits,o.LockAcquireStatus=e.LockAcquireStatus,o.LockAction=e.LockAction,o.LrsApplyEdits=e.LrsApplyEdits,o.QueryLock=e.QueryLock,o.acquireLock=e.acquireLock,o.atOrBetween=e.atOrBetween,o.createFeatureLayer=e.createFeatureLayer,o.createField=e.createField,o.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,o.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,o.fieldsWithContingentValues=e.fieldsWithContingentValues,o.findFieldByName=e.findFieldByName,o.findFieldByType=e.findFieldByType,o.formatMessage=e.formatMessage,o.getCalciteBasicTheme=e.getCalciteBasicTheme,o.getCalciteNoticeTheme=e.getCalciteNoticeTheme,o.getContingentOptions=e.getContingentOptions,o.getExistingFieldNames=e.getExistingFieldNames,o.getGDBVersion=e.getGDBVersion,o.getGeometryGraphic=e.getGeometryGraphic,o.getLayer=e.getLayer,o.getMapAllLayers=e.getMapAllLayers,o.isCodedDomain=e.isCodedDomain,o.isConflictPreventionEnabled=e.isConflictPreventionEnabled,o.isDate=e.isDate,o.isDefined=e.isDefined,o.isInWidgetController=e.isInWidgetController,o.isNumber=e.isNumber,o.isRangeDomain=e.isRangeDomain,o.isWithinTolerance=e.isWithinTolerance,o.normalizeFieldName=e.normalizeFieldName,o.requestService=e.requestService,o.resolveFieldName=e.resolveFieldName,o.setContingentValues=e.setContingentValues,o.shouldTryAcquireLock=e.shouldTryAcquireLock,o.tryAutoReconcile=e.tryAutoReconcile,o.validateContingencyConstraints=e.validateContingencyConstraints,o.validateField=e.validateField,o.validateRangeDomain=e.validateRangeDomain},function(e){s.CalciteAction=e.CalciteAction,s.CalciteActionBar=e.CalciteActionBar,s.CalciteActionGroup=e.CalciteActionGroup,s.CalciteButton=e.CalciteButton,s.CalciteIcon=e.CalciteIcon,s.CalciteInputDatePicker=e.CalciteInputDatePicker,s.CalciteNotice=e.CalciteNotice,s.CalciteOption=e.CalciteOption,s.CalcitePanel=e.CalcitePanel,s.CalcitePopover=e.CalcitePopover,s.CalciteSelect=e.CalciteSelect,s.CalciteTable=e.CalciteTable,s.CalciteTableCell=e.CalciteTableCell,s.CalciteTableHeader=e.CalciteTableHeader,s.CalciteTableRow=e.CalciteTableRow},function(e){l.getTheme=e.getTheme,l.useTheme=e.useTheme},function(e){c.default=e.default},function(e){u.default=e.default},function(e){d.default=e.default},function(e){f.default=e.default},function(e){p.default=e.default},function(e){m.default=e.default},function(e){g.default=e.default},function(e){h.default=e.default}],execute:function(){e((()=>{var e={38252:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=s},22089:e=>{"use strict";e.exports=c},38410:e=>{"use strict";e.exports=p},82228:e=>{"use strict";e.exports=m},44927:e=>{"use strict";e.exports=g},77958:e=>{"use strict";e.exports=d},85633:e=>{"use strict";e.exports=h},59620:e=>{"use strict";e.exports=r},73387:e=>{"use strict";e.exports=f},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=u},1888:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=n},47626:e=>{"use strict";e.exports=o},46942:(e,t)=>{var a;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];a&&(e=o(e,r(a)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var a in e)n.call(e,a)&&e[a]&&(t=o(t,a));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0===(a=function(){return i}.apply(t,[]))||(e.exports=a)}()}},t={};function y(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,y),i.exports}y.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return y.d(t,{a:t}),t},y.d=(e,t)=>{for(var a in t)y.o(t,a)&&!y.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},y.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),y.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},y.p="";var v={};return y.p=window.jimuConfig.baseUrl,(()=>{"use strict";y.r(v),y.d(v,{__set_webpack_public_path__:()=>sn,default:()=>on});var e=y(79244);const t={_widgetLabel:"Dynamic Segmentation",_action_dynSeg_label:"Dynamic Segmentation",measureRange:"Measure Range",routeIdLabel:"Route ID: {routeId}",routeNameLabel:"Route Name: {routeName}",dateLabel:"View Date: {date} ",measureRangeNoValue:"Measure Range:",measureRangeValue:"Measure Range: {fromM} - {toM} {units} ",measuresRange:"{fromM}   -   {toM}",saveSuccess:"Success",saveError:"Error",saveSuccessMessage:"Successfully edited {editCount} event records",saveEdits:"Save",navStart:"Navigate to start",navEnd:"Navigate to end",navBack:"Navigate back",navForward:"Navigate forward",diagramLabel:"Diagram",tableLabel:"Table",editableFields:"Editable Fields",nonEditableFields:"Non-Editable Fields",applyLabel:"Apply",exportLabel:"Export",exportGeoJson:"Export to GeoJSON",exportJson:"Export to JSON",exportCsv:"Export to CSV",selectLayers:"Select Layers",selectFields:"Select Fields",fieldCalculatorLabel:"Field Calculator",updateField:"Update Field",fieldValue:"Field Value",update:"Update",eventLayer:"Event Layer",discardEdits:"Discard Edits",showFields:"Show Fields",dynamicSeg:"Dynamic Segmentation",historicalFirstLabel:"Historical First",historicalLastLabel:"Historical Last",historicalMinimumLabel:"Minimum",historicalMaximumLabel:"Maximum",meanLabel:"Mean",medianLabel:"Median",tableLabelDisabled:"Table: Save/Discard edits to switch",diagramLabelDisabled:"Diagram: Save/Discard edits to switch",applyEditTitle:"Apply Edits",applyEditMessage:"Edits made have not been applied. Would you like to discard or apply these changes?",sldEditSuccessful:"Changes applied successfully.",editFieldSuccess:"Field updated successfully"};var a,n,i,r=y(14321),o=y(38252),s=y.n(o),l=y(62686),c=y(59620),u=y(47626);!function(e){e.Table="Table",e.Diagram="Diagram"}(a||(a={})),function(e){e.LineOnly="LineOnly",e.LineAndPoint="LineAndPoint"}(n||(n={})),function(e){e.Point="Point",e.Line="Line",e.Undefined="Undefined"}(i||(i={}));const d={pendingEdits:new Map,records:[],originalRecords:[],selectedRecordIds:[],fieldInfo:[],errorCount:0,isLoading:!1,display:a.Table,routeInfo:{networkInfo:void 0,fromMeasure:0,toMeasure:0},jimuMapView:void 0,highlightLayer:null,highlightColor:"#65adff",selectedSldId:"",outputDataSources:[]},f=(e,t)=>{switch(t.type){case"SET_EDITS":return Object.assign(Object.assign({},e),{pendingEdits:t.value});case"SET_RECORDS":return Object.assign(Object.assign({},e),{records:t.value});case"SET_ORIGINAL_RECORDS":return Object.assign(Object.assign({},e),{originalRecords:t.value});case"SET_SELECTED_RECORD_IDS":return Object.assign(Object.assign({},e),{selectedRecordIds:t.value});case"SET_FIELD_INFO":return Object.assign(Object.assign({},e),{fieldInfo:t.value});case"SET_ERROR_COUNT":return Object.assign(Object.assign({},e),{errorCount:t.value});case"SET_IS_LOADING":return Object.assign(Object.assign({},e),{isLoading:t.value});case"SET_DISPLAY":return Object.assign(Object.assign({},e),{display:t.value});case"SET_ROUTE_INFO":return Object.assign(Object.assign({},e),{routeInfo:t.value});case"SET_JIMU_MAP_VIEW":return Object.assign(Object.assign({},e),{jimuMapView:t.value});case"SET_HIGHLIGHT_LAYER":return Object.assign(Object.assign({},e),{highlightLayer:t.value});case"SET_HIGHLIGHT_COLOR":return Object.assign(Object.assign({},e),{highlightColor:t.value});case"SET_SELECTED_SLD_ID":return Object.assign(Object.assign({},e),{selectedSldId:t.value});case"SET_OUTPUT_DATA_SOURCES":return Object.assign(Object.assign({},e),{outputDataSources:t.value});case"RESET_STATE":return Object.assign(Object.assign({},d),{isLoading:!0,display:e.display,jimuMapView:e.jimuMapView,highlightLayer:e.highlightLayer,highlightColor:e.highlightColor,outputDataSources:e.outputDataSources});default:return e}},p=e.React.createContext(void 0),m=e.React.createContext(void 0),g=t=>{const{defaultState:a,children:n}=t,[i,r]=e.React.useReducer(f,a||d);return e.React.createElement(p.Provider,{value:i},e.React.createElement(m.Provider,{value:r},n))},h=()=>e.React.useContext(p),b=()=>e.React.useContext(m);function x(t){const{isLoading:a}=t;return(0,e.jsx)("div",null,a&&(0,e.jsx)("div",{className:"d-flex h-100 w-100",style:{position:"absolute"}},(0,e.jsx)("div",{style:{height:"80px",position:"relative",width:"200px",margin:"auto"}},(0,e.jsx)(r.Loading,null))))}const S={routeIdName:"route_id",routeIdAlias:"Route ID",fromDateName:"from_date",fromDateAlias:"From Date",toDateName:"to_date",toDateAlias:"To Date",fromMeasureName:"from_measure",fromMeasureAlias:"From Measure",toMeasureName:"to_measure",toMeasureAlias:"To Measure",objectId:"OBJECTID",typeName:"type",typeAlias:"Type"},w=45,I=25,D=35,N=24;var L=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function k(e,t,a,n){return L(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(e)||!(0,u.isDefined)(t)||!(0,u.isDefined)(n))return null;const i=yield function(e,t,a){return L(this,void 0,void 0,(function*(){const n=[],i=(0,u.getExistingFieldNames)(),r=t.find((t=>(0,u.isDefined)(t.networkInfo)&&t.networkInfo.datasetName===e.datasetName));return yield(0,u.getLayer)(r.useDataSource).then((e=>L(this,void 0,void 0,(function*(){const r=(0,u.findFieldByType)(e.fields,"oid");(0,u.isDefined)(r)&&(i.push(r.name.toUpperCase()),n.push(r));const o=(0,u.findFieldByType)(e.fields,"geometry");(0,u.isDefined)(o)&&(i.push(o.name.toUpperCase()),n.push(o));const s=yield(0,u.createField)(S.routeIdName,S.routeIdAlias,"string",!0);i.push(s.name.toUpperCase()),n.push(s);const l=yield(0,u.createField)(S.fromDateName,S.fromDateAlias,"date",!0);i.push(l.name.toUpperCase()),n.push(l);const c=yield(0,u.createField)(S.toDateName,S.toDateAlias,"date",!0);i.push(c.name.toUpperCase()),n.push(c);const d=yield(0,u.createField)(S.fromMeasureName,S.fromMeasureAlias,"double",!0);i.push(d.name.toUpperCase()),n.push(d);const f=yield(0,u.createField)(S.toMeasureName,S.toMeasureAlias,"double",!0);i.push(f.name.toUpperCase()),n.push(f);const p=yield(0,u.createField)(S.typeName,S.typeAlias,"string",!0);return i.push(p.name.toUpperCase()),n.push(p),a.forEach((e=>L(this,void 0,void 0,(function*(){const a=t.find((t=>t.serviceId.toString()===e.layerId));yield(0,u.getLayer)(a.useDataSource).then((t=>L(this,void 0,void 0,(function*(){e.fields.forEach((e=>{const r=(0,u.findFieldByName)(t.fields,e);if((0,u.isDefined)(r)){const t=(0,u.resolveFieldName)(i,r.name);r.name=t,r.alias=a.eventInfo.datasetName+"."+e,r.nullable=!0,r.defaultValue=null,"oid"===r.type&&(r.type="integer",r.editable=!0),i.push(t.toUpperCase()),n.push(r)}}))}))))})))),n})))).catch((()=>[]))}))}(e,t,a);return yield(0,u.createFeatureLayer)(i,"polyline","hide",n,"dynamic-segmentation")}))}function E(e,t){return L(this,void 0,void 0,(function*(){const a=[];return yield Promise.all(t.map((t=>L(this,void 0,void 0,(function*(){const n=e.find((e=>e.serviceId.toString()===t.layerId));(0,u.isDefined)(n)&&(yield(0,u.getLayer)(n.useDataSource).then((e=>L(this,void 0,void 0,(function*(){(0,u.isDefined)(e.subtypes)&&a.push({id:n.serviceId.toString(),subtypes:e.subtypes,subtypeField:e.subtypeField})})))))}))))),a}))}const R=(e,t,a)=>L(void 0,void 0,void 0,(function*(){const n=a.message,i=n.substring(n.indexOf("field: "),n.length),r=i.substring(0,i.indexOf(",")),o=r.substring(7,r.length);return t.attributes[o]=null,yield e.applyEdits({addFeatures:[t.clone()]}).then((e=>e.addFeatureResults.length>0?e.addFeatureResults[0].error:null)).catch((e=>(console.error("Failed to add feature",e),null)))}));var j=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function M(t,a,n){const i=[],r=e.DataSourceManager.getInstance(),o=t.networkInfo.lrsNetworkId;return n&&n.layers.forEach((e=>{var t;const n=a.find((t=>t.serviceId===e.layerId));if((0,u.isDefined)(n)){const a=null===(t=null==n?void 0:n.eventInfo)||void 0===t?void 0:t.parentNetworkId;if(o===a){const t={layerId:e.layerId.toString(),fields:[]};e.fields.forEach((e=>{t.fields.push(e.name)})),t.fields.push(n.eventInfo.eventIdFieldName);const a=r.getDataSource(n.useDataSource.dataSourceId);t.fields.push(a.getIdField()),i.push(t)}}})),i}function T(t,a,n,i){return j(this,void 0,void 0,(function*(){if(!a.routeId.length)return null;const r=a.networkInfo.networkUrl,o=`${r}/queryAttributeSet`,s=yield e.SessionManager.getInstance().getSessionByUrl(r).getToken(r),l=function(e){const t=[];if(e.routeId){const a={routeId:e.routeId};(0,u.isDefined)(e.fromMeasure)&&!isNaN(e.fromMeasure)&&(a.fromMeasure=e.fromMeasure),(0,u.isDefined)(e.toMeasure)&&!isNaN(e.toMeasure)&&(a.toMeasure=e.toMeasure),t.push(a)}return t}(a);let c=t.getGDBVersion();c||(c="");const d=[n.getTime(),n.getTime()],f={f:"json",token:s,locations:l,attributeSet:i,temporalViewDate:JSON.stringify(d),gdbVersion:c};return(0,u.requestService)({method:"POST",url:o,params:f}).then((e=>j(this,void 0,void 0,(function*(){return e||null}))))}))}var F=y(99037),C=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function A(a){const{allowMerge:n,lrsLayers:i,networkDS:o,networkInfo:s,onSave:l}=a,{pendingEdits:c,errorCount:d}=h(),f=e.hooks.useTranslation(t),p=b(),m=e.React.useMemo((()=>c.size>0&&0===d),[d,c]),g=(t,a,n)=>(0,u.getLayer)(t.useDataSource).then((i=>C(this,void 0,void 0,(function*(){const r={},o=t.eventInfo;if(a.attributes.forEach(((t,a)=>{switch(a){case S.routeIdName:r[o.routeIdFieldName]=t;break;case S.fromDateName:r[o.fromDateFieldName]=t;break;case S.toDateName:r[o.toDateFieldName]=t;break;case S.fromMeasureName:r[o.fromMeasureFieldName]=t;break;case S.toMeasureName:o.isPointEvent||(r[o.toMeasureFieldName]=t);break;case o.eventIdFieldName:(0,u.isDefined)(t)?r[a]=t:r[a]="{"+e.utils.getUUID()+"}";break;default:r[a]=t}})),o.fromReferentMethodFieldName){const e=i.fields.find((e=>e.name===o.fromReferentMethodFieldName));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.name===n));t&&(r[o.fromReferentMethodFieldName]=t.code)}}if(o.fromReferentLocationFieldName&&(r[o.fromReferentLocationFieldName]=r[o.routeIdFieldName]),o.fromReferentOffsetFieldName){const e=r[o.fromMeasureFieldName];r[o.fromReferentOffsetFieldName]=(0,u.isDefined)(e)?e.toString():null}if(o.toReferentMethodFieldName){const e=i.fields.find((e=>e.name===o.toReferentMethodFieldName));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.name===n));t&&(r[o.toReferentMethodFieldName]=t.code)}}if(o.toReferentLocationFieldName&&(r[o.toReferentLocationFieldName]=r[o.routeIdFieldName]),o.toReferentOffsetFieldName){const e=r[o.toMeasureFieldName];r[o.toReferentOffsetFieldName]=(0,u.isDefined)(e)?e.toString():null}return r}))));return(0,e.jsx)(r.Tooltip,{placement:"auto",title:f("saveEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:f("saveEdits"),icon:"save",scale:"m",disabled:!m||void 0,onClick:()=>C(this,void 0,void 0,(function*(){const e={edits:[]};let t=o.getGDBVersion();t||(t="");const a=[];c.forEach((e=>{a.push(e)}));let r="";Promise.all(a.map(((t,a)=>C(this,void 0,void 0,(function*(){const a=i.find((e=>e.serviceId.toString()===t.layerId));""===r&&(r=a.lrsUrl);const o=[],l={attributes:yield g(a,t,s.datasetName)};o.push(l);const c={id:a.serviceId,adds:o,allowMerge:n,retireMeasureOverlap:!0,retireByEventId:!1};e.edits.push(c)}))))).then((()=>C(this,void 0,void 0,(function*(){yield(0,u.LrsApplyEdits)(r,e,t).then((e=>C(this,void 0,void 0,(function*(){if(e.success){const e=c.size;p({type:"SET_EDITS",value:new Map});const t={title:f("saveSuccess"),body:f("saveSuccessMessage",{editCount:e}),type:"success"};l(t)}else{const t={title:f("saveError"),body:e.message,details:e.details,type:"danger"};l(t)}}))))}))))}))}))}var O=y(1888);function P(){const n=e.hooks.useTranslation(t),i=(0,O.getTheme)(),{display:o,records:s,pendingEdits:l}=h(),c=b(),d=e=>{if((0,u.isDefined)(l)&&l.size>0){if(o===a.Diagram&&e===a.Table)return!0;if(o===a.Table&&e===a.Diagram)return!0}return!1};return(0,e.jsx)(F.CalciteActionGroup,{scale:"m"},(0,e.jsx)(r.Tooltip,{placement:"auto",title:d(a.Table)?n("tableLabelDisabled"):n("tableLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:n("tableLabel"),icon:"table",scale:"m",indicator:o===a.Table||void 0,disabled:!!d(a.Table)||void 0,css:e.css`--calcite-action-indicator-color: ${i.sys.color.primary.main};`,onClick:()=>{o!==a.Table&&(c({type:"SET_DISPLAY",value:a.Table}),s.length>0&&c({type:"SET_IS_LOADING",value:!0}))}})),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d(a.Diagram)?n("diagramLabelDisabled"):n("diagramLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:n("diagramLabel"),icon:"graph-bar",scale:"m",indicator:o===a.Diagram||void 0,disabled:!!d(a.Diagram)||void 0,css:e.css`--calcite-action-indicator-color: ${i.sys.color.primary.main};`,onClick:()=>{o!==a.Diagram&&(c({type:"SET_DISPLAY",value:a.Diagram}),s.length>0&&c({type:"SET_IS_LOADING",value:!0}))}})))}var _=y(22089),V=y(68972),$=y(77958);function B(a){const n=e.hooks.useTranslation(t),{records:i,selectedRecordIds:o,display:s}=h(),{jimuMapView:c,networkDS:u}=a,[d,f]=V.default.useState(!1);V.default.useEffect((()=>{0===o.length?f(!1):f(!0)}),[o,s]);return(0,e.jsx)(r.Tooltip,{placement:"auto",title:n("ZoomLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:n("ZoomLabel"),icon:"zoom-to-object",scale:"m",onClick:()=>{const e=[],t=u.layerDefinition.objectIdField;o&&o.length>0&&i.forEach((a=>{const n=null==a?void 0:a.attributes[t];o.includes(n)&&e.push(a.geometry)}));const a=$.default.union(e);l.geometryUtils.projectToSpatialReference([a],c.view.spatialReference).then((e=>{var t;const a=new _.default({geometry:e[0]});if("point"===(null===(t=null==a?void 0:a.geometry)||void 0===t?void 0:t.type))null==c||c.view.goTo({target:e,zoom:100});else{const e=a.geometry.extent.expand(1.25);null==c||c.view.goTo({center:e})}}))},disabled:!d||void 0}))}var G=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};const H=["long","big-integer","integer","single","double","small-integer"],z=["global-id","guid","string"];function W(a){const{dynSegFeatureLayer:n,widgetId:i,routeId:o,jimuMapView:s}=a,l=e.hooks.useTranslation(t),{records:c,display:d}=h(),[f,p]=e.React.useState(!1);e.React.useEffect((()=>{0===(null==c?void 0:c.length)?p(!1):p(!0)}),[c,d]);const m=t=>{let a;return H.includes(t.type)?a=e.JimuFieldType.Number:"date"===t.type?a=e.JimuFieldType.Date:z.includes(t.type)&&(a=e.JimuFieldType.String),a?{jimuName:t.name,name:t.name,type:a,esriType:t.type,alias:t.alias,format:"oid"===t.type?{digitSeparator:!1,places:0}:null}:null},g=e=>{if(!e)return null;const t={};return e.forEach((e=>{const a=m(e);a&&a.name&&(t[e.name]=a)})),t},y=()=>{const e=g(n.fields);return Object.keys(e)},v=()=>{const e=(e=>{if(!e)return null;const t={};return e.forEach((e=>{const a=m(e);a&&a.name&&(t[e.alias]=a)})),t})(n.fields);return Object.keys(e)};return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.Dropdown,{className:"float-right",direction:"down",size:"sm",useKeyUpEvent:!0},(0,e.jsx)(r.DropdownButton,{icon:!0,arrow:!1,size:"sm",type:"link"},(0,e.jsx)(r.Tooltip,{placement:"auto",title:l("exportLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:l("exportLabel"),icon:"export",scale:"m",disabled:!f||void 0}))),(0,e.jsx)(r.DropdownMenu,null,(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadCsv_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(n.fields,"oid"),fields:Object.assign({},g(n.fields))},geometryType:"esriGeometryPolyline"})).then((t=>{const a=[];c.forEach((e=>{const n=t.buildRecord(e);a.push(n)}));const n={records:a,dataSource:t,name:l("dynamicSeg"),fields:y()};e.DataActionManager.getInstance().getSupportedActions(i,[n],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const a=t.export;if((null==a?void 0:a.length)>0){const t=a.filter((e=>"export-csv"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[n],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}},l("exportCsv")),(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadJson_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(n.fields,"oid"),fields:Object.assign({},g(n.fields))},geometryType:"esriGeometryPolyline"})).then((t=>{const a=[],r=(()=>{const e=n.fields,t={};return e.forEach((e=>{t[e.name]=e.alias})),t})();c.forEach((e=>{const n=e.clone(),i=n.attributes;Object.keys(i).forEach((e=>{const t=r[e];i[t]=i[e],delete i.key}));const o=t.buildRecord(n);a.push(o)}));const o={records:a,dataSource:t,name:l("dynamicSeg"),fields:v()};e.DataActionManager.getInstance().getSupportedActions(i,[o],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const a=t.export;if((null==a?void 0:a.length)>0){const t=a.filter((e=>"export-json"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[o],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}},l("exportJson")),(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadGeoJson_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(n.fields,"oid"),fields:Object.assign({},g(n.fields))},geometryType:"esriGeometryPolyline"})).then((t=>G(this,void 0,void 0,(function*(){const a=[],n=c,r=s.view.spatialReference,o=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/projection");o.load().then((()=>{n.forEach((e=>{"Point"===e.attributes[S.typeName]&&(e.geometry=null)})),n.forEach((e=>{e.geometry&&(e.geometry=o.project(e.geometry,r))})),n.forEach((e=>{const n=t.buildRecord(e);a.push(n)}));const s={records:a,dataSource:t,name:l("dynamicSeg"),fields:y()};e.DataActionManager.getInstance().getSupportedActions(i,[s],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const a=t.export;if((null==a?void 0:a.length)>0){const t=a.filter((e=>"export-geojson"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[s],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}))))}},l("exportGeoJson")))))}function U(a){const n=e.hooks.useTranslation(t),{fieldInfo:i,display:o}=h(),{handleFieldCalculator:s}=a,[l,c]=e.React.useState(!0);e.React.useEffect((()=>{i&&0!==i.length?c(void 0):c(!0)}),[i,o]);return(0,e.jsx)(r.Tooltip,{placement:"auto",title:n("fieldCalculatorLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{disabled:l,text:n("fieldCalculatorLabel"),icon:"calculator",scale:"m",id:"field-calculator",onClick:()=>{const e={id:"field-calculator",heading:n("fieldCalculatorLabel")};s(e)}}))}function q(a){const n=e.hooks.useTranslation(t),{dynSegFeatureLayer:i}=a,{pendingEdits:o,originalRecords:s}=h(),l=b();return(0,e.jsx)(r.Tooltip,{placement:"auto",title:n("discardEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:n("discardEdits"),icon:"read-only-non-editable",scale:"m",onClick:()=>{if(o){l({type:"SET_RECORDS",value:s}),l({type:"SET_EDITS",value:new Map}),l({type:"SET_ERROR_COUNT",value:0});const e={updateFeatures:s};i.applyEdits(e)}},disabled:!(o.size>0)||void 0}))}var J=y(49419),Y=y.n(J),Q=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a};const X=t=>{const a=window.SVG,{className:n}=t,i=Q(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:r,src:Y()},i)):e.React.createElement("svg",Object.assign({className:r},i))};function K(){const a=e.hooks.useTranslation(t),{fieldInfo:n,display:i}=h(),o=b(),[s,l]=e.React.useState(),[c,u]=e.React.useState([]),[d,f]=e.React.useState([]),[p,m]=e.React.useState(!0);e.React.useEffect((()=>{const e=g();l(e),u(e),f(n),n&&0!==n.length?m(!1):m(!0)}),[n,i]);const g=()=>{const e=[];return n&&0!==n.length?(n.forEach((t=>{if(t.isEventIdField||t.isOidField||t.exclude);else{const a={label:t.featureFieldAlias,value:t.featureFieldAlias};e.push(a)}})),e):[]},y=e=>{d.forEach((e=>{e.visible=!0})),f(d);const t=e,a=c.filter((e=>!t.some((t=>t.value===e.value)))),n=d;a.forEach((e=>{const t=e.value;n.find((e=>e.featureFieldAlias===t)).visible=!1})),o({type:"SET_FIELD_INFO",value:n})},v=e.css`
    .advance-select-lrs, 
    .advance-select-lrs .jimu-dropdown,
    .advance-select-lrs .jimu-dropdown button {
      padding: 0;
      margin: 0;
      border: none;
    }
    
    .advance-select-lrs, 
    .advance-select-lrs .jimu-dropdown {
      padding: 0;
      margin: 0;
      border: none;
      height: 100%;
    }
    
    .advance-select-lrs .jimu-dropdown button  {
      padding-inline: 1rem;
    }

    .advance-select-lrs .jimu-dropdown button: disabled{
      background-color: transparent;
      color: #6a6a6a;
      opacity: 0.5;
    }

  `,x={icon:!0,arrow:!1,disabled:p};return(0,e.jsx)("span",{css:v},(0,e.jsx)(r.AdvancedSelect,{className:"advance-select-lrs",size:"sm",title:a("showFields"),fluid:!0,sortValuesByLabel:!1,selectedValues:s,isMultiple:!0,buttonProps:x,strategy:"absolute",customDropdownButtonContent:()=>(0,e.jsx)(X,null),onChange:e=>{e&&0!==e.length?(l(e),y(e)):(d.forEach((e=>{e.visible=!1})),f(d),o({type:"SET_FIELD_INFO",value:d}),l([]))},staticValues:g()}))}var Z=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function ee(t){const{intl:n,routeId:i,allowMerge:r,widgetId:o,jimuMapView:s,highlightLayer:l,highlightColor:c,lrsLayers:d,networkDS:f,networkInfo:p,dynSegFeatureLayer:m,onSave:g,handleFieldCalculator:y,attributeSet:v}=t,{records:b,selectedRecordIds:x,selectedSldId:w,display:I}=h();return e.React.useEffect((()=>{!function(e){Z(this,void 0,void 0,(function*(){(0,u.isDefined)(l)&&(l.removeAll(),(0,u.isDefined)(b)&&(0,u.isDefined)(e)&&e.forEach((e=>Z(this,void 0,void 0,(function*(){const t=b.find((t=>t.getObjectId()===e));if((0,u.isDefined)(t)){const e="Point"===t.attributes[S.typeName],a=yield(0,u.getGeometryGraphic)(t,c,4,!e);l.add(a)}})))))}))}(x)}),[x]),e.React.useEffect((()=>{""===w&&(0,u.isDefined)(l)&&l.removeAll()}),[w]),(0,e.jsx)(F.CalciteActionBar,{slot:"header-actions-end",layout:"horizontal",scale:"m",className:"header-actions",expandDisabled:!0},(0,e.jsx)(P,null),(0,e.jsx)(F.CalciteActionGroup,{scale:"m"},(0,e.jsx)(A,{lrsLayers:d,networkDS:f,networkInfo:p,onSave:g,allowMerge:r}),I===a.Table&&(0,e.jsx)(q,{dynSegFeatureLayer:m}),I===a.Table&&(0,e.jsx)(B,{jimuMapView:s,networkDS:f}),I===a.Table&&(0,e.jsx)(K,null),I===a.Table&&(0,e.jsx)(U,{intl:n,attributeSet:v,lrsLayers:d,dynSegFeatureLayer:m,handleFieldCalculator:y}),I===a.Table&&(0,e.jsx)(W,{dynSegFeatureLayer:m,widgetId:o,routeId:i,jimuMapView:s})))}function te(t){const{open:a,messageProp:n,onClose:i}=t;e.React.useEffect((()=>{let e=null==n?void 0:n.time;e||(e=5e3),a&&setTimeout((()=>{i()}),e)}),[a,i,null==n?void 0:n.time]);return(0,e.jsx)("div",{className:"toast-container h-100 w-100 d-flex"},(0,e.jsx)("div",{className:"toast m-auto"},(0,e.jsx)(F.CalciteNotice,{className:"toast-notice",kind:n.type,closable:!0,icon:(e=>{switch(e){case"brand":default:return"information";case"success":return"checkCircle";case"error":case"danger":case"warning":return"exclamationMarkTriangle"}})(n.type),open:!0,scale:"m",onCalciteNoticeClose:()=>{i()}},(0,e.jsx)("div",{slot:"title"},n.title),(0,e.jsx)("div",{slot:"message"},(0,e.jsx)("span",null,n.body),n.details&&(0,e.jsx)("div",null,(0,e.jsx)("span",null,n.details))))))}function ae(a){const{fieldInfo:n}=a,i=e.hooks.useTranslation(t);return(0,e.jsx)(F.CalciteTableRow,{slot:"table-header",className:"dyn-seg-table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:i("measureRange"),className:"dyn-seg-column-header"}),n.map(((t,a)=>t.visible&&!t.exclude?(0,e.jsx)(F.CalciteTableHeader,{key:a,heading:t.originalFieldAlias,description:t.eventAlias,className:"dyn-seg-column-header"}):null)))}var ne=y(28996),ie=y.n(ne),re=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function oe(t,a,n){if(!(0,u.isDefined)(t))return[];const r=e.DataSourceManager.getInstance(),o=new Set,s=new Map;a.forEach((e=>{if(e.eventInfo){o.add(e.eventInfo.eventIdFieldName);const t=r.getDataSource(e.useDataSource.dataSourceId);s.set(e.eventInfo.datasetName,t.getIdField())}}));const l=[],c=t.fields;let d=0;return c.forEach((e=>{var t,r,c,f,p,m,g,h,y;if(e.alias.includes(".")){if(e.alias.includes(".")){const v=e.alias.split(".")[0],b=e.alias.split(".")[1],x=a.find((e=>(0,u.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===v)),S=null===(r=null===(t=x.eventInfo)||void 0===t?void 0:t.attributeFields)||void 0===r?void 0:r.find((e=>e.field.name===b)),w=null===(f=null===(c=x.eventInfo)||void 0===c?void 0:c.lrsFields)||void 0===f?void 0:f.find((e=>e.name===b)),I=o.has(b),D=s.get(null===(p=null==x?void 0:x.eventInfo)||void 0===p?void 0:p.datasetName)===b,N={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:v,eventAlias:null===(m=x.eventInfo)||void 0===m?void 0:m.datasetName,originalFieldName:b,originalFieldAlias:(0,u.isDefined)(S)?null===(g=null==S?void 0:S.field)||void 0===g?void 0:g.alias:null==w?void 0:w.alias,eventLayerId:x.serviceId.toString(),visible:!0,exclude:I||D,editable:!I&&!D,EventType:(null===(h=x.eventInfo)||void 0===h?void 0:h.isPointEvent)?i.Point:i.Line,isSubtypeField:se(x.serviceId.toString(),e.name,n),isEventIdField:(null===(y=x.eventInfo)||void 0===y?void 0:y.eventIdFieldName)===b,isOidField:D,displayField:x.displayField};l.push(N)}}else if(e.alias===S.typeAlias){const t={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!0,exclude:!1,editable:!1,EventType:i.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:e.alias,eventAlias:""};l.push(t)}else{const t={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!1,exclude:!0,editable:!1,EventType:i.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:"",eventAlias:""};l.push(t)}d++})),l}function se(e,t,a){if(!(0,u.isDefined)(a))return!1;const n=a.find((t=>t.id===e));return!!(0,u.isDefined)(n)&&n.subtypeField.toUpperCase()===t.toUpperCase()}function le(e,t,a,n){const i=new Map;return e.forEach((e=>{e.eventName===a&&(e.isOidField?n&&i.set(e.featureFieldName,t.attributes[e.featureFieldName]):i.set(e.originalFieldName,t.attributes[e.featureFieldName]))})),i.set(S.routeIdName,t.attributes[S.routeIdName]),i.set(S.fromDateName,t.attributes[S.fromDateName]),i.set(S.toDateName,t.attributes[S.toDateName]),i.set(S.fromMeasureName,t.attributes[S.fromMeasureName]),i.set(S.toMeasureName,t.attributes[S.toMeasureName]),i}function ce(e,t,a,n){const i=new Map;if(t.isSubtypeField){const r=n.find((e=>e.id===t.eventLayerId));if((0,u.isDefined)(r)&&(0,u.isDefined)(r.subtypes)){const t=r.subtypes.find((t=>t.code===e)).defaultValues;if((0,u.isDefined)(t))return Object.keys(t).forEach((e=>{if(e in a.attributes){a.attributes[e]!==t[e]&&i.set(e,t[e])}})),i}}return i}function ue(e,t){return`${e.attributes[S.objectId]}.${t}`}var de=y(46942),fe=y.n(de),pe=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function me(a){const{intl:n,featureLayer:o,record:s,fieldInfo:l,subTypeInfo:c,layerMap:d,fieldGroups:f,contingentValues:p,updateRecord:m}=a,[g,y]=e.React.useState(s.attributes[l.featureFieldName]),[v,x]=e.React.useState(s.attributes[l.featureFieldName]),[w,I]=e.React.useState(s.attributes[l.featureFieldName]),[D,N]=e.React.useState(!1),[L,k]=e.React.useState(""),[E,R]=e.React.useState(!1),[j,M]=e.React.useState(!1),T=e.React.useRef(null),[C,A]=e.React.useState([]),[O,P]=e.React.useState([]),{errorCount:_,pendingEdits:V}=h(),$=b();e.React.useEffect((()=>{0===_&&re("")}),[_]);const B=e.React.useMemo((()=>{const e=o.fields.find((e=>e.name===l.featureFieldName));return e||null}),[o,l]),G=e.React.useMemo((()=>o.fields.filter((e=>e.alias.includes(".")&&e.alias.split(".")[0]===l.eventName))),[o,l]),H=e.React.useMemo((()=>{const e=c.find((e=>e.id===l.eventLayerId));return(0,u.isDefined)(e)?s.attributes[e.subtypeField]:NaN}),[c,l,s]),z=e.React.useMemo((()=>{const e=d.get(l.eventLayerId),t=f.get(l.eventLayerId),a=p.get(l.eventLayerId);return(0,u.setContingentValues)(a,t,e,H)}),[d,f,p,l,H]),W=e.React.useMemo((()=>{if((0,u.isDefined)(B)&&(0,u.isDefined)(B.domain)&&"coded-value"===B.domain.type){const e=B.domain.codedValues.some((e=>null===e.code&&"null"===e.name));return B.nullable&&!e&&B.domain.codedValues.unshift({code:null,name:"null"}),B.domain}return null}),[B]),U=e.React.useMemo((()=>{const e=c.find((e=>e.id===l.eventLayerId));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]}),[c]),q=e.React.useMemo((()=>l.isSubtypeField?"subtype":(0,u.isDefined)(B.domain)&&(0,u.isCodedDomain)(B.domain.type)?"domain":(0,u.isDefined)(B.domain)&&(0,u.isRangeDomain)(B.domain.type)?"range":(0,u.isDate)(B.type)?"date":(0,u.isNumber)(B.type)?"number":"text"),[l,B]),J=e.React.useMemo((()=>{if(B.editable&&l.editable&&(0,u.isDefined)(s)){const e=s.attributes[S.typeName];return("Point"!==e||l.EventType!==i.Line)&&("Line"!==e||l.EventType!==i.Point)}}),[B,l]),Y=e.React.useMemo((()=>L.length>0),[L]),Q=e.React.useMemo((()=>!(!(0,u.isDefined)(w)&&""===g)&&(g!==w&&0===L.length)),[w,g,L]);e.React.useEffect((()=>{(0,u.isDefined)(s)&&(0,u.isDefined)(l)&&I(s.attributes[l.featureFieldName])}),[]),e.React.useEffect((()=>{const e=new IntersectionObserver((([e])=>{R(e.isIntersecting)}),{root:null,rootMargin:"0px",threshold:0});return T.current&&e.observe(T.current),()=>{T.current&&e.unobserve(T.current)}})),e.React.useEffect((()=>{function e(e){T.current&&!T.current.contains(e.target)&&M(!1)}if(j)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[j,T]),e.React.useEffect((()=>{(0,u.isDefined)(s)&&(0,u.isDefined)(l)&&y(s.attributes[l.featureFieldName])}),[s,l]),e.React.useEffect((()=>{const e=(0,u.getContingentOptions)(l.originalFieldName,z),t=function(e,t,a,n){const i=[];if(!(0,u.fieldsWithContingentValues)(e).has(n))return[];if(!e||0===e.length)return[];const r=[];if((null==e?void 0:e.length)>0)for(const o of e){const e=null==o?void 0:o.contingencies,s=null==o?void 0:o.fields;if(e&&(null==s?void 0:s.includes(n)))for(const o of e){let e=null,s=!1;const l=Object.keys(o.values);null==l||l.forEach((i=>{const r=o.values[i];if(i===n)"code"===r.objectType&&(e=r.codedValue.code);else if("code"===r.objectType){const e=r.codedValue.code;t.some((t=>{if(t.alias.split(".")[1]===i){const n=a.attributes[t.name];return(n===e||null===n)&&(s=!0),!0}return!1}))}})),null!==e&&(s?i.push(e):r.push(e))}}return i}(z,G,s,l.originalFieldName);A(e),P(t)}),[G,z,l,s]),e.React.useEffect((()=>{if(z.length>0){const e=ue(s,l.eventName),a=V.get(e);if((0,u.isDefined)(a)){const e=(0,u.validateContingencyConstraints)(-1,"",-1,null,z,s,G);if(e.length>0){const a=[];for(let t=0;t<(null==e?void 0:e.length);t++){const n=e[t];a.push(null==n?void 0:n.fieldGroup)}null==a||a.forEach((e=>{const a=null==e?void 0:e.fields;(null==a?void 0:a.find((e=>e===(null==l?void 0:l.originalFieldName))))&&(re((0,u.formatMessage)(n,"contingentValueError",t)),N(!0))}))}else D&&(re(""),N(!1))}}}),[V,s]);const X=(e,t)=>(0,u.isDefined)(t)?`${t} - ${e}`:e,K=()=>{if((0,u.isDefined)(g)){const e=U.find((e=>"string"==typeof e.value&&"string"==typeof g?e.value.toLowerCase()===g.toLowerCase():e.value===g));return(0,u.isDefined)(e)?X(e.label):""}return""},Z=()=>{if((0,u.isDefined)(g)){const e=W.codedValues.find((e=>"string"==typeof e.code&&"string"==typeof g?e.code.toLowerCase()===g.toLowerCase():e.code===g));return(0,u.isDefined)(e)?X(e.name):""}return""},ee=()=>B.name===S.typeName?"75px":"125px",te=j&&(0,u.isDefined)(B.domain)&&"domain"===q,ae=e=>{e.target.value!==g&&(y(e.target.value),se(e.target.value,""))},ne=(e,t)=>pe(this,void 0,void 0,(function*(){const t=s.clone(),a=ce(e,l,t,c);a.size>0?a.forEach(((e,a)=>{t.attributes[a]=e})):t.attributes[l.featureFieldName]=e;const n={updateFeatures:[t]};yield o.applyEdits(n).then((e=>{e.updateFeatureResults.length>0&&(e.updateFeatureResults[0].error?re(e.updateFeatureResults[0].error.message):m(t,l))})).catch((e=>{re(e.message)}))})),re=e=>{const t=L.length>0;let a=_;t&&0===e.length&&a--,!t&&e.length>0&&a++,$({type:"SET_ERROR_COUNT",value:a}),k(e)},oe=e=>{y(e)},se=(e,t)=>{ne(e),x(e),M(!1)};return(0,e.jsx)(F.CalciteTableCell,{className:fe()("dyn-seg-cell",Q?"edited":"",J?"":"non-editable",Y?"error":"")},(0,e.jsx)("div",{ref:T,style:{minWidth:ee(),maxWidth:"224px"}},E&&(0,e.jsx)("div",{className:"dyn-seg-cell-content h-100 d-flex",tabIndex:-1},!j&&(0,e.jsx)("div",{onDoubleClick:()=>{J&&M(!0)},className:"d-flex"},(0,e.jsx)(r.Label,{size:"sm",className:"text-truncate w-100",style:{textOverflow:"ellipse",minWidth:ee(),maxWidth:"200px",textWrap:"nowrap",marginBottom:0,alignItems:"center",textAlign:"left"}},(()=>{switch(q){case"subtype":return K();case"domain":return Z();case"date":return(0,u.isDefined)(g)?new Date(g).toLocaleDateString():"";case"range":case"number":case"text":return(0,u.isDefined)(g)?g.toString():"";default:return""}})()),L.length>0&&(0,e.jsx)(r.Icon,{icon:ie(),size:16,title:L,color:"red",style:{alignSelf:"center",marginLeft:"4px",marginRight:"4px"}})),j&&"text"===q&&(0,e.jsx)(r.TextInput,{size:"sm",style:{minWidth:ee()},className:"w-100",autoFocus:!0,required:!B.nullable,value:g,type:"text",onChange:e=>{oe(e.currentTarget.value)},checkValidityOnAccept:e=>pe(this,void 0,void 0,(function*(){let a=e;if("number"===q&&(a=parseFloat(e)),w===a||v===g)return L.length>0&&re(""),{valid:!0};const i=L.length>0,r=(0,u.validateField)(e,l.featureFieldName,void 0,B);return r.hasError?i?{valid:!1,msg:r.message}:(re((0,u.formatMessage)(n,r.message,t)),se(a,(0,u.formatMessage)(n,r.message,t)),{valid:!1,msg:(0,u.formatMessage)(n,r.message,t)}):(re(""),se(a,""),{valid:!0})}))}),j&&"number"===q&&(0,e.jsx)(r.NumericInput,{size:"sm",style:{minWidth:ee()},className:"w-100",autoFocus:!0,showHandlers:!1,required:!B.nullable,value:g,onAcceptValue:e=>{e!==g&&(y(e),se(e,""))}}),j&&"date"===q&&(0,e.jsx)(F.CalciteInputDatePicker,{scale:"s",style:{minWidth:ee()},valueAsDate:(0,u.isDefined)(g)?new Date(g):null,onCalciteInputDatePickerChange:e=>{var a;const i=null===(a=e.target)||void 0===a?void 0:a.valueAsDate,r=i.valueOf();if(w===r)return L.length>0&&re(""),{valid:!0};const o=L.length>0,s=(0,u.validateField)(i,l.featureFieldName,void 0,B);return s.hasError?o?{valid:!1,msg:s.message}:(re((0,u.formatMessage)(n,s.message,t)),se(r,(0,u.formatMessage)(n,s.message,t)),{valid:!1,msg:(0,u.formatMessage)(n,s.message,t)}):(re(""),se(r,""),{valid:!0})},placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0}),j&&"domain"===q&&(0,e.jsx)(r.Select,{size:"sm",className:"w-100",style:{minWidth:ee()},value:g,onChange:e=>{ae(e)}},(()=>{var t;if(te)return(null==C?void 0:C.length)>0?C.map(((t,a)=>{var n;const i=(n=t.code,!(!O||!O.includes(n)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,e.jsx)("option",{key:a,value:t.code,style:i},X(t.name,t.code))})):null===(t=null==W?void 0:W.codedValues)||void 0===t?void 0:t.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.code},X(t.name,t.code))))})()),j&&"subtype"===q&&(0,e.jsx)(r.Select,{size:"sm",style:{minWidth:ee()},className:"w-100",value:g,onChange:e=>{ae(e)}},U.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.value},X(t.label,t.value))))),j&&"range"===q&&(0,e.jsx)(r.TextInput,{size:"sm",className:"w-100",style:{minWidth:ee()},autoFocus:!0,required:!B.nullable,value:g,onChange:e=>{oe(e.currentTarget.value)},checkValidityOnAccept:e=>{if(w===e||v===g)return L.length>0&&re(""),{valid:!0};const a=L.length>0,i=(0,u.validateRangeDomain)(e,l.featureFieldName,void 0,B);return i.hasError?a?{valid:!1,msg:i.message}:(re((0,u.formatMessage)(n,i.message,t)),se(e,(0,u.formatMessage)(n,i.message,t)),{valid:!1,msg:(0,u.formatMessage)(n,i.message,t)}):(re(""),se(e,""),{valid:!0})}}))))}var ge=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function he(e,t,a){return ge(this,void 0,void 0,(function*(){const n=yield(0,u.QueryLock)(t,e,!1);let i;if((0,u.shouldTryAcquireLock)(t,n)){if(i=yield(0,u.acquireLock)(t,n),i.acquireStatus===u.LockAcquireStatus.EsriReconcileRequired){if(!(yield(0,u.tryAutoReconcile)(t)))return ye(i,e,t,a);i=yield(0,u.acquireLock)(t,n)}else if(i.acquireStatus!==u.LockAcquireStatus.EsriSuccess)return ye(i,e,t,a)}else if(n.status!==u.LockAcquireStatus.EsriSuccess)return ye(i,e,t,a)}))}function ye(e,t,a,n){var i;let r="",o="info",s="";const l=null===(i=null==t?void 0:t.details[0])||void 0===i?void 0:i.lrsNetworkName,c=(0,u.getGDBVersion)(a);switch(e.acquireStatus){case u.LockAcquireStatus.EsriSuccess:s=""!==(f=t.routeInfo).lineId&&""===f.lineName?f.lineId:""!==f.lineId&&""!==f.lineName?f.lineName:""!==f.routeName?f.routeName:f.routeId,r=""!==t.routeInfo.lineId?(0,u.formatMessage)(n,"YouAcquiredLockOnLine",{nameOrId:s,networkName:l,version:c}):(0,u.formatMessage)(n,"YouAcquiredLockOnRoute",{nameOrId:s,networkName:l,version:c}),o="info";break;case u.LockAcquireStatus.EsriReconcileRequired:r=(0,u.formatMessage)(n,"ReconcileRequired"),o="danger";break;case u.LockAcquireStatus.EsriCouldNotAcquireAllLocks:const a=e.unavailableLocks[0].versionName,i=e.unavailableLocks[0].user;d=e.unavailableLocks[0],s=(0,u.isDefined)(d.routeName)&&""!==d.routeName?d.routeName:(0,u.isDefined)(d.lineName)&&""!==d.lineName?d.lineName:(0,u.isDefined)(d.routeId)&&""!==d.routeId?d.routeId:(0,u.isDefined)(d.lineId)&&""!==d.lineId?d.lineId:void 0,r=""===a?""!==t.routeInfo.lineId?(0,u.formatMessage)(n,"UnavailableLockOnLineWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):(0,u.formatMessage)(n,"UnavailableLockOnRouteWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):""!==t.routeInfo.lineId?(0,u.formatMessage)(n,"UnavailableLockOnLine",{nameOrId:s,networkName:l,lockUser:i,version:a}):(0,u.formatMessage)(n,"UnavailableLockOnRoute",{nameOrId:s,networkName:l,lockUser:i,version:a}),o="danger";break;default:r="",o="info"}var d,f;return{toastMsg:r,toastMsgType:o,toastOpen:open}}function ve(e,t,a){return ge(this,void 0,void 0,(function*(){var n;const i=e.routeIdFieldSchema.name,r=e.lineIdFieldSchema.name;let o="";const s=[t];s.length>0&&(o=i+" IN ('"+s.join("','")+"')");const l={where:o,outFields:["*"]},c=yield a.query(l);if(0===(null===(n=null==c?void 0:c.records)||void 0===n?void 0:n.length))return null;return null==c?void 0:c.records[0].feature.attributes[r]}))}function be(e){const t=`TIMESTAMP '${xe(e).toISOString().slice(0,10)}'`;return`(((${S.fromDateName.toUpperCase()} <= ${t}) AND (${S.toDateName.toUpperCase()} IS NULL)) OR ((${S.fromDateName.toUpperCase()} IS NULL) AND (${S.toDateName.toUpperCase()} >= ${t})) OR ((${S.fromDateName.toUpperCase()} < ${t}) AND (${S.toDateName.toUpperCase()} > ${t})))`}function xe(e){if((0,u.isDefined)(e)){const t=e.getCurrentQueryParams().time;let a=new Date(Date.now());return t&&(a=new Date(t[0])),a}return null}var Se=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function we(t){const{networkDS:a,intl:n,conflictPreventionEnabled:i,routeId:o,lrsLayers:s,currentRouteInfo:l,networkInfo:c,rowIndex:d,handleLockToast:f,featureLayer:p,record:m,rangeHeader:g,fieldInfos:y,lastIndex:v,subTypeInfo:x,layerMap:S,fieldGroups:w,contingentValues:I}=t,[D,N]=e.React.useState(!1),[L,k]=e.React.useState(m),[E,R]=e.React.useState(),{pendingEdits:j,selectedRecordIds:M,fieldInfo:T}=h(),C=b();e.React.useEffect((()=>{if(j.size>0){let e=!1;if(y.forEach((t=>{const a=ue(m,t.eventName);j.get(a)&&(e=!0)})),e){const e=p.objectIdField+" = "+m.getObjectId();p.queryFeatures({where:e}).then((e=>{k(e.features[0])}))}}else k(m)}),[j]),e.React.useEffect((()=>{if(M.length>0){const e=M.find((e=>e===m.getObjectId()));(e&&!D||!e&&D)&&N((0,u.isDefined)(e))}}),[M]),e.React.useEffect((()=>{d===v&&C({type:"SET_IS_LOADING",value:!1})}),[]),e.React.useEffect((()=>{(null==c?void 0:c.supportsLines)&&ve(c,o,a).then((e=>{e&&R(e)})).catch((e=>{console.error(e)}))}),[c]);const A=(e,t)=>{const a=ue(t,e.eventName),n=j.get(a),i=le(y,t,e.eventName,!1),r=new Map(j);if((0,u.isDefined)(n))n.attributes=i,r.set(a,n);else{const t={layerId:e.eventLayerId,attributes:i};r.set(a,t)}C({type:"SET_EDITS",value:r})},O=()=>{const e=c.lrsNetworkId,t=[],a=[],n=[],i=l;T.forEach((i=>{const r=i.eventLayerId,l=s.find((e=>e.serviceId.toString()===r.toString()));if(l){l.eventInfo.parentNetworkId===e&&(n.push(r),c.supportsLines&&E?t.push(E):t.push(o),a.push(c.supportsLines))}}));return{networkId:[e],routeOrLineId:t,eventServiceLayerIds:n,isLine:a,status:u.LockAcquireStatus.EsriSuccess,details:[],routeInfo:i,lockAction:u.LockAction.Query}},P=(e,t)=>Se(this,void 0,void 0,(function*(){let r;if(i){const i=O(),o=a;if(r=yield he(i,o,n),r){const a={title:r.toastMsg,body:"",type:r.toastMsgType};f(a),A(t,e),k(e)}else{f({title:"Field updated successfully",body:"",type:"success"}),A(t,e),k(e)}}else A(t,e),k(e)}));return(0,e.jsx)(F.CalciteTableRow,{className:"dyn-seg-row",onClick:e=>{let t=[...M];if(e.shiftKey){const e=t[t.length-1],a=m.getObjectId();if(e<a){Array.from({length:a-e+1},((t,a)=>a+e)).forEach((e=>{const a=t.findIndex((e=>e===m.getObjectId()));-1===a&&t.push(e)}))}else if(e>a){Array.from({length:e-a+1},((e,t)=>t+a)).forEach((e=>{const a=t.findIndex((e=>e===m.getObjectId()));-1===a&&t.push(e)}))}}else if(e.ctrlKey){const e=t.findIndex((e=>e===m.getObjectId()));e>-1?t.splice(e,1):t.push(m.getObjectId())}else t=[m.getObjectId()];C({type:"SET_SELECTED_RECORD_IDS",value:t})}},(0,e.jsx)(F.CalciteTableCell,{className:fe()("dyn-seg-row-header",D?"selected":"")},(0,e.jsx)("div",{className:"h-100 d-flex"},(0,e.jsx)(r.Label,{size:"sm",className:"w-100",centric:!0,style:{minWidth:"100px",textWrap:"nowrap",marginBottom:0,textAlign:"left",whiteSpace:"pre"}},g))),y.map(((t,a)=>t.visible&&!t.exclude?(0,e.jsx)(me,{intl:n,key:a,rowIndex:a,fieldInfo:t,featureLayer:p,record:L,subTypeInfo:x,layerMap:S,fieldGroups:w,contingentValues:I,updateRecord:P}):null)))}function Ie(t){const{intl:a,conflictPreventionEnabled:n,networkDS:i,routeId:r,lrsLayers:o,currentRouteInfo:s,networkInfo:l,featureLayer:c,records:u,measureHeaders:d,fieldInfo:f,subTypeInfo:p,layerMap:m,fieldGroups:g,contingentValues:y,handleLockToast:v}=t,{isLoading:b}=h(),x=(0,O.useTheme)();return e.React.useEffect((()=>{if(!b){let e=!1,t=0;for(;!e;){let a=!1,n=!1,i=!1,r=!1,o=!1;setTimeout((()=>{const e=document.querySelector(".dyn-seg-table");if(e&&e.shadowRoot){const t=e.shadowRoot.querySelector(".table-container");t&&(t.style.height="100%",a=!0)}const t=document.querySelector(".dyn-seg-table-header");if(t&&t.shadowRoot){const e=t.shadowRoot.querySelector(".interaction-container");if(e){const t=e.firstChild;t&&t&&(t.style.position="sticky",t.style.top="0",t.style.zIndex="10",t.style.backgroundColor=x.sys.color.surface.background,n=!0)}}const s=document.querySelectorAll(".dyn-seg-column-header");s&&s.forEach((e=>{const t=e.shadowRoot.querySelector(".content-cell");t&&"1"===t.ariaColIndex&&(t.style.position="sticky",t.style.left="0",t.style.zIndex="10",t.style.backgroundColor=x.sys.color.surface.background,i=!0)}));const l=document.querySelectorAll(".dyn-seg-row-header");l&&l.forEach((e=>{const t=e.shadowRoot.querySelector(".interaction-container");if(t){const e=t.childNodes[0];e&&(e.style.position="sticky",e.style.left="0",e.style.zIndex="5")}r=!0}));const c=document.querySelectorAll(".dyn-seg-row"),u=c[c.length-1];if(u){const e=u.shadowRoot.querySelector(".interaction-container");if(e){const t=e.lastChild;t&&(t.className="",t.style.borderBlockEnd=`1px solid ${x.sys.color.surface.background};`)}o=!0}}),1e3),t++,t>10&&(e=!0),a&&n&&i&&r&&o&&(e=!0)}}}),[b]),(0,e.jsx)(F.CalciteTable,{caption:"Dynamic Segmentation Table",className:"dyn-seg-table",bordered:!0,scale:"s",layout:"auto",style:{height:"100%",width:"100%"}},(0,e.jsx)(ae,{fieldInfo:f}),u.map(((t,h)=>(0,e.jsx)(we,{intl:a,conflictPreventionEnabled:n,key:h,rowIndex:h,featureLayer:c,record:t,rangeHeader:d[h],fieldInfos:f,lastIndex:u.length-1,subTypeInfo:p,layerMap:m,fieldGroups:g,contingentValues:y,networkInfo:l,currentRouteInfo:s,lrsLayers:o,routeId:r,networkDS:i,handleLockToast:v}))))}const De="object"==typeof global&&global&&global.Object===Object&&global;var Ne="object"==typeof self&&self&&self.Object===Object&&self;const Le=De||Ne||Function("return this")();var ke=/\s/;const Ee=function(e){for(var t=e.length;t--&&ke.test(e.charAt(t)););return t};var Re=/^\s+/;const je=function(e){return e?e.slice(0,Ee(e)+1).replace(Re,""):e};const Me=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const Te=Le.Symbol;var Fe=Object.prototype,Ce=Fe.hasOwnProperty,Ae=Fe.toString,Oe=Te?Te.toStringTag:void 0;const Pe=function(e){var t=Ce.call(e,Oe),a=e[Oe];try{e[Oe]=void 0;var n=!0}catch(e){}var i=Ae.call(e);return n&&(t?e[Oe]=a:delete e[Oe]),i};var _e=Object.prototype.toString;const Ve=function(e){return _e.call(e)};var $e=Te?Te.toStringTag:void 0;const Be=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":$e&&$e in Object(e)?Pe(e):Ve(e)};const Ge=function(e){return null!=e&&"object"==typeof e};const He=function(e){return"symbol"==typeof e||Ge(e)&&"[object Symbol]"==Be(e)};var ze=/^[-+]0x[0-9a-f]+$/i,We=/^0b[01]+$/i,Ue=/^0o[0-7]+$/i,qe=parseInt;const Je=function(e){if("number"==typeof e)return e;if(He(e))return NaN;if(Me(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Me(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=je(e);var a=We.test(e);return a||Ue.test(e)?qe(e.slice(2),a?2:8):ze.test(e)?NaN:+e};var Ye=1/0;const Qe=function(e){return e?(e=Je(e))===Ye||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Xe=function(e){var t=Qe(e),a=t%1;return t==t?a?t-a:t:0};const Ke=function(e,t){for(var a=-1,n=null==e?0:e.length,i=Array(n);++a<n;)i[a]=t(e[a],a,e);return i};const Ze=Array.isArray;var et=Te?Te.prototype:void 0,tt=et?et.toString:void 0;const at=function e(t){if("string"==typeof t)return t;if(Ze(t))return Ke(t,e)+"";if(He(t))return tt?tt.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a};const nt=function(e){return null==e?"":at(e)};var it=Le.isFinite,rt=Math.min;const ot=function(e){var t=Math[e];return function(e,a){if(e=Je(e),(a=null==a?0:rt(Xe(a),292))&&it(e)){var n=(nt(e)+"e").split("e"),i=t(n[0]+"e"+(+n[1]+a));return+((n=(nt(i)+"e").split("e"))[0]+"e"+(+n[1]-a))}return t(e)}}("round");var st=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function lt(a){const{intl:n,conflictPreventionEnabled:i,routeId:r,networkDS:o,featureLayer:s,records:l,lrsLayers:c,attributeSet:d,networkInfo:f,currentRouteInfo:p,handleLockToast:m}=a,g=e.hooks.useTranslation(t),[y,v]=e.React.useState(!1),[x,S]=e.React.useState([]),[w,I]=e.React.useState([]),[D,N]=e.React.useState(new Map),[L,k]=e.React.useState(new Map),[R,j]=e.React.useState(new Map),{fieldInfo:M}=h(),T=b();e.React.useEffect((()=>{const e=e=>st(this,void 0,void 0,(function*(){T({type:"SET_SELECTED_RECORD_IDS",value:[]}),e.length>0?F():C()}));(0,u.isDefined)(l)?e(l):C()}),[l]);const F=()=>st(this,void 0,void 0,(function*(){const e=yield E(c,d),t=oe(s,c,e),a=yield function(e,t){return re(this,void 0,void 0,(function*(){const a=new Map;return yield Promise.all(t.map((t=>re(this,void 0,void 0,(function*(){const n=e.find((e=>e.serviceId.toString()===t.layerId));(0,u.isDefined)(n)&&(yield(0,u.getLayer)(n.useDataSource).then((e=>re(this,void 0,void 0,(function*(){a.set(n.serviceId.toString(),e)})))))}))))),a}))}(c,d),n=A(l,f),i=yield function(e,t,a){return re(this,void 0,void 0,(function*(){const n=new Map;return yield Promise.all(a.map((a=>re(this,void 0,void 0,(function*(){const i=t.find((e=>e.serviceId.toString()===a.layerId)),r=e.get(i.serviceId.toString());(0,u.isDefined)(i)&&(0,u.isDefined)(r)&&(yield(0,u.fetchEnterpriseFieldGroup)(r).then((e=>re(this,void 0,void 0,(function*(){if((null==e?void 0:e.length)>0){const t=e.map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>(0,u.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase())))})));n.set(i.serviceId.toString(),t)}})))))}))))),n}))}(a,c,d),r=yield function(e,t,a){return re(this,void 0,void 0,(function*(){const n=new Map;return yield Promise.all(a.map((a=>re(this,void 0,void 0,(function*(){const i=t.find((e=>e.serviceId.toString()===a.layerId)),r=e.get(i.serviceId.toString());(0,u.isDefined)(i)&&(0,u.isDefined)(r)&&(yield(0,u.fetchEnterpriseContingentValues)(r).then((e=>{n.set(i.serviceId.toString(),e)})))}))))),n}))}(a,c,d);S(n),I(e),N(a),k(i),j(r),v(!0),T({type:"SET_FIELD_INFO",value:t}),T({type:"SET_SELECTED_RECORD_IDS",value:[]})})),C=()=>{v(!1),S([]),I([]),N(new Map),k(new Map),j(new Map),T({type:"SET_SELECTED_RECORD_IDS",value:[]}),T({type:"SET_IS_LOADING",value:!1}),T({type:"SET_FIELD_INFO",value:[]})},A=(e,t)=>{if((0,u.isDefined)(e)&&e.length>0){const a=[];return e.forEach((e=>{const n=ot(e.attributes.from_measure,t.measurePrecision).toFixed(t.measurePrecision),i=ot(e.attributes.to_measure,t.measurePrecision).toFixed(t.measurePrecision);a.push(g("measuresRange",{fromM:n,toM:i}))})),a}return[]};return(0,e.jsx)("div",{className:"dyn-seg-table-container h-100 w-100 d-flex"},y&&(0,e.jsx)(Ie,{intl:n,conflictPreventionEnabled:i,featureLayer:s,records:l,measureHeaders:x,fieldInfo:M,subTypeInfo:w,layerMap:D,fieldGroups:L,contingentValues:R,networkInfo:f,networkDS:o,currentRouteInfo:p,lrsLayers:c,routeId:r,handleLockToast:m}))}var ct=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function ut(t,a,n,i,r,o){return ct(this,void 0,void 0,(function*(){const s=new Map;let l=0;a.forEach((e=>{if(""!==e.eventName){const t={index:l++,layerId:e.eventLayerId,layerName:e.eventName,eventType:e.EventType,records:[],visible:!0,isActive:!0};s.set(e.eventName,t)}}));let c=0;return t.forEach((e=>{s.forEach((t=>{if(function(e,t,a){let n=!1;const i=ft(e,t,a),r=t.attributes[S.typeName];i&&"Line"===r&&(n=!0);i||"Point"!==r||(n=!0);return n}(a,e,t.layerName,o.mTolerance))return;const s=n.find((e=>(0,u.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===t.layerName)),l=a.filter((e=>e.eventName===t.layerName)),d=e.attributes[S.fromMeasureName]<r.from?r.from:e.attributes[S.fromMeasureName],f=e.attributes[S.toMeasureName]>r.to?r.to:e.attributes[S.toMeasureName],p={index:c++,objectId:e.attributes[S.objectIdName],attributes:le(a,e,t.layerName,!0),fromMeasure:d,toMeasure:f,geometry:e.geometry,selected:!1,hasValue:pt(a,e,t.layerName),isPoint:ft(a,e,t.layerName),displayField:dt(s.displayField,t.layerId,i),fieldInfos:l};t.records.push(p)}))})),yield function(t){return ct(this,void 0,void 0,(function*(){const a=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/geometryEngine"),n=new Map(t);return n.forEach((e=>{const t=[];let n=null;e.records.sort(((e,t)=>e.fromMeasure-t.fromMeasure)),e.records.forEach((e=>{n?!function(e,t){if(e.isPoint)return!1;let a=!0;return e.attributes.forEach(((e,n)=>{if(n!==S.fromMeasureName&&n!==S.toMeasureName&&t.attributes.has(n)){const i=(0,u.isDefined)(e),r=(0,u.isDefined)(t.attributes.get(n));(!i&&r||i&&!r||e!==t.attributes.get(n))&&(a=!1)}})),a}(n,e)?(t.push(n),n=e):(n.attributes.set(S.toMeasureName,e.toMeasure),n.toMeasure=e.toMeasure,n.geometry=function(e,t,a){return!(0,u.isDefined)(t)&&(0,u.isDefined)(a)?a:(0,u.isDefined)(t)&&!(0,u.isDefined)(a)?t:(0,u.isDefined)(t)||(0,u.isDefined)(a)?e.union([t,a]):null}(a,n.geometry,e.geometry)):n=e})),n&&t.push(n),e.records=t})),n}))}(s)}))}function dt(e,t,a){const n=a.find((e=>e.layerId===t));if((0,u.isDefined)(n)){const t=n.fields.find((t=>t===e));return(0,u.isDefined)(t)?t:n.fields[0]}return""}function ft(e,t,a){let n=!1;return e.forEach((e=>{e.eventName===a&&e.EventType===i.Point&&(n=!0)})),n}function pt(e,t,a){let n=!1;return e.forEach((e=>{if(e.eventName===a&&e.isOidField){const a=t.attributes[e.featureFieldName];(0,u.isDefined)(a)&&""!==a&&!isNaN(a)&&(n=!0)}})),n}function mt(e,t,a){if(isNaN(e))return NaN;const n=t.to-t.from,i=a,r=(e-t.from)/n*i;return Math.floor(r)}function gt(e,t,a){for(let n=0;n<t;++n)if(0!==e.data[a*t*4+4*n+3])return!1;return!0}function ht(e,t,a,n,i){for(let r=n;r<i;++r)if(0!==e.data[r*t*4+4*a+3])return!1;return!0}function yt(e,t){const a=function(e,t){const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const n=a.getContext("2d");return(0,u.isDefined)(t)?n.drawImage(e,0,0,t,t):n.drawImage(e,0,0),a}(e,t),n=function(e,t){const a=e.getContext("2d"),n=(0,u.isDefined)(t)?t:e.width,i=(0,u.isDefined)(t)?t:e.height,r=a.getImageData(0,0,n,i);let o=0,s=r.height,l=0,c=r.width;for(;o<s&&gt(r,n,o);)++o;for(;s-1>o&&gt(r,n,s-1);)--s;for(;l<c&&ht(r,n,l,o,s);)++l;for(;c-1>l&&ht(r,n,c-1,o,s);)--c;const d=c-l==0?1:c-l,f=s-o==0?1:s-o,p=a.getImageData(l,o,d,f),m=e.ownerDocument.createElement("canvas"),g=m.getContext("2d");return m.width=p.width,m.height=p.height,g.putImageData(p,0,0),m}(a,t);return n.toDataURL("image/png")}function vt(e,t,a,n,i){if((0,u.isDefined)(e)){const i=function(e,t,a,n){if((0,u.isDefined)(e)&&(0,u.isDefined)(a)){if((0,u.isDefined)(t)){const e=a.find((e=>e.id===t.eventLayerId));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]}return n.subtypes.map((e=>({value:e.code,label:e.name})))||[]}return[]}(t,a,n),r=i.find((t=>"string"==typeof t.value&&"string"==typeof e?t.value.toLowerCase()===e.toLowerCase():t.value===e));return(0,u.isDefined)(r)?r.label:""}return""}function bt(e,t){if((0,u.isDefined)(e)){const n=(a=t,(0,u.isDefined)(a)&&(0,u.isDefined)(a.domain)&&"coded-value"===a.domain.type?a.domain:null).codedValues.find((t=>"string"==typeof t.code&&"string"==typeof e?t.code.toLowerCase()===e.toLowerCase():t.code===e));return(0,u.isDefined)(n)?n.name:""}var a;return""}function xt(e,t,a,n){const i=function(e,t){return e.find((e=>e.alias.split(".")[1]===t.displayField))}(e,a),r=It(t,a);if((0,u.isDefined)(i)&&(0,u.isDefined)(r)){return St(wt(i,r),i,r,a.attributes.get(a.displayField),n)}return""}function St(e,t,a,n,i,r){switch(e){case"subtype":return vt(n,t,a,i);case"domain":return bt(n,t);case"date":return(0,u.isDefined)(n)?new Date(n).toLocaleDateString():"";case"range":case"number":case"text":return(0,u.isDefined)(n)?n.toString():"";default:return""}}function wt(e,t,a){if((0,u.isDefined)(t)){if(t.isSubtypeField)return"subtype"}else if(a.subtypeField===e.name)return"subtype";return(0,u.isDefined)(e.domain)&&(0,u.isCodedDomain)(e.domain.type)?"domain":(0,u.isDefined)(e.domain)&&(0,u.isRangeDomain)(e.domain.type)?"range":(0,u.isDate)(e.type)?"date":(0,u.isNumber)(e.type)?"number":"text"}function It(e,t){return e.find((e=>e.originalFieldName===t.displayField))}function Dt(e,t){return e.find((e=>e.isEventIdField))}function Nt(t,a,n=!1){return(0,e.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{let i=null;[i]=e;const r=[...t.attributes.keys()],o={};return r.forEach((e=>{o[e]=t.attributes.get(e),!n||(0,u.isDefined)(o[e])&&"null"!==o[e]||(o[e]="<Null>")})),(0,u.isDefined)(a)?new i({geometry:t.geometry,attributes:o,layer:a}):new i({geometry:t.geometry,attributes:o})}))}function Lt(e,t,a,n){const i=new Map;return e.forEach((e=>{e.eventName===a&&(e.isOidField?n&&i.set(e.featureFieldName,t.attributes.get(e.featureFieldName)):i.set(e.originalFieldName,t.attributes.get(e.featureFieldName)))})),i.set(S.routeIdName,t.attributes.get(S.routeIdName)),i.set(S.fromDateName,t.attributes.get(S.fromDateName)),i.set(S.toDateName,t.attributes.get(S.toDateName)),i.set(S.fromMeasureName,t.attributes.get(S.fromMeasureName)),i.set(S.toMeasureName,t.attributes.get(S.toMeasureName)),i}function kt(t){const{trackKey:a,track:n,onTrackClicked:i}=t;return(0,e.jsx)("div",{className:(0,e.classNames)("sidebar-item",n.isActive?"active":"inactive"),onClick:()=>{n.isActive=!n.isActive,i(n,a)}},(0,e.jsx)(r.Label,{centric:!0,style:{marginBottom:"0"}},n.layerName))}function Et(t){const{trackMap:a,width:n,onTrackChanged:i}=t,r=(e,t)=>{const n=new Map(a);n.set(t,e),i(n)};return(0,e.jsx)("div",{className:"sidebar-body h-100",style:{width:n}},[...a.keys()].filter((e=>a.get(e).isActive)).map((t=>(0,e.jsx)(kt,{key:t,trackKey:t,track:a.get(t),onTrackClicked:r}))),[...a.keys()].filter((e=>!a.get(e).isActive)).map((t=>(0,e.jsx)(kt,{key:t,trackKey:t,track:a.get(t),onTrackClicked:r}))))}function Rt(t){const{width:a,height:n,trackMap:i,onTrackChanged:r}=t;return(0,e.jsx)("div",{className:"sidebar d-flex",style:{width:a,height:n}},(0,e.jsx)(Et,{trackMap:i,width:a,onTrackChanged:r}))}function jt(){return jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},jt.apply(null,arguments)}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tt(e)}function Ft(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ft=function(){return!!e})()}function Ct(e){var t="function"==typeof Map?new Map:void 0;return Ct=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return function(e,t,a){if(Ft())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return a&&Mt(i,a.prototype),i}(e,arguments,Tt(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Mt(a,e)},Ct(e)}var At=function(e){var t,a;function n(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,Mt(t,a),n}(Ct(Error));function Ot(e,t){return e.substr(-t.length)===t}var Pt=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function _t(e){return"string"!=typeof e?e:e.match(Pt)?parseFloat(e):e}var Vt=function(e){return function(t,a){void 0===a&&(a="16px");var n=t,i=a;if("string"==typeof t){if(!Ot(t,"px"))throw new At(69,e,t);n=_t(t)}if("string"==typeof a){if(!Ot(a,"px"))throw new At(70,e,a);i=_t(a)}if("string"==typeof n)throw new At(71,t,e);if("string"==typeof i)throw new At(72,a,e);return""+n/i+e}};Vt("em");Vt("rem");function $t(e){return Math.round(255*e)}function Bt(e,t,a){return $t(e)+","+$t(t)+","+$t(a)}function Gt(e,t,a,n){if(void 0===n&&(n=Bt),0===t)return n(a,a,a);var i=(e%360+360)%360/60,r=(1-Math.abs(2*a-1))*t,o=r*(1-Math.abs(i%2-1)),s=0,l=0,c=0;i>=0&&i<1?(s=r,l=o):i>=1&&i<2?(s=o,l=r):i>=2&&i<3?(l=r,c=o):i>=3&&i<4?(l=o,c=r):i>=4&&i<5?(s=o,c=r):i>=5&&i<6&&(s=r,c=o);var u=a-r/2;return n(s+u,l+u,c+u)}var Ht={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var zt=/^#[a-fA-F0-9]{6}$/,Wt=/^#[a-fA-F0-9]{8}$/,Ut=/^#[a-fA-F0-9]{3}$/,qt=/^#[a-fA-F0-9]{4}$/,Jt=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Yt=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Qt=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Xt=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function Kt(e){if("string"!=typeof e)throw new At(3);var t=function(e){if("string"!=typeof e)return e;var t=e.toLowerCase();return Ht[t]?"#"+Ht[t]:e}(e);if(t.match(zt))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(Wt)){var a=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:a}}if(t.match(Ut))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(qt)){var n=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:n}}var i=Jt.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var r=Yt.exec(t.substring(0,50));if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10),alpha:parseFloat(""+r[4])>1?parseFloat(""+r[4])/100:parseFloat(""+r[4])};var o=Qt.exec(t);if(o){var s="rgb("+Gt(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=Jt.exec(s);if(!l)throw new At(4,t,s);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=Xt.exec(t.substring(0,50));if(c){var u="rgb("+Gt(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",d=Jt.exec(u);if(!d)throw new At(4,t,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new At(5)}function Zt(e){return function(e){var t,a=e.red/255,n=e.green/255,i=e.blue/255,r=Math.max(a,n,i),o=Math.min(a,n,i),s=(r+o)/2;if(r===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:s,alpha:e.alpha}:{hue:0,saturation:0,lightness:s};var l=r-o,c=s>.5?l/(2-r-o):l/(r+o);switch(r){case a:t=(n-i)/l+(n<i?6:0);break;case n:t=(i-a)/l+2;break;default:t=(a-n)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:s,alpha:e.alpha}:{hue:t,saturation:c,lightness:s}}(Kt(e))}var ea=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function ta(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function aa(e){return ta(Math.round(255*e))}function na(e,t,a){return ea("#"+aa(e)+aa(t)+aa(a))}function ia(e,t,a){return Gt(e,t,a,na)}function ra(e,t,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof a)return ia(e,t,a);if("object"==typeof e&&void 0===t&&void 0===a)return ia(e.hue,e.saturation,e.lightness);throw new At(1)}function oa(e,t,a,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof a&&"number"==typeof n)return n>=1?ia(e,t,a):"rgba("+Gt(e,t,a)+","+n+")";if("object"==typeof e&&void 0===t&&void 0===a&&void 0===n)return e.alpha>=1?ia(e.hue,e.saturation,e.lightness):"rgba("+Gt(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new At(2)}function sa(e,t,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof a)return ea("#"+ta(e)+ta(t)+ta(a));if("object"==typeof e&&void 0===t&&void 0===a)return ea("#"+ta(e.red)+ta(e.green)+ta(e.blue));throw new At(6)}function la(e,t,a,n){if("string"==typeof e&&"number"==typeof t){var i=Kt(e);return"rgba("+i.red+","+i.green+","+i.blue+","+t+")"}if("number"==typeof e&&"number"==typeof t&&"number"==typeof a&&"number"==typeof n)return n>=1?sa(e,t,a):"rgba("+e+","+t+","+a+","+n+")";if("object"==typeof e&&void 0===t&&void 0===a&&void 0===n)return e.alpha>=1?sa(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new At(7)}var ca=function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha)},ua=function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha},da=function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha)},fa=function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha};function pa(e){if("object"!=typeof e)throw new At(8);if(ua(e))return la(e);if(ca(e))return sa(e);if(fa(e))return oa(e);if(da(e))return ra(e);throw new At(8)}function ma(e,t,a){return function(){var n=a.concat(Array.prototype.slice.call(arguments));return n.length>=t?e.apply(this,n):ma(e,t,n)}}function ga(e){return ma(e,e.length,[])}ga((function(e,t){if("transparent"===t)return t;var a=Zt(t);return pa(jt({},a,{hue:a.hue+parseFloat(e)}))}));function ha(e,t,a){return Math.max(e,Math.min(t,a))}ga((function(e,t){if("transparent"===t)return t;var a=Zt(t);return pa(jt({},a,{lightness:ha(0,1,a.lightness-parseFloat(e))}))}));ga((function(e,t){if("transparent"===t)return t;var a=Zt(t);return pa(jt({},a,{saturation:ha(0,1,a.saturation-parseFloat(e))}))}));ga((function(e,t){if("transparent"===t)return t;var a=Zt(t);return pa(jt({},a,{lightness:ha(0,1,a.lightness+parseFloat(e))}))}));var ya=ga((function(e,t,a){if("transparent"===t)return a;if("transparent"===a)return t;if(0===e)return a;var n=Kt(t),i=jt({},n,{alpha:"number"==typeof n.alpha?n.alpha:1}),r=Kt(a),o=jt({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=i.alpha-o.alpha,l=2*parseFloat(e)-1,c=((l*s==-1?l:l+s)/(1+l*s)+1)/2,u=1-c;return la({red:Math.floor(i.red*c+o.red*u),green:Math.floor(i.green*c+o.green*u),blue:Math.floor(i.blue*c+o.blue*u),alpha:i.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})}));ga((function(e,t){if("transparent"===t)return t;var a=Kt(t);return la(jt({},a,{alpha:ha(0,1,(100*("number"==typeof a.alpha?a.alpha:1)+100*parseFloat(e))/100)}))}));ga((function(e,t){if("transparent"===t)return t;var a=Zt(t);return pa(jt({},a,{saturation:ha(0,1,a.saturation+parseFloat(e))}))}));ga((function(e,t){return"transparent"===t?t:pa(jt({},Zt(t),{hue:parseFloat(e)}))}));ga((function(e,t){return"transparent"===t?t:pa(jt({},Zt(t),{lightness:parseFloat(e)}))}));ga((function(e,t){return"transparent"===t?t:pa(jt({},Zt(t),{saturation:parseFloat(e)}))}));ga((function(e,t){return"transparent"===t?t:ya(parseFloat(e),"rgb(0, 0, 0)",t)}));ga((function(e,t){return"transparent"===t?t:ya(parseFloat(e),"rgb(255, 255, 255)",t)}));ga((function(e,t){if("transparent"===t)return t;var a=Kt(t);return la(jt({},a,{alpha:ha(0,1,+(100*("number"==typeof a.alpha?a.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))}));var va=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function ba(t){const{eventDS:a,record:n,fieldInfos:i,fields:o,isActive:s,contentWidth:l,measureRange:c,trackIndex:d,subtypeLayers:f,onItemClick:p,onItemHover:m,onItemHoverExit:g}=t,y=e.React.useRef(null),v=(0,O.getTheme)(),[x,S]=e.React.useState(null),[w,I]=e.React.useState(null),[L,k]=e.React.useState(null),[E,R]=e.React.useState(!1),[j,M]=e.React.useState(!1),[T,C]=e.React.useState(null),A=.75,[P,_]=e.React.useState(!1),{selectedSldId:V,pendingEdits:$}=h(),B=b(),G=e=>{e.stopPropagation(),B({type:"SET_SELECTED_SLD_ID",value:re()}),p(n,i,re(),!1)},H=e=>{e.stopPropagation(),B({type:"SET_SELECTED_SLD_ID",value:re()}),p(n,i,re(),!0)},z=e=>{e.stopPropagation();const t=U();m(t,re())},W=e=>{e.stopPropagation(),g()},U=()=>{if((0,u.isDefined)(T)&&!$.has(re()))return T;const e=new Map,t=It(i,n),a=Dt(i);e.set(t.originalFieldName,xt(o,i,n,f)),e.set(a.originalFieldName,n.attributes.get(a.originalFieldName));const r={attributes:e,fromMeasure:n.fromMeasure,toMeasure:n.toMeasure,index:n.index,isPoint:n.isPoint,hasValue:n.hasValue,selected:n.selected,displayField:n.displayField,geometry:n.geometry,objectId:n.objectId,fieldInfos:i,attributeBackgrounds:q()};return C(r),r},q=()=>{const e=new Map,t=It(i,n),a=Dt(i);return e.set(t.originalFieldName,la(L.r,L.g,L.b,.5)),e.set(a.originalFieldName,"transparent"),e};e.React.useEffect((()=>{s&&(()=>{va(this,void 0,void 0,(function*(){n.isPoint&&!E?(yield J(),R(!0)):n.isPoint||(yield Y(),R(!0))}))})()}),[s,l]),e.React.useEffect((()=>{const e=()=>va(this,void 0,void 0,(function*(){n.isPoint?yield J(!0):n.isPoint||(yield Y(!0))}));$.has(re())&&(e(),_(!0))}),[$]);const J=e=>va(this,void 0,void 0,(function*(){if(!n.hasValue)return;const[t,i,r]=yield Promise.all([ee(),te(),Nt(n,null,!0)]);S(t),I(i);const o=a;yield t.getDisplayedSymbol(r,{renderer:o.layer.renderer}).then((a=>va(this,void 0,void 0,(function*(){var n,s;if(Q(r,o,t,e),!(0,u.isDefined)(a))return;const l=a.toJSON(),c=null!==(s=null===(n=null==l?void 0:l.symbol)||void 0===n?void 0:n.symbolLayers)&&void 0!==s?s:null;if((0,u.isDefined)(c)){l.symbolLayers=K(c,!1),a=i.fromJSON(l);const e=document.getElementById(re()),n=e.getElementsByTagName("img");n.length>0&&e.removeChild(n[0]);const r=yield t.renderPreviewHTML(a,{node:e,size:N*A});r.style.width=`${N}px`,r.style.height=`${N}px`;const o=e.getElementsByTagName("img")[0],s=yt(o,N);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}else if("picture-marker"===a.type){const e=document.getElementById(re()),t=document.createElement("img");t.src=null==a?void 0:a.url,e.style.backgroundImage=`url(${t.src})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.backgroundSize="contain"}else if((0,u.isDefined)(l)){l.size=N,a=i.fromJSON(l);const e=document.getElementById(re()),n=e.getElementsByTagName("img");n.length>0&&e.removeChild(n[0]);const r=yield t.renderPreviewHTML(a,{node:e,size:N*A});r.style.width=`${N}px`,r.style.height=`${N}px`;const o=e.getElementsByTagName("img")[0],s=yt(o,N);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}}))))})),Y=e=>va(this,void 0,void 0,(function*(){if(!n.hasValue)return;const t=document.getElementById(re());if((0,u.isDefined)(t)){const i=a,[r,o,s]=yield Promise.all([ee(),te(),Nt(n,i,!0)]);S(r),I(o),yield r.getDisplayedSymbol(s,{renderer:i.layer.renderer}).then((a=>va(this,void 0,void 0,(function*(){var n,l;if(X(t,s,i,r,e),!(0,u.isDefined)(a))return;const c=a.toJSON(),d=null!==(l=null===(n=null==c?void 0:c.symbol)||void 0===n?void 0:n.symbolLayers)&&void 0!==l?l:null;if((0,u.isDefined)(d)&&d.length>1){c.symbolLayers=K(d,!1),a=o.fromJSON(c);const e=t.getElementsByTagName("img");e.length>0&&t.removeChild(e[0]),yield r.renderPreviewHTML(a,{node:t,size:{width:t.getBoundingClientRect().width*A,height:D*A},symbolConfig:{isSquareFill:!0}});const n=t.getElementsByTagName("img")[0];if(""===n.src||0===n.width)return void t.removeChild(n);const i=yt(n);n.src=i,t.style.backgroundImage=`url(${i})`,t.style.backgroundPosition="center",t.removeChild(n),M(!0)}}))))}})),Q=(e,t,a,n)=>va(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(L)||n){const n=yield a.getDisplayedColor(e,{renderer:t.layer.renderer});if((0,u.isDefined)(n))k(n);else{k({r:255,g:255,b:255,a:0})}}})),X=(e,t,a,n,i)=>va(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(L)||i){const i=yield n.getDisplayedColor(t,{renderer:a.layer.renderer});if((0,u.isDefined)(i))e.style.background=la(i.r,i.g,i.b,i.a),k(i);else{const t={r:255,g:255,b:255,a:0};e.style.background=la(t.a,t.g,t.b,t.a),k(t)}}else e.style.background=la(L.r,L.g,L.b,L.a)})),K=(e,t)=>{if(t)e.forEach((e=>{e.width=N}));else{let t=0;e.forEach((e=>{e.width>t&&(t=e.width)})),e.forEach((e=>{e.width=D-(t-e.width),e.capStyle="Butt",e.joinStyle="Round"}))}return e},Z=(e,t,a)=>1-(.299*e+.587*t+.114*a)/255<.5,ee=()=>va(this,void 0,void 0,(function*(){if(x)return x;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return S(t),t}})),te=()=>va(this,void 0,void 0,(function*(){if(w)return w;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/jsonUtils");return I(t),t}})),ae=()=>{const e=ne(),t=ie();return t-e>0?t-e:1},ne=()=>{const e=n.fromMeasure;if(!isNaN(e)){const t=mt(e,c,l);return n.isPoint?t-N/2:t}return 0},ie=()=>{const e=n.toMeasure;return isNaN(e)?ne():mt(e,c,l)},re=()=>d+"-"+n.index;return(0,e.jsx)("div",null,s&&n.hasValue&&n.isPoint&&(0,e.jsx)("div",{id:re(),className:(0,e.classNames)("sld-item-point-active",V===re()?"sld-item-selected-point":"",P?"sld-item-edited-point":""),ref:y,style:{left:ne(),background:"transparent"},onMouseEnter:z,onMouseLeave:W,onClick:G,onDoubleClick:H}),s&&n.hasValue&&!n.isPoint&&(0,e.jsx)("div",{id:re(),ref:y,className:(0,e.classNames)("sld-item-line-active",V===re()?"sld-item-selected-line":"",P?"sld-item-edited-line":""),onMouseEnter:z,onMouseLeave:W,onClick:G,onDoubleClick:H,style:{width:ae(),left:ne()}},(0,e.jsx)("div",{className:"sld-item-label-wrapper"},(0,e.jsx)(r.Label,{className:"sld-item-label",centric:!0,style:{color:(0,u.isDefined)(L)?Z(L.r,L.g,L.b)?"#000":"#fff":"#000",background:j&&(0,u.isDefined)(L)?la(L.r,L.g,L.b,L.a):"transparent",visibility:""!==xt(o,i,n,f)?"visible":"hidden"}},xt(o,i,n,f)))),!s&&n.hasValue&&n.isPoint&&(0,e.jsx)("div",{id:re(),className:"sld-item-point-inactive",style:{width:"24px",left:ne(),background:"transparent"}},(0,e.jsx)(F.CalciteIcon,{icon:"bullet-point-large",scale:"m",css:e.css`--calcite-ui-icon-color: ${v.sys.color.action.disabled.text};`})),!s&&n.hasValue&&!n.isPoint&&(0,e.jsx)("div",{id:re(),className:"sld-item-line-inactive",style:{width:ae(),left:ne()}}))}function xa(t){const{allLayersDS:a,trackMap:n,contentWidth:i,measureRange:r,isActive:o,featureLayer:s,subtypeLayers:l,onItemClick:c,onItemHover:d,onItemHoverExit:f}=t,{fieldInfo:p}=h(),m=()=>{if((0,u.isDefined)(a)&&a.length){const e=a.find((e=>e.layer.layerId.toString()===n.layerId));if((0,u.isDefined)(e))return e}return null},g=(e,t,a,i)=>{c(e,n,t,a,i)},y=(e,t)=>{d(e,n,t)},v=e.React.useMemo((()=>p.filter((e=>e.eventName===n.layerName||""===e.eventName))),[p,n.layerName]),b=e.React.useMemo((()=>(0,u.isDefined)(s)?s.fields.filter((e=>e.alias.includes(".")&&(e.alias.split(".")[0]===n.layerName||""===e.alias.split(".")[0]))):null),[s,n.layerName]);return(0,e.jsx)("div",{className:(0,e.classNames)("sld-row d-flex",o?"active":"inactive"),style:{width:i,flexDirection:"row",position:"relative"}},n.records.map((t=>(0,e.jsx)(ba,{key:t.index,eventDS:m(),record:t,fieldInfos:v,fields:b,featureLayer:s,isActive:o,contentWidth:i,measureRange:r,trackIndex:n.index,subtypeLayers:l,onItemClick:g,onItemHover:y,onItemHoverExit:f}))))}const Sa=function(){return Le.Date.now()};var wa=Math.max,Ia=Math.min;const Da=function(e,t,a){var n,i,r,o,s,l,c=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var a=n,r=i;return n=i=void 0,c=t,o=e.apply(r,a)}function m(e){var a=e-l;return void 0===l||a>=t||a<0||d&&e-c>=r}function g(){var e=Sa();if(m(e))return h(e);s=setTimeout(g,function(e){var a=t-(e-l);return d?Ia(a,r-(e-c)):a}(e))}function h(e){return s=void 0,f&&n?p(e):(n=i=void 0,o)}function y(){var e=Sa(),a=m(e);if(n=arguments,i=this,l=e,a){if(void 0===s)return function(e){return c=e,s=setTimeout(g,t),u?p(e):o}(l);if(d)return clearTimeout(s),s=setTimeout(g,t),p(l)}return void 0===s&&(s=setTimeout(g,t)),o}return t=Je(t)||0,Me(a)&&(u=!!a.leading,r=(d="maxWait"in a)?wa(Je(a.maxWait)||0,t):r,f="trailing"in a?!!a.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=l=i=s=void 0},y.flush=function(){return void 0===s?o:h(Sa())},y};var Na=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};const La=t=>{const a=e.React.useRef();e.React.useEffect((()=>{a.current=t}),[t]);return e.React.useMemo((()=>Da((()=>{var e;null===(e=a.current)||void 0===e||e.call(a)}),1e3)),[])};function ka(t){const{allLayersDS:a,trackMap:n,contentWidth:i,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}=t,[d,f]=e.React.useState(""),[p,m]=e.React.useState(new Map),[g,y]=e.React.useState(!1),[v,x]=e.React.useState(new Map),{highlightColor:S,highlightLayer:w,selectedSldId:I}=h(),[D,N]=e.React.useState(null),[L,k]=e.React.useState(null),[E,R]=e.React.useState(null),j=(0,O.getTheme)(),M=b(),T=()=>{""!==I&&I!==E||(R(null),m(new Map),x(new Map),k(null),y(!1),V())},C=(e,t,a)=>{""!==I&&I!==a||(N(e),k(t),R(a),P())},A=(e,t,a,n,i)=>{y(!1),_(e),i||I!==n||M({type:"SET_SELECTED_SLD_ID",value:""}),i&&c(e,t,a)},P=La((()=>{(0,u.isDefined)(D)&&(0,u.isDefined)(L)&&(0,u.isDefined)(E)&&(""!==I&&I!==E||(_(D),y(!0),f(E),m(D.attributes),x(D.attributeBackgrounds),k(L)))})),_=e=>Na(this,void 0,void 0,(function*(){if((0,u.isDefined)(e)&&(0,u.isDefined)(w)){w.removeAll();const t=yield Nt(e),a=yield(0,u.getGeometryGraphic)(t,S,4,!e.isPoint);w.add(a)}})),V=()=>{(0,u.isDefined)(w&&""!==I)&&w.removeAll()},$=()=>(0,u.isDefined)(L)?L.layerName:"";return(0,e.jsx)("div",{className:"sld-body h-100",style:{width:i}},[...n.keys()].filter((e=>n.get(e).isActive)).map((t=>(0,e.jsx)(xa,{key:n.get(t).index,allLayersDS:a,featureLayer:s,trackMap:n.get(t),contentWidth:i,measureRange:o,isActive:!0,subtypeLayers:l,onItemClick:A,onItemHover:C,onItemHoverExit:T}))),[...n.keys()].filter((e=>!n.get(e).isActive)).map((t=>(0,e.jsx)(xa,{key:n.get(t).index,allLayersDS:a,featureLayer:s,trackMap:n.get(t),contentWidth:i,measureRange:o,isActive:!1,subtypeLayers:l,onItemClick:c,onItemHover:C,onItemHoverExit:T}))),(0,e.jsx)(F.CalcitePopover,{autoClose:void 0,closable:void 0,open:!!g||void 0,overlayPositioning:"absolute",placement:"auto",scale:"s",label:$(),heading:$(),referenceElement:d,style:{borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${e.polished.rgba(j.sys.color.surface.overlayHint,.5)}`}},(0,e.jsx)("div",{style:{margin:"10px"}},[...p.keys()].map((t=>(0,e.jsx)("span",{key:t},(0,e.jsx)("div",{style:{background:v.get(t),marginBottom:"3px"}},(0,e.jsx)(r.Label,{centric:!0,style:{margin:"2px 5px"}},`${(e=>{if(!(0,u.isDefined)(D))return"";const t=D.fieldInfos.find((t=>t.originalFieldName===e));return(0,u.isDefined)(t)?t.originalFieldAlias:e})(t)}: ${p.get(t)}`))))))))}function Ea(t){const{trackMap:a,height:n,containerWidth:i,contentWidth:r,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}=t,{jimuMapView:d}=h(),f=e.React.useMemo((()=>{if(d)return(0,u.getMapAllLayers)(d.mapWidgetId)}),[d]);return(0,e.jsx)("div",{className:"sld",style:{width:i,height:n}},(0,e.jsx)(ka,{allLayersDS:f,trackMap:a,contentWidth:r,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}))}const Ra=t=>{const[a,n]=e.React.useState({refWidth:0,refHeight:0});return e.React.useEffect((()=>{const e=e=>({refWidth:e.contentRect.width,refHeight:e.contentRect.offsetHeight});if(t.current){const a=new ResizeObserver((t=>{for(const a of t)n(e(a))}));return a.observe(t.current),()=>{a.disconnect()}}}),[t]),a};function ja(a){const{sidebarWidth:n,zoom:i,measureRange:o,scrollPosition:s,onZoomChange:l,onNavForwardOrBack:c,onNavStartOrEnd:u}=a,d=e.hooks.useTranslation(t);return(0,e.jsx)("div",{className:"sidebar-header d-flex",style:{width:n}},(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navStart"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-start",scale:"m",textLabel:d("navStart"),onClick:()=>{u(!1)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navBack"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-left",scale:"m",textLabel:d("navBack"),onClick:()=>{c(!1)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("zoomOut"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"minus-circle",scale:"m",textLabel:d("zoomOut"),onClick:()=>{l(i/2<1?1:i/2)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("zoomIn"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"plus-circle",scale:"m",textLabel:d("zoomIn"),onClick:()=>{const e=o.to-o.from,t=i*(n/e),a=s/i;l((a*i+n)/t-a*i/t<1?i:2*i)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navForward"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-right",scale:"m",textLabel:d("navForward"),onClick:()=>{c(!0)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navEnd"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-end",scale:"m",textLabel:d("navEnd"),onClick:()=>{u(!0)}}))))}function Ma(t){const a=(0,O.getTheme)(),{width:n=0,zoom:i=1,range:r=[-1/0,1/0],scrollPosition:o=0,onClickOrHover:s}=t,l=V.default.useRef(null),[c,u]=V.default.useState(""),[d,f]=V.default.useState(""),[p,m]=V.default.useState(!1),[g,h]=V.default.useState(!1);V.default.useEffect((()=>{function e(e){l.current&&!l.current.contains(e.target)&&(m(!1),h(!1),s(null,!1,!1))}return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[l,s]),V.default.useEffect((()=>{x(o,i)}),[o,i,n]);const y=e=>{const t=document.createElement("div");return t.style.display="none",t.style.color=e,document.body.appendChild(t),window.getComputedStyle(t,null).getPropertyValue("color")},v=e=>{if(0===c.length){const t=y(e);return u(t),t}return c},b=e=>{if(0===d.length){const t=y(e);return f(t),t}return d},x=(e,t)=>{const i=l.current.getContext("2d"),o=r[0]<0,s=w,c=w/2,u=w/3,d=w/4,f=v(a.sys.color.surface.background),p=b(a.sys.color.surface.backgroundHint),m=b(a.sys.color.surface.backgroundHint),g="transparent";i.rect(0,0,n,w),i.fillStyle=f,i.fill(),i.save(),i.scale(1,1),i.strokeStyle=p,i.lineWidth=1,i.font="12px sans-serif",i.fillStyle=m,i.textAlign="left",i.textBaseline="bottom",i.translate(.5,0),i.beginPath();const h=r[1]-r[0],y=t*(n/h),x=e/t==0?Number.MIN_VALUE:e/t,S=x*t/y,I=(x*t+n)/y;let D=Math.floor(S),N=ot(I-S,0);const L=Math.ceil(N/10);if(D%L!=0){const e=D%L;D-=e,N+=e}const k=Math.max(["left","center","right"].indexOf("left")-1,-1),E=w,R=[];let j=1;j=N>=6?8:N>=4?16:N>=2?32:64;for(let e=0;e<=N;++e){if(e%L!=0)continue;const t=(e+D)*(n/h),a=`${ot(h/n*t+r[0],1)}`,o=i.measureText(a).width;R.push({color:m,backgroundColor:g,value:t,text:a,textSize:o,isLast:!1})}0===R.length&&(R.push({color:m,backgroundColor:g,value:0,text:r[0].toString(),textSize:i.measureText(r[0].toString()).width,isLast:!1}),R.push({color:m,backgroundColor:g,value:n,text:r[1].toString(),textSize:i.measureText(r[1].toString()).width,isLast:!0}));for(let e=0;e<=N;++e){const a=e+D;if(!o&&a<0)continue;const r=(a*(n/h)-x)*t;if(N>=10){const t=L/j;if(e%L!=0)continue;for(let e=0;e<j;++e){const a=r+e*t*y;if(a<0||a>=n)continue;let o=s;o=0===e?s:e%4==0?c:e%2==0?u:d;const l=E-o,[f,p]=[a,l],[m,g]=[f,p+o];i.moveTo(f,p),i.lineTo(m,g)}}else for(let t=0;t<j;++t){const a=r+t/j*y;if(a<0||a>=n)continue;let o=s;o=0===t&&e%L==0?s:t%4==0?c:t%2==0?u:d;const l=E-o,[f,p]=[a,l],[m,g]=[f,p+o];i.moveTo(f,p),i.lineTo(m,g)}}i.stroke(),i.beginPath(),R.forEach((({value:e,backgroundColor:a,color:r,text:l,textSize:c,isLast:u})=>{if(!o&&e<0)return;const d=(e-x)*t;if(d<-y||d>=n+n/h*t)return;let f=0;f=u?17:E-25;let p=k;u&&(p=c/2);const[m,g]=[d+-3*p,f];if(a){let e=0;e=u?-c:0,i.save(),i.fillStyle=a,i.fillRect(m+e,0,c,s),i.restore()}i.save(),i.fillStyle=r,i.fillText(l,m,g),i.restore()})),i.restore()};return(0,e.jsx)("div",{className:"dyn-seg-ruler",style:{width:n},onMouseDown:e=>{g&&(m(!p),s(e,!p,g))},onMouseMove:e=>{g&&s(e,p,g)},onMouseEnter:e=>{h(!0)},onMouseLeave:e=>{h(!1),s(e,p,!1)}},(0,e.jsx)("canvas",{ref:l,width:n,height:w}))}function Ta(t){const{sidebarWidth:a,bodyWidth:n,contentWidth:i,measureRange:r,zoom:o,scrollPosition:s,onZoomChange:l,onNavForwardOrBack:c,onNavStartOrEnd:u,onClickOrHover:d}=t,[f,p]=e.React.useState(o);e.React.useEffect((()=>{p(o)}),[o]);const m=e.React.useCallback((e=>{p(e),l(e)}),[l]);return(0,e.jsx)("div",{className:"header w-100 d-flex"},(0,e.jsx)(ja,{sidebarWidth:a,bodyWidth:n,contentWidth:i,zoom:f,measureRange:r,scrollPosition:s,onZoomChange:m,onNavForwardOrBack:c,onNavStartOrEnd:u}),(0,e.jsx)(Ma,{width:n,range:[r.from,r.to],zoom:f,scrollPosition:s,onClickOrHover:d}))}var Fa=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function Ca(t){const{x:a,m:n,snapTolerance:i,isPopupActive:o,isHoverActive:s,trackMap:l,featureLayer:c,subtypeLayers:d,maxHeight:f,networkInfo:p,measureRange:m,contentWidth:g,sidebarWidth:y,scrollPos:v}=t,[b,x]=e.React.useState(new Map),{fieldInfo:S}=h(),[w,I]=e.React.useState(null),{jimuMapView:D}=h(),[N,L]=e.React.useState(a),[k,E]=e.React.useState(n),R=e.React.useRef(null),j=(0,O.getTheme)();e.React.useEffect((()=>{const e=()=>Fa(this,void 0,void 0,(function*(){const e=new Map;if(!isNaN(n)){const t=V();L(t[0]),E(t[1]),yield Promise.all([...l.keys()].map((a=>Fa(this,void 0,void 0,(function*(){return l.get(a).isActive&&(yield Promise.all(l.get(a).records.map((n=>Fa(this,void 0,void 0,(function*(){if(n.hasValue&&B(n,t[1])){const t=A(l.get(a).layerName),i=C(l.get(a).layerName),r=l.get(a).index.toString()+"-"+n.index.toString(),o=yield P(l.get(a),n),s={displayField:It(i,n).originalFieldAlias,displayValue:xt(t,S,n,d),background:o,order:l.get(a).index};e.set(r,s)}})))))),a}))))).then((()=>{x(e)}))}}));isNaN(n)||e()}),[n]);const M=e.React.useMemo((()=>{if(D)return(0,u.getMapAllLayers)(D.mapWidgetId)}),[D]),T=()=>Fa(this,void 0,void 0,(function*(){if(w)return w;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return I(t),t}})),C=e=>S.filter((t=>t.eventName===e)),A=e=>(0,u.isDefined)(c)?c.fields.filter((t=>t.alias.includes(".")&&t.alias.split(".")[0]===e)):null,P=(e,t)=>Fa(this,void 0,void 0,(function*(){const[a,n]=yield Promise.all([T(),Nt(t,null,!0)]),i=_(e),r=yield a.getDisplayedColor(n,{renderer:i.layer.renderer});return(0,u.isDefined)(r)?la(r.r,r.g,r.b,.5):la(255,255,255,0)})),_=e=>{if((0,u.isDefined)(M)&&M.length){const t=M.find((t=>t.layer.layerId.toString()===e.layerId));if((0,u.isDefined)(t))return t}return null},V=()=>{const e=null==p?void 0:p.mTolerance,t=[...l.keys()];for(let a=0;a<t.length;a++){const r=l.get(t[a]);if(r.isActive)for(let t=0;t<r.records.length;t++){const a=r.records[t];if(a.isPoint&&a.hasValue&&(0,u.atOrBetween)([n-i,n+i],a.fromMeasure,e))return[$(a.fromMeasure),a.fromMeasure]}}return[a,n]},$=e=>{if(isNaN(e))return NaN;const t=mt(e,m,g)+y-v;return Math.floor(t)},B=(e,t)=>{const a=null==p?void 0:p.mTolerance;return!(!(0,u.isWithinTolerance)(t,e.fromMeasure,a)&&!(0,u.isWithinTolerance)(t,e.toMeasure,a))||!e.isPoint&&t>e.fromMeasure&&t<e.toMeasure},G=()=>(0,u.isDefined)(p)?p.measurePrecision:0,H=()=>o||s;return(0,e.jsx)("div",{ref:R,id:"sld-marker",className:`sld-marker sld-marker--pointer ${H()?"sld-is-visible":""} `,style:{left:isNaN(N)?0:N}},(0,e.jsx)(F.CalcitePopover,{id:"sld-marker-popover",style:{minWidth:12*(isNaN(k)?0:k.toFixed(G()).toString().length)+"px",borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${e.polished.rgba(j.sys.color.surface.overlayHint,.5)}`},autoClose:void 0,closable:void 0,open:!!H()||void 0,overlayPositioning:"absolute",placement:"auto-start",offsetDistance:15,offsetSkidding:10,scale:"s",label:k.toFixed(G()),heading:k.toFixed(G()),referenceElement:"sld-marker"},o&&(0,e.jsx)("div",{style:{padding:"10px",textWrap:"nowrap",maxHeight:f,overflow:"auto"}},[...new Map([...b.entries()].sort(((e,t)=>e[1].order-t[1].order))).keys()].map((t=>(0,e.jsx)("span",{key:t},(0,e.jsx)("div",{style:{background:b.get(t).background,marginBottom:"3px"}},(0,e.jsx)(r.Label,{centric:!0,style:{margin:"2px 5px"}},`${b.get(t).displayField}: ${b.get(t).displayValue}`))))))))}var Aa=y(73387),Oa=y(38410),Pa=y(82228),_a=y(44927);const Va=e.React.forwardRef(((a,n)=>{const{trackRecord:i,eventInfo:o,eventRecords:s,featureLayer:l,eventFields:c,currentRecord:d,onApply:f}=a,[p,m]=e.React.useState(!1),[g,h]=e.React.useState(!1),[y,v]=e.React.useState(d),b=e.React.useRef(null),x=(0,O.getTheme)(),S=e.hooks.useTranslation(t);e.React.useImperativeHandle(n,(()=>({isEditPending:()=>!I(),applyEdit:()=>{D()}}))),e.React.useEffect((()=>{v(d)}),[d]);const w=()=>{const e=[];let t=[...i.attributes.keys()];t=t.filter((e=>e!==o.eventIdFieldName));for(let a=0;a<c.length;a++)if(c[a].editable&&t.includes(c[a].name))if("date"===c[a].type){const t=new Pa.default({fieldName:c[a].name,label:c[a].alias,input:new _a.default({includeTime:!1})});e.push(t)}else{const t=new Pa.default({fieldName:c[a].name,label:c[a].alias,editableExpression:"true"});e.push(t)}return new Oa.default({elements:e})};e.React.useEffect((()=>{if((0,u.isDefined)(l)&&(0,u.isDefined)(y)&&l&&s.length>0){const e=document.getElementById("formDiv");b.current=new Aa.default({container:e,layer:l,feature:y,formTemplate:w()}),b.current.on("submit",(e=>{const{invalid:t,values:a}=e;if(t.length)return;Object.keys(a).forEach((e=>{i.attributes.has(e)&&i.attributes.set(e,a[e])})),y.attributes=a,m(!1),v(y),f(i)})),b.current.on("value-change",(e=>{var t,a;const{feature:n,fieldName:i,value:r}=e,o=null===(t=b.current.viewModel)||void 0===t?void 0:t.submittable;h(o),r!==(null===(a=null==n?void 0:n.attributes)||void 0===a?void 0:a[i])?m(!0):m(!1)}))}}),[y]);const I=()=>!p||!g,D=()=>{var e;null===(e=b.current.viewModel)||void 0===e||e.submit()};return(0,e.jsx)("div",{className:"editable-fields d-flex w-100 h-100",style:{flexDirection:"column"}},(0,e.jsx)("div",{style:{background:x.sys.color.surface.paper},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{size:"lg",centric:!0,style:{fontWeight:600,paddingLeft:"15px",margin:"0px"}},S("editableFields")),(0,e.jsx)("div",{id:"formDiv",style:{width:"100%",backgroundColor:x.sys.color.surface.paper}}),(0,e.jsx)(F.CalciteButton,{style:{padding:"0px 15px 15px 15px"},appearance:"solid",scale:"m",width:"full",alignment:"center",kind:"brand",disabled:!!I()||void 0,label:S("apply"),onClick:D},S("apply"))))}));function $a(a){const{eventInfo:n,eventFields:i,subtypeLayers:o,featureLayer:s,currentRecord:l}=a,c=e.hooks.useTranslation(t),d=(0,O.getTheme)(),f=e=>{if((0,u.isDefined)(l)){const t=l.attributes[e.name];return function(e,t,a,n){return St(wt(e,null,t),e,null,a,n)}(e,s,t,o)}};return(0,e.jsx)("div",{className:"non-editable-fields d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"}},(0,e.jsx)("div",{style:{background:d.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{size:"lg",centric:!0,style:{fontWeight:600,margin:"0px"}},c("nonEditableFields")),(0,e.jsx)(F.CalciteTable,{caption:c("nonEditableFields"),bordered:!0,className:"table-container",scale:"m",layout:"fixed"},(0,e.jsx)(F.CalciteTableRow,{slot:"table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:c("attribute")}),(0,e.jsx)(F.CalciteTableHeader,{heading:c("value")})),(()=>{if(!(0,u.isDefined)(l))return[];const e=n.lrsFields.map((e=>e.alias)),t=(0,u.getExistingFieldNames)();let a=i.filter((t=>e.includes(t.alias)));return a=a.filter((e=>!t.includes(e.name.toUpperCase()))),a})().map(((t,a)=>(0,e.jsx)(F.CalciteTableRow,{key:a},(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t.alias,className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t.alias))),(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:f(t),className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},f(t))))))))))}var Ba=y(46420),Ga=y.n(Ba),Ha=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a};const za=t=>{const a=window.SVG,{className:n}=t,i=Ha(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:r,src:Ga()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var Wa=y(85633);const Ua=e.React.forwardRef(((a,n)=>{const{track:i,trackRecord:o,eventEsriFields:s,eventInfo:l,currentRecord:c,allRecords:d,networkInfo:f,featureLayer:p,refresh:m}=a,[g,h]=e.React.useState(null),[y,v]=e.React.useState([]),[b,x]=e.React.useState([]),S=e.hooks.useTranslation(t),w=(0,O.getTheme)();e.React.useImperativeHandle(n,(()=>({getStats:()=>b}))),e.React.useEffect((()=>{if((0,u.isDefined)(l)&&(0,u.isDefined)(s)){const e=I();N(e)}}),[i,o,l,s,c]),e.React.useEffect((()=>{if(m){const e=I();N(e)}}),[m]);const I=()=>{const e=l.lrsFields.map((e=>e.alias)),t=(0,u.getExistingFieldNames)(),a=s.filter((a=>(0,u.isNumber)(a.type)&&!e.includes(a.alias)&&!t.includes(a.name.toUpperCase())&&!(0,u.isDefined)(a.domain)&&o.attributes.has(a.name)));return v(a),a.length?(h(a[0]),a[0]):null},D=(e,t,a,n,i,r)=>{var o,s,l,c,u,d;const f=[];return f.push([S("historicalFirstLabel"),null!==(o=null==e?void 0:e.toString())&&void 0!==o?o:""]),f.push([S("historicalLastLabel"),null!==(s=null==t?void 0:t.toString())&&void 0!==s?s:""]),f.push([S("historicalMinimumLabel"),null!==(l=null==a?void 0:a.toString())&&void 0!==l?l:""]),f.push([S("historicalMaximumLabel"),null!==(c=null==n?void 0:n.toString())&&void 0!==c?c:""]),f.push([S("meanLabel"),null!==(u=null==i?void 0:i.toString())&&void 0!==u?u:""]),f.push([S("medianLabel"),null!==(d=null==r?void 0:r.toString())&&void 0!==d?d:""]),f},N=e=>{var t,a;let n=D();if((0,u.isDefined)(d)&&(0,u.isDefined)(c)&&(0,u.isDefined)(f)&&(0,u.isDefined)(e)&&d.length){const r=null===(t=null==p?void 0:p.editFieldsInfo)||void 0===t?void 0:t.creationDateField,o=new Map;i.records.forEach((e=>{const t=function(e){var t;const a=e.fieldInfos.find((e=>e.isOidField));return(0,u.isDefined)(a)&&null!==(t=e.attributes.get(a.featureFieldName))&&void 0!==t?t:NaN}(e);isNaN(t)||o.set(t,e)}));let s=null,l=null,c=NaN,f=NaN,m=NaN,g=NaN,h=NaN,y=NaN;const v=[];if(d.forEach((t=>{let a=t.attributes[e.name];const n=t.getObjectId();if(o.has(n)){a=o.get(n).attributes.get(e.name)}if((0,u.isDefined)(a)&&!isNaN(a)){const e=t.attributes[r];if((0,u.isDefined)(e)){const t=new Date(e);(!(0,u.isDefined)(s)||t<s)&&(c=a,s=t),(!(0,u.isDefined)(l)||t>l)&&(f=a,l=t)}v.push(a)}})),v.length>0){const e=L(v);g=ot(Math.min(...v),e),h=ot(Math.max(...v),e),y=ot(v.reduce(((e,t)=>e+t),0)/v.length,e);const t=[...v].sort(((e,t)=>e-t)),i=null!==(a=Math.floor(t.length/2))&&void 0!==a?a:0;m=t.length%2?ot(t[i],e):ot((t[i-1]+t[i])/2,e),n=D(c,f,g,h,y,m)}}x(n)},L=e=>{let t=0;return e.forEach((e=>{const a=k(e);a>t&&(t=a)})),t},k=e=>{if(!isFinite(e))return 0;let t=1,a=0;for(;Math.round(e*t)/t!==e;)t*=10,a++;return a},E=y&&y.length;return(0,e.jsx)("div",{className:"statistics d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"}},E?(0,e.jsx)("div",{style:{margin:"0px",background:w.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{className:"statistic-label text-truncate",size:"lg",centric:!0,style:{fontWeight:600,margin:"0px"}},S("statistics")),(0,e.jsx)(r.Select,{className:"statistics-select",style:{marginBottom:"15px"},value:g.alias,onChange:e=>{(e=>{const t=s.find((t=>t.alias===e));h(t),N(t)})(e.target.value)}},y.map(((t,a)=>(0,e.jsx)("option",{key:t.alias,value:t.alias},t.alias)))),(0,e.jsx)(F.CalciteTable,{caption:S("statistics"),bordered:!0,className:"table-container",scale:"m",layout:"fixed"},(0,e.jsx)(F.CalciteTableRow,{slot:"table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:S("attribute")}),(0,e.jsx)(F.CalciteTableHeader,{heading:S("value")})),b.map(((t,a)=>(0,e.jsx)(F.CalciteTableRow,{key:a},(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t[0],className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t[0]))),(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t[1],className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t[1])))))))):(0,e.jsx)("div",null))}));var qa=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function Ja(a){const{widgetId:n,track:i,trackRecord:o,trackFieldInfos:s,lrsLayers:l,subtypeLayers:c,networkInfo:d,showEventStatistics:f,onApply:p,onClose:m}=a,[g,y]=e.React.useState(!1),[v,x]=e.React.useState(!1),[w,I]=e.React.useState(!1),[D,N]=e.React.useState(!1),[L,k]=e.React.useState(null),[E,R]=e.React.useState([]),[j,M]=e.React.useState(null),[T,C]=e.React.useState([]),[A,P]=e.React.useState(null),[V,$]=e.React.useState(null),[B,G]=e.React.useState(null),[H,z]=e.React.useState(null),W=e.React.useRef(null),U=e.React.useRef(null),{pendingEdits:q,selectedSldId:J,outputDataSources:Y}=h(),Q=b(),X=e.hooks.useTranslation(t),K=(0,O.getTheme)();e.React.useEffect((()=>{(0,u.isDefined)(i)&&(0,u.isDefined)(o)?(y(!0),Z()):y(!1)}),[i,o]),e.React.useEffect((()=>{(0,u.isDefined)(Y)&&2===Y.length&&(G(Y[0]),z(Y[1]))}),[Y]),e.React.useEffect((()=>{w&&setTimeout((()=>{I(!1)}),1e4)}),[w]);const Z=()=>qa(this,void 0,void 0,(function*(){const t=l.find((e=>e.serviceId.toString()===i.layerId));if((0,u.isDefined)(t)&&(0,u.isDefined)(t.eventInfo)){k(t.eventInfo);const a=e.DataSourceManager.getInstance().getDataSource(t.useDataSource.dataSourceId);if((0,u.isDefined)(a)){let e=a.getGDBVersion();e||(e="");const n=yield(0,u.getLayer)(t.useDataSource),i=n.createQuery(),r=o.attributes.get(S.routeIdName);i.outFields=["*"],i.where=`LOWER(${t.eventInfo.routeIdFieldName}) = LOWER('${r}')`,i.gdbVersion=e,yield n.queryFeatures(i).then((e=>{P(a),C(n.fields),M(n),R(e.features),ee(e.features,a,t.eventInfo)}))}}})),ee=(e,t,a)=>{0===e.length?$(null):1===E.length?$(te(E[0],o,a)):e.forEach((e=>{e.attributes[a.eventIdFieldName]===o.attributes.get(Dt(s).originalFieldName)&&$(te(e,o,a))}))},te=(e,t,a)=>{const n=e.attributes;return Object.keys(n).forEach((e=>{t.attributes.has(e)&&(n[e]=t.attributes.get(e))})),e.attributes=n,e},ae=(t,a)=>qa(this,void 0,void 0,(function*(){var n,i,r;const o=L.isPointEvent?B:H;let s=e.DataSourceManager.getInstance().getDataSource(o);if(s||(s=yield e.DataSourceManager.getInstance().createDataSource(o)),!s)return;const l=ne(t);s.setSchema(l);const c=ie(),u=Object.assign(s.getDataSourceJson()),d=t.getLabel()+"_export";e.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(s,(0,e.Immutable)(Object.assign(Object.assign({},u),{label:d,disableExport:!1})));const f=[];null==a||a.forEach(((e,t)=>{const a={},n=e.getFeature();if(n.attributes)for(const e in n.attributes){const t=n.attributes[e];null!=t&&(a[e]=t)}const i=new _.default({attributes:a,geometry:e.geometry});f.push(i)}));const p=[],m=[],g=Object.keys(null==l?void 0:l.fields).filter((e=>c.includes(e))).reduce(((e,t)=>(e[t]=null==l?void 0:l.fields[t],e)),{});for(const t in g){let a="";a=g[t].type===e.JimuFieldType.Number?"double":g[t].type===e.JimuFieldType.Date?"date":"string";const n={alias:g[t].alias,name:g[t].name,type:a},i={fieldName:g[t].name,label:g[t].alias};m.push(n),p.push(i)}const h=new Wa.default({id:o+"_layer",title:o,fields:m,geometryType:L.isPointEvent?"point":"polyline",source:f,objectIdField:s.getSchema().idField,popupTemplate:{title:s.getLabel(),fieldInfos:p,content:[{type:"fields",fieldInfos:p}]},visible:!1,listMode:"hide"}),y=e.DataSourceManager.getInstance().getDataSource(o);h&&y&&(y.layer=h);const v=[];return v.push({records:a,dataSource:s,name:s.getLabel(),fields:c}),null===(n=e.DataSourceManager.getInstance().getDataSource(o))||void 0===n||n.setStatus(e.DataSourceStatus.Unloaded),null===(i=e.DataSourceManager.getInstance().getDataSource(o))||void 0===i||i.setCountStatus(e.DataSourceStatus.Unloaded),null===(r=e.DataSourceManager.getInstance().getDataSource(o))||void 0===r||r.addSourceVersion(),[o,v]})),ne=t=>{const a={},n=t,i=null==n?void 0:n.getSchema().fields.asMutable({deep:!0}),r=re(),o=oe(),s=se(),l=[];Object.keys(i).forEach((e=>{r.includes(e)&&l.push(i[e]),o.includes(e)&&l.push(i[e])})),s.forEach((t=>{l.push({alias:t[0],type:e.JimuFieldType.Number,jimuName:t[0],name:t[0]})})),null==l||l.forEach((e=>{a[null==e?void 0:e.jimuName]=e}));return{label:t.getLabel()+"_export",idField:"OBJECTID",fields:a}},ie=()=>{const e=L.lrsFields.map((e=>e.name)),t=se().map((e=>e[0])),a=Object.values(S),n=[...o.attributes.keys()],i=s.filter((e=>e.isOidField)).map((e=>e.featureFieldName));return[...e,...t,...n.filter((e=>!a.includes(e)&&e!==L.eventIdFieldName&&!i.includes(e)))]},re=()=>L.lrsFields.map((e=>e.name)),oe=()=>{const e=[];return Object.keys(V.attributes).forEach((t=>{o.attributes.has(t)&&e.push(t)})),e},se=()=>W.current?W.current.getStats():[],le=(e,t)=>{const a={},n=re(),i=se();return Object.keys(t.attributes).forEach((e=>{n.includes(e)&&(a[e]=t.attributes[e]),o.attributes.has(e)&&(a[e]=o.attributes.get(e))})),i.forEach((e=>{a[e[0]]=e[1]})),e.buildRecord({attributes:a,geometry:t.geometry})},ce=e=>{U.current&&U.current.isEditPending()&&!e?x(!0):(x(!1),I(!1),y(!1),k(null),R([]),M(null),C([]),$(null),Q({type:"SET_SELECTED_SLD_ID",value:""}),m())},ue=e.React.useCallback((e=>{const t=new Map(q),a={layerId:i.layerId,attributes:Lt(s,e,null==L?void 0:L.datasetName,!1)};t.set(J,a),Q({type:"SET_EDITS",value:t});const n=i.records.findIndex((e=>e.index===o.index));n>-1&&(i.records[n]=e,I(!0),p(i),de())}),[Q,L,p,q,J,i,s,o]),de=()=>{N(!0),setTimeout((()=>{N(!1)}),200)};return(0,e.jsx)(r.Modal,{size:"sm",isOpen:g,centered:!0,scrollable:!0,toggle:()=>{ce()},backdrop:"static"},(0,e.jsx)(r.ModalHeader,{title:null==i?void 0:i.layerName,toggle:()=>{ce()}},(0,e.jsx)("div",{className:"d-flex w-100"},null==i?void 0:i.layerName,(0,e.jsx)(r.Tooltip,{title:X("dataAction_ExportCSV")},(0,e.jsx)(r.Button,{style:{marginLeft:"auto",border:"none"},icon:!0,size:"sm",onClick:()=>qa(this,void 0,void 0,(function*(){if((0,u.isDefined)(A)&&(0,u.isDefined)(V)){const t=le(A,V);if(!(0,u.isDefined)(t))return;const a=yield ae(A,[t]);if(!(0,u.isDefined)(a))return;const i=a[0];if(i){const r=a[1],o=e.DataSourceManager.getInstance(),s=null==o?void 0:o.getDataSource(i);o.createDataSource((0,e.Immutable)({id:A.id+"_export",type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:s.getSchema(),disableExport:!1})).then((a=>{a.setSourceRecords([t]);e.DataActionManager.getInstance().getSupportedActions(n,r,e.DataLevel.Records).then((t=>qa(this,void 0,void 0,(function*(){const a=t.export;if((null==a?void 0:a.length)>0){const t=a.filter((e=>"export-csv"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],r,e.DataLevel.Records,n)}})))).catch((e=>{console.error(e)}))}))}}}))},(0,e.jsx)(za,null))))),(0,e.jsx)(r.ModalBody,{style:{maxHeight:"70vh",overflow:"auto",background:K.sys.color.surface.background}},(0,e.jsx)(F.CalciteNotice,{css:(0,u.getCalciteNoticeTheme)(K),style:{position:"sticky",top:0,zIndex:1,marginBottom:w?"15px":"0px",borderTop:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderRight:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!w||void 0,icon:"check-circle",kind:"success",scale:"s",width:"auto",closable:!0,onCalciteNoticeClose:e=>{I(!1)}},(0,e.jsx)("div",{slot:"title"},X("sldEditSuccessful"))),(0,e.jsx)(F.CalciteNotice,{css:(0,u.getCalciteNoticeTheme)(K),style:{position:"sticky",top:0,zIndex:1,marginBottom:v?"15px":"0px",borderTop:v?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderRight:v?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:v?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!v||void 0,icon:"exclamation-mark-triangle",kind:"warning",scale:"s",width:"auto"},(0,e.jsx)("div",{slot:"title"},X("applyEditTitle")),(0,e.jsx)("div",{slot:"message"},X("applyEditMessage")),(0,e.jsx)("div",{slot:"actions-end"},(0,e.jsx)("div",{className:"d-flex",style:{flexDirection:"column",backgroundColor:K.sys.color.primary.main}},(0,e.jsx)(F.CalciteAction,{scale:"m",icon:"read-only-non-editable",text:"Discard","text-enabled":!0,appearance:"transparent",onClick:()=>{ce(!0)},style:{border:`2px solid ${K.sys.color.surface.paper}`}}),(0,e.jsx)(F.CalciteAction,{scale:"m",icon:"save",text:"Apply","text-enabled":!0,appearance:"transparent",onClick:()=>{var e;null===(e=U.current)||void 0===e||e.applyEdit(),setTimeout((()=>{U.current.isEditPending()||(x(!1),ce())}),200)},style:{border:`2px solid ${K.sys.color.surface.paper}`,borderTop:0}})))),(0,e.jsx)(Va,{ref:U,trackRecord:o,eventInfo:L,eventRecords:E,eventFields:T,featureLayer:j,currentRecord:V,onApply:ue}),(0,e.jsx)($a,{eventInfo:L,eventFields:T,subtypeLayers:c,featureLayer:j,currentRecord:V}),f&&(0,e.jsx)(Ua,{ref:W,track:i,trackRecord:o,eventEsriFields:T,eventInfo:L,currentRecord:V,allRecords:E,networkInfo:d,featureLayer:j,refresh:D})))}function Ya(t){const{widgetId:a,trackMap:n,measureRange:i,defaultRange:r,featureLayer:o,subtypeLayers:s,networkInfo:l,lrsLayers:c,showEventStatistics:d}=t,[f,p]=e.React.useState(200),[m,g]=e.React.useState(!1),[h,y]=e.React.useState(!1),[v,b]=e.React.useState(0),[x,S]=e.React.useState(0),D=e.React.useRef(null),N=e.React.useRef(null),L=e.React.useRef(null),{refWidth:k}=Ra(D),E=e.React.useRef({startX:0,startY:0,scrollLeft:0,scrollTop:0}),[R,j]=e.React.useState(n),[M,T]=e.React.useState(0),[F,C]=e.React.useState(NaN),[A,O]=e.React.useState(0),[P,_]=e.React.useState(!1),[V,$]=e.React.useState(!1),[B,G]=e.React.useState(null),[H,z]=e.React.useState(null),[W,U]=e.React.useState([]);e.React.useEffect((()=>{j(n)}),[n]),e.React.useEffect((()=>{const e=(i.to-i.from)/r;b(e<1?1:e)}),[r,i]);const q=e.React.useCallback((e=>{b(e)}),[]),J=e=>{if(g(!1),h){if(y(!1),!N.current)return;document.body.style.cursor="default"}},Y=e=>{if(m&&!h){if(e.pageX<140)return;p(e.pageX)}if(!m&&h&&N.current){e.preventDefault();const t=N.current,a=L.current,n=e.pageX-t.offsetLeft,i=e.pageY-a.offsetTop,r=1.5*(n-E.current.startX),o=1.5*(i-E.current.startY);t.scrollLeft=E.current.scrollLeft-r,a.scrollTop=E.current.scrollTop-o}},Q=(e,t)=>{if(isNaN(e))return NaN;let a=x;(0,u.isDefined)(t)&&(a=t);let n=a+(e-f);return n<0&&(n=0),function(e,t,a){return isNaN(e)?NaN:e/a*(t.to-t.from)+t.from}(n,i,ae)},X=e=>{const t=e.currentTarget.getBoundingClientRect();return e.clientX-t.left+f},K=e.React.useMemo((()=>{const e=document.createElement("div");e.style.cssText="overflow:scroll; visibility:hidden; position:absolute;",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;return e.remove(),t}),[]),Z=e.React.useMemo((()=>{let e=0;return R.forEach((t=>{t.isActive?e+=w:e+=I})),e+K}),[K,R]),ee=e.React.useMemo((()=>{let e=0;return R.forEach((t=>{t.isActive?e+=w:e+=I})),e}),[R]),te=e.React.useMemo((()=>k-f-K),[K,k,f]),ae=e.React.useMemo((()=>(k-f-K)*v),[K,k,f,v]);return(0,e.jsx)("div",{ref:D,className:"dyn-seg-diagram-container h-100 w-100 d-flex",style:{flexDirection:"column"},onMouseUp:J,onMouseMove:Y},(0,e.jsx)(Ja,{widgetId:a,track:B,trackRecord:H,trackFieldInfos:W,lrsLayers:c,subtypeLayers:s,networkInfo:l,showEventStatistics:d,onApply:e=>{const t=new Map(R);t.set(e.layerName,e),j(t)},onClose:()=>{G(null),z(null),U(null)}}),(0,e.jsx)(Ca,{x:M,m:F,snapTolerance:A,isPopupActive:P,isHoverActive:V,trackMap:R,featureLayer:o,subtypeLayers:s,maxHeight:D.current?D.current.clientHeight-.3*D.current.clientHeight:0,networkInfo:l,measureRange:i,contentWidth:ae,sidebarWidth:f,scrollPos:x}),(0,e.jsx)(Ta,{sidebarWidth:f,bodyWidth:te,contentWidth:ae,measureRange:i,zoom:v,scrollPosition:x,onZoomChange:q,onNavForwardOrBack:e=>{if(!N.current)return;const t=N.current,a=t.scrollLeft,n=t.clientWidth;t.scrollLeft=e?a+n:a-n},onNavStartOrEnd:e=>{if(!N.current)return;const t=N.current;t.scrollLeft=e?t.scrollWidth:0},onClickOrHover:(e,t,a)=>{(0,u.isDefined)(e)?(T(X(e)),C(Q(X(e))),O(Q(X(e)+10)-Q(X(e)))):(T(NaN),C(NaN)),_(t),$(a)}}),(0,e.jsx)("div",{className:"diagram-container h-100 w-100 d-flex"},(0,e.jsx)("div",{ref:L,className:"sidebar-container h-100 d-flex",onScroll:e=>{N.current&&(N.current.scrollTop=e.target.scrollTop)}},(0,e.jsx)(Rt,{trackMap:R,width:f,height:Z,onTrackChanged:e=>{j(e)}}),(0,e.jsx)("div",{className:"sidebar-resizer d-flex",style:{height:Z},onMouseDown:e=>{g(!0),e.preventDefault()},onMouseUp:J,onMouseMove:Y})),(0,e.jsx)("div",{ref:N,className:"sld-container h-100",onScroll:e=>{S(e.target.scrollLeft),L.current&&(L.current.scrollTop=e.target.scrollTop),N.current&&(N.current.scrollTop=e.target.scrollTop),C(Q(M))},onMouseDown:e=>{if(!N.current)return;const t=N.current,a=L.current,n=e.pageX-t.offsetLeft,i=e.pageY-a.offsetTop,r=t.scrollLeft,o=a.scrollTop;E.current={startX:n,startY:i,scrollLeft:r,scrollTop:o},y(!0),document.body.style.cursor="grabbing"},onMouseUp:J,onMouseMove:Y},(0,e.jsx)(Ea,{trackMap:R,containerWidth:te,height:ee,contentWidth:ae,measureRange:i,featureLayer:o,subtypeLayers:s,onItemClick:(e,t,a)=>{G(t),z(e),U(a),_(!1),$(!1)}}))))}var Qa=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function Xa(t){const{widgetId:a,featureLayer:n,records:i,lrsLayers:r,attributeSet:o,measureRange:s,defaultRange:l,networkInfo:c,showEventStatistics:d}=t,[f,p]=e.React.useState(!0),[m,g]=e.React.useState(new Map),[h,y]=e.React.useState([]),v=b();e.React.useEffect((()=>{(0,u.isDefined)(i)?x(i):S()}),[]);const x=e=>Qa(this,void 0,void 0,(function*(){const t=yield E(r,o),a=oe(n,r,t),i=yield ut(e,a,r,o,s,c);v({type:"SET_FIELD_INFO",value:a}),v({type:"SET_IS_LOADING",value:!1}),g(i),p(!0),y(t)})),S=()=>{v({type:"SET_FIELD_INFO",value:[]}),p(!1)};return(0,e.jsx)("div",{className:"dyn-seg-diagram h-100 w-100 d-flex"},f&&(0,e.jsx)(Ya,{widgetId:a,trackMap:m,measureRange:s,defaultRange:l,featureLayer:n,subtypeLayers:h,networkInfo:c,lrsLayers:r,showEventStatistics:d}))}var Ka=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function Za(a){const{dynSegFeatureLayer:n,lrsLayers:i,attributeSet:o,intl:s,networkDS:l,routeId:c,currentRouteInfo:d,networkInfo:f,handleLockToast:p}=a,{fieldInfo:m,pendingEdits:g}=h(),[y,v]=e.React.useState(),[x,S]=e.React.useState(),[w,I]=e.React.useState([]),[D,N]=e.React.useState(),[L,k]=e.React.useState([]),[R,j]=e.React.useState([]),[M,T]=e.React.useState(""),[C,A]=e.React.useState(),[O,P]=e.React.useState(),_=b(),V=e.hooks.useTranslation(t);e.React.useEffect((()=>{Q()}),[]),e.React.useEffect((()=>{E(i,o).then((e=>{j(e)}))}),[o,i]),e.React.useEffect((()=>{(null==f?void 0:f.supportsLines)&&ve(f,c,l).then((e=>{e&&A(e)})).catch((e=>{console.error(e)}))}),[f]);const $=e=>{if(!w)return null;const t=w.find((t=>t.eventLayerId===y&&t.originalFieldName===e)),a=n.fields.find((e=>e.name===t.featureFieldName));return a||null},B=(e,t)=>t.isSubtypeField?"subtype":(0,u.isDefined)(e.domain)&&(0,u.isCodedDomain)(e.domain.type)?"domain":(0,u.isDefined)(e.domain)&&(0,u.isRangeDomain)(e.domain.type)?"range":(0,u.isDate)(e.type)?"date":(0,u.isNumber)(e.type)?"number":"text",G=(e,t)=>(0,u.isDefined)(t)?`${t} - ${e}`:e,H=e=>{P(e)},z=e=>Ka(this,void 0,void 0,(function*(){if(!x||!w)return null;const a=w.find((e=>e.eventLayerId===y&&e.originalFieldName===x)),n=$(x),i=B(n,a);let r=e;"number"===i&&(r=parseFloat(e));const o=M.length>0,l=(0,u.validateField)(e,a.featureFieldName,void 0,n);return l.hasError?o?{valid:!1,msg:l.message}:(T((0,u.formatMessage)(s,l.message,t)),H(r),{valid:!1,msg:(0,u.formatMessage)(s,l.message,t)}):(T(""),H(r),{valid:!0})})),W=e=>{const a=x,n=w.find((e=>e.eventLayerId===y&&e.originalFieldName===a)),i=$(a),r=M.length>0,o=(0,u.validateRangeDomain)(e,n.featureFieldName,void 0,i);return o.hasError?r?{valid:!1,msg:o.message}:(T((0,u.formatMessage)(s,o.message,t)),H(e),{valid:!1,msg:(0,u.formatMessage)(s,o.message,t)}):(T(""),H(e),{valid:!0})},U=e=>{var a;const n=null===(a=e.target)||void 0===a?void 0:a.valueAsDate;if(!n||isNaN(n.getTime()))return P(null),T(""),{valid:!0};const i=n.valueOf();if(!i)return P(null),T(""),{valid:!0};const r=x,o=w.find((e=>e.eventLayerId===y&&e.originalFieldName===r)),l=$(r),c=M.length>0,d=(0,u.validateField)(n,o.featureFieldName,void 0,l);return d.hasError?c?{valid:!1,msg:d.message}:(T((0,u.formatMessage)(s,d.message,t)),H(i),{valid:!1,msg:(0,u.formatMessage)(s,d.message,t)}):(T(""),H(i),{valid:!0})},q=e=>{e!==O&&H(e)},J=e=>{H(e.target.value)},Y=(t,a)=>{const n=(()=>{const e=R.find((e=>e.id===y));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]})();if("text"===t)return(0,e.jsx)(r.TextInput,{style:{height:"32px"},autoFocus:!0,type:"text",value:O,onChange:e=>{H(e.currentTarget.value)},checkValidityOnAccept:z});if("number"===t)return(0,e.jsx)(r.NumericInput,{style:{height:"32px"},autoFocus:!0,value:O,showHandlers:!1,onAcceptValue:q});if("date"===t)return(0,e.jsx)(F.CalciteInputDatePicker,{scale:"m",style:{height:"32px"},onCalciteInputDatePickerChange:U,placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0});if("domain"===t){const t=(i=a.domain,null===(o=null==i?void 0:i.codedValues)||void 0===o?void 0:o.map(((t,a)=>{let n=t.code;return null===n&&(n="<null>"),(0,e.jsx)("option",{key:a,value:n},G(t.name,t.code))})));return(0,e.jsx)(r.Select,{value:O,onChange:e=>{J(e)}},t)}return"subtype"===t?(0,e.jsx)(r.Select,{value:O,onChange:e=>{J(e)}},n.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.value},G(t.label,t.value))))):"range"===t?(0,e.jsx)(r.TextInput,{style:{height:"32px"},autoFocus:!0,value:O,onChange:e=>{H(e.currentTarget.value)},checkValidityOnAccept:W}):void 0;var i,o},Q=()=>{const e={},t=[];if(!m||0===m.length||!e)return{};m.forEach((a=>{const n=a.isEventIdField,i=a.exclude;!a.eventLayerId||n||i||(e[a.eventLayerId]?e[a.eventLayerId].push(a):(e[a.eventLayerId]=[a],t.push(a.eventLayerId)))})),e&&N(e);const a=e[t[0]];return I(a),k(t),v(t[0]),S(a[0].originalFieldName),e},X=(e,t)=>Ka(this,void 0,void 0,(function*(){const a=e.createQuery();return a.outFields=["*"],a.returnGeometry=!0,a.where=be(t),e.queryFeatures(a).then((e=>Ka(this,void 0,void 0,(function*(){return e.features})))).catch((e=>[]))})),K=()=>Ka(this,void 0,void 0,(function*(){let e=O;"<null>"===e&&(e=null);const t=yield X(n,l),a=[],i=w.find((e=>e.eventLayerId===y&&e.originalFieldName===x));t.forEach((t=>{const n=t.clone();if(n.attributes.type===i.EventType){const t=ce(e,i,n,R);t.size>0?t.forEach(((e,t)=>{n.attributes[t]=e})):n.attributes[i.featureFieldName]=e,a.push(n)}}));const r={updateFeatures:a};yield n.applyEdits(r).then((e=>{if(e.updateFeatureResults.length>0){let e=new Map(g);a.forEach((t=>{t.attributes.type===i.EventType&&(e=function(e,t,a,n){const i=ue(t,e.eventName),r=n.get(i),o=le(a,t,e.eventName,!1),s=new Map(n);if((0,u.isDefined)(r))r.attributes=o,s.set(i,r);else{const t={layerId:e.eventLayerId,attributes:o};s.set(i,t)}return s}(i,t,w,e),_({type:"SET_EDITS",value:e}))}))}})).catch((e=>{T(e.message)}))}));return(0,e.jsx)("div",{style:{margin:"1rem",display:"flex",flexDirection:"column"}},(0,e.jsx)(r.Label,null,V("eventLayer"),(0,e.jsx)(F.CalciteSelect,{label:V("eventLayer"),value:y,onCalciteSelectChange:e=>{v(e.target.value);const t=D[e.target.value];I(t),S(t[0].originalFieldName),P(null)}},(()=>{const t=[];return L&&0!==L.length?(L.forEach((a=>{const n=D[a],i=n[0].eventName,r=n[0].eventLayerId;t.push((0,e.jsx)(F.CalciteOption,{value:r}," ",i||r," "))})),t):[]})())),(0,e.jsx)(r.Label,{style:{marginTop:"0.3rem"}},V("updateField"),(0,e.jsx)(F.CalciteSelect,{label:V("updateField"),value:x,onCalciteSelectChange:e=>{P(null),S(e.target.value)}},(()=>{if(!y)return[];const t=[],a=D[y];return a&&0!==a.length?(a.forEach(((a,n)=>{t.push((0,e.jsx)(F.CalciteOption,{value:a.originalFieldName}," ",a.originalFieldName," "))})),t):[]})())),(0,e.jsx)(r.Label,{style:{marginTop:"0.3rem"}},V("fieldValue"),(()=>{if(!x||!w)return null;const e=w.find((e=>e.eventLayerId===y&&e.originalFieldName===x)),t=$(x),a=B(t,e);return Y(a,t)})()),(0,e.jsx)(F.CalciteButton,{onClick:()=>Ka(this,void 0,void 0,(function*(){let e;if(yield(0,u.isConflictPreventionEnabled)(l._url)){const t=(()=>{const e=f.lrsNetworkId,t=[],a=[],n=[],r=d;return L.forEach((t=>{const a=i.find((e=>e.serviceId.toString()===t.toString()));a&&a.eventInfo.parentNetworkId===e&&n.push(t)})),n.forEach((e=>{f.supportsLines&&C?t.push(C):t.push(c),a.push(f.supportsLines)})),{networkId:[e],routeOrLineId:t,eventServiceLayerIds:n,isLine:a,status:u.LockAcquireStatus.EsriSuccess,details:[],routeInfo:r,lockAction:u.LockAction.Query}})(),a=l;if(e=yield he(t,a,s),e){const t={title:e.toastMsg,body:"",type:e.toastMsgType};p(t),yield K()}else{const e={title:V("editFieldSuccess"),body:"",type:"success"};p(e),yield K()}}else yield K()})),disabled:(null==M?void 0:M.length)>0||void 0,style:{alignSelf:"flex-end",width:"50%",marginTop:"0.5rem"}},V("update")))}var en=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};function tn(i){const{widgetId:o,allowMerge:s,conflictPreventionEnabled:c,intl:d,networkDS:f,routeInfo:p,lrsLayers:m,attributeSets:g,defaultPointAttributeSet:y,defaultLineAttributeSet:v,attributeInputType:w,mapHighlightColor:I,graphicsLayer:D,defaultDisplayType:N,defaultDiagramScale:E,jimuMapView:j,outputDataSources:C,showEventStatistics:A,useMapWidgetIds:O,onResetDataAction:P}=i,_=e.hooks.useTranslation(t),[V,$]=e.React.useState(null),[B,G]=e.React.useState(null),[H,z]=e.React.useState(null),[W,U]=e.React.useState([]),[q,J]=e.React.useState(null),[Y,Q]=e.React.useState(!1),[X,K]=e.React.useState(),[Z,ae]=e.React.useState({title:"",body:"",type:"brand"}),{isLoading:ne,pendingEdits:ie,records:re,display:oe}=h(),se=b();e.React.useEffect((()=>{const e=e=>{if(ie.size>0){const t=e;return t.preventDefault(),t&&(t.returnValue=""),""}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[]),e.React.useEffect((()=>{se({type:"SET_DISPLAY",value:N})}),[N]),e.React.useEffect((()=>{se({type:"SET_OUTPUT_DATA_SOURCES",value:C})}),[C]),e.React.useEffect((()=>{(0,u.isDefined)(f)&&(0,u.isDefined)(p)&&(se({type:"RESET_STATE",action:""}),le(f,p))}),[p]),e.React.useEffect((()=>{(0,u.isDefined)(j)&&se({type:"SET_JIMU_MAP_VIEW",value:j})}),[se,j]),e.React.useEffect((()=>{(0,u.isDefined)(D)&&se({type:"SET_HIGHLIGHT_LAYER",value:D}),(0,u.isDefined)(I)&&se({type:"SET_HIGHLIGHT_COLOR",value:I})}),[se,D,I]);const le=(t,a)=>en(this,void 0,void 0,(function*(){const n=xe(t),i=de(a);let r=j;(0,u.isDefined)(r)||(r=(()=>{let e=null;if((null==O?void 0:O.length)>0){const t=l.MapViewManager.getInstance().getJimuMapViewGroup(null==O?void 0:O[0]);if(t&&t.jimuMapViews)for(const a in t.jimuMapViews)t.jimuMapViews[a].dataSourceId&&(t.jimuMapViews[a].isActive||void 0===t.jimuMapViews[a].isActive)&&(e=t.jimuMapViews[a])}return e})()),(0,u.isDefined)(r)||se({type:"SET_IS_LOADING",value:!1}),yield T(t,a,n,i).then((n=>en(this,void 0,void 0,(function*(){const o=yield k(a.networkInfo,m,i,r);yield function(t,a,n){return L(this,void 0,void 0,(function*(){if(!t||!a)return;let i=null,r=null,o=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic","esri/geometry/SpatialReference"]).then((e=>{[i,r,o]=e})).then((()=>L(this,void 0,void 0,(function*(){yield Promise.all(t.features.map((e=>L(this,void 0,void 0,(function*(){const s=new o({wkid:t.spatialReference.wkid}),l=new i(e.geometry);if(l.spatialReference=s,"Point"===e.attributes[S.typeName]&&1===l.paths.length&&2===l.paths[0].length){const e=l.getPoint(0,0),t=l.getPoint(0,1);e.x===t.x&&e.y===t.y&&(t.x+=n.xyTolerance,t.y+=n.xyTolerance,l.setPoint(0,1,t))}const c=Object.keys(e.attributes).filter((t=>(0,u.isDefined)(e.attributes[t]))).reduce(((t,a)=>(t[a]=e.attributes[a],t)),{}),d=new r({geometry:l,attributes:c});yield a.applyEdits({addFeatures:[d.clone()]}).then((e=>L(this,void 0,void 0,(function*(){if(e.addFeatureResults.length>0){let t=e.addFeatureResults[0].error,n=0;for(;(0,u.isDefined)(t)&&(t=yield R(a,d,t),(0,u.isDefined)(t)&&!(n>10));)n++}else console.error("Failed to add feature",e.addFeatureResults)})))).catch((e=>{console.error("Failed to add feature",e)}))})))))}))))}))}(n,o,a.networkInfo).then((()=>en(this,void 0,void 0,(function*(){z(o),U(i),$(t),G(a),J({from:a.fromMeasure,to:a.toMeasure}),P(),ce(o,t)}))))})))).catch((e=>{z(null),U([]),$(null),G(null),se({type:"SET_IS_LOADING",value:!1})}))})),ce=(e,t)=>en(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(e))return;const a=e.createQuery();a.outFields=["*"],a.returnGeometry=!0,a.where=be(t),a.orderByFields=[S.fromMeasureName],e.queryFeatures(a).then((e=>en(this,void 0,void 0,(function*(){se({type:"SET_RECORDS",value:e.features}),se({type:"SET_ORIGINAL_RECORDS",value:e.features}),0===e.features.length&&se({type:"SET_IS_LOADING",value:!1})})))).catch((e=>{se({type:"SET_RECORDS",value:[]}),se({type:"SET_ORIGINAL_RECORDS",value:[]}),se({type:"SET_IS_LOADING",value:!1})}))})),ue=()=>en(this,void 0,void 0,(function*(){(0,u.isDefined)(H)&&(se({type:"SET_RECORDS",value:[]}),se({type:"SET_ORIGINAL_RECORDS",value:[]}),setTimeout((()=>{ce(H,V)}),100))})),de=e=>{const t=g.attributeSet.find((e=>e.title===y)),a=g.attributeSet.find((e=>e.title===v));let i=[];w===n.LineAndPoint&&(i=M(e,m,t));const r=M(e,m,a);return i.concat(r)},fe=()=>(0,u.isDefined)(B)?B.networkInfo:null,pe=e=>{e&&K(e)},me=e=>{"success"===e.type||(e.time=6e4),ae(e),Q(!0)};return(0,e.jsx)(F.CalcitePanel,null,(0,e.jsx)("div",{slot:"header-content",className:"d-flex",style:{flexDirection:"column",height:"40px"}},(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{fontWeight:"600",marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(B)?B.routeId:"",t=(0,u.isDefined)(B)?B.routeName:"";return(0,u.isDefined)(B)&&B.networkInfo.useRouteName?_("routeNameLabel",{routeName:t}):_("routeIdLabel",{routeId:e})})()),(0,e.jsx)("div",{className:"d-flex",style:{flexDirection:"row"}},(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(V)?xe(V):null,t=(0,u.isDefined)(e)?e.toLocaleDateString():"";return _("dateLabel",{date:t})})()),(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{paddingLeft:"10px",marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(B)?B.fromMeasure:NaN,t=(0,u.isDefined)(B)?B.toMeasure:NaN;if(isNaN(e)||isNaN(t))return _("measureRangeNoValue");const a=(0,u.GetUnits)(B.networkInfo.unitsOfMeasure,d);return _("measureRangeValue",{fromM:e,toM:t,units:a})})()))),X&&(0,e.jsx)(F.CalcitePopover,{autoClose:void 0,closable:!0,overlayPositioning:"absolute",scale:"m",label:X.heading,heading:X.heading,style:{width:"300px"},referenceElement:X.id},"field-calculator"===X.id&&(0,e.jsx)(Za,{dynSegFeatureLayer:H,handleFieldCalculator:pe,intl:d,lrsLayers:m,attributeSet:W,networkDS:V,networkInfo:fe(),currentRouteInfo:B,routeId:(0,u.isDefined)(B)?B.routeId:"",handleLockToast:me})),(0,e.jsx)(ee,{attributeSet:W,widgetId:o,highlightLayer:D,highlightColor:I,onSave:e=>{ae(e),Q(!0)},lrsLayers:m,networkDS:V,networkInfo:fe(),jimuMapView:j,dynSegFeatureLayer:H,handleFieldCalculator:pe,intl:d,allowMerge:s,routeId:(0,u.isDefined)(B)?B.routeId:""}),(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)(x,{isLoading:ne}),Y&&(0,e.jsx)(te,{open:Y,messageProp:Z,onClose:()=>{Q(!1),"success"===Z.type&&(ae({title:"",body:"",type:"brand"}),ue())}}),(0,u.isDefined)(H)&&(0,u.isDefined)(B)&&re.length>0&&(oe===a.Table?(0,e.jsx)(lt,{intl:d,featureLayer:H,records:re,lrsLayers:m,attributeSet:W,networkInfo:B.networkInfo,networkDS:f,conflictPreventionEnabled:c,currentRouteInfo:B,routeId:(0,u.isDefined)(B)?B.routeId:"",handleLockToast:me}):(0,e.jsx)(Xa,{intl:d,widgetId:o,featureLayer:H,records:re,lrsLayers:m,attributeSet:W,measureRange:q,defaultRange:E,networkInfo:B.networkInfo,showEventStatistics:A}))))}function an(t,a){return e.css`
    background-color: var(--ref-palette-white);
    .table-indent {
      background-color: ${t.sys.color.surface.paper};
      width: calc(100% - 32px);
      height: calc(100% - 26px);
      margin: 0px 16px 16px;
      display: inline-block;
    }
    .dyn-seg-table-container {
      background-color: ${t.sys.color.surface.paper};
    }
    .dyn-seg-row {
       --calcite-table-row-border-color: ${t.sys.color.surface.background};
    }
    .dyn-seg-cell.edited {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.warning.light,.4)};
    }
    .dyn-seg-cell.non-editable {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.action.disabled.default,.2)};
    }
    .dyn-seg-cell.error {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.error.main,.2)};
    }
    .dyn-seg-column-header {
       --calcite-table-header-background: ${t.sys.color.surface.background};
    }
    .dyn-seg-row-header {
      --calcite-table-cell-background: ${t.sys.color.surface.background};
    }
    .dyn-seg-row-header.selected {
      --calcite-table-cell-background: ${a};
    }
    .header-divider {
      border-left: 1px solid red;
      height: auto;
    }
    .header-divider::hover {
      border-left: 1px solid ${e.polished.rgba(t.sys.color.secondary.light,.3)};
      height: 100%;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      top: 0;
      z-index: 5;
    }
    .toast {
      position: relative;
      z-index: 999;
      }
    .toast-notice {
      transform: translateY(100px);
    }
    .sidebar-header {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${w}px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-icon {
      width: 24px;
      height: 24px;
    }
    .sidebar-icon:hover {
      cursor: pointer;
      border: 1px solid ${t.sys.color.primary.main};
    }
    .header-actions {
      align-content: center;
    }
    .sidebar-item.active {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${w}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item.inactive {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${I}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item:hover {
      cursor: pointer;
      border: 1px solid ${t.sys.color.primary.main};
      background-color: ${t.sys.color.action.hover};
    }
    .sidebar-resizer {
      width: 10px;
      margin: 0px -5px;
      z-index: 1;
    }
    .sidebar-resizer:hover {
      border-left: 5px solid ${e.polished.rgba(t.sys.color.divider.input,.5)};
      border-right: 5px solid ${e.polished.rgba(t.sys.color.divider.input,.5)};
      cursor: col-resize;
      }
    .header {
      height: ${w}px;
    }
    .diagram-container {
      overflow: hidden;
    }
    .sidebar-container {
      overflow: auto;
      scrollbar-width: none;
      flex-direction: row;
    }
    .sld-container {
      flex-direction: row;
      overflow: auto;
    }
    .sld-row.active {
      border: 1px solid ${t.sys.color.divider.primary};
      background-color: ${t.sys.color.surface.paper};
      height: ${w}px;
    }
    .sld-row.inactive {
      border: 1px solid ${t.sys.color.divider.primary};
      background-color: ${t.sys.color.surface.paper};
      height: ${I}px;
    }
    .sld-body {
      overflow: hidden;
    }
    .sld-item-line-active {
      height: ${D}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${t.sys.color.divider.primary};
    }
    .sld-item-point-active {
      height: ${N}px;
      width: ${N}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-line-inactive {
      height: ${15}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${t.sys.color.divider.primary};
      background: ${t.sys.color.action.disabled.text};
    }
    .sld-item-point-inactive {
      height: ${I}px;
      width: ${I}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-label-wrapper {
      overflow: hidden;
      height: ${I}px;
      line-height: ${I}px;
      margin: 4px;
      text-align: center;
    }
    .sld-item-selected-line {
      z-index: 1;
      border: 1px solid ${t.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.primary.main};
    }
    .sld-item-selected-point {
      z-index: 1;
      filter: drop-shadow(0 0 4px ${t.sys.color.primary.main});
    }
    .sld-item-edited-point {
      border-radius: 2px;
      filter: drop-shadow(0 0 4px ${t.sys.color.warning.main});
    }
    .sld-item-edited-line {
      border: 1px solid ${t.sys.color.warning.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.warning.main};
    }
    .sld-item-label-wrapper::before {
      content: '';
      display: inline-block;
    }
    .sld-item-label {
      display: inline-block;
      height: ${I}px;
      margin: 0px;
      padding: 0px 5px;
      text-align: center;
      align-content: center;
      font-weight: 700;
      border-radius: 5px;
    }
    .sld-item-line-active:hover{
      z-index: 1;
      border: 1px solid ${t.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.primary.main};
    }
    .sld-item-point-active:hover {
      z-index: 1;
      filter: drop-shadow(0 0 3px ${t.sys.color.primary.main});
    } 
    .sld-marker {
      position: absolute;
      z-index: 2;
      top: 60px;
      bottom: 0;
      margin-left: 1px;
      border-left: 2px dashed;
      opacity: 0;
      pointer-events: none;
    }
    .sld-marker--pointer {
      color: ${t.sys.color.action.focus};
    }
    .sld-marker.sld-is-visible {
      opacity: 1;
    }
    &.formDiv{
      .esri-feature-form {
        background-color: ${t.sys.color.surface.paper};
      }
    }
  }
  `}var nn=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};class rn extends e.React.PureComponent{constructor(a){super(a),this.onActiveViewChange=e=>nn(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>nn(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const a=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==a?void 0:a.isDataSourceSet())&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then((()=>a)).catch((e=>a)):Promise.resolve(a)})),this.getI18nMessage=(e,a)=>{const n=Object.assign({},t,r.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},a)},this.state={hideTitle:!1,jimuMapView:void 0,highlightGraphicLayer:null,locationInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.routeLocationParams)&&this.setState({locationInfoFromDataAction:this.props.routeLocationParams});const a=(0,u.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:a})}componentDidUpdate(t,a){var n,i,r,o,s,l,c,u,d,f;a.jimuMapView!==this.state.jimuMapView&&this.state.jimuMapView&&(this.removeGraphicLayer(),this.createGraphicLayer());const p=null===(r=null===(i=null===(n=(0,e.getAppStore)())||void 0===n?void 0:n.getState())||void 0===i?void 0:i.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;if((p===e.WidgetState.Opened||!p)&&((null===(o=this.props)||void 0===o?void 0:o.selectedNetworkDataSource)&&(t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(s=null==t?void 0:t.mutableStatePropsVersion)||void 0===s?void 0:s.selectedNetworkDataSource)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(c=this.props)||void 0===c?void 0:c.routeLocationParams)){!(null===(u=this.props)||void 0===u?void 0:u.routeLocationParams)||t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.routeLocationParams&&(null===(d=null==t?void 0:t.mutableStatePropsVersion)||void 0===d?void 0:d.routeLocationParams)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.routeLocationParams)||this.setState({locationInfoFromDataAction:this.props.routeLocationParams})}}resetDataAction(){this.setState({networkDataSourceFromDataAction:null}),this.setState({locationInfoFromDataAction:null})}componentWillUnmount(){this.removeGraphicLayer()}removeGraphicLayer(){(0,u.isDefined)(this.state.highlightGraphicLayer)&&(this.state.highlightGraphicLayer.removeAll(),this.state.highlightGraphicLayer.destroy(),this.setState({highlightGraphicLayer:null}))}createGraphicLayer(){var e;if((0,u.isDefined)(this.state.jimuMapView)){this.removeGraphicLayer();const t=new c.default({listMode:"hide"});null===(e=this.state.jimuMapView.view)||void 0===e||e.map.add(t),this.setState({highlightGraphicLayer:t})}}render(){var t,a;const{config:n,id:i,routeLocationParams:o,selectedNetworkDataSource:c,outputDataSources:u}=this.props,{lrsLayers:d,mapHighlightColor:f,attributeSets:p,defaultPointAttributeSet:m,defaultLineAttributeSet:h,attributeInputType:y,defaultDisplayType:v,defaultDiagramScale:b,allowMerge:x,conflictPreventionEnabled:S,showEventStatistics:w}=n,{highlightGraphicLayer:I,jimuMapView:D}=this.state,N=this.props.theme;return(null===(t=n.lrsLayers)||void 0===t?void 0:t.length)?(0,e.jsx)(g,null,(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-dynamic-segmentation surface-1 border-0 d-flex",css:an(N,n.tableHighlightColor)},(0,e.jsx)("div",{className:"table-indent"},(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(tn,{widgetId:i,allowMerge:x,conflictPreventionEnabled:S,intl:this.props.intl,networkDS:c,routeInfo:o,lrsLayers:d,attributeSets:p,defaultPointAttributeSet:m,defaultLineAttributeSet:h,attributeInputType:y,mapHighlightColor:f,graphicsLayer:I,defaultDisplayType:v,defaultDiagramScale:b,jimuMapView:D,outputDataSources:u,showEventStatistics:w,useMapWidgetIds:this.props.useMapWidgetIds,onResetDataAction:this.resetDataAction.bind(this)})))):(0,e.jsx)(r.WidgetPlaceholder,{icon:s(),widgetId:i,message:this.getI18nMessage("_widgetLabel")})}}rn.mapExtraStateProps=(e,t)=>{var a,n;return{routeLocationParams:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.routeLocationParams,selectedNetworkDataSource:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedNetworkDataSource}};const on=rn;function sn(e){y.p=e}})(),v})())}}}));