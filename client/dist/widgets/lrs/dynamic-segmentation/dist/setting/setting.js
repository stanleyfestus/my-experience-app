System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","widgets/shared-code/lrs","jimu-ui/basic/list-tree","jimu-core/react","jimu-ui/basic/color-picker"],(function(e,t){var i={},s={},a={},r={},n={},o={},l={};return{setters:[function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.ReactRedux=e.ReactRedux,i.SessionManager=e.SessionManager,i.classNames=e.classNames,i.css=e.css,i.hooks=e.hooks,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){s.Alert=e.Alert,s.Button=e.Button,s.NumericInput=e.NumericInput,s.Select=e.Select,s.Switch=e.Switch,s.defaultMessages=e.defaultMessages},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.ObjectIdSchema=e.ObjectIdSchema,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){r.LrsLayerType=e.LrsLayerType,r.errorMessageDelay=e.errorMessageDelay,r.formatMessage=e.formatMessage,r.getAttributeSets=e.getAttributeSets,r.getEventInfoFromResults=e.getEventInfoFromResults,r.getFeatureLayer=e.getFeatureLayer,r.getLrsRequestUrl=e.getLrsRequestUrl,r.getMapAllLayers=e.getMapAllLayers,r.getNetworkInfoFromResults=e.getNetworkInfoFromResults,r.getUniqueUrls=e.getUniqueUrls,r.highlightColor=e.highlightColor,r.isConflictPreventionEnabled=e.isConflictPreventionEnabled,r.isDefined=e.isDefined,r.isParentNetworkAvailable=e.isParentNetworkAvailable,r.requestService=e.requestService},function(e){n.List=e.List,n.TreeItemActionType=e.TreeItemActionType},function(e){o.Fragment=e.Fragment},function(e){l.ColorPicker=e.ColorPicker}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=s},79298:e=>{"use strict";e.exports=a},54337:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=n},47626:e=>{"use strict";e.exports=r}},t={};function u(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,u),a.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>C,default:()=>M});var e,t,i,s=u(79244),a=u(14321);!function(e){e.Table="Table",e.Diagram="Diagram"}(e||(e={})),function(e){e.LineOnly="LineOnly",e.LineAndPoint="LineAndPoint"}(t||(t={})),function(e){e.Point="Point",e.Line="Line",e.Undefined="Undefined"}(i||(i={}));const r={blankStatus:"Select a map to import LRS networks and events",defaultSettings:"Default settings",defaultDynSegResult:"Default dynamic segmentation result",tableLabel:"Table",diagramLabel:"Diagram",defaultAttributeSetType:"Default attribute set type",lineOnlyLabel:"Line only",lineAndPointLabel:"Line and point",lineAttributeSet:"Line attribute set",pointAttributeSet:"Point attribute set",tableHighlightColor:"Table highlight color",mapHighlightColor:"Map highlight color",noEventLayersTips:"No Event layers are present in the selected map. Select a map with Line or Point Event layer/s present in the webmap.",diagramScale:"Diagram default scale",displayFieldLabel:"Display field",layerConfig:"Layer configuration",eventLabel:"Event Name",includeDerivedFields:"Include derived fields",mergeEvents:"Merge coincident events",showStatistics:"Show statistics",pointOutputLabel:"Dynamic Segmentation - Point",lineOutputLabel:"Dynamic Segmentation - Line"};var n=u(79298),o=u(47626),l=u(98640),p=u(68972),g=u(28996),d=u.n(g),h=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const m=e=>{const t=window.SVG,{className:i}=e,a=h(e,["className"]),r=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:r,src:d()},a)):s.React.createElement("svg",Object.assign({className:r},a))};var f=u(31027),y=u.n(f),S=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const v=e=>{const t=window.SVG,{className:i}=e,a=S(e,["className"]),r=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:r,src:y()},a)):s.React.createElement("svg",Object.assign({className:r},a))};function b(e){var t;const{widgetId:i,index:l,lrsLayer:u,attributeSets:c,lineAttributeSet:p,pointAttributeSet:g,onLayerChanged:d}=e,h=s.hooks.useTranslation(r),[m,f]=s.React.useState(null==u?void 0:u.name),y=function(e){const{widgetId:t,useDataSourceId:i}=e;return s.ReactRedux.useSelector((e=>{var s;let a;return a=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(s=a.widgets[t].useDataSources)&&void 0!==s?s:[]).some((e=>e.dataSourceId===i))}))}({widgetId:i,useDataSourceId:null===(t=null==u?void 0:u.useDataSource)||void 0===t?void 0:t.dataSourceId});s.React.useEffect((()=>{(null==u?void 0:u.name)&&m!==(null==u?void 0:u.name)&&f(null==u?void 0:u.name)}),[null==u?void 0:u.name]);const S=s.React.useCallback(((e,t,i=!1)=>{let s;s=null==t?u.without(e):u.set(e,t),d(l,s,i)}),[d,l,u]),v=()=>{var e;const t=(null===(e=u.eventInfo)||void 0===e?void 0:e.isPointEvent)?g:p,i=c.attributeSet.find((e=>e.title===t)),s=null==i?void 0:i.layers.find((e=>e.layerId===u.serviceId));if(!s)return[u.eventInfo.eventIdFieldName];return[...s.fields.map((e=>e.name)),u.eventInfo.eventIdFieldName]},b=e=>{S("displayField",e)};return(0,s.jsx)("div",{className:"h-100"},(0,s.jsx)("div",{css:s.css`height: 100%; overflow:auto;`},u&&y&&u.layerType===o.LrsLayerType.event&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(n.SettingSection,{role:"group","aria-label":h("eventLabel"),title:h("eventLabel")},u.name,(0,s.jsx)(n.SettingRow,{flow:"wrap",label:h("displayFieldLabel")},(0,s.jsx)(a.Select,{"aria-label":h("displayFieldLabel"),className:"w-100",size:"sm",value:(()=>{const e=v();return e.includes(null==u?void 0:u.displayField)?null==u?void 0:u.displayField:(b(e[0]),e[0])})(),onChange:e=>{b(e.target.value)}},v().map(((e,t)=>(0,s.jsx)("options",{key:t,value:e},e)))))))))}var I=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function n(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((s=s.apply(e,t||[])).next())}))};const x=u(62838);function L(e){const{runningQuery:t,intl:i,widgetId:u,layers:c=[],mapWidgetIds:g,portalUrl:d,attributeSets:h,lineAttributeSet:f,pointAttributeSet:y,theme:S,onLayersAdded:L,onLayerRemoved:w,onClearAll:j,onLayerChanged:D,onLayerOrderChanged:M,onMapWidgetedChanged:C,onAttributeSetsChanged:T,setRunningQuery:A}=e,R=s.React.useRef(null),[O,N]=s.React.useState(!1),[k,P]=s.React.useState(!1),[F,E]=s.React.useState(!1),[U,H]=s.React.useState(!1),[_,W]=s.React.useState(-1),[B,q]=s.React.useState(!1),z=s.hooks.useTranslation(r);let J=t;const Q=(e,t)=>I(this,void 0,void 0,(function*(){J=!0,A(!0);let i=!1;const a=e[t];let r=null;const n=s.SessionManager.getInstance().getSessionByUrl(d),l=n&&n.token?n.token:"";return r=l?{f:"json",token:l}:{f:"json"},i=yield(0,o.requestService)({method:"GET",url:a,params:r}).then((e=>{if(!e.hasOwnProperty("lrs"))return N(!0),setTimeout((()=>{N(!1)}),o.errorMessageDelay),!1;G(e,a),V(a)})).catch((e=>!1)),i})),G=(e,t)=>{const i=null==g?void 0:g[0],s=(0,o.getMapAllLayers)(i),a=[],r=[],n=[],l=[],u=[],p=[];s.forEach((e=>{p.push(e)})),e.networkLayers.forEach((e=>{p.findIndex((t=>t.layerId===e.id.toString()))>-1&&(n.push(e.id),r.push(e.id))})),e.eventLayers.forEach((e=>{p.findIndex((t=>t.layerId===e.id.toString()))>-1&&(l.push(e.id),r.push(e.id),"esriLRSPointEventLayer"!==e.type&&"esriLRSLinearEventLayer"!==e.type||u.push(e))})),s.forEach((e=>{var t,i;const s=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,n=null==e?void 0:e.getLayerDefinition(),o=-1===c.findIndex((t=>t.id===e.id)),l=r.findIndex((e=>e===n.id))>-1;s&&o&&l&&a.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id})})),0===c.length&&0===a.length?(N(!0),setTimeout((()=>{N(!1)}),o.errorMessageDelay)):0===n.length?(P(!0),setTimeout((()=>{P(!1)}),o.errorMessageDelay)):0===u.length?(E(!0),setTimeout((()=>{E(!1)}),o.errorMessageDelay)):a.length>0&&K(a,n,l)},K=(e,t,i)=>I(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const a=yield(()=>I(this,void 0,void 0,(function*(){let a=[];const r=[];return e.forEach((e=>{r.push(s.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,s.Immutable)(e)).then((r=>I(this,void 0,void 0,(function*(){const n=null==r?void 0:r.getLayerDefinition(),l=t.findIndex((e=>e===n.id))>-1,u=i.findIndex((e=>e===n.id))>-1,c=null==r?void 0:r.url,p=(0,o.getLrsRequestUrl)(c);let g="";l?g=p+"/networkLayers/"+n.id:u&&(g=p+"/eventLayers/"+n.id),g.length>0&&(yield $(r,e,g,p,l,u).then((e=>(e&&(a=a.concat([(0,s.Immutable)(e)])),a))))})))))})),yield Promise.all(r),a})))();L(a)})),$=(e,t,i,a,r,n)=>(0,o.getFeatureLayer)(e).then((l=>{const u=s.SessionManager.getInstance().getSessionByUrl(d),c=u&&u.token?u.token:"";let p=null;return p=c?{f:"json",token:c}:{f:"json"},new Promise(((u,c)=>{(0,o.requestService)({method:"POST",url:i,params:p}).then((c=>{c||u(null);const p=c.type;if("esriLRSNetworkLayer"===p||"esriLRSPointEventLayer"===p||"esriLRSLinearEventLayer"===p){let p={},g={};const d=null==e?void 0:e.getSchema(),h=c.id;let m=o.LrsLayerType.nonLrs;r&&!c.isDerived?(m=o.LrsLayerType.network,p=(0,o.getNetworkInfoFromResults)(c,i,d)):n&&(m=o.LrsLayerType.event,g=(0,o.getEventInfoFromResults)(c,i,d,l));const f=null==l?void 0:l.displayField,y={id:e.id,serviceId:h,name:e.getLabel(),originName:e.getLayerDefinition().name,lrsUrl:a,useDataSource:t,layerType:m,networkInfo:p||void 0,eventInfo:g||void 0,intersectionInfo:void 0,useFieldAlias:!0,displayField:f},S=(0,s.Immutable)(Object.assign({},y,{layerInfo:y}));u(S)}else u(null)}))}))})),V=e=>I(this,void 0,void 0,(function*(){(0,o.getAttributeSets)(e,d).then((e=>{T(e)})).catch((e=>!1))})),Y=s.React.useCallback((()=>{W(-1)}),[]),X=s.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${S.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${S.ref.palette.neutral[1e3]};
          font-size: ${s.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${S.ref.palette.neutral[800]};
        }
      }
    }
  `,Z={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:l.TreeItemActionType.RenderOverrideItem,children:[{name:l.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:l.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:l.TreeItemActionType.RenderOverrideItemBody,children:[{name:l.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:l.TreeItemActionType.RenderOverrideItemDragHandle},{name:l.TreeItemActionType.RenderOverrideItemTitle},{name:l.TreeItemActionType.RenderOverrideItemDetailToggle},{name:l.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,s.jsx)("div",{ref:R,css:X,className:(0,s.classNames)("d-flex flex-column",{"h-100":0===c.length})},(0,s.jsx)(n.SettingSection,{className:"border-0"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(n.SettingRow,{label:(0,o.formatMessage)(i,"selectMap")}),(0,s.jsx)(n.SettingRow,null,(0,s.jsx)(n.MapWidgetSelector,{onSelect:e=>{C(e)},useMapWidgetIds:g})),(0,s.jsx)(n.SettingRow,null,(0,s.jsx)(a.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:()=>{if(N(!1),H(!1),P(!1),q(!1),void 0===(null==g?void 0:g[0]))q(!0),setTimeout((()=>{q(!1)}),o.errorMessageDelay);else{const e=(0,o.getUniqueUrls)(null==g?void 0:g[0]);e.length>1?(H(!0),setTimeout((()=>{H(!1)}),o.errorMessageDelay)):e.length>0?J||Q(e,0):(N(!0),setTimeout((()=>{N(!1)}),o.errorMessageDelay))}},title:(0,o.formatMessage)(i,"loadLayers"),"aria-label":(0,o.formatMessage)(i,"loadLayers")},(0,o.formatMessage)(i,"loadLayers"))),c&&c.length>0&&(0,s.jsx)(n.SettingRow,null,(0,s.jsx)(a.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:j,title:(0,o.formatMessage)(i,"clearLayers"),"aria-label":(0,o.formatMessage)(i,"clearLayers")},(0,o.formatMessage)(i,"clearLayers"))),O&&(0,s.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(m,{color:S.sys.color.error.main}),(0,s.jsx)("div",{className:"display-error-tips"},(0,o.formatMessage)(i,"noLrsLayersTips")))),B&&(0,s.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(m,{color:S.sys.color.error.main}),(0,s.jsx)("div",{className:"display-error-tips"},(0,o.formatMessage)(i,"noMapSelectedTips")))),k&&(0,s.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(m,{color:S.sys.color.error.main}),(0,s.jsx)("div",{className:"display-error-tips"},(0,o.formatMessage)(i,"noNetworkLayersTips")))),F&&(0,s.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(m,{color:S.sys.color.error.main}),(0,s.jsx)("div",{className:"display-error-tips"},z("noEventLayersTips")))),U&&(0,s.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,s.jsx)(p.Fragment,null,(0,s.jsx)(m,{color:S.sys.color.error.main}),(0,s.jsx)("div",{className:"display-error-tips"},(0,o.formatMessage)(i,"multipleServicesTips")))))),(0,s.jsx)(n.SettingSection,{className:(0,s.classNames)("pt-0 border-0",{"h-100":0===c.length})},(0,s.jsx)(n.SettingRow,null,(0,s.jsx)("div",{className:"setting-ui-unit-list w-100"},(0,s.jsx)(l.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:c.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:_===t,itemStateTitle:e.name,itemStateCommands:[{label:(0,o.formatMessage)(i,"removeLayer"),iconProps:()=>({icon:x,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,i=+t.itemKey;i===_&&Y(),w(i)}}]}))),renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:r}=t.props,[n]=r;return(0,o.isParentNetworkAvailable)(+n.itemKey,c)?"":(0,s.jsx)(a.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:(0,o.formatMessage)(i,"missingParentNetwork")})},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,s]=i;M(s.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;var s;s=+i.itemKey,W(s===_?-1:s)}},Z)),c.length===_&&(0,s.jsx)(l.List,Object.assign({className:"setting-ui-unit-list-new",css:s.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${_}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},Z)))),0===c.length&&(0,s.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,s.jsx)("div",{className:"empty-placeholder-inner"},(0,s.jsx)("div",{className:"empty-placeholder-icon"},(0,s.jsx)(v,{size:48})),(0,s.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:z("blankStatus")}}))),(0,s.jsx)(n.SidePopper,{isOpen:_>=0&&!s.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:Y,position:"right",trigger:null==R?void 0:R.current,title:z("layerConfig")},(0,s.jsx)(b,{widgetId:u,index:_,total:c.length,lrsLayer:c[_],attributeSets:h,lineAttributeSet:f,pointAttributeSet:y,onLayerChanged:D}))))}var w=u(54337),j=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function n(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((s=s.apply(e,t||[])).next())}))};let D;class M extends s.React.PureComponent{constructor(e){super(e),this.updateWidgetJson=(...e)=>{const[t,...i]=e,s=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(s,...i)},this.updateConfigForOptions=(...e)=>j(this,void 0,void 0,(function*(){let t=null,i=e.reduce(((e,[i,s,a])=>("lrsLayers"===i&&(null==a?void 0:a.dsUpdateRequired)&&(t=this.getAllDataSources(s)),e.set(i,s))),this.props.config);const s=i.lrsLayers.find((e=>e.layerType===o.LrsLayerType.network));if((0,o.isDefined)(s)){const e=yield(0,o.isConflictPreventionEnabled)(s.lrsUrl);i=i.setIn(["conflictPreventionEnabled"],e)}t?this.updateWidgetJson({config:i,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:i})})),this.getAllDataSources=e=>(0,s.Immutable)(e).asMutable({deep:!0}).reduce(((e,t)=>{const i=t.useDataSource,s=i.dataSourceId;e.useDataSourceMap[s]=e.useDataSourceMap[s]||i,e.useDataSourceMap[s].fields=i.fields;const a=this.props.id+"_point_output",r=this.props.id+"_line_output",n=this.getI18nMessage("pointOutputLabel"),o=this.getI18nMessage("lineOutputLabel");if(0===e.outputDataSources.length){const t=this.createInitOutputDataSource(a,n,"esriGeometryPoint"),i=this.createInitOutputDataSource(r,o,"esriGeometryPolyline");e.outputDataSources.push(t),e.outputDataSources.push(i)}return e}),{useDataSourceMap:{},outputDataSources:[]}),this.createInitOutputDataSource=(e,t,i)=>{const a=this.getInitSchema(t),r=e+"__layer";return{id:e,type:s.DataSourceTypes.FeatureLayer,label:t,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:a,geometryType:i,layerId:r}},this.getInitSchema=(e="")=>({label:e,idField:n.ObjectIdSchema.jimuName,fields:{[n.ObjectIdSchema.jimuName]:n.ObjectIdSchema}}),this.addLayers=(e,t=!0)=>{var i,a,r;let n=null!==(i=this.props.config.lrsLayers)&&void 0!==i?i:(0,s.Immutable)([]),o=null!==(r=null===(a=this.props.config.lrsLayers)||void 0===a?void 0:a.length)&&void 0!==r?r:0;e.forEach((e=>{n=s.Immutable.set(n,o,e),o++})),this.updateConfigForOptions(["lrsLayers",n,{dsUpdateRequired:t}])},this.updateLayerItem=(e,t,i=!1)=>{var a;let r=null!==(a=this.props.config.lrsLayers)&&void 0!==a?a:(0,s.Immutable)([]);r=s.Immutable.set(r,e,t),this.updateConfigForOptions(["lrsLayers",r,{dsUpdateRequired:i}])},this.reOrderLayers=e=>{this.updateConfigForOptions(["lrsLayers",e])},this.removeAllLayers=(e=!1)=>{this.setRunningQuery(!1);const t={dsUpdateRequired:e};this.updateConfigForOptions(["lrsLayers",[],t])},this.removeLayer=(e,t=!1)=>{const i={dsUpdateRequired:t},s=this.props.config.lrsLayers.asMutable({deep:!0});s.splice(e,1),this.updateConfigForOptions(["lrsLayers",s,i])},this.setDisplayType=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultDisplayType",e)})},this.setAttributeInputType=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("attributeInputType",e)})},this.updateAttributeSets=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("attributeSets",e)})},this.setDefaultAttributeSet=(e,t)=>{t?this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultPointAttributeSet",e)}):this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultLineAttributeSet",e)})},this.setTableHighlight=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("tableHighlightColor",e)})},this.setAllowMerge=e=>{const t=e.target.checked;this.props.onSettingChange({id:this.props.id,config:this.props.config.set("allowMerge",t)})},this.setMapHighlightColor=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("mapHighlightColor",e)})},this.setDefaultScale=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultDiagramScale",e)})},this.setShowStatistics=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("showEventStatistics",e)})},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.getI18nMessage=(e,t)=>{const i=Object.assign({},r,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.getNetworkDefaultScale=e=>{switch(e){case"esriInches":return 190080;case"esriFeet":case"esriIntFeet":return 15840;case"esriYards":return 5280;case"esriMiles":case"esriDecimalDegrees":default:return 3;case"esriNauticalMiles":return 2.6;case"esriMillimeters":return 4828e3;case"esriCentimeters":return 482800;case"esriDecimeters":return 48280;case"esriMeters":return 4828;case"esriKilometers":return 4.828}},this.setRunningQuery=e=>{D=e},this.state={}}componentDidMount(){D=!1}getDisplayType(){return this.props.config.defaultDisplayType}getAttributeInputType(){return this.props.config.attributeInputType}getDefaultAttributeSet(e){var t,i,s,a,r,n,o,l;if(e){if(this.props.config.defaultPointAttributeSet)return this.props.config.defaultPointAttributeSet;if((null===(i=null===(t=this.props.config.attributeSets)||void 0===t?void 0:t.attributeSet)||void 0===i?void 0:i.length)>0){const e=null===(a=null===(s=this.props.config.attributeSets)||void 0===s?void 0:s.attributeSet)||void 0===a?void 0:a.find((e=>e.isPoint));return this.setDefaultAttributeSet(e.title,!0),null==e?void 0:e.title}return""}if(this.props.config.defaultLineAttributeSet)return this.props.config.defaultLineAttributeSet;if((null===(n=null===(r=this.props.config.attributeSets)||void 0===r?void 0:r.attributeSet)||void 0===n?void 0:n.length)>0){const e=null===(l=null===(o=this.props.config.attributeSets)||void 0===o?void 0:o.attributeSet)||void 0===l?void 0:l.find((e=>!e.isPoint));return this.setDefaultAttributeSet(e.title,!1),null==e?void 0:e.title}return""}getTableHighlightColor(){if(this.props.config.tableHighlightColor)return this.props.config.tableHighlightColor;{const e=o.highlightColor;return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("tableHighlightColor",e)}),e}}getMapHighlightColor(){if(this.props.config.mapHighlightColor)return this.props.config.mapHighlightColor;{const e=o.highlightColor;return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("mapHighlightColor",e)}),e}}getDefaultScale(){var e,t;if(this.props.config.defaultDiagramScale)return this.props.config.defaultDiagramScale;{const i=null===(t=null===(e=this.props.config.lrsLayers.find((e=>e.layerType===o.LrsLayerType.network)))||void 0===e?void 0:e.networkInfo)||void 0===t?void 0:t.unitsOfMeasure,s=this.getNetworkDefaultScale(i);return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultDiagramScale",s)}),s}}getShowStatistics(){return this.props.config.showEventStatistics?this.props.config.showEventStatistics:(this.setShowStatistics(!1),!1)}render(){var i,r,l,u;const{config:c}=this.props,p=null===(r=null===(i=this.props.config.attributeSets)||void 0===i?void 0:i.attributeSet)||void 0===r?void 0:r.filter((e=>!e.isPoint)),g=null===(u=null===(l=this.props.config.attributeSets)||void 0===l?void 0:l.attributeSet)||void 0===u?void 0:u.filter((e=>e.isPoint));return(0,s.jsx)("div",{className:"setting-dyn-seg h-100"},(0,s.jsx)("div",{className:"jimu-widget-setting setting-dyn-seg__setting-content h-100"},(0,s.jsx)(L,{runningQuery:D,setRunningQuery:this.setRunningQuery,intl:this.props.intl,widgetId:this.props.id,layers:this.props.config.lrsLayers,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,attributeSets:this.props.config.attributeSets,lineAttributeSet:this.getDefaultAttributeSet(!1),pointAttributeSet:this.getDefaultAttributeSet(!0),theme:this.props.theme,onLayersAdded:this.addLayers,onClearAll:this.removeAllLayers,onLayerRemoved:this.removeLayer,onLayerChanged:this.updateLayerItem,onLayerOrderChanged:this.reOrderLayers,onMapWidgetedChanged:this.mapWidgetIdUpdated,onAttributeSetsChanged:this.updateAttributeSets}),c.lrsLayers&&0!==c.lrsLayers.length&&(0,s.jsx)(n.SettingSection,{role:"group",title:this.getI18nMessage("defaultSettings"),"aria-label":this.getI18nMessage("defaultSettings")},(0,s.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultDynSegResult")},(0,s.jsx)(a.Select,{"aria-label":this.getI18nMessage("defaultDynSegResult"),className:"w-100",size:"sm",value:this.getDisplayType(),onChange:e=>{this.setDisplayType(e.target.value)}},(0,s.jsx)("options",{value:e.Table},this.getI18nMessage("tableLabel")),(0,s.jsx)("options",{value:e.Diagram},this.getI18nMessage("diagramLabel")))),(0,s.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultAttributeSetType")},(0,s.jsx)(a.Select,{"aria-label":this.getI18nMessage("defaultAttributeSetType"),className:"w-100",size:"sm",value:this.getAttributeInputType(),onChange:e=>{this.setAttributeInputType(e.target.value)}},(0,s.jsx)("options",{value:t.LineOnly},this.getI18nMessage("lineOnlyLabel")),(0,s.jsx)("options",{value:t.LineAndPoint},this.getI18nMessage("lineAndPointLabel")))),(0,o.isDefined)(p)&&p.length>0&&(0,s.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("lineAttributeSet")},(0,s.jsx)(a.Select,{"aria-label":this.getI18nMessage("lineAttributeSet"),className:"w-100",size:"sm",value:this.getDefaultAttributeSet(!1),onChange:e=>{this.setDefaultAttributeSet(e.target.value,!1)}},p.map(((e,t)=>(0,s.jsx)("options",{key:t,value:e.title},e.title))))),c.attributeInputType===t.LineAndPoint&&(0,o.isDefined)(g)&&g.length>0&&(0,s.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("pointAttributeSet")},(0,s.jsx)(a.Select,{"aria-label":this.getI18nMessage("pointAttributeSet"),className:"w-100",size:"sm",value:this.getDefaultAttributeSet(!0),onChange:e=>{this.setDefaultAttributeSet(e.target.value,!0)}},g.map(((e,t)=>(0,s.jsx)("options",{key:t,value:e.title},e.title))))),(0,o.isDefined)(p)&&p.length>0&&(0,s.jsx)(n.SettingRow,{label:this.getI18nMessage("mergeEvents")},(0,s.jsx)(a.Switch,{checked:this.props.config.allowMerge,onChange:this.setAllowMerge,title:this.getI18nMessage("mergeEvents"),"aria-label":this.getI18nMessage("mergeEvents")})),(0,s.jsx)(n.SettingRow,{label:this.getI18nMessage("tableHighlightColor")},(0,s.jsx)(w.ColorPicker,{color:this.props.config.tableHighlightColor?this.props.config.tableHighlightColor:o.highlightColor,value:this.getTableHighlightColor()||this.props.theme2.sys.color.surface.paper||"",onChange:this.setTableHighlight,"aria-label":this.getI18nMessage("tableHighlightColor")})),(0,s.jsx)(n.SettingRow,{label:this.getI18nMessage("mapHighlightColor")},(0,s.jsx)(w.ColorPicker,{color:this.props.config.mapHighlightColor?this.props.config.mapHighlightColor:o.highlightColor,value:this.getMapHighlightColor()||this.props.theme2.sys.color.surface.paper||"",onChange:this.setMapHighlightColor,"aria-label":this.getI18nMessage("mapHighlightColor")})),(0,s.jsx)(n.SettingRow,{flow:"wrap",label:this.getI18nMessage("diagramScale")},(0,s.jsx)(a.NumericInput,{className:"w-100",value:this.getDefaultScale(),onChange:this.setDefaultScale,"aria-label":this.getI18nMessage("diagramScale")})),(0,s.jsx)(n.SettingRow,{flow:"no-wrap",label:this.getI18nMessage("showStatistics")},(0,s.jsx)(a.Switch,{"aria-label":this.getI18nMessage("showStatistics"),checked:this.getShowStatistics(),onChange:e=>{this.setShowStatistics(e.target.checked)}})))))}}function C(e){u.p=e}})(),c})())}}}));