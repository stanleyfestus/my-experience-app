"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_common_feature-report_node_modules_arcgis-survey123_feature-report-08dfc7"],{402:(e,t,i)=>{i.r(t),i.d(t,{features_preview:()=>c,report_generator:()=>h,report_settings:()=>d,task_list:()=>u,template_chooser:()=>m});var s=i(183),r=i(312),o=i(500),a=i(543),l=i(129);const n=e=>{const{folderId:t,start:i=1,num:s=10,authentication:r}=e,o=t?`/${t}`:"";return function(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}(e).then((t=>`${(0,a.d)(e)}/content/users/${t}${o}`)).then((e=>(0,a.r)(e,{httpMethod:"GET",authentication:r,params:{start:i,num:s}})))},c=class{constructor(e){(0,s.r)(this,e),this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.stateService=l.S.getService(),this.queryParameters=void 0,this.inputFeatureTemplate=void 0,this.featureCount=0,this.featureStr="",this.translator=void 0,this.reportLang=void 0,this.commonLang=void 0}componentWillLoad(){return this.stateService.subscribe("update-features-preview",(e=>{void 0!==e&&(this.inputFeatureTemplate=e),this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.init()})),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();this.translator=e,this.initTranslateData(e),this.stateService.subscribe("locale-data-changed",(e=>{this.initTranslateData(e)}))})).catch((e=>{this.reportService.showError(e)}))}initTranslateData(e){this.translator=e,this.commonLang=null==e?void 0:e.common,this.reportLang=null==e?void 0:e.customPrint}init(){let e=[];return this.getDisplayFields().then((t=>{e=t;let i=[];i=e;const s=JSON.parse(this.queryParameters);let a=10;s.resultRecordCount<10&&(a=s.resultRecordCount),s.orderByFields&&(s.orderByFields=s.orderByFields.replace("||",""));const l=Object.assign({url:r.P.featureLayerUrl,authentication:r.P.token,outFields:i,resultRecordCount:a},s),n="where"in l?l.where:null,c="objectIds"in l?l.objectIds:null,h={};return null!==n&&(h.where=n),null!=c&&(h.objectIds=c),c||n||(h.where="1<>1",delete h.objectIds),l.params=h,delete l.where,delete l.objectIds,(0,o.q)(l)})).then((t=>{if(0===this.featureCount)return this.featureStr=this.commonLang.noResults,!0;const i=t.fields||[],s={};i.forEach((e=>{s[e.name]=e}));const r=this.featureCount>10?10:this.featureCount,o=t.features.splice(0,r);return this.featureStr=o.map((t=>{let i=this.inputFeatureTemplate;return e.forEach((e=>{const r=this.utilService.formatFieldVal(s[e],t.attributes[e]);i=i.replace(`{${e}}`,r)})),i})).join("<br>"),this.featureCount>10&&(this.featureStr+=`<br>...(${this.utilService.formatNumber(this.featureCount-10)} ${this.commonLang.more||"more"})`),!0})).catch((e=>{this.reportService.showError(e)}))}getDisplayFields(){let e=[];return this.reportService.getLayerJson().then((t=>{if(this.inputFeatureTemplate){const i=t.fields||[];return(this.inputFeatureTemplate.match(/\{.*?\}/g)||[]).forEach((t=>{const s=t.substring(1,t.length-1),r=i.find((e=>e.name===s));e.indexOf(s)<0&&r&&e.push(s)})),e.length||(e=[t.objectIdField||"objectid"]),e}if(t.displayField)this.inputFeatureTemplate="{"+t.displayField+"}",e=[t.displayField];else{const i=t.fields||[],s=Object.keys(t.editFieldsInfo||{}).map((e=>t.editFieldsInfo[e])).concat([t.objectIdField||"",t.globalIdField||""]),r=i.find((e=>!s.includes(e.name)&&"esriFieldTypeString"===e.type)),o=i.find((e=>!s.includes(e.name)&&this.utilService.isNumberField(e))),a=i.find((e=>!s.includes(e.name)&&!this.utilService.isNumberField(e)&&"esriFieldTypeString"!==e.type)),l=r||o||a||i[0];l&&(this.inputFeatureTemplate="{"+l.name+"}",e=[l.name])}return e}))}render(){var e,t;return(0,s.h)(s.H,{key:"f2c77b92f32d439574043b1746bf8b4f36df78e9"},(0,s.h)("div",{key:"250a3421f00f699028066cddbb133be62f3df570"},(0,s.h)("div",{key:"4e2c1ac52c1bd185cfba5df6ab87155a3762615c",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.inputFeatures," (",this.featureCount,")"),(0,s.h)("div",{key:"ad8ebea8558d0ec9d5e25b3b97ee2b3e070b6d11",innerHTML:this.featureStr})),(0,s.h)("slot",{key:"4346d0030a306b4ae30ec8b808667147e0ffc080"}))}};c.style=":host{display:block;min-height:200;padding:0 0.75rem;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2)}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}";const h=class{constructor(e){(0,s.r)(this,e),this.reportCreated=(0,s.c)(this,"reportCreated",7),this.batchPrintLimitCount=2e3,this.checkingList=[],this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.state=l.S.getService(),this.featureCount=void 0,this.supportShowCredits=!0,this.printTemplates=[],this.langObj=void 0,this.creditsInfo=void 0,this.creditStatus=void 0,this.testModeJobObj=void 0,this.isTestModePrinting=void 0,this.visibleConf=void 0,this.templateItemId=void 0,this.isPrinting=void 0,this.translator=void 0}componentWillLoad(){return this.checkPrivilige(),this.printTemplates=this.reportService.getHelperObj("printTemplates")||[],this.state.subscribe("print-templates-updated",(e=>{this.printTemplates=e||[]})),this.state.subscribe("portal-info-update",(()=>{this.checkPrivilige()})),this.state.subscribe("feature-count-updated",(()=>{this.checkPrivilige()})),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();this.translator=e,this.state.subscribe("locale-data-changed",(e=>{this.translator=e}))}))}checkPrivilige(){this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.isPortal=this.utilService.isPortal;const e=this.utilService.supportFeatureReport(),t=this.utilService.isUserCanPrintFeatureReport();this.canShowEstimateCredits=!!e&&t,this.supportShowCredits=!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits}estimateCredits(){if(!(this.featureCount>this.batchPrintLimitCount)&&!(this.featureCount<1)&&this.printTemplates&&this.printTemplates.length&&(!this.creditsInfo||"estimating"!==this.creditStatus)){const e=this.reportService.getParamCache().templateItemId||r.P.templateItemId,t={queryParameters:r.P.queryParameters,featureLayerUrl:r.P.featureLayerUrl,templateItemId:e,surveyItemId:r.P.surveyItemId};this.creditStatus="estimating",this.creditsInfo=this.creditsInfo||{},this.reportService.estimateReportCosts(t).then((t=>{if(!t.resultInfo)throw t.error;this.creditsInfo=t.resultInfo,this.creditStatus="finished",this.creditsInfo.lastCalculatedCount=this.featureCount,this.creditsInfo.lastSelectedTemplateId=e})).catch((e=>{this.reportService.showError(e),this.creditStatus="changed"}))}}buttonClickable(){return!!this.templateItemId||!(!this.printTemplates||!this.printTemplates.length)}executeCustomPrint(e){var t;const i=this.reportService.getParamCache();if(e&&this.isTestModePrinting)return;if(this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.featureCount<1)return void this.reportService.showError({},{errorStr:null===(t=this.translator)||void 0===t?void 0:t.common.noResults});if(e?this.isTestModePrinting=!0:this.isPrinting=!0,e){const e={queryParameters:r.P.queryParameters,templateItemId:i.templateItemId||r.P.templateItemId,surveyItemId:r.P.surveyItemId,featureLayerUrl:r.P.featureLayerUrl,outputReportName:i.outputPackageName||r.P.outputPackageName||i.outputReportName||r.P.outputReportName||""};if(e.outputReportName){const t=this.utilService.extractPlaceholders(e.outputReportName);t&&t.length||(e.outputPackageName=e.outputReportName)}const t=i.mergeFiles||r.P.mergeFiles;return t&&"none"!==t&&(e.mergeFiles=t),this.reportService.createSampleReport(e).then((e=>{var t,i;e&&e.success?(this.testModeJobObj=e,this.watchTestModeJob()):(this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1}))}let s=i.outputPackageName||r.P.outputPackageName||i.outputReportName||r.P.outputReportName||"";return s.length>250&&(s=s.substr(0,250)),Promise.resolve().then((()=>{let e=null;e=i.uploadInfo||r.P.uploadInfo||{type:"arcgis",parameters:{},conflictBehavior:"rename"};const t=r.P.packageFiles+""=="true"||r.P.packageFiles+""!="false"&&"auto",o={queryParameters:r.P.queryParameters,templateItemId:i.templateItemId||r.P.templateItemId,outputReportName:s||"",featureLayerUrl:r.P.featureLayerUrl,uploadInfo:JSON.stringify(e),packageFiles:t};r.P.surveyItemId&&(o.surveyItemId=i.surveyItemId||r.P.surveyItemId),(i.outputFormat||r.P.outputFormat)&&(o.outputFormat=i.outputFormat||r.P.outputFormat),r.P.webmapItemId&&(o.webmapItemId=r.P.webmapItemId),(Number(r.P.mapScale)||0===Number(r.P.mapScale))&&(o.mapScale=Number(r.P.mapScale)),r.P.locale&&(o.locale="||"+r.P.locale),r.P.utcOffset&&(o.utcOffset=r.P.utcOffset);const a=i.outputPackageName||r.P.outputPackageName;a&&(o.outputPackageName=a);const l=i.mergeFiles||r.P.mergeFiles;l&&"none"!==l&&(o.mergeFiles=l);!1===this.reportService.getHelperObj().canCreateItem&&delete o.uploadInfo;let n=null;this.reportService.executeReport(o).then((e=>{var t,i;if(e&&e.success)return n=e.jobId,this.reportService.checkJobStatus(n);this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error.message}),this.isPrinting=!1})).then((()=>{this.queryJobTimmer&&clearTimeout(this.queryJobTimmer),this.queryJobTimmer=setTimeout((()=>{this.reportService.queryJobs(!0).then((e=>{this.checkingList.push(n),this.reportCreated.emit({jobId:n,checkingList:this.checkingList,jobs:(null==e?void 0:e.jobs)||[]}),this.isPrinting=!1}))}),100)})).catch((e=>{var t,i;const s=this.reportService.getErrorStr(e);this.reportService.showError(e,{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:s}),this.isPrinting=!1}))}))}watchTestModeJob(){if(!this.testModeJobObj)return;const e=this.testModeJobObj.jobId,t=()=>this.reportService.checkJobStatus(e).then((e=>{var i,s;if(this.testModeJobObj=e,"esriJobSucceeded"===e.jobStatus||"esriJobPartialSucceeded"===e.jobStatus)return this.reportService.downloadFile(e),this.isTestModePrinting=!1,"esriJobPartialSucceeded"===e.jobStatus&&this.reportService.showError({},{alertType:"warning",errorStr:null===(s=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===s?void 0:s.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),!0;if("esriJobFailed"===this.testModeJobObj.jobStatus)throw this.isTestModePrinting=!1,e;if(e.error)throw e.error;setTimeout((()=>{t()}),1500)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),this.isTestModePrinting=!1}));t()}render(){var e,t,i,r,o,a,l,n,c,h,d,u,m,p,v;return(0,s.h)(s.H,{key:"aca32173e6e0e969c0321fdd6dc10145da134760"},(0,s.h)("p",{key:"2a893d489dfe3a83bb27a2fe590621223025894d"},this.supportShowCredits),this.supportShowCredits&&this.visibleConf.indexOf("showCredits")>=0?(0,s.h)("div",{class:"credits-info"},(0,s.h)("div",{class:"show-credits has-spinner"},this.creditsInfo&&"estimating"===this.creditStatus?(0,s.h)(s.F,null,(0,s.h)("span",{class:""+(this.featureCount<1||!this.printTemplates.length?"disabled":""),onClick:()=>this.estimateCredits()},`${null===(e=this.translator)||void 0===e?void 0:e.common.calculating}`),(0,s.h)("calcite-loader",{label:null===(t=this.translator)||void 0===t?void 0:t.common.calculating,inline:"true"})):(0,s.h)("calcite-link",{disabled:`${this.featureCount<1||!this.printTemplates.length}`,onClick:()=>this.estimateCredits()},`${null===(r=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===r?void 0:r.creditsEstimate}`)),this.creditsInfo&&"finished"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,s.h)("div",{class:"credits-result-info"},(0,s.h)("span",null,null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.creditsRecordsCount.replace("${$recordsCount}",`${this.featureCount}`).replace("${$requiredCredits}",`${this.creditsInfo.cost}`))):"",this.creditsInfo&&"changed"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,s.h)("div",{class:"credits-result-info"},(0,s.h)("span",null,null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.credtisResultInvalid)):""):"",(0,s.h)("div",{key:"bc95469bad71ab752a604a34b258471f73992a8f",class:"execute-btn "+(!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits?"":"portal-btn")},(0,s.h)("a",{key:"cdc19e375ccf3d035b72706b70ba771b185e9706",class:"no-hover"},(0,s.h)("calcite-button",{key:"32ec0cfa2757e0d8124ba0c9703d90f2d1850e62",id:"submit-btn",disabled:this.isPrinting||!this.buttonClickable(),onClick:()=>this.executeCustomPrint()},null===(h=null===(c=this.translator)||void 0===c?void 0:c.customPrint)||void 0===h?void 0:h.generate,this.isPrinting?(0,s.h)("calcite-loader",{label:null===(u=null===(d=this.translator)||void 0===d?void 0:d.common)||void 0===u?void 0:u.loading,inline:"true"}):null),(this.printTemplates||[]).length>0||this.templateItemId||(null===(m=this.visibleConf)||void 0===m?void 0:m.indexOf("selectTemplate"))>=0?null:(0,s.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,s.h)("div",{slot:"message"},null===(v=null===(p=this.translator)||void 0===p?void 0:p.customPrint)||void 0===v?void 0:v.chooseTemplateNoOneYet1)))),(0,s.h)("slot",{key:"5ff5f48aaf6df90e383672eb15e850a46a867f48"}))}};h.style=":host{padding:0 0.75rem;display:block}:host .clickable-text{cursor:pointer;font-weight:normal}:host calcite-notice{margin-top:6px}:host .credits-info{margin:10px 0 10px 0;padding:10px 0;background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-2);display:flex;justify-content:space-between}:host .credits-info>div{margin:0px 10px}:host .credits-info .show-credits{display:inline-flex;align-items:center}:host .credits-info .show-credits survey123-ui-spinner{line-height:0}:host .credits-info .show-credits ::ng-deep span{line-height:0}:host .credits-info .show-credits .icon-spin.icon-refresh{top:1px}:host .credits-info .show-credits .spinner{-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none}:host .credits-info .show-credits span:not(.clickable-text){cursor:default}:host .credits-info .show-credits span.clickable-text.disabled{cursor:not-allowed}:host .credits-info .credits-result-info{flex-grow:1;display:flex;justify-content:flex-end}:host .credits-info .credits-result-info span{word-break:break-word}:host .pieview-info{margin-top:10px;margin-bottom:20px}:host .pieview-info .has-spinner>span{cursor:default}:host .pieview-info .has-spinner>span.report-status{padding:0 2px}:host .pieview-info .preview-text{cursor:default;display:flex;align-items:center}:host .pieview-info .preview-text>span{cursor:pointer}:host .pieview-info .preview-text.disabled{text-decoration:underline solid #979797;color:#979797;cursor:not-allowed}:host .pieview-info .preview-text.disabled>span{cursor:not-allowed}:host .execute-btn{overflow:auto;margin:-5px 0 30px 0}:host .execute-btn>span{line-height:41px}:host .execute-btn a{float:inline-start}:host .execute-btn a button{width:auto}:host .execute-btn.portal-btn{margin:20px 0}:host calcite-loader{display:inline-block;margin:0 0 0 10px}";const d=class{constructor(e){(0,s.r)(this,e),this.fileOptionChange=(0,s.c)(this,"fileOptionChange",7),this.fileNameChange=(0,s.c)(this,"fileNameChange",7),this.selectedFolderChange=(0,s.c)(this,"selectedFolderChange",7),this.selectedFileFormatChange=(0,s.c)(this,"selectedFileFormatChange",7),this.reportService=o.R.getService(),this.state=l.S.getService(),this.mergeFiles=void 0,this.outputFormat="word",this.conflictBehavior="rename",this.fileName=void 0,this.visibleElems=[],this.translator=void 0,this.langReport=void 0,this.helperObj=void 0,this.featureCount=void 0,this.printTemplates=[]}onFileNameChange(){this.fileNameChangeHandler({target:{value:this.fileName}})}componentWillLoad(){return Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();return this.translator=e,this.langReport=null==e?void 0:e.customPrint,this.state.subscribe("locale-data-changed",(e=>{this.translator=e,this.langReport=null==e?void 0:e.customPrint})),this.printTemplates=this.reportService.getHelperObj("printTemplates")||[],this.state.subscribe("print-templates-updated",(e=>{this.printTemplates=e||[]})),this.helperObj=this.reportService.getHelperObj(),this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.state.subscribe("portal-info-update",(()=>{this.featureCount=this.reportService.getHelperObj("featureCount")||0})),this.state.subscribe("feature-count-updated",(()=>{this.featureCount=this.reportService.getHelperObj("featureCount")||0})),this.getUserFolders()})).catch((e=>{this.reportService.showError(e)}))}fileOptChangeHandler(e){const t=this.reportService.getParamCache();"split"!==e.detail?t.mergeFiles=e.detail:delete t.mergeFiles,this.fileOptionChange.emit(e.detail)}fileNameChangeHandler(e){this.fileName=e.target.value;const t=this.fileName;if(t){const e=this.extractPlaceholders(t);e&&e.length||this.reportService.setParamCache({outputPackageName:t})}this.reportService.setParamCache({outputReportName:t}),this.fileNameChange.emit(this.fileName)}selectedFolderChangeHandler(){const e=this.reportService.getParamCache("uploadInfo")||{type:"arcgis",parameters:{},conflictBehavior:"rename"};e.parameters.folderId="all"===this.selectedFolder.id?"":this.selectedFolder.id,this.reportService.setParamCache({uploadInfo:e}),this.selectedFolderChange.emit(this.selectedFolder)}outputFormatChangeHandler(e){this.outputFormat=e.target.value,this.reportService.setParamCache({outputFormat:this.outputFormat}),this.selectedFileFormatChange.emit(this.outputFormat)}getUserFolders(){var e,t;const i=a.U.getService(),s=null===(e=i.getUser())||void 0===e?void 0:e.username,r=null===(t=this.langReport)||void 0===t?void 0:t.saveToAGOFolderRoot.replace("${$username}",s),o=Object.assign({owner:s},i.getBaseRequestOptions());return n(o).then((e=>{this.folders=[];const t=[];return t.push({username:s,id:"all",value:"all",title:r,label:r,created:null}),e&&e.folders&&e.folders.length?(e.folders.forEach((e=>{e.label=e.title,e.value=e.id})),this.folders=t.concat(e.folders)):this.folders=t,this.selectedFolder=this.folders[0],this.folders}))}extractPlaceholders(e){const t=(e=e||"").match(/\$[^{$]*?{[^}]*?.*?}/g),i=[];return t&&t.forEach((e=>{-1===i.indexOf(e)&&i.push(e)})),i}changeConflictBehavior(e){this.conflictBehavior=e.target.value;const t=this.reportService.getParamCache("uploadInfo")||{type:"arcgis",parameters:{},conflictBehavior:"rename"};t.conflictBehavior=this.conflictBehavior,this.reportService.setParamCache({uploadInfo:t})}render(){var e,t,i,r,o,a,l,n,c,h,d,u,m,p,v,g,f,b,C,S,P,I,k,T,y,x,w,F,j,O;return(0,s.h)(s.H,{key:"f7533ed880148f57d8d02b32f1c098b7a50aaf0c"},(0,s.h)("div",{key:"2a9949c62bbb802797eb7f959769290f665d5d58",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.resultSettingsLabel1),this.visibleElems.indexOf("fileOptions")<0?null:(0,s.h)("file-option-chooser",{fileOption:this.mergeFiles,onFileOptionChange:e=>{this.fileOptChangeHandler(e)}}),this.visibleElems.indexOf("reportName")<0?null:(0,s.h)("calcite-label",null,null===(r=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===r?void 0:r.saveToAGOItemName,(0,s.h)("calcite-input-text",{placeholder:null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.saveToAGOItemName,value:this.fileName,onCalciteInputTextChange:e=>this.fileNameChangeHandler(e)})),this.visibleElems.indexOf("saveToAGSAccount")<0?null:(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"folder-label"},(0,s.h)("span",null,null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.saveToAGOFolder),(0,s.h)("calcite-dropdown",{width:"l",scale:"m","close-on-select-disabled":!0,type:"click","width-scale":"l"},(0,s.h)("calcite-button",{slot:"trigger","icon-start":"gear",appearance:"transparent"}),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("div",{class:"conflict-name-setting"},(0,s.h)("calcite-radio-button-group",{name:"conflict-name-options",layout:"vertical"},(0,s.h)("calcite-label",{layout:"inline"},null===(h=null===(c=this.translator)||void 0===c?void 0:c.customPrint)||void 0===h?void 0:h.nameConflictOptLabel,(0,s.h)("calcite-icon",{id:"info-icon",icon:"question",scale:"s"}," "),(0,s.h)("calcite-tooltip",{label:null===(u=null===(d=this.translator)||void 0===d?void 0:d.customPrint)||void 0===u?void 0:u.nameConflictOptLabel,"reference-element":"info-icon"},(0,s.h)("span",null,null===(p=null===(m=this.translator)||void 0===m?void 0:m.customPrint)||void 0===p?void 0:p.nameConflictOptLabel))),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{value:"rename",checked:"rename"==this.conflictBehavior,onCalciteRadioButtonChange:e=>this.changeConflictBehavior(e)}),null===(g=null===(v=this.translator)||void 0===v?void 0:v.customPrint)||void 0===g?void 0:g.nameConflictOptRename),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{value:"replace",checked:"replace"==this.conflictBehavior,onCalciteRadioButtonChange:e=>this.changeConflictBehavior(e)}),null===(b=null===(f=this.translator)||void 0===f?void 0:f.customPrint)||void 0===b?void 0:b.nameConflictOptReplace),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{value:"fail",checked:"fail"==this.conflictBehavior,onCalciteRadioButtonChange:e=>this.changeConflictBehavior(e)}),null===(S=null===(C=this.translator)||void 0===C?void 0:C.customPrint)||void 0===S?void 0:S.nameConflictOptSkip)))))),(0,s.h)("calcite-tooltip",{label:!1===this.helperObj.canCreateItem?this.langReport.saveToAGONoCreatePrivilegeTip:"","reference-element":"folder-selector"},(0,s.h)("span",null,!1===this.helperObj.canCreateItem?this.langReport.saveToAGONoCreatePrivilegeTip:"")),(0,s.h)("calcite-combobox",{id:"folder-selector",disabled:!1===this.helperObj.canCreateItem,placeholder:null===(I=null===(P=this.translator)||void 0===P?void 0:P.customPrint)||void 0===I?void 0:I.saveToAGOFolder,"selection-mode":"single-persist",clearDisabled:"true",maxItems:"7",value:this.selectedFolder,onCalciteComboboxChange:()=>{this.selectedFolderChangeHandler()}},(this.folders||[]).map((e=>{var t;return(0,s.h)("calcite-combobox-item",{value:e.value,"text-label":e.label,selected:e.value===(null===(t=this.selectedFolder)||void 0===t?void 0:t.id)})})))),this.visibleElems.indexOf("outputFormat")<0?null:(0,s.h)("calcite-label",null,null===(T=null===(k=this.translator)||void 0===k?void 0:k.customPrint)||void 0===T?void 0:T.outputFormat,(0,s.h)("calcite-combobox",{placeholder:null===(x=null===(y=this.translator)||void 0===y?void 0:y.customPrint)||void 0===x?void 0:x.outputFormat,"selection-mode":"single-persist",clearDisabled:"true",value:this.outputFormat,onCalciteComboboxChange:e=>this.outputFormatChangeHandler(e)},(0,s.h)("calcite-combobox-item",{value:"docx",selected:"docx"===this.outputFormat,"text-label":null===(F=null===(w=this.translator)||void 0===w?void 0:w.customPrint)||void 0===F?void 0:F.outputFormatDocx}),(0,s.h)("calcite-combobox-item",{value:"pdf",selected:"pdf"===this.outputFormat,"text-label":null===(O=null===(j=this.translator)||void 0===j?void 0:j.customPrint)||void 0===O?void 0:O.outputFormatPdf}))),(0,s.h)("slot",{key:"0ea7f1954b4d990870bce17a6f6ab3d9904242df"}))}static get watchers(){return{fileName:["onFileNameChange"]}}};d.style=":host{display:block;padding:0 0.75rem}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}:host .folder-label{display:flex;justify-content:space-between;align-items:center}:host .conflict-name-setting{padding-block:0.5rem;padding-inline:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}";const u=class{constructor(e){(0,s.r)(this,e),this.goBackClicked=(0,s.c)(this,"goBackClicked",7),this.recentTasksCount=10,this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.utilService=a.U.getService(),this.langReport=void 0,this.langCommon=void 0,this.langTasks=void 0,this.state="loading",this.jobs=void 0}componentWillLoad(){this.state="loading",Promise.resolve(!0).then((()=>{var e;const t=r.T.getService().getTranslateSync();return this.langReport=null==t?void 0:t.customPrint,this.langCommon=null==t?void 0:t.common,this.langTasks=null==t?void 0:t.customPrint.recentTasks,this.stateService.subscribe("locale-data-changed",(e=>{this.langReport=null==e?void 0:e.customPrint,this.langCommon=null==e?void 0:e.common,this.langTasks=null==e?void 0:e.customPrint.recentTasks})),(null===(e=this.jobs)||void 0===e?void 0:e.length)?{jobs:this.jobs}:this.reportService.queryJobs(!0)})).then((e=>{var t;return this.jobList=e,this.jobs=(null===(t=this.jobList)||void 0===t?void 0:t.jobs)||[],this.state="ready",this.jobList}))}jobSplitDate(e,t){if(!this.jobs||t<0||t>=this.jobs.length||!e)return null;const i=this.utilService.formatDateTime(e.submitted,"date");if(0===t)return i;if(this.jobs[t-1]){return this.utilService.formatDateTime(this.jobs[t-1].submitted,"date")===i?null:i}return null}goBack(){this.goBackClicked.emit()}removeJob(e){const t=e.detail;if(this.jobs){const e=this.jobs.findIndex((e=>e.jobId===t.jobId));this.jobs.splice(e,1),this.jobs=[].concat(this.jobs)}}render(){var e,t;return(0,s.h)(s.H,{key:"9e04f7f484918b584487a2cd887a4473424e2a86"},(0,s.h)("div",{key:"7bd7270ce284bdc0d8bf858c6d4726e165d96b88",class:"banner"},(0,s.h)("calcite-action",{key:"53d1f3665321ff931bfd32771d01baba7995676c",onClick:()=>this.goBack(),text:null===(e=this.langTasks)||void 0===e?void 0:e.label,icon:"chevrons-left","text-enabled":!0})),"ready"===this.state&&this.langReport&&this.langCommon&&this.langTasks&&this.jobList?(0,s.h)("div",{class:"list"},this.jobs.length<1?(0,s.h)("div",{class:"no-tasks"},this.langTasks.noTaskDesc):"",this.jobs.length?(0,s.h)(s.F,null,(0,s.h)("div",{class:"no-tasks"},this.langTasks.limitationDesc.replace("${$maxJobCount}",`${this.recentTasksCount}`)),(0,s.h)("ul",null,this.jobs.map(((e,t)=>(0,s.h)("li",{key:"li_"+e.jobId},this.jobSplitDate(e,t)?(0,s.h)("p",{class:"job-date"},this.jobSplitDate(e,t)):"",(0,s.h)("task-info",{key:e.jobId,job:e,onJobRemoved:e=>this.removeJob(e)})))))):""):(0,s.h)("div",{class:"loading"},(0,s.h)("calcite-loader",{label:null===(t=this.langCommon)||void 0===t?void 0:t.loading})),(0,s.h)("slot",{key:"6e879c58da983aa00e6040ae7a5e7efbf61d8a2b"}))}};u.style=":host{display:block}:host *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:host *{font-size:14px}:host .banner{cursor:pointer;font-weight:700;line-height:60px}:host .banner a{cursor:pointer;float:inline-start;transform:rotateZ(180deg);top:16px}:host .banner span{float:inline-start;padding-left:10px}:host .no-tasks{margin-bottom:20px}:host .list{height:calc(100% - 60px);padding:0 0.75rem;overflow:auto;width:100%}:host .list ul{padding-left:0}:host .list ul li{list-style:none;margin-bottom:15px;border-radius:2px}:host .list p.job-date{color:#979797;line-height:40px;margin-bottom:0}:host-context([dir=rtl]) .banner a{transform:none !important}:host-context([dir=rtl]) .banner span{padding-right:10px;padding-left:unset !important}:host-context([dir=rtl]) list ul{padding-right:0;padding-left:unset !important}";const m=class{constructor(e){(0,s.r)(this,e),this.selectedTemplateChange=(0,s.c)(this,"selectedTemplateChange",7),this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.langObj=void 0,this.selectedTemplateId=void 0,this.templateIds=void 0,this.templates=[],this.translator=void 0}selectedTemplateIdChanged(){this.reportService.setParamCache({templateItemId:this.selectedTemplateId})}templateIdsChanged(){this.init()}componentWillLoad(){return this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();return this.translator=e,this.stateService.subscribe("locale-data-changed",(e=>{this.translator=e})),this.init()}))}init(){const e=r.P,t=o.R.getService();return Promise.resolve(!0).then((()=>void 0===this.templateIds?t.getReportTemplates(e.surveyItemId):t.getReportTemplates(e.surveyItemId,{templateIds:this.templateIds}))).then((e=>(this.templates=e,this.stateService.notifyDataChanged("print-templates-updated",{value:e}),this.reportService.setHelperObj({printTemplates:e}),!this.selectedTemplateId&&e.length&&(this.selectedTemplateId=e[0].id,this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),this.selectedTemplateChange.emit(this.selectedTemplateId)),!0))).catch((e=>{this.reportService.showError(e)}))}selectedTemplateChangeHandler(e){this.reportService.setParamCache({templateItemId:e.target.value}),this.selectedTemplateChange.emit(e.target.value)}render(){var e,t,i;return(0,s.h)(s.H,{key:"7f3ef2c784e04f8a1a0d1861200d4c794ed50fb7"},(0,s.h)("div",{key:"5e54734af22f84f41e1f5a6c87773e6c0a302869",class:"heading"},null===(e=this.translator)||void 0===e?void 0:e.customPrint.chooseTemplateLabel1),(0,s.h)("calcite-combobox",{key:"7eb5e61f8d97e61b6421ac73a6a814842e5e11a0",placeholder:null===(t=this.translator)||void 0===t?void 0:t.customPrint.chooseTemplateLabel1,"selection-mode":"single-persist",clearDisabled:"true",value:this.selectedTemplateId,onCalciteComboboxChange:e=>{this.selectedTemplateChangeHandler(e)}},(this.templates||[]).map((e=>(0,s.h)("calcite-combobox-item",{value:e.id,"text-label":e.title,selected:e.id===this.selectedTemplateId})))),(this.templates||[]).length>0?null:(0,s.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,s.h)("div",{slot:"message"},null===(i=this.translator)||void 0===i?void 0:i.customPrint.chooseTemplateNoOneYet1)),(0,s.h)("slot",{key:"2cea7b7e4e0d4591c35e8466f4295af2b6119c66"}))}get element(){return(0,s.a)(this)}static get watchers(){return{selectedTemplateId:["selectedTemplateIdChanged"],templateIds:["templateIdsChanged"]}}};m.style=":host{display:block;padding:0 0.75rem}:host calcite-notice{margin-top:6px}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}"}}]);