System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/basic/list-tree","jimu-core/react","jimu-for-builder","jimu-arcgis"],(function(e,t){var i={},a={},s={},o={},n={},r={},l={},d={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){a.AdvancedSelect=e.AdvancedSelect,a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.ConfirmDialog=e.ConfirmDialog,a.Label=e.Label,a.Loading=e.Loading,a.PanelHeader=e.PanelHeader,a.Popper=e.Popper,a.Radio=e.Radio,a.Select=e.Select,a.Switch=e.Switch,a.TextArea=e.TextArea,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.JimuLayerViewSelector=e.JimuLayerViewSelector,s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){o.DataSourceSelector=e.DataSourceSelector,o.FieldSelector=e.FieldSelector,o.dataComponentsUtils=e.dataComponentsUtils},function(e){n.List=e.List,n.Tree=e.Tree,n.TreeAlignmentType=e.TreeAlignmentType,n.TreeCollapseStyle=e.TreeCollapseStyle,n.TreeItemActionType=e.TreeItemActionType},function(e){r.Fragment=e.Fragment,r.createRef=e.createRef,r.useCallback=e.useCallback,r.useEffect=e.useEffect,r.useMemo=e.useMemo,r.useRef=e.useRef,r.useState=e.useState},function(e){l.builderAppSync=e.builderAppSync},function(e){d.JimuMapViewComponent=e.JimuMapViewComponent,d.LayerTypes=e.LayerTypes,d.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},19556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h4a1 1 0 0 1 1 1v1h8a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 1v11h13V4.913H5V3zm6 3h1v3h3v1H8v3H7v-3H4V9h3z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=d},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=r},4108:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=a},13089:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=s},98640:e=>{"use strict";e.exports=n}},t={};function c(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>Ie,default:()=>Me});var e,t,i,a,s,o=c(79244),n=c(14321),r=c(79298),l=c(13089);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.Added="Added",e.Updated="Updated",e.Deleted="Deleted"}(i||(i={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(a||(a={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(s||(s={}));const d={newEdit:"New editable source",newEditGeo:"New editable layer",newEditTips:"Support selected features view only",newMapEditTips:"Add layers from the map",attrMode:"Attribute only",geoMode:"Geometry and attribute",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateRecords:"Update records",snappingSettings:"Snapping settings",selfSnapping:"Geometry guides",featureSnapping:"Feature to feature",configFields:"Configure fields",configFieldsTip:"Select fields to show",importAll:"Import all",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",removeGroupConfirmTitle:"Are you sure you want to remove the group?",removeGroupConfirmTips:"The fields included in the group will also be removed.",noDataMessage:"No data message",noDataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",editableLayer:"editable layers",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",editableCount:"{count} Editable",layerHonorSetting:"Use webmap settings",layerCustomize:"Customize",noLayerTips:"The Map does not contain any editable data.",noMapTips:"Please establish a connection with a Map widget.",chooseDefault:"Choose default snapping layers",uneditableTips:"The layer is in a read-only state.",prescriptiveMode:"Prescriptive mode",flexibleMode:"Flexible mode",templateFilter:"Template filter",relatedRecords:"Related records",runtimeDataEditing:"Runtime data editing",initialReshapeMode:"Display vertices while editing",selectLayers:"Select layers"};var p=c(98640),m=c(19556),h=c.n(m),g=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const f=e=>{const t=window.SVG,{className:i}=e,a=g(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:h()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var y=c(9044),v=c.n(y),S=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const b=e=>{const t=window.SVG,{className:i}=e,a=S(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:v()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var w=c(45508),x=c.n(w),j=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const C=e=>{const t=window.SVG,{className:i}=e,a=j(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:x()},a)):o.React.createElement("svg",Object.assign({className:s},a))},M=["CreationDate","Creator","EditDate","Editor","GlobalID"];var I=c(68972);const O="root item for tree data entry";class D extends o.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.OrientedImageryLayer,o.AllDataSourceTypes.SubtypeSublayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[])=>e.some((e=>!e.editAuthority&&e.editable)),this.getIndeterminate=(e=[])=>{const t=e.some((e=>e.editAuthority&&e.editable)),i=e.some((e=>!e.editAuthority&&e.editable));return t&&i},this.onLayerModeChange=e=>{this.props.optionChange("layerHonorMode",e)},this.handleSwitchChange=(e,t)=>{const i=e.currentTarget;i&&this.props.optionChange(t,i.checked)},this.handleUpdateRecordsChange=(e,t)=>{const i=e.currentTarget;if(!i)return;const a=i.checked;this.props.multiOptionsChange({updateRecords:a,updateAttributes:a,updateGeometries:t&&a})},this.handleUpdateAttrOrGeoChange=(e,t)=>{const i=e.currentTarget;if(!i)return;const a=i.checked,{updateAttributes:s,updateGeometries:o}=this.props;"updateAttributes"===t&&!a&&!o||"updateGeometries"===t&&!a&&!s?this.props.multiOptionsChange({updateRecords:!1,updateAttributes:!1,updateGeometries:!1}):this.props.optionChange(t,a)},this.findEditingIndex=e=>{const{groupedFields:t}=this.props;let i;return t.forEach(((t,a)=>{if(t.jimuName===e)i=[a];else if(null==t?void 0:t.children){const s=t.children.findIndex((t=>t.jimuName===e));s>-1&&(i=[a,s])}})),i},this.handleTreeBoxChange=e=>{const t=e.currentTarget;if(!t)return;const{groupedFields:i}=this.props,a=this.findEditingIndex(t.id);if(2===a.length){const[e,s]=a;i[e][s].editAuthority=t.checked}else if(1===a.length){const[e]=a;i[e].editAuthority=t.checked}this.props.optionChange("groupedFields",i);const s=this.constructTreeItem(i);this.setState({rootItemJson:s})},this.handleTreeDescChange=(e,t)=>{const{groupedFields:i}=this.props,a=this.findEditingIndex(e);if(2===a.length){const[e,s]=a;i[e].children[s].subDescription=t}else if(1===a.length){const[e]=a;i[e].subDescription=t}this.props.optionChange("groupedFields",i);const s=this.constructTreeItem(i);this.setState({rootItemJson:s,isOpenDetailPopper:!1})},this.formatMessage=(e,t)=>{const i=Object.assign({},d,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.minusArray=(e,t,i)=>{const a=i||"jimuName",s=e.length>t.length,o=s?t:e;return(s?e:t).filter((e=>!o.some((t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))))},this.onFieldChange=e=>{if(!e)return;const{dataSource:t}=this.state,{showFields:i,groupedFields:a}=this.props,s=e.filter((e=>e));if(0===e.length)a.length=0;else{const s=this.minusArray(e,i),o=null==s?void 0:s[0];let n;if(a.forEach(((e,t)=>{if(null==e?void 0:e.children){const i=e.children.findIndex((e=>e.jimuName===(null==o?void 0:o.jimuName)));i>-1&&(n=[t,i])}else e.jimuName===(null==o?void 0:o.jimuName)&&(n=[t])})),n){if(2===n.length){const[e,t]=n;a[e].children.splice(t,1)}else if(1===n.length){const[e]=n;a.splice(e,1)}}else{const e=null==t?void 0:t.getLayerDefinition(),i=((null==e?void 0:e.fields)||[]).find((e=>e.name===o.jimuName)),s=null==i?void 0:i.editable;a.push(Object.assign(Object.assign({},o),{editAuthority:s,subDescription:(null==o?void 0:o.description)||"",editable:s}))}}this.props.multiOptionsChange({showFields:s,groupedFields:a});const o=this.constructTreeItem(a),n=this.getUncheckState(a),r=this.getIndeterminate(a);this.setState({rootItemJson:o,hasUncheck:n,indeterminate:r})},this.onDataSourceCreated=e=>{this.setState({dataSource:e},(()=>{const{groupedFields:e}=this.props,t=this.constructTreeItem(e);this.setState({rootItemJson:t})}))},this.getFieldsFromDataSource=()=>{const{useDataSource:e}=this.props,t=o.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),i=null==t?void 0:t.getSchema();return(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[]},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.getSelectorFields=e=>{const t=[];return e&&e.length>0&&e.forEach((e=>{t.push(e.jimuName)})),t},this.handleTreeBoxAll=e=>{const{groupedFields:t}=this.props,i=t.map((t=>(null==t?void 0:t.children)?Object.assign(Object.assign({},t),{editAuthority:e,children:t.children.map((t=>Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})))}):Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})));this.props.optionChange("groupedFields",i);const a=this.constructTreeItem(i);this.setState({rootItemJson:a,hasUncheck:!e,indeterminate:!1})},this.addGroupForFields=()=>{this.setState({groupUpdating:!0},(()=>{setTimeout((()=>{this.setState({groupUpdating:!1})}),1e3)}));const{groupedFields:e}=this.props,t=this.getGroupMaxId(e)+1,i={jimuName:`${this.formatMessage("group")}-${t}`,name:`${this.formatMessage("group")}-${t}`,alias:`${this.formatMessage("group")}-${t}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:t};e.unshift(i),this.props.optionChange("groupedFields",e);const a=this.constructTreeItem(e);this.setState({rootItemJson:a})},this.removeGroup=e=>{var t;const{curEditField:i}=this.state,{groupedFields:a}=this.props,s=a.findIndex((t=>t.jimuName===e));a.splice(s,1,...null===(t=a[s])||void 0===t?void 0:t.children),this.props.optionChange("groupedFields",a);const o=this.constructTreeItem(a);this.setState({rootItemJson:o}),(null==i?void 0:i.jimuName)===e&&this.setState({isOpenDetailPopper:!1})},this.constructTreeItem=(e=[])=>{const{theme:t,layerEditingEnabled:i}=this.props,a=this.getFieldsFromDataSource(),s=e=>Array.from(e).map(((e,n)=>Object.assign({itemKey:`${o.utils.getUUID()}_${n}`,itemStateChecked:!!i&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:l.dataComponentsUtils.getIconFromFieldType(e.type,t),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!this.checkFieldsExist(a,e),itemStateCommands:[],isCheckboxDisabled:!i||!e.editable},e.children?{itemChildren:s(e.children)}:{}))),n=s(e);return{itemKey:O,itemStateTitle:O,itemChildren:n}},this.setRootItemJson=e=>{this.setState({rootItemJson:e})},this.showDetailPopper=(e,t)=>{const{isOpenDetailPopper:i}=this.state;this.setState({isOpenDetailPopper:!i,popperRef:e,curEditField:t})},this.getCurrentEditField=e=>{const{groupedFields:t}=this.props,i=this.findEditingIndex(e);let a={jimuName:"",groupKey:"",editAuthority:!1,children:[],subDescription:"",description:"",name:""};if(2===(null==i?void 0:i.length)){const[e,s]=i;a=t[e].children[s]}else if(1===(null==i?void 0:i.length)){const[e]=i;a=t[e]}return a},this.state={dataSource:void 0,rootItemJson:this.constructTreeItem(e.groupedFields),itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.groupedFields),indeterminate:this.getIndeterminate(e.groupedFields),isOpenDetailPopper:!1,popperRef:void 0,curEditField:void 0,groupUpdating:!1},this.colRef=o.React.createRef()}componentDidUpdate(e,t){this.props.name!==e.name&&this.setState({itemLabel:this.props.name||""}),this.props.id!==e.id&&this.setState({rootItemJson:this.constructTreeItem(this.props.groupedFields)})}getGroupMaxId(e=[]){const t=[];return e.forEach((e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)})),t.length>0?Math.max.apply(null,t):0}getStyle(e){return o.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: calc(100% - ${o.polished.rem(58)});
          overflow: auto;
          .layer-mode {
            .layer-mode-item {
              display: flex;
              margin-bottom: 8px;
            }
          }
          .fields-list-header {
            background: ${e.ref.palette.neutral[300]};
            border-bottom: 1px solid ${e.ref.palette.neutral[600]};
            height: 34px;
            width: 100%;
            flex-wrap: nowrap;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 300px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.ref.palette.neutral[300]};
              border-bottom: 1px solid ${e.ref.palette.neutral[400]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.ref.palette.neutral[300]};
                  .jimu-tree-item__title{
                    .jimu-input{
                      width: 125px;
                    }
                  }
                  .item-remove-button {
                    padding: 0 .125rem; /** consistent with detail icon from tree. */
                  }
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
          .capability-item{
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
          }
          .disabled-label{
            color: ${e.ref.palette.neutral[700]};
          }
        }
      }
    `}render(){var e,i;const{onClose:a,optionChange:s,dataSourceChange:d,filterDs:c,id:u,useDataSource:m,theme:h,showFields:g,addRecords:y,deleteRecords:v,updateRecords:S,updateAttributes:w,updateGeometries:x,groupedFields:j,layerHonorMode:O,layerEditingEnabled:D,isMapMode:T}=this.props,{rootItemJson:L,itemLabel:N,dataSource:A,hasUncheck:k,indeterminate:R,isOpenDetailPopper:E,popperRef:P,curEditField:V,groupUpdating:F}=this.state,H=T,z=this.getSelectorFields(g),B=A||o.DataSourceManager.getInstance().getDataSource(u),U=(null==B?void 0:B.type)===o.DataSourceTypes.SceneLayer?null===(e=B.getAssociatedDataSource())||void 0===e?void 0:e.getLayerDefinition():null==B?void 0:B.getLayerDefinition(),J=null==U?void 0:U.allowGeometryUpdates,G=(null==U?void 0:U.type)===o.SupportedLayerServiceTypes.Table,_=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),$=null==U?void 0:U.capabilities,W=_($,"create"),q=_($,"update"),K=_($,"delete"),Q={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemContent,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:p.TreeItemActionType.RenderOverrideItemIcon},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:p.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:p.TreeItemActionType.RenderOverrideItemSubitems}]})};let Y=0;null==j||j.forEach((e=>{(null==e?void 0:e.children)?null==e||e.children.forEach((e=>{(null==e?void 0:e.editAuthority)&&Y++})):(null==e?void 0:e.editAuthority)&&Y++}));const X=!!(null===(i=null==B?void 0:B.getRootDataSource())||void 0===i?void 0:i.map);return(0,o.jsx)("div",{className:"w-100 h-100",css:this.getStyle(h)},(0,o.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,o.jsx)("div",{className:"w-100 d-flex px-4 py-0"},(0,o.jsx)(n.PanelHeader,{level:1,className:"px-0 py-4 panel-inner",showClose:!!a,onClose:a,title:this.formatMessage("layerConfig")})),(0,o.jsx)("div",{className:"setting-container"},(0,o.jsx)(r.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(l.DataSourceSelector,{types:this.supportedDsTypes,disableRemove:()=>!0,disableDataSourceList:T,hideDataView:!0,useDataSources:m?(0,o.Immutable)([m]):(0,o.Immutable)([]),mustUseDataSource:!0,onChange:d,closeDataSourceListOnChange:!0,hideDs:c,hideTabs:(0,o.Immutable)(["OUTPUT"])}))),m&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingSection,{title:this.formatMessage("label")},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:N,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,o.jsx)(r.SettingSection,{title:this.formatMessage("capability")},D?(0,o.jsx)(I.Fragment,null,(!H&&G||H)&&(0,o.jsx)("div",{className:"capability-item",key:"addRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("addRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("addRecords"),className:"can-x-switch",checked:y,onChange:e=>{this.handleSwitchChange(e,"addRecords")},disabled:!W})),(0,o.jsx)("div",{className:"capability-item",key:"deleteRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("deleteRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("deleteRecords"),className:"can-x-switch",checked:v,onChange:e=>{this.handleSwitchChange(e,"deleteRecords")},disabled:!K})),(0,o.jsx)("div",{className:"capability-item",key:"updateRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("updateRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("updateRecords"),className:"can-x-switch",checked:S,onChange:e=>{this.handleUpdateRecordsChange(e,J)},disabled:!q})),H&&S&&(0,o.jsx)("div",{className:"ml-4"},(0,o.jsx)(n.Label,{className:"w-100 d-flex"},(0,o.jsx)(n.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:w,"aria-label":this.formatMessage("attribute"),onChange:e=>{this.handleUpdateAttrOrGeoChange(e,"updateAttributes")}}),(0,o.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},this.formatMessage("attribute"))),(0,o.jsx)(n.Label,{className:"w-100 d-flex"},(0,o.jsx)(n.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:x,"aria-label":this.formatMessage("geometry"),onChange:e=>{this.handleUpdateAttrOrGeoChange(e,"updateGeometries")},disabled:!J}),(0,o.jsx)("div",{className:`m-0 ml-2 flex-grow-1 omit-label ${!J&&"disabled-label"}`},this.formatMessage("geometry"))))):this.formatMessage("uneditableTips")),(0,o.jsx)(r.SettingSection,{title:this.formatMessage("configFields")},X&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Select,{size:"sm",className:"w-100",value:O,onChange:e=>{s("layerHonorMode",e.target.value)}},(0,o.jsx)("option",{value:t.Webmap},this.formatMessage("layerHonorSetting")),(0,o.jsx)("option",{value:t.Custom},this.formatMessage("layerCustomize")))),O===t.Custom&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("configFieldsTip")},(0,o.jsx)(l.FieldSelector,{useDataSources:m?(0,o.Immutable)([m]):(0,o.Immutable)([]),onChange:this.onFieldChange,selectedFields:(0,o.Immutable)(z),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,hiddenFields:(0,o.Immutable)(M)})),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:D&&this.formatMessage("editableCount",{count:Y})},(0,o.jsx)("div",{className:"fields-list-header form-inline"},(0,o.jsx)("div",{className:"d-flex w-100 ml-5 fields-list-check"},D&&(0,o.jsx)(n.Checkbox,{id:"editAll","data-field":"editAll",onClick:()=>{this.handleTreeBoxAll(k)},checked:!k,indeterminate:R,title:k?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,o.jsx)(n.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))),(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"tertiary",onClick:this.addGroupForFields,title:this.formatMessage("addGroup"),"aria-label":this.formatMessage("addGroup"),disabled:F},(0,o.jsx)(f,null)))),(0,o.jsx)(r.SettingRow,{className:"selected-fields-con"},(0,o.jsx)(p.Tree,Object.assign({className:"selected-fields-list",rootItemJson:L,treeAlignmentType:p.TreeAlignmentType.Intact,dndEnabled:!0,checkboxLinkage:D,collapseStyle:p.TreeCollapseStyle.Arrow,renderOverrideItemCommands:(e,t)=>{const{itemJsons:i}=t.props,[a]=i,{jimuName:s}=null==a?void 0:a.itemStateDetailContent,r=this.getCurrentEditField(s),{jimuName:l,groupKey:d}=r;return d?(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"tertiary",className:"item-remove-button",onClick:e=>{null==e||e.stopPropagation(),this.removeGroup(l)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||this.removeGroup(l)},title:this.formatMessage("remove"),"aria-label":this.formatMessage("remove")},(0,o.jsx)(b,null)):""},renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:i,itemJsons:[{itemStateDetailVisible:a,itemStateDetailContent:s,itemStateDisabled:r}]}=t.props,[l]=i,{jimuName:d}=null==l?void 0:l.itemStateDetailContent,c=this.getCurrentEditField(d);return s?(0,o.jsx)(n.Button,{icon:!0,type:"tertiary",size:"sm",title:this.formatMessage("description"),"aria-label":this.formatMessage("description"),disabled:!!r,"aria-expanded":!!a,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),this.showDetailPopper(t.dragRef,c)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.showDetailPopper(t.dragRef,c))},css:()=>o.css`
                                &.jimu-tree-item__detail-toggle {
                                  display: flex;
                                  align-items: center;
                                  cursor: pointer;

                                  .icon-btn-sizer {
                                    margin: 0;
                                    min-width: 0.5rem;
                                    min-height: 0.5rem;
                                  }
                                }
                              `},(0,o.jsx)(C,{autoFlip:!a})):null},isItemDroppable:(e,t)=>{var i,a,s;const{draggingItemJsons:o,targetItemJsons:n,dropType:r}=e,l=null===(i=n[0])||void 0===i?void 0:i.itemChildren,d=null===(a=n[Math.min(1,n.length-2)])||void 0===a?void 0:a.itemChildren,c=null===(s=o[0])||void 0===s?void 0:s.itemChildren;let u=!0;return"to-inside"!==r||l&&!c||(u=!1),"to-inside"!==r&&d&&c&&(u=!1),u},isFolder:(e,t)=>{const{targetItemJsons:i}=e,[a]=i,{groupKey:s}=null==a?void 0:a.itemStateDetailContent;return!!s},onUpdateItem:(e,t)=>{var i;const{itemJsons:a,updateType:o}=e,n=a[a.length-1],[r]=a,{jimuName:l}=null==r?void 0:r.itemStateDetailContent,d=this.getCurrentEditField(l),{groupKey:c}=d;if(!c&&o===p.TreeItemActionType.HandleStartEditing)return;const u=null===(i=n.itemChildren)||void 0===i?void 0:i.map(((e,t)=>{var i,a,s,o,r;return(null==e?void 0:e.itemChildren)?(e.itemStateTitle||(n.itemChildren[t].itemStateTitle=null===(i=e.itemStateDetailContent)||void 0===i?void 0:i.jimuName),Object.assign(Object.assign(Object.assign(Object.assign({},e.itemStateDetailContent),{children:e.itemChildren.map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})))}),e.itemStateTitle?{name:e.itemStateTitle,alias:e.itemStateTitle}:{name:null===(a=e.itemStateDetailContent)||void 0===a?void 0:a.jimuName,alias:null===(s=e.itemStateDetailContent)||void 0===s?void 0:s.jimuName}),{editAuthority:(null===(o=e.itemChildren)||void 0===o?void 0:o.length)>0&&!(null===(r=e.itemChildren)||void 0===r?void 0:r.some((e=>!1===e.isCheckboxDisabled&&!1===e.itemStateChecked)))})):Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})}));s("groupedFields",u);const m=this.getUncheckState(u),h=this.getIndeterminate(u);this.setState({rootItemJson:n,hasUncheck:m,indeterminate:h})}},Q)),(0,o.jsx)(n.Popper,{placement:"bottom-start",disableResize:!0,reference:P,offset:[-27,3],open:E,showArrow:!1,toggle:e=>{this.setState({isOpenDetailPopper:!E})}},(0,o.jsx)("div",{style:{width:228,height:132},className:"p-4"},(0,o.jsx)(n.TextArea,{ref:e=>{this.popperTextRef=e},id:null==V?void 0:V.jimuName,className:"w-100",height:60,placeholder:this.formatMessage("editFieldDescription"),defaultValue:(null==V?void 0:V.subDescription)||(null==V?void 0:V.description)}),(0,o.jsx)("div",{className:"mt-4 float-right"},(0,o.jsx)(n.Button,{size:"sm",type:"primary",onClick:()=>{this.handleTreeDescChange(null==V?void 0:V.jimuName,this.popperTextRef.value)}},this.formatMessage("commonModalOk")),(0,o.jsx)(n.Button,{size:"sm",className:"ml-1",onClick:()=>{this.setState({isOpenDetailPopper:!1})}},this.formatMessage("commonModalCancel")))))))),(0,o.jsx)("div",{className:"ds-container"},(0,o.jsx)(o.DataSourceComponent,{useDataSource:(0,o.Immutable)(m),onDataSourceCreated:this.onDataSourceCreated}))))))}}var T=c(4108);class L extends o.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,o.jsx)(o.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var N=c(23662),A=c.n(N),k=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const R=e=>{const t=window.SVG,{className:i}=e,a=k(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:A()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var E=c(31027),P=c.n(E),V=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const F=e=>{const t=window.SVG,{className:i}=e,a=V(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:P()},a)):o.React.createElement("svg",Object.assign({className:s},a))};function H(e){var t,i,a,s,n;let r=[];if(!e)return r;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(a=null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(s=(0,o.getAppStore)().getState())||void 0===s?void 0:s.appConfig;if(!l)return r;const d=null===(n=l.widgets[e])||void 0===n?void 0:n.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((e=>{const t=o.DataSourceManager.getInstance().getDataSource(e),i=(null==t?void 0:t.getDataSourcesByType(o.DataSourceTypes.FeatureLayer))||[],a=(null==t?void 0:t.getDataSourcesByType(o.DataSourceTypes.OrientedImageryLayer))||[],s=i.concat(a);if(s){const e=s.filter((e=>!function(e){const t=e=>{var i,a;let s=!1;const n=null==e?void 0:e.parentDataSource,r=null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.isTable;if(((null===(a=null==n?void 0:n.layer)||void 0===a?void 0:a.type)===o.SupportedJSAPILayerTypes.MapImageLayer||r)&&(s=!0),s||!n)return s;t(n)};return t(e)}(e)));r=r.concat(e)}}))}return r}var z=c(62686),B=c(53195),U=c.n(B),J=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const G=e=>{const t=window.SVG,{className:i}=e,a=J(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:U()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var _=c(72529),$=c.n(_),W=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const q=e=>{const t=window.SVG,{className:i}=e,a=W(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:$()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var K=c(93303),Q=c.n(K),Y=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const X=e=>{const t=window.SVG,{className:i}=e,a=Y(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:Q()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var Z=c(30655),ee=c.n(Z),te=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const ie=e=>{const t=window.SVG,{className:i}=e,a=te(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:ee()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var ae=c(94064),se=c.n(ae),oe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const ne=e=>{const t=window.SVG,{className:i}=e,a=oe(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:se()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var re=c(28996),le=c.n(re),de=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const ce=e=>{const t=window.SVG,{className:i}=e,a=de(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:le()},a)):o.React.createElement("svg",Object.assign({className:s},a))};const ue=["CreationDate","Creator","EditDate","Editor","GlobalID"],pe=[z.LayerTypes.FeatureLayer,z.LayerTypes.SceneLayer,z.LayerTypes.BuildingComponentSublayer,z.LayerTypes.OrientedImageryLayer,z.LayerTypes.SubtypeSublayer],me=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),he=(e,i)=>{var a,s,n;const r=null==e?void 0:e.getLayerDefinition(),l=null==r?void 0:r.allowGeometryUpdates,d=null==r?void 0:r.capabilities,c=me(d,"create"),u=me(d,"update"),p=me(d,"delete"),m=null==e?void 0:e.getSchema();let h=(null==m?void 0:m.fields)?Object.values(null==m?void 0:m.fields):[];const g=(null==r?void 0:r.fields)||[];h=h.filter((e=>!ue.includes(e.name)));const f=null===(s=null===(a=null==e?void 0:e.layer)||void 0===a?void 0:a.formTemplate)||void 0===s?void 0:s.elements;if(f){const e=[];f.forEach((t=>{var i;const a=t;(null===(i=null==a?void 0:a.elements)||void 0===i?void 0:i.length)>0?null==a||a.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):a.fieldName&&e.push(a.fieldName)})),h=h.filter((t=>e.includes(t.name)))}(null==h?void 0:h.length)>50&&(h=h.slice(0,50));const y=h.map((e=>{const t=g.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),v={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(n=e.getRootDataSource())||void 0===n?void 0:n.id},S=(0,o.Immutable)(v);return{id:e.id,name:e.getLabel(),layerId:null==e?void 0:e.jimuChildId,useDataSource:S,addRecords:c,deleteRecords:p,updateRecords:u,updateAttributes:u,updateGeometries:l&&u,featureSnapping:!1,showFields:h,groupedFields:y,layerHonorMode:t.Webmap,parentViewId:i}};function ge(e){if(!e||!e.type)return!1;const t=e.layer.type,i=t!==z.LayerTypes.BuildingComponentSublayer||t===z.LayerTypes.BuildingComponentSublayer&&e.view;return!!(pe.includes(t)&&i)}function fe(e){const t=e.slice();return t.sort(((e,t)=>{const i=null==e?void 0:e.hierarchyLevel,a=null==t?void 0:t.hierarchyLevel;return i&&a?function(e,t){const i=e.split(".").map((e=>parseInt(e))),a=t.split(".").map((e=>parseInt(e)));for(;i.length>0&&a.length>0;){const e=i.shift(),t=a.shift();if(e<t)return-1;if(e>t)return 1}if(i.length>0)return 1;if(a.length>0)return-1;return 0}(i,a):0})),t}var ye=function(e,t,i,a){return new(i||(i=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function r(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const ve=(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.BuildingComponentSubLayer,o.AllDataSourceTypes.OrientedImageryLayer,o.AllDataSourceTypes.SubtypeSublayer]),Se=o.css`
  .map-layers-header-setting-row.jimu-widget-setting--row-label {
    margin-top: 0 !important;
  }

  .map-layers-header-setting-row {
    width: calc(100% - 22px);
    max-width: calc(100% - 22px);

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;

        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }

  .jimu-tree-item.jimu-tree-item_template-card.jimu-tree-item_disabled-false .jimu-tree-item__content .jimu-tree-item__body:hover {
    cursor: pointer !important;
  }
`;function be(e){var t,i,a,s,l,c;const{jimuMapView:u,mapViewConfig:m,theme:h,widgetId:g,intl:f,isMapMode:y,sidePopperTrigger:v,useMapWidgetIds:S,onLayerItemClick:b,onMapSettingClick:w,onLayerSettingChange:x,onMultipleLayerSettingChange:j,onMapLayersConfigChange:C,onMapLayersMultipleConfigChange:M,onMapLayersConfigActiveIdSet:O}=e,L=o.hooks.useTranslation(n.defaultMessages,d),[N,A]=(0,I.useState)(""),[k,R]=(0,I.useState)(!1),[E,P]=(0,I.useState)(null),[V,F]=(0,I.useState)(!1),[z,B]=(0,I.useState)(!1),[U,J]=(0,I.useState)([]),[_,$]=(0,I.useState)(!1),[W,K]=(0,I.useState)(null),Q=(0,I.useRef)(null),Y=o.DataSourceManager.getInstance(),Z=Y.getDataSource(u.dataSourceId),ee=(null==Z?void 0:Z.getLabel())||"",te=u.id,ae=(0,I.useRef)(te);ae.current=te;const se="3d"===(null===(t=u.view)||void 0===t?void 0:t.type),oe=(0,I.useRef)(null),re=(0,I.useMemo)((()=>{const e={};return U.forEach((t=>{e[t.id]=!0;t.getAllAncestorJimuLayerViews().forEach((t=>{e[t.id]=!0}))})),e}),[U]);(0,I.useEffect)((()=>{we()}),[m,u]),(0,I.useEffect)((()=>{!function(){ye(this,void 0,void 0,(function*(){const e=u.id,t=yield u.whenAllJimuLayerViewLoaded(),i=Object.values(t).filter((e=>!e.fromRuntime&&ge(e))),a=i.map((e=>e.createLayerDataSource()));try{yield Promise.all(a)}catch(e){console.log(e)}var s;u.isActive||(yield(s=500,new Promise((e=>{setTimeout((()=>{e()}),s)}))));const o=i.filter((e=>{var t;return!!e.getLayerDataSource()&&!!(null===(t=e.layer)||void 0===t?void 0:t.url)}));ae.current===e&&(J(o),F(!0))}))}()}),[u]);const le=(0,I.useCallback)((()=>{B(!0),w(u.id)}),[]),de=(0,I.useCallback)((()=>{$((e=>!e))}),[]),ue=(0,I.useCallback)((()=>{B(!1)}),[]),pe=(0,I.useCallback)(((e,t)=>{if(!t||(null==W?void 0:W.customJimuLayerViewIds)&&0!==W.customJimuLayerViewIds.length){j(e,{layersConfig:[],customizeLayers:t})}else{const i=Object.keys(u.jimuLayerViews).filter((e=>ge(u.jimuLayerViews[e]))),a=u.jimuLayerViews;if(a){const e=fe(Object.values(a));i.sort(((t,i)=>(null==e?void 0:e.findIndex((e=>e.id===t)))-(null==e?void 0:e.findIndex((e=>e.id===i)))))}j(e,{customJimuLayerViewIds:i,customizeLayers:t})}}),[x]),me=(0,I.useCallback)((e=>{const t=e.id;return!re[t]}),[re]),be=(0,I.useCallback)((e=>!U.includes(e)),[U]),we=()=>{var e,t,i,a,s;const n=u.jimuLayerViews,r=[];for(const s in n){const o=null===(e=n[s])||void 0===e?void 0:e.getLayerDataSource();if(!o||!ve.includes(o.type)||!(null===(i=null===(t=n[s])||void 0===t?void 0:t.layer)||void 0===i?void 0:i.url))continue;const l=Y.getDataSource(o.id),d=null==m?void 0:m.layersConfig.find((e=>e.id===o.id));let c;if(d)c=d;else{c=he(l,null===(a=n[s])||void 0===a?void 0:a.jimuMapViewId)}r.push(c)}const l=null==m?void 0:m.customizeLayers,d=null==m?void 0:m.customJimuLayerViewIds;if(l&&(null==d?void 0:d.length)>0)r.sort(((e,t)=>(null==d?void 0:d.findIndex((t=>t.includes(e.id))))-(null==d?void 0:d.findIndex((e=>e.includes(t.id))))));else{const e=fe(Object.values(n));r.sort(((t,i)=>(null==e?void 0:e.findIndex((e=>e.id.includes(t.id))))-(null==e?void 0:e.findIndex((e=>e.id.includes(i.id))))))}const c={parentViewId:(null==m?void 0:m.parentViewId)||u.id,customizeLayers:!(!m||!("customizeLayers"in m))&&m.customizeLayers,customJimuLayerViewIds:(null===(s=null==m?void 0:m.customJimuLayerViewIds)||void 0===s?void 0:s.asMutable({deep:!0}))||[],layersConfig:(0,o.Immutable)(r)};K(c)},xe=[];oe.current&&xe.push(oe.current);const je=(e,t)=>{(e=>{const t=v.getElementsByClassName("jimu-tree-item__body")[e];P(t)})(e),e===Q.current?(k||(A(t),O(t)),R(!k)):(A(t),O(t),R(!0),Q.current=e)},Ce=()=>{R(!1),Q.current=0},Me=null===(i=null==W?void 0:W.customJimuLayerViewIds)||void 0===i?void 0:i.map((e=>{const t=e.indexOf("-");return e.substring(t+1)})),Ie=(null==W?void 0:W.customizeLayers)?null===(a=null==W?void 0:W.layersConfig)||void 0===a?void 0:a.filter((e=>Me.includes(e.id))):null==W?void 0:W.layersConfig,Oe=H(null==S?void 0:S[0]).find((e=>{var t;return(null===(t=null==Ie?void 0:Ie[Q.current])||void 0===t?void 0:t.id)===e.id})),De=null===(c=null===(l=null===(s=null==Oe?void 0:Oe.getMainDataSource())||void 0===s?void 0:s.layer)||void 0===l?void 0:l.editingEnabled)||void 0===c||c;return(0,o.jsx)("div",{className:"map-layers-setting",css:Se},(0,o.jsx)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-4"},se?(0,o.jsx)(q,{className:"mr-2"}):(0,o.jsx)(G,{className:"mr-2"}),(0,o.jsx)(r.SettingRow,{flow:"no-wrap",className:"map-layers-header-setting-row w-100",label:ee,"aria-label":ee},(0,o.jsx)("div",{className:"map-title-icon-container d-flex align-items-center"},!V&&(0,o.jsx)("div",{className:"setting-loading-container"},(0,o.jsx)(n.Loading,{type:"DONUT"})),V&&0===U.length&&(0,o.jsx)(n.Tooltip,{title:L("noAvailableLayers"),showArrow:!1,placement:"top"},(0,o.jsx)("span",null,(0,o.jsx)(n.Button,{className:"border-0",disabled:!V,type:"tertiary",icon:!0,size:"sm"},(0,o.jsx)(ce,{size:16,color:"var(--warning-600)"})))),V&&U.length>0&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(n.Tooltip,{title:L("selectLayers"),showArrow:!1,placement:"top"},(0,o.jsx)("span",null,(0,o.jsx)(n.Button,{ref:oe,className:"map-layers-setting-btn mr-1 p-0 border-0",disabled:!V,type:"tertiary",icon:!0,size:"sm",onClick:le},(0,o.jsx)(X,{size:16})))),(null==W?void 0:W.customizeLayers)&&(0,o.jsx)(n.Button,{className:"layer-list-toggle-btn p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:de},_?(0,o.jsx)(ne,{size:16}):(0,o.jsx)(ie,{size:16})))))),(null==W?void 0:W.customizeLayers)&&(0,o.jsx)(p.List,{className:(0,o.classNames)(["w-100 mt-1",{"d-none":!_}]),itemsJson:(()=>{var e;const t=[],i=null===(e=null==W?void 0:W.customJimuLayerViewIds)||void 0===e?void 0:e.map((e=>{const t=e.indexOf("-");return e.substring(t+1)}));return((null==W?void 0:W.customizeLayers)?(null==W?void 0:W.layersConfig.filter((e=>i.includes(e.id))))||[]:(null==W?void 0:W.layersConfig)||[]).forEach(((e,i)=>{t.push({itemStateDetailContent:e,itemKey:`${i}`,itemStateChecked:k&&i===Q.current,itemStateTitle:e.name,itemStateCommands:[]})})),t})(),dndEnabled:!1,renderOverrideItemDetailToggle:()=>"",onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props,a=i.itemStateDetailContent,s=a.id,o=+i.itemKey;b(a.parentViewId||u.id,o),je(o,s),N!==s&&(T.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"activeTabId",value:s}),T.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"settingChangeTab",value:!0}))}}),z&&(0,o.jsx)(r.SidePopper,{isOpen:!0,toggle:ue,position:"right",trigger:xe,title:L("selectLayers")},(0,o.jsx)(r.SettingRow,{className:"w-100 pl-4 pr-4",label:L("customizeLayers")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:W.customizeLayers,"data-key":"customizeLayers",onChange:e=>{pe(W.parentViewId,e.target.checked)},"aria-label":L("customizeLayers")})),W.customizeLayers&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,{className:"w-100 pl-4 pr-4",label:ee,"aria-label":ee}),(0,o.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,o.jsx)(r.JimuLayerViewSelector,{key:te,jimuMapViewId:te,isMultiSelection:!0,selectedValues:null==W?void 0:W.customJimuLayerViewIds,hideLayers:me,disableLayers:be,onChange:e=>{const t=u.jimuLayerViews;if(t){const i=fe(Object.values(t));e.sort(((e,t)=>(null==i?void 0:i.findIndex((t=>t.id===e)))-(null==i?void 0:i.findIndex((e=>e.id===t)))))}x(u.id,"customJimuLayerViewIds",e)}})))),(0,o.jsx)(r.SidePopper,{position:"right",isOpen:k&&!o.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:Ce,trigger:v,backToFocusNode:E},(0,o.jsx)(D,Object.assign({},null==Ie?void 0:Ie.asMutable({deep:!0})[Q.current],{isMapMode:y,intl:f,theme:h,layerEditingEnabled:De,optionChange:C,multiOptionsChange:M,onClose:Ce}))))}var we=function(e,t,i,a){return new(i||(i=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function r(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const xe=c(62838),je=Object.assign({},d,n.defaultMessages);class Ce extends o.React.PureComponent{constructor(i){super(i),this.supportedDsTypes=(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.OrientedImageryLayer,o.AllDataSourceTypes.SubtypeSublayer]),this.sidePopperTrigger=(0,I.createRef)(),this.customizeLayersTrigger=(0,I.createRef)(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{this.dsHash[t]=e.useDataSource,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.dataSourceChangeSave=i=>{if(!i)return;const{config:a}=this.props,{editMode:s}=a,n=s===e.Attribute,r=a.editMode===e.Geometry,l=(0,o.Immutable)(i[0]);this.dsManager.createDataSourceByUseDataSource(l).then((e=>{var i,a,s,d,c,u;const p=e.type===o.DataSourceTypes.SceneLayer?null==e?void 0:e.getAssociatedDataSource():e,m=null==p?void 0:p.getLayerDefinition(),h=null==m?void 0:m.allowGeometryUpdates,g=null==m?void 0:m.capabilities,f=(null==m?void 0:m.type)===o.SupportedLayerServiceTypes.Table,y=!r&&f||r,v=me(g,"create")&&y,S=me(g,"update"),b=me(g,"delete"),w=null==p?void 0:p.getSchema();let x=(null==w?void 0:w.fields)?Object.values(null==w?void 0:w.fields):[];const j=(null==m?void 0:m.fields)||[];x=x.filter((e=>!M.includes(e.name)));const C=null===(a=null===(i=null==p?void 0:p.layer)||void 0===i?void 0:i.formTemplate)||void 0===a?void 0:a.elements;if(C){const e=[];C.forEach((t=>{var i;const a=t;(null===(i=null==a?void 0:a.elements)||void 0===i?void 0:i.length)>0?null==a||a.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):a.fieldName&&e.push(a.fieldName)})),x=x.filter((t=>e.includes(t.name)))}(null==x?void 0:x.length)>50&&(x=x.slice(0,50));const I=x.map((e=>{const t=j.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),O=!!(null===(s=p.getRootDataSource())||void 0===s?void 0:s.map),D=Object.assign({id:p.id,name:p.getLabel(),layerId:null==p?void 0:p.jimuChildId,useDataSource:l,addRecords:v,deleteRecords:b,updateRecords:S,updateAttributes:S,updateGeometries:h&&S,featureSnapping:!1,showFields:x,groupedFields:I,layerHonorMode:O?t.Webmap:t.Custom},n?{layerEditingEnabled:null===(u=null===(c=null===(d=null==p?void 0:p.getMainDataSource())||void 0===d?void 0:d.layer)||void 0===c?void 0:c.editingEnabled)||void 0===u||u,isTable:f}:{});let T;if(this.props.config.layersConfig[this.index]){const e=this.props.config.layersConfig.asMutable({deep:!0});e.splice(this.index,1,D),T=(0,o.Immutable)(e)}else T=this.props.config.layersConfig.concat([(0,o.Immutable)(D)]);this.dsHash[this.index]=l,this.updateDsHash(T);const L={id:this.props.id,config:this.props.config.set("layersConfig",T),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(L)})).catch((e=>{console.error(e)}))},this.importAllLayersConfigSave=e=>we(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const i=yield(()=>we(this,void 0,void 0,(function*(){let i=this.props.config.layersConfig;const s=[];e.forEach((e=>{e.dataSourceId.startsWith("add-data")||s.push(this.dsManager.createDataSourceByUseDataSource((0,o.Immutable)(e)))}));const n=yield Promise.all(s);return e.forEach(((s,r)=>{var l,d,c,u,p;const m=n[r];if(!this.supportedDsTypes.includes(null==m?void 0:m.type))return;const h=m.type===o.DataSourceTypes.SceneLayer?null==m?void 0:m.getAssociatedDataSource():m,g=null==h?void 0:h.getLayerDefinition();if((null===(l=null==h?void 0:h.layer)||void 0===l?void 0:l.isTable)||(null==g?void 0:g.type)===o.SupportedLayerServiceTypes.Table||(null===(d=null==h?void 0:h.getDataSourceJson())||void 0===d?void 0:d.isHidden))return;const f=(0,o.Immutable)(s),y=(null==g?void 0:g.fields)||[],v=null==h?void 0:h.getSchema();let S=(null==v?void 0:v.fields)?Object.values(null==v?void 0:v.fields):[];S=S.filter((e=>!M.includes(e.jimuName)));const b=null===(u=null===(c=null==h?void 0:h.layer)||void 0===c?void 0:c.formTemplate)||void 0===u?void 0:u.elements;if(b){const e=[];b.forEach((t=>{var i;const a=t;(null===(i=null==a?void 0:a.elements)||void 0===i?void 0:i.length)>0?null==a||a.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):a.fieldName&&e.push(a.fieldName)})),S=S.filter((t=>e.includes(t.name)))}(null==S?void 0:S.length)>50&&(S=S.slice(0,50));const w=S.map((e=>{const t=y.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),x=null==g?void 0:g.allowGeometryUpdates,j=null==g?void 0:g.capabilities,C=me(j,"create"),I=me(j,"update"),O=me(j,"delete"),D=!!(null===(p=h.getRootDataSource())||void 0===p?void 0:p.map),T={id:h.id,name:h.getLabel(),layerId:null==h?void 0:h.jimuChildId,useDataSource:f,addRecords:C,deleteRecords:O,updateRecords:I,updateAttributes:I,updateGeometries:x&&I,featureSnapping:!1,showFields:S,groupedFields:w,layerHonorMode:D?t.Webmap:t.Custom};i=i.concat([(0,o.Immutable)(T)]),this.dsHash[this.index]=f,e.length===r+1&&0===i.length&&this.setState({importHintType:a.NoLayer},(()=>{setTimeout((()=>{this.setState({importHintType:void 0})}),3e3)}))})),i})))();this.updateDsHash(i.asMutable({deep:!0}));const s={id:this.props.id,config:this.props.config.set("layersConfig",i),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(s)})),this.updateAllUseDataSourcesFromViews=e=>{const{config:t}=this.props,{mapViewsConfig:i}=t,a=[];for(const t in e){const s=e[t].jimuLayerViews,o=null==i?void 0:i[t],n=null==o?void 0:o.customizeLayers,r=null==o?void 0:o.customJimuLayerViewIds;for(const e in s){const t=s[e];if(n&&!(null==r?void 0:r.includes(e)))continue;const i=null==t?void 0:t.getLayerDataSource();if(!i||!this.supportedDsTypes.includes(i.type))continue;const o=this.dsManager.getDataSource(i.id),l=he(o,t.jimuMapViewId);a.push(l)}}this.updateDsHash(a);const s={id:this.props.id,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(s)},this.onViewsCreate=t=>{const{config:i}=this.props,{editMode:a}=i,s=a===e.Geometry;this.setState({allLayerLoaded:!1});const o=Object.keys(t),n=o.length,r={};let l=0;o.forEach((e=>we(this,void 0,void 0,(function*(){r[e]=!1;const i=t[e];if(yield i.whenJimuMapViewLoaded(),yield i.whenAllJimuLayerViewLoaded(),r[e]=!0,l++,l===n){Object.values(r).every((e=>e))&&this.setState({jimuMapViews:t,allLayerLoaded:!0},(()=>{s&&this.updateAllUseDataSourcesFromViews(t)}))}}))))},this.onFilterDs=t=>{var i,a;if(!(null==t?void 0:t.url)||(null==t?void 0:t.isOutputFromWidget))return!0;const{useMapWidgetIds:s,config:n}=this.props,{layersConfig:r,editMode:l}=n,d=r.map((e=>e.id));let c=!1;if(l===e.Geometry){const e=null==s?void 0:s[0];if(!e)return!0;const n=this.dsManager.getDataSource(t.id),r=null==n?void 0:n.getLayerDefinition();if((null===(i=null==n?void 0:n.layer)||void 0===i?void 0:i.isTable)||(null==r?void 0:r.type)===o.SupportedLayerServiceTypes.Table)return!0;const l=(null===(a=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===a?void 0:a.useDataSources).map((e=>e.dataSourceId)),u=t.id.split("-")[0];c=!l.includes(u)||l.includes(u)&&d.includes(t.id)}else c=d.includes(t.id);return c},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>{const i=e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t}));return i},this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((t=>{const i=this.dsHash[t].dataSourceId;let a;a=e[i]?(0,o.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[i].fields,this.dsHash[t].fields)}):this.dsHash[t],e[i]=a}));const t=[];return Object.keys(e).forEach((i=>{t.push(e[i])})),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);let i=this.props.config.set("layersConfig",t);0===(null==t?void 0:t.length)&&(i=i.set("description","")),delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,T.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.getStyle=e=>o.css`
      .widget-setting-edit {
        .layerlist-tools{
          .layerlist-tools-item{
            display: flex;
            margin-bottom: 8px;
          }
        }

        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.sys.color.secondary.main};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .edit-tips{
          font-style: italic;
          font-size: 12px;
          color: ${e.ref.palette.neutral[1e3]};
        }
        .filter-item-active {
          border-left: 2px solid ${e.sys.color.primary.main};
        }
        .capability-header{
          margin-bottom: 12px;
        }
        .capability-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 12px;
        }
        .empty-placeholder {
          display: flex;
          flex-flow: column;
          justify-content: center;
          height: calc(100% - 379px);
          overflow: hidden;
          .empty-placeholder-inner {
            padding: 0px 20px;
            flex-direction: column;
            align-items: center;
            display: flex;

            .empty-placeholder-text {
              color: ${e.ref.palette.neutral[1e3]};
              font-size: ${o.polished.rem(14)};
              margin-top: 16px;
              text-align: center;
            }
            .empty-placeholder-icon {
              color: ${e.ref.palette.neutral[800]};
            }
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${o.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${o.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:je[e]},t),this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.onPropertyChange("layersConfig",[])},this.onShowLayerPanel=(e,t=!1)=>{const{showLayerPanel:i}=this.state;this.settSidePopperAnchor(e,t),e===this.index?this.setState({showLayerPanel:!i}):(this.setState({showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.settSidePopperAnchor=(e,t=!1)=>{let i;i=t?this.sidePopperTrigger.current.getElementsByClassName("add-edit-btn")[0]:this.sidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map((e=>e.itemStateDetailContent)),o={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.onEditModeChange=t=>{this.toBeChangedMode=t;const{config:i}=this.props,{editMode:a,layersConfig:s}=i;if(a===e.Attribute&&0===s.length)return this.onPropertyChange("editMode",this.toBeChangedMode),void this.setState({showLayerPanel:!1});t!==a&&this.setState({changeModeConfirmOpen:!0})},this.handleChangeModeOk=()=>{const e=[{name:"editMode",value:this.toBeChangedMode},{name:"layersConfig",value:[]},{name:"mapViewsConfig",value:{}}];this.onMultiplePropertyChange(e),this.setState({changeModeConfirmOpen:!1,showLayerPanel:!1})},this.handleChangeModeClose=()=>{this.setState({changeModeConfirmOpen:!1})},this.onLayerItemClick=(e,t)=>{this.index=t,this.setState({activeJmViewId:e})},this.onMapSettingClick=e=>{this.setState({activeJmViewId:e})},this.onLayerSettingChange=(e,t,i)=>{this.onMapModeSettingChange("layer",{viewId:e,key:t,value:i})},this.onMultipleLayerSettingChange=(e,t)=>{this.onMapModeSettingChange("layer-multiple",{viewId:e,updateOptions:t})},this.onMapLayersConfigChange=(e,t)=>{this.onMapModeSettingChange("single",{key:e,value:t})},this.onMapLayersMultipleConfigChange=e=>{this.onMapModeSettingChange("multiple",e)},this.onMapLayersConfigActiveIdSet=e=>{this.setState({activeId:e})},this.getDefaultConfig=()=>{const{activeId:e,jimuMapViews:t,activeJmViewId:i}=this.state,a=t[i].jimuLayerViews[`${i}${e.substring(e.indexOf("-"))}`],s=this.dsManager.getDataSource(null==a?void 0:a.layerDataSourceId);return he(s,null==a?void 0:a.jimuMapViewId)},this.getUpdateObject=(e,t,i)=>{let a;if("single"===t){const{key:t,value:s}=i;a=Object.assign(Object.assign({},e),{[t]:s})}else"multiple"===t&&(a=Object.assign(Object.assign({},e),i));return a},this.onMapModeSettingChange=(e,t)=>{const{id:i,config:a}=this.props,{activeId:s,jimuMapViews:o,activeJmViewId:n}=this.state,r=a,l=r.mapViewsConfig,d="layer"===e,c="layer-multiple"===e;if(null==l?void 0:l[n]){let a;if(d){const{viewId:e,key:s,value:o}=t;a=r.setIn(["mapViewsConfig",e,s],o);const n={id:i,config:a};return void this.props.onSettingChange(n)}if(c){const{viewId:e,updateOptions:s}=t,o=Object.assign(Object.assign({},l[e]),s);a=r.setIn(["mapViewsConfig",e],o);const n={id:i,config:a};return void this.props.onSettingChange(n)}const o=l[n],u=o.layersConfig.findIndex((e=>e.id===s));if(u>-1){const s=o.layersConfig[u],l=this.getUpdateObject(s.asMutable({deep:!0}),e,t);a=r.setIn(["mapViewsConfig",n,"layersConfig",u.toString()],l);const d={id:i,config:a};this.props.onSettingChange(d)}else{const s=this.getDefaultConfig(),l=o.layersConfig.asMutable({deep:!0}),d=this.getUpdateObject(s,e,t);l.push(d),a=r.setIn(["mapViewsConfig",n,"layersConfig"],l);const c={id:i,config:a};this.props.onSettingChange(c)}}else{let a;const s=Object.keys(o[n].jimuLayerViews);if(d){const{viewId:e,key:i,value:o}=t;a={parentViewId:n||e,customizeLayers:!1,customJimuLayerViewIds:s,layersConfig:[],[i]:o}}else if(c){const{viewId:e,updateOptions:i}=t;a=Object.assign({parentViewId:n||e,customizeLayers:!1,customJimuLayerViewIds:s,layersConfig:[]},i)}else{const i=this.getDefaultConfig();a={parentViewId:n,customizeLayers:!1,customJimuLayerViewIds:s,layersConfig:[this.getUpdateObject(i,e,t)]}}const l={id:i,config:r.setIn(["mapViewsConfig",n],a)};this.props.onSettingChange(l)}},this.onPropertyChange=(e,t)=>{const{config:i}=this.props;if(t===i[e])return;const a=i.set(e,t),s={id:this.props.id,config:a};this.props.onSettingChange(s)},this.onMultiplePropertyChange=e=>{const{config:t}=this.props;let i=t;e.forEach((e=>{e.value!==t[e.name]&&(i=i.set(e.name,e.value))}));const a={id:this.props.id,config:i};this.props.onSettingChange(a)},this.getAllLayersOptions=()=>{const e=[],{jimuMapViews:t,allLayerLoaded:i}=this.state;return i?(Object.keys(t).forEach((i=>{var a,s;const o=t[i].jimuLayerViews;for(const t in o){const i=null===(s=null===(a=o[t])||void 0===a?void 0:a.getLayerDataSource())||void 0===s?void 0:s.getDataSourceJson();i&&e.push({value:i.id,label:i.sourceLabel})}})),e):e},this.getSnapLayers=e=>{const t=[],{jimuMapViews:i}=this.state;return Object.keys(i).forEach((a=>{var s,o;const n=i[a].jimuLayerViews;for(const i in n){const a=null===(o=null===(s=n[i])||void 0===s?void 0:s.getLayerDataSource())||void 0===o?void 0:o.getDataSourceJson();a&&(null==e?void 0:e.includes(a.id))&&t.push({value:a.id,label:a.sourceLabel})}})),t},this.onSnapLayersChange=e=>{e||(e=[]);const t=e.map((e=>e.value));this.onPropertyChange("defaultSnapLayers",t)},this.onTooltipToggle=e=>{const t=[{name:"tooltip",value:e},{name:"defaultTooltipEnabled",value:!1}];this.onMultiplePropertyChange(t)},this.displaySelectedLayers=e=>this.formatMessage("numSelected",{number:e.length}),this.isDataSourceEmpty=()=>{var e,t,i;const a=(null===(e=z.MapViewManager.getInstance().getJimuMapViewGroup(this.props.useMapWidgetIds[0]))||void 0===e?void 0:e.jimuMapViews)||{};return 1===Object.keys(a).length&&!(null===(i=null===(t=Object.values(a))||void 0===t?void 0:t[0])||void 0===i?void 0:i.dataSourceId)},this.getLayersSettingContent=()=>{var e;return(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e.length)>0&&(0,o.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,o.jsx)(r.SettingRow,null,this.isDataSourceEmpty()?(0,o.jsx)(n.Alert,{tabIndex:0,className:"warningMsg",open:!0,text:this.formatMessage("noWebMapWebSceneTip"),type:"warning"}):this.getTableLayerList()))},this.getTableLayerList=()=>{const{jimuMapViews:t}=this.state,{config:i,theme:a,theme2:s,id:n,intl:r,useMapWidgetIds:l}=this.props,{editMode:d}=i,c={theme:a,theme2:s,widgetId:n,intl:r,isMapMode:d===e.Geometry};return(0,o.jsx)("div",{ref:this.customizeLayersTrigger,className:"w-100"},Object.keys(t).map((e=>{var a,s;const n=t[e];return(0,o.jsx)(be,Object.assign({},c,{key:e,jimuMapView:n,sidePopperTrigger:null===(a=this.sidePopperTrigger)||void 0===a?void 0:a.current,mapViewConfig:null===(s=null==i?void 0:i.mapViewsConfig)||void 0===s?void 0:s[e],useMapWidgetIds:l,onLayerItemClick:this.onLayerItemClick,onMapSettingClick:this.onMapSettingClick,onLayerSettingChange:this.onLayerSettingChange,onMultipleLayerSettingChange:this.onMultipleLayerSettingChange,onMapLayersConfigChange:this.onMapLayersConfigChange,onMapLayersMultipleConfigChange:this.onMapLayersMultipleConfigChange,onMapLayersConfigActiveIdSet:this.onMapLayersConfigActiveIdSet}))})))},this.index=0,this.dsManager=o.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={showLayerPanel:!1,refreshPanel:!1,dataSources:{},changeModeConfirmOpen:!1,importHintType:void 0,popperFocusNode:null,jimuMapViews:{},allLayerLoaded:!1,activeJmViewId:"",activeId:""}}componentDidUpdate(t){const{useMapWidgetIds:i,config:a}=this.props,{mapViewsConfig:s,editMode:n}=a,r=n===e.Geometry,{jimuMapViews:l}=this.state,{useMapWidgetIds:d,config:c}=t,{mapViewsConfig:u}=c;(null==i?void 0:i[0])!==(null==d?void 0:d[0])&&this.onPropertyChange("defaultSnapLayers",[]),!o.lodash.isDeepEqual(s,u)&&r&&this.updateAllUseDataSourcesFromViews(l)}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var t,i,l,d,c,u,m,h;const{showLayerPanel:g,changeModeConfirmOpen:f,importHintType:y,allLayerLoaded:v}=this.state,{theme:S,config:b,useMapWidgetIds:w}=this.props,{layersConfig:x,editMode:j,selfSnapping:C,featureSnapping:M,defaultSelfEnabled:O,defaultFeatureEnabled:T,defaultSnapLayers:N,snapSettingMode:A,tooltip:k,defaultTooltipEnabled:E,templateFilter:P,relatedRecords:V,liveDataEditing:B,initialReshapeMode:U}=b,J=j===e.Attribute,G=j===e.Geometry,_=J?this.formatMessage("newEdit"):this.formatMessage("newEditGeo"),$=J?this.formatMessage("editableSource"):this.formatMessage("editableLayer"),W=x.length,q=(0,o.getAppStore)().getState().appStateInBuilder.appConfig,K=null==w?void 0:w[0],Q=G&&(!w||0===(null==w?void 0:w.length)||!(null===(t=q.widgets)||void 0===t?void 0:t[K])),Y={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},X=G?(null==w?void 0:w.length)>0:W>0,Z=H(K).find((e=>{var t;return(null===(t=x[this.index])||void 0===t?void 0:t.id)===e.id})),ee=G?null===(d=null===(l=null===(i=null==Z?void 0:Z.getMainDataSource())||void 0===i?void 0:i.layer)||void 0===l?void 0:l.editingEnabled)||void 0===d||d:null===(c=x[this.index])||void 0===c?void 0:c.layerEditingEnabled,te=window.isExpressBuilder;return(0,o.jsx)("div",{css:this.getStyle(S),className:"h-100"},(0,o.jsx)("div",{className:"jimu-widget-setting widget-setting-edit h-100"},null===(u=this.props.useDataSources)||void 0===u?void 0:u.map(((e,t)=>(0,o.jsx)(L,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,o.jsx)(r.SettingSection,{role:"group",title:this.formatMessage("mode")},(0,o.jsx)("div",{ref:this.sidePopperTrigger},(0,o.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,o.jsx)("div",{role:"radiogroup",className:"mb-4"},(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:J,onChange:()=>{this.onEditModeChange(e.Attribute)}}),this.formatMessage("attrMode")),(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:G,onChange:()=>{this.onEditModeChange(e.Geometry)}}),this.formatMessage("interactWithMap"))),G&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(r.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:w})),y&&(0,o.jsx)(n.Alert,{withIcon:!0,tabIndex:0,className:"w-100 mt-2 mb-2",open:!0,closable:!0,onClose:()=>{this.setState({importHintType:void 0})},text:y===a.NoLayer?this.formatMessage("noLayerTips"):this.formatMessage("selectMapTip"),type:"warning"})),J&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(W,!0)},disabled:Q,title:_,"aria-label":_,"aria-describedby":"edit-blank-msg"},(0,o.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,o.jsx)(R,{className:"mr-1 mb-1"}),_))),J&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)("div",{className:"text-break edit-tips"},this.formatMessage("newEditTips")))),J&&(0,o.jsx)(r.SettingSection,{className:"border-0 pt-0 pl-0 pr-0"},(0,o.jsx)("div",{className:"setting-ui-unit-list"},!!W&&(0,o.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-existing",itemsJson:Array.from(b.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:e.name,itemStateChecked:g&&t===this.index,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:xe,size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var i,a;const{itemJsons:s}=t.props,[r]=s,l=null===(a=null===(i=null==r?void 0:r.itemStateDetailContent)||void 0===i?void 0:i.useDataSource)||void 0===a?void 0:a.dataSourceId;return this.isDataSourceAccessible(l)?"":(0,o.jsx)(n.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;this.onShowLayerPanel(+i.itemKey)}},Y)),W===this.index&&g&&(0,o.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateTitle:e.name,itemStateChecked:!0,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},Y)))),G&&this.getLayersSettingContent(),G&&X&&!this.isDataSourceEmpty()&&(0,o.jsx)(r.SettingSection,{role:"group",title:this.formatMessage("snappingSettings"),"aria-label":this.formatMessage("snappingSettings"),className:"border-0 pt-0 pl-0 pr-0"},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Select,{size:"sm",className:"w-100",value:A,onChange:e=>{this.onPropertyChange("snapSettingMode",e.target.value)}},(0,o.jsx)("option",{value:s.Prescriptive},this.formatMessage("prescriptiveMode")),(0,o.jsx)("option",{value:s.Flexible},this.formatMessage("flexibleMode")))),A===s.Prescriptive?(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:O,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultSelfEnabled",e.target.checked)}}),this.formatMessage("selfSnapping"))),(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:T,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultFeatureEnabled",e.target.checked)}}),this.formatMessage("featureSnapping")))):(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,{label:this.formatMessage("selfSnapping")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:C,"data-key":"selfSnapping",onChange:e=>{this.onPropertyChange("selfSnapping",e.target.checked)},"aria-label":this.formatMessage("selfSnapping")})),C&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:O,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultSelfEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled"))),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("featureSnapping")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:M,"data-key":"featureSnapping",onChange:e=>{this.onPropertyChange("featureSnapping",e.target.checked)},"aria-label":this.formatMessage("featureSnapping")})),M&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:T,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultFeatureEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled")))),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("chooseDefault"),className:"select-option"},(0,o.jsx)(n.AdvancedSelect,{size:"sm",title:this.formatMessage("chooseDefault"),fluid:!0,hideCheckAll:!1,hideBottomTools:!0,hideSearchInput:!0,staticValues:this.getAllLayersOptions(),sortValuesByLabel:!1,isMultiple:!0,selectedValues:this.getSnapLayers(N),onChange:this.onSnapLayersChange,"aria-label":this.formatMessage("chooseDefault"),buttonProps:{disabled:!v}}))))),0===W&&!g&&!te&&J&&(0,o.jsx)("div",{className:"empty-placeholder w-100"},(0,o.jsx)("div",{className:"empty-placeholder-inner"},(0,o.jsx)("div",{className:"empty-placeholder-icon"},(0,o.jsx)(F,{size:48})),(0,o.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:this.formatMessage("editBlankStatus",{EditString:_,ModeString:$})}}))),X&&(!G||!this.isDataSourceEmpty())&&(0,o.jsx)(r.SettingSection,{role:"group","aria-label":this.formatMessage("iconGroup_general"),title:this.formatMessage("iconGroup_general")},G&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,{label:this.formatMessage("tooltip")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:k,"data-key":"tooltip",onChange:e=>{this.onTooltipToggle(e.target.checked)},"aria-label":this.formatMessage("tooltip")})),k&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:E,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultTooltipEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled"))),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("templateFilter")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:P,"data-key":"templateFilter",onChange:e=>{this.onPropertyChange("templateFilter",e.target.checked)},"aria-label":this.formatMessage("templateFilter")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("relatedRecords")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:V,"data-key":"relatedRecords",onChange:e=>{this.onPropertyChange("relatedRecords",e.target.checked)},"aria-label":this.formatMessage("relatedRecords")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("runtimeDataEditing")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:B,"data-key":"liveDataEditing",onChange:e=>{this.onPropertyChange("liveDataEditing",e.target.checked)},"aria-label":this.formatMessage("runtimeDataEditing")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("initialReshapeMode")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:U,"data-key":"initialReshapeMode",onChange:e=>{this.onPropertyChange("initialReshapeMode",e.target.checked)},"aria-label":this.formatMessage("initialReshapeMode")}))),J&&(0,o.jsx)(I.Fragment,null,(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("description")},(0,o.jsx)(n.TextArea,{className:"w-100",height:90,"aria-label":this.formatMessage("description"),placeholder:this.formatMessage("editFieldDescription"),defaultValue:null!==(m=b.description)&&void 0!==m?m:"",onBlur:e=>{this.onPropertyChange("description",e.target.value)}})),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("noDataMessage")},(0,o.jsx)(n.TextArea,{className:"w-100",height:75,"aria-label":this.formatMessage("noDataMessage"),placeholder:this.formatMessage("noDataMessageDefaultText"),defaultValue:b.noDataMessage,onBlur:e=>{this.onPropertyChange("noDataMessage",e.target.value)}})))),(0,o.jsx)(z.JimuMapViewComponent,{useMapWidgetId:null==w?void 0:w[0],onViewsCreate:this.onViewsCreate}),(0,o.jsx)(r.SidePopper,{position:"right",isOpen:g&&!o.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:this.onCloseLayerPanel,trigger:null===(h=this.sidePopperTrigger)||void 0===h?void 0:h.current,backToFocusNode:this.state.popperFocusNode},(0,o.jsx)(D,Object.assign({},b.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:S,isMapMode:G,layerEditingEnabled:ee,dataSourceChange:this.dataSourceChangeSave,filterDs:this.onFilterDs,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onClose:this.onCloseLayerPanel}))),f&&(0,o.jsx)(n.ConfirmDialog,{level:"warning",title:this.formatMessage("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:this.formatMessage("changeModeConfirmTips"),onConfirm:this.handleChangeModeOk,onClose:this.handleChangeModeClose})))}}Ce.mapExtraStateProps=(e,t)=>{var i,a;return{activeTabId:null===(a=null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId}};const Me=Ce;function Ie(e){c.p=e}})(),u})())}}}));