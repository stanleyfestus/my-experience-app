System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/FeatureForm","esri/widgets/Editor","esri/layers/FeatureLayer","esri/layers/OrientedImageryLayer","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/GroupElement","esri/Graphic","esri/rest/support/Query","esri/core/reactiveUtils"],(function(e,t){var i={},s={},o={},a={},n={},r={},l={},d={},u={},c={},p={},h={},f={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.React=e.React,i.ServiceManager=e.ServiceManager,i.SessionManager=e.SessionManager,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.WidgetState=e.WidgetState,i.WidgetVersionManager=e.WidgetVersionManager,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.privilegeUtils=e.privilegeUtils},function(e){s.ADD_TO_MAP_DATA_ID_PREFIX=e.ADD_TO_MAP_DATA_ID_PREFIX,s.JimuMapViewComponent=e.JimuMapViewComponent,s.LayerTypes=e.LayerTypes,s.SHOW_ON_MAP_DATA_ID_PREFIX=e.SHOW_ON_MAP_DATA_ID_PREFIX},function(e){o.Button=e.Button,o.Loading=e.Loading,o.Select=e.Select,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){a.default=e.default},function(e){n.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){p.default=e.default},function(e){h.default=e.default},function(e){f.default=e.default}],execute:function(){e((()=>{var e={37201:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 400 400"><path fill="#A8A8A8" fill-rule="evenodd" d="M193 10H10v28h183zm197 53H10v2h380zM10 299h380v2H10zm142-196H25v22h127zm235.99-11H12.01v44h375.98zM10 90v48h380V90zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14M25 171h127v22H25zm-12.99-11h375.98v44H12.01zM10 206v-48h380v48zm362-24c0 7.732-6.268 14-14 14s-14-6.268-14-14 6.268-14 14-14 14 6.268 14 14m-220 57H25v22h127zm235.99-11H12.01v44h375.98zM10 226v48h380v-48zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14m-188 62H10v22h160zm209 2h-18a9 9 0 0 0-9 9 9 9 0 0 0 9 9h18a9 9 0 0 0 9-9 9 9 0 0 0-9-9m-18-2c-6.075 0-11 4.925-11 11s4.925 11 11 11h18c6.075 0 11-4.925 11-11s-4.925-11-11-11zm25 11a7 7 0 1 1-14 0 7 7 0 0 1 14 0M10 367h160v22H10zm351 2h18a9 9 0 0 1 9 9 9 9 0 0 1-9 9h-18a9 9 0 0 1-9-9 9 9 0 0 1 9-9m-11 9c0-6.075 4.925-11 11-11h18c6.075 0 11 4.925 11 11s-4.925 11-11 11h-18c-6.075 0-11-4.925-11-11m29 7a7 7 0 1 0 0-14 7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},22089:e=>{"use strict";e.exports=p},62243:e=>{"use strict";e.exports=f},38410:e=>{"use strict";e.exports=d},82228:e=>{"use strict";e.exports=u},20277:e=>{"use strict";e.exports=c},85633:e=>{"use strict";e.exports=r},92195:e=>{"use strict";e.exports=l},36510:e=>{"use strict";e.exports=h},48816:e=>{"use strict";e.exports=n},73387:e=>{"use strict";e.exports=a},62686:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o}},t={};function v(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,v),o.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var m={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(m),v.d(m,{ModifyType:()=>Me,__set_webpack_public_path__:()=>Ne,default:()=>Oe});var e,t,i,s,o,a=v(79244);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.Added="Added",e.Updated="Updated",e.Deleted="Deleted"}(i||(i={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(s||(s={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(o||(o={}));var n=v(62686);var r=v(14321);function l(e,t,i,s,o){return a.css`
    ${"&.edit-widget-"+t} {
      .esri-feature-form__input:focus,
      calcite-input:focus{
        outline: unset !important;
        outline-offset: unset !important;
      }
      .editor-white-bg{
        background-color: ${e.ref.palette.white};
      }
      [heading='Edit feature'] .esri-editor__panel-content{
        padding: 0;
        .esri-editor__panel-content--section{
          padding: 8px 16px;
        }
      }
      .esri-editor__content{
        padding: 8px 16px;
      }
      .esri-feature-form{
        ${("empty"===i||"list"===i)&&`border-bottom: 1px solid ${e.ref.palette.neutral[300]};`}
        background-color: unset;
        .esri-feature-form__form-header{
          margin: 0;
          .esri-feature-form__description-text{
            font-weight: 500;
            font-size: 13px;
            margin: 0;
          }
        }
      }
      .esri-feature-templates{
        width: 100%;
        height: calc(100% - 40px);
        .esri-item-list{
          height: 100%;
          .esri-item-list__scroller{
            height: 100%;
          }
        }
      }
      .esri-editor__temp-wrapper{
        height: 100%;
      }
      .esri-editor__header{
        min-height: 56px;
        padding-left: ${o&&1!==s?"35px":"15px"};
        .esri-widget__heading{
          font-weight: 600;
          font-size: 16px;
          margin: 0 8px;
          text-align: left;
          padding: 1px 0;
          height: 56px;
          line-height: 54px
        }
      }
      .esri-editor__controls{
        border-top: 1px solid rgba(110,110,110,.3);
        padding: 12px 15px;
        display: flex;
        flex-direction: column;
        ${!o&&"justify-content: space-between !important; flex-direction: row !important;"}
        .esri-editor__control-button:first-of-type{
          color: ${e.ref.palette.white};
          background-color: ${e.sys.color.primary.main};
          border: 1px solid ${e.sys.color.primary.main};
          :hover{
            background-color: ${e.sys.color.primary.main};
          }
        }
        .esri-editor__control-button{
          color: ${e.ref.palette.neutral[1100]};
          background-color: ${e.ref.palette.white};
          border: 1px solid ${e.ref.palette.neutral[500]};
          :hover{
            background-color: ${e.ref.palette.neutral[200]};
          }
        }
        .esri-editor__control-button + .esri-editor__control-button{
          margin-left: 2%;
        }
      }
      .esri-item-list__list-item{
        :focus,
        :focus-visible {
          outline-offset: -2px !important;
        }
      }
      .esri-item-list__list{
        list-style: none;
        margin: 0;
        padding: 0;
        .esri-item-list__list-item{
          cursor: pointer;
          margin-bottom: 6px;
          min-height: 48px;
          transition: border 250ms ease-in-out;
          display: flex;
          justify-content: space-between;
          .esri-item-list__list-item-container{
            display: flex;
            margin: 9px 2px;
            width: 100%;
            .esri-item-list__list-item-label{
              flex: 1;
              margin: 0;
              display: flex;
              align-items: center;
              word-break: break-word;
              padding-left: 20px;
            }
          }
        }
      }
      .esri-item-list__scroller {
        position: relative;
        z-index: 0;
      }

      .esri-editor__feature-list-item,
      .esri-item-list__list-item{
        border-color: ${e.ref.palette.neutral[300]};
        box-shadow: unset;
        :hover{
          border-color: ${e.ref.palette.neutral[900]};
        }
      }
      .confirm-scrim{
        position: absolute;
        background-color: var(--calcite-scrim-background);
        width: 100%;
        height: 100%;
        top: 0;
      }
      .esri-editor__prompt__actions{
        .esri-editor__warning-option--primary,
        .esri-editor__warning-option--positive{
          text-align: center;
          padding: ${a.polished.rem(4)} ${a.polished.rem(16)};
          line-height: ${a.polished.rem(22)};
          border: 1px solid var(--calcite-ui-danger);
          border-radius: 0;
          flex: 1;
        }
        .esri-editor__warning-option--primary{
          background-color: transparent;
          color: var(--calcite-ui-danger);
          :hover{
            border-color: var(--calcite-ui-danger-hover);
            color: var(--calcite-ui-danger-hover);
            box-shadow: inset 0 0 0 1px var(--calcite-ui-danger-hover);
          }
        }
        .esri-editor__warning-option--positive{
          background-color: var(--calcite-ui-danger);
          color: ${e.ref.palette.white};
          :hover{
            border-color: var(--calcite-ui-danger-hover);
            background-color: var(--calcite-ui-danger-hover);
          }
        }
      }
      .esri-feature-table__loader-container{
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        margin: unset;
        background-color: ${a.polished.rgba(e.sys.color.secondary.main,.3)};
        .esri-feature-table__loader{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
      }

      .attr-height{
        overflow-y: auto;
        height: calc(100% - 113px);
      }
      .snapping-option{
        position: absolute;
        top: 170px;
        width: calc(100% - 33px);
        margin: 10px 16px;
        padding: 16px 7px 10px;
        border-top: 1px solid ${e.ref.palette.neutral[400]};
        .snapping-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 16px;
        }
      }
      .feature-list{
        height: calc(100% - 57px);
        background-color: var(--calcite-ui-background);
        max-height: unset;
        .esri-item-list{
          background-color: unset;
        }
        .esri-item-list__list-item{
          background-color: var(--calcite-ui-foreground-1);
          :hover{
            cursor: pointer;
            background-color: var(--calcite-ui-foreground-2);
          }
        }
        .esri-editor__scroller{
          overflow-y: auto;
          max-height: unset;
        }
      }
      .esri-editor__scroller{
        overflow-y: auto;
        max-height: unset;
        .esri-item-list__scroller{
          max-height: unset;
        }
      }
      .esri-item-list__group{
        padding: 0 12px;
      }
      .esri-editor__message{
        margin: auto;
      }
      .form-header-container{
        border-bottom: 1px solid ${e.ref.palette.neutral[300]};.
      }
      .esri-editor__header{
        padding-left: unset;
      }
      .back-button{
        width: 32px;
        padding-inline: ${a.polished.rem(8)};
        padding-block: ${a.polished.rem(4)};
        line-height: ${a.polished.rem(16)};
        color: ${e.ref.palette.black};
        border-top: 0px !important;
        border-left: 0px !important;
        border-bottom: 0px !important;
        border-style: solid;
        border-color: var(--calcite-ui-border-3);
        border-inline-end-width: 1px;
      }
      .layer-selector{
        padding: 12px 15px;
      }
      .single-buttons{
        flex: 1;
      }
      .multi-buttons{
        width: 49%;
      }
      .add-feature-btn{
        position: absolute;
        right: 15px;
        top: 12px;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .back-list-btn{
        position: absolute;
        left: 15px;
        top: 15px;
      }
      .edit-blank{
        min-height: 300px;
        .placeholder-icon{
          color: ${e.ref.palette.neutral[800]};
        }
        & > div{
          top: calc(50% + 20px);
          transform: translateY(-50%);
        }
        p{
          font-size: ${a.polished.rem(14)};
          margin-top: ${a.polished.rem(16)};
          line-height: ${a.polished.rem(19)};
          color: ${e.ref.palette.neutral[1e3]};
        }
      }
    }
  `}class d extends a.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onDataSourceInfoChange=(e,t)=>{this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,null==e?void 0:e.status);const i=null==t?void 0:t.selectedIds,s=null==e?void 0:e.selectedIds,o=i!==s&&(0!==(null==i?void 0:i.length)||0!==(null==s?void 0:s.length)),a=null==t?void 0:t.gdbVersion,n=null==e?void 0:e.gdbVersion,r=null==t?void 0:t.sourceVersion,l=null==e?void 0:e.sourceVersion,d=null==t?void 0:t.version,u=null==e?void 0:e.version;o?this.props.onDataSourceSelectedChange(this.props.useDataSource.dataSourceId,s):a===n&&r===l&&d===u||this.props.onDataSourceVersionChange(this.props.useDataSource.dataSourceId)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}componentWillUnmount(){this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null),this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,a.DataSourceStatus.NotReady)}render(){const{useDataSource:e}=this.props;return(0,a.jsx)(a.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed,onDataSourceInfoChange:this.onDataSourceInfoChange})}}var u=v(23662),c=v.n(u),p=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const h=e=>{const t=window.SVG,{className:i}=e,s=p(e,["className"]),o=(0,a.classNames)("jimu-icon jimu-icon-component",i);return t?a.React.createElement(t,Object.assign({className:o,src:c()},s)):a.React.createElement("svg",Object.assign({className:o},s))};var f=v(45508),g=v.n(f),y=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const b=e=>{const t=window.SVG,{className:i}=e,s=y(e,["className"]),o=(0,a.classNames)("jimu-icon jimu-icon-component",i);return t?a.React.createElement(t,Object.assign({className:o,src:g()},s)):a.React.createElement("svg",Object.assign({className:o},s))};var S=v(73387),w=v(48816),I=v(85633),x=v(92195),C=v(38410),D=v(82228),E=v(20277),_=v(22089),j=v(36510);const F=["CreationDate","Creator","EditDate","Editor","GlobalID"];var L=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};class M extends a.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.7.0",description:"Add layerHonorMode to config for support smart form.",upgrader:e=>L(this,void 0,void 0,(function*(){let i=e;const s=(e,t)=>{const i=[],s=e=>(e.forEach((e=>{if(e.groupKey)s(e.children);else{const s=t.find((t=>t.name===e.jimuName));F.includes(e.jimuName)||i.push(Object.assign(Object.assign({},e),{editable:null==s?void 0:s.editable,editAuthority:!!(null==s?void 0:s.editable)&&(null==e?void 0:e.editAuthority)}))}})),i);return s(e)};return yield Promise.all(i.layersConfig.map((e=>new Promise((t=>{a.DataSourceManager.getInstance().createDataSourceByUseDataSource(e.useDataSource).then((i=>{const o=null==i?void 0:i.getLayerDefinition(),a=(null==o?void 0:o.fields)||[],n=e.groupedFields.map((e=>{var t;const i=a.find((t=>t.name===e.jimuName));return e.groupKey?Object.assign(Object.assign({},e),{editable:!0,editAuthority:!(null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.some((e=>!1===e.editAuthority))),children:s(null==e?void 0:e.children,a)}):Object.assign(Object.assign({},e),{editable:null==i?void 0:i.editable,editAuthority:!!(null==i?void 0:i.editable)&&(null==e?void 0:e.editAuthority)})})).filter((e=>!F.includes(e.jimuName)));t(n)}))}))))).then((e=>(e.forEach(((e,s)=>{const o=i.layersConfig[s].showFields.filter((e=>!F.includes(e.jimuName)));let n=[];const r=e.asMutable({deep:!0});e.forEach((e=>{e.groupKey?n=n.concat(e.children):n.push(e)})),o.forEach((e=>{n.find((t=>t.jimuName===e.jimuName))||r.push(e)})),i=i.setIn(["layersConfig",s,"groupedFields"],(0,a.Immutable)(r)),i=i.setIn(["layersConfig",s,"layerHonorMode"],t.Custom)})),Promise.resolve(i))))}))},{version:"1.10.0",description:"Set old app default snapping to true",upgrader:e=>L(this,void 0,void 0,(function*(){let t=e;return t=t.set("selfSnapping",!0).set("featureSnapping",!0),t}))},{version:"1.12.0",description:'Set "undefined" option to "false", and remove not editable layer',upgrader:t=>L(this,void 0,void 0,(function*(){var i,s,o;let n=t;const r=n.editMode===e.Geometry,l=a.DataSourceManager.getInstance(),d=[];for(const e of n.layersConfig){let t;try{t=yield l.createDataSourceByUseDataSource(null==e?void 0:e.useDataSource)}catch(e){console.error(e)}if(!t){d.push(e);continue}const n=null==t?void 0:t.getLayerDefinition(),u=(null===(i=null==t?void 0:t.layer)||void 0===i?void 0:i.isTable)||(null==n?void 0:n.type)===a.SupportedLayerServiceTypes.Table;if(r&&u)continue;const c=null==n?void 0:n.allowGeometryUpdates;if(null===(o=null===(s=null==t?void 0:t.layer)||void 0===s?void 0:s.editingEnabled)||void 0===o||o){let t;t=e.updateGeometries?Object.assign(Object.assign({},e),{updateRecords:!0,updateAttributes:!0,updateGeometries:c&&!0}):Object.assign(Object.assign({},e),{updateRecords:!1,updateAttributes:!1,updateGeometries:!1}),d.push(t)}}return n=n.setIn(["layersConfig"],d),n}))},{version:"1.13.0",description:"Update snap options",upgrader:e=>L(this,void 0,void 0,(function*(){let t=e;return t.selfSnapping&&(t=t.set("defaultSelfEnabled",!0)),t.featureSnapping&&(t=t.set("defaultFeatureEnabled",!0)),t}))},{version:"1.14.0",description:"Add predefine snapping options",upgrader:e=>L(this,void 0,void 0,(function*(){let t=e;return t=t.set("snapSettingMode",o.Flexible),t}))},{version:"1.15.0",description:"Add general setting options",upgrader:e=>L(this,void 0,void 0,(function*(){let t=e;return t=t.set("tooltip",!0).set("templateFilter",!0).set("relatedRecords",!0),t}))},{version:"1.16.0",description:"Update map mode config",upgradeFullInfo:!0,upgrader:t=>L(this,void 0,void 0,(function*(){const i=t.widgetJson,s=i.config;if(!s)return t;let o=s;const{editMode:n,layersConfig:r}=s,l={},d=(e,t,i)=>L(this,void 0,void 0,(function*(){try{const s=yield a.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,a.Immutable)({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:t}));if(!s)return console.error("Cannot create layer data source.",e),null;return`${i}-${s.jimuLayerId}`}catch(e){return console.error("Cannot create layer data source.",e),null}}));if(n===e.Geometry){const e=i.useMapWidgetIds[0];for(const t of r){const i=t.id,s=i.indexOf("-"),o=t.id.substring(0,s),n=`${e}-${o}`,r=yield d(i,o,n);if(!r)continue;const u=t.asMutable({deep:!0});if(u.parentViewId=n,l[n]){l[n].customJimuLayerViewIds.push(r);const e=l[n].layersConfig.asMutable({deep:!0});e.push(u),l[n].layersConfig=(0,a.Immutable)(e)}else{const e={parentViewId:n,customizeLayers:!0,customJimuLayerViewIds:[r],layersConfig:(0,a.Immutable)([u])};l[n]=e}}o=o.set("mapViewsConfig",l)}const u=i.set("config",(0,a.Immutable)(o));return Object.assign(Object.assign({},t),{widgetJson:u})}))}]}}const A=new M;var O=v(28996),N=v.n(O),T=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const R=e=>{const t=window.SVG,{className:i}=e,s=T(e,["className"]),o=(0,a.classNames)("jimu-icon jimu-icon-component",i);return t?a.React.createElement(t,Object.assign({className:o,src:N()},s)):a.React.createElement("svg",Object.assign({className:o},s))};var k=v(62243),V=v(50170),P=v.n(V),U=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const $=e=>{const t=window.SVG,{className:i}=e,s=U(e,["className"]),o=(0,a.classNames)("jimu-icon jimu-icon-component",i);return t?a.React.createElement(t,Object.assign({className:o,src:P()},s)):a.React.createElement("svg",Object.assign({className:o},s))};var B=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const W=["CreationDate","Creator","EditDate","Editor","GlobalID"],H=[n.LayerTypes.FeatureLayer,n.LayerTypes.SceneLayer,n.LayerTypes.BuildingComponentSublayer,n.LayerTypes.OrientedImageryLayer,n.LayerTypes.SubtypeSublayer],G=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),z=(e,i)=>{var s,o,n;const r=null==e?void 0:e.getLayerDefinition(),l=null==r?void 0:r.allowGeometryUpdates,d=null==r?void 0:r.capabilities,u=G(d,"create"),c=G(d,"update"),p=G(d,"delete"),h=null==e?void 0:e.getSchema();let f=(null==h?void 0:h.fields)?Object.values(null==h?void 0:h.fields):[];const v=(null==r?void 0:r.fields)||[];f=f.filter((e=>!W.includes(e.name)));const m=null===(o=null===(s=null==e?void 0:e.layer)||void 0===s?void 0:s.formTemplate)||void 0===o?void 0:o.elements;if(m){const e=[];m.forEach((t=>{var i;const s=t;(null===(i=null==s?void 0:s.elements)||void 0===i?void 0:i.length)>0?null==s||s.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):s.fieldName&&e.push(s.fieldName)})),f=f.filter((t=>e.includes(t.name)))}(null==f?void 0:f.length)>50&&(f=f.slice(0,50));const g=f.map((e=>{const t=v.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),y={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(n=e.getRootDataSource())||void 0===n?void 0:n.id},b=(0,a.Immutable)(y);return{id:e.id,name:e.getLabel(),layerId:null==e?void 0:e.jimuChildId,useDataSource:b,addRecords:u,deleteRecords:p,updateRecords:c,updateAttributes:c,updateGeometries:l&&c,featureSnapping:!1,showFields:f,groupedFields:g,layerHonorMode:t.Webmap,parentViewId:i}};function J(e,t,i){const s=i||"jimuName",o=e.length>t.length,a=o?t:e;return(o?e:t).filter((e=>!a.some((t=>(null==t?void 0:t[s])===(null==e?void 0:e[s])))))}function q(e,t,i,s){return B(this,void 0,void 0,(function*(){let o;if(s){const e=yield function(e,t){return B(this,void 0,void 0,(function*(){var i;if(!t)return[];const s=[],o=t.jimuLayerViews,r=t.id,l=(null==e?void 0:e[r])||{},{layersConfig:d=[],customJimuLayerViewIds:u=[],customizeLayers:c}=l;for(const e in o){const t=o[e];if(!H.includes(null===(i=t.layer)||void 0===i?void 0:i.type))continue;const{layerDataSourceId:r}=t,l=!(!(e.includes(n.ADD_TO_MAP_DATA_ID_PREFIX)||e.includes(n.SHOW_ON_MAP_DATA_ID_PREFIX))&&c)||u.includes(e);if(!l)continue;const p=e.indexOf("-"),h=e.substring(p+1),f=d.find((e=>e.id===h));let v=(null==t?void 0:t.getLayerDataSource())||a.DataSourceManager.getInstance().getDataSource(r);if(v||(v=yield t.createLayerDataSource()),!v)continue;const m=z(v);if(f){if(0!==J(m.showFields,f.showFields).length){if(l){const e=Object.assign(Object.assign({},f),{name:m.name,useDataSource:m.useDataSource,showFields:m.showFields});s.push(e)}}else l&&s.push(f)}else l&&s.push(m)}return s}))}(null==t?void 0:t.asMutable({deep:!0}),i);o=e}else o=e;return o}))}function X(e){const t=e.slice();return t.sort(((e,t)=>{const i=null==e?void 0:e.hierarchyLevel,s=null==t?void 0:t.hierarchyLevel;return i&&s?function(e,t){const i=e.split(".").map((e=>parseInt(e))),s=t.split(".").map((e=>parseInt(e)));for(;i.length>0&&s.length>0;){const e=i.shift(),t=s.shift();if(e<t)return-1;if(e>t)return 1}if(i.length>0)return 1;if(s.length>0)return-1;return 0}(i,s):0})),t}var K=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const Q=v(37201),Y="esri-item-list",Z="esri-widget",ee="esri-editor__header",te="esri-feature-form__form-header",ie="esri-feature-form__description-text",se="esri-editor__controls",oe="esri-button--disabled",ae="esri-widget__heading",ne="esri-feature-form",re="esri-editor__scroller",le="esri-editor__content",de="esri-item-list__list",ue="esri-item-list__group",ce="esri-item-list__no-matches-message",pe="esri-item-list__list-item-label",he="esri-item-list__list-item-container",fe="esri-item-list__list-item",ve="esri-item-list__group-header",me="esri-editor__back-button",ge="esri-widget__heading",ye="esri-editor__warning-option",be="esri-editor__warning-option--primary",Se="esri-editor__warning-option--positive",we="esri-editor__progress-bar",Ie="esri-editor__prompt--danger",xe="esri-editor__prompt__header",Ce="esri-editor__prompt__header__heading",De="esri-editor__prompt__message",Ee="esri-editor__prompt__divider",_e="esri-editor__prompt__actions",je=Object.assign({},{_widgetLabel:"Edit",initGeoEmptyMessage:"Please add an editable layer.",initAttEmptyMessage:"Please add an editable source.",noRecordTips:"No valid record is selected, select one or add one.",addFeature:"Add feature",selfSnapping:"Geometry guides",featureSnapping:"Feature to feature",update:"Update",deleteRecord:"Delete this record?",deleteRecordTips:"This record will be permanently removed.",keepRecord:"Keep record",_action_edit_label:"Edit",selectionChangeConfirmTitle:"Discard the edits?",selectionChangeConfirmTips:"You have unsaved edits that could be lost.",discardConfirm:"Discard edits",discardCancel:"Continue editing"},r.defaultMessages,a.defaultMessages),Fe=(0,a.Immutable)([n.LayerTypes.FeatureLayer,n.LayerTypes.SceneLayer,n.LayerTypes.BuildingComponentSublayer,n.LayerTypes.OrientedImageryLayer,n.LayerTypes.SubtypeSublayer]),Le=(0,a.Immutable)([a.AllDataSourceTypes.FeatureLayer,a.AllDataSourceTypes.SceneLayer,a.AllDataSourceTypes.BuildingComponentSubLayer,a.AllDataSourceTypes.OrientedImageryLayer,a.AllDataSourceTypes.SubtypeSublayer]);var Me;!function(e){e.new="NEW",e.update="UPDATE"}(Me||(Me={}));class Ae extends a.React.PureComponent{constructor(s){super(s),this.getWhetherArrayIsShallowEqual=(e,t)=>{let i=!1;return e&&t&&e.length===t.length&&(i=!e.some(((e,i)=>e!==t[i]))),i},this.updateAllUseDataSourcesFromView=e=>{if(!e||e.isDestroyed())return;const{config:t}=this.props,{mapViewsConfig:i}=t,s=null==i?void 0:i[e.id],o=null==s?void 0:s.customizeLayers,n=null==s?void 0:s.customJimuLayerViewIds,r=[],l=e.jimuLayerViews;for(const e in l){const t=l[e];if(!t.isLayerVisible())continue;if(o&&!(null==n?void 0:n.includes(e)))continue;const i=null==t?void 0:t.getLayerDataSource();if(!i||!Le.includes(i.type))continue;const s=this.dsManager.getDataSource(i.id),d=s.getMainDataSource(),u=s.getRootDataSource(),c=(0,a.Immutable)({dataSourceId:s.id,mainDataSourceId:null==d?void 0:d.id,dataViewId:s.dataViewId,rootDataSourceId:null==u?void 0:u.id});r.push(c)}this.setState({mapUseDataSources:r})},this.visibleChangedListener=t=>K(this,void 0,void 0,(function*(){const{jimuMapView:t}=this.state,{config:i}=this.props,{layersConfig:s,mapViewsConfig:o,editMode:a}=i,n=a===e.Geometry,r=yield q(s,o,t,n);this.setState({fullLayersConfig:r})})),this.viewCreatedListener=t=>K(this,void 0,void 0,(function*(){if(t.fromRuntime){const{jimuMapView:t}=this.state,{config:i}=this.props,{layersConfig:s,mapViewsConfig:o,editMode:a}=i,n=a===e.Geometry,r=yield q(s,o,t,n);this.setState({fullLayersConfig:r})}})),this.viewRemovedListener=t=>K(this,void 0,void 0,(function*(){if(t.fromRuntime){const{jimuMapView:t}=this.state,{config:i}=this.props,{layersConfig:s,mapViewsConfig:o,editMode:a}=i,n=a===e.Geometry,r=yield q(s,o,t,n);this.setState({fullLayersConfig:r})}})),this.handleActiveViewChange=t=>K(this,void 0,void 0,(function*(){const{config:i}=this.props,{editMode:s,layersConfig:o,mapViewsConfig:a}=i,n=s===e.Geometry;t&&(yield t.whenAllJimuLayerViewLoaded());const r=yield q(o,a,t,n);this.setState({jimuMapView:t,fullLayersConfig:r},(()=>{this.isActiveViewChange=!0,this.updateAllUseDataSourcesFromView(t),t&&(t.removeJimuLayerViewsVisibleChangeListener(this.visibleChangedListener),t.removeJimuLayerViewCreatedListener(this.viewCreatedListener),t.removeJimuLayerViewRemovedListener(this.viewRemovedListener),n&&(t.addJimuLayerViewsVisibleChangeListener(this.visibleChangedListener),t.addJimuLayerViewCreatedListener(this.viewCreatedListener),t.addJimuLayerViewRemovedListener(this.viewRemovedListener))),t||this.destroyEdit()}))})),this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:je[e]},t),this.destroyEdit=()=>{this.edit&&!this.edit.destroyed&&this.edit.destroy()},this.flatMapArray=e=>{const t=[];for(const i in e)(null==e?void 0:e[i])&&t.push(...e[i]);return t},this.flatMapArrayWithView=(e,t)=>{const i=[],s=null==t?void 0:t.dataSourceId;for(const t in e)0===t.indexOf(s)&&(null==e?void 0:e[t])&&i.push(...e[t]);return i},this.createEditForm=(e,t,i)=>K(this,void 0,void 0,(function*(){var s,o,n,r;const{dataSources:l,editFeatures:d}=this.state,{id:u,config:c}=this.props,{layersConfig:p}=c,h=l[e],f=d;h&&(f[e]=h.getSelectedRecords());const v=this.getInLayersConfigFeatures(f,p),m=this.flatMapArray(v).length,g=m>1?"list":1===m?"form":"empty";if(this.setState({featureFormStep:g}),1===m){const e=null===(s=h.getSelectedRecords())||void 0===s?void 0:s[0],r=h.getIdField()||"OBJECTID",l=e?`${r} IN (${e.getId()})`:"",d=yield h.query({where:l,returnGeometry:!0,notAddFieldsToClient:!0,outFields:["*"]}).then((e=>{var t;return null===(t=null==e?void 0:e.records)||void 0===t?void 0:t[0]}));if(!d)return;if(t||!this.edit||(null===(o=this.edit)||void 0===o?void 0:o.destroyed))this.renderFeatureForm(h,d,i);else{null===(n=document.getElementById(`edit-container-${u}`))||void 0===n||n.classList.remove("esri-hidden"),this.createOrUpdateHeader(h,null==d?void 0:d.feature);const e=this.edit;if(!e)return;const t=yield a.dataSourceUtils.changeToJSAPIGraphic(null==d?void 0:d.feature);e.feature=t}}else(m>1||0===m)&&(null===(r=document.getElementById(`edit-container-${u}`))||void 0===r||r.classList.add("esri-hidden"))})),this.getDsAccessibleInfo=e=>{if(!e)return Promise.resolve(!1);return(0,a.esri.restRequest.request)(`${e}?f=json`).then((e=>!Object.keys(e).includes("error"))).catch((e=>!1))},this.getPrivilege=()=>a.privilegeUtils.checkExbAccess(a.privilegeUtils.CheckTarget.Experience).then((e=>{var t;return null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.canEditFeature})),this.getIsAdvancedPermission=(e,t)=>K(this,void 0,void 0,(function*(){var i;const{dataSources:s}=this.state,o=t||s[Object.keys(s).find((t=>t.includes(e.id)))];if(!o)return!1;const n=yield null==o?void 0:o.fetchItemInfo().then((e=>e)).catch((e=>{console.error(e)}));if(!n||!n.url)return!1;const r=null===(i=a.ServiceManager.getInstance().getServerInfoByServiceUrl(n.url))||void 0===i?void 0:i.owningSystemUrl;if(!r)return!1;const l=a.SessionManager.getInstance().getSessionByUrl(r);if(!l)return!1;const d=yield l.getUser(),u="org_admin"===(null==d?void 0:d.role)&&(null==n?void 0:n.isOrgItem),c=n.owner===(null==d?void 0:d.username),p=yield a.privilegeUtils.isItemInTheUpdatedGroup(n.id,l);return u||c||p})),this.sendSparkMsg=(e,t)=>{var i,s,o;const a=null===(o=null===(s=null===(i=null===window||void 0===window?void 0:window.Capacitor)||void 0===i?void 0:i.Plugins)||void 0===s?void 0:s.Spark)||void 0===o?void 0:o.sendDiscussionAsync;if(a){a({title:`${e} data to ${t}`,content:window.location.href})}},this.getTimezone=e=>a.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone()),this.renderFeatureForm=(s,o,n,r)=>{this.setState({loading:!0});const{activeId:l}=this.state,{config:d,id:u}=this.props,{editMode:c,layersConfig:p}=d,h=p.asMutable({deep:!0}).find((e=>e.id===l));this.destroyEdit();const f=(null==s?void 0:s.type)===a.AllDataSourceTypes.SceneLayer||(null==s?void 0:s.type)===a.AllDataSourceTypes.BuildingComponentSubLayer?s.getAssociatedDataSource():s;this.getFeatureLayer(f).then((s=>K(this,void 0,void 0,(function*(){var l,d;if(n&&n!==this.currentRequestId)return void this.setState({loading:!1});if(this.removeLayerOnce=!1,!s)return void this.setState({loading:!1});const p=document&&document.createElement("div");let v;p.id=`edit-container-${u}`,p.className=`edit-container-${u}`,this.editContainer.current.appendChild(p),v=s.layer?s.layer:s;const m=yield this.getDsAccessibleInfo(null==v?void 0:v.url),g=yield this.getPrivilege(),y=yield this.getIsAdvancedPermission(v,f),b=null==v?void 0:v.userHasFullEditingPrivileges,w=null===(l=null==v?void 0:v.editingEnabled)||void 0===l||l,I=m||g;let x;x=y||b&&w?"full":b&&!w?"none":"normal",this.setState({formPrivileges:x,formEditable:I});const D=r?h.addRecords:h.updateRecords||h.deleteRecords;if("none"===x||"normal"===x&&!D)this.setState({loading:!1,featureFormStep:"empty"});else if(c===e.Attribute){const e=this.constructFormElements(f.id),s=new C.default({elements:e}),n=((null==o?void 0:o.feature)?yield a.dataSourceUtils.changeToJSAPIGraphic(null==o?void 0:o.feature):void 0)||new _.default({layer:v}),r=h.layerHonorMode===t.Webmap?null===(d=null==f?void 0:f.layer)||void 0===d?void 0:d.formTemplate:s;this.edit=new S.default({container:p,feature:n,layer:v,formTemplate:r,timeZone:this.getTimezone(f)}),this.createOrUpdateHeader(f,n),o&&this.setState({featureFormStep:"form"});const l=this.edit;l.on("submit",(()=>{const e=(null==l?void 0:l.feature)||n;if(e){(null==e?void 0:e.geometry)&&(e.geometry=null);const t=l.getValues();Object.keys(t).forEach((i=>{e.attributes[i]=t[i]}));const i={updateFeatures:[e]};this.applyAttributeUpdates(i)}})),l.on("value-change",(e=>{var t;const i=f.getIdField(),{feature:s,fieldName:o}=e;if(o===i)return;const a=null===(t=this.edit.viewModel)||void 0===t?void 0:t.submittable;this.setState({formSubmittable:a});const n=s.attributes||l.feature.attributes,r=null==l?void 0:l.viewModel.getValues();let d=!1;if(r)for(const e in r)if(n[e]!==r[e]){d=!0;break}this.setState({formChange:d})}));const u=v.isTable,c=e=>{var t,s,o,a,n,r,l,d;const{addedFeatures:c,updatedFeatures:p,deletedFeatures:h}=e,m=c&&c.length>0,g=p&&p.length>0,y=h&&h.length>0;let b=i.Added;if(m){b=i.Added;const n=null===(s=null===(t=null==e?void 0:e.edits)||void 0===t?void 0:t.addFeatures)||void 0===s?void 0:s[0];if(n){const e=f.getIdField(),t=f.buildRecord(n),i=(null==t?void 0:t.getData())||{};t.setData(Object.assign(Object.assign({},i),{[e]:null===(a=null===(o=c[0])||void 0===o?void 0:o.objectId)||void 0===a?void 0:a.toString()})),f.afterAddRecord(t),u&&f.selectRecordById(t.getId(),t)}}if(g){b=i.Updated;const t=null===(r=null===(n=null==e?void 0:e.edits)||void 0===n?void 0:n.updateFeatures)||void 0===r?void 0:r[0];if(t){const e=null==f?void 0:f.buildRecord(t);null==f||f.afterUpdateRecord(e)}}if(y){b=i.Deleted;const t=null===(d=null===(l=null==e?void 0:e.edits)||void 0===l?void 0:l.deleteFeatures)||void 0===d?void 0:d[0];if(t){const e=f.buildRecord(t);f.afterDeleteRecordById(e.getId())}}(m||g||y)&&this.sendSparkMsg(b,v.title)};"subtype-sublayer"===v.type?v.parent.on("edits",c):v.on("edits",c),this.setState({loading:!1})}})))).catch((e=>{this.setState({loading:!1}),this.removeLayerOnce=!1,console.error(e)}))},this.createOrUpdateHeader=(e,t)=>{var i,s;const{id:o}=this.props,{featureFormStep:n}=this.state,r=this.getLayerDisplayField(e),l="new"===n?this.formatMessage("addFeature"):null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i[r];if(null===document||void 0===document?void 0:document.getElementById(`form_heading_${o}`))document.getElementById(`form_heading_${o}`).innerText=l;else{const e=document&&document.createElement("div");e.className="d-flex",e.innerHTML=`\n        <button id='back_home_${o}' class='back-button surface-1 ${(0,a.classNames)(me)}' title='${this.formatMessage("back")}'><</button>\n        <header class='${(0,a.classNames)(ee)}'>\n          <h4 id='form_heading_${o}' class='text-truncate ${(0,a.classNames)(ae)}' title='${l}'>${l}</h4>\n        </header>\n      `,this.formHeaderContainer.current.appendChild(e),null===(s=document.getElementById(`back_home_${o}`))||void 0===s||s.addEventListener("click",this.handleBack)}},this.deleteChangeDataSource=e=>{const{activeId:t,editFeatures:i}=this.state,s=Object.assign({},i);s[t]=e,this.setState({editFeatures:s},(()=>{this.createEditForm(t,!1)}))},this.applyAttributeUpdates=e=>{const{dataSources:t,editFeatures:i,activeId:s}=this.state,o=this.edit,a=t[s],n=a.getGDBVersion();o.layer.applyEdits(e,{gdbVersion:n}).then((t=>{if(null==e?void 0:e.deleteFeatures){const t=(null==a?void 0:a.getSelectedRecords()).filter((t=>t.feature.attributes!==(null==e?void 0:e.deleteFeatures[0].attributes)));if(t.length>0)this.deleteChangeDataSource(t);else{const e=Object.assign({},i);delete e[s];const t=this.formHeaderContainer.current;(null==t?void 0:t.innerHTML)&&(t.innerHTML=""),this.destroyEdit(),this.setState({editFeatures:e,featureFormStep:"empty",activeId:""})}}else(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1});this.setState({formChange:!1,formSubmittable:!0})})).catch((t=>{(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1}),console.error(t)}))},this.constructFormElements=e=>{let{activeId:t}=this.state;e&&(t=e);const{config:i}=this.props,{layersConfig:s}=i,o=s.asMutable({deep:!0}).find((e=>e.id===t));if(!o)return[];const{groupedFields:a}=o;return a.map((e=>(null==e?void 0:e.children)?new E.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:null==e?void 0:e.children.map((e=>new D.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))}):new D.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))},this.onFilterChange=e=>{this.setState({filterText:e.target.value})},this.renderListItems=e=>{var t,i,s;const{filterText:o}=this.state,{config:n}=this.props,{layersConfig:r}=n,l=[];for(const a in e){const n=e[a],r=null===(t=null==n?void 0:n[0])||void 0===t?void 0:t.dataSource,d=null==r?void 0:r.belongToDataSource,u=null==d?void 0:d.jimuChildId,c=(null===(i=null==d?void 0:d.layerDefinition)||void 0===i?void 0:i.name)||(null===(s=null==d?void 0:d.layerDefinition)||void 0===s?void 0:s.description),p=this.getLayerDisplayField(r),h=this.getLayerObjectIdField(r),f={id:u,label:c,dsId:a,items:n.filter((e=>{var t,i,s,a;const n=(null===(t=e.feature.attributes)||void 0===t?void 0:t[p])||(null===(i=e.feature.attributes)||void 0===i?void 0:i[h])||(null===(s=e.feature.attributes)||void 0===s?void 0:s.objectid),r=o.toLowerCase();return!r||(null===(a=null==n?void 0:n.toString())||void 0===a?void 0:a.toLowerCase().indexOf(r))>-1})).map((e=>{var t,i,s;const o=(null===(t=e.feature.attributes)||void 0===t?void 0:t[p])||(null===(i=e.feature.attributes)||void 0===i?void 0:i[h])||(null===(s=e.feature.attributes)||void 0===s?void 0:s.objectid);return{id:o,dsId:a,label:o,data:e.feature}}))};l.push(f)}let d=0;return l.forEach((e=>{d+=e.items.length})),l.sort(((e,t)=>{const i=r.findIndex((t=>t.layerId===e.id)),s=r.findIndex((e=>e.layerId===t.id));return i-s})),0===d?(0,a.jsx)("div",{className:ce,key:"no-matches"},this.formatMessage("noItemsFound")):(0,a.jsx)("div",{key:"item-container"},l.map((e=>this.renderGroup(e))))},this.renderGroup=e=>{if(0!==e.items.length)return(0,a.jsx)("div",{role:"group","aria-label":e.label,className:ue,key:e.id},(0,a.jsx)("h4",{className:(0,a.classNames)(ve,ae)},(0,a.jsx)("span",{className:pe},e.label)),(0,a.jsx)("div",{className:de,role:"listbox"},e.items.map(((e,t)=>this.renderItem(e,t)))))},this.renderItem=(e,t)=>{const i=`${e.dsId}__${e.label}_${t}`,{dataSources:s}=this.state;return(0,a.jsx)(r.Button,{role:"option",className:(0,a.classNames)(`w-100 border-0 ${fe}`),key:i,onClick:()=>{clearTimeout(this.timerFn),this.timerFn=setTimeout((()=>{this.renderFeatureForm(s[e.dsId],{feature:e.data})}),200)},onDoubleClick:()=>{clearTimeout(this.timerFn)}},(0,a.jsx)("div",{className:he},(0,a.jsx)("span",{className:pe},e.label)))},this.getLayerDisplayField=e=>{var t,i,s,o,a,n,r,l;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.displayField)||(null===(i=null==e?void 0:e.layerDefinition)||void 0===i?void 0:i.displayField)||(null===(o=null===(s=null==e?void 0:e.belongToDataSource)||void 0===s?void 0:s.layerDefinition)||void 0===o?void 0:o.displayField)||(null===(a=null==e?void 0:e.layer)||void 0===a?void 0:a.objectIdField)||(null===(n=null==e?void 0:e.layerDefinition)||void 0===n?void 0:n.objectIdField)||(null===(l=null===(r=null==e?void 0:e.belongToDataSource)||void 0===r?void 0:r.layerDefinition)||void 0===l?void 0:l.objectIdField)||"OBJECTID"},this.getLayerObjectIdField=e=>{var t,i,s;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(s=null===(i=null==e?void 0:e.belongToDataSource)||void 0===i?void 0:i.layerDefinition)||void 0===s?void 0:s.objectIdField)||"OBJECTID"},this.renderFeatureList=(e,t)=>{const{id:i,label:s,theme:o}=this.props,{filterText:n}=this.state,l=`${i}-placeholder`,d=this.formHeaderContainer.current;return(null==d?void 0:d.innerHTML)&&(d.innerHTML=""),(0,a.jsx)("div",{className:"surface-1 border-0 h-100"},(0,a.jsx)("div",{className:ne},(0,a.jsx)("div",{className:te},(0,a.jsx)("h2",{className:ae},s),(0,a.jsx)("p",{className:(0,a.classNames)(`text-truncate ${ie}`),key:"description",title:t},t))),(0,a.jsx)("div",{className:(0,a.classNames)(`feature-list ${le} ${re}`)},(0,a.jsx)("div",{className:(0,a.classNames)(Y,Z)},(0,a.jsx)("div",{className:"d-flex align-items-center m-2"},(0,a.jsx)(r.TextInput,{"aria-labelledby":l,className:"w-100",placeholder:this.formatMessage("search"),onChange:this.onFilterChange,value:n,prefix:(0,a.jsx)($,{color:o.ref.palette.neutral[700]}),allowClear:!0,title:n})),(0,a.jsx)("div",{key:"content",className:(0,a.classNames)(re)},this.renderListItems(e)))))},this.renderFormEmpty=t=>{var i,s,o;const{fullLayersConfig:n,jimuMapView:r}=this.state,{id:l,label:d,config:u}=this.props,{noDataMessage:c,editMode:p,layersConfig:h,mapViewsConfig:f}=u,v=this.formHeaderContainer.current;(null==v?void 0:v.innerHTML)&&(v.innerHTML="");const m=p===e.Attribute,g=p===e.Geometry,y=m?(null==h?void 0:h.length)>0:(null==n?void 0:n.length)>0,S=m?this.formatMessage("initAttEmptyMessage"):this.formatMessage("initGeoEmptyMessage"),w=y?c||this.formatMessage("noRecordTips"):S,I=document.getElementById(`edit-container-${l}`);I&&(null==I||I.classList.add("esri-hidden"));const x=!(null===(i=null==f?void 0:f[null==r?void 0:r.id])||void 0===i?void 0:i.customizeLayers)||(null===(o=null===(s=null==f?void 0:f[r.id])||void 0===s?void 0:s.customJimuLayerViewIds)||void 0===o?void 0:o.length)>=0;return g&&(!r||r&&!x)?(0,a.jsx)("div",{className:"jimu-secondary-loading"}):(0,a.jsx)("div",{className:"surface-1 border-0 h-100"},(0,a.jsx)("div",{className:(0,a.classNames)(`editor-white-bg ${ne}`)},(0,a.jsx)("div",{className:te},(0,a.jsx)("h2",{className:ae},d),y&&(0,a.jsx)("p",{className:(0,a.classNames)(`text-truncate ${ie}`),key:"description",title:t},t))),(0,a.jsx)("div",{className:"w-100 text-center edit-blank"},(0,a.jsx)("div",{className:"position-absolute edit-blank-content w-100"},(0,a.jsx)(b,{size:32,className:"placeholder-icon"}),(0,a.jsx)("p",null,w))))},this.renderControlButtons=e=>(0,a.jsx)("div",{className:(0,a.classNames)(`flex-row justify-content-between ${se}`),key:"controls"},e.map((({disabled:t=!1,label:i,type:s,clickHandler:o},n)=>this.renderButton({label:i,class:(0,a.classNames)({"single-buttons":1===e.length},{"multi-buttons":e.length>1},t?oe:null),type:s,disabled:t,clickHandler:o,key:n})))),this.handleNew=()=>{var e,t;const{dataSources:i,formPrivileges:s}=this.state,{config:o}=this.props,{layersConfig:a}=o,n="normal"===s;let r;if("full"===s?r=null===(e=a.find((e=>null==e?void 0:e.isTable)))||void 0===e?void 0:e.id:n&&(r=null===(t=a.find((e=>null==e?void 0:e.addRecords)))||void 0===t?void 0:t.id),r){const e=null==i?void 0:i[r];if(!e)return;this.setState({featureFormStep:"new",activeId:r},(()=>{this.renderFeatureForm(e,void 0,void 0,!0)}))}},this.handleAdd=()=>{const e=this.edit.viewModel;if(null==e?void 0:e.submittable){const t=null==e?void 0:e.feature;if(t){const e=this.edit.getValues();t.attributes=e;const i={addFeatures:[t]};this.applyAttributeUpdates(i)}}},this.handleSave=()=>{const e=this.edit.viewModel;(null==e?void 0:e.submittable)&&(null==e||e.submit(),this.setState({attrUpdating:!0}))},this.handleDeleteConfirm=()=>{this.setState({delConfirm:!0})},this.cancelDelete=()=>{this.setState({delConfirm:!1})},this.handleDelete=()=>{var e;const{dataSources:t,activeId:i}=this.state,s=t[i],o=null===(e=null==s?void 0:s.getSelectedRecords())||void 0===e?void 0:e[0],a=null==o?void 0:o.feature;if(a){const e={deleteFeatures:[a]};this.applyAttributeUpdates(e)}this.setState({delConfirm:!1})},this.renderButton=e=>(0,a.jsx)(r.Button,{className:e.class,disabled:e.disabled,key:e.key,onClick:e.clickHandler,type:e.type},e.label),this.constructFieldConfig=(e,t,i=[])=>{const s=((null==e?void 0:e.asMutable)?e.asMutable({deep:!0}):e).map((e=>(null==e?void 0:e.children)?new E.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:null==e?void 0:e.children.map((e=>new D.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))}):new D.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"}))),o=[];if(!t)for(const e of i){const t=e.clone();t.editableExpression="false",o.push(t)}const a=t?i:o;return a?s.concat(a):s},this.editorLayerWatcher=(e,t,s,o)=>{var a,n,r,l,d,u,c,p,h,f,v,m,g;const{dataSources:y,activeId:b}=this.state,S=y[t],{addedFeatures:w,updatedFeatures:I,deletedFeatures:x}=e,C=w&&w.length>0,D=I&&I.length>0,E=x&&x.length>0;let _=i.Added;if(C){_=i.Added;const t=null===(n=null===(a=null==e?void 0:e.edits)||void 0===a?void 0:a.addFeatures)||void 0===n?void 0:n[0];if(t){const e=S.buildRecord(t);S.afterAddRecord(e)}}if(D){_=i.Updated;const t=null===(l=null===(r=null==e?void 0:e.edits)||void 0===r?void 0:r.updateFeatures)||void 0===l?void 0:l[0],o=(null===(u=null===(d=this.edit.viewModel)||void 0===d?void 0:d.featureFormViewModel)||void 0===u?void 0:u.feature)||(null===(p=null===(c=this.edit)||void 0===c?void 0:c._featureForm)||void 0===p?void 0:p.feature),a=(null==o?void 0:o.attributes)||{},n=(null==o?void 0:o.geometry)||null,m=(null==o?void 0:o.layer)||s,g=Object.assign(a,null==t?void 0:t.attributes);if(t.attributes=g,t.layer=m,t.geometry||(t.geometry=n),t){const e=null==S?void 0:S.buildRecord(t);null==S||S.afterUpdateRecord(e);const i={};if(!b)return;i[b]=[e];(null===(v=null===(f=null===(h=this.edit.activeWorkflow.data)||void 0===h?void 0:h.rootFeature)||void 0===f?void 0:f.layer)||void 0===v?void 0:v.id)===s.id&&this.startWorkFlowWhenAwait(i)}}if(E){_=i.Deleted;const t=null===(g=null===(m=null==e?void 0:e.edits)||void 0===m?void 0:m.deleteFeatures)||void 0===g?void 0:g[0];if(t){const e=S.buildRecord(t);S.afterDeleteRecordById(e.getId())}}(C||D||E)&&this.sendSparkMsg(_,o)},this.isLayerInfoChange=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)||(e.forEach(((e,s)=>{const o=t.findIndex((t=>t.layer.id===e.layer.id));if(o!==s)return void(i=!0);const a=t[o];if(a){const t=["enabled","addEnabled","updateEnabled","deleteEnabled","formTemplate"];for(const s of t)if(a[s]!==e[s]){i=!0;break}}else i=!0})),i)},this.clearAllDsSelect=()=>{const{dataSources:e}=this.state;Object.keys(e).forEach((t=>{var i;null===(i=e[t])||void 0===i||i.clearSelection()}))},this.getDsCap=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.constructUneditableInfo=e=>({layer:e,enabled:!1,addEnabled:!1,updateEnabled:!1,deleteEnabled:!1}),this.getAllLayersIncludeSubtype=e=>{var t,i;const s=(null===(i=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===i?void 0:i.allLayers)||[];let o=s;return s.forEach((e=>{if("subtype-group"===e.type){const t=(e=>{const t=[],i=e=>{"subtype-group"===e.type?e.sublayers.forEach((e=>{i(e)})):"subtype-sublayer"===e.type&&t.push(e)};return i(e),t})(e);o=o.concat(t)}})),o},this.newOrUpdateEditor=(e,i,s,r)=>K(this,void 0,void 0,(function*(){var l,d;const u=e===Me.new,{jimuMapView:c,dataSources:p,editFeatures:h,fullLayersConfig:f}=this.state;r&&this.setState({fullLayersConfig:r});const v=r||f,{id:m,config:g}=this.props,{selfSnapping:y,featureSnapping:b,defaultSelfEnabled:S,defaultFeatureEnabled:I,defaultSnapLayers:x,defaultTooltipEnabled:D,snapSettingMode:E,tooltip:_,templateFilter:j,relatedRecords:F,liveDataEditing:L,initialReshapeMode:M}=g,A=[];let O,N=c;if(i&&(N=i),!N)return;let T=0;if(u){const{useMapWidgetIds:e}=this.props;if(!e||0===e.length)return;if(!v||0===v.length)return;if(void 0!==this.edit&&!s&&!this.isActiveViewChange&&!i&&this.edit&&!this.edit.destroyed)return void this.newOrUpdateEditor(Me.update,N);this.isActiveViewChange&&(this.isActiveViewChange=!1),this.destroyEdit();let t=null;const n=document.getElementById(`edit-container-${m}`);n&&n.remove(),t=document&&document.createElement("div"),t.id=`edit-container-${m}`,t.className=`h-100 edit-container-${m}`,this.editContainer.current.appendChild(t);const r=E===o.Flexible,l=y||b,d=yield this.getDefaultSnapSources(N,x),u=r&&l||_;O=e=>{this.edit=new w.default({container:t,view:N.view,layerInfos:A,tooltipOptions:{enabled:D},snappingOptions:{enabled:S||I,selfEnabled:S,featureEnabled:I,featureSources:d},visibleElements:{snappingControls:r&&l,snappingControlsElements:{enabledToggle:!0,selfEnabledToggle:y,featureEnabledToggle:b,gridEnabledToggle:!1,gridControls:!1,gridControlsElements:{}},tooltipsToggle:_,settingsMenu:u,editFeaturesSection:e},supportingWidgetDefaults:{featureTemplates:{visibleElements:{filter:j}},sketch:{defaultUpdateOptions:{tool:M?"reshape":"transform"}}}});const i=this;k.default.watch((()=>this.edit.viewModel.state),((e,t)=>{var s,o,a;"ready"!==e&&setTimeout((()=>{var e;const t=null===(e=document.querySelector("calcite-flow-item:not([hidden])"))||void 0===e?void 0:e.shadowRoot,i=null==t?void 0:t.querySelector(".back-button"),s=()=>{this.setState({editFeatures:{}},(()=>{this.clearAllDsSelect()}))};null==i||i.removeEventListener("click",s),null==i||i.addEventListener("click",s)}),500);const n=null===(s=i.edit.viewModel)||void 0===s?void 0:s.featureFormViewModel,r=null==n?void 0:n.feature;if(!r)return;const{dataSources:l,selectionStartWorkflow:d}=i.state,u=(null===(o=null==r?void 0:r.layer)||void 0===o?void 0:o.id)||(null===(a=null==n?void 0:n.layer)||void 0===a?void 0:a.id),c=null==v?void 0:v.find((e=>e.layerId===u));if(!c)return;const p=l[c.id];if(this.editorNotBackButton||"ready"!==e||null==p||p.clearSelection(),"editing-attributes"===e){const e=null==p?void 0:p.buildRecord(r);d?i.setState({selectionStartWorkflow:!1}):(this.editorSelectFeature=!0,null==p||p.selectRecordById(e.getId(),e))}}));const s=Object.assign({},h);for(const e in p){const t=A.find((t=>e.includes(t.layer.id)));((null==t?void 0:t.updateEnabled)||(null==t?void 0:t.deleteEnabled))&&(s[e]=p[e].getSelectedRecords())}a.lodash.isDeepEqual(h,s)||this.setState({editFeatures:s,selectionStartWorkflow:!0},(()=>{N&&this.startWorkFlowWhenAwait(s)}))}}const R=this.getAllLayersIncludeSubtype(N);((null===(d=null===(l=N.view)||void 0===l?void 0:l.map)||void 0===d?void 0:d.layers)||[]).filter((e=>null==e?void 0:e.id.includes(n.ADD_TO_MAP_DATA_ID_PREFIX))).forEach((e=>{R.find((t=>t.id===e.id))||R.push(e)}));const V=R.filter((e=>{const t=e;return Fe.includes(t.type)})),P=[];R.forEach((e=>{((null==e?void 0:e.id.includes("jimu-draw-measurements-layer"))||(null==e?void 0:e._exb_not_editable))&&P.push(e)})),P.length>0&&P.forEach((e=>{A.push(this.constructUneditableInfo(e))}));const U=[];let $=!1;V.forEach((e=>K(this,void 0,void 0,(function*(){var i,s,o,a,r,l,d,c,p,h,f,m;const g=null==v?void 0:v.find((t=>t.layerId===e.id)),y=e;if(y){const v=(null===(i=y.id)||void 0===i?void 0:i.includes(n.ADD_TO_MAP_DATA_ID_PREFIX))||(null===(o=null===(s=y.parent)||void 0===s?void 0:s.id)||void 0===o?void 0:o.includes(n.ADD_TO_MAP_DATA_ID_PREFIX)),b=null===(a=y.id)||void 0===a?void 0:a.includes(n.SHOW_ON_MAP_DATA_ID_PREFIX),S=null==y?void 0:y.url;if(g&&!v&&!b&&S){const{groupedFields:i,addRecords:s,deleteRecords:o,updateRecords:a,updateAttributes:n,updateGeometries:f,layerHonorMode:v,id:m}=g,b=v===t.Webmap,S=yield this.getDsAccessibleInfo(null==e?void 0:e.url),w=yield this.getPrivilege(),I=yield this.getIsAdvancedPermission(y);(I||(a||o))&&($=!0);const x=null==y?void 0:y.userHasFullEditingPrivileges,D=null===(r=null==y?void 0:y.editingEnabled)||void 0===r||r,E=S||w,_=null!==(l=null==y?void 0:y.formTemplate)&&void 0!==l?l:{},j=(null===(d=_.elements)||void 0===d?void 0:d.length)>0,{expressionInfos:L,title:M}=_,A=this.state.dataSources[g.id],O=(null===(c=null==y?void 0:y.popupTemplate)||void 0===c?void 0:c.fieldInfos)||[],N=null==A?void 0:A.getSchema(),T=(null==N?void 0:N.fields)?Object.keys(N.fields):[],R=null==A?void 0:A.getLayerDefinition(),k=(null==R?void 0:R.fields)||[],V=(null==N?void 0:N.fields)?Object.values(null==N?void 0:N.fields):[],P=((null===(p=null==R?void 0:R.fields)||void 0===p?void 0:p.length)>0?R.fields:V).filter((e=>T.includes(e.jimuName||e.name)));let B=this.relationships[y.id];if(!B){const e=null===(h=null==_?void 0:_.elements)||void 0===h?void 0:h.filter((e=>"relationship"===e.type)),t=[];null==e||e.forEach((e=>{t.push(null==e?void 0:e.clone())})),this.relationships[y.id]=t,B=t}let W={};if(b){const e=(null==A?void 0:A.getIdField())||"OBJECTID",t=this.getUsedFields(k,P,e,O);if(j)if(F)if((null==B?void 0:B.length)>0){const e=_.clone();e.elements.map((e=>{let t=e;if("relationship"===e.type){const i=B.find((t=>t.label===e.label&&t.relationshipId===e.relationshipId));i&&(t=i)}return t})),W=e}else{W=_.clone()}else if((null==B?void 0:B.length)>0){const e=_.clone();for(const t of e.elements)"relationship"===t.type&&(t.editableExpression="false");W=e}else{W=_.clone()}else W=new C.default({elements:this.constructFieldConfig(t,F,[]),expressionInfos:L,title:M||(null==y?void 0:y.title)})}else W=new C.default({elements:this.constructFieldConfig(i,F,B),expressionInfos:L,title:M||(null==y?void 0:y.title)});I||x&&D?U.push(Object.assign(Object.assign({layer:y},W?{formTemplate:W}:{}),{enabled:!0,addEnabled:!0,updateEnabled:!0,deleteEnabled:!0,attributeUpdatesEnabled:!0,geometryUpdatesEnabled:!0})):x&&!D?U.push(this.constructUneditableInfo(y)):U.push(Object.assign(Object.assign({layer:y},W?{formTemplate:W}:{}),{enabled:E&&(s||a||o),addEnabled:s,updateEnabled:a,deleteEnabled:o,attributeUpdatesEnabled:n,geometryUpdatesEnabled:f}));const H=y;if(H.on)!u&&H.hasEventListener("edits")||H.on("edits",(e=>{this.editorLayerWatcher(e,m,H,H.title)}));else{const e=H.parent;!u&&e.hasEventListener("edits")||e.on("edits",(e=>{this.editorLayerWatcher(e,m,H,H.title)}))}}else if(L&&v){yield N.whenJimuMapViewLoaded(),yield N.whenAllJimuLayerViewLoaded();const t=null===(f=N.jimuLayerViews[`${N.id}-${y.id}`])||void 0===f?void 0:f.getLayerDataSource(),i=t;if(!t||!i.itemId&&!i.url)return A.push(this.constructUneditableInfo(y)),void T++;const s=yield this.getIsAdvancedPermission(y,t),o=null==y?void 0:y.userHasFullEditingPrivileges,a=null===(m=null==y?void 0:y.editingEnabled)||void 0===m||m,n=yield this.getDsAccessibleInfo(null==e?void 0:e.url),r=yield this.getPrivilege(),l=n||r,d=null==y?void 0:y.sourceJSON,u=null==d?void 0:d.allowGeometryUpdates,c=null==d?void 0:d.capabilities,p=this.getDsCap(c,"create"),h=this.getDsCap(c,"update"),v=this.getDsCap(c,"delete");s||o&&a?($=!0,A.push({layer:y,enabled:!0,addEnabled:!0,updateEnabled:!0,deleteEnabled:!0,attributeUpdatesEnabled:!0,geometryUpdatesEnabled:!0})):o&&!a?A.push(this.constructUneditableInfo(y)):(l&&(h||v)&&($=!0),A.push({layer:y,enabled:l&&(p||h||v),addEnabled:p,updateEnabled:h,deleteEnabled:v,attributeUpdatesEnabled:h,geometryUpdatesEnabled:u&&h}))}else A.push(this.constructUneditableInfo(y))}if(T++,T===V.length){const{config:e}=this.props,{mapViewsConfig:t}=e,i=null==t?void 0:t[N.id],s=null==i?void 0:i.customizeLayers,o=null==i?void 0:i.customJimuLayerViewIds;if(s)U.sort(((e,t)=>(null==o?void 0:o.findIndex((t=>t.includes(e.layer.id))))-(null==o?void 0:o.findIndex((e=>e.includes(t.layer.id))))));else{const e=N.jimuLayerViews,t=X(Object.values(e));U.sort(((e,i)=>(null==t?void 0:t.findIndex((t=>t.id.includes(e.layer.id))))-(null==t?void 0:t.findIndex((e=>e.id.includes(i.layer.id))))))}if(A.unshift(...U),u)O($);else{const e=this.edit;this.isLayerInfoChange(A,e.layerInfos)&&(e.layerInfos=A),e.visibleElements.editFeaturesSection=$}}}))))})),this.getUsedFields=(e,t,i,s)=>{const o=[];return t.forEach((t=>{const a=e.find((e=>e.name===t.name)),n=null==a?void 0:a.editable;if(![i,"CreationDate","Creator","EditDate","Editor","GlobalID"].includes(t.name)){const e=s.find((e=>e.fieldName===t.name)),i=e?null==e?void 0:e.isEditable:n;o.push({name:t.name,jimuName:t.name,alias:t.alias,editable:i,editAuthority:i})}})),o},this.getDefaultSnapSources=(e,t)=>K(this,void 0,void 0,(function*(){if(!e)return[];if(yield e.whenAllJimuLayerViewLoaded(),!(null==e?void 0:e.jimuLayerViews))return[];return Object.keys(e.jimuLayerViews).filter((i=>null==t?void 0:t.includes(e.jimuLayerViews[i].layerDataSourceId))).map((t=>({layer:e.jimuLayerViews[t].layer,enabled:!0})))})),this.getImageryLayer=e=>{const t=e;let i;const s=t.getCurrentQueryParams();if(t.itemId){const e=parseInt(t.layerId),o={portalItem:{id:t.itemId,portal:{url:t.portalUrl}},definitionExpression:s.where,layerId:e||void 0};t.url&&(o.url=t.url),i=new x.default(o)}else if(t.url)i=new x.default({definitionExpression:s.where,url:t.url});else if(t.layer)return null==t?void 0:t.createJSAPILayerByDataSource().then((e=>e));return Promise.resolve(i)},this.getSubtypeSublayer=e=>{const t=e;return null==t?void 0:t.createJSAPILayerByDataSource().then((e=>e))},this.getFeatureLayer=e=>{var t;if(e.type===a.AllDataSourceTypes.OrientedImageryLayer)return this.getImageryLayer(e);if(e.type===a.AllDataSourceTypes.SubtypeSublayer)return this.getSubtypeSublayer(e);const{id:i}=this.props,s=e,o=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.isDataInDataSourceInstance;let n;const r=e&&e.getCurrentQueryParams();if(o)return s.load({returnGeometry:!0},{widgetId:i}).then((e=>K(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return a.dataSourceUtils.createJSAPIFeatureLayerByRecords(s,t)})))).catch((e=>{console.error(e)}));if(!I.default)return Promise.resolve(n);if(null==s?void 0:s.itemId){const e=parseInt(s.layerId),t={portalItem:{id:s.itemId,portal:{url:s.portalUrl}},definitionExpression:r.where,layerId:e||void 0};s.url&&(t.url=s.url),n=new I.default(t)}else{if(!s.url)return s.layer?s.load({returnGeometry:!0},{widgetId:i}).then((e=>K(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return a.dataSourceUtils.createJSAPIFeatureLayerByRecords(s,t)})))).catch((e=>{console.error(e)})):Promise.resolve(n);n=new I.default({definitionExpression:r.where,url:s.url})}return Promise.resolve(n)},this.getCurrentEditLayer=e=>{if(!e)return;const{activeId:t,jimuMapView:i,fullLayersConfig:s}=this.state,o=this.getAllLayersIncludeSubtype(i),a=null==s?void 0:s.find((e=>e.id===t)),{id:r}=a;let l=o.find((t=>t.type===n.LayerTypes.SceneLayer?r.includes(t.id):t.id===e));return l||o.forEach((t=>{const i=null==t?void 0:t.layers;i&&((null==r?void 0:r.includes(t.id))||(null==r?void 0:r.includes(e)))&&(l=i.find((t=>{var i;return(null===(i=t.layerId)||void 0===i?void 0:i.toString())===e||t.id===e})))})),l},this.startWorkFlowWhenAwait=(e,t)=>K(this,void 0,void 0,(function*(){var i,s,o;const{activeId:a,dataSources:n,editFeatures:r,jimuMapView:l}=this.state,d=this.edit,u=e||r,c=this.flatMapArrayWithView(u,l).length;if(1===c){const e=t||a,r=this.getLayerObjectIdField(n[e]),l=null===(s=null===(i=null==u?void 0:u[e])||void 0===i?void 0:i[0])||void 0===s?void 0:s.feature,c=this.getCurrentEditLayer(null===(o=null==l?void 0:l.layer)||void 0===o?void 0:o.id);if(!c)return;const p=new j.default({where:`${r} = ${l.attributes[r]}`,outFields:["*"],returnGeometry:!0});c.queryFeatures(p).then((e=>{const t=null==e?void 0:e.features[0];null==d||d.startUpdateWorkflowAtFeatureEdit(t)})).catch((e=>{console.error(e)}))}else if(c>1){const e=()=>K(this,void 0,void 0,(function*(){var e,t;let i=[];const s=[];for(const i in u){const o=this.getLayerObjectIdField(n[i]),a=null==u?void 0:u[i];if((null==a?void 0:a.length)>0){const n=`${o} IN (${u[i].map((e=>(null==e?void 0:e.feature).attributes[o])).join()})`,r=null===(e=a[0])||void 0===e?void 0:e.feature,l=this.getCurrentEditLayer(null===(t=null==r?void 0:r.layer)||void 0===t?void 0:t.id);if(!l)return;const d=new j.default({where:n,outFields:["*"],returnGeometry:!0});s.push(l.queryFeatures(d))}}const o=yield Promise.all(s);return Object.keys(u).forEach(((e,t)=>{var s;i=i.concat((null===(s=o[t])||void 0===s?void 0:s.features)||[])})),i})),t=yield e();null==d||d.startUpdateWorkflowAtMultipleFeatureSelection(t)}else(null==d?void 0:d.activeWorkflow)&&(null==d||d.cancelWorkflow())})),this.idsArrayEquals=(e,t)=>{var i,s;if(!t)return!1;if((null===(i=this.selectedIds[e])||void 0===i?void 0:i.length)!==t.length)return!1;let o=!0;return null===(s=this.selectedIds[e])||void 0===s||s.forEach(((e,i)=>{e!==t[i]&&(o=!1)})),o},this.dsSelectionChangeExec=(t,i)=>{var s,o;const n=this.currentRequestId+1;this.currentRequestId++,this.selectedIds[t]=i;const{activeId:r,dataSources:l,editFeatures:d,jimuMapView:u,fullLayersConfig:c}=this.state,{id:p,config:h,widgetsRuntimeInfo:f}=this.props,{editMode:v}=h,m=v===e.Geometry;m||this.setState({formChange:!1});let g=t;const y=Object.assign({},d);if(!l[g]){const e=this.dsManager.getDataSource(g);e&&(l[g]=e)}const b=null===(s=l[g])||void 0===s?void 0:s.getSelectedRecords();if(m){const e=this.edit;if(!e&&!this.changeBeforeRender){this.changeBeforeRender={dataSourceId:t,selectedRecords:b};let e=0;return void(this.loadChangeAfterRenderTimer=setInterval((()=>{if(e++,this.edit){const{dataSourceId:e,selectedRecords:t}=this.changeBeforeRender;this.onDataSourceSelectedChange(e,t),this.changeBeforeRender=void 0,clearInterval(this.loadChangeAfterRenderTimer)}else 5!==e||this.edit||(this.changeBeforeRender=void 0,clearInterval(this.loadChangeAfterRenderTimer))}),1e3))}const i=null==e?void 0:e.layerInfos.find((e=>g.includes(e.layer.id)));((null==i?void 0:i.updateEnabled)||(null==i?void 0:i.deleteEnabled))&&(y[g]=b)}else y[g]=b;const S=this.getInLayersConfigFeatures(y,c),w=this.flatMapArray(S).length;if(this.setState({editFeatures:y}),m&&0===w){const e=this.edit;(null==e?void 0:e.activeWorkflow)&&(null==e||e.cancelWorkflow())}if(this.editorSelectFeature)return this.setState({activeId:t}),void(this.editorSelectFeature=!1);if(0===(null==b?void 0:b.length)&&1===w){let e;for(const t in y)1===(null===(o=null==y?void 0:y[t])||void 0===o?void 0:o.length)&&(e=t);g=e}if(m&&0===(null==b?void 0:b.length)){const e=this.edit;(null==e?void 0:e.activeWorkflow)&&(null==e||e.cancelWorkflow())}const I=r!==t;if(m||this.setState({activeId:g},(()=>{this.createEditForm(g,I,n)})),m&&i&&0!==i.length&&this.setState({activeId:t}),m&&0!==w){if(!u)return;if(f[p].state===a.WidgetState.Closed)return;this.setState({selectionStartWorkflow:!0},(()=>{this.startWorkFlowWhenAwait(y,g)}))}},this.onDataSourceSelectedChange=(e,t)=>K(this,void 0,void 0,(function*(){this.remainDsId&&this.remainDsId===e?this.remainDsId="":this.idsArrayEquals(e,t)||this.dsSelectionChangeExec(e,t)})),this.onIsDataSourceNotReady=(e,t)=>{this.setState((i=>{var s;if(!(null===(s=i.dataSources[e])||void 0===s?void 0:s.getDataSourceJson().isOutputFromWidget))return;const o=Object.assign({},i.outputDataSourceIsNotReady);return o[e]=t===a.DataSourceStatus.NotReady,{outputDataSourceIsNotReady:o}}))},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const s=Object.assign({},i.dataSources);return s[e]=t,{dataSources:s}}))},this.onDataSourceVersionChange=t=>{const{config:i}=this.props,{editMode:s}=i;s===e.Attribute&&this.setState({activeId:t,formChange:!1},(()=>{this.createEditForm(t,!0)}))},this.onLayerChange=e=>{var t;const{dataSources:i}=this.state,s=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.setState({activeId:s},(()=>{this.renderFeatureForm(i[s])}))},this.handleBack=()=>{const{id:e,config:t}=this.props,{layersConfig:i}=t,{editFeatures:s}=this.state,o=this.getInLayersConfigFeatures(s,i),a=this.flatMapArray(o).length;a<=1?this.setState({featureFormStep:"empty"}):a>1&&this.setState({featureFormStep:"list"}),document.getElementById(`edit-container-${e}`).classList.add("esri-hidden")},this.getInLayersConfigFeatures=(e,t)=>{const i=Object.assign({},e);return Object.keys(e).forEach((e=>{(null==t?void 0:t.some((t=>e.includes(t.id))))||delete i[e]})),i},this.handleChangeModeOk=()=>{this.setState({selectionChangeConfirm:!1});const{dataSourceId:e,selectedIds:t}=this.toBeChangedSelection;this.dsSelectionChangeExec(e,t)},this.handleChangeModeClose=()=>{const{dataSources:e}=this.state;this.setState({selectionChangeConfirm:!1});const{dataSourceId:t}=this.toBeChangedSelection;if(t){(e[t]||this.dsManager.getDataSource(t)).selectRecordsByIds(this.selectedIds[t]),this.remainDsId=t}},this.state={jimuMapView:void 0,dataSources:{},outputDataSourceIsNotReady:{},editFeatures:{},activeId:void 0,featureFormStep:"empty",filterText:"",formPrivileges:"normal",formEditable:!1,delConfirm:!1,attrUpdating:!1,formChange:!1,formSubmittable:!0,loading:!1,selectionStartWorkflow:!1,selectionChangeConfirm:!1,fullLayersConfig:void 0,mapUseDataSources:[],mapDataSources:[]},this.editContainer=a.React.createRef(),this.formHeaderContainer=a.React.createRef(),this.dsManager=a.DataSourceManager.getInstance(),this.removeLayerOnce=!1,this.selectedIds={},this.currentRequestId=0,this.timerFn=null,this.editorSelectFeature=!1,this.editorNotBackButton=!1,this.relationships={},this.changeBeforeRender=void 0,this.loadChangeAfterRenderTimer=void 0,this.toBeChangedSelection={dataSourceId:"",selectedIds:[]},this.remainDsId="",this.isActiveViewChange=!1}componentDidUpdate(i,s){return K(this,void 0,void 0,(function*(){var n,r,l,d,u,c,p,h,f,v,m,g,y;const{id:b,config:S,widgetsRuntimeInfo:w,useMapWidgetIds:I}=this.props,{editFeatures:x,dataSources:D,activeId:E,jimuMapView:_,featureFormStep:j,fullLayersConfig:F,mapUseDataSources:L}=this.state,{editMode:M,layersConfig:A,mapViewsConfig:O,selfSnapping:N,featureSnapping:T,defaultSelfEnabled:R,defaultFeatureEnabled:k,defaultSnapLayers:V,snapSettingMode:P,tooltip:U,defaultTooltipEnabled:$,templateFilter:B,relatedRecords:W,liveDataEditing:H,initialReshapeMode:G}=S,{editFeatures:z,fullLayersConfig:J,mapUseDataSources:X}=s,{config:K,widgetsRuntimeInfo:Q,useMapWidgetIds:Y}=i,{editMode:Z,layersConfig:ee,mapViewsConfig:te,selfSnapping:ie,featureSnapping:se,defaultSelfEnabled:oe,defaultFeatureEnabled:ae,defaultSnapLayers:ne,snapSettingMode:re,tooltip:le,defaultTooltipEnabled:de,templateFilter:ue,relatedRecords:ce,liveDataEditing:pe,initialReshapeMode:he}=K;if(a.lodash.isDeepEqual(L,X)&&this.setState({mapDataSources:L}),!(a.lodash.isDeepEqual(I,Y)||I&&0!==I.length))return void this.setState({fullLayersConfig:[]});let fe;const ve=M===e.Geometry;!a.lodash.isDeepEqual(A,ee)||!a.lodash.isDeepEqual(O,te)||M!==Z?(fe=yield q(A,O,_,ve),this.setState({fullLayersConfig:fe}),ve&&this.updateAllUseDataSourcesFromView(_)):fe=F;const me=w[b].state,ge=Q[b].state,ye=this.getInLayersConfigFeatures(x,fe),be=this.flatMapArray(ye),Se=be.length;if(ve)if(ge===a.WidgetState.Opened&&me===a.WidgetState.Closed){const e=this.edit;(null==e?void 0:e.activeWorkflow)&&(null==e||e.cancelWorkflow())}else ge===a.WidgetState.Closed&&me===a.WidgetState.Opened&&0!==Se&&this.setState({selectionStartWorkflow:!0},(()=>{this.startWorkFlowWhenAwait()}));else ge===a.WidgetState.Closed&&me===a.WidgetState.Opened&&this.createEditForm(E,!1);const we=this.getInLayersConfigFeatures(z,ee),Ie=this.flatMapArray(we),xe=be.length,Ce=Ie.length;0===xe||0===Ce||this.getWhetherArrayIsShallowEqual(be,Ie)?this.editorNotBackButton=!1:this.editorNotBackButton=!0;const De=!a.lodash.isDeepEqual(J,fe)&&!a.lodash.isDeepEqual(s,this.state),Ee=W!==ce,_e=H!==pe||Ee;0===(null==fe?void 0:fe.length)&&this.destroyEdit();if(Z!==M&&this.destroyEdit(),De||_e)if(ve)this.newOrUpdateEditor(Me.new,void 0,Ee,fe);else{const e=this.edit,i=Object.keys(x),s=A.some((e=>i.includes(e.id))),o=this.getInLayersConfigFeatures(x,A),a=this.flatMapArray(o).length;if((null==e?void 0:e.formTemplate)&&0!==A.length){const i=A.asMutable({deep:!0}).find((e=>e.id===E));if((null==i?void 0:i.layerHonorMode)===t.Webmap){const t=D[E];e.formTemplate=null===(n=null==t?void 0:t.layer)||void 0===n?void 0:n.formTemplate}else if(null==e?void 0:e.formTemplate){const t=this.constructFormElements(),i=new C.default({elements:t});e.formTemplate=i}const s=null===(r=null==e?void 0:e.formTemplate)||void 0===r?void 0:r.elements;0===(null==s?void 0:s.length)?null===(l=document.getElementById(`edit-container-${b}`))||void 0===l||l.classList.add("esri-hidden"):0!==a&&"form"===j&&(null===(d=document.getElementById(`edit-container-${b}`))||void 0===d||d.classList.remove("esri-hidden"))}else if(0!==A.length&&s)if(1===a){const e=null==D?void 0:D[i[0]],t=null===(u=e.getSelectedRecords())||void 0===u?void 0:u[0];if(!t)return;this.renderFeatureForm(e,t)}else(a>1||0===a)&&(null===(c=document.getElementById(`edit-container-${b}`))||void 0===c||c.classList.add("esri-hidden"))}const je=P===o.Flexible&&(N||T),Fe=je||U;if(N!==ie||T!==se||R!==oe||k!==ae||V!==ne||P!==re){const e=yield this.getDefaultSnapSources(_,V);if(this.edit&&ve){const t=this.edit,i=t.visibleElements,s=Object.assign(Object.assign({},i),{settingsMenu:Fe,tooltipsToggle:U,snappingControls:je,snappingControlsElements:{enabledToggle:!0,selfEnabledToggle:N,featureEnabledToggle:T,gridEnabledToggle:!1,gridControls:!1,gridControlsElements:{}}}),o=t.snappingOptions,a=Object.assign(Object.assign({},o),{enabled:R||k,selfEnabled:R,featureEnabled:k,featureSources:e});t.visibleElements=s,t.snappingOptions=a}}if((U!==le||$!==de)&&this.edit&&ve){const e=this.edit;e.visibleElements.tooltipsToggle=U,e.visibleElements.settingsMenu=Fe;const t=e.tooltipOptions,i=Object.assign(Object.assign({},t),{enabled:$});e.tooltipOptions=i}if(B!==ue&&this.edit&&ve){this.edit.supportingWidgetDefaults={featureTemplates:{visibleElements:{filter:B}}}}if(G!==he&&this.edit&&ve){this.edit.supportingWidgetDefaults={sketch:{defaultUpdateOptions:{tool:G?"reshape":"transform"}}}}if(((null===(h=null===(p=this.props)||void 0===p?void 0:p.stateProps)||void 0===h?void 0:h.removeLayerFlag)||!1)&&!this.removeLayerOnce){this.props.dispatch(a.appActions.widgetStatePropChange(b,"removeLayerFlag",!1));const e=Object.assign({},x);Object.keys(e).forEach((t=>{A.find((e=>e.id===t))||delete e[t]}));const t=this.getInLayersConfigFeatures(e,A),i=this.flatMapArray(t),s=i.length,o=s>1?"list":1===s?"form":"empty";if("form"===o){this.removeLayerOnce=!0;const e=null===(m=null===(v=null===(f=i[0])||void 0===f?void 0:f.dataSource)||void 0===v?void 0:v.belongToDataSource)||void 0===m?void 0:m.id;null===(g=document.getElementById(`edit-container-${b}`))||void 0===g||g.classList.remove("esri-hidden"),this.renderFeatureForm(D[e],i[0])}else"list"===o&&(null===(y=document.getElementById(`edit-container-${b}`))||void 0===y||y.classList.add("esri-hidden"));this.setState({editFeatures:e,featureFormStep:o})}}))}componentWillUnmount(){const{config:t}=this.props,{editMode:i}=t,s=i===e.Geometry;if(this.edit&&!this.edit.destroyed&&s){const e=this.edit;(null==e?void 0:e.cancelWorkflow)&&e.cancelWorkflow()}}render(){var t,i,s;const{activeId:o,editFeatures:u,featureFormStep:c,formPrivileges:p,formEditable:f,delConfirm:v,attrUpdating:m,formChange:g,formSubmittable:y,loading:b,fullLayersConfig:S,mapUseDataSources:w}=this.state,{id:I,theme:x,config:C,useDataSources:D,useMapWidgetIds:E}=this.props,{editMode:_,description:j,layersConfig:F}=C,L=_===e.Attribute,M=L?F:S,A=null==M?void 0:M.find((e=>e.id===o)),O=null!==(t=null==A?void 0:A.updateRecords)&&void 0!==t&&t,N=null!==(i=null==A?void 0:A.deleteRecords)&&void 0!==i&&i,T=this.getInLayersConfigFeatures(u,M),k=this.flatMapArray(T).length,V=F.some((e=>null==e?void 0:e.isTable)),P=F.some((e=>null==e?void 0:e.addRecords)),U="full"===p,$="normal"===p,B=[];(U||$&&O)&&B.push({label:this.formatMessage("update"),type:"primary",disabled:!(g&&y),clickHandler:this.handleSave}),(U||$&&N)&&B.push({label:this.formatMessage("delete"),type:"default",clickHandler:this.handleDeleteConfirm});const W=[],H=U&&V||$&&P;H&&W.push({label:this.formatMessage("add"),type:"primary",disabled:!1,clickHandler:this.handleAdd});const G=L&&("form"===c||"new"===c)||!L&&M&&0!==(null==M?void 0:M.length),z=L&&"list"!==c&&"empty"!==c||!L&&M&&0!==(null==M?void 0:M.length),J=L&&"list"!==c&&"empty"!==c;let q;return U?q=F.filter((e=>e.isTable)):$&&(q=F.filter((e=>e.addRecords))),L||E&&0!==E.length?(0,a.jsx)("div",{className:(0,a.classNames)(`jimu-widget widget-edit esri-widget edit-widget-${I}`),css:l(x,I,c,k,L)},L&&m&&(0,a.jsx)("div",{className:we}),(0,a.jsx)("div",{className:(0,a.classNames)("edit-con",{"surface-1 border-0":G,"h-100":z})},(0,a.jsx)("div",{className:(0,a.classNames)({"form-header-container":J}),ref:this.formHeaderContainer}),(0,a.jsx)("div",{className:(0,a.classNames)({"h-100":!L,"attr-height":L&&z}),ref:this.editContainer},L&&"new"===c&&(0,a.jsx)("div",{className:"layer-selector"},(0,a.jsx)("label",{className:"esri-feature-form__label"},this.formatMessage("selectLayer")),(0,a.jsx)(r.Select,{value:o,onChange:this.onLayerChange},q.map((e=>(0,a.jsx)("option",{key:e.id,value:e.id},e.name)))))),L&&k>0&&"form"===c&&f&&(null==B?void 0:B.length)>0&&this.renderControlButtons(B),L&&"new"===c&&this.renderControlButtons(W)),!L&&(0,a.jsx)(n.JimuMapViewComponent,{useMapWidgetId:null==E?void 0:E[0],onActiveViewChange:this.handleActiveViewChange}),L&&k>1&&"list"===c&&this.renderFeatureList(T,j),b&&(0,a.jsx)(r.Loading,null),L&&("empty"===c||0===F.length)&&this.renderFormEmpty(j),!L&&(!M||0===(null==M?void 0:M.length))&&this.renderFormEmpty(),L&&v&&(0,a.jsx)(a.React.Fragment,null,(0,a.jsx)("div",{className:"confirm-scrim"}),(0,a.jsx)("div",{className:Ie},(0,a.jsx)("div",{className:xe},(0,a.jsx)(R,null),(0,a.jsx)("h4",{className:(0,a.classNames)(ge,Ce)},this.formatMessage("deleteRecord"))),(0,a.jsx)("div",{className:De},this.formatMessage("deleteRecordTips")),(0,a.jsx)("div",{className:Ee}),(0,a.jsx)("div",{className:_e},(0,a.jsx)(r.Button,{className:(0,a.classNames)(ye,be),onClick:this.cancelDelete},this.formatMessage("keepRecord")),(0,a.jsx)(r.Button,{className:(0,a.classNames)(ye,Se),onClick:this.handleDelete},this.formatMessage("delete"))))),L&&H&&"form"!==c&&"new"!==c&&(0,a.jsx)(r.Button,{size:"sm",icon:!0,type:"tertiary",className:"add-feature-btn",onClick:this.handleNew,title:this.formatMessage("addFeature"),"aria-label":this.formatMessage("addFeature")},(0,a.jsx)(h,{className:"mr-1"}),this.formatMessage("add")),(0,a.jsx)("div",{className:"ds-container"},null===(s=L?D:w)||void 0===s?void 0:s.map(((e,t)=>(0,a.jsx)(d,{key:t,useDataSource:e,onIsDataSourceNotReady:this.onIsDataSourceNotReady,onDataSourceSelectedChange:this.onDataSourceSelectedChange,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed,onDataSourceVersionChange:this.onDataSourceVersionChange}))))):(0,a.jsx)(r.WidgetPlaceholder,{widgetId:I,autoFlip:!0,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:Q,"data-testid":"editPlaceholder"})}}Ae.mapExtraStateProps=(e,t)=>{var i;return{appMode:null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.appMode,widgetsRuntimeInfo:null==e?void 0:e.widgetsRuntimeInfo}},Ae.versionManager=A;const Oe=Ae;function Ne(e){v.p=e}})(),m})())}}}));