System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-core/react","jimu-theme","jimu-ui/basic/sql-expression-runtime"],(function(e,t){var i={},o={},s={},n={},r={},l={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.CONSTANTS=e.CONSTANTS,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.LayoutType=e.LayoutType,i.LinkType=e.LinkType,i.MessageManager=e.MessageManager,i.PageMode=e.PageMode,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.RepeatedDataSourceProvider=e.RepeatedDataSourceProvider,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jimuHistory=e.jimuHistory,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){o.Alert=e.Alert,o.Button=e.Button,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.DistanceUnits=e.DistanceUnits,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.LinkTip=e.LinkTip,o.ListGroupItem=e.ListGroupItem,o.Pagination=e.Pagination,o.Popper=e.Popper,o.TextAlignValue=e.TextAlignValue,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o._Link=e._Link,o.defaultMessages=e.defaultMessages,o.hooks=e.hooks,o.styleUtils=e.styleUtils,o.utils=e.utils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils},function(e){n.Fragment=e.Fragment,n.PureComponent=e.PureComponent,n.createElement=e.createElement,n.forwardRef=e.forwardRef},function(e){r.useTheme=e.useTheme},function(e){l.SqlExpressionRuntime=e.SqlExpressionRuntime,l.updateSQLExpressionByVersion=e.updateSQLExpressionByVersion}],execute:function(){e((()=>{var e={70778:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#FFF" fill-rule="nonzero" d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4M2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},47569:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M18.5.995c0-.55-.43-.995-.96-.995H2.46a.94.94 0 0 0-.605.223 1.02 1.02 0 0 0-.14 1.4L6.5 7.72c.122.156.196.347.212.548l.835 10.815q.011.139.058.27a.95.95 0 0 0 1.237.582l2.112-.82a.99.99 0 0 0 .615-.797l1.325-10.062c.025-.193.105-.374.228-.52l5.141-6.087c.154-.181.238-.414.238-.655M2.5 1h14.999l-5.141 6.09-.117.153a2 2 0 0 0-.34.883l-1.325 10.062-2.035.792-.833-10.788-.02-.169a2 2 0 0 0-.402-.92L2.502 1.006z" clip-rule="evenodd"></path></svg>'},51879:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M6 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path fill="#000" d="M10.5 2a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zM10 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M6 12a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path fill="#000" d="M10 14.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M10.5 17a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},76219:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6 1.5a.5.5 0 1 0-1 0v12.158L1.207 9.06a.5.5 0 1 0-.76.652l4.146 5.008A.8.8 0 0 0 6 14.2zm4 13a.5.5 0 1 0 1 0V2.342l3.794 4.598a.5.5 0 1 0 .759-.652L11.407 1.28A.8.8 0 0 0 10 1.8z" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},20904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},27964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},10527:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2zm.951-4v-2H5.817l-.578-1h8.81v3z" clip-rule="evenodd"></path></svg>'},73027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=n},41496:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=o},76117:e=>{"use strict";e.exports=l}},t={};function a(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var d={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(d),a.d(d,{Widget:()=>ki,__set_webpack_public_path__:()=>Ni,default:()=>Di});var e,t=a(79244),i=a(14321);!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(e||(e={}));const o=20,s=8;var n,r,l,c,u,h,p,g,m,f,v;!function(e){e.None="NONE",e.Arrangement="ARRANGEMENT",e.States="STATES",e.Tools="TOOLS"}(n||(n={})),function(e){e.None="NONE",e.Single="SINGLE",e.Multiple="MULTIPLE"}(r||(r={})),function(e){e.Scroll="SCROLL",e.MultiPage="MULTIPAGE"}(l||(l={})),function(e){e.Start="FLEX-START",e.Center="CENTER",e.End="FLEX-END"}(c||(c={})),function(e){e.Horizon="HORIZON",e.Vertical="VERTICAL"}(u||(u={})),function(e){e.Row="ROW",e.Column="COLUMN",e.GRID="GRID"}(h||(h={})),function(e){e.Glide="GLIDE",e.Fade="FADE",e.Float="FLOAT"}(p||(p={})),function(e){e.Hover0="HOVER0",e.Hover1="HOVER1",e.Hover2="HOVER2",e.Hover3="HOVER3"}(g||(g={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3"}(m||(m={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9"}(f||(f={})),function(e){e.Default="DEFAULT",e.Selected="SELECTED",e.Hover="HOVER"}(v||(v={}));var S=a(41496),y=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{a(o.next(e))}catch(e){n(e)}}function l(e){try{a(o.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}a((o=o.apply(e,t||[])).next())}))};function w(e,t,i,o){var s,n;let r,l=[];if(!1===o)return l;if(t&&e&&(r=e.find((e=>e.ruleOptionName===i)),r=r||e[0],(null===(n=null===(s=null==r?void 0:r.rule)||void 0===s?void 0:s[0])||void 0===n?void 0:n.jimuFieldName)||(r=void 0),r)){const e=[];r.rule.forEach((t=>{t.jimuFieldName&&e.push(`${t.jimuFieldName} ${t.order}`)})),l=e}return l}const b=t.utils.memoize((function(e){const{showTopTools:i,bottomToolH:o,topRightToolW:s,hasRecords:n,currentCardSize:r,pageStyle:a,scrollBarOpen:d,appMode:c,theme:p,isHeightAuto:g,isWidthAuto:m,listTemplateDefaultCardSize:f,layoutType:v,listLeftPadding:S}=e,y=i?42:0,w=v===h.Column?u.Horizon:u.Vertical,b=v===h.Column,x=v===h.Column?"column":"row";return t.css`
    &.list-container {
      /* position: ${g?"absolute":"relative"}; */
      position: relative;
      z-index: 0;
      overflow: hidden;
      .bottom-boundary {
        height: 2px;
        width: 2px;
        position: absolute;
        bottom: 0;
        right: 0;
        opacity: 0;
      }
      ${w===u.Horizon?`\n          margin-left: 0px;\n          height: ${g?"auto":"calc(100% - 1px)"};\n          width: ${m?"auto":"calc(100% - 0px)"};\n        `:`\n          margin-top: 0px;\n          width: ${m?"auto":"calc(100% - 1px)"};\n          height: ${g?"auto":"calc(100% - 0px)"};\n        `}

      .editing-mask-con {
        &:before {
          content: '';
          position: absolute;
          left: 0;
          top: ${y}px;
          z-index: 10;
          height: ${r.height}px;
          width: ${S}px;
          background-color: ${t.polished.rgba(p.ref.palette.black,.2)};
        }
        .editing-mask-list-grid {
          position: absolute;
          left: ${r.width+S}px;
          top: ${y}px;
          right: 0;
          z-index: 10;
          height: ${r.height}px;
          background-color: ${t.polished.rgba(p.ref.palette.black,.2)};
        }
      }
      .editing-mask-list {
        position: absolute;
        top: ${v!==h.Column&&n?r.height+y:y}px;
        left: ${v===h.Column&&n?r.width:0}px;
        bottom: ${t.polished.rem(o)};
        right: 0;
        z-index: 10;
        background-color: ${t.polished.rgba(p.ref.palette.black,.2)};
      }

      .editing-mask-ds-tool {
        position: absolute;
        z-index: 10;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background-color: ${t.polished.rgba(p.ref.palette.black,.2)};
      }

      .editing-mask-bottom-tool {
        position: absolute;
        z-index: 10;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background-color: ${t.polished.rgba(p.ref.palette.black,.2)};
      }

      .empty-con {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        z-index: 10;
        transform: translateY(-50%);
        padding-top: ${y}px;
        .jimu-icon {
          color: ${p.sys.color.warning.dark};
        }
        .discribtion {
          margin: ${t.polished.rem(9)} 0 ${t.polished.rem(8)} 0;
          font-size: ${t.polished.rem(14)};
          color: ${p.ref.palette.black}
        }
        .clear-message-action-button {
          width: ${t.polished.rem(65)};
        }
      }

      .datasource-tools {
        position: relative;
        height: ${t.polished.rem(y)};
        padding: ${t.polished.rem(4)} ${t.polished.rem(4)} ${t.polished.rem(14)} ${t.polished.rem(4)};
        .list-sort-con {
          margin-right: ${t.polished.rem(4)};
        }
        .sort-fields-input {
          width: 200px;
          margin-left: 8px;
          margin-right: 16px;
        }

        .tool-row {
          height: ${28}px;
        }
        .ds-tools-line {
          width: 100%;
          height: 1px;
          margin-top: ${t.polished.rem(6)};
          background-color: ${p.ref.palette.neutral[500]};
        }
        .ds-tools-line-blue {
          background-color: ${p.sys.color.info.main};
        }
        .list-search-div {
          width: calc(100% - ${s}px);
          .list-search {
            margin-bottom: ${t.polished.rem(-4)};
            width: 100%;
          }
        }
        .top-right-tools-size-3 {
          max-width: 73%;
        }
        .top-right-tools-size-2 {
          max-width: 65%;
        }
        .top-right-tools-size-1 {
          max-width: 55%;
        }
        .top-right-tools-size-0 {
          max-width: 85%;
        }
      }
      .tools-menu {
        color: var(--ref-palette-black);
        margin-top: 1px;
      }
      .tools-menu:hover {
        color: ${p.sys.color.info.main};
      }
      .bottom-tools {
        position: relative;
        padding-top: ${t.polished.rem(14)};
        min-height: ${t.polished.rem(40)};
        .scroll-navigator {
          .btn {
            border-radius: 50%;
          }
        }
      }

      .widget-list-list:focus {
        outline: none;
      }
      .widget-list-list {
        & {
          padding: 0;
          position: relative;
          padding-left: ${`${S}px`};
        }
        &>div {
          position: relative;
          flex: 1;
          box-sizing: content-box;
        }
        /* box-sizing: border-box; */
        ${window.jimuConfig.isInBuilder&&c===t.AppMode.Design?"overflow: hidden !important;":`overflow-${b?"y":"x"}: hidden !important;`}
        height: ${g?"auto":`calc(100% - ${y}px - ${o}px)`} !important;
        width: ${m?"auto":"100%"} !important;
        display: flex;
        ${`flex-direction: ${x}`};
        ${g&&`min-height: ${f.height}px;`};
        ${m&&`min-width: ${f.width}px;`};
        ${function(e,t,i,o,s){return e===l.MultiPage?null:t?`max-width: ${i.maxWidth};`:`max-height: calc(${i.maxHeight} - ${o}px - ${s}px);`}(a,b,e.mexSize,y,o)}
      }
      .hide-list {
        overflow: hidden !important;
      }
      ${a!==l.Scroll||d?"":"\n          .widget-list-list::-webkit-scrollbar {\n            display: none; //Safari and Chrome\n          }\n          .widget-list-list {\n              -ms-overflow-style: none; //IE 10+\n              overflow: -moz-scrollbars-none; //Firefox\n              scrollbar-width: none; /* Firefox */\n          }\n        "}
      .placeholder-alert-con {
        position: absolute;
        bottom: ${t.polished.rem(8)};
        right: ${t.polished.rem(8)};
        z-index: 11;
      }
    }
  `}));function x(e,i,o){var s,n,r,l,a,d,c,h,p,g;const{config:m,id:f,appMode:v,isHeightAuto:S,isWidthAuto:y,theme:w}=e;return t.css`
    ${"&.list-widget-"+f} {
      overflow: visible;
      background-color: transparent;
      border: ${t.polished.rem(0)} solid ${t.polished.rgba(w.ref.palette.black,window.jimuConfig.isInBuilder&&i?.2:0)};
      height: ${S?"auto":"100%"};
      width: ${y?"auto":"100%"};
      .list-auto-refresh-button {
        padding: 0;
        svg {
          margin: 0;
        }
      }
      .list-with-mask {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        top: 0;
        background-color: ${t.polished.rgba(w.ref.palette.black,0)};
        z-index: 1;
      }
      .list-toggle-button {
        background: none;
      }
      .list-loading-con {
        min-height: ${t.polished.rem(120)};
        min-width: ${t.polished.rem(160)};
      }
      .list-error-con {
        .alert-panel-of-list {
          border-radius: 0;
          text-align: left;
          left: ${t.polished.rem(4)};
          right: ${t.polished.rem(4)};
          bottom: ${t.polished.rem(4)};
          width: auto;
        }
      }
      .refresh-loading-con {
        right: 0;
        bottom:${o?t.polished.rem(40):0};
        align-items: center;
        height: ${t.polished.rem(18)};
        .auto-refresh-loading {
          background: ${null===(n=null===(s=null==w?void 0:w.ref.palette)||void 0===s?void 0:s.neutral)||void 0===n?void 0:n[200]};
          color: ${null===(r=w.ref.palette)||void 0===r?void 0:r.black};
          font-size: ${t.polished.rem(12)};
          line-height: ${t.polished.rem(18)};
          padding: 0 ${t.polished.rem(5)};
          .auto-refresh-string-con {
            padding: 0 ${t.polished.rem(2)};
          }
        }
        &.horizon-loading {
          bottom:${o?t.polished.rem(46):t.polished.rem(6)};
        }
        &.vertical-loading {
          right: ${t.polished.rem(6)};
        }
      }
      .loading-con {
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        width: ${t.polished.rem(16)};
        height: ${t.polished.rem(16)};
        border: 1px solid ${null===(a=null===(l=null==w?void 0:w.ref.palette)||void 0===l?void 0:l.neutral)||void 0===a?void 0:a[800]};
        border-radius: 50%;
        border-top: 1px solid ${null===(c=null===(d=null==w?void 0:w.ref.palette)||void 0===d?void 0:d.neutral)||void 0===c?void 0:c[1100]};
        box-sizing: border-box;
        animation:loading 2s infinite linear;
        margin-right: ${t.polished.rem(4)};
      }
      .widget-list {
        overflow: ${window.jimuConfig.isInBuilder&&v===t.AppMode.Design?"hidden":"auto"};
        height: ${S?"auto":"100%"};
        width: ${y?"auto":"100%"};
        /* align-items: ${m.alignType};
        justify-content: ${m.alignType}; */
        ${m.direction===u.Horizon?"\n            overflow-y: hidden;\n          ":"\n            overflow-x: hidden;\n          "}
      }
      .data-count {
        left: 0;
        bottom: 0;
        background: ${null===(p=null===(h=null==w?void 0:w.ref.palette)||void 0===h?void 0:h.neutral)||void 0===p?void 0:p[200]};
        color: ${null===(g=w.ref.palette)||void 0===g?void 0:g.black};
        font-size: ${t.polished.rem(12)};
        line-height: ${t.polished.rem(18)};
        padding: 0 ${t.polished.rem(5)};
      }
    }

  `}function I(e){const{theme:i}=e;return t.css`
    & {
      padding: ${t.polished.rem(6)} ${t.polished.rem(11)};
      height: ${t.polished.rem(40)};
    }
    .list-toggle-button {
      background: none;
    }
    .list-sort-con, .list-search-icon {
      margin-right: ${t.polished.rem(4)};
    }
    .ds-tools-line {
      width: 100%;
      height: 1px;
      background-color: ${i.ref.palette.neutral[500]};
    }
    .ds-tools-line-blue {
      background-color: ${i.sys.color.info.main};
    }
    .close-search {
      margin-top: ${t.polished.rem(-6)};
    }
    .list-search-div {
      svg {
        color: var(--ref-palette-neutral-1100) !important;
      }
    }
    div.list-sort-con {
      margin-left: 0;
    }
  `}function C(e){const{theme:i}=e;return t.css`
    .close-search {
      border: 1px solid ${i.ref.palette.neutral[500]};
      box-sizing: border-box;
      background-color: ${i.ref.palette.white};
    }
    .search-box-content {
      flex-direction: column;
      align-items: flex-start;
    }
  `}const{useRef:R,useState:T}=t.React,M=e=>{var o;const{useDataSources:s,appMode:n,linkParam:r,widgetId:l,queryObject:a,children:d,changeIsCanClickLink:c}=e,u=R(null),h=R(null),p=t.React.useContext(t.jimuHistory.HistoryContext),[g,m]=T(!1),[f,v]=T(null),S=i.hooks.useApplyLinkResult(),y=()=>{clearTimeout(h.current),m(!0),setTimeout((()=>{m(!1)}),3e3)},w=()=>{var e,i;let o=!1;return(null==r?void 0:r.linkType)===t.LinkType.WebAddress&&(r.value?o=t.urlUtils.isAbsoluteUrl(r.value):(null===(e=null==r?void 0:r.expression)||void 0===e?void 0:e.name)&&(o=t.urlUtils.isAbsoluteUrl(null===(i=null==r?void 0:r.expression)||void 0===i?void 0:i.name))),o},b=e=>{const t=e.target;return x(t,e)||x(null==t?void 0:t.parentNode,e)},x=(e,t)=>{if(!e)return!1;const i=null==e?void 0:e.getAttribute("z-index"),o=null==e?void 0:e.role,s=e&&e.tagName||"",n="button"===s.toLowerCase()||"button"===o,r="a"===s.toLowerCase()||"linkClick"===t.exbEventType,l="input"===s.toLowerCase()||"input"===o;return n||r||!!i&&i>-1||l},I=t.css`
    .list-clear-background {
      background: transparent !important;
    }
    .list-link {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
    }
  `,C=t.hooks.useEventCallback((e=>{const i=null==r?void 0:r.openType,o={linkType:null==r?void 0:r.linkType,value:null==r?void 0:r.value};let s=e;return(null==r?void 0:r.linkType)===t.LinkType.WebAddress&&(o.value=f||(null==o?void 0:o.value),s=void 0),{queryObject:s,target:i,linkTo:o}})),M=e=>{e.stopPropagation()};return(0,t.jsx)("div",{className:"w-100 h-100",onClick:e=>{if(c&&!c())return;const i=window.jimuConfig.isInBuilder;if(n===t.AppMode.Design&&i)return!1;const o=b(e),s=w();if(!o&&(null==r?void 0:r.linkType)&&(null==r?void 0:r.linkType)!==t.LinkType.None){const o=C(a);if(s){if(i)return y(),!1;"_self"===r.openType?window.location.href=o.linkTo.value:o.linkTo.value&&window.open(o.linkTo.value,r.openType)}else if((null==r?void 0:r.linkType)===t.LinkType.Block)u.current.click();else{if(i&&(null==r?void 0:r.linkType)===t.LinkType.PrintPreview)return y(),!1;S({evt:e,linkTo:o.linkTo,target:o.target,replace:!1,queryObject:o.queryObject})}}"linkClick"===e.exbEventType&&delete e.exbEventType},css:I},(()=>{var e;const o=C(a);return(null===(e=null==o?void 0:o.linkTo)||void 0===e?void 0:e.linkType)&&(0,t.jsx)(i._Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:u,to:o.linkTo,target:o.target,queryObject:o.queryObject,onClick:M})})(),d,s&&(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:s,expression:null==r?void 0:r.expression,onChange:e=>{if(e.isSuccessful)v(e.value);else{v("")}},widgetId:l}),window.jimuConfig.isInBuilder&&(w()||(null==r?void 0:r.linkType)===t.LinkType.PrintPreview)&&(0,t.jsx)(i.LinkTip,{reference:null===(o=u.current)||void 0===o?void 0:o.id,open:g,href:(()=>{const e=C(a);return t.urlUtils.getHrefFromLinkTo(e.linkTo,a,p&&p.location)||""})()}))};class O extends t.React.Component{constructor(){super(...arguments),this.getNewProviderData=()=>{const{widgetId:e,datasourceId:t,index:i,record:o}=this.props;return{widgetId:e,dataSourceId:t,recordIndex:i,record:o}},this.shouldComponentUpdateExcept=(e,t,i,o=[])=>{let s=!1;return this.props&&Object.keys(this.props).some((t=>!i.includes(t)&&(this.props[t]!==e[t]&&(s=!0,!0)))),this.state&&Object.keys(this.state).some((e=>!o.includes(e)&&(this.state[e]!==t[e]&&(s=!0,!0)))),s},this.isProviderEqual=(e,t)=>{let i=!0;if(e)Object.keys(e).some((o=>{if(!t)return i=!1,!0;return e[o]!==t[o]&&(i=!1,!0)}));else if(t)return!1;return i},this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:i,selectable:o,appMode:s}=this.props,n=this.checkIsBackgroundTransparent(e);return t.css`
      ${"&.list-card-"+i} {
        padding: 0;
        border: 0;
        background-color: transparent;
        .list-card-content {
          width: 100%;
          height: 100%;
          overflow: hidden;
        }
      }
      &.surface-1 {
        border: none !important;
        background: ${n&&"none !important"};
      }
      .list-item-con {
        overflow: hidden;
      }
      ${"&.list-card-"+i}:hover {
        ${window.jimuConfig.isInBuilder&&s===t.AppMode.Design||!o?"":"cursor: pointer;"}
      }
      .card-editor-mask {
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 100;
      }
      .jimu-link {
        text-align: left;
      }
    `}}checkIsBackgroundTransparent(e){var t,i,o;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(o=null===(i=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===i?void 0:i.background)||void 0===o?void 0:o.color)}}var L=a(73027),j=a.n(L),z=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const P=e=>{const i=window.SVG,{className:o}=e,s=z(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:j()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var k=a(10527),D=a.n(k),N=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const A=e=>{const i=window.SVG,{className:o}=e,s=N(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:D()},s)):t.React.createElement("svg",Object.assign({className:n},s))};function E(e,t){return Math.abs(e-t)<1e-4}function B(e,t){const{config:n}=e,r=$(e),l=i.utils.toLinearUnit(r.width);let a=H(i.utils.toLinearUnit(r.width),t.width+n.horizontalSpace-s);l.unit===i.DistanceUnits.PERCENTAGE&&(a=a-n.horizontalSpace>0?a-n.horizontalSpace:o);let d=H(i.utils.toLinearUnit(r.height),t.height);n.keepAspectRatio&&(null==n?void 0:n.layoutType)===h.GRID&&(d=a*(null==n?void 0:n.gridItemSizeRatio));return{width:a,height:d}}function $(e){var t;const{config:i,builderStatus:o,browserSizeMode:s}=e;let n=null==i?void 0:i.asMutable({deep:!0}).cardConfigs[o];n&&n.cardSize||(n=null==i?void 0:i.asMutable({deep:!0}).cardConfigs[v.Default]);let r=null===(t=null==n?void 0:n.cardSize)||void 0===t?void 0:t[s];return r||(r=n.cardSize[Object.keys(n.cardSize)[0]]),r}function _(e){const t=$(e),s={width:o,height:o},n=i.utils.toLinearUnit(t.width),r=i.utils.toLinearUnit(t.height);return n.unit===i.DistanceUnits.PERCENTAGE&&(s.width=(o+30)/n.distance*100),r.unit===i.DistanceUnits.PERCENTAGE&&(s.height=(o+30)/r.distance*100),s}function F(e){const{config:t}=e,s=$(e),n=i.utils.toLinearUnit(s.width);n.unit===i.DistanceUnits.PERCENTAGE&&(n.distance=n.distance-t.horizontalSpace>0?n.distance-t.horizontalSpace:o);return{width:n,height:i.utils.toLinearUnit(s.height)}}function H(e,t){return e.unit===i.DistanceUnits.PERCENTAGE?e.distance/100*t:e.distance}function U(e,t,i,o){const s=B(i,e),{config:n,isHeightAuto:r,isWidthAuto:a}=i;let d;if(n.pageStyle===l.Scroll){if(!e)return 0;switch(null==n?void 0:n.layoutType){case h.Row:if(0===e.height)return 0;r&&(t=document.body.scrollHeight),d=Math.ceil((t+n.space)/(s.height+n.space))+1;break;case h.Column:if(0===e.width)return 0;let i=e.width;a&&(i=document.body.scrollWidth),d=Math.ceil((i+n.space)/(s.width+n.space))+1;break;case h.GRID:if(0===e.height)return 0;r&&(t=document.body.scrollHeight),d=Math.ceil((t+(null==n?void 0:n.verticalSpace))/(s.height+n.space))*o}n.navigatorOpen&&(d=Math.max(d,n.scrollStep))}else d=n.itemsPerPage;return d}function W(e,t){let i=40;return e&&(i=e.clientHeight),i=t?i:0,i}function G(e,t,i){const o=i?42:0;if(!e)return 0;const s=e.height-o-t;return s<0?0:s}function V(e,t){const{config:i}=e,{datasource:o}=t;return!(!o||i.pageStyle===l.Scroll&&!i.navigatorOpen)}function q(e){return Q(e)||K(e)}function Q(e){var t;return Y(e)||Z(e)||ee(e)||X(e)||J(e)||(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.showRefresh)}function K(e){var i,o,s;const{id:n,config:r}=e,l=null===(o=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===o?void 0:o.appConfig,a=null===(s=null==l?void 0:l.widgets)||void 0===s?void 0:s[n];return(void 0===(null==a?void 0:a.enableDataAction)||(null==a?void 0:a.enableDataAction))&&function(e){const{useDataSources:t}=e;return!!t&&!!t[0]}(e)&&r.isItemStyleConfirm}function Y(e){const{config:t}=e;if(!t.sortOpen||!t.sorts||t.sorts.length<1)return!1;const i=t.sorts;let o=!1;return i.some((e=>(e.rule&&e.rule.some((e=>(e&&e.jimuFieldName&&(o=!0),o))),o))),o}function J(e){const{config:t}=e;return t.searchOpen&&!!t.searchFields}function X(e){const{config:t}=e;return t.filterOpen&&!!t.filter}function Z(e){const{config:t}=e;return t.showSelectedOnlyOpen&&t.cardConfigs[v.Selected].selectionMode!==r.None}function ee(e){const{config:t}=e;return t.showClearSelected&&t.cardConfigs[v.Selected].selectionMode!==r.None}function te(e){const i=null==e?void 0:e.asMutable({deep:!0}),o=(null==i?void 0:i.border)||{};return(null==o?void 0:o.color)||!(null==i?void 0:i.border)?e:(null==i||delete i.border,(0,t.Immutable)(Object.assign(Object.assign({},i),o)))}function ie(e,t,i,o,s){var n,r;if(!e)return!1;const l=null===(r=null===(n=e.manifest)||void 0===n?void 0:n.properties)||void 0===r?void 0:r.supportRepeat,a=s.jimuForBuilderLib.getAppConfigAction().appConfig,d=s.widgetModules.selectionInList;return i&&l&&(!e.layoutInfo||e.layoutInfo&&d(e.layoutInfo,o,a,!1))}const oe=16,se=[0,5],ne=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","left-start","bottom-start","top-end","top-start"]}}],re=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}];const le=t.ReactRedux.connect(((e,i)=>{var o;const{selectionIsList:s,builderSupportModules:n,appMode:r,widgetId:l,browserSizeMode:a}=i;if(!window.jimuConfig.isInBuilder||r===t.AppMode.Run)return{selection:void 0,showBreak:!1};const d=null===(o=null==n?void 0:n.widgetModules)||void 0===o?void 0:o.searchUtils,c=n.jimuForBuilderLib.getAppConfigAction().appConfig,u=0===i.index&&i.selectionIsInList&&e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection;return{selection:u,showBreak:!s&&u&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(c,u,l,a).length>1}}))(class extends O{constructor(i){super(i),this.lastResizeCall=null,this.getNewCardSize=(e,t=!1)=>{const{keepAspectRatio:i,layoutType:o,gridItemSizeRatio:s,horizontalSpace:n,isWidthPercentage:r}=this.props;let l,a=e.right-e.left;return!t&&r&&(a=e.right-e.left+n),l=o===h.GRID&&i?{width:a,height:a*s}:{width:a,height:e.bottom-e.top},l},this.handleItemClick=e=>{const{selectCard:t}=this.props;e&&e.stopPropagation(),t()},this.handleCopyTo=(e,t,i)=>{const{layouts:o,builderSupportModules:s,browserSizeMode:n,builderStatus:r,selection:l}=this.props;let a=s.jimuForBuilderLib.getAppConfigAction();const d=S.searchUtils.findLayoutItem(a.appConfig,l);if(!d)return;let c=a.appConfig;const u=S.searchUtils.findLayoutId(o[r],n,c.mainSizeMode),h=S.searchUtils.findLayoutId(o[t],n,c.mainSizeMode);if(i){const e=s.widgetModules.searchUtils,t=d.widgetId,i=c.widgets[t].parent[n],o=i.find((e=>e.layoutId===u)),r=i.find((e=>e.layoutId===h)),l=e.findLayoutItem(c,o);a.editLayoutItemProperty(r,"bbox",l.bbox).editLayoutItemProperty(r,"setting",l.setting)}else{const e=s.jimuForBuilderLib.LayoutServiceProvider.getService(c,h).createBlankItem(c,h);c=e[0];const t=e[1],i={layoutId:h,layoutItemId:t},o=S.searchUtils.findLayoutItem(c,{layoutId:u,layoutItemId:d.id});c=s.jimuForBuilderLib.widgetService.addParent(c,d.widgetId,i,n),a=s.jimuForBuilderLib.getAppConfigAction(c),a.editLayoutItemProperty(i,"bbox",o.bbox).editLayoutItemProperty(i,"setting",o.setting).editLayoutItemProperty(i,"type",o.type).editLayoutItemProperty(i,"widgetId",o.widgetId).adjustOrderOfItem(i,-1)}a.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,i)=>{const{dispatch:o,widgetId:s}=this.props;o(t.appActions.widgetStatePropChange(s,e,i))},this.handleBreakLink=e=>{const{builderSupportModules:i,browserSizeMode:o,selection:s,builderStatus:n,dispatch:r,widgetId:l}=this.props,a=i.jimuForBuilderLib.getAppConfigAction(),d=a.appConfig,c=S.searchUtils.findLayoutItem(d,s);if(!c)return;const u=d.widgets[l].layouts[n][o],h=a.duplicateLayoutItemInSameLayout({layoutId:u,layoutItemId:c.id});a.editLayoutItemProperty({layoutId:u,layoutItemId:h},"bbox",c.bbox).removeLayoutItem({layoutId:u,layoutItemId:c.id},!1),a.exec(),r(t.appActions.selectionChanged({layoutId:u,layoutItemId:h})),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getCopyDropdownItems=i=>{var o,s;const{cardConfigs:n,layouts:l,browserSizeMode:a,selection:d,builderStatus:c,builderSupportModules:u}=this.props,h=u.jimuForBuilderLib.getAppConfigAction().appConfig,p=S.searchUtils.findLayoutItem(h,d);if(!d||!p||!window.jimuConfig.isInBuilder)return{items:(0,t.Immutable)([]),title:""};const g=[];let m="",f=!0,y=n[v.Selected].selectionMode!==r.None,w=!!n[v.Hover].enable;const b=(e,i)=>u.widgetModules.searchUtils.getContentsInLayoutWithRecursiveLayouts(h,e,t.LayoutItemType.Widget,a).indexOf(i)>-1,x=(null===(o=n[v.Hover])||void 0===o?void 0:o.listLayout)!==(null==e?void 0:e.AUTO),I=(null===(s=n[v.Selected])||void 0===s?void 0:s.listLayout)!==(null==e?void 0:e.AUTO),C=()=>{if(n[v.Hover].enable){const e=S.searchUtils.findLayoutId(l[v.Hover],a,h.mainSizeMode);b(e,h.layouts[d.layoutId].content[d.layoutItemId].widgetId)||(w=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,v.Hover,w)}})}},R=()=>{if(n[v.Selected].selectionMode!==r.None){const e=S.searchUtils.findLayoutId(l[v.Selected],a,h.mainSizeMode);b(e,h.layouts[d.layoutId].content[d.layoutItemId].widgetId)||(y=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("selected").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,v.Selected,y)}})}},T=()=>{const e=S.searchUtils.findLayoutId(l[v.Default],a,h.mainSizeMode);b(e,h.layouts[d.layoutId].content[d.layoutItemId].widgetId)||(f=!1),g.push({label:this.formatMessage("applyTo",{status:this.formatMessage("default").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,v.Default,f)}})};return c===v.Default?(x&&C(),I&&R(),w&&y?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("selected").toLocaleLowerCase(),where2:this.formatMessage("hover").toLocaleLowerCase()}):w?m=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()}):y&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("selected").toLocaleLowerCase()}))):c===v.Hover?(T(),I&&R(),f&&y?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("default").toLocaleLowerCase(),where2:this.formatMessage("selected").toLocaleLowerCase()}):f?m=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()}):y&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("selected").toLocaleLowerCase()}))):(T(),x&&C(),f&&w?m=this.formatMessage("linkedToAnd",{where1:this.formatMessage("default").toLocaleLowerCase(),where2:this.formatMessage("hover").toLocaleLowerCase()}):f?m=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()}):w&&(m=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()}))),i?g.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):m=this.formatMessage("isolate"),{items:(0,t.Immutable)(g),title:m}},this._renderAction=()=>{const e=[],{theme:i,layoutType:o,keepAspectRatio:s}=this.props,n=t.css`
      box-shadow: none;

      &:after {
        position: absolute;
        content: '';
        width: ${12}px;
        height: ${12}px;
        background-color: ${i.sys.color.primary.main};
        border: 2px solid ${i.ref.palette.white};
        border-radius: 50%;
        z-index: ${20};
      }
    `,r=t.css`
      box-shadow: none;
      height: ${oe}px;
      left: 0px;
      right: 0px;
      bottom: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        bottom: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background-color: ${i.sys.color.primary.light};
        z-index: ${20};
      }
    `,l=t.css`
      box-shadow: none;
      width: ${oe}px;
      top: 0px;
      bottom: 0px;
      right: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        right: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: ${i.sys.color.primary.light};
        z-index: ${20};
      }
    `,a=t.css`
      position: absolute;
    `,d=t.css`
      width: ${oe}px;
      top: ${10}px;
      bottom: ${10}px;
      right: ${-8}px;

      &:after {
        top: 50%;
        right: 50%;
        margin-top: ${-5}px;
        margin-right: ${-5}px;
      }
    `,c=t.css`
      height: ${oe}px;
      left: ${10}px;
      right: ${10}px;
      bottom: ${-8}px;

      &:after {
        left: 50%;
        bottom: 50%;
        margin-left: ${-5}px;
        margin-bottom: ${-5}px;
      }
    `;switch(o){case h.Column:e.push((0,t.jsx)("span",{key:"10",className:"list-card-rnd-resize-left-line",css:[a,l]})),e.push((0,t.jsx)("span",{key:"4",className:"list-card-rnd-resize-right",css:[a,n,d]}));break;case h.Row:e.push((0,t.jsx)("span",{key:"9",className:"list-card-rnd-resize-bottom-line",css:[a,r]})),e.push((0,t.jsx)("span",{key:"6",className:"list-card-rnd-resize-bottom",css:[a,n,c]}));break;case h.GRID:e.push((0,t.jsx)("span",{key:"10",className:"list-card-rnd-resize-left-line",css:[a,l]})),e.push((0,t.jsx)("span",{key:"4",className:"list-card-rnd-resize-right",css:[a,n,d]})),s||(e.push((0,t.jsx)("span",{key:"9",className:"list-card-rnd-resize-bottom-line",css:[a,r]})),e.push((0,t.jsx)("span",{key:"6",className:"list-card-rnd-resize-bottom",css:[a,n,c]})))}return e},this.getCardToolsStyle=e=>t.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{const{index:e}=this.props;if(!window.jimuConfig.isInBuilder||e>0)return;const{cardConfigs:i,appMode:o,builderSupportModules:s,datasourceId:n,selectionIsInList:l,selectionIsList:a,hideCardTool:d}=this.props;let c=!0;const{BuilderPopper:u,GLOBAL_RESIZING_CLASS_NAME:h,GLOBAL_H5_DRAGGING_CLASS_NAME:p,GLOBAL_DRAGGING_CLASS_NAME:g}=s.widgetModules;return(l||a)&&o!==t.AppMode.Run&&!d&&n||(c=!1),c&&this.props.isEditing&&(i[v.Hover].enable||i[v.Selected].selectionMode!==r.None)&&(0,t.jsx)(u,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:t.css`
            .${g} &,
            .${h} &,
            .${p} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.resizeRef.current,offset:se,modifiers:ne,open:c},this.getCardMenuElement())},this.getCardMenuElement=()=>{var i;const{index:o}=this.props;if(!window.jimuConfig.isInBuilder||o>0)return;const{cardConfigs:s,selection:n,widgetId:l,builderSupportModules:a,browserSizeMode:d,builderStatus:c,selectionIsList:u}=this.props,h=a.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:p,BuilderDropDown:g,BuilderButton:m,withBuilderTheme:f}=a.widgetModules,S=u,y=!S&&n&&p&&p.getRelatedLayoutItemsInWidgetByLayoutInfo(h,n,l,d).length>1,{items:w,title:b}=this.getCopyDropdownItems(y),x=w&&w.length>0,I=(null===(i=s[c])||void 0===i?void 0:i.listLayout)||e.CUSTOM,C=!S&&(x||y)&&I===e.CUSTOM,R=f((e=>(0,t.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e)},(0,t.jsx)(m,{active:c===v.Default,onClick:e=>{this.handleBuilderStatusChange(e,v.Default)}},this.formatMessage("default")),s[v.Hover].enable&&(0,t.jsx)(m,{active:c===v.Hover,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,v.Hover)}},this.formatMessage("hover")),s[v.Selected].selectionMode!==r.None&&(0,t.jsx)(m,{active:c===v.Selected,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,v.Selected)}},this.formatMessage("selected")),C&&(0,t.jsx)(g,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:b,toggleType:"default",direction:"left",toggleArrow:!1,toggleContent:e=>y?(0,t.jsx)(P,{size:16}):(0,t.jsx)(A,{size:16}),modifiers:re,items:w}))));return(0,t.jsx)(R,null)},this.isItemAccept=(e,t)=>{const{isEditing:i,builderSupportModules:o,widgetId:s}=this.props;return ie(e,0,i,s,o)},this.getEditorStyle=()=>t.css`
      &.list-card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.state={didMount:!1},this.resizeRef=t.React.createRef(),this.providerData=this.getNewProviderData()}shouldComponentUpdate(e,i){let o=this.shouldComponentUpdateExcept(e,i,["listStyle","selection"]);if(o=o||!t.utils.isDeepEqual(this.props.listStyle,e.listStyle),!o){const{selectionIsInList:i,selectionIsList:s}=this.props;(s||i)&&(o=!t.utils.isDeepEqual(this.props.selection,e.selection))}return o}componentDidUpdate(e){const{selectionIsInList:t,isEditing:i,layoutType:o,isRTL:s,lockItemRatio:n,keepAspectRatio:r,index:l}=this.props;window.jimuConfig.isInBuilder&&0===l&&this.interactable&&(i&&!t?o===h.GRID?(this.interactable.resizable({edges:{top:!1,left:s,bottom:!r,right:!s}}),this.interactable.resizable(!0)):n?this.interactable.resizable(!1):(this.interactable.resizable({edges:{top:!1,left:o===h.Column&&s,bottom:o===h.Row,right:o===h.Column&&!s}}),this.interactable.resizable(!0)):this.interactable.resizable(!1))}componentDidMount(){const{index:e,layoutType:t,updateCardToolPosition:i,keepAspectRatio:s}=this.props;if(0===e&&window.jimuConfig.isInBuilder&&this.resizeRef.current){const{interact:e,handleResizeCard:n,isRTL:r,lockItemRatio:l}=this.props;this.interactable=e(this.resizeRef.current).resizable({edges:{top:!1,left:(t===h.Column||t===h.GRID)&&r,bottom:t===h.Row&&!l||t===h.GRID&&!s,right:(t===h.Column&&!l||t===h.GRID)&&!r},modifiers:[e.modifiers.restrictEdges({endOnly:!0}),e.modifiers.restrictSize({min:{width:o,height:o}})],inertia:!1,onstart:e=>{const{changeIsResizingCard:t}=this.props;t&&t(!0),e.stopPropagation()},onmove:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall);const t=e.rect,o=this.getNewCardSize(t,!0);i(),this.lastResizeCall=requestAnimationFrame((()=>{const e={};n(o,!1,e.top,e.left)}))},onend:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.lastResizeCall=requestAnimationFrame((()=>{const t=e.rect,i=this.getNewCardSize(t);n(i,!0);const{changeIsResizingCard:o}=this.props;o&&o(!1)}))}})}this.setState({didMount:!0})}componentWillUnMount(){this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.interactable&&(this.interactable.unset(),this.interactable=null)}handleBuilderStatusChange(e,t){this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t);const{selectCard:i}=this.props;i(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var o;const{selectable:s,active:n,cardConfigs:r,LayoutEntry:l,selectionIsInList:a,isEditing:d,widgetId:c,listStyle:u,lockItemRatio:p,builderStatus:g,layouts:m,layoutType:f}=this.props,{didMount:S}=this.state,y=m[g],w=(null===(o=r[g])||void 0===o?void 0:o.listLayout)||e.CUSTOM,b=m[v.Default],x=w===e.AUTO?b:y,I=te(r[g].backgroundStyle),C=w===e.AUTO&&g!==v.Default,R=Object.assign({},i.styleUtils.toCSSStyle(I||{})),T=Object.assign({},i.styleUtils.toCSSStyle({borderRadius:(null==I?void 0:I.borderRadius)||0}||{})),M=this.getNewProviderData();this.isProviderEqual(M,this.providerData)||(this.providerData=M);const O=f!==h.GRID&&p;return(0,t.jsx)(t.RepeatedDataSourceProvider,{data:this.providerData},(0,t.jsx)(i.ListGroupItem,{active:s&&n,css:this.getStyle(g),style:Object.assign(Object.assign({},T),u),className:(0,t.classNames)("surface-1",`list-card-${c}`),onClick:this.handleItemClick,role:"listCardEditor"},C&&(0,t.jsx)("div",{className:"card-editor-mask position-absolute"}),S&&this.renderCardTools(),(0,t.jsx)("div",{className:"list-card-content d-flex",style:R,css:this.getEditorStyle(),ref:this.resizeRef},(0,t.jsx)(l,{isItemAccepted:this.isItemAccept,isRepeat:!0,layouts:x,isInWidget:!0}),d&&!a&&!O&&this._renderAction())))}});class ae extends O{constructor(e){super(e),this.handleItemClick=e=>{const{onChange:t,active:i}=this.props,{providerData:o}=this;if(i){this.checkIsClickItemButtonOrA(e)||"linkClick"===e.exbEventType||t(o&&o.record)}else t(o&&o.record);"linkClick"===e.exbEventType&&delete e.exbEventType},this.checkIsClickItemButtonOrA=e=>{const t=e.target;if(!t)return!1;const i=e.target&&e.target.tagName||"",o=t.closest("button")||t.closest("a");return"a"===i.toLowerCase()||"button"===i.toLowerCase()||o},this.handleItemKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||this.handleItemClick(e)},this.handleLinkClick=e=>{e.stopPropagation()},this.isItemAccept=(e,i)=>{const{isEditing:o,builderSupportModules:s,widgetId:n,appMode:r}=this.props;return ie(e,0,r===t.AppMode.Express?window.jimuConfig.isInBuilder:o,n,s)},this.onClickCapture=e=>{clearTimeout(this.clickCaptureTimeoutRef),this.clickCaptureTimeoutRef=setTimeout((()=>{this.handleItemClick(e)}))},this.providerData=this.getNewProviderData(),this.layoutRef=t.React.createRef(),this.linkRef=t.React.createRef()}shouldComponentUpdate(e,i){let o=this.shouldComponentUpdateExcept(e,i,["listStyle"]);return o=o||!t.utils.isDeepEqual(this.props.listStyle,e.listStyle),o}render(){var o;const{selectable:s,active:n,cardConfigs:r,widgetId:l,listStyle:a,layouts:d,hoverLayoutOpen:c,appMode:u,isHover:h,itemIdex:p,LayoutEntry:g,handleListMouseLeave:m,handleListMouseMove:f}=this.props;let y=v.Default;const w=window.jimuConfig.isInBuilder,b=w&&u===t.AppMode.Express;let x,I;w&&u===t.AppMode.Design?(I=te(r[v.Default].backgroundStyle),x=d[v.Default]):(x=d[v.Default],I=te(r[v.Default].backgroundStyle),c&&h&&(y=v.Hover,x=null==d?void 0:d[v.Hover],I=te(r[v.Hover].backgroundStyle)),s&&n&&(y=v.Selected,x=null==d?void 0:d[v.Selected],I=te(r[v.Selected].backgroundStyle)));const C=(null===(o=r[y])||void 0===o?void 0:o.listLayout)||e.CUSTOM,R=d[v.Default],T=C===e.AUTO?R:x,M=Object.assign({},i.styleUtils.toCSSStyle(I||{})),O=Object.assign({},i.styleUtils.toCSSStyle({borderRadius:(null==I?void 0:I.borderRadius)||0}||{})),L=this.getNewProviderData();return this.isProviderEqual(L,this.providerData)||(this.providerData=L),(0,t.jsx)(t.RepeatedDataSourceProvider,{data:this.providerData},(0,t.jsx)(i.ListGroupItem,{active:s&&n,css:this.getStyle(y),style:Object.assign(Object.assign({},a),O),tabIndex:0,onClickCapture:this.onClickCapture,className:(0,t.classNames)("surface-1 jimu-outline-inside",`list-card-${l}`),role:"option",onKeyDown:this.handleItemKeyDown,"aria-describedby":"describeByMessage","aria-selected":s&&n},(0,t.jsx)("div",{className:"list-card-content d-flex",onMouseLeave:m,onMouseMove:()=>{f(p)},style:M},(0,t.jsx)("div",{className:"position-relative h-100 w-100"},(0,t.jsx)("div",{className:"d-flex w-100 h-100 list-item-con",ref:this.layoutRef},b&&(0,t.jsx)(g,{isItemAccepted:this.isItemAccept,isRepeat:!0,layouts:T,isInWidget:!0}),!b&&(0,t.jsx)(S.LayoutEntry,{layouts:T}))))))}}const de={_widgetLabel:"List",_widgetDescription:"A widget to display data in a list view.",_action_filter_label:"Filter",_layout_REGULAR_label:"Regular",_layout_DEFAULT_label:"Default",_layout_HOVER_label:"Hover",_layout_SELECTED_label:"Selected",applyTo:"Apply to {status}",listLoading:"Loading",pleaseSelect:"Please select",listNoData:"No data",selectSortFields:"Select sorting fields",clearFilter:"Clear filter",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a list template.",showSelected:"Show selected",clearSelected:"Clear selected",listSorting:"Sorting",listSort:"Sort",guideStep2Title:"Template",guideStep2Content:"Click on a template and click start.",guideStep3Title:"Data",guideStep3Content:"Click on select data to add a data source.",guideStep4Title:"Add new data",guideStep4Content:"Click add new data to select a web map.",guideStep5Title:"Select data",guideStep5Content:"Click the feature layer in the select data panel and close the panel.",guideStep6Title:"Data",guideStep6Content:"Specifies the data source, allows you to filter the data and limit the number of features that appear in the list.",guideStep7Title:"Arrangement",guideStep7Content:"Click the expand icon to explore the Arrangement section. In here, it allows you to define the direction, height, spacing, and paging style for your list.",guideStep8Title:"States",guideStep8Content:"Click the expand icon to explore the available States. In this section, it provides a visual representation to communicate the state of the list items. There are three states: regular, selected, and hover. By default, the selected state is always on.",guideStep9Title:"Tools",guideStep9Content:"Click the expand icon to explore the available Tools. In here, you can include search, sort, filter, and show selected tools in your list.",guideStep10Title:"Select image",guideStep10Content:"Click the image widget to configure it in the content panel.",guideStep10Title2:"Image settings",guideStep10Content2:"Allows you to select the image source and other settings for your widget.",guideStep11Title:"Select text",guideStep11Content:"Click the text widget to add attributes in the widget toolbar.",guideStep11Title2:"Text settings",guideStep11Content2:"Provides the configurations and style, including adding dynamic content from the widget toolbar. ",guideStep12Title:"End of tour",guideStep12Content:"Add other widgets to enhance your experience.",clearSearch:"Clear search",minimize:"Minimize",topToolBack:"Back",showAllListRecords:"Show all records",listDataActionLabel:"{layer} list selection",searchResult:"Search result",describeMessage:"List item"};var ce=a(62838),ue=a.n(ce),he=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const pe=e=>{const i=window.SVG,{className:o}=e,s=he(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:ue()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var ge=a(50170),me=a.n(ge),fe=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const ve=e=>{const i=window.SVG,{className:o}=e,s=fe(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:me()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var Se=a(96300),ye=a.n(Se),we=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const be=e=>{const i=window.SVG,{className:o}=e,s=we(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:ye()},s)):t.React.createElement("svg",Object.assign({className:n},s))},xe=new(0,t.esri.Sanitizer);class Ie extends t.React.PureComponent{constructor(e){super(e),this.handleChange=e=>{this.setState({searchText:e,isShowSuggestion:(null==e?void 0:e.length)>2},(()=>{const{onSearchTextChange:t}=this.props;t&&t(e)}))},this.handleSubmit=(e,t=!1)=>{const{onSubmit:i}=this.props;i&&i(e,t)},this.onKeyUp=e=>{if(!e||!e.target)return;const{isShowSuggestion:t}=this.state;if("Enter"===e.key&&(this.setState({isShowSuggestion:!1}),this.handleSubmit(e.target.value,!0)),t){const t=this.getMenuItems()||[],i=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?setTimeout((()=>{var e;null===(e=t[i])||void 0===e||e.focus()})):"ArrowDown"===e.key&&setTimeout((()=>{var e,i;null===(e=this.containerRef)||void 0===e||e.focus(),null===(i=t[0])||void 0===i||i.focus()}))}},this.onSuggestionConfirm=e=>{this.setState({searchText:e,isShowSuggestion:!1},(()=>{var t;this.handleSubmit(e),null===(t=this.props)||void 0===t||t.toggleSearchBoxVisible(!0)}))},this.handleClear=e=>{this.setState({searchText:""}),e.stopPropagation()},this.getStyle=()=>{var e,i,o,s,n,r;const{theme:l}=this.props;return t.css`
      position: relative;
      .search-input {
        margin-bottom: -1px;
        padding-left: 3px;
        border: 0;
        // border-bottom-width: 1px;
        // border-bottom-style: solid;
        // border-color: ${l.sys.color.primary.main};
        background: transparent;
        height: ${t.polished.rem(26)};
        min-width: 0;
        .input-wrapper {
          background: transparent;
          border: none;
          padding: 0;
          height: 100%;
        }
      }
      .search-input:focus {
        background: transparent;
      }
      .search-loading-con {
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        width: ${t.polished.rem(13)};
        height: ${t.polished.rem(13)};
        min-width: ${t.polished.rem(13)};
        border: 2px solid ${null===(i=null===(e=null==l?void 0:l.sys.color)||void 0===e?void 0:e.secondary)||void 0===i?void 0:i.light};
        border-radius: 50%;
        border-top: 2px solid ${null===(s=null===(o=null==l?void 0:l.sys.color)||void 0===o?void 0:o.primary)||void 0===s?void 0:s.main};
        box-sizing: border-box;
        animation:loading 2s infinite linear;
        margin-right: ${t.polished.rem(4)};
      }
      .clear-search, .search-back {
        cursor: pointer;
        padding: ${t.polished.rem(6)};
        background: none;
        border: none;
        color: ${null===(r=null===(n=null==l?void 0:l.ref.palette)||void 0===n?void 0:n.neutral)||void 0===r?void 0:r[1100]}
      }
      .search-back {
        margin-left: ${t.polished.rem(-6)};
      }
      .clear-search:hover {
        background: none;
      }
    `},this.getSuggestionListStyle=()=>{const{suggestionWidth:e}=this.props;return t.css`
      & {
        max-height: ${t.polished.rem(300)};
        min-width: ${t.polished.rem(e)};
        overflow: auto;
      }
      button {
        display: block;
        width: 100%;
        text-align: left;
        border: none;
        border-radius: 0;
      }
      .suggestion-item:focus {
        background: var(--sys-color-primary-main);
        color: var(--ref-palette-white);
      }
      button:hover {
        border: none;
      }
    `},this.clearSearchText=()=>{const{searchText:e}=this.state;e&&(this.handleChange(""),this.setState({isShowSuggestion:!1}))},this.getMenuItems=()=>this.containerRef?Array.prototype.slice.call(this.containerRef.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],this.getTextInputSuffixElement=()=>{const{theme:e,showLoading:o,formatMessage:s}=this.props,{searchText:n}=this.state;return(0,t.jsx)("div",{className:"d-flex align-items-center"},o&&(0,t.jsx)("div",{className:"search-loading-con"}),n&&(0,t.jsx)(i.Button,{className:"clear-search",icon:!0,size:"sm",onClick:this.clearSearchText,title:s("clearSearch")},(0,t.jsx)(pe,{size:14,color:e.ref.palette.neutral[1100]})))},this.getTextInputPrefixElement=()=>{const{theme:e,formatMessage:o}=this.props;return(0,t.jsx)(i.Button,{type:"tertiary",icon:!0,size:"sm",title:o("SearchLabel"),onClick:e=>{this.handleSubmit(this.state.searchText)}},(0,t.jsx)(ve,{size:16,color:e.ref.palette.neutral[700]}))},this.handlePopperKeyDown=e=>{const{isShowSuggestion:t}=this.state;if(!t)return;const i="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),t&&i))if("Escape"===e.key)this.handleEscEvent(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=this.getMenuItems();let i=t.indexOf(e.target),o=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(i=0!==i?i-1:t.length-1,o=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(o=!1,i=i===t.length-1?0:i+1);const s=0===i&&!o,n=i===t.length-1&&o;clearTimeout(this.focusTimeout),this.focusTimeout=s||n?setTimeout((()=>{var e;null===(e=this.searchInputRef)||void 0===e||e.focus()})):setTimeout((()=>{var e;null===(e=this.containerRef)||void 0===e||e.focus(),t[i].focus()}))}else if("End"===e.key){const e=this.getMenuItems();e[e.length-1].focus()}else if("Home"===e.key){this.getMenuItems()[0].focus()}else if(e.which>=48&&e.which<=90){const t=this.getMenuItems(),i=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===i){t[e].focus();break}}}},this.handleEscEvent=e=>{var t;const{isShowSuggestion:i}=this.state;e.preventDefault(),this.setState({isShowSuggestion:!i}),null===(t=this.searchInputRef)||void 0===t||t.focus()},this.setInputRef=e=>{const{inputRef:t}=this.props;this.searchInputRef=e,t&&t(e)},this.state={searchText:e.searchText||"",isShowSuggestion:!1}}componentDidUpdate(e){var i;if(this.props.searchText!==e.searchText&&this.props.searchText!==this.state.searchText){const{searchText:e}=this.props;this.setState({searchText:e})}(null===(i=this.props)||void 0===i?void 0:i.appMode)===t.AppMode.Design&&this.state.isShowSuggestion&&this.setState({isShowSuggestion:!1,searchText:""})}render(){const{placeholder:e,className:o,showClear:s,hideSearchIcon:n,onFocus:r,onBlur:l,theme:a,searchSuggestion:d,formatMessage:c,isShowBackButton:u}=this.props,{searchText:h,isShowSuggestion:p}=this.state;return(0,t.jsx)("div",{ref:e=>{this.reference=e}},(0,t.jsx)("div",{css:this.getStyle(),className:`d-flex align-items-center ${o}`},u&&(0,t.jsx)(i.Button,{className:"search-back",icon:!0,size:"sm",onClick:e=>{var t;null===(t=this.props)||void 0===t||t.toggleSearchBoxVisible(!1)},title:c("topToolBack")},(0,t.jsx)(be,{size:20,color:a.ref.palette.neutral[1100]})),(0,t.jsx)(i.TextInput,{className:"search-input flex-grow-1",ref:e=>{this.setInputRef(e)},placeholder:e,onChange:e=>{this.handleChange(e.target.value)},onBlur:l,onFocus:r,title:h||e,value:h||"",onKeyDown:e=>{this.onKeyUp(e)},prefix:!n&&!u&&this.getTextInputPrefixElement(),suffix:this.getTextInputSuffixElement()}),s&&(0,t.jsx)(i.Button,{id:"test-focus",icon:!0,size:"sm",onClick:this.handleSubmit},(0,t.jsx)(pe,{size:12,color:a.ref.palette.neutral[1100]}))),(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:this.getSuggestionListStyle(),placement:"bottom-start",reference:this.reference,offset:[0,8],open:p,autoFocus:!1,toggle:e=>{this.setState({isShowSuggestion:!p})}},(0,t.jsx)("div",{ref:e=>{this.containerRef=e},onKeyDown:this.handlePopperKeyDown},d.map(((e,o)=>{const s=xe.sanitize(e.suggestionHtml);return(0,t.jsx)(i.Button,{key:o,type:"secondary",size:"sm",role:"button",title:null==e?void 0:e.suggestion,className:"suggestion-item",onClick:()=>{this.onSuggestionConfirm(e.suggestion)}},(0,t.jsx)("div",{className:"w-100",dangerouslySetInnerHTML:{__html:s}}))}))))))}}function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)({}).hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},Ce.apply(null,arguments)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Te(e,t){return Te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Te(e,t)}function Me(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Te(e,t)}var Oe=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Le(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(o=e[i],s=t[i],!(o===s||Oe(o)&&Oe(s)))return!1;var o,s;return!0}const je=function(e,t){var i;void 0===t&&(t=Le);var o,s=[],n=!1;return function(){for(var r=[],l=0;l<arguments.length;l++)r[l]=arguments[l];return n&&i===this&&t(r,s)||(o=e.apply(this,r),n=!0,i=this,s=r),o}};var ze=a(68972),Pe="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function ke(e){cancelAnimationFrame(e.id)}function De(e,t){var i=Pe();var o={id:requestAnimationFrame((function s(){Pe()-i>=t?e.call(null):o.id=requestAnimationFrame(s)}))};return o}var Ne=-1;function Ae(e){if(void 0===e&&(e=!1),-1===Ne||e){var t=document.createElement("div"),i=t.style;i.width="50px",i.height="50px",i.overflow="scroll",document.body.appendChild(t),Ne=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Ne}var Ee=null;function Be(e){if(void 0===e&&(e=!1),null===Ee||e){var t=document.createElement("div"),i=t.style;i.width="50px",i.height="50px",i.overflow="scroll",i.direction="rtl";var o=document.createElement("div"),s=o.style;return s.width="100px",s.height="100px",t.appendChild(o),document.body.appendChild(t),t.scrollLeft>0?Ee="positive-descending":(t.scrollLeft=1,Ee=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),Ee}return Ee}var $e=function(e){var t=e.columnIndex;e.data;return e.rowIndex+":"+t};function _e(e){var t,i=e.getColumnOffset,o=e.getColumnStartIndexForOffset,s=e.getColumnStopIndexForStartIndex,n=e.getColumnWidth,r=e.getEstimatedTotalHeight,l=e.getEstimatedTotalWidth,a=e.getOffsetForColumnAndAlignment,d=e.getOffsetForRowAndAlignment,c=e.getRowHeight,u=e.getRowOffset,h=e.getRowStartIndexForOffset,p=e.getRowStopIndexForStartIndex,g=e.initInstanceProps,m=e.shouldResetStyleCacheOnItemSizeChange,f=e.validateProps;return(t=function(e){function t(t){var o;return(o=e.call(this,t)||this)._instanceProps=g(o.props,Re(o)),o._resetIsScrollingTimeoutId=null,o._outerRef=void 0,o.state={instance:Re(o),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:"number"==typeof o.props.initialScrollLeft?o.props.initialScrollLeft:0,scrollTop:"number"==typeof o.props.initialScrollTop?o.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},o._callOnItemsRendered=void 0,o._callOnItemsRendered=je((function(e,t,i,s,n,r,l,a){return o.props.onItemsRendered({overscanColumnStartIndex:e,overscanColumnStopIndex:t,overscanRowStartIndex:i,overscanRowStopIndex:s,visibleColumnStartIndex:n,visibleColumnStopIndex:r,visibleRowStartIndex:l,visibleRowStopIndex:a})})),o._callOnScroll=void 0,o._callOnScroll=je((function(e,t,i,s,n){return o.props.onScroll({horizontalScrollDirection:i,scrollLeft:e,scrollTop:t,verticalScrollDirection:s,scrollUpdateWasRequested:n})})),o._getItemStyle=void 0,o._getItemStyle=function(e,t){var s,r=o.props,l=r.columnWidth,a=r.direction,d=r.rowHeight,h=o._getItemStyleCache(m&&l,m&&a,m&&d),p=e+":"+t;if(h.hasOwnProperty(p))s=h[p];else{var g=i(o.props,t,o._instanceProps),f="rtl"===a;h[p]=s={position:"absolute",left:f?void 0:g,right:f?g:void 0,top:u(o.props,e,o._instanceProps),height:c(o.props,e,o._instanceProps),width:n(o.props,t,o._instanceProps)}}return s},o._getItemStyleCache=void 0,o._getItemStyleCache=je((function(e,t,i){return{}})),o._onScroll=function(e){var t=e.currentTarget,i=t.clientHeight,s=t.clientWidth,n=t.scrollLeft,r=t.scrollTop,l=t.scrollHeight,a=t.scrollWidth;o.setState((function(e){if(e.scrollLeft===n&&e.scrollTop===r)return null;var t=o.props.direction,d=n;if("rtl"===t)switch(Be()){case"negative":d=-n;break;case"positive-descending":d=a-s-n}d=Math.max(0,Math.min(d,a-s));var c=Math.max(0,Math.min(r,l-i));return{isScrolling:!0,horizontalScrollDirection:e.scrollLeft<n?"forward":"backward",scrollLeft:d,scrollTop:c,verticalScrollDirection:e.scrollTop<r?"forward":"backward",scrollUpdateWasRequested:!1}}),o._resetIsScrollingDebounced)},o._outerRefSetter=function(e){var t=o.props.outerRef;o._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},o._resetIsScrollingDebounced=function(){null!==o._resetIsScrollingTimeoutId&&ke(o._resetIsScrollingTimeoutId),o._resetIsScrollingTimeoutId=De(o._resetIsScrolling,150)},o._resetIsScrolling=function(){o._resetIsScrollingTimeoutId=null,o.setState({isScrolling:!1},(function(){o._getItemStyleCache(-1)}))},o}Me(t,e),t.getDerivedStateFromProps=function(e,t){return Fe(e,t),f(e),null};var v=t.prototype;return v.scrollTo=function(e){var t=e.scrollLeft,i=e.scrollTop;void 0!==t&&(t=Math.max(0,t)),void 0!==i&&(i=Math.max(0,i)),this.setState((function(e){return void 0===t&&(t=e.scrollLeft),void 0===i&&(i=e.scrollTop),e.scrollLeft===t&&e.scrollTop===i?null:{horizontalScrollDirection:e.scrollLeft<t?"forward":"backward",scrollLeft:t,scrollTop:i,scrollUpdateWasRequested:!0,verticalScrollDirection:e.scrollTop<i?"forward":"backward"}}),this._resetIsScrollingDebounced)},v.scrollToItem=function(e){var t=e.align,i=void 0===t?"auto":t,o=e.columnIndex,s=e.rowIndex,n=this.props,c=n.columnCount,u=n.height,h=n.rowCount,p=n.width,g=this.state,m=g.scrollLeft,f=g.scrollTop,v=Ae();void 0!==o&&(o=Math.max(0,Math.min(o,c-1))),void 0!==s&&(s=Math.max(0,Math.min(s,h-1)));var S=r(this.props,this._instanceProps),y=l(this.props,this._instanceProps)>p?v:0,w=S>u?v:0;this.scrollTo({scrollLeft:void 0!==o?a(this.props,o,i,m,this._instanceProps,w):m,scrollTop:void 0!==s?d(this.props,s,i,f,this._instanceProps,y):f})},v.componentDidMount=function(){var e=this.props,t=e.initialScrollLeft,i=e.initialScrollTop;if(null!=this._outerRef){var o=this._outerRef;"number"==typeof t&&(o.scrollLeft=t),"number"==typeof i&&(o.scrollTop=i)}this._callPropsCallbacks()},v.componentDidUpdate=function(){var e=this.props.direction,t=this.state,i=t.scrollLeft,o=t.scrollTop;if(t.scrollUpdateWasRequested&&null!=this._outerRef){var s=this._outerRef;if("rtl"===e)switch(Be()){case"negative":s.scrollLeft=-i;break;case"positive-ascending":s.scrollLeft=i;break;default:var n=s.clientWidth,r=s.scrollWidth;s.scrollLeft=r-n-i}else s.scrollLeft=Math.max(0,i);s.scrollTop=Math.max(0,o)}this._callPropsCallbacks()},v.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&ke(this._resetIsScrollingTimeoutId)},v.render=function(){var e=this.props,t=e.children,i=e.className,o=e.columnCount,s=e.direction,n=e.height,a=e.innerRef,d=e.innerElementType,c=e.innerTagName,u=e.itemData,h=e.itemKey,p=void 0===h?$e:h,g=e.outerElementType,m=e.outerTagName,f=e.rowCount,v=e.style,S=e.useIsScrolling,y=e.width,w=this.state.isScrolling,b=this._getHorizontalRangeToRender(),x=b[0],I=b[1],C=this._getVerticalRangeToRender(),R=C[0],T=C[1],M=[];if(o>0&&f)for(var O=R;O<=T;O++)for(var L=x;L<=I;L++)M.push((0,ze.createElement)(t,{columnIndex:L,data:u,isScrolling:S?w:void 0,key:p({columnIndex:L,data:u,rowIndex:O}),rowIndex:O,style:this._getItemStyle(O,L)}));var j=r(this.props,this._instanceProps),z=l(this.props,this._instanceProps);return(0,ze.createElement)(g||m||"div",{className:i,onScroll:this._onScroll,ref:this._outerRefSetter,style:Ce({position:"relative",height:n,width:y,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:s},v)},(0,ze.createElement)(d||c||"div",{children:M,ref:a,style:{height:j,pointerEvents:w?"none":void 0,width:z}}))},v._callPropsCallbacks=function(){var e=this.props,t=e.columnCount,i=e.onItemsRendered,o=e.onScroll,s=e.rowCount;if("function"==typeof i&&t>0&&s>0){var n=this._getHorizontalRangeToRender(),r=n[0],l=n[1],a=n[2],d=n[3],c=this._getVerticalRangeToRender(),u=c[0],h=c[1],p=c[2],g=c[3];this._callOnItemsRendered(r,l,u,h,a,d,p,g)}if("function"==typeof o){var m=this.state,f=m.horizontalScrollDirection,v=m.scrollLeft,S=m.scrollTop,y=m.scrollUpdateWasRequested,w=m.verticalScrollDirection;this._callOnScroll(v,S,f,w,y)}},v._getHorizontalRangeToRender=function(){var e=this.props,t=e.columnCount,i=e.overscanColumnCount,n=e.overscanColumnsCount,r=e.overscanCount,l=e.rowCount,a=this.state,d=a.horizontalScrollDirection,c=a.isScrolling,u=a.scrollLeft,h=i||n||r||1;if(0===t||0===l)return[0,0,0,0];var p=o(this.props,u,this._instanceProps),g=s(this.props,p,u,this._instanceProps),m=c&&"backward"!==d?1:Math.max(1,h),f=c&&"forward"!==d?1:Math.max(1,h);return[Math.max(0,p-m),Math.max(0,Math.min(t-1,g+f)),p,g]},v._getVerticalRangeToRender=function(){var e=this.props,t=e.columnCount,i=e.overscanCount,o=e.overscanRowCount,s=e.overscanRowsCount,n=e.rowCount,r=this.state,l=r.isScrolling,a=r.verticalScrollDirection,d=r.scrollTop,c=o||s||i||1;if(0===t||0===n)return[0,0,0,0];var u=h(this.props,d,this._instanceProps),g=p(this.props,u,d,this._instanceProps),m=l&&"backward"!==a?1:Math.max(1,c),f=l&&"forward"!==a?1:Math.max(1,c);return[Math.max(0,u-m),Math.max(0,Math.min(n-1,g+f)),u,g]},t}(ze.PureComponent)).defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},t}var Fe=function(e,t){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,t.instance},He=function(e,t){var i=e.rowCount,o=t.rowMetadataMap,s=t.estimatedRowHeight,n=t.lastMeasuredRowIndex,r=0;if(n>=i&&(n=i-1),n>=0){var l=o[n];r=l.offset+l.size}return r+(i-n-1)*s},Ue=function(e,t){var i=e.columnCount,o=t.columnMetadataMap,s=t.estimatedColumnWidth,n=t.lastMeasuredColumnIndex,r=0;if(n>=i&&(n=i-1),n>=0){var l=o[n];r=l.offset+l.size}return r+(i-n-1)*s},We=function(e,t,i,o){var s,n,r;if("column"===e?(s=o.columnMetadataMap,n=t.columnWidth,r=o.lastMeasuredColumnIndex):(s=o.rowMetadataMap,n=t.rowHeight,r=o.lastMeasuredRowIndex),i>r){var l=0;if(r>=0){var a=s[r];l=a.offset+a.size}for(var d=r+1;d<=i;d++){var c=n(d);s[d]={offset:l,size:c},l+=c}"column"===e?o.lastMeasuredColumnIndex=i:o.lastMeasuredRowIndex=i}return s[i]},Ge=function(e,t,i,o){var s,n;return"column"===e?(s=i.columnMetadataMap,n=i.lastMeasuredColumnIndex):(s=i.rowMetadataMap,n=i.lastMeasuredRowIndex),(n>0?s[n].offset:0)>=o?Ve(e,t,i,n,0,o):qe(e,t,i,Math.max(0,n),o)},Ve=function(e,t,i,o,s,n){for(;s<=o;){var r=s+Math.floor((o-s)/2),l=We(e,t,r,i).offset;if(l===n)return r;l<n?s=r+1:l>n&&(o=r-1)}return s>0?s-1:0},qe=function(e,t,i,o,s){for(var n="column"===e?t.columnCount:t.rowCount,r=1;o<n&&We(e,t,o,i).offset<s;)o+=r,r*=2;return Ve(e,t,i,Math.min(o,n-1),Math.floor(o/2),s)},Qe=function(e,t,i,o,s,n,r){var l="column"===e?t.width:t.height,a=We(e,t,i,n),d="column"===e?Ue(t,n):He(t,n),c=Math.max(0,Math.min(d-l,a.offset)),u=Math.max(0,a.offset-l+r+a.size);switch("smart"===o&&(o=s>=u-l&&s<=c+l?"auto":"center"),o){case"start":return c;case"end":return u;case"center":return Math.round(u+(c-u)/2);default:return s>=u&&s<=c?s:u>c||s<u?u:c}},Ke=_e({getColumnOffset:function(e,t,i){return We("column",e,t,i).offset},getColumnStartIndexForOffset:function(e,t,i){return Ge("column",e,i,t)},getColumnStopIndexForStartIndex:function(e,t,i,o){for(var s=e.columnCount,n=e.width,r=We("column",e,t,o),l=i+n,a=r.offset+r.size,d=t;d<s-1&&a<l;)d++,a+=We("column",e,d,o).size;return d},getColumnWidth:function(e,t,i){return i.columnMetadataMap[t].size},getEstimatedTotalHeight:He,getEstimatedTotalWidth:Ue,getOffsetForColumnAndAlignment:function(e,t,i,o,s,n){return Qe("column",e,t,i,o,s,n)},getOffsetForRowAndAlignment:function(e,t,i,o,s,n){return Qe("row",e,t,i,o,s,n)},getRowOffset:function(e,t,i){return We("row",e,t,i).offset},getRowHeight:function(e,t,i){return i.rowMetadataMap[t].size},getRowStartIndexForOffset:function(e,t,i){return Ge("row",e,i,t)},getRowStopIndexForStartIndex:function(e,t,i,o){for(var s=e.rowCount,n=e.height,r=We("row",e,t,o),l=i+n,a=r.offset+r.size,d=t;d<s-1&&a<l;)d++,a+=We("row",e,d,o).size;return d},initInstanceProps:function(e,t){var i=e,o={columnMetadataMap:{},estimatedColumnWidth:i.estimatedColumnWidth||50,estimatedRowHeight:i.estimatedRowHeight||50,lastMeasuredColumnIndex:-1,lastMeasuredRowIndex:-1,rowMetadataMap:{}};return t.resetAfterColumnIndex=function(e,i){void 0===i&&(i=!0),t.resetAfterIndices({columnIndex:e,shouldForceUpdate:i})},t.resetAfterRowIndex=function(e,i){void 0===i&&(i=!0),t.resetAfterIndices({rowIndex:e,shouldForceUpdate:i})},t.resetAfterIndices=function(e){var i=e.columnIndex,s=e.rowIndex,n=e.shouldForceUpdate,r=void 0===n||n;"number"==typeof i&&(o.lastMeasuredColumnIndex=Math.min(o.lastMeasuredColumnIndex,i-1)),"number"==typeof s&&(o.lastMeasuredRowIndex=Math.min(o.lastMeasuredRowIndex,s-1)),t._getItemStyleCache(-1),r&&t.forceUpdate()},o},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.columnWidth,e.rowHeight}}),Ye=function(e,t){return e};function Je(e){var t,i=e.getItemOffset,o=e.getEstimatedTotalSize,s=e.getItemSize,n=e.getOffsetForIndexAndAlignment,r=e.getStartIndexForOffset,l=e.getStopIndexForStartIndex,a=e.initInstanceProps,d=e.shouldResetStyleCacheOnItemSizeChange,c=e.validateProps;return t=function(e){function t(t){var o;return(o=e.call(this,t)||this)._instanceProps=a(o.props,Re(o)),o._outerRef=void 0,o._resetIsScrollingTimeoutId=null,o.state={instance:Re(o),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof o.props.initialScrollOffset?o.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},o._callOnItemsRendered=void 0,o._callOnItemsRendered=je((function(e,t,i,s){return o.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:i,visibleStopIndex:s})})),o._callOnScroll=void 0,o._callOnScroll=je((function(e,t,i){return o.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:i})})),o._getItemStyle=void 0,o._getItemStyle=function(e){var t,n=o.props,r=n.direction,l=n.itemSize,a=n.layout,c=o._getItemStyleCache(d&&l,d&&a,d&&r);if(c.hasOwnProperty(e))t=c[e];else{var u=i(o.props,e,o._instanceProps),h=s(o.props,e,o._instanceProps),p="horizontal"===r||"horizontal"===a,g="rtl"===r,m=p?u:0;c[e]=t={position:"absolute",left:g?void 0:m,right:g?m:void 0,top:p?0:u,height:p?"100%":h,width:p?h:"100%"}}return t},o._getItemStyleCache=void 0,o._getItemStyleCache=je((function(e,t,i){return{}})),o._onScrollHorizontal=function(e){var t=e.currentTarget,i=t.clientWidth,s=t.scrollLeft,n=t.scrollWidth;o.setState((function(e){if(e.scrollOffset===s)return null;var t=o.props.direction,r=s;if("rtl"===t)switch(Be()){case"negative":r=-s;break;case"positive-descending":r=n-i-s}return r=Math.max(0,Math.min(r,n-i)),{isScrolling:!0,scrollDirection:e.scrollOffset<r?"forward":"backward",scrollOffset:r,scrollUpdateWasRequested:!1}}),o._resetIsScrollingDebounced)},o._onScrollVertical=function(e){var t=e.currentTarget,i=t.clientHeight,s=t.scrollHeight,n=t.scrollTop;o.setState((function(e){if(e.scrollOffset===n)return null;var t=Math.max(0,Math.min(n,s-i));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),o._resetIsScrollingDebounced)},o._outerRefSetter=function(e){var t=o.props.outerRef;o._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},o._resetIsScrollingDebounced=function(){null!==o._resetIsScrollingTimeoutId&&ke(o._resetIsScrollingTimeoutId),o._resetIsScrollingTimeoutId=De(o._resetIsScrolling,150)},o._resetIsScrolling=function(){o._resetIsScrollingTimeoutId=null,o.setState({isScrolling:!1},(function(){o._getItemStyleCache(-1,null)}))},o}Me(t,e),t.getDerivedStateFromProps=function(e,t){return Xe(e,t),c(e),null};var u=t.prototype;return u.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},u.scrollToItem=function(e,t){void 0===t&&(t="auto");var i=this.props,o=i.itemCount,s=i.layout,r=this.state.scrollOffset;e=Math.max(0,Math.min(e,o-1));var l=0;if(this._outerRef){var a=this._outerRef;l="vertical"===s?a.scrollWidth>a.clientWidth?Ae():0:a.scrollHeight>a.clientHeight?Ae():0}this.scrollTo(n(this.props,e,t,r,this._instanceProps,l))},u.componentDidMount=function(){var e=this.props,t=e.direction,i=e.initialScrollOffset,o=e.layout;if("number"==typeof i&&null!=this._outerRef){var s=this._outerRef;"horizontal"===t||"horizontal"===o?s.scrollLeft=i:s.scrollTop=i}this._callPropsCallbacks()},u.componentDidUpdate=function(){var e=this.props,t=e.direction,i=e.layout,o=this.state,s=o.scrollOffset;if(o.scrollUpdateWasRequested&&null!=this._outerRef){var n=this._outerRef;if("horizontal"===t||"horizontal"===i)if("rtl"===t)switch(Be()){case"negative":n.scrollLeft=-s;break;case"positive-ascending":n.scrollLeft=s;break;default:var r=n.clientWidth,l=n.scrollWidth;n.scrollLeft=l-r-s}else n.scrollLeft=s;else n.scrollTop=s}this._callPropsCallbacks()},u.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&ke(this._resetIsScrollingTimeoutId)},u.render=function(){var e=this.props,t=e.children,i=e.className,s=e.direction,n=e.height,r=e.innerRef,l=e.innerElementType,a=e.innerTagName,d=e.itemCount,c=e.itemData,u=e.itemKey,h=void 0===u?Ye:u,p=e.layout,g=e.outerElementType,m=e.outerTagName,f=e.style,v=e.useIsScrolling,S=e.width,y=this.state.isScrolling,w="horizontal"===s||"horizontal"===p,b=w?this._onScrollHorizontal:this._onScrollVertical,x=this._getRangeToRender(),I=x[0],C=x[1],R=[];if(d>0)for(var T=I;T<=C;T++)R.push((0,ze.createElement)(t,{data:c,key:h(T,c),index:T,isScrolling:v?y:void 0,style:this._getItemStyle(T)}));var M=o(this.props,this._instanceProps);return(0,ze.createElement)(g||m||"div",{className:i,onScroll:b,ref:this._outerRefSetter,style:Ce({position:"relative",height:n,width:S,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:s},f)},(0,ze.createElement)(l||a||"div",{children:R,ref:r,style:{height:w?"100%":M,pointerEvents:y?"none":void 0,width:w?M:"100%"}}))},u._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],i=e[1],o=e[2],s=e[3];this._callOnItemsRendered(t,i,o,s)}if("function"==typeof this.props.onScroll){var n=this.state,r=n.scrollDirection,l=n.scrollOffset,a=n.scrollUpdateWasRequested;this._callOnScroll(r,l,a)}},u._getRangeToRender=function(){var e=this.props,t=e.itemCount,i=e.overscanCount,o=this.state,s=o.isScrolling,n=o.scrollDirection,a=o.scrollOffset;if(0===t)return[0,0,0,0];var d=r(this.props,a,this._instanceProps),c=l(this.props,d,a,this._instanceProps),u=s&&"backward"!==n?1:Math.max(1,i),h=s&&"forward"!==n?1:Math.max(1,i);return[Math.max(0,d-u),Math.max(0,Math.min(t-1,c+h)),d,c]},t}(ze.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var Xe=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},Ze=function(e,t,i){var o=e.itemSize,s=i.itemMetadataMap,n=i.lastMeasuredIndex;if(t>n){var r=0;if(n>=0){var l=s[n];r=l.offset+l.size}for(var a=n+1;a<=t;a++){var d=o(a);s[a]={offset:r,size:d},r+=d}i.lastMeasuredIndex=t}return s[t]},et=function(e,t,i,o,s){for(;o<=i;){var n=o+Math.floor((i-o)/2),r=Ze(e,n,t).offset;if(r===s)return n;r<s?o=n+1:r>s&&(i=n-1)}return o>0?o-1:0},tt=function(e,t,i,o){for(var s=e.itemCount,n=1;i<s&&Ze(e,i,t).offset<o;)i+=n,n*=2;return et(e,t,Math.min(i,s-1),Math.floor(i/2),o)},it=function(e,t){var i=e.itemCount,o=t.itemMetadataMap,s=t.estimatedItemSize,n=t.lastMeasuredIndex,r=0;if(n>=i&&(n=i-1),n>=0){var l=o[n];r=l.offset+l.size}return r+(i-n-1)*s},ot=Je({getItemOffset:function(e,t,i){return Ze(e,t,i).offset},getItemSize:function(e,t,i){return i.itemMetadataMap[t].size},getEstimatedTotalSize:it,getOffsetForIndexAndAlignment:function(e,t,i,o,s,n){var r=e.direction,l=e.height,a=e.layout,d=e.width,c="horizontal"===r||"horizontal"===a?d:l,u=Ze(e,t,s),h=it(e,s),p=Math.max(0,Math.min(h-c,u.offset)),g=Math.max(0,u.offset-c+u.size+n);switch("smart"===i&&(i=o>=g-c&&o<=p+c?"auto":"center"),i){case"start":return p;case"end":return g;case"center":return Math.round(g+(p-g)/2);default:return o>=g&&o<=p?o:o<g?g:p}},getStartIndexForOffset:function(e,t,i){return function(e,t,i){var o=t.itemMetadataMap,s=t.lastMeasuredIndex;return(s>0?o[s].offset:0)>=i?et(e,t,s,0,i):tt(e,t,Math.max(0,s),i)}(e,i,t)},getStopIndexForStartIndex:function(e,t,i,o){for(var s=e.direction,n=e.height,r=e.itemCount,l=e.layout,a=e.width,d="horizontal"===s||"horizontal"===l?a:n,c=Ze(e,t,o),u=i+d,h=c.offset+c.size,p=t;p<r-1&&h<u;)p++,h+=Ze(e,p,o).size;return p},initInstanceProps:function(e,t){var i={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,o){void 0===o&&(o=!0),i.lastMeasuredIndex=Math.min(i.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),o&&t.forceUpdate()},i},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});var st=a(76219),nt=a.n(st),rt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const lt=e=>{const i=window.SVG,{className:o}=e,s=rt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:nt()},s)):t.React.createElement("svg",Object.assign({className:n},s))};class at extends t.React.PureComponent{constructor(e){super(e),this.onDropDownToggle=e=>{e.stopPropagation();const{isDropDownOpen:t,onDropDownOpenChange:i}=this.props;if(void 0!==t)i&&i(!t);else{const{isOpen:e}=this.state;this.setState({isOpen:!e})}},this.onItemClick=(e,t)=>{const{isDropDownOpen:i,onDropDownOpenChange:o}=this.props;void 0!==i?o&&o(!1):this.setState({isOpen:!1}),t.event(e,t),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDropDownMouseClick=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getStyle=()=>{var e,i,o,s;const{theme:n}=this.props;return t.css`
      & button {
        padding: 0;
      }
      .list-toggle-button {
        background: ${null===(i=null===(e=null==n?void 0:n.ref.palette)||void 0===e?void 0:e.neutral)||void 0===i?void 0:i[500]};
        border: none;
        &:hover, &[aria-expanded="true"] {
          background: ${null===(s=null===(o=null==n?void 0:n.ref.palette)||void 0===o?void 0:o.neutral)||void 0===s?void 0:s[700]};
        }
      }
    `},this.state={isOpen:!1};const{withBuilderTheme:o}=e;this.MyDropdown=o?o(i.Dropdown):i.Dropdown,this.MyDropdownButton=o?o(i.DropdownButton):i.DropdownButton,this.MyDropdownMenu=o?o(i.DropdownMenu):i.DropdownMenu,this.MyDropdownItem=o?o(i.DropdownItem):i.DropdownItem}render(){const{items:e,toggleContent:i,toggleType:o,toggleArrow:s,menuContent:n,appMode:r,modifiers:l,toggleIsIcon:a,theme:d,isDropDownOpen:c,size:u,appendToBody:h,toggleTitle:p,direction:g,menuCss:m,className:f,showActive:v,activeLabel:S,fluid:y}=this.props;let{isOpen:w}=this.state;w=void 0===c?w:c;const{MyDropdown:b,MyDropdownButton:x,MyDropdownMenu:I,MyDropdownItem:C}=this;return(0,t.jsx)(b,{size:u,toggle:this.onDropDownToggle,direction:g,fluid:y,isOpen:w&&r!==t.AppMode.Design,className:`my-dropdown ${f}`,css:this.getStyle()},i&&(0,t.jsx)(x,{icon:a,title:p,size:u,type:o,className:"list-toggle-button",arrow:s},i&&i(d)),(0,t.jsx)(I,{appendToBody:h,modifiers:l,css:m&&m(d),referenceHiddenVisibility:!0},n?n(d):e&&e.asMutable().map(((e,i)=>!e.hide&&(0,t.jsx)(C,{key:i,className:"no-user-select",title:e.label,active:v&&e.label===S,onClick:t=>{this.onItemClick(t,e)}},e.label)))))}}var dt=a(1888);const{useEffect:ct,useState:ut,useRef:ht}=t.React,{useSelector:pt}=t.ReactRedux,gt=t.css`
  .list-toggle-button:hover, .list-toggle-button {
    background: none !important;
  }
  .dropdown-btn-con {
    color: var(--ref-palette-black);
    padding-left: ${t.polished.rem(7)};
    padding-right: ${t.polished.rem(7)};
    svg {
      margin-right: ${t.polished.rem(4)} !important;
    }
  }
  .dropdown-btn-con:hover {
    color: var(--sys-color-primary-main);
  }
`,mt=e=>{const o=(0,dt.useTheme)(),s=pt((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),n=pt((e=>null==e?void 0:e.widgetsState)),r=ht(null),l=t.hooks.useTranslation(de,i.defaultMessages,t.defaultMessages),{handleSortOptionChange:a,dispatch:d,sorts:c,datasource:u,sortOptionName:h,id:p,showSortString:g}=e,[m,f]=ut(null);ct((()=>{y()}),[c]),ct((()=>{S()}),[]);const v=(e,t)=>{a(null==t?void 0:t.label),S()},S=()=>{var e,i;for(const o in n)if((null===(e=n[o])||void 0===e?void 0:e.listWidget)&&(null===(i=n[o])||void 0===i?void 0:i.dsId)===(null==u?void 0:u.id)){const e=p===o;d(t.appActions.widgetStatePropChange(o,"activeSort",e))}},y=()=>{const e=[];c&&c.forEach((t=>{t.rule&&t.rule.forEach((i=>{i&&i.jimuFieldName&&e.push({label:t.ruleOptionName,event:v})}))})),r.current=(0,t.Immutable)(e),f((0,t.Immutable)(e))},w=t.hooks.useEventCallback((e=>{var i,o;let s;return s=g?l("listSort"):h||(null===(o=null===(i=r.current)||void 0===i?void 0:i[0])||void 0===o?void 0:o.label),(0,t.jsx)("div",{className:"d-flex align-items-center dropdown-btn-con",title:s},(0,t.jsx)(lt,null),(0,t.jsx)("span",{className:"flex-grow-1 w-100 text-truncate"},s))}));return(0,t.jsx)("div",{className:"list-sort-con d-flex align-items-center flex-grow-1 text-truncate w-100",css:gt},(0,t.jsx)(at,{theme:o,items:m,appMode:s,toggleType:"tertiary",toggleArrow:!1,toggleContent:w,size:"sm",showActive:!0,activeLabel:w(),className:"w-100"}))};var ft=a(76117),vt=a(47569),St=a.n(vt),yt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const wt=e=>{const i=window.SVG,{className:o}=e,s=yt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:St()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var bt=a(29435),xt=a.n(bt),It=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const Ct=e=>{const i=window.SVG,{className:o}=e,s=It(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:xt()},s)):t.React.createElement("svg",Object.assign({className:n},s))},Rt=[0,5],Tt=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["bottom-start","right-end","top-start","left-start"]}}];class Mt extends t.React.PureComponent{constructor(e){super(e),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.onPopperToggle=e=>{const{filter:t}=this.props,{isOpen:i}=this.state;i||this.setState({currentFilter:t}),this.setState({isOpen:!i})},this.onItemClick=(e,t)=>{this.setState({isOpen:!1}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.handleFilterChange=e=>{this.setState({currentFilter:e})},this.handleApplyClick=e=>{const{currentFilter:t}=this.state,{handleFilterApplyChange:i,handleFilterChange:o}=this.props;o(t),i(!0),this.setState({isOpen:!1})},this.handleResetClick=e=>{const{handleFilterApplyChange:t,handleFilterChange:i}=this.props;t(!1),i(this.props.filterInConfig),this.setState({currentFilter:this.props.filterInConfig})},this.handleClearClick=e=>{const{handleFilterApplyChange:t}=this.props;t(!1),this.setState({isOpen:!1})},this.getStyle=()=>{const{theme:e}=this.props;return t.css`
      position: relative;
      .dot {
        position: absolute;
        width: 6px;
        height: 6px;
        right: -2px;
        top: 0px;
        .dot-bottom {
          width: 6px;
          height: 6px;
          background-color: transparent;
          .dot-top {
            width: 4px;
            height: 4px;
            background-color: ${e.ref.palette.neutral[1e3]};
          }
        }
      }
      :hover {
        .dot-top {
          background-color: ${e.sys.color.primary.main};
        }
      }
      & .active {
        .dot-top {
          background-color: ${e.ref.palette.white};
        }
        :hover {
          .dot-top {
            background-color: ${e.ref.palette.white};
          }
        }
      }
    `},this.getPopperStyle=()=>t.css`
      & .popper-box{
        max-height: ${document.documentElement.clientHeight}px;
        overflow: auto;
      }
      .filter-button-con  {
        & {
          text-align: right;
        }
        button {
          max-width: ${t.polished.rem(92)};
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }
        button svg {
          margin-right: 0 !important;
        }
        .reset-button {
          padding-left: ${t.polished.rem(5)};
          padding-right: ${t.polished.rem(5)};
        }
      }
      .clear-button, .reset-button {
        margin-left: ${t.polished.rem(8)};
      }
    `,this.toggleRef=t.React.createRef(),this.state={isOpen:!1,currentFilter:e.filter}}componentDidUpdate(e){const{filter:i,appMode:o}=this.props;i!==e.filter&&this.setState({currentFilter:i}),o!==e.appMode&&o===t.AppMode.Design&&this.setState({isOpen:!1})}render(){const{filter:e,selectedDs:o,widgetId:s,title:n,applied:r}=this.props,{isOpen:l,currentFilter:a}=this.state,d=r&&(null==e?void 0:e.sql)===(null==a?void 0:a.sql);return(0,t.jsx)(ze.Fragment,null,(0,t.jsx)(i.Button,{css:this.getStyle(),size:"sm",type:"tertiary",icon:!0,title:n,ref:this.toggleRef,onClick:this.onPopperToggle},(0,t.jsx)(wt,{size:16}),r&&(0,t.jsx)("div",{className:"dot align-items-center justify-content-center"},(0,t.jsx)("div",{className:"dot-bottom rounded-circle"},(0,t.jsx)("div",{className:"dot-top rounded-circle"})))),(0,t.jsx)(i.Popper,{placement:"bottom-start",reference:this.toggleRef.current,offset:Rt,toggle:this.onPopperToggle,css:this.getPopperStyle(),open:l,modifiers:Tt,referenceHiddenVisibility:!0},(0,t.jsx)("div",{style:{padding:t.polished.rem(20),width:t.polished.rem(250)}},(0,t.jsx)("div",null,(0,t.jsx)(ft.SqlExpressionRuntime,{widgetId:s,dataSource:o,expression:a,onChange:this.handleFilterChange})),(0,t.jsx)("div",{className:"w-100 mt-4 filter-button-con"},(0,t.jsx)(i.Button,{disabled:d,onClick:this.handleApplyClick,type:"primary",title:this.formatMessage("apply"),size:"sm"},this.formatMessage("apply")),(0,t.jsx)(i.Button,{disabled:!r,onClick:this.handleClearClick,title:this.formatMessage("commonModalCancel"),className:"clear-button",size:"sm"},this.formatMessage("commonModalCancel")),(0,t.jsx)(i.Button,{onClick:this.handleResetClick,title:this.formatMessage("resetFilters"),className:"reset-button",size:"sm"},(0,t.jsx)(Ct,{size:"s"}))))))}}var Ot=a(37568),Lt=a.n(Ot),jt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const zt=e=>{const i=window.SVG,{className:o}=e,s=jt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Lt()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var Pt=a(94064),kt=a.n(Pt),Dt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const Nt=e=>{const i=window.SVG,{className:o}=e,s=Dt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:kt()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var At=a(52943),Et=a.n(At),Bt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const $t=e=>{const i=window.SVG,{className:o}=e,s=Bt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Et()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var _t=a(30655),Ft=a.n(_t),Ht=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const Ut=e=>{const i=window.SVG,{className:o}=e,s=Ht(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Ft()},s)):t.React.createElement("svg",Object.assign({className:n},s))},{useState:Wt,useEffect:Gt}=t.React;function Vt(e){const{isRTL:o,totalPage:s,pageStyle:n,currentPage:r,scrollStatus:a,isScrollEnd:d,isEditing:c,showLoading:u,layoutType:p,hidePageTotal:g,isLastPage:m,handleScrollDown:f,handleScrollUp:v,handleSwitchPage:S,formatMessage:y}=e,[w,b]=Wt(!1);return Gt((()=>{b(g&&!m)}),[g,s,m]),t.React.createElement("div",{className:"bottom-tools w-100 d-flex align-items-center justify-content-center pl-2 pr-2"},n===l.MultiPage?t.React.createElement(i.Pagination,{size:"sm",totalPage:s,current:r,onChangePage:S,disabled:u,showEndEllipsis:w,isLastPage:m}):t.React.createElement("div",{className:"d-flex scroll-navigator"},t.React.createElement(i.Button,{title:y("previous"),disabled:"start"===a,type:"secondary",size:"sm",icon:!0,onClick:v},p===h.Column?t.React.createElement(zt,{size:12}):t.React.createElement(Nt,{size:12})),t.React.createElement(i.Button,{title:y("next"),disabled:"end"===a||d,type:"secondary",size:"sm",style:o?{marginRight:t.polished.rem(10)}:{marginLeft:t.polished.rem(10)},icon:!0,onClick:f},p===h.Column?t.React.createElement($t,null):t.React.createElement(Ut,null))),window.jimuConfig.isInBuilder&&c&&t.React.createElement("div",{className:"editing-mask-bottom-tool"}))}var qt=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{a(o.next(e))}catch(e){n(e)}}function l(e){try{a(o.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}a((o=o.apply(e,t||[])).next())}))};const Qt=function(e,i){return qt(this,void 0,void 0,(function*(){var e,o,s,n;let r;const l=null===(n=null===(s=null===(o=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appConfig)||void 0===o?void 0:o.widgets[i])||void 0===s?void 0:s.useDataSources)||void 0===n?void 0:n[0],a=t.DataSourceManager.getInstance();return l&&(r=a.createDataSourceByUseDataSource(Object.assign({},l,{mainDataSourceId:l.mainDataSourceId}),"localId")),yield Promise.resolve(r)}))};class Kt extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.1.0",description:"",upgrader:(e,t)=>qt(this,void 0,void 0,(function*(){const i=e.filter;return yield Qt(0,t).then((t=>{let o=e;const s=i?(0,ft.updateSQLExpressionByVersion)(i,"1.1.0",t):null;return o=o.set("filter",s),o}),(t=>e))}))},{version:"1.5.0",description:"1.5.0",upgrader:(e,t)=>qt(this,void 0,void 0,(function*(){e.filter;return yield Qt(0,t).then((t=>{if(!t)return e;let i=e;if("boolean"!=typeof(null==e?void 0:e.isShowAutoRefresh)){const e=!!(o=t)&&((null==o?void 0:o.getAutoRefreshInterval())||0)>0;i=i.set("isShowAutoRefresh",e)}var o;return i}),(t=>e))}))},{version:"1.8.0",description:"1.8.0",upgrader:(e,t)=>qt(this,void 0,void 0,(function*(){let t=e;if((null==e?void 0:e.direction)&&!(null==e?void 0:e.layoutType)){const i=(null==e?void 0:e.direction)===u.Horizon?h.Column:h.Row;t=t.set("layoutType",i).set("keepAspectRatio",!1)}return t}))},{version:"1.13.0",description:"1.13.0",upgrader:(e,t)=>qt(this,void 0,void 0,(function*(){let t=e;if((null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const i=e.searchFields.split(",")||[];t=t.set("searchFields",i)}return t}))},{version:"1.16.0",description:"1.16.0",upgrader:(e,t)=>qt(this,void 0,void 0,(function*(){let t=e;return(null==t?void 0:t.pageStyle)===l.MultiPage&&(t=t.set("hidePageTotal",!1)),t}))}]}}const Yt=new Kt;var Jt=a(7835),Xt=a.n(Jt),Zt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const ei=e=>{const i=window.SVG,{className:o}=e,s=Zt(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Xt()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var ti=a(27964),ii=a.n(ti),oi=a(20904),si=a.n(oi),ni=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const ri=e=>{const i=window.SVG,{className:o}=e,s=ni(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component has-rtl-svg",o);return i?t.React.createElement(i,Object.assign({className:n,src:ii(),srcRTL:si()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var li=a(4583),ai=a.n(li),di=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const ci=e=>{const i=window.SVG,{className:o}=e,s=di(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:ai()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var ui=a(28996),hi=a.n(ui),pi=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const gi=e=>{const i=window.SVG,{className:o}=e,s=pi(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:hi()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var mi=a(51879),fi=a.n(mi),vi=a(45508),Si=a.n(vi),yi=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const wi=e=>{const i=window.SVG,{className:o}=e,s=yi(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Si()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var bi=a(4651),xi=a.n(bi),Ii=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const Ci=e=>{const i=window.SVG,{className:o}=e,s=Ii(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:xi()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var Ri=a(21935),Ti=a.n(Ri),Mi=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const Oi=e=>{const i=window.SVG,{className:o}=e,s=Mi(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?t.React.createElement(i,Object.assign({className:n,src:Ti()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var Li=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const ji={fake:!0},zi=Object.assign({},de,i.defaultMessages,t.defaultMessages),{SELECTION_DATA_VIEW_ID:Pi}=t.CONSTANTS;class ki extends t.React.PureComponent{constructor(e){super(e),this.isFirstLoad=!0,this.isHasScrolled=!1,this.isHasRenderList=!1,this.isHasPublishMessageAction=!1,this.maxPageForHidePageTotal=1,this.isSetLayout=!1,this.resetTimeout=null,this.isHasInitCurrentCardSize=!1,this.needAutoScrollToSelectedItemWhenLoadPage=!1,this.autoScrollIndex=null,this.isScrollToNextStep=!1,this.canClickLink=!0,this.isScrollEnd=!1,this.loadMoreDataTimeout=null,this.queryOptions=null,this.hasGetListSizeByResizeDetector=!1,this.isCurrentPageLastPage=!1,this.updateWidgetRectTimeout=void 0,this.updatePageWhenPrePageSizeChange=e=>{var t,i;if(!(null===(t=this.props.config)||void 0===t?void 0:t.itemsPerPage))return!1;(null==e?void 0:e.itemsPerPage)!==(null===(i=this.props.config)||void 0===i?void 0:i.itemsPerPage)&&this.resetPage()},this.checkIsRecordsChange=(e,t)=>{var i;const o=(null==e?void 0:e.map((e=>null==e?void 0:e.getId())))||[],s=(null==t?void 0:t.map((e=>null==e?void 0:e.getId())))||[];return(null==o?void 0:o.length)!==s||(null===(i=null==o?void 0:o.filter((e=>!(null==s?void 0:s.includes(e)))))||void 0===i?void 0:i.length)>0},this.resetAfterIndices=()=>{var e,t,i,o;(null===(t=null===(e=this.listRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.resetAfterIndices)&&(null===(o=null===(i=this.listRef)||void 0===i?void 0:i.current)||void 0===o||o.resetAfterIndices({columnIndex:0,rowIndex:0,shouldForceUpdate:!1}))},this.setListLayoutInWidgetState=()=>{const{layoutId:e,layoutItemId:i,id:o,selectionIsSelf:s}=this.props;e&&o&&i&&!this.isSetLayout&&s&&(this.props.dispatch(t.appActions.widgetStatePropChange(o,"layoutInfo",{layoutId:e,layoutItemId:i})),this.isSetLayout=!0)},this.setListParentSizeInWidgetState=()=>{const{browserSizeMode:e,id:i,parentSize:o,layoutId:s}=this.props,n=(0,t.getAppStore)().getState().appConfig,r=t.utils.findViewportSize(n,e),l=`div.layout[data-layoutid=${s}]`,a=document.querySelector(l),d={width:(null==a?void 0:a.clientWidth)||r.width,height:(null==a?void 0:a.clientHeight)||r.height};o&&o.height===d.height&&o.width===d.width||this.props.dispatch(t.appActions.widgetStatePropChange(i,"parentSize",d))},this.getBodySize=()=>{this.bodySize={scrollWidth:document.documentElement.scrollWidth,scrollHeight:document.documentElement.scrollHeight,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight}},this.updateListInBuilder=(e,t)=>{var i;const{config:o}=this.props;if(!window.jimuConfig.isInBuilder)return!1;const s=B(this.props,null===(i=this.state)||void 0===i?void 0:i.widgetRect);let n=this.layoutPropertiesChange(e,t);this.updateScrollContentSize(e.config),this.pageTypeChange(e),this.useDatasourcesChange(e),n=this.listDivSizeChange(e,t,s,n),n&&this.updateCardToolPosition(),this.listSortChange(e),this.listFilterChange(e);o.cardConfigs[v.Selected].selectionMode!==e.config.cardConfigs[v.Selected].selectionMode&&this.selectRecords([])},this.layoutPropertiesChange=(e,t)=>{var i,o;const{config:s,top:n,left:r}=this.props;let l=!1;if(!window.jimuConfig.isInBuilder)return!1;let a=!1;const d=B(this.props,this.state.widgetRect),c=B(e,null==t?void 0:t.widgetRect);this.updateScrollContentSize(e.config);const u=n!==e.top||r!==e.left,p=(null==s?void 0:s.layoutType)!==e.config.layoutType,g=(m=c,f=d,!((v=s.layoutType)===h.Column?E(m.width,f.width):(v===h.Row||E(m.width,f.width))&&E(m.height,f.height)));var m,f,v;if(p||g||u)if(l=!0,g){const e={currentCardSize:d};a=!0,this.setState(e,(()=>{a&&this.refreshList()}))}else p&&this.handleResizeCard(this.state.currentCardSize,!0,!1,!1,!0);if(!a){((null==s?void 0:s.layoutType)===h.GRID?E(null==s?void 0:s.horizontalSpace,null===(i=e.config)||void 0===i?void 0:i.horizontalSpace)&&E(null==s?void 0:s.verticalSpace,null===(o=e.config)||void 0===o?void 0:o.verticalSpace):E(s.space,e.config.space))&&s.layoutType===e.config.layoutType||(a=!0,this.refreshList())}return l},this.listDivSizeChange=(e,t,i,s)=>{var n;const{config:r,isHeightAuto:l}=this.props,{listDivSize:a,createDataSourceFailed:d,datasource:c}=this.state;if(!this.isHasRenderList&&!d||c&&!(null==t?void 0:t.datasource))return s;const u=V(this.props,this.state),p=V(e,t),g=q(this.props),m=q(e);if(u!==p||g!==m)if(l)s=!0;else if(r.layoutType===h.Column){let e=(null===(n=this.state.widgetRect)||void 0===n?void 0:n.height)||(null==a?void 0:a.clientHeight);if(e-=W(this.paginatorDiv.current,u)+42*(g?1:0),e<o)return;const t={height:e,width:i.width};this.handleResizeCard(t,!0,!1,!1,!0)}return s},this.appModeChange=e=>{const{appMode:i,selectionIsSelf:o,selectionStatus:s,builderStatus:n}=this.props;e.appMode!==i&&(i!==t.AppMode.Design?this.editBuilderAndSettingStatus(v.Default):(s!==n&&(s?this.editBuilderAndSettingStatus(s):o||this.editBuilderAndSettingStatus(v.Default)),this.setState({showSelectionOnly:!1,searchText:void 0,filterApplied:!1,hoverIndex:-1},(()=>{this.scrollToIndex(0)}))))},this.pageTypeChange=e=>{const{pageStyle:t}=this.props.config;t!==e.config.pageStyle&&this.resetPage()},this.resetPage=()=>{this.setState({page:1}),this.maxPageForHidePageTotal=1},this.useDatasourcesChange=e=>{const{useDataSources:t}=this.props,i=e.useDataSources;if(t&&t[0]){const e=i&&i[0];e&&e.dataSourceId===t[0].dataSourceId||this.resetPage()}else this.setState({datasource:void 0})},this.listSortChange=e=>{const{config:t}=this.props;if(t.sortOpen){t.sorts!==e.config.sorts&&this.setState({sortOptionName:void 0,showSortString:!1})}},this.listFilterChange=e=>{const{config:t}=this.props;if(t.filterOpen){t.filter!==e.config.filter&&this.setState({currentFilter:void 0,filterApplied:!1})}},this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:i}=this.props;this.props.dispatch(t.appActions.widgetStatePropChange(e,"selectionIsInSelf",i))},this.updateScrollContentSize=e=>{const{config:t}=this.props,i=(null==t?void 0:t.layoutType)===h.GRID?E(null==t?void 0:t.horizontalSpace,null==e?void 0:e.horizontalSpace)&&E(null==t?void 0:t.verticalSpace,null==e?void 0:e.verticalSpace):E(t.space,e.space);t.layoutType===e.layoutType&&i||this.setScrollContentSize()},this.scrollToSelectedItems=e=>{var t;const i=e.getSelectedRecordIds(),o=this.checkIsSelectRecordsChange(e);if(i&&i.length>0&&o&&(o||this.needScroll)){const o=this.getNewAddedSelectedRecordsId(e),s=(null==o?void 0:o.length)>0?o:i;let n=-1;if(null===(t=null==this?void 0:this.records)||void 0===t||t.find(((e,t)=>{var i;if(!(null==e?void 0:e.getId))return!1;const o=null===(i=null==e?void 0:e.getId)||void 0===i?void 0:i.call(e);return!!(null==s?void 0:s.includes(o))&&(n=t,!0)})),-1===n){const t=e.getRecords();if(t&&t.find(((e,t)=>{var o;return(null===(o=e.getId)||void 0===o?void 0:o.call(e))===i[0]&&(n=t,!0)})),n>-1){const e=Math.ceil((n+1)/this.getPageSize());this.needScroll=!0,this.setState({page:e})}}else this.scrollToIndex(n),this.needScroll=!1,this.autoScrollIndex=n,this.needAutoScrollToSelectedItemWhenLoadPage=!0,this.lastSelectedRecordIds=i||[]}},this.checkIsSelectRecordsChange=e=>{var t;const i=(null==e?void 0:e.getSelectedRecordIds())||[],o=(null==this?void 0:this.lastSelectedRecordIds)||[];return(null==i?void 0:i.length)!==(null==o?void 0:o.length)||(null===(t=null==i?void 0:i.filter((e=>!(null==o?void 0:o.includes(e)))))||void 0===t?void 0:t.length)>0},this.getNewAddedSelectedRecordsId=e=>{const t=this.lastSelectedRecordIds||[],i=e.getSelectedRecordIds()||[];return null==i?void 0:i.filter((e=>!(null==t?void 0:t.includes(e))))},this.onDSCreated=e=>{const{dispatch:i,id:o}=this.props;this.setState({datasource:e,createDataSourceFailed:!1},(()=>{i(t.appActions.widgetStatePropChange(o,"dsId",e.id))}))},this.onResize=(e,t)=>{const i={width:e,height:t};this.hasGetListSizeByResizeDetector=!0;const{config:s}=this.props,{isResizingCard:n,currentCardSize:r,widgetRect:l}=this.state;if(n)return;const a=V(this.props,this.state),d=W(this.paginatorDiv.current,a),c=q(this.props),u=G(i,d,c),p=this.getOldCardSizeWhenResize(i),g=s.layoutType===h.GRID?B(this.props,i):r,m={width:g.width,height:g.height};let f=!E(null==r?void 0:r.width,null==g?void 0:g.width)||!E(null==r?void 0:r.height,null==g?void 0:g.height);if(s.lockItemRatio&&s.layoutType!==h.GRID){const t=m.width/m.height;switch(null==s?void 0:s.layoutType){case h.Column:m.height=u,m.width=u*t,E(m.width,p.width)||(f=!0);break;case h.Row:m.height=e/t,m.width=e,E(m.height,p.height)||(f=!0)}}else switch(null==s?void 0:s.layoutType){case h.Column:m.height=u;break;case h.Row:m.width=e}const v=m.width<o||m.height<o,S=(i.width!==l.width||i.height!==l.height)&&0!==i.width&&0!==i.height;v&&!S||(this.setState({widgetRect:i,currentCardSize:m},(()=>{this.isHasInitCurrentCardSize=!0,this.editListSizeInRunTime(i),f&&this.refreshList()})),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=void 0),s.lockItemRatio&&(this.resizeTimeout=setTimeout((()=>{this.handleResizeCard(m,!0,!1,!1,!0)}),500)),this.updateCardToolPosition(),this.setListDivSize(),!this.isCurrentPageLastPage&&this.isScrollEnd&&this.loadNextPageWhenListSizeOrTotalCountChange())},this.getOldCardSizeWhenResize=e=>{const{currentCardSize:t}=this.state;return this.isHasInitCurrentCardSize?t:B(this.props,e)},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props,{hideCardTool:t}=this.state;e&&!t&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.refreshList=(e=!0)=>{var t,i,o,s,n;this.listRef.current&&((null===(t=this.props.config)||void 0===t?void 0:t.layoutType)===h.GRID?this.resetAfterIndices():(null===(o=null===(i=this.listRef)||void 0===i?void 0:i.current)||void 0===o?void 0:o.resetAfterIndex)&&(null===(n=null===(s=this.listRef)||void 0===s?void 0:s.current)||void 0===n||n.resetAfterIndex(0,e)))},this.isDsConfigured=()=>{const{useDataSources:e}=this.props;return!!e&&!!e[0]},this.selectRecords=e=>{const{datasource:i}=this.state;i&&(t.MessageManager.getInstance().publishMessage(new t.DataRecordsSelectionChangeMessage(this.props.id,e,[i.id])),e?(this.isHasPublishMessageAction=!0,this.lastSelectedRecordIds=(null==e?void 0:e.map((e=>e.getId())))||[],i.selectRecordsByIds(e.map((e=>e.getId())))):this.isHasPublishMessageAction=!1)},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:zi[e]},t),this.editStatus=(e,i)=>{const{dispatch:o,id:s}=this.props;o(t.appActions.widgetStatePropChange(s,e,i))},this.editWidgetConfig=e=>{if(!window.jimuConfig.isInBuilder)return;this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.scrollToIndex=(e,t="start")=>{const{config:i}=this.props;if(this.listRef.current)if((null==i?void 0:i.layoutType)===h.GRID){const i=this.getItemColumnCount(),o=Math.floor(e/i);this.listRef.current.scrollToItem({columnIndex:e-o*i,rowIndex:o,align:t})}else this.listRef.current.scrollToItem(e,t)},this.isEditing=()=>{const{appMode:e,config:i,selectionIsSelf:o,selectionIsInSelf:s}=this.props;if(!window.jimuConfig.isInBuilder)return!1;const n=e===t.AppMode.Design;return(o||s)&&window.jimuConfig.isInBuilder&&n&&i.isItemStyleConfirm},this.handleItemChange=e=>{const{config:t}=this.props,{datasource:i}=this.state;if(!i||!e)return;let o=i.getSelectedRecords()||[];if(t.cardConfigs[v.Selected].selectionMode&&t.cardConfigs[v.Selected].selectionMode!==r.None){const i=null==e?void 0:e.getId(),s=o.find((e=>e.getId()===i));t.cardConfigs[v.Selected].selectionMode===r.Single?s?(this.canClickLink=!1,this.selectRecords([]),this.setState({showSelectionOnly:!1})):(this.canClickLink=!0,this.selectRecords([e])):(s?(this.canClickLink=!1,o=o.filter((e=>e.getId()!==i))):(this.canClickLink=!0,o=o.concat([e])),this.selectRecords(o))}},this.handleListPointerDown=e=>{this.setState({forceShowMask:!0}),this.mouseClickTimeout&&(clearTimeout(this.mouseClickTimeout),this.mouseClickTimeout=void 0),this.mouseClickTimeout=setTimeout((()=>{this.setState({forceShowMask:!1})}),200)},this.handleScrollUp=e=>{e&&(this.isScrollToNextStep=!0);const t=this.getScrollStep();let i=this.getListVisibleStartIndex()-t;i<0&&(i=0),this.scrollToIndex(i,"start"),this.isScrollToNextStep=!1},this.handleScrollDown=e=>{let t=0;e?(t=this.getListVisibleEndIndex(),this.isScrollToNextStep=!0):t=this.getListVisibleStartIndex();const i=this.getScrollStep(),{listVisibleStopIndex:o}=this;o+i>=this.records.length-1&&!this.isCurrentPageLastPage?(this.isSwitchPage=!0,this.setState({page:this.state.page+1})):this.needAutoScrollToSelectedItemWhenLoadPage?this.scrollToIndex(this.autoScrollIndex):this.scrollToIndex(t+i,"start")},this.getScrollStep=()=>{const{scrollStep:e,layoutType:t}=this.props.config,i=this.isScrollToNextStep?e:0,o=this.getItemColumnCount();return t===h.GRID?i*o:i},this.handleSwitchPage=e=>{const t=this.getTotalPage();t&&(e<1||e>t)||e!==this.state.page&&(this.isSwitchPage=!0,this.lastQueryStart=this.state.page,this.setState({page:e}))},this.handleListMouseLeave=()=>{this.isEditing()||this.setState({hoverIndex:-1})},this.handleListMouseMove=e=>{this.isEditing()||e!==this.state.hoverIndex&&this.setState({hoverIndex:e})},this.lastScrollOffset=0,this.handleListScroll=({scrollDirection:e,scrollOffset:i,scrollTop:o,scrollUpdateWasRequested:s})=>{var n,r;const{appMode:a,config:d}=this.props,c=this.listOutDivRef,{datasource:u,scrollStatus:p}=this.state;this.lastScrollOffset=(null==d?void 0:d.layoutType)===h.GRID?o:i,!c||(null!==(r=null===(n=this.records)||void 0===n?void 0:n.length)&&void 0!==r?r:0)<1||d.pageStyle!==l.Scroll||this.queryStatus===t.DataSourceStatus.Loading||!u||window.jimuConfig.isInBuilder&&a===t.AppMode.Design||(this.isHasScrolled=!0,!function(e,t){return!e||t<2}(c,this.lastScrollOffset)?"mid"!==p&&this.setState({scrollStatus:"mid"}):"start"!==p&&this.setState({scrollStatus:"start"}))},this.getTotalPage=()=>{const{totalCount:e}=this,{config:t}=this.props,i=e,o=Math.floor(i/t.itemsPerPage);return 0===i%t.itemsPerPage?o:o+1},this.getListVisibleStartIndex=()=>{const{lastScrollOffset:e}=this,{config:t}=this.props,i=this.itemSize(0),o=1*e/i;let s=Math.floor(o);const n=(o-s)*i,r=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space,l=this.getItemColumnCount();return s=(null==t?void 0:t.layoutType)===h.GRID?s*l:s,n>i-r&&(s=(null==t?void 0:t.layoutType)===h.GRID?s+l:s+1),s},this.getListVisibleEndIndex=()=>{const{lastScrollOffset:e}=this,{config:t}=this.props,i=this.itemSize(0),o=(null==t?void 0:t.layoutType)===h.Column,s=this.getListSize(),n=1*(e+(o?s.width:s.height))/i;let r=Math.floor(n);const l=(n-r)*i,a=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space,d=this.getItemColumnCount();return r=(null==t?void 0:t.layoutType)===h.GRID?r*d-1:r,r<0&&(r=0),l>i-a&&(r=(null==t?void 0:t.layoutType)===h.GRID?r+d:r+1),r},this.handleSortOptionChange=e=>{this.setState({sortOptionName:e,page:1,showSortString:!1,scrollStatus:"start",isScrollEnd:!1},(()=>{this.resetPage(),this.scrollToIndex(0)}))},this.handleSearchTextChange=e=>{""!==e&&e||this.handleSearchSubmit(void 0),this.setState({searchSuggestion:[]}),clearTimeout(this.suggestionsQueryTimeout),this.suggestionsQueryTimeout=setTimeout((()=>{this.getSearchSuggestions(e)}),200)},this.getSearchSuggestions=e=>{const{config:i}=this.props,{datasource:o}=this.state;if((null==e?void 0:e.length)<3)return!1;(function(e,i,o){return y(this,void 0,void 0,(function*(){var s;const n={searchText:e,searchFields:(null===(s=null==i?void 0:i.searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],dataSource:o,exact:null==i?void 0:i.searchExact};return t.dataSourceUtils.querySuggestions(n)}))})(e,i,o).then((e=>{this.setState({searchSuggestion:e})}))},this.handleSearchSubmit=(e,i=!1)=>{const{datasource:o}=this.state;(this.state.searchText!==e||i)&&this.setState({searchText:e,page:1},(()=>{this.resetPage(),t.MessageManager.getInstance().publishMessage(new t.DataSourceFilterChangeMessage(this.props.id,[o.id]))}))},this.changeIsResizingCard=e=>{this.setState({isResizingCard:e})},this.handleResizeCard=(e,t=!1,i,o,s=!1)=>{if(t){const n=this.initNewCardSize(e);window.jimuConfig.isInBuilder&&this.props.builderSupportModules.widgetModules.handleResizeCard(this.props,n,i,o,t,s)}else this.setState({currentCardSize:e},(()=>{this.refreshList(!1)}))},this.initNewCardSize=e=>{const{config:o}=this.props,{widgetRect:n}=this.state;let r=(0,t.Immutable)(e);const l=F(this.props);return l.width.unit===i.DistanceUnits.PERCENTAGE&&(r=r.set("width",100*e.width/(n.width+(null==o?void 0:o.horizontalSpace)-s)+"%")),l.height.unit===i.DistanceUnits.PERCENTAGE&&(r=r.set("height",100*e.height/n.height+"%")),null==r?void 0:r.asMutable({deep:!0})},this.handleFilterChange=e=>{const{datasource:i}=this.state;this.setState({currentFilter:e,page:1},(()=>{this.resetPage(),t.MessageManager.getInstance().publishMessage(new t.DataSourceFilterChangeMessage(this.props.id,[i.id]))}))},this.handleFilterApplyChange=e=>{const{datasource:i}=this.state,o={filterApplied:e,queryStart:0};this.setState(o,(()=>{t.MessageManager.getInstance().publishMessage(new t.DataSourceFilterChangeMessage(this.props.id,[i.id]))}))},this.handleShowSelectionClick=e=>{const{showSelectionOnly:t}=this.state;this.setState({showSelectionOnly:!t})},this.handleClearSelectionClick=()=>{this.setState({showSelectionOnly:!1}),this.selectRecords([])},this.resetShowSelectionStatus=()=>{const{showSelectionOnly:e}=this.state;e&&this.setState({showSelectionOnly:!1})},this._getCurrentPage=()=>this.state.page,this.getTotalCount=()=>this.totalCount||0,this.selectCard=()=>{const{selectionIsInSelf:e}=this.props;e&&this.selectSelf()},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.editListSizeInRunTime=e=>{const{id:i,dispatch:o}=this.props;o(t.appActions.widgetStatePropChange(i,"widgetRect",e))},this.renderListTopTools=(e,o,s,n)=>{const{widgetRect:r,isSearchBoxVisible:l,isOpenTopToolsPopper:a}=this.state,d=(null==r?void 0:r.width)||620,c=K(this.props),u=Q(this.props),h=this.formatMessage("listDataActionLabel",{layer:(null==e?void 0:e.getLabel())||""}),p=c?250:175,g=this.getFieldsOfWidgetInList();return(0,t.jsx)("div",{className:"datasource-tools w-100",css:(this.props,m=u,t.css`
    .list-data-action {
      & {
        padding-left: ${t.polished.rem(4)};
      }
      &::after {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        height: ${t.polished.rem(16)};
        border-left: 1px solid ${m?"var(--light-400)":"transparent"}
      }
    }
    .m-left {
      margin-left: ${t.polished.rem(4)};
    }
  `)},(0,t.jsx)("div",{className:"d-flex align-items-center"},(0,t.jsx)("div",{className:"flex-grow-1 tool-row overflow-hidden"},u&&(0,t.jsx)("div",null,d>=p&&(0,t.jsx)("div",{className:"tool-row row1 d-flex align-items-center w-100 justify-content-between"},this.renderSearchTools(e,o),(!l||d>=360)&&this.renderTopRightTools(e,o)),d<p&&(0,t.jsx)("div",{className:"float-right",ref:e=>{this.reference=e}},(0,t.jsx)(i.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:this.formatMessage("guideStep9Title"),onClick:e=>{this.setState({isOpenTopToolsPopper:!a})}},(0,t.jsx)(Ci,{size:16})),this.renderListTopToolsInPopper(e,o)))),e&&c&&(0,t.jsx)("div",{className:(0,t.classNames)("list-data-action position-relative",{"m-left":d<p}),"data-testid":"data-action"},(0,t.jsx)(i.DataActionList,{widgetId:this.props.id,dataSets:[{dataSource:e,records:s,name:h,type:"selected",fields:g}],listStyle:i.DataActionListStyle.Dropdown,buttonType:"tertiary",buttonSize:"sm"}))),n&&(0,t.jsx)("div",{className:"editing-mask-ds-tool"}));var m},this.getFieldsOfWidgetInList=()=>{var e,i,o;const{browserSizeMode:s,id:n}=this.props,r=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appConfig,l=(null===(o=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[n])||void 0===o?void 0:o.layouts)||{};let a=Object.keys(l).map((e=>l[e][s]))||[];a=Array.from(new Set(a));let d=[];a.forEach((e=>{const i=S.searchUtils.getContentsInLayoutWithRecursiveLayouts(r,e,t.LayoutItemType.Widget,s)||[];d=d.concat(i)})),d=Array.from(new Set(d));let c=[];return d.forEach((e=>{var t,i,o;const s=(null===(o=null===(i=null===(t=r.widgets[e])||void 0===t?void 0:t.useDataSources)||void 0===i?void 0:i[0])||void 0===o?void 0:o.fields)||[];c=c.concat(s)})),Array.from(new Set(c))},this.renderListTopToolsInPopper=(e,o)=>{const{widgetRect:s,isSearchBoxVisible:n,isOpenTopToolsPopper:r}=this.state,l=this.isEditing(),a=((null==s?void 0:s.width)||620)<(K(this.props)?250:175)&&r&&!l;return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{placement:"bottom-start",reference:this.reference,offset:[-10,0],open:a,showArrow:!0,toggle:e=>{this.setState({isOpenTopToolsPopper:!a})}},(0,t.jsx)("div",{className:"tool-row row1 d-flex align-items-center justify-content-between",css:I(this.props)},this.renderSearchTools(e,o),!n&&this.renderTopRightTools(e,o))))},this.renderSearchTools=(e,o)=>{const s=this.isEditing()||!e||o!==t.DataSourceStatus.Loaded,{searchText:n,widgetRect:r,isSearchBoxVisible:l,showLoading:a}=this.state,d=(null==r?void 0:r.width)||620,{theme:c,config:u,appMode:h}=this.props,p=d<360?"ds-tools-line-blue":"",g=(null==u?void 0:u.searchHint)||this.formatMessage("search"),m=d<360&&l;return(0,t.jsx)("div",{className:"list-search-div flex-grow-1",css:C(this.props)},J(this.props)&&(0,t.jsx)("div",{className:"d-flex search-box-content"},(d>=360||l)&&(0,t.jsx)("div",{className:"flex-grow-1 w-100"},(0,t.jsx)(Ie,{theme:c,placeholder:g,searchText:n,onSearchTextChange:this.handleSearchTextChange,onSubmit:this.handleSearchSubmit,disabled:s,searchSuggestion:this.state.searchSuggestion,suggestionWidth:d,showLoading:a,formatMessage:this.formatMessage,isShowBackButton:m,toggleSearchBoxVisible:this.toggleSearchBoxVisible,className:"list-search ",appMode:h}),(0,t.jsx)("div",{className:(0,t.classNames)("ds-tools-line",p)})),d<360&&!l&&(0,t.jsx)(i.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.toggleSearchBoxVisible(!0)},className:"list-search-icon",title:this.formatMessage("search")},(0,t.jsx)(ve,{size:16,color:c.ref.palette.neutral[700]}))))},this.toggleSearchBoxVisible=(e=!1)=>{const{widgetRect:t}=this.state;this.setState({isSearchBoxVisible:e});const i=K(this.props)?250:175;((null==t?void 0:t.width)||620)<i&&(clearTimeout(this.showPopperTimeOut),this.showPopperTimeOut=setTimeout((()=>{this.setState({isOpenTopToolsPopper:!0})})))},this.getPageSize=()=>{const{widgetRect:e}=this.state,{config:t}=this.props,i=V(this.props,this.state),o=G(e,W(this.paginatorDiv.current,i),q(this.props))||1,s=(null==t?void 0:t.layoutType)===h.GRID?this.getItemColumnCount():null;return Math.max(U(e,o,this.props,s),1)},this.handleRefreshList=e=>{const{id:t}=this.props;e.load(this.queryOptions,{widgetId:t,refresh:!0})},this.getClassNameOfTopRightToolsCon=()=>{const{widgetRect:e}=this.state,t=e&&e.width||o;return t>580?"top-right-tools-size-3":t>480?"top-right-tools-size-2":t>355?"top-right-tools-size-1":"top-right-tools-size-0"},this.renderTopRightTools=(e,o)=>{const{showSelectionOnly:s,currentFilter:n,filterApplied:r,sortOptionName:l,showSortString:a}=this.state,{config:d,theme:c,id:u,appMode:h,dispatch:p}=this.props,g=e&&e.getSelectedRecords(),m=g&&g.length>0;return(0,t.jsx)("div",{className:(0,t.classNames)("d-flex align-items-center mr-1",this.getClassNameOfTopRightToolsCon()),ref:this.listTopRightToolsDiv},Y(this.props)&&(0,t.jsx)(mt,{sortOptionName:l,datasource:e,sorts:d.sorts,handleSortOptionChange:this.handleSortOptionChange,dispatch:p,id:u,showSortString:a}),X(this.props)&&(0,t.jsx)(Mt,{filter:n||d.filter,filterInConfig:d.filter,appMode:h,applied:r,title:this.formatMessage("filter"),selectedDs:this.state.datasource,handleFilterChange:this.handleFilterChange,handleFilterApplyChange:this.handleFilterApplyChange,formatMessage:this.formatMessage,theme:c,widgetId:u}),(null==d?void 0:d.showRefresh)&&(0,t.jsx)(i.Button,{type:"tertiary",title:this.formatMessage("refresh"),icon:!0,size:"sm",onClick:()=>{this.handleRefreshList(e)}},(0,t.jsx)(Oi,{size:16})),Z(this.props)&&(0,t.jsx)(i.Button,{disabled:!m,type:"tertiary",title:s?this.formatMessage("showAll"):this.formatMessage("showSelection"),icon:!0,size:"sm",onClick:this.handleShowSelectionClick},s?(0,t.jsx)(ei,{size:16}):(0,t.jsx)(ri,{size:16})),ee(this.props)&&(0,t.jsx)(i.Button,{disabled:!m,type:"tertiary",title:this.formatMessage("clearSelection"),icon:!0,size:"sm",onClick:this.handleClearSelectionClick},(0,t.jsx)(ci,{size:16})))},this.getListSize=()=>{const{widgetRect:e}=this.state,t=q(this.props),i=V(this.props,this.state),s=G(e,W(this.paginatorDiv.current,i),t)||1;return{width:e&&e.width||o,height:s}},this.renderList=(e,i)=>{const{widgetRect:s,isMount:n,currentCardSize:r}=this.state,{config:l,isRTL:a}=this.props,d=null==i?void 0:i.status;if(this.queryStatus=d,this.isHasRenderList=!0,!n||!this.hasGetListSizeByResizeDetector)return!1;d===t.DataSourceStatus.Unloaded&&(e=void 0),this.getDsTotalCount(e,d),this.checkIsLastPageWithQueryStatus(e,d);const c=this.getLoadingStatus(e,d),u=(null==e?void 0:e.getAutoRefreshInterval())||0;this.toggleAutoRefreshLoading(e,c);const p=V(this.props,this.state),g=q(this.props),m=G(s,W(this.paginatorDiv.current,p),g)||1,f=s&&s.width||o,v=this.getOverscanCount(m),S=this.getDsSelectRecords(e),y=this.getDsRecords(e,c,m),w=this.checkIsShowListMask(c,y);this.isFirstLoad=!1,0===y.length&&this.resetShowSelectionStatus(),this.getListInnerElementType();const b=this.getListStyle();return(0,t.jsx)("div",{"data-testid":"listContainer",className:"list-container animation",css:b,onKeyDown:this.handleListKeyDown},g&&this.renderListTopTools(e,d,S,w),(null==l?void 0:l.layoutType)===h.GRID&&(0,t.jsx)(Ke,{className:(0,t.classNames)("widget-list-list",{"hide-list":!y||0===(null==y?void 0:y.length)}),ref:this.listRef,useIsScrolling:!0,outerRef:this.setListOutDivRef,direction:a?"rtl":"ltr",itemCount:this.records.length,overscanCount:v,itemKey:this.gridItemIndex,columnCount:this.getItemColumnCount(),columnWidth:e=>this.columnWidth(e,r.width,null==l?void 0:l.horizontalSpace),rowCount:this.getItemRowCount(),rowHeight:e=>this.rowHeight(e,r.height,null==l?void 0:l.verticalSpace),width:f,height:m,onItemsRendered:this.onItemsRendered,itemData:this.getItemsByRecords(this.records),innerElementType:this.innerElementType,onScroll:this.handleListScroll,role:"listbox"},this.itemRender),(null==l?void 0:l.layoutType)!==h.GRID&&(0,t.jsx)(ot,{className:(0,t.classNames)("widget-list-list",{"hide-list":!y||0===(null==y?void 0:y.length)}),ref:this.listRef,useIsScrolling:!0,outerRef:this.setListOutDivRef,direction:a?"rtl":"ltr",role:"listbox",layout:l.layoutType===h.Column?"horizontal":"vertical",itemCount:this.records.length,overscanCount:v,itemKey:this.itemKey,width:f,height:m,onItemsRendered:this.onItemsRendered,itemData:this.getItemsByRecords(this.records),innerElementType:this.innerElementType,itemSize:this.itemSize,onScroll:this.handleListScroll},this.itemRender),w&&(0,t.jsx)("div",{className:"editing-mask-con"},(0,t.jsx)("div",{className:"editing-mask-list"}),(null==l?void 0:l.layoutType)===h.GRID&&(0,t.jsx)("div",{className:"editing-mask-list-grid"})),p&&this.renderBottomTools(c),this.renderEmptyElement(c),d===t.DataSourceStatus.NotReady&&this.renderNotReadyTips(e),(c||u>0)&&this.renderLoading(c,u),l.showRecordCount&&this.renderDataCount(e,d),(0,t.jsx)("div",{id:"describeByMessage",className:"sr-only"},this.formatMessage("describeMessage")),(0,t.jsx)("div",{className:"sr-only",tabIndex:0,ref:e=>{this.jumpOutNodeOfList=e}}))},this.renderDataCount=(e,i)=>{var o;const{widgetRect:s}=this.state,n=(null==s?void 0:s.width)||620,r=n<321?n-36:n/2,l=i===t.DataSourceStatus.NotReady?0:null==e?void 0:e.count,a=i===t.DataSourceStatus.NotReady?0:null===(o=null==e?void 0:e.getSelectedRecords())||void 0===o?void 0:o.length;return(0,t.jsx)("div",{ref:"countContainer",className:"position-absolute data-count d-flex align-items-center",style:{maxWidth:r}},(0,t.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate",title:this.formatMessage("dataCount",{total:l,selected:a})},this.formatMessage("dataCount",{total:l,selected:a})))},this.handleListKeyDown=e=>{"Escape"===e.key&&this.jumpOutNodeOfList.focus()},this.renderEmptyElement=e=>{var i;const o=!this.records||this.records.length<1,s=(null===(i=this.props.config)||void 0===i?void 0:i.noDataMessage)||this.formatMessage("noData");return!e&&o&&(0,t.jsx)("div",{className:"empty-con text-center"},(0,t.jsx)(gi,{size:16}),(0,t.jsx)("div",{className:"discribtion"},s))},this.clearMessageAction=()=>{const{datasource:e}=this.state;this.handleClearSelectionClick(),e&&t.MessageManager.getInstance().publishMessage(new t.DataRecordsSelectionChangeMessage(this.props.id,[],[e.id]))},this.renderLoading=(e,o)=>{const{autoRefreshLoadingString:s,widgetRect:n}=this.state,{config:r}=this.props;let l=null==r?void 0:r.isShowAutoRefresh;"boolean"!=typeof l&&(l=!0);const a=((null==n?void 0:n.width)||620)<321;return(0,t.jsx)("div",{className:(0,t.classNames)("position-absolute refresh-loading-con d-flex align-items-center",this.getRefreshLoadingClass())},e&&(0,t.jsx)("div",{className:"loading-con"}),o>0&&l&&(0,t.jsx)("div",{className:"flex-grow-1 auto-refresh-loading"},a&&(0,t.jsx)(i.Tooltip,{title:s,placement:"top"},(0,t.jsx)(i.Button,{className:"list-auto-refresh-button",type:"tertiary","aria-label":s},(0,t.jsx)(wi,null))),!a&&(0,t.jsx)("div",{className:"auto-refresh-string-con"},s)))},this.renderNotReadyTips=e=>{var o,s,n,r,l;const a=null==e?void 0:e.getLabel(),d=null===t.appConfigUtils||void 0===t.appConfigUtils?void 0:t.appConfigUtils.getWidgetIdByOutputDataSource(null===(s=null===(o=this.props)||void 0===o?void 0:o.useDataSources)||void 0===s?void 0:s[0]),c=null===(n=(0,t.getAppStore)().getState())||void 0===n?void 0:n.appConfig,u=null===(l=null===(r=null==c?void 0:c.widgets)||void 0===r?void 0:r[d])||void 0===l?void 0:l.label;return(0,t.jsx)("div",{className:"placeholder-alert-con"},(0,t.jsx)(i.Alert,{form:"tooltip",size:"small",type:"warning",text:this.formatMessage("outputDataIsNotGenerated",{outputDsLabel:a,sourceWidgetName:u})}))},this.checkAndResetPage=()=>{const{datasource:e}=this.state;if(this.maxPageForHidePageTotal<2)return;const t=this.checkIsLastPage(e,this.maxPageForHidePageTotal,this.pageSize),i=this.maxPageForHidePageTotal-1,o=this.checkIsLastPage(e,i,this.pageSize);t&&o&&this.resetPage()},this.renderBottomTools=e=>{const{scrollStatus:i,isScrollEnd:o,datasource:s}=this.state,{config:n,isRTL:r}=this.props;this.checkAndResetPage();const l=this.checkIsLastPage(s,this.maxPageForHidePageTotal,this.pageSize),a=l||this.checkIsLastPage(s,this.maxPageForHidePageTotal+1,this.pageSize);let d;return d=!1===(null==n?void 0:n.hidePageTotal)?this.getTotalPage():l?this.maxPageForHidePageTotal:this.maxPageForHidePageTotal+1,(0,t.jsx)("div",{ref:this.paginatorDiv},(0,t.jsx)(Vt,{isLastPage:a,isRTL:r,totalPage:d,currentPage:this._getCurrentPage(),isEditing:this.isEditing(),isScrollEnd:o,pageStyle:n.pageStyle,layoutType:null==n?void 0:n.layoutType,scrollStatus:i,handleScrollUp:this.handleScrollUp,handleScrollDown:this.handleScrollDown,handleSwitchPage:this.handleSwitchPage,formatMessage:this.formatMessage,showLoading:e,hidePageTotal:null==n?void 0:n.hidePageTotal}))},this.getDsTotalCount=(e,i)=>{const{config:o}=this.props;if(!this.checkIsQueryCount(o))return;const s=null==e?void 0:e.count;if(this.queryStatus=i,i===t.DataSourceStatus.Loaded&&null!==s){this.totalCount!==s&&(this.setPageTimeout=setTimeout((()=>{this.resetPage()}),1));const e=this.totalCount;this.totalCount=s,e!==this.totalCount&&this.loadNextPageWhenListSizeOrTotalCountChange()}},this.checkIsLastPage=(e,t,i)=>{var o;if(!t||!i||!e)return!1;const s=null==e?void 0:e.haveMorePages(t,i),n=!s;let r=!1;if("unknown"===s){const t=null==e?void 0:e.count;r=(null===(o=this.records)||void 0===o?void 0:o.length)>=t}else r=n;return r},this.checkIsLastPageWithQueryStatus=(e,i)=>{if(i===t.DataSourceStatus.Loaded&&i){const{page:t}=this.state;this.isCurrentPageLastPage=this.checkIsLastPage(e,t,this.pageSize),t>this.maxPageForHidePageTotal&&(this.maxPageForHidePageTotal=t)}},this.loadNextPageWhenListSizeOrTotalCountChange=()=>{const{config:e}=this.props;e.pageStyle===l.Scroll&&(clearTimeout(this.loadMoreDataTimeout),this.loadMoreDataTimeout=setTimeout((()=>{this.isScrollEnd&&(this.isHasScrolled=!0,this.intersectionObserverCallback(!0))}),500))},this.getLoadingStatus=(e,i)=>{const{LayoutEntry:o}=this.state,{showLoading:s}=this.props;let n=!1;return(s||window.jimuConfig.isInBuilder&&!o||e&&i===t.DataSourceStatus.Loading)&&(n=!0),n},this.toggleAutoRefreshLoading=(e,t)=>{const i=(null==e?void 0:e.getAutoRefreshInterval())||0;this.resetAutoRefreshTimes(i,t),i>0&&this.setRefreshLoadingString(t)},this.setListOutDivRef=e=>{if(!e)return;const t=`bottomBoundary${this.props.id}`;this.listOutDivRef=e,this.setListDivSize();const i=document.createElement("div");i.id=t,i.className="bottom-boundary";const o=this.listOutDivRef.getElementsByTagName("div")[0];this.setScrollContentSize(),o.appendChild(i),function(e,t,i,o){const s=new IntersectionObserver((function(e,t){const o=e[0].intersectionRatio>0;i&&i(o)}),o||{root:t});s.observe(e)}(document.getElementById(t),this.listOutDivRef,this.intersectionObserverCallback)},this.getDsRecords=(e,i,o)=>{const{showSelectionOnly:s,widgetRect:n}=this.state,{config:r,appMode:a}=this.props,d=(null==r?void 0:r.layoutType)===h.GRID?this.getItemColumnCount():null,c=U(n,o,this.props,d),u=this.getDefaultRecords(c);let p=u;const g=this.getDsSelectRecords(e);if(e&&r.isItemStyleConfirm){p=(null==e?void 0:e.dataViewId)===Pi?e&&(r.pageStyle===l.Scroll?e.getRecordsByPage(1,c*this.state.page):e.getRecordsByPage(this.state.page,c))||[]:e&&(r.pageStyle===l.Scroll?e.getRecordsByPageWithSelection(1,c*this.state.page):e.getRecordsByPageWithSelection(this.state.page,c))||[],s&&(p=g)}return window.jimuConfig.isInBuilder&&a===t.AppMode.Design&&!i&&p.length<1&&(p=u),i&&!this.isFirstLoad||(this.records=p),p},this.resetGridListAfterRowIndex=e=>{var t,i,o,s,n;if((null==this?void 0:this.records)&&(null===(t=this.records)||void 0===t?void 0:t.length)!==(null==e?void 0:e.length)){let e=this.getItemRowCount()-1;e=e>-1?e:0,(null===(o=null===(i=this.listRef)||void 0===i?void 0:i.current)||void 0===o?void 0:o.resetAfterIndices)&&(null===(n=null===(s=this.listRef)||void 0===s?void 0:s.current)||void 0===n||n.resetAfterRowIndex(e,!0))}},this.resetListAfterRecordChange=e=>{var t,i,o,s,n,r;(null==this?void 0:this.records)&&(null===(t=this.records)||void 0===t?void 0:t.length)!==(null==e?void 0:e.length)&&this.listRef.current&&((null===(i=this.props.config)||void 0===i?void 0:i.layoutType)===h.GRID?(null===(s=null===(o=this.listRef)||void 0===o?void 0:o.current)||void 0===s?void 0:s.resetAfterIndices)&&(null===(r=null===(n=this.listRef)||void 0===n?void 0:n.current)||void 0===r||r.resetAfterRowIndex(0,!0)):(this.resetTimeout&&clearTimeout(this.resetTimeout),this.resetTimeout=setTimeout((()=>{var e,t,i,o;(null===(t=null===(e=this.listRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.resetAfterIndex)&&(null===(o=null===(i=this.listRef)||void 0===i?void 0:i.current)||void 0===o||o.resetAfterIndex(0,!1))}),300)))},this.getDefaultRecords=(e=3)=>{e=e&&e>1?e:3;const t=[];for(let i=0;i<e;i++)t.push(ji);return t},this.getDsSelectRecords=e=>{const{config:t}=this.props;let i;return e&&t.isItemStyleConfirm&&(i=e.getSelectedRecords()),i},this.getListInnerElementType=()=>{const{config:e}=this.props,i=(null==e?void 0:e.layoutType)===h.GRID?null==e?void 0:e.verticalSpace:null==e?void 0:e.space;this.lastSpace!==i&&(this.lastSpace=i,this.innerElementType=(0,ze.forwardRef)(((o,s)=>{var{style:n}=o,r=Li(o,["style"]);return(0,t.jsx)("div",Object.assign({ref:s,style:Object.assign(Object.assign({},n),{height:parseFloat(n.height)-(e.layoutType===h.Column?0:i)+"px",width:parseFloat(n.width)-(e.layoutType!==h.Column?0:i)+"px"})},r))})))},this.getListStyle=()=>{var e,t;const{toolsDivWidth:i,currentCardSize:o,widgetRect:s}=this.state,{config:n,appMode:r,theme:l,isHeightAuto:a,isWidthAuto:d}=this.props,c=V(this.props,this.state),u=W(this.paginatorDiv.current,c),h=q(this.props),p=B(this.props,s),g={pageStyle:null==n?void 0:n.pageStyle,scrollBarOpen:null==n?void 0:n.scrollBarOpen,direction:null==n?void 0:n.direction,appMode:r,theme:l,isHeightAuto:a,isWidthAuto:d,currentCardSize:o,listTemplateDefaultCardSize:p,showTopTools:h,bottomToolH:u,topRightToolW:i,hasRecords:(null!==(t=null===(e=this.records)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>0,mexSize:this.getListMaxSize(),layoutType:null==n?void 0:n.layoutType,listLeftPadding:this.getListContentLeftPadding()};return b(g)},this.checkIsShowListMask=(e,i)=>{const{appMode:o}=this.props,{isInBuilder:s}=window.jimuConfig,n=this.isEditing(),r=!i||i.length<1;return s&&n&&!(!e&&r)&&o===t.AppMode.Design},this.getOverscanCount=e=>{const{widgetRect:i}=this.state,{appMode:o,config:s}=this.props,n=(null==s?void 0:s.layoutType)===h.GRID?this.getItemColumnCount():null,r=U(i,e,this.props,n);return window.jimuConfig.isInBuilder&&o===t.AppMode.Design?0:r},this.setScrollContentSize=()=>{var e;if(!this.listOutDivRef)return;const{layoutType:t}=null===(e=this.props)||void 0===e?void 0:e.config,i=this.listOutDivRef.getElementsByTagName("div")[0];t===h.Column?i.style.height="100%":i.style.width="100%"},this.intersectionObserverCallback=e=>{var i,o;const{appMode:s,config:n}=this.props,r=this.listOutDivRef,{datasource:a}=this.state;this.setState({isScrollEnd:e}),this.isScrollEnd=e,!r||(null!==(o=null===(i=this.records)||void 0===i?void 0:i.length)&&void 0!==o?o:0)<1||n.pageStyle===l.Scroll&&this.queryStatus!==t.DataSourceStatus.Loading&&a&&(!window.jimuConfig.isInBuilder||s!==t.AppMode.Design&&e)&&this.isHasScrolled&&(this.isCurrentPageLastPage?e&&this.setState({scrollStatus:"end"}):(this.setState({page:this.state.page+1}),this.isSwitchPage=!0))},this.setListDivSize=()=>{var e;const t=this.listOutDivRef,i=(null==t?void 0:t.clientWidth)||null,o=(null==t?void 0:t.clientHeight)||null,s=(null===(e=this.listTopRightToolsDiv.current)||void 0===e?void 0:e.clientWidth)||0,n=(null==t?void 0:t.getBoundingClientRect())||null,r={clientWidth:i,clientHeight:o};this.setState({listDivSize:r,toolsDivWidth:s,listDivBoundRect:n})},this.getContentLayout=()=>{const{layoutId:e,browserSizeMode:i}=this.props,o=(0,t.getAppStore)().getState().appConfig,s=S.searchUtils.getWidgetIdThatUseTheLayoutId(o,e);return S.searchUtils.getContentLayoutInfosInOneSizeMode(o,s,t.LayoutItemType.Widget,i)},this.getContentLayoutSetting=()=>{var e,i,o,s,n;const r=(0,t.getAppStore)().getState().appConfig,{layouts:l}=r,a=this.getContentLayout(),d=null===(e=null==a?void 0:a[0])||void 0===e?void 0:e.layoutId,c=null===(i=null==a?void 0:a[0])||void 0===i?void 0:i.layoutItemId;return null===(n=null===(s=null===(o=null==l?void 0:l[d])||void 0===o?void 0:o.content)||void 0===s?void 0:s[c])||void 0===n?void 0:n.setting},this.getListMaxSize=()=>{var e,i,o,s,n;const{boundingBox:r,heightLayoutItemSizeModes:l,layoutId:a,appMode:d,pageMode:c}=this.props,u=l===S.LayoutItemSizeModes.Custom&&(null==r?void 0:r.height),h=this.getContentLayoutSetting(),p="auto"===(null===(e=null==h?void 0:h.autoProps)||void 0===e?void 0:e.width)||"auto"===(null==h?void 0:h.widthMode),g="auto"===(null===(i=null==h?void 0:h.autoProps)||void 0===i?void 0:i.height)||"auto"===(null==h?void 0:h.heightMode)||!h,m=c===t.PageMode.AutoScroll&&g?600:this.bodySize.clientHeight,f=d===t.AppMode.Design?m:this.bodySize.clientHeight,v=u?null==r?void 0:r.height:f,y=u&&!((null===(o=null==r?void 0:r.height)||void 0===o?void 0:o.includes)&&(null===(s=null==r?void 0:r.height)||void 0===s?void 0:s.includes("%")));let w=(0,t.Immutable)({maxWidth:this.bodySize.scrollWidth,maxHeight:v,maxSizeIsBodySize:!1});const b=(0,t.getAppStore)().getState().appConfig,{layouts:x}=b,I=null===(n=x[a])||void 0===n?void 0:n.type;if(I===t.LayoutType.ColumnLayout&&p&&(w=w.set("maxWidth",this.bodySize.clientWidth).set("maxSizeIsBodySize",!0)),"ROW"===I&&g&&!y){const e=d===t.AppMode.Design?m:this.bodySize.clientHeight,i=d!==t.AppMode.Design;w=w.set("maxHeight",e).set("maxSizeIsBodySize",i)}return w=w.set("maxHeight",this.initElementSize(w.maxHeight)),w=w.set("maxWidth",this.initElementSize(w.maxWidth)),w},this.initElementSize=e=>Number(e)?`${e}px`:"string"!=typeof e||(null==e?void 0:e.includes("px"))||(null==e?void 0:e.includes("rem"))?e:(null==e?void 0:e.includes("%"))?"100%":void 0,this.getRefreshLoadingClass=()=>{const{config:e,appMode:i}=this.props,{scrollBarOpen:o,layoutType:s}=e,n=window.jimuConfig.isInBuilder&&i===t.AppMode.Design;return!o||n?"":s===h.Column?"horizon-loading":"vertical-loading"},this.resetAutoRefreshTimes=(e,t=!1)=>{clearTimeout(this.resetAutoRefreshTime),e<=0&&clearInterval(this.autoRefreshLoadingTime),this.resetAutoRefreshTime=setTimeout((()=>{t&&e>0&&this.setState({autoRefreshLoadingString:this.formatMessage("lastUpdateAFewTime")}),this.setState({showLoading:t})}),0)},this.setRefreshLoadingString=(e=!1)=>{if(!e)return!1;let t=0;clearInterval(this.autoRefreshLoadingTime),this.autoRefreshLoadingTime=setInterval((()=>{t++,this.setState({autoRefreshLoadingString:this.getLoadingString(t)})}),6e4)},this.getLoadingString=e=>{let t=this.formatMessage("lastUpdateAFewTime");return e>1&&e<=2?t=this.formatMessage("lastUpdateAMinute"):e>2&&(t=this.formatMessage("lastUpdateTime",{updateTime:e})),t},this.onItemsRendered=({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:i,visibleStopIndex:o,visibleColumnStartIndex:s,visibleColumnStopIndex:n,visibleRowStartIndex:r,visibleRowStopIndex:a})=>{const{config:d}=this.props;this.listVisibleStartIndex=(null==d?void 0:d.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(r,s):i,this.listVisibleStopIndex=(null==d?void 0:d.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(a,n):o,this.needRefreshListOnListRendered&&(this.needRefreshListOnListRendered=!1,this.refreshList()),this.isSwitchPage&&(d.pageStyle===l.Scroll?this.records.length>this.listVisibleStopIndex+1&&(this.isSwitchPage=!1,this.onItemsRenderedTimeout=setTimeout((()=>{this.handleScrollDown(null),this.isScrollToNextStep&&(this.isScrollToNextStep=!1)}),500)):this.isSwitchPage=!1)},this.getItemIndexByRowAndColumnIndex=(e,t)=>e*this.getItemColumnCount()+t,this.itemSize=e=>{const{config:t}=this.props,{currentCardSize:i}=this.state,o=(null==t?void 0:t.layoutType)===h.Column,s=(null==t?void 0:t.layoutType)===h.GRID?null==t?void 0:t.verticalSpace:null==t?void 0:t.space,n=i.width+s,r=i.height+s;return o?n:r},this.columnWidth=(e,t,i=0)=>t+i,this.rowHeight=(e,t,i=0)=>t+i,this.getItemsByRecords=e=>{const{config:t,selectionIsInSelf:i,selectionIsSelf:o,builderStatus:s}=this.props,{datasource:n,hoverIndex:r}=this.state,l=(n&&t.isItemStyleConfirm?n.getSelectedRecordIds():[]).map((e=>e+""));return e&&e.map(((e,a)=>{const d={hideCardTool:this.state.hideCardTool,selectionIsList:o,selectionIsInList:i,isEditing:this.isEditing(),builderStatus:s,lockItemRatio:t.lockItemRatio,changeIsResizingCard:this.changeIsResizingCard};return Object.assign(Object.assign({index:a,isHover:r===a,record:t.isItemStyleConfirm?e:void 0,active:!e.fake&&t.isItemStyleConfirm&&n&&l.includes(e.getId())},this.getOtherProps()),d)}))},this.getOtherProps=()=>{var e,t;const{config:o,theme:s,id:n,appMode:l,builderSupportModules:a,layouts:d,browserSizeMode:c,dispatch:u,isRTL:h}=this.props,{datasource:p}=this.state,g=(null===(t=null===(e=F(this.props))||void 0===e?void 0:e.width)||void 0===t?void 0:t.unit)===i.DistanceUnits.PERCENTAGE;return{browserSizeMode:c,space:o.space,isRTL:h,builderSupportModules:a,formatMessage:this.formatMessage,dispatch:u,widgetId:n,interact:window.jimuConfig.isInBuilder&&a.widgetModules.interact,selectCard:this.selectCard,handleResizeCard:this.handleResizeCard,appMode:l,onChange:this.handleItemChange,hoverLayoutOpen:o.cardConfigs[v.Hover].enable,selectable:o.cardConfigs[v.Selected].selectionMode!==r.None,direction:o.direction,theme:s,LayoutEntry:this.state.LayoutEntry,layouts:d,layoutType:null==o?void 0:o.layoutType,keepAspectRatio:null==o?void 0:o.keepAspectRatio,gridItemSizeRatio:null==o?void 0:o.gridItemSizeRatio,cardConfigs:o.cardConfigs,datasourceId:p&&p.id,updateCardToolPosition:this.updateCardToolPosition,isWidthPercentage:g,horizontalSpace:null==o?void 0:o.horizontalSpace}},this.itemRender=e=>{var i;const{appMode:o,config:s}=this.props;let n=e.style;const r=(null==e?void 0:e.columnIndex)||0,l=(null==e?void 0:e.rowIndex)||0,a=this.getItemRowCount(),d=this.getItemColumnCount(),c=(null==s?void 0:s.layoutType)===h.GRID?this.getItemIndexByRowAndColumnIndex(l,r):e.index,u=e.data,p=((null===(i=this.records)||void 0===i?void 0:i.length)||0)-1===c;let g;switch(null==s?void 0:s.layoutType){case h.Column:g={width:parseFloat(n.width)-s.space+"px",height:"100%"};break;case h.Row:g={width:"100%",height:parseFloat(n.height)-s.space+"px"};break;case h.GRID:g={height:parseFloat(n.height)-(null==s?void 0:s.verticalSpace)+"px",width:parseFloat(null==n?void 0:n.width)-(null==s?void 0:s.horizontalSpace)+"px"}}switch(null==s?void 0:s.layoutType){case h.Column:n=Object.assign(Object.assign({},n),{width:p?parseFloat(n.width)-s.space+"px":`${parseFloat(n.width)}px`});break;case h.Row:n=Object.assign(Object.assign({},n),{height:p?parseFloat(n.height)-s.space+"px":`${parseFloat(n.height)}px`});break;case h.GRID:n=Object.assign(Object.assign({},n),{height:a===l+1?parseFloat(n.height)-(null==s?void 0:s.verticalSpace)+"px":`${parseFloat(n.height)}px`,width:d===r+1?parseFloat(null==n?void 0:n.width)-(null==s?void 0:s.horizontalSpace)+"px":`${parseFloat(null==n?void 0:n.width)}px`})}const m=0===c&&window.jimuConfig.isInBuilder&&o===t.AppMode.Design?le:ae;return(null==u?void 0:u.length)<c+1?null:(0,t.jsx)("div",{style:n},(0,t.jsx)(m,Object.assign({listStyle:g,widgetId:this.props.id},u[c],{handleListMouseMove:this.handleListMouseMove,handleListMouseLeave:this.handleListMouseLeave,itemIdex:c})))},this.itemKey=e=>{const t=this.records[e];return`${(null==t?void 0:t.getId)&&(null==t?void 0:t.getId())||e}`},this.gridItemIndex=e=>{const{columnIndex:t,rowIndex:i}=e,o=this.getItemIndexByRowAndColumnIndex(i,t),s=this.records[o];return`${(null==s?void 0:s.getId)&&(null==s?void 0:s.getId())||o+100}`},this.getItemColumnCount=()=>{const{widgetRect:e,currentCardSize:t}=this.state,{config:i}=this.props;let n=e&&e.width||o;n-=s;const r=t.width+(null==i?void 0:i.horizontalSpace);return Math.floor((n-t.width)/r+1)||1},this.getItemRowCount=()=>Math.ceil(this.records.length/this.getItemColumnCount())||1,this.getListContentLeftPadding=()=>{const{widgetRect:e,currentCardSize:t}=this.state,{config:n}=this.props,r=e&&e.width||o,l=this.getItemColumnCount()*(t.width+(null==n?void 0:n.horizontalSpace))-(null==n?void 0:n.horizontalSpace);let a;switch(null==n?void 0:n.gridAlignment){case i.TextAlignValue.LEFT:a=0;break;case i.TextAlignValue.RIGHT:a=r-l-s;break;default:a=(r-l-s)/2}return(null==n?void 0:n.layoutType)===h.GRID&&a>0?a:0},this.onCreateDataSourceFailed=e=>{this.setState({createDataSourceFailed:!0})},this.renderWidgetPlaceholder=()=>(0,t.jsx)(i.WidgetPlaceholder,{icon:fi(),widgetId:this.props.id,message:""}),this.onListContainerMouseMove=()=>{this.needAutoScrollToSelectedItemWhenLoadPage&&this.records&&(this.needAutoScrollToSelectedItemWhenLoadPage=!1)},this.changeIsCanClickLink=()=>this.canClickLink,this.onDataSourceInfoChange=(e,t)=>{const{config:i,activeSort:o}=this.props;if(!(null==i?void 0:i.sortOpen)||o||"boolean"!=typeof o)return;const s=this.getOrderByFields(e),n=this.getOrderByFields(t);if(!this.checkIsOrderByFieldsChange(s,n))return;const r=s.filter((e=>!n.includes(e))),l=i.sorts.map((e=>{const t=w(i.sorts,!0,e.ruleOptionName,!0)[0];return{ruleOptionName:e.ruleOptionName,orderByFieldsItem:t}})),a=l.filter((e=>r.includes(e.orderByFieldsItem)));(null==a?void 0:a.length)>0?this.setState({sortOptionName:a[0].ruleOptionName,showSortString:!1}):this.setState({sortOptionName:null,showSortString:!0})},this.checkIsOrderByFieldsChange=(e=[],t=[])=>JSON.stringify(e)!==JSON.stringify(t),this.getOrderByFields=e=>{var t;if(!e)return[];let i=[];for(const o in null==e?void 0:e.widgetQueries){const s=(null===(t=e.widgetQueries[o])||void 0===t?void 0:t.orderByFields)||[];i=i.concat(s)}return Array.from(new Set(i))},this.onDsSelectionChange=e=>{const{datasource:t}=this.state;t&&this.scrollToSelectedItems(t)},this.checkIsQueryCount=e=>(null==e?void 0:e.showRecordCount)?null==e?void 0:e.showRecordCount:(null==e?void 0:e.pageStyle)===l.MultiPage&&!1===(null==e?void 0:e.hidePageTotal),this.checkIsShowMask=()=>{const{config:e,appMode:i,browserSizeMode:o,selectionIsInSelf:s,selectionIsSelf:n,builderStatus:r,layouts:l}=this.props,{forceShowMask:a}=this.state,d=(0,t.getAppStore)().getState().appConfig,c=window.jimuConfig.isInBuilder,u=null==d?void 0:d.layouts[S.searchUtils.findLayoutId((0,t.Immutable)(l[r]),o,d.mainSizeMode)],h=u&&u.type;return!(!c||i===t.AppMode.Run)&&(i===t.AppMode.Express?!e.isItemStyleConfirm&&h:a||!s&&!n||!e.isItemStyleConfirm&&h)};const{config:n}=e;this.paginatorDiv=t.React.createRef(),this.listTopRightToolsDiv=t.React.createRef();const a={LayoutEntry:null,page:1,sortOptionName:n.sorts&&n.sorts[0]&&n.sorts[0].ruleOptionName,currentCardSize:B(e,_(e)),forceShowMask:!1,widgetRect:_(e),showList:!0,searchText:"",currentFilter:void 0,filterApplied:!1,showSelectionOnly:!1,hideCardTool:!1,scrollStatus:"start",datasource:void 0,hoverIndex:-1,isScrolling:!1,isScrollSpeedOver:!1,isResizingCard:!1,searchSuggestion:[],isSearchBoxVisible:!1,isOpenTopToolsPopper:!1,latestUpdateTime:0,showLoading:!1,autoRefreshLoadingString:"",listDivSize:{clientWidth:null,clientHeight:null},toolsDivWidth:null,listDivBoundRect:null,isScrollEnd:!1,isMount:!1,createDataSourceFailed:!1,showSortString:!1};this.selectSelf=this.selectSelf.bind(this),this.handleResizeCard=this.handleResizeCard.bind(this),this.listRef=t.React.createRef(),window.jimuConfig.isInBuilder?a.LayoutEntry=this.props.builderSupportModules.LayoutEntry:a.LayoutEntry=S.LayoutEntry,this.state=a,this.onResize=this.onResize.bind(this),this.changeIsResizingCard=this.changeIsResizingCard.bind(this),this.setRefreshLoadingString=this.setRefreshLoadingString.bind(this),this.resetAutoRefreshTimes=this.resetAutoRefreshTimes.bind(this),this.debounceOnResize=t.lodash.debounce(((e,t)=>{this.onResize(e,t)}),100),this.debounceResetAfterIndices=t.lodash.debounce((()=>{this.resetAfterIndices()}),200)}componentDidMount(){const{dispatch:e,id:i}=this.props;this.setState({isMount:!0}),this.getBodySize(),window.addEventListener("resize",this.getBodySize),e(t.appActions.widgetStatePropChange(i,"listWidget",!0))}componentWillUnmount(){clearTimeout(this.resizeTimeout),clearTimeout(this.updateCardToolTimeout),clearTimeout(this.mouseClickTimeout),clearTimeout(this.suggestionsQueryTimeout),clearTimeout(this.showPopperTimeOut),clearTimeout(this.resetAutoRefreshTime),clearTimeout(this.setPageTimeout),clearTimeout(this.onItemsRenderedTimeout),clearInterval(this.autoRefreshLoadingTime)}componentDidUpdate(e,i){var o;const{config:s,appMode:n}=this.props,{datasource:l}=this.state;if(!window.jimuConfig.isInBuilder||n!==t.AppMode.Design){const e=s.cardConfigs[v.Selected].selectionMode!==r.None;l&&e&&this.scrollToSelectedItems(l)}this.updateListInBuilder(e,i),this.appModeChange(e),(null==e?void 0:e.selectionIsInSelf)!==(null===(o=this.props)||void 0===o?void 0:o.selectionIsInSelf)&&this.setSelectionStatus(),this.setListLayoutInWidgetState(),this.setListParentSizeInWidgetState(),this.updatePageWhenPrePageSizeChange(e.config)}selectSelf(){window.jimuConfig.isInBuilder&&this.props.builderSupportModules.widgetModules.selectSelf(this.props)}render(){const{config:e,id:o,appMode:s,queryObject:n,selectionIsInSelf:r,selectionIsSelf:l,useDataSources:d,activeSort:c}=this.props,{datasource:u,widgetRect:p,page:g,createDataSourceFailed:m,sortOptionName:f,searchText:v,filterApplied:S,currentFilter:y}=this.state,b=window.jimuConfig.isInBuilder,I=(0,t.classNames)("jimu-widget","widget-list","list-widget-"+o);if(!e.itemStyle)return(0,t.jsx)(i.WidgetPlaceholder,{widgetId:this.props.id,icon:a(70778),message:this.formatMessage("placeHolderTip")});const C=V(this.props,this.state),R=G(p,W(this.paginatorDiv.current,C),q(this.props)),T=(null==e?void 0:e.layoutType)===h.GRID?this.getItemColumnCount():null,O=U(p,R,this.props,T);this.pageSize=O;let L=function(e){var i;const o={returnGeometry:!0},{sortOptionName:s,searchText:n,currentFilter:r,filterApplied:l,datasource:a,config:d,useDataSources:c,pageSize:u,page:h,activeSort:p}=e,g=c&&c[0];if(!a||!g)return null;if(!a.query)return null;const m=w(d.sorts,d.sortOpen,s,p);if(m.length>0&&(o.orderByFields=m),d.filterOpen&&l&&d.filter&&r&&r.sql&&(o.where=r.sql,o.sqlExpression=r),d.searchOpen&&d.searchFields&&n){const e=t.dataSourceUtils.getSQL(n,null===(i=d.searchFields)||void 0===i?void 0:i.asMutable({deep:!0}),a,null==d?void 0:d.searchExact);if(o.where){const i=t.dataSourceUtils.getMergedSQLExpressions([o.sqlExpression.asMutable({deep:!0}),e],a);o.where=i.sql,o.sqlExpression=(0,t.Immutable)(i)}else o.where=e.sql,o.sqlExpression=(0,t.Immutable)(e)}return u>0&&(o.page=h,o.pageSize=u),o}({sortOptionName:f,searchText:v,currentFilter:y,filterApplied:S,datasource:u,config:e,pageSize:O,useDataSources:(0,t.Immutable)(d),page:g,activeSort:c});if(this.queryOptions=L,!function(e,i,o){return!!o&&(e=o.getRealQueryParams(e,"query"),i=o.getRealQueryParams(i,"query"),!(!e||!i)&&(delete e.page,delete e.pageSize,delete e.resultOffset,delete e.resultRecordCount,delete i.page,delete i.pageSize,delete i.resultOffset,delete i.resultRecordCount,t.utils.isDeepEqual(e,i)))}(L,this.lastQuery,u)&&u){const e=L;1!==g?(L=this.lastQuery,this.lastQuery=e,this.resetPage()):this.lastQuery=e}return(0,t.jsx)("div",{className:I,css:x(this.props,this.isEditing(),C),onPointerDown:e=>{b&&s===t.AppMode.Design&&!l&&!r&&this.handleListPointerDown(e)}},(0,t.jsx)("div",{className:"widget-list d-flex",onMouseMove:this.onListContainerMouseMove},(0,t.jsx)(M,{widgetId:o,appMode:s,linkParam:e.linkParam,queryObject:n,useDataSources:(0,t.Immutable)(d),changeIsCanClickLink:this.changeIsCanClickLink},this.isDsConfigured()?(0,t.jsx)(t.DataSourceComponent,{query:u?L:null,useDataSource:(0,t.Immutable)(d&&d[0]),onDataSourceCreated:this.onDSCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed,widgetId:this.props.id,queryCount:this.checkIsQueryCount(e),onDataSourceInfoChange:this.onDataSourceInfoChange,onSelectionChange:this.onDsSelectionChange},this.renderList):this.renderList(),!this.isHasRenderList&&!m&&(0,t.jsx)("div",{className:"list-loading-con w-100 h-100"},(0,t.jsx)("div",{className:"jimu-secondary-loading"})),m&&(0,t.jsx)("div",{className:"list-error-con position-relative w-100 h-100"},this.renderWidgetPlaceholder(),(0,t.jsx)(i.Alert,{className:"position-absolute alert-panel-of-list",type:"warning",withIcon:!0,text:this.formatMessage("dataSourceCreateError")})))),this.checkIsShowMask()&&(0,t.jsx)("div",{className:"list-with-mask"}),(0,t.jsx)(t.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize}))}}ki.versionManager=Yt,ki.mapExtraStateProps=(e,i)=>{var o,s,n,r,l,a,d,c,u,h,p,g,m,f,y,w,b,x,I,C,R,T,M,O;const L=e&&e.appConfig,{layouts:j,layoutId:z,layoutItemId:P,builderSupportModules:k,id:D}=i,N=e&&e.browserSizeMode,A=e&&e.widgetsState&&e.widgetsState[i.id]&&e.widgetsState[i.id].builderStatus||v.Default;let E;if(L){const i=L&&e.appConfig.layouts&&e.appConfig.layouts[S.searchUtils.findLayoutId((0,t.Immutable)(j[A]),N,L.mainSizeMode)];E=i&&i.type}const B=null===(o=L.layouts)||void 0===o?void 0:o[z],$=null===(n=null===(s=null==B?void 0:B.content)||void 0===s?void 0:s[P])||void 0===n?void 0:n.setting,_=(null===(r=null==$?void 0:$.autoProps)||void 0===r?void 0:r.height)===S.LayoutItemSizeModes.Auto||!0===(null===(l=null==$?void 0:$.autoProps)||void 0===l?void 0:l.height),F=(null===(a=null==$?void 0:$.autoProps)||void 0===a?void 0:a.width)===S.LayoutItemSizeModes.Auto||!0===(null===(d=null==$?void 0:$.autoProps)||void 0===d?void 0:d.width);let H;if(window.jimuConfig.isInBuilder){const e=null===(p=null===(h=null===(u=null===(c=L.layouts)||void 0===c?void 0:c[z])||void 0===u?void 0:u.content)||void 0===h?void 0:h[P])||void 0===p?void 0:p.bbox;H=e&&{left:e.left,top:e.top}}const U=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,W=U&&k&&k.widgetModules&&k.widgetModules.selectionInList(U,D,L,!1);let G;W&&(G=Object.keys(j).find((e=>S.searchUtils.findLayoutId((0,t.Immutable)(j[e]),N,L.mainSizeMode)===U.layoutId)));const V=!(!U||U.layoutId!==z||U.layoutItemId!==P),q=null===(g=null==e?void 0:e.appRuntimeInfo)||void 0===g?void 0:g.currentPageId,Q=null===(y=null===(f=null===(m=null==e?void 0:e.appConfig)||void 0===m?void 0:m.pages)||void 0===f?void 0:f[q])||void 0===y?void 0:y.mode;return{selectionIsSelf:V,selectionIsInSelf:!!W,selectionStatus:G,appMode:null===(w=null==e?void 0:e.appRuntimeInfo)||void 0===w?void 0:w.appMode,browserSizeMode:e&&e.browserSizeMode,builderStatus:e&&e.widgetsState&&e.widgetsState[i.id]&&e.widgetsState[i.id].builderStatus||v.Default,showLoading:null===(x=null===(b=null==e?void 0:e.widgetsState)||void 0===b?void 0:b[i.id])||void 0===x?void 0:x.showLoading,activeSort:null===(C=null===(I=null==e?void 0:e.widgetsState)||void 0===I?void 0:I[i.id])||void 0===C?void 0:C.activeSort,isRTL:e&&e.appContext&&e.appContext.isRTL,subLayoutType:E,left:H&&H.left,top:H&&H.top,isHeightAuto:_,isWidthAuto:F,queryObject:e.queryObject,boundingBox:null===(T=null===(R=null==B?void 0:B.content)||void 0===R?void 0:R[P])||void 0===T?void 0:T.bbox,heightLayoutItemSizeModes:null===(M=null==$?void 0:$.autoProps)||void 0===M?void 0:M.height,parentSize:(null===(O=e.widgetsState[i.id])||void 0===O?void 0:O.parentSize)||null,pageMode:Q}};const Di=ki;function Ni(e){a.p=e}})(),d})())}}}));