System.register(["jimu-core","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-arcgis","jimu-ui","jimu-ui/advanced/style-setting-components","jimu-ui/basic/date-picker","jimu-core/react","jimu-core/dnd","jimu-ui/basic/color-picker"],(function(e,t){var a={},i={},s={},n={},o={},r={},l={},c={},u={},p={},d={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.ReactRedux=e.ReactRedux,a.TimezoneConfig=e.TimezoneConfig,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.dateUtils=e.dateUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.lodash=e.lodash,a.polished=e.polished},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){n.DataSourceSelector=e.DataSourceSelector},function(e){o.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Icon=e.Icon,r.Label=e.Label,r.NumericInput=e.NumericInput,r.Option=e.Option,r.Radio=e.Radio,r.Select=e.Select,r.Switch=e.Switch,r.Tooltip=e.Tooltip,r.defaultMessages=e.defaultMessages},function(e){l.DateUnitInput=e.DateUnitInput},function(e){c.DatePicker=e.DatePicker},function(e){u.default=e.default},function(e){p.interact=e.interact},function(e){d.ThemeColorPicker=e.ThemeColorPicker}],execute:function(){e((()=>{var e={15656:(e,t,a)=>{var i={"./style_classic.svg":50816,"./style_modern.svg":26805};function s(e){var t=n(e);return a(t)}function n(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}s.keys=function(){return Object.keys(i)},s.resolve=n,e.exports=s,s.id=15656},43673:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.182 9.727a1.91 1.91 0 1 0 0-3.818 1.91 1.91 0 0 0 0 3.818M7.3 7.182a3.183 3.183 0 1 0 0 1.273h1.4a3.183 3.183 0 1 0 0-1.273z" clip-rule="evenodd"></path></svg>'},72823:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 1C4.15 1 1 4.15 1 8s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7m1.167 11.667H6.834v-2.334h2.333zm-2.333-4.5V3.333h2.333v4.834z" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},80914:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m8 0 8 6-8 6-8-6zM1.887 6 8 10.82 14.113 6 8 1.18zM0 9.81.563 9 8 14.775 15.437 9l.563.81L8 16z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},50816:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA0IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA0IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04OCAyMkM4OCAyMC44OTU0IDg4Ljg5NTQgMjAgOTAgMjBIOTRDOTUuMTA0NiAyMCA5NiAyMC44OTU0IDk2IDIyQzk2IDIzLjEwNDYgOTUuMTA0NiAyNCA5NCAyNEg5MEM4OC44OTU0IDI0IDg4IDIzLjEwNDYgODggMjJaTTggMjFIMjJWMjNIOFYyMVpNOTQgNDZDOTIuODk1NCA0NiA5MiA0Ni44OTU0IDkyIDQ4QzkyIDQ5LjEwNDYgOTIuODk1NCA1MCA5NCA1MEM5NS4xMDQ2IDUwIDk2IDQ5LjEwNDYgOTYgNDhDOTYgNDYuODk1NCA5NS4xMDQ2IDQ2IDk0IDQ2Wk00NSA0NkM0My44OTU0IDQ2IDQzIDQ2Ljg5NTQgNDMgNDhDNDMgNDkuMTA0NiA0My44OTU0IDUwIDQ1IDUwQzQ2LjEwNDYgNTAgNDcgNDkuMTA0NiA0NyA0OEM0NyA0Ni44OTU0IDQ2LjEwNDYgNDYgNDUgNDZaTTQ5IDQ4QzQ5IDQ2Ljg5NTQgNDkuODk1NCA0NiA1MSA0NkM1Mi4xMDQ2IDQ2IDUzIDQ2Ljg5NTQgNTMgNDhDNTMgNDkuMTA0NiA1Mi4xMDQ2IDUwIDUxIDUwQzQ5Ljg5NTQgNTAgNDkgNDkuMTA0NiA0OSA0OFpNNTUgNDhDNTUgNDYuODk1NCA1NS44OTU0IDQ2IDU3IDQ2QzU4LjEwNDYgNDYgNTkgNDYuODk1NCA1OSA0OEM1OSA0OS4xMDQ2IDU4LjEwNDYgNTAgNTcgNTBDNTUuODk1NCA1MCA1NSA0OS4xMDQ2IDU1IDQ4Wk0xMCA0NkM4Ljg5NTQzIDQ2IDggNDYuODk1NCA4IDQ4QzggNDkuMTA0NiA4Ljg5NTQzIDUwIDEwIDUwQzExLjEwNDYgNTAgMTIgNDkuMTA0NiAxMiA0OEMxMiA0Ni44OTU0IDExLjEwNDYgNDYgMTAgNDZaTTkgMzBIMTBWMzRIOVYzMFpNMjMgMzJIMjRWMzRIMjNWMzJaTTM4IDMwSDM3VjM0SDM4VjMwWk01MSAzMkg1MlYzNEg1MVYzMlpNNjYgMzBINjVWMzRINjZWMzBaTTc5IDMySDgwVjM0SDc5VjMyWk05NCAzMEg5M1YzNEg5NFYzMFpNMTAuNSAzNkg5My41Qzk0Ljg4MDcgMzYgOTYgMzcuMTE5MyA5NiAzOC41Qzk2IDM5Ljg4MDcgOTQuODgwNyA0MSA5My41IDQxSDEwLjVDOS4xMTkyOSA0MSA4IDM5Ljg4MDcgOCAzOC41QzggMzcuMTE5MyA5LjExOTI5IDM2IDEwLjUgMzZaTTEwLjUgMzdDOS42NzE1NyAzNyA5IDM3LjY3MTYgOSAzOC41QzkgMzkuMzI4NCA5LjY3MTU3IDQwIDEwLjUgNDBIMjIuNDk4M0MyMS42Njk5IDQwIDIwLjk5ODMgMzkuMzI4NCAyMC45OTgzIDM4LjVDMjAuOTk4MyAzNy42NzE2IDIxLjY2OTkgMzcgMjIuNDk4MyAzN0gxMC41Wk05My41IDQwSDMxLjQ5NjlDMzIuMzI1MyA0MCAzMi45OTY5IDM5LjMyODQgMzIuOTk2OSAzOC41QzMyLjk5NjkgMzcuNjcxNiAzMi4zMjUzIDM3IDMxLjQ5NjkgMzdIOTMuNUM5NC4zMjg0IDM3IDk1IDM3LjY3MTYgOTUgMzguNUM5NSAzOS4zMjg0IDk0LjMyODQgNDAgOTMuNSA0MFoiIGZpbGw9IiM2QTZBNkEiLz4NCjwvc3ZnPg0K"},26805:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA0IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA0IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04MiAyMEM4MC44OTU0IDIwIDgwIDIwLjg5NTQgODAgMjJDODAgMjMuMTA0NiA4MC44OTU0IDI0IDgyIDI0SDg3Qzg4LjEwNDYgMjQgODkgMjMuMTA0NiA4OSAyMkM4OSAyMC44OTU0IDg4LjEwNDYgMjAgODcgMjBIODJaTTE4IDI3SDg2Qzg3LjY1NjkgMjcgODkgMjguMzQzMSA4OSAzMFY0NkM4OSA0Ny42NTY5IDg3LjY1NjkgNDkgODYgNDlIODNWNDZIODJWNDlINzNWNDFINzJWNDlINjNWNDZINjJWNDlINTNWNDFINTJWNDlINDNWNDhINDJWNDlIMzNWNDFIMzJWNDlIMjNWNDZIMjJWNDlIMThDMTYuMzQzMSA0OSAxNSA0Ny42NTY5IDE1IDQ2VjMwQzE1IDI4LjM0MzEgMTYuMzQzMSAyNyAxOCAyN1pNMTQgMzBDMTQgMjcuNzkwOSAxNS43OTA5IDI2IDE4IDI2SDg2Qzg4LjIwOTEgMjYgOTAgMjcuNzkwOSA5MCAzMFY0NkM5MCA0OC4yMDkxIDg4LjIwOTEgNTAgODYgNTBIMThDMTUuNzkwOSA1MCAxNCA0OC4yMDkxIDE0IDQ2VjMwWk0zNCAzMkMzNCAzMC4zNDMxIDM1LjM0MzEgMjkgMzcgMjlINDJDNDMuNjU2OSAyOSA0NSAzMC4zNDMxIDQ1IDMyVjQ0QzQ1IDQ1LjY1NjkgNDMuNjU2OSA0NyA0MiA0N0gzN0MzNS4zNDMxIDQ3IDM0IDQ1LjY1NjkgMzQgNDRWMzJaTTggMzRDOCAzMi44OTU0IDguODk1NDMgMzIgMTAgMzJDMTEuMTA0NiAzMiAxMiAzMi44OTU0IDEyIDM0QzEyIDM1LjEwNDYgMTEuMTA0NiAzNiAxMCAzNkM4Ljg5NTQzIDM2IDggMzUuMTA0NiA4IDM0Wk04IDQyQzggNDAuODk1NCA4Ljg5NTQzIDQwIDEwIDQwQzExLjEwNDYgNDAgMTIgNDAuODk1NCAxMiA0MkMxMiA0My4xMDQ2IDExLjEwNDYgNDQgMTAgNDRDOC44OTU0MyA0NCA4IDQzLjEwNDYgOCA0MlpNOTQgMzJDOTIuODk1NCAzMiA5MiAzMi44OTU0IDkyIDM0QzkyIDM1LjEwNDYgOTIuODk1NCAzNiA5NCAzNkM5NS4xMDQ2IDM2IDk2IDM1LjEwNDYgOTYgMzRDOTYgMzIuODk1NCA5NS4xMDQ2IDMyIDk0IDMyWk05NCA0MEM5Mi44OTU0IDQwIDkyIDQwLjg5NTQgOTIgNDJDOTIgNDMuMTA0NiA5Mi44OTU0IDQ0IDk0IDQ0Qzk1LjEwNDYgNDQgOTYgNDMuMTA0NiA5NiA0MkM5NiA0MC44OTU0IDk1LjEwNDYgNDAgOTQgNDBaTTE0IDIyQzE0IDIwLjg5NTQgMTQuODk1NCAyMCAxNiAyMEMxNy4xMDQ2IDIwIDE4IDIwLjg5NTQgMTggMjJDMTggMjMuMTA0NiAxNy4xMDQ2IDI0IDE2IDI0QzE0Ljg5NTQgMjQgMTQgMjMuMTA0NiAxNCAyMlpNNjAgMjFINDZWMjNINjBWMjFaIiBmaWxsPSIjNkE2QTZBIi8+DQo8L3N2Zz4NCg=="},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a},26245:e=>{"use strict";e.exports=p},68972:e=>{"use strict";e.exports=u},4108:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=r},13089:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=s},15562:e=>{"use strict";e.exports=l},54337:e=>{"use strict";e.exports=d},25938:e=>{"use strict";e.exports=c}},t={};function g(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,g),s.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var a in t)g.o(t,a)&&!g.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var m={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(m),g.d(m,{__set_webpack_public_path__:()=>Te,default:()=>fe});var e,t,a,i=g(79244),s=g(4108),n=g(79298),o=g(13089),r=g(62686),l=g(14321);!function(e){e.Classic="CLASSIC",e.Modern="MODERN"}(e||(e={})),function(e){e.Slowest="SLOWEST",e.Slow="SLOW",e.Medium="MEDIUM",e.Fast="FAST",e.Fastest="FASTEST"}(t||(t={})),function(e){e.instant="INSTANT",e.current="CURRENT",e.cumulatively="CUMULATIVE"}(a||(a={}));function c(e){return i.css`
    height: calc(100% - ${i.polished.rem(50)});
    overflow: auto;

    .date-label {
      color: ${e.ref.palette.neutral[1e3]};
    }
    .time-step-details {
      margin-top: 0.75rem !important;
    }
  `}function u(e){return i.css`
    &.show-disabled-mask {
      position: relative;
      overflow-y: hidden;
      .disabled-mask {
        position: absolute;
        top: 0;
        background-color: transparent;
        .mask-bg {
          width: 100%;
          height: 100%;
          background-color: #000;
          opacity: 0.5;
        }
        .alert-container {
          position: absolute;
          left: 10px;
          top: 16px;
        }
      }
    }

    .style-container{
      display: flex;
      justify-content: space-between;
      .jimu-btn {
        padding: 0;
        background: ${e.ref.palette.neutral[300]};
        &.active{
          background: ${e.ref.palette.neutral[300]};
          outline: 2px solid ${e.sys.color.primary.main};
        }
      }
    }
    .autoplay-label{
      color: ${e.ref.palette.neutral[900]};
    }

    .empty-placeholder {
      position: relative;
      overflow: hidden;
      .empty-placeholder-inner {
        position: absolute;
        top: 50%;
        width: 100%;
        transform: translateY(-50%);
        .empty-placeholder-text {
          color: ${e.ref.palette.neutral[1e3]};
          font-size: ${i.polished.rem(14)};
          margin: 1rem 1rem 0 1rem;
        }
        .empty-placeholder-icon {
          color: ${e.ref.palette.neutral[800]};
        }
      }
    }

    .honor-label {
      color: ${e.ref.palette.neutral[1100]};
    }
  `}function p(e){return i.css`
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: ${e}px;
  `}var d=g(15562),h=g(25938),y=g(68972),S=g(26245);const D=["year","month","day"],M=["hour","minute","second"],f=10,T=-59011488343e3,x=325036512e5,N="d/M/y",j="h:mm:ss a",v=[...D,...M];var w;!function(e){e[e.year=31536e3]="year",e[e.month=2592e3]="month",e[e.day=86400]="day",e[e.hour=3600]="hour",e[e.minute=60]="minute",e[e.second=1]="second"}(w||(w={}));const b={slowest:5e3,slow:4e3,medium:3e3,fast:2e3,fastest:1e3};function I(e){let a;const i=1e3*Math.ceil(e/1e3);return Object.keys(b).some((e=>b[e]===i&&(a=e.toUpperCase(),!0))),a||(i>b.slowest?a=t.Slowest:i<b.fastest&&(a=t.Fastest)),a}function C(e,a,s=!1){const{startTime:n,endTime:o,layerList:r,accuracy:l,stepLength:c}=e||{};let u;const{startTime:p,endTime:d}=function(e,t,a,i){let s=O(a),n=O(i,!1),o=null,r=null;if(!s||!n){const a=L(e,t);a&&(e=a);if(Object.keys(e).filter((t=>null===e[t])).length===Object.keys(e).length)return{startTime:s,endTime:n};Object.keys(e).forEach((t=>{var a,i;const l=e[t];if(!l)return;const c=l.getTimeInfo();if(!s){const e=null===(a=null==c?void 0:c.timeExtent)||void 0===a?void 0:a[0];o=o?Math.min(o,e):e}if(!n){const e=null===(i=null==c?void 0:c.timeExtent)||void 0===i?void 0:i[1];r=r?Math.max(r,e):e}})),s=s||o,n=n||r}return z(s,n,!0)}(a,r,n,o);if(!p||!d)return null;const g=E(p,d),m=g[0],h=A(p,d,m);if(e){u=(0,i.Immutable)(e);const t=!g.includes(l);t&&(u=u.set("accuracy",m)),c&&(t||w[c.unit]>w[m]||1e3*w[c.unit]*c.val>d-p)&&(u=u.set("stepLength",h))}else u=(0,i.Immutable)(function(e,a){return{layerList:null,startTime:{value:i.dateUtils.VirtualDateType.Min},endTime:{value:i.dateUtils.VirtualDateType.Max},timeDisplayStrategy:"CURRENT",dividedCount:null,accuracy:e,stepLength:a,speed:t.Medium}}(m,h));return s?(u=u.set("startTime",{value:p}).set("endTime",{value:d}),u):(0,i.Immutable)({config:u,exactStartTime:p,exactEndTime:d,minAccuracy:m,accuracyList:g})}function A(e,t,a){const i=(t-e)/1e3/w[a];return{val:i>15?f:i>10?5:1,unit:a}}function O(e,t=!0){let a=null;if(e)if("number"==typeof e.value)a=e.value;else{const s=new Date;s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0),e.value===i.dateUtils.VirtualDateType.Today?(s.setHours(0),a=s.getTime()+k(e),a=t?a:a+1e3*w.day):e.value===i.dateUtils.VirtualDateType.Now&&(a=s.getTime()+k(e),a=t?a:a+1e3*w.hour)}return a}function k(e){return e.offset?e.offset.val*w[e.offset.unit]*1e3:0}function L(e,t){let a=null;const s=Object.keys(e).map((t=>e[t]))[0];if((null==s?void 0:s.type)===r.ArcGISDataSourceTypes.WebMap){const e=[];s.getAllChildDataSources().forEach((t=>{(t.type===i.DataSourceTypes.MapService||t.type===i.DataSourceTypes.SubtypeGroupLayer||t.type===i.DataSourceTypes.ImageryLayer||t.type===i.DataSourceTypes.ImageryTileLayer||t.type===i.DataSourceTypes.FeatureLayer&&null===i.dataSourceUtils.findMapServiceDataSource(t))&&t.supportTime()&&e.push(t)}));const n=(null==t?void 0:t.map((e=>e.dataSourceId)))||[];a={},e.forEach((e=>{(0===n.length||n.includes(e.id))&&(a[e.id]=e)}))}return a}function z(e,t,a=!1){let s;if(s=window.jimuConfig.isBuilder?(0,i.getAppStore)().getState().appStateInBuilder.appConfig.attributes.timezone:(0,i.getAppStore)().getState().appConfig.attributes.timezone,(null==s?void 0:s.type)===i.TimezoneConfig.Specific){const n=i.dataSourceUtils.getTimeZoneOffsetByName(s.value),o=i.dataSourceUtils.getLocalTimeOffset();a?(e=e-o+n,t=t-o+n):(e=e+o-n,t=t+o-n)}return{startTime:e,endTime:t}}function E(e,t){const a=[...D,...M],i=[],s=t-e;return a.forEach((e=>{s>=1e3*w[e]&&i.push(e)})),i}function Q(e){return e===i.DataSourceTypes.FeatureLayer||e===i.DataSourceTypes.ImageryLayer||e===i.DataSourceTypes.ImageryTileLayer||e===i.DataSourceTypes.SubtypeGroupLayer}function R(e,t,a,i){let s=0;t[0]!==a&&(s=e/((t[1]-t[0])/(a-t[0])),s<0&&(s=0));let n=e/((t[1]-t[0])/(i-a));return n<=2&&(n=2),{marginLeft:s+"px",width:n+"px"}}function U(e,t,a,i,s,n){let o=e,r=t;const l=(a[1]-a[0])/i*s;return n.edges.left?(o=e-l,o=Math.max(T,o)):(r=t+l,r=Math.min(x,r)),{newStart:o,newEnd:r}}var W=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const P=[{name:"offset",options:{offset:[0,10]}}],V=function(e){const{width:t,isRTL:a,shadowHeight:s,extent:n,intl:o,onChange:r}=e,c=W(e,["width","isRTL","shadowHeight","extent","intl","onChange"]),{startValue:u,endValue:p}=c,[d,g]=i.React.useState([u,p]),[m,h]=i.React.useState(null),y=i.React.useRef(null),D=i.React.useRef(null),M=i.React.useRef(null);i.React.useEffect((()=>{const e=i.lodash.debounce((()=>{m&&m.unset(),y.current&&h(function(e,t,a,i,s,n,o,r){let l,c,u;const p=i-a;return e(t).resizable({edges:{left:".resize-left",right:".resize-right"}}).on("resizestart",(e=>{e.stopPropagation(),l=0;const a=t.getBoundingClientRect();c=a.width,u=parseFloat(t.style.marginLeft.split("px")[0]),t.style.minWidth="0px"})).on("resizemove",(e=>{e.stopPropagation();const r=e.deltaRect;l+=r.width,e.edges.left?l>0?(a<=T&&(l=u),l=Math.min(u+20,l)):l=Math.max(20-c,l):e.edges.right&&(l>0?(i>=x&&(l=n-u-c),l=Math.min(n-u-c+20,l)):l=Math.max(20-c,l));const d=p&&c+l;e.edges.left&&(t.style.marginLeft=u-l+"px"),t.style.width=d+"px";const g=U(a,i,s,n,l,e);o([g.newStart,g.newEnd])})).on("resizeend",(e=>{e.stopPropagation();const t=U(a,i,s,n,l,e);r(t.newStart,t.newEnd)}))}(S.interact,y.current,d[0],d[1],n,t,g,r))}),50);e()}),[n]),i.React.useEffect((()=>{function e(e){e.edges={left:!0},f(e)}function t(e){e.edges={right:!0},f(e)}return D.current.addEventListener("keyup",e,!0),M.current.addEventListener("keyup",t,!0),()=>{D.current&&M.current&&(D.current.removeEventListener("keyup",e,!0),M.current.removeEventListener("keyup",t,!0))}}),[]);const f=i.hooks.useEventCallback((e=>{if(e.key.includes("Arrow")){let a="ArrowLeft"===e.key||"ArrowTop"===e.key?5:-5;e.edges.right&&(a=-a);const i=U(u,p,n,t,a,e);r(i.newStart,i.newEnd)}}));i.React.useEffect((()=>{g([u,p])}),[u,p]);const v=i.React.useMemo((()=>R(t,n,d[0],d[1])),[t,n,d]),w=i.React.useMemo((()=>i.dateUtils.formatDateLocally(d[0],o,N,j)),[o,d]),b=i.React.useMemo((()=>i.dateUtils.formatDateLocally(d[1],o,N,j)),[o,d]);return(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)("span",{className:"range-shadow",css:i.css`
          left: ${a?"unset":v.marginLeft};
          right: ${a?v.marginLeft:"unset"};
          width: ${v.width};
          height: ${s+"px"};
        `}),(0,i.jsx)("div",{className:"layer-line extent-line",style:{width:t}},(0,i.jsx)("div",{className:"resize-handlers",ref:e=>{y.current=e},style:v},(0,i.jsx)(l.Tooltip,{placement:"bottom",modifiers:P,title:w},(0,i.jsx)("button",{className:"resize-handler resize-left",ref:e=>{D.current=e}})),(0,i.jsx)(l.Tooltip,{placement:"bottom",modifiers:P,title:b},(0,i.jsx)("button",{className:"resize-handler resize-right",ref:e=>{M.current=e}})))))};var B=g(80914),F=g.n(B),Y=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const J=e=>{const t=window.SVG,{className:a}=e,s=Y(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return t?i.React.createElement(t,Object.assign({className:n,src:F()},s)):i.React.createElement("svg",Object.assign({className:n},s))};var $=g(43673),Z=g.n($),G=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const H=e=>{const t=window.SVG,{className:a}=e,s=G(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return t?i.React.createElement(t,Object.assign({className:n,src:Z()},s)):i.React.createElement("svg",Object.assign({className:n},s))};function _(e){const t=(0,i.getAppStore)().getState().appContext.isRTL;return i.css`
    .layer-lines{
      position: relative;

      .range-shadow {
        margin-left: ${t?"unset":"30px"};
        margin-right: ${t?"30px":"unset"};
        position: absolute;
        top: 0;
        z-index: -1;
        background: linear-gradient(0deg, #010101 0%, rgba(1, 1, 1, 0) 100%);
      }
      .layer-line-container {
        margin-bottom: 0.25rem;
        .layer-icon {
          margin-right: ${i.polished.rem(14)};
        }
        .layer-line, .extent-line {
          height: 2px;
        }
        .layer-line {
          background: ${e.ref.palette.neutral[900]};
          .jimu-btn {
            margin-left: 1rem;
          }
        }
      }
      .extent-line {
        background: ${e.ref.palette.neutral[700]};
        .resize-handlers {
          background: ${e.sys.color.primary.light};
          height: 2px;
          display: flex;
          justify-content: space-between;
          .resize-handler {
            min-width: 10px;
            width: 10px;
            height: 10px;
            border-radius: 10px;
            overflow: visible;
            margin-top: -5px;
            padding: 0;
            border: none;
            background: ${e.ref.palette.neutral[500]};
            border: 2px solid ${e.sys.color.primary.light};
          }
        }
      }
    }
  `}const q=function(e){const{startTime:t,endTime:a,theme:s,intl:n,overallExtentLabel:o,width:r=188,dataSources:c,onChange:u}=e,[p,d]=y.default.useState(null),[g,m]=y.default.useState(null),[h,S]=y.default.useState(null),D=(0,i.getAppStore)().getState().appContext.isRTL;y.default.useEffect((()=>{g&&f()}),[t,a]),y.default.useEffect((()=>{M()}),[c]);const M=()=>{let e=null,t=null;const a=[];Object.keys(c).forEach((s=>{var o,r;const l=c[s],u=l.getTimeInfo(),p=null===(o=null==u?void 0:u.timeExtent)||void 0===o?void 0:o[0],d=null===(r=null==u?void 0:u.timeExtent)||void 0===r?void 0:r[1];a.push({label:l.getLabel(),extent:[p,d],extentLabels:[i.dateUtils.formatDateLocally(p,n,N,j),i.dateUtils.formatDateLocally(d,n,N,j)]}),e=e?Math.min(e,p):p,t=t?Math.max(t,d):d})),d(a),m([e,t]),f(e,t)},f=(e=g[0],i=g[1])=>{const s=t?Math.min(t,e):e,n=a?Math.max(a,i):i;S([s,n])};return(0,i.jsx)("div",{className:"time-span w-100",dir:"ltr",css:_(s)},(0,i.jsx)("div",{className:"layer-lines",css:i.css`
          height: ${20*(Object.keys(c).length+1)};
        `},null==p?void 0:p.map(((e,t)=>{const a=R(r,h,e.extent[0],e.extent[1]);return(0,i.jsx)("div",{className:"d-flex align-items-center layer-line-container",key:"layer-line-"+t},(0,i.jsx)(l.Tooltip,{placement:"bottom",title:(0,i.jsx)("div",{className:"p-2"},(0,i.jsx)("div",null,e.label),(0,i.jsx)("div",null,`${e.extentLabels[0]} - ${e.extentLabels[1]}`))},(0,i.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",className:"layer-icon p-0 border-0"},(0,i.jsx)(J,{size:12}))),(0,i.jsx)("div",{className:"layer-line",css:i.css`
                  margin-left: ${D?"unset":a.marginLeft};
                  margin-right: ${D?a.marginLeft:"unset"};
                  width: ${a.width};
                `}))})),(0,i.jsx)("div",{className:"d-flex align-items-center layer-line-container"},(0,i.jsx)(l.Tooltip,{placement:"bottom",title:o},(0,i.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",className:"layer-icon p-0"},(0,i.jsx)(H,{size:12}))),h&&(0,i.jsx)(V,{theme:s,width:r,isRTL:D,intl:n,shadowHeight:20*p.length+10,startValue:null!=t?t:h[0],endValue:null!=a?a:h[1],extent:h,onChange:(e,t)=>{u(e,t)}}))))};var K=g(45508),X=g.n(K),ee=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const te=e=>{const t=window.SVG,{className:a}=e,s=ee(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return t?i.React.createElement(t,Object.assign({className:n,src:X()},s)):i.React.createElement("svg",Object.assign({className:n},s))};var ae=g(72823),ie=g.n(ae),se=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const ne=e=>{const t=window.SVG,{className:a}=e,s=se(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return t?i.React.createElement(t,Object.assign({className:n,src:ie()},s)):i.React.createElement("svg",Object.assign({className:n},s))},oe=(0,i.Immutable)([i.AllDataSourceTypes.FeatureLayer,i.AllDataSourceTypes.ImageryLayer,i.AllDataSourceTypes.ImageryTileLayer,i.AllDataSourceTypes.SubtypeGroupLayer,i.AllDataSourceTypes.MapService]),re=[i.dateUtils.VirtualDateType.Min,i.dateUtils.VirtualDateType.Today,i.dateUtils.VirtualDateType.Now],le=[i.dateUtils.VirtualDateType.Max,i.dateUtils.VirtualDateType.Today,i.dateUtils.VirtualDateType.Now];class ce extends i.React.PureComponent{constructor(e){super(e),this.timeSpanChanged=(e,t)=>{const{config:a,dataSources:i,exactStartTime:s,exactEndTime:n}=this.props;let o;if(s!==e)o=a.set("startTime",{value:e}),this.checkIfDatesInvalid({value:e},!0);else{if(n===t)return;o=a.set("endTime",{value:t}),this.checkIfDatesInvalid({value:t},!1)}if(a.stepLength){const e=C(o,i).config;o=o.set("accuracy",e.accuracy).set("stepLength",e.stepLength)}this.props.onChange(o)},this.onTimeChanged=(e,t)=>{const{config:a,dataSources:s}=this.props,n={value:e};e===i.dateUtils.VirtualDateType.Today?n.offset={val:0,unit:"day"}:e===i.dateUtils.VirtualDateType.Now?n.offset={val:0,unit:"minute"}:"number"==typeof e&&(n.value=t?Math.max(T,e):Math.min(x,e));let o=a.set((t?"start":"end")+"Time",n);if(this.checkIfDatesInvalid(n,t),a.stepLength){const e=C(o,s).config;o=o.set("accuracy",e.accuracy).set("stepLength",e.stepLength)}this.props.onChange(o)},this.checkIfDatesInvalid=(e,t)=>{const{exactStartTime:a,exactEndTime:i}=this.props;let s=!0;const n=O(e,t);(t&&n>i||!t&&n<a)&&(s=!1),this.setState({isDateValid:s})},this.getOffsetUnits=e=>{let t;return t=e===i.dateUtils.VirtualDateType.Today?D:[...D,...M.filter((e=>"second"!==e))],t},this.onDateOffsetChanged=(e,t=!1)=>{const a=t?"startTime":"endTime",i=this.props.config.setIn([a,"offset"],e);this.checkIfDatesInvalid(i[a],t),this.props.onChange(i)},this.onAccuracyChanged=e=>{const{config:t,exactStartTime:a,exactEndTime:i,accuracyList:s}=this.props,n=e.target.value;let o=t.set("accuracy",n);if(t.stepLength&&s.indexOf(n)<s.indexOf(t.stepLength.unit)){const e=A(a,i,n);o=o.set("stepLength",e)}this.props.onChange(o)},this.onStepChecked=()=>{const{config:e,exactStartTime:t,exactEndTime:a}=this.props,i=A(t,a,e.accuracy);this.props.onChange(this.props.config.set("stepLength",i).set("dividedCount",null))},this.onDividedChecked=()=>{this.props.onChange(this.props.config.set("stepLength",null).set("dividedCount",5))},this.onStepLengthChanged=e=>{e.val=Math.round(e.val||1),this.props.onChange(this.props.config.set("stepLength",e).set("dividedCount",null))},this.onDividedCountChanged=e=>{e=e?Math.round(e):2,this.props.onChange(this.props.config.set("dividedCount",e).set("stepLength",null))},this.onSpeedChanged=e=>{const t=this.props.config.set("speed",e.target.value);this.props.onChange(t)},this.onChange=(e,t)=>{this.props.onChange(this.props.config.set(e,t))},this.getAllSupportedLayersFromMap=()=>{const{dataSources:e,dataSourceType:t,config:a}=this.props;return t===i.AllDataSourceTypes.WebMap?L(e,null==a?void 0:a.layerList):null},this.getSupportedLayerIdsFromMap=()=>{if(this.props.dataSourceType===i.AllDataSourceTypes.WebMap){const e=Object.keys(this.allSupportedLayers).map((e=>e));return(0,i.Immutable)(e)}return null},this.getSelectedDataSources=()=>{const{dataSources:e,dataSourceType:t,config:a}=this.props;let s={};return t===i.AllDataSourceTypes.WebMap?Object.keys(this.allSupportedLayers).forEach((e=>{(null===a.layerList||a.layerList.filter((t=>t.dataSourceId===e)).length>0)&&(s[e]=this.allSupportedLayers[e])})):s=e,s},this.getSelectedUseDataSources=()=>{var e;const{config:t,dataSourceType:a}=this.props;if(a===i.AllDataSourceTypes.WebMap){if(null!==t.layerList)return t.layerList;const a=[];return null===(e=Object.keys(this.allSupportedLayers))||void 0===e||e.forEach((e=>{var t,i;const s=this.allSupportedLayers[e];a.push({rootDataSourceId:null===(t=s.getRootDataSource())||void 0===t?void 0:t.id,dataSourceId:e,mainDataSourceId:null===(i=s.getMainDataSource())||void 0===i?void 0:i.id})})),(0,i.Immutable)(a)}return null},this.dataSourceChange=e=>{const t=C(null,L(this.props.dataSources,e)).config;this.props.onChange(t.set("layerList",e))},this.getDateValue=e=>e?("number"==typeof e&&(e=new Date(e)),e):null,this.isSelectionDisabled=()=>{const{layerList:e}=this.props.config;return null===e||e.length===this.state.supportedLayerIdsFromMap.length},this.getDsTimezone=()=>{const e=(0,i.getAppStore)().getState().appStateInBuilder.appConfig.attributes.timezone;return(null==e?void 0:e.type)===i.TimezoneConfig.Specific?e.value:null},this.allSupportedLayers=this.getAllSupportedLayersFromMap(),this.state={supportedLayerIdsFromMap:this.getSupportedLayerIdsFromMap(),selectedUseDataSources:this.getSelectedUseDataSources(),selectedDataSources:this.getSelectedDataSources(),isDateValid:e.exactStartTime<=e.exactEndTime}}componentDidUpdate(e,t){this.props.config.layerList!==e.config.layerList&&this.setState({selectedUseDataSources:this.getSelectedUseDataSources(),selectedDataSources:this.getSelectedDataSources()})}render(){const{i18nMessage:e,config:s,dataSourceType:r,intl:u,theme:g,exactStartTime:m,exactEndTime:y,accuracyList:S}=this.props,{supportedLayerIdsFromMap:D,selectedUseDataSources:M,selectedDataSources:f}=this.state,{startTime:T,endTime:x,accuracy:v,timeDisplayStrategy:b,stepLength:I,dividedCount:C,speed:A}=s,O="number"==typeof(null==T?void 0:T.value)?z(T.value,0,!0).startTime:null==T?void 0:T.value,k="number"==typeof(null==x?void 0:x.value)?z(0,x.value,!0).endTime:null==x?void 0:x.value,L=this.getDateValue(O),E=this.getDateValue(k),Q="string"==typeof(null==T?void 0:T.value)&&[i.dateUtils.VirtualDateType.Today,i.dateUtils.VirtualDateType.Now].includes(null==T?void 0:T.value),R="string"==typeof(null==x?void 0:x.value)&&[i.dateUtils.VirtualDateType.Today,i.dateUtils.VirtualDateType.Now].includes(null==x?void 0:x.value);return(0,i.jsx)("div",{className:"time-panel w-100 h-100",css:c(g)},r===i.AllDataSourceTypes.WebMap&&(0,i.jsx)(n.SettingSection,{className:"pt-0",title:(0,i.jsx)("span",{title:e("enableTimeAnimation")},e("enableTimeAnimation"))},(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(o.DataSourceSelector,{isMultiple:!0,"aria-label":e("enableTimeAnimation"),types:oe,useDataSources:M,mustUseDataSource:!0,disableDataView:!0,hideDataView:!0,closeDataSourceListOnChange:!0,disableRemove:()=>1===M.length,onChange:this.dataSourceChange,hideDs:e=>!D.includes(e.id),disableSelection:this.isSelectionDisabled})))),(0,i.jsx)(n.SettingSection,{role:"group",title:e("timeSpan"),"aria-label":e("timeSpan"),className:"border-0 "+(r!==i.AllDataSourceTypes.WebMap?"pt-0":"")},(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(q,{intl:u,theme:g,overallExtentLabel:e("overallTimeExtent"),dataSources:f,startTime:m,endTime:y,onChange:this.timeSpanChanged}))),(0,i.jsx)(n.SettingSection,{role:"group",title:e("startTime"),"aria-label":e("startTime"),className:"border-0 pt-0"},(0,i.jsx)(n.SettingRow,{className:"mt-2"},(0,i.jsx)(h.DatePicker,{style:{width:"226px"},"aria-label":e("startTime"),disablePortal:!1,selectedDate:L,format:"shortDateLongTime",runtime:!1,showDoneButton:!0,hideEmpty:!0,showTimeInput:!0,isTimeLong:!0,supportVirtualDateList:!0,virtualDateList:re,dataSourceTimezone:this.getDsTimezone(),onChange:e=>{this.onTimeChanged(e,!0)}})),"string"==typeof(null==T?void 0:T.value)&&T.value===i.dateUtils.VirtualDateType.Min&&(0,i.jsx)(n.SettingRow,{className:"mt-1 date-label"},i.dateUtils.formatDateLocally(m,u,N,j)),Q&&(0,i.jsx)(n.SettingRow,{"aria-label":e("offset"),label:(0,i.jsx)("div",{title:e("offset"),css:p(73)},e("offset"))},(0,i.jsx)(d.DateUnitInput,{style:{width:"125px"},step:1,value:T.offset,units:this.getOffsetUnits(T.value),onChange:e=>{this.onDateOffsetChanged(e,!0)}}))),(0,i.jsx)(n.SettingSection,{role:"group",title:e("endTime"),"aria-label":e("endTime"),className:"border-0 pt-0"},(0,i.jsx)(n.SettingRow,{className:"mt-2"},(0,i.jsx)(h.DatePicker,{style:{width:"226px"},"aria-label":e("endTime"),disablePortal:!1,selectedDate:E,format:"shortDateLongTime",runtime:!1,showDoneButton:!0,hideEmpty:!0,showTimeInput:!0,isTimeLong:!0,supportVirtualDateList:!0,virtualDateList:le,dataSourceTimezone:this.getDsTimezone(),onChange:e=>{this.onTimeChanged(e,!1)}})),"string"==typeof(null==x?void 0:x.value)&&x.value===i.dateUtils.VirtualDateType.Max&&(0,i.jsx)(n.SettingRow,{className:"mt-1 date-label"},i.dateUtils.formatDateLocally(y,u,N,j)),R&&(0,i.jsx)(n.SettingRow,{"aria-label":e("offset"),label:(0,i.jsx)("div",{title:e("offset"),css:p(73)},e("offset"))},(0,i.jsx)(d.DateUnitInput,{style:{width:"125px"},step:1,value:x.offset,units:this.getOffsetUnits(x.value),onChange:e=>{this.onDateOffsetChanged(e,!1)}})),!this.state.isDateValid&&(0,i.jsx)("div",{className:"d-flex mt-2 ml-1 mr-1",role:"alert","aria-live":"polite"},(0,i.jsx)(ne,{color:this.props.theme.sys.color.error.dark,className:"mr-2"}),(0,i.jsx)("div",{className:"flex-grow-1",style:{color:g.sys.color.error.dark}},e("timeWarning")))),(0,i.jsx)(n.SettingSection,{className:"pt-0",role:"group","aria-label":e("setMinTimeAccuracy")},(0,i.jsx)(n.SettingRow,{flow:"wrap",label:(0,i.jsx)("div",{className:"m-0 d-flex justify-content-between"},(0,i.jsx)("span",null,e("setMinTimeAccuracy")),(0,i.jsx)(l.Tooltip,{title:e("setMinTimeAccuracyTip"),showArrow:!0,placement:"left"},(0,i.jsx)(l.Button,{icon:!0,type:"tertiary",size:"sm",className:"ml-2 p-0",disableHoverEffect:!0,disableRipple:!0},(0,i.jsx)(te,null))))}),(0,i.jsx)(n.SettingRow,{className:"mt-1"},(0,i.jsx)(l.Select,{size:"sm","aria-label":e("setMinTimeAccuracy"),onChange:this.onAccuracyChanged,value:v},S.map((t=>(0,i.jsx)(l.Option,{key:t,value:t,active:t===v},e(t))))))),(0,i.jsx)(n.SettingSection,{role:"group",title:e("timeStep"),"aria-label":e("timeStep")},(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Label,{check:!0},(0,i.jsx)(l.Radio,{name:"time-step-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:!!I,onChange:this.onStepChecked}),e("lengthOfOneStep"))),I&&(0,i.jsx)(n.SettingRow,{className:"time-step-details"},(0,i.jsx)(d.DateUnitInput,{className:"w-100",min:1,step:1,value:I,units:S.filter((e=>w[e]>=w[v])),onChange:this.onStepLengthChanged})),(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Label,{check:!0},(0,i.jsx)(l.Radio,{name:"time-step-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:C>0,onChange:this.onDividedChecked}),e("totalTimeDividedIntoEqualSteps"))),C&&(0,i.jsx)(n.SettingRow,{className:"time-step-details",label:(0,i.jsx)("div",{title:e("count"),css:p(118)},e("count"))},(0,i.jsx)(l.NumericInput,{style:{width:"80px"},"aria-label":e("count"),size:"sm",min:2,showHandlers:!1,value:C,onAcceptValue:this.onDividedCountChanged}))),(0,i.jsx)(n.SettingSection,{role:"group",title:e("timeDisplay"),"aria-label":e("timeDisplay")},(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Tooltip,{placement:"bottom",title:e("showCurrentFeaturesTip"),describeChild:!0},(0,i.jsx)("label",null,(0,i.jsx)(l.Radio,{name:"time-display-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:b===a.instant,onChange:()=>{this.onChange("timeDisplayStrategy",a.instant)}}),e("showCurrentFeatures")))),(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Tooltip,{placement:"bottom",title:e("showCurrentWindowTip"),describeChild:!0},(0,i.jsx)("label",null,(0,i.jsx)(l.Radio,{name:"time-display-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:b===a.current,onChange:()=>{this.onChange("timeDisplayStrategy",a.current)}}),e("showCurrentWindow")))),(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Tooltip,{placement:"bottom",title:e("showDataCumulativelyTip"),describeChild:!0},(0,i.jsx)("label",null,(0,i.jsx)(l.Radio,{name:"time-display-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:b===a.cumulatively,onChange:()=>{this.onChange("timeDisplayStrategy",a.cumulatively)}}),e("showDataCumulatively"))))),(0,i.jsx)(n.SettingSection,{title:e("defaultPlaySpeed")},(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Select,{size:"sm",onChange:this.onSpeedChanged,value:A,"aria-label":e("defaultPlaySpeed")},[t.Slowest,t.Slow,t.Medium,t.Fast,t.Fastest].map((t=>(0,i.jsx)(l.Option,{key:t,value:t,active:t===A},e(t.toLowerCase()))))))))}}var ue=g(31027),pe=g.n(ue),de=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const ge=e=>{const t=window.SVG,{className:a}=e,s=de(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return t?i.React.createElement(t,Object.assign({className:n,src:pe()},s)):i.React.createElement("svg",Object.assign({className:n},s))};var me=g(54337);class he extends i.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,i.jsx)(i.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var ye=function(e,t,a,i){return new(a||(a=Promise))((function(s,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function r(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};const Se=Object.assign({},{selectDataSourceLabel:"You can directly choose either one web map, or multiple layers including feature layers, map services, dynamic or tiled imagery layers, and subtype group layers. However, the data must be temporal to work. If the layers are not time-aware, they will not show in the select data panel.",selectDataSourceLabel1:"You can directly choose either one web map, or multiple layers including feature layers, map services, dynamic or tiled imagery layers, and subtype group layers. However, the data must be temporal to work. If the layers are not time-aware, they will not show in the select data panel.",selectDataSourceLabel2:"Alternatively, you can connect it directly with a map widget. The widget utilizes the data in this map widget. If there is no temporal data, the widget is unavailable to work.",addSourceByData:"Add web map or individual layers",addSourceByMapWidget:"Interact with a Map widget",noSupportedLayersInMapWidgetTip:"The selected Map widget does not contain any time-aware web map or web scene.",timeSetting:"Time settings",honorTimeSettings:"Synchronize with the time settings in the web map",customTimeSettings:"Customize time settings",configureTime:"Configure time",classicStyle:"Classic",modernStyle:"Modern",applyFilteringByDefault:"Apply timeline filtering by default",enableTimeAnimation:"Enable time animation for",timeSpan:"Time span",overallTimeExtent:"Overall time extent",startTime:"Start time",endTime:"End time",timeWarning:"The start time should be no later than the end time.",setMinTimeAccuracy:"Set the minimum time accuracy",setMinTimeAccuracyTip:"The minimum time accuracy represents the minimum time interval that users are allowed to see at runtime. If you set the time step based on defined length, you can move the slider by each minimum time accuracy.",timeDisplay:"Time display",showCurrentFeatures:"Show current features",showCurrentFeaturesTip:"Only display data at the current time instance.",showCurrentWindow:"Show current window",showCurrentWindowTip:"Only display data in the current time window.",showDataCumulatively:"Show data cumulatively",showDataCumulativelyTip:"Progressively display all data as time passes.",timeStep:"Time step",lengthOfOneStep:"Length of one step",totalTimeDividedIntoEqualSteps:"Total time divided into equal steps",defaultPlaySpeed:"Default play speed",displayAccuracy:"Display accuracy",timezoneWarning:"The Timeline widget is not available to use under the data time zone. Please change to the device or a specific time zone first."},l.defaultMessages),De=(0,i.Immutable)([i.AllDataSourceTypes.WebMap,i.AllDataSourceTypes.MapService,i.AllDataSourceTypes.FeatureLayer,i.AllDataSourceTypes.ImageryLayer,i.AllDataSourceTypes.ImageryTileLayer,i.AllDataSourceTypes.SubtypeGroupLayer]);class Me extends i.React.PureComponent{constructor(t){super(t),this.i18nMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Se[e]},t),this.updateConfigForOptions=(e,t)=>{const a={id:this.props.id,config:this.props.config.set(e,t)};this.props.onSettingChange(a)},this.dataSourceChange=e=>ye(this,void 0,void 0,(function*(){var t;let a=e,s=this.state.dataSources,n=this.props.config.set("timeSettings",null),o=n.dataSourceType;if(e.length<(null===(t=this.props.useDataSources)||void 0===t?void 0:t.length))delete s[this.props.useDataSources[this.props.useDataSources.length-1].dataSourceId],this.setState({dataSources:s}),0===a.length&&(n=n.set("honorTimeSettings",!0));else{const t=e[e.length-1],r=yield this.dsManager.createDataSourceByUseDataSource((0,i.Immutable)(t));let l=r.type===i.AllDataSourceTypes.WebMap&&n.honorTimeSettings;r.type===n.dataSourceType&&r.type!==i.AllDataSourceTypes.WebMap||(a=[t],o=r.type,s={},r.type!==n.dataSourceType&&r.type===i.AllDataSourceTypes.WebMap&&(l=!0)),s[t.dataSourceId]=r,this.setState({dataSources:s}),n=n.set("honorTimeSettings",l).set("dataSourceType",o)}this.props.onSettingChange({id:this.props.id,config:n,useDataSources:a})})),this.getTimeSettings=()=>C(this.props.config.timeSettings,this.state.dataSources),this.setHonorTimeSettings=()=>{const{id:e,config:t,onSettingChange:i}=this.props;if(t.honorTimeSettings){const s=function(e,t=!1){var i,s,n;let o=null;const l=e[Object.keys(e).filter((t=>e[t].type===r.ArcGISDataSourceTypes.WebMap))[0]],c=null===(n=null===(s=null===(i=null==l?void 0:l.getItemData())||void 0===i?void 0:i.widgets)||void 0===s?void 0:s.timeSlider)||void 0===n?void 0:n.properties;if(c){const{startTime:e,endTime:i,timeStopInterval:s,numberOfStops:n,thumbMovingRate:r,thumbCount:l}=c;let u=e,p=i;if(t){const t=z(e,i,!0);u=t.startTime,p=t.endTime}if(o={speed:I(r),layerList:null,startTime:{value:u},endTime:{value:p},timeDisplayStrategy:2===l?a.current:a.cumulatively},s){const e=function(e){switch(e){case"esriTimeUnitsMonths":return"month";case"esriTimeUnitsDays":return"day";case"esriTimeUnitsHours":return"hour";case"esriTimeUnitsMinutes":return"minute";default:return"year"}}(s.units);o.accuracy=e,o.stepLength={val:s.interval,unit:e}}else if(n){o.dividedCount=n;const e=E(u,p);o.accuracy=e[0];const t=(p-u)/n;e.some((e=>t>=1e3*w[e]&&(o.accuracy=e,!0)))}}return o}(this.state.dataSources);i({id:e,config:t.set("honorTimeSettings",!1).set("timeSettings",s)})}else i({id:e,config:t.set("honorTimeSettings",!0).set("timeSettings",null)})},this.enablePlayControl=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("enablePlayControl",t).set("autoPlay",!1)})},this.enableApplyFilteringByDefault=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("applyFilteringByDefault",t)})},this.enableDisplayAccuracy=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("enableDisplayAccuracy",t).set("displayAccuracy","second")})},this.onTimeSettingPanel=()=>{this.setState({isTimePanelOpen:!this.state.isTimePanelOpen})},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((a=>{const i=Object.assign({},a.dataSources);return i[e]=t,{dataSources:i}}))},this.isTimeExtentValid=()=>{let e=!1;return Object.keys(this.state.dataSources).some((t=>{var a;const s=this.state.dataSources[t];if((null==s?void 0:s.type)===i.AllDataSourceTypes.FeatureLayer){const t=null===(a=s.getTimeInfo())||void 0===a?void 0:a.timeExtent;if((null==t?void 0:t[0])&&(null==t?void 0:t[1])&&t[0]===t[1])return e=!0,!0}return!1})),e},this.hideDs=e=>{var t;let a=!1;const s=null===(t=this.dsManager)||void 0===t?void 0:t.getDataSource(e.id);if(Q(s.type))a=!s.supportTime()||null!==i.dataSourceUtils.findMapServiceDataSource(s);else if(s.type===i.AllDataSourceTypes.WebMap){a=0===(s.isDataSourceSet()&&s.getAllChildDataSources().filter((e=>(Q(e.type)||e.type===i.AllDataSourceTypes.MapService)&&e.supportTime()))).length}else a=!s.supportTime();return a},this.setSourceMode=e=>{const{id:t,config:a,onSettingChange:s}=this.props;s({id:t,useDataSources:[],config:a.set("addSourceByData",e).set("honorTimeSettings",!0).set("dataSourceType",i.AllDataSourceTypes.WebMap).set("timeSettings",null)})},this.onMapWidgetSelected=e=>ye(this,void 0,void 0,(function*(){this.props.onSettingChange({id:this.props.id,config:this.props.config.set("addSourceByData",!1),useMapWidgetIds:e})})),this.getSourceContent=(e,t,a)=>{var s,c;return(0,i.jsx)(n.SettingSection,{role:"group",className:t?"border-0":"","aria-label":this.i18nMessage("source"),title:(0,i.jsx)("div",{className:"d-flex justify-content-between"},(0,i.jsx)("div",null,this.i18nMessage("source")),(0,i.jsx)(l.Tooltip,{showArrow:!0,placement:"right",title:(0,i.jsx)("div",{css:i.css`
              width: 340px;
              margin: 0.75rem;
              font-size: 12px;
              line-height: 150%;
              font-style: normal;
            `},this.i18nMessage("selectDataSourceLabel1"),(0,i.jsx)("div",{className:"mt-2"},this.i18nMessage("selectDataSourceLabel2")))},(0,i.jsx)(l.Button,{icon:!0,type:"tertiary",size:"sm",className:"ml-2 p-0 jimu-outline-inside",disableHoverEffect:!0,disableRipple:!0},(0,i.jsx)(te,null))))},(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Label,{className:"source-label",check:!0},(0,i.jsx)(l.Radio,{name:"time-setting-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:e,onChange:e=>{this.setSourceMode(!0)}}),this.i18nMessage("addSourceByData"))),(0,i.jsx)(n.SettingRow,{className:"mt-2"},(0,i.jsx)(l.Label,{className:"source-label",check:!0},(0,i.jsx)(l.Radio,{name:"time-setting-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:!e,onChange:e=>{this.setSourceMode(!1)}}),this.i18nMessage("addSourceByMapWidget"))),(0,i.jsx)(n.SettingRow,null,e?(0,i.jsx)(o.DataSourceSelector,{hideAllOptionOfTypeDropdown:!0,isMultiple:!0,"aria-describedby":"timeline-ds-label timeline-blank-msg",types:De,useDataSources:a||(0,i.Immutable)([]),mustUseDataSource:!0,disableDataView:!0,hideDataView:!0,hideDs:this.hideDs,closeDataSourceListOnChange:!1,onChange:this.dataSourceChange}):(0,i.jsx)(n.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:this.props.useMapWidgetIds})),(null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length)>0&&(0,i.jsx)(n.SettingRow,{className:"mt-0"},(0,i.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null===(c=this.props.useMapWidgetIds)||void 0===c?void 0:c[0],onViewsCreate:this.onJimuViewsCreate}),!e&&this.state.noSupportedLayersInMapWidget&&(0,i.jsx)(l.Alert,{closable:!1,className:"w-100 mt-4",form:"basic",text:this.i18nMessage("noSupportedLayersInMapWidgetTip"),type:"warning",withIcon:!1})))},this.onJimuViewsCreate=e=>ye(this,void 0,void 0,(function*(){const t=Object.values(e),a=[];for(let e=0;e<t.length;e++){const s=t[e];if(!s.dataSourceId||a.length)continue;const n={dataSourceId:s.dataSourceId,mainDataSourceId:s.dataSourceId},o=(yield this.dsManager.createDataSourceByUseDataSource((0,i.Immutable)(n))).getAllChildDataSources().filter((e=>(Q(e.type)||e.type===i.AllDataSourceTypes.MapService)&&e.supportTime()));a.push(...o)}this.setState({noSupportedLayersInMapWidget:0===a.length})})),this.getPlaceholderContent=e=>{const{useDataSources:t,useMapWidgetIds:a}=this.props;let s="";return s=e?(null==t?void 0:t.length)>0?"":"selectDataPlaceholder":(null==a?void 0:a.length)>0?"":"selectMapHint",s?(0,i.jsx)("div",{className:"empty-placeholder w-100 flex-grow-1 text-center"},(0,i.jsx)("div",{className:"empty-placeholder-inner"},(0,i.jsx)("div",{className:"empty-placeholder-icon"},(0,i.jsx)(ge,{size:48})),(0,i.jsx)("div",{className:"empty-placeholder-text",id:"timeline-blank-msg"},this.i18nMessage(s)))):null},this.getTimeSettingsContent=e=>{const{honorTimeSettings:t,dataSourceType:a}=this.props.config;return e?(0,i.jsx)(n.SettingSection,{role:"group",title:this.i18nMessage("timeSetting"),"aria-label":this.i18nMessage("timeSetting")},a===i.AllDataSourceTypes.WebMap?(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Label,{className:"honor-label",check:!0},(0,i.jsx)(l.Radio,{name:"time-setting-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:t,onChange:this.setHonorTimeSettings}),this.i18nMessage("honorTimeSettings"))),(0,i.jsx)(n.SettingRow,{className:"mt-2"},(0,i.jsx)(l.Label,{className:"honor-label",check:!0},(0,i.jsx)(l.Radio,{name:"time-setting-radio",style:{cursor:"pointer"},className:"mr-2 align-text-bottom",checked:!t,onChange:this.setHonorTimeSettings}),this.i18nMessage("customTimeSettings")))):(0,i.jsx)(n.SettingRow,{className:"mt-2"},(0,i.jsx)(l.Label,{className:"honor-label",check:!0},this.i18nMessage("customTimeSettings"))),!t&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(n.SettingRow,{className:"mt-4"},(0,i.jsx)(l.Button,{className:"w-100",ref:e=>{this.timeSettingsRef=e},onClick:this.onTimeSettingPanel,disabled:0===Object.keys(this.state.dataSources).length||this.isTimeExtentValid()},(0,i.jsx)("div",{className:"w-100 px-2 text-truncate"},this.i18nMessage("configureTime")))),(0,i.jsx)(n.SettingRow,null,this.isTimeExtentValid()&&(0,i.jsx)(l.Alert,{open:!0,type:"warning",tabIndex:0,className:"w-100",text:"The time extent is not ready. Cannot configure time settings at this time."})))):null},this.updateStyle=e=>{this.updateConfigForOptions("timeStyle",e),this.props.offPanel||(0,s.getAppConfigAction)().editWidgetProperty(this.props.id,"offPanel",!0).exec()},this.getStylesContent=()=>{const{timeStyle:t}=this.props.config;return(0,i.jsx)(n.SettingSection,{role:"group",title:this.i18nMessage("style"),"aria-label":this.i18nMessage("style")},(0,i.jsx)(n.SettingRow,{className:"style-container"},[e.Classic,e.Modern].map(((e,a)=>{const s=e.toLowerCase();return(0,i.jsx)(l.Tooltip,{key:a,title:this.i18nMessage(`${s}Style`),placement:"bottom"},(0,i.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",active:e===t,"aria-pressed":e===t,onClick:()=>{this.updateStyle(e)}},(0,i.jsx)(l.Icon,{width:104,height:70,icon:g(15656)(`./style_${s}.svg`)})))}))))},this.getAppearanceContent=()=>{const{theme2:e,config:t}=this.props,a=this.i18nMessage("appearance"),s=this.i18nMessage("foregroundColor"),o=this.i18nMessage("backgroundColor"),r=this.i18nMessage("sliderColor");return(0,i.jsx)(n.SettingSection,{role:"group",title:a,"aria-label":a},(0,i.jsx)(n.SettingRow,{label:s},(0,i.jsx)(me.ThemeColorPicker,{"aria-label":s,specificTheme:e,value:t.foregroundColor,onChange:e=>{this.updateConfigForOptions("foregroundColor",e)}})),(0,i.jsx)(n.SettingRow,{label:o},(0,i.jsx)(me.ThemeColorPicker,{"aria-label":o,specificTheme:e,value:t.backgroundColor,onChange:e=>{this.updateConfigForOptions("backgroundColor",e)}})),(0,i.jsx)(n.SettingRow,{label:r},(0,i.jsx)(me.ThemeColorPicker,{"aria-label":r,specificTheme:e,value:t.sliderColor,onChange:e=>{this.updateConfigForOptions("sliderColor",e)}})))},this.getOptionsContent=()=>{const{enablePlayControl:e,autoPlay:t,enableDisplayAccuracy:a=!1,displayAccuracy:s="second",applyFilteringByDefault:o=!0}=this.props.config,r=this.i18nMessage("options"),c=this.i18nMessage("enablePlayControl"),u=this.i18nMessage("applyFilteringByDefault"),p=this.i18nMessage("displayAccuracy");return(0,i.jsx)(n.SettingSection,{role:"group",title:r,"aria-label":r},(0,i.jsx)(n.SettingRow,{label:c},(0,i.jsx)(l.Switch,{checked:e,onChange:this.enablePlayControl,"aria-label":c})),e&&(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Label,{className:"w-100 d-flex"},(0,i.jsx)(l.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:t,onChange:()=>{this.updateConfigForOptions("autoPlay",!t)}}),(0,i.jsx)("div",{className:"m-0 ml-2 flex-grow-1 autoplay-label"},this.i18nMessage("autoPlay")))),(0,i.jsx)(n.SettingRow,{label:u},(0,i.jsx)(l.Switch,{checked:o,onChange:this.enableApplyFilteringByDefault,"aria-label":u})),(0,i.jsx)(n.SettingRow,{label:p},(0,i.jsx)(l.Switch,{checked:a,onChange:this.enableDisplayAccuracy,"aria-label":p})),a&&(0,i.jsx)(n.SettingRow,null,(0,i.jsx)(l.Select,{size:"sm","aria-label":p,value:s,onChange:e=>{this.updateConfigForOptions("displayAccuracy",e.target.value)}},v.map((e=>(0,i.jsx)(l.Option,{key:e,value:e,active:e===s},this.i18nMessage(e)))))))},this.dsManager=i.DataSourceManager.getInstance(),this.state={isTimePanelOpen:!1,activeJimuMapViewId:"",dataSources:{},noSupportedLayersInMapWidget:!1}}componentDidUpdate(e,t){this.props.config.honorTimeSettings!==e.config.honorTimeSettings&&this.props.config.honorTimeSettings&&this.setState({isTimePanelOpen:!1})}render(){const{theme:e,config:t,useDataSources:a,intl:s,isTimeZoneData:o}=this.props,{honorTimeSettings:r,dataSourceType:c,addSourceByData:p=!window.isExpressBuilder}=t,d=this.getPlaceholderContent(p),g=null!==d;return(0,i.jsx)("div",{className:(0,i.classNames)("jimu-widget-setting widget-setting-timeline d-flex flex-column",{"show-disabled-mask":o}),css:u(e)},null==a?void 0:a.map(((e,t)=>(0,i.jsx)(he,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),this.getSourceContent(p,g,a),g?d:(0,i.jsx)(i.React.Fragment,null,this.getTimeSettingsContent(p),this.getStylesContent(),this.getAppearanceContent(),this.getOptionsContent(),!r&&(0,i.jsx)(n.SidePopper,{position:"right",title:this.i18nMessage("configureTime"),isOpen:this.state.isTimePanelOpen,trigger:this.timeSettingsRef,toggle:this.onTimeSettingPanel},Object.keys(this.state.dataSources).length===a.length&&(0,i.jsx)(ce,Object.assign({intl:s,theme:e,i18nMessage:this.i18nMessage,dataSources:this.state.dataSources,dataSourceType:c},this.getTimeSettings(),{onChange:e=>{this.updateConfigForOptions("timeSettings",e)}})))),o&&(0,i.jsx)("div",{className:"disabled-mask w-100 h-100"},(0,i.jsx)("div",{className:"mask-bg"}),(0,i.jsx)(l.Alert,{form:"basic",type:"warning",className:"alert-container"},this.i18nMessage("timezoneWarning"))))}}const fe=i.ReactRedux.connect(((e,t)=>{var a,s;return{isTimeZoneData:(null===(s=null===(a=e.appStateInBuilder.appConfig.attributes)||void 0===a?void 0:a.timezone)||void 0===s?void 0:s.type)===i.TimezoneConfig.Data}}))(Me);function Te(e){g.p=e}})(),m})())}}}));