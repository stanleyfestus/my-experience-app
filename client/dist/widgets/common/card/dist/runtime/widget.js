System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime"],(function(e,t){var o={},i={},s={};return{setters:[function(e){o.AnimationContext=e.AnimationContext,o.AppMode=e.AppMode,o.ExpressionResolverComponent=e.ExpressionResolverComponent,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.LinkType=e.LinkType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ReactResizeDetector=e.ReactResizeDetector,o.TransitionContainer=e.TransitionContainer,o.TransitionDirection=e.TransitionDirection,o.TransitionType=e.TransitionType,o.appActions=e.appActions,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.getAppStore=e.getAppStore,o.getNextAnimationId=e.getNextAnimationId,o.hooks=e.hooks,o.jimuHistory=e.jimuHistory,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){i.LinkTip=e.LinkTip,i.WidgetPlaceholder=e.WidgetPlaceholder,i._Link=e._Link,i.hooks=e.hooks,i.styleUtils=e.styleUtils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils}],execute:function(){e((()=>{var e={86800:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#FFF" fill-rule="nonzero" d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4M2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4"></path></svg>'},10527:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2zm.951-4v-2H5.817l-.578-1h8.81v3z" clip-rule="evenodd"></path></svg>'},73027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=s},14321:e=>{"use strict";e.exports=i}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var l={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(l),n.d(l,{Widget:()=>P,__set_webpack_public_path__:()=>H,default:()=>E});var e,t=n(79244),o=n(14321);!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(e||(e={}));t.TransitionType.None,t.TransitionDirection.Horizontal;var i,s,a,r;!function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10"}(i||(i={})),function(e){e.Default="DEFAULT",e.Hover="HOVER"}(s||(s={})),function(e){e.None="NONE",e.Default="DEFAULT",e.Hover="HOVER"}(a||(a={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(r||(r={}));var d=n(41496);class u extends t.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:o}=this.props,i=this.checkIsBackgroundTransparent(e);return t.css`
      & {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      .animation-list>div {
        overflow: hidden;
      }
      .card-editor-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      ${"&.card-"+o} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent !important;
      }
      .card-link {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      .clear-background:focus {
        outline: none;
      }
      .surface-1 {
        border: none !important;
        background: ${i&&"none !important"};
      }
      ${"&.card-"+o}:hover {
      }
    `}}checkIsBackgroundTransparent(e){var t,o,i;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(i=null===(o=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===o?void 0:o.background)||void 0===i?void 0:i.color)}}var c=n(73027),p=n.n(c),h=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const v=e=>{const o=window.SVG,{className:i}=e,s=h(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?t.React.createElement(o,Object.assign({className:n,src:p()},s)):t.React.createElement("svg",Object.assign({className:n},s))};var g=n(10527),y=n.n(g),f=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const m=e=>{const o=window.SVG,{className:i}=e,s=f(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?t.React.createElement(o,Object.assign({className:n,src:y()},s)):t.React.createElement("svg",Object.assign({className:n},s))};function I(e){const o=null==e?void 0:e.setIn(["boxShadow","color"],"transparent").asMutable({deep:!0}),i=(null==o?void 0:o.border)||{};return(null==i?void 0:i.color)||!(null==o?void 0:o.border)?e:(null==o||delete o.border,(0,t.Immutable)(Object.assign(Object.assign({},o),i)))}const S=[0,5],b=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],w=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}];const C=t.ReactRedux.connect(((e,o)=>{var i;const{appMode:s}=o;if(!window.jimuConfig.isInBuilder||s===t.AppMode.Run)return{selection:void 0};return{selection:o.selectionIsInCard&&(null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.selection)}}))(class extends u{constructor(i){super(i),this.lastResizeCall=null,this.handleCopyTo=(e,t,o,i)=>{if(!o)return;const{layouts:s,builderSupportModules:n,browserSizeMode:l,builderStatus:a}=this.props,r=n.jimuForBuilderLib;let u=r.getAppConfigAction(),c=u.appConfig;const p=d.searchUtils.findLayoutId(s[a],l,c.mainSizeMode),h=d.searchUtils.findLayoutId(s[t],l,c.mainSizeMode);if(i){const e=n.widgetModules.searchUtils,t=o.widgetId,i=c.widgets[t].parent[l],s=i.find((e=>e.layoutId===p)),a=i.find((e=>e.layoutId===h)),r=e.findLayoutItem(c,s);u.editLayoutItemProperty(a,"bbox",r.bbox).editLayoutItemProperty(a,"setting",r.setting)}else{const e=r.LayoutServiceProvider.getService(c,h).createBlankItem(c,h);c=e[0];const t=e[1],i={layoutId:h,layoutItemId:t},s=d.searchUtils.findLayoutItem(c,{layoutId:p,layoutItemId:o.id});c=r.widgetService.addParent(c,o.widgetId,i,l),u=r.getAppConfigAction(c),u.editLayoutItemProperty(i,"bbox",s.bbox).editLayoutItemProperty(i,"setting",s.setting).editLayoutItemProperty(i,"type",s.type).editLayoutItemProperty(i,"widgetId",s.widgetId).adjustOrderOfItem(i,-1)}this.setState({widgetsUpdate:Symbol()}),u.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,o)=>{const{dispatch:i,widgetId:s}=this.props;i(t.appActions.widgetStatePropChange(s,e,o))},this.toggleStatus=e=>{var o;const{cardConfigs:i}=this.props,n=null===(o=null==i?void 0:i.HOVER)||void 0===o?void 0:o.enable,l=e===s.Hover;let{previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u}=this.state;const c=e===s.Default&&1===r;(n||c)&&(a=l?0:1,r=l?1:0,d=l?(0,t.getNextAnimationId)():null,u=l?null:(0,t.getNextAnimationId)()),this.setState({previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u})},this.handleBreakLink=e=>{const{builderSupportModules:o,browserSizeMode:i,selection:s,builderStatus:n,dispatch:l,widgetId:a}=this.props,r=o.jimuForBuilderLib;let u=r.getAppConfigAction();const c=u.appConfig,p=d.searchUtils.findLayoutItem(c,s);if(!p)return;const h=c.widgets[a].layouts[n][i],v=u.duplicateLayoutItemInSameLayout({layoutId:h,layoutItemId:p.id});u.editLayoutItemProperty({layoutId:s.layoutId,layoutItemId:v},"bbox",p.bbox).removeLayoutItem({layoutId:h,layoutItemId:p.id},!1);const g=d.searchUtils.findLayoutItem(u.appConfig,{layoutId:h,layoutItemId:v}),y=new r.ContentServiceWrapper(u.appConfig,g);y.removeSizeModeParent(i),y.addParent({layoutId:h,layoutItemId:v},i),u=r.getAppConfigAction(y.getConfig()),s.layoutId===h&&s.layoutItemId===p.id&&l(t.appActions.selectionChanged(null));const f=u.appConfig.layouts[h].content,m=Object.keys(f)[Object.keys(f).length-1];if(m){const e=f[m];l(t.appActions.selectionChanged({layoutId:h,layoutItemId:e.id}))}u.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.initParentOfNewWidgetAfterIsolate=(e,t)=>{const{browserSizeMode:o}=this.props,i=e.parent[o],s=null==i?void 0:i.filter((e=>e.layoutId===t));return e.setIn(["parent",o],s)},this.getCopyDropdownItems=o=>{const{cardConfigs:i,layouts:n,browserSizeMode:l,selection:a,builderStatus:r,builderSupportModules:u}=this.props,c=u.jimuForBuilderLib.getAppConfigAction().appConfig,p=d.searchUtils.findLayoutItem(c,a);if(!a||!p||!window.jimuConfig.isInBuilder)return{items:(0,t.Immutable)([]),title:""};const h=[];let v="",g=!0,y=!0;const f=(e,o)=>u.widgetModules.searchUtils.getContentsInLayoutWithRecursiveLayouts(c,e,t.LayoutItemType.Widget,l).indexOf(o)>-1,m=()=>{const{cardLayout:t}=this.props;if(i[s.Hover]&&t!==e.AUTO){const e=d.searchUtils.findLayoutId(n[s.Hover],l,c.mainSizeMode);f(e,c.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(y=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,s.Hover,p,y)}})}},I=()=>{const{cardLayout:t}=this.props;if(t!==e.AUTO){const e=d.searchUtils.findLayoutId(n[s.Default],l,c.mainSizeMode);f(e,c.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(g=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("default").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,s.Default,p,g)}})}};return r===s.Default?(m(),v=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):r===s.Hover&&(I(),v=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()})),o?h.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):v=this.formatMessage("isolate"),{items:(0,t.Immutable)(h),title:v}},this.getCardToolsStyle=e=>t.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{builderSupportModules:e,selectionIsCard:o,selectionIsInCard:i,appMode:n,hideCardTool:l,cardConfigs:a}=this.props,{BuilderPopper:r,GLOBAL_RESIZING_CLASS_NAME:d,GLOBAL_H5_DRAGGING_CLASS_NAME:u,GLOBAL_DRAGGING_CLASS_NAME:c}=e.widgetModules;let p=!0;return(!i&&!o||n===t.AppMode.Run||l)&&(p=!1),this.props.isEditing&&a[s.Hover].enable&&(0,t.jsx)(r,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:t.css`
            .${c} &,
            .${d} &,
            .${u} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:S,modifiers:b,open:p},this.getCardMenuElement())},this.getCardMenuElement=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:e,widgetId:o,builderSupportModules:i,browserSizeMode:n,builderStatus:l,selectionIsCard:a}=this.props,r=i.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:d,BuilderDropDown:u,BuilderButton:c,withBuilderTheme:p}=i.widgetModules,h=a,g=!h&&e&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(r,e,o,n).length>1,{items:y,title:f}=this.getCopyDropdownItems(g),I=y&&y.length>0,S=p((e=>(0,t.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e)},(0,t.jsx)(c,{active:l===s.Default,onClick:e=>{this.handleBuilderStatusChange(e,s.Default)}},this.formatMessage("default")),(0,t.jsx)(c,{active:l===s.Hover,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,s.Hover)}},this.formatMessage("hover")),!h&&(I||g)&&(0,t.jsx)(u,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:f,toggleType:"default",direction:"left",toggleContent:e=>g?(0,t.jsx)(v,{size:16}):(0,t.jsx)(m,{size:16}),modifiers:w,items:y}))));return(0,t.jsx)(S,null)},this.getEditorStyle=()=>t.css`
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{const{cardConfigs:i,LayoutEntry:n,layouts:l,browserSizeMode:a,cardLayout:r}=this.props,{hoverPlayId:d,regularPlayId:u}=this.state,c=l[s.Default],p=r===e.AUTO?c:l[s.Hover],h=I(i[s.Default].backgroundStyle),v=I(i[s.Hover].backgroundStyle),g=i.transitionInfo,y=[],f=Object.assign({},o.styleUtils.toCSSStyle(h||{})),m=(0,t.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.regularLayoutRef,key:s.Default},(0,t.jsx)("div",{className:"w-100, h-100 animation-list",style:f},(0,t.jsx)(t.AnimationContext.Provider,{value:{setting:(null==g?void 0:g.oneByOneEffect)||null,playId:u,oid:c[a]}},(0,t.jsx)(n,{className:"h-100",isRepeat:!0,layouts:c,isInWidget:!0}))));if(y.push(m),!i[s.Hover].enable)return y;const S=Object.assign({},o.styleUtils.toCSSStyle(v||{})),b=r===e.AUTO&&i[s.Hover].enable,w=(0,t.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.hoverLayoutRef,key:s.Hover},(0,t.jsx)("div",{className:"w-100, h-100 animation-list position-relative",style:S},(0,t.jsx)(t.AnimationContext.Provider,{value:{setting:(null==g?void 0:g.oneByOneEffect)||null,playId:d,oid:null==p?void 0:p[a]}},(0,t.jsx)(n,{className:"h-100",isRepeat:!0,layouts:p,isInWidget:!0})),b&&(0,t.jsx)("div",{className:"card-editor-mask position-absolute"})));return y.push(w),y},this.getCardStyle=()=>{var e,t,i,n;const{builderStatus:l,cardConfigs:a}=this.props,r=a[s.Hover].enable?l:s.Default,d={boxShadow:null===(t=null===(e=a[r])||void 0===e?void 0:e.backgroundStyle)||void 0===t?void 0:t.boxShadow,borderRadius:null===(n=null===(i=a[r])||void 0===i?void 0:i.backgroundStyle)||void 0===n?void 0:n.borderRadius};return Object.assign({},o.styleUtils.toCSSStyle(d))},this.state={didMount:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null,widgetsUpdate:null},this.regularLayoutRef=t.React.createRef(),this.hoverLayoutRef=t.React.createRef(),this.layoutRef=t.React.createRef(),this.isUpdateFirst=!0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(e){var t,o;const{cardConfigs:i,builderStatus:n}=this.props,l=e.cardConfigs,a=(null===(t=null==l?void 0:l.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(o=null==i?void 0:i.transitionInfo)||void 0===o?void 0:o.previewId),r=e.builderStatus&&e.builderStatus!==n&&!this.isUpdateFirst,d=l[s.Hover].enable!==i[s.Hover].enable;(!a||r||d)&&this.toggleStatus(n),this.isUpdateFirst&&(this.isUpdateFirst=!1)}handleBuilderStatusChange(e,t){var o;this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t),null===(o=null==this?void 0:this.props)||void 0===o||o.selectSelf(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var e,o;const{cardConfigs:i,widgetId:s,isShowMask:n,builderStatus:l,selectionIsCard:a,selectionIsInCard:r}=this.props,{didMount:d,previousIndex:u,currentIndex:c}=this.state,p=i.transitionInfo,h=`card-${s}`,v=(a||r?null==p?void 0:p.previewId:null)||null;return(0,t.jsx)("div",{css:this.getStyle(l),style:this.getCardStyle(),className:h},d&&this.renderCardTools(),(0,t.jsx)("div",{className:"w-100, h-100",ref:this.layoutRef},(0,t.jsx)(t.TransitionContainer,{previousIndex:u,currentIndex:c,transitionType:null===(e=null==p?void 0:p.transition)||void 0===e?void 0:e.type,direction:null===(o=null==p?void 0:p.transition)||void 0===o?void 0:o.direction,playId:d?v:null,withOneByOne:!!(null==p?void 0:p.oneByOneEffect)},this.renderCardEditor())),n&&(0,t.jsx)("div",{className:"edit-mask position-absolute"}))}}),{useRef:x,useState:L}=t.React,j=e=>{var i;const{useDataSources:s,appMode:n,linkParam:l,widgetId:a,queryObject:r,children:d,changeIsCanClickLink:u}=e,c=x(null),p=x(null),h=t.React.useContext(t.jimuHistory.HistoryContext),[v,g]=L(!1),[y,f]=L(null),m=o.hooks.useApplyLinkResult(),I=()=>{clearTimeout(p.current),g(!0),setTimeout((()=>{g(!1)}),3e3)},S=()=>{var e,o;let i=!1;return(null==l?void 0:l.linkType)===t.LinkType.WebAddress&&(l.value?i=t.urlUtils.isAbsoluteUrl(l.value):(null===(e=null==l?void 0:l.expression)||void 0===e?void 0:e.name)&&(i=t.urlUtils.isAbsoluteUrl(null===(o=null==l?void 0:l.expression)||void 0===o?void 0:o.name))),i},b=e=>{const t=e.target;return w(t,e)||w(null==t?void 0:t.parentNode,e)},w=(e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),i=null==e?void 0:e.role,s=e&&e.tagName||"",n="button"===s.toLowerCase()||"button"===i,l="a"===s.toLowerCase()||"linkClick"===t.exbEventType,a="input"===s.toLowerCase()||"input"===i;return n||l||!!o&&o>-1||a},C=t.css`
    .list-clear-background {
      background: transparent !important;
    }
    .list-link {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
    }
  `,j=t.hooks.useEventCallback((e=>{const o=null==l?void 0:l.openType,i={linkType:null==l?void 0:l.linkType,value:null==l?void 0:l.value};let s=e;return(null==l?void 0:l.linkType)===t.LinkType.WebAddress&&(i.value=y||(null==i?void 0:i.value),s=void 0),{queryObject:s,target:o,linkTo:i}})),T=e=>{e.stopPropagation()};return(0,t.jsx)("div",{className:"w-100 h-100",onClick:e=>{if(u&&!u())return;const o=window.jimuConfig.isInBuilder;if(n===t.AppMode.Design&&o)return!1;const i=b(e),s=S();if(!i&&(null==l?void 0:l.linkType)&&(null==l?void 0:l.linkType)!==t.LinkType.None){const i=j(r);if(s){if(o)return I(),!1;"_self"===l.openType?window.location.href=i.linkTo.value:i.linkTo.value&&window.open(i.linkTo.value,l.openType)}else if((null==l?void 0:l.linkType)===t.LinkType.Block)c.current.click();else{if(o&&(null==l?void 0:l.linkType)===t.LinkType.PrintPreview)return I(),!1;m({evt:e,linkTo:i.linkTo,target:i.target,replace:!1,queryObject:i.queryObject})}}"linkClick"===e.exbEventType&&delete e.exbEventType},css:C},(()=>{var e;const i=j(r);return(null===(e=null==i?void 0:i.linkTo)||void 0===e?void 0:e.linkType)&&(0,t.jsx)(o._Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:c,to:i.linkTo,target:i.target,queryObject:i.queryObject,onClick:T})})(),d,s&&(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:s,expression:null==l?void 0:l.expression,onChange:e=>{if(e.isSuccessful)f(e.value);else{f("")}},widgetId:a}),window.jimuConfig.isInBuilder&&(S()||(null==l?void 0:l.linkType)===t.LinkType.PrintPreview)&&(0,t.jsx)(o.LinkTip,{reference:null===(i=c.current)||void 0===i?void 0:i.id,open:v,href:(()=>{const e=j(r);return t.urlUtils.getHrefFromLinkTo(e.linkTo,r,h&&h.location)||""})()}))},{useState:T,useRef:k,useEffect:M}=t.React,A=function(i){var n,l;const a=k(!1),r=k(null),{cardConfigs:u,layouts:c,appMode:p,linkParam:h,browserSizeMode:v,cardLayout:g,hoverPlayId:y,regularPlayId:f,previewId:m,previousIndex:S,currentIndex:b,queryObject:w,LayoutEntry:C}=i,[x,L]=T(null),[A,O]=T(!1),[R,P]=T(!1);M((()=>{var e,t;r.current=u,L(null==u?void 0:u.transitionInfo),O(null===(e=null==u?void 0:u.HOVER)||void 0===e?void 0:e.enable),P((null===(t=window.jimuConfig)||void 0===t?void 0:t.isInBuilder)||!1)}),[u]),M((()=>{a.current=!0}),[]);const E=e=>R&&p===t.AppMode.Express?(0,t.jsx)(C,{layouts:e,isInWidget:!0}):(0,t.jsx)(d.LayoutEntry,{layouts:e}),H=t.hooks.useEventCallback((i=>{var n,l;r.current=i;const a=[];let d,u,m,I,S,b;R&&p===t.AppMode.Design?(u=N(s.Default),S=z(s.Default),d=c[s.Default],A&&(I=N(s.Hover),b=z(s.Hover),m=g===e.AUTO?d:c[s.Hover])):(d=c[s.Default],u=N(s.Default),S=z(s.Default),A&&(m=g===e.AUTO?d:c[s.Hover],I=N(s.Hover),b=z(s.Hover)));const w=Object.assign({},o.styleUtils.toCSSStyle(u||{}));S&&(S=Object.assign({},o.styleUtils.toCSSStyle(S||{}))),b&&(b=Object.assign({},o.styleUtils.toCSSStyle(b||{})));const C=(null==h?void 0:h.linkType)&&(null==h?void 0:h.linkType)!==t.LinkType.None,x=(0,t.jsx)("div",{className:(0,t.classNames)("card-content d-flex surface-1",C?"card-link":""),tabIndex:C?-1:1,key:s.Default},(0,t.jsx)("div",{className:"w-100 animation-list",style:w},(0,t.jsx)("div",{className:"d-flex w-100 h-100",style:S},(0,t.jsx)(t.AnimationContext.Provider,{value:{setting:(null===(n=null==i?void 0:i.transitionInfo)||void 0===n?void 0:n.oneByOneEffect)||null,playId:f,oid:null==d?void 0:d[v]}},E(d)))));if(a.push(x),A){const e=Object.assign({},o.styleUtils.toCSSStyle(I||{})),n=(0,t.jsx)("div",{className:(0,t.classNames)("card-content d-flex surface-1 w-100 h-100",C?"card-link":""),key:s.Hover},(0,t.jsx)("div",{className:"w-100 h-100 animation-list",style:e},(0,t.jsx)("div",{className:"d-flex w-100 h-100",style:b},(0,t.jsx)(t.AnimationContext.Provider,{value:{setting:(null===(l=null==i?void 0:i.transitionInfo)||void 0===l?void 0:l.oneByOneEffect)||null,playId:y,oid:(null==m?void 0:m[v])||null}},E(m)))));a.push(n)}return a})),N=e=>I(r.current[e].backgroundStyle),z=e=>{const t=r.current[e].backgroundStyle;return(null==t?void 0:t.borderRadius)?{borderRadius:null==t?void 0:t.borderRadius}:null};return(0,t.jsx)(j,{linkParam:h,appMode:p,queryObject:w},(0,t.jsx)(t.TransitionContainer,{previousIndex:S,currentIndex:b,transitionType:null===(n=null==x?void 0:x.transition)||void 0===n?void 0:n.type,direction:null===(l=null==x?void 0:x.transition)||void 0===l?void 0:l.direction,playId:a.current?m:null,withOneByOne:!!(null==x?void 0:x.oneByOneEffect)},H(u)))};class O extends u{constructor(e){super(e),this.onMouse=(e,o=!1)=>{var i;const{cardConfigs:s}=this.props,n=null===(i=null==s?void 0:s.HOVER)||void 0===i?void 0:i.enable;let{previousIndex:l,currentIndex:a,hoverPlayId:r,regularPlayId:d}=this.state;n&&(l=o?0:1,a=o?1:0,r=o?(0,t.getNextAnimationId)():null,d=o?null:(0,t.getNextAnimationId)()),this.setState({isHover:o,previousIndex:l,currentIndex:a,hoverPlayId:r,regularPlayId:d})},this.getCardShadowStyle=()=>{var e,t;const{cardConfigs:i}=this.props,{isHover:n}=this.state,l=n&&i[s.Hover].enable?s.Hover:s.Default,a={boxShadow:null===(e=i[l].backgroundStyle)||void 0===e?void 0:e.boxShadow,borderRadius:null===(t=i[l].backgroundStyle)||void 0===t?void 0:t.borderRadius};return Object.assign({},o.styleUtils.toCSSStyle(a))},this.state={url:"",isHover:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null},this.regularLayoutRef=t.React.createRef(),this.hoverLayoutRef=t.React.createRef(),this.linkRef=t.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(e){var o,i;const s=this.props.cardConfigs,{cardConfigs:n}=e;(null===(o=null==s?void 0:s.transitionInfo)||void 0===o?void 0:o.previewId)===(null===(i=null==n?void 0:n.transitionInfo)||void 0===i?void 0:i.previewId)||this.setState({hoverPlayId:(0,t.getNextAnimationId)(),regularPlayId:(0,t.getNextAnimationId)()})}render(){const{widgetId:e,cardConfigs:o,linkParam:i,queryObject:n,layouts:l,appMode:a,browserSizeMode:r,cardLayout:d,LayoutEntry:u}=this.props,{previousIndex:c,currentIndex:p,regularPlayId:h,hoverPlayId:v}=this.state,g=o.transitionInfo,y=`card-${e}`,f=(null==g?void 0:g.previewId)||null,m=0===p?s.Default:s.Hover;return(0,t.jsx)("div",{css:this.getStyle(m),style:this.getCardShadowStyle(),className:y,onMouseLeave:e=>{this.onMouse(e,!1)},onMouseEnter:e=>{this.onMouse(e,!0)}},(0,t.jsx)(A,{linkParam:i,queryObject:n,cardConfigs:o,layouts:l,appMode:a,browserSizeMode:r,hoverPlayId:v,regularPlayId:h,previousIndex:c,currentIndex:p,previewId:f,cardLayout:d,LayoutEntry:u}))}}const R={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",_layout_DEFAULT_label:"Default",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class P extends t.React.PureComponent{constructor(e){super(e),this.setListParentSizeInWidgetState=()=>{const{browserSizeMode:e,id:o,parentSize:i,layoutId:s}=this.props,n=(0,t.getAppStore)().getState().appConfig,l=t.utils.findViewportSize(n,e),a=`div.layout[data-layoutid=${s}]`,r=document.querySelector(a),d={width:(null==r?void 0:r.clientWidth)||l.width,height:(null==r?void 0:r.clientHeight)||l.height};i&&i.height===d.height&&i.width===d.width||this.props.dispatch(t.appActions.widgetStatePropChange(o,"parentSize",d))},this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:o}=this.props;this.props.dispatch(t.appActions.widgetStatePropChange(e,"selectionIsInSelf",o))},this.setSettingLayout=()=>{const{layoutId:e,layoutItemId:o,id:i,selectionIsSelf:s}=this.props,{isSetlayout:n}=this.state;e&&i&&o&&!n&&s&&(this.props.dispatch(t.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:e,layoutItemId:o})),this.setState({isSetlayout:!0}))},this.onResize=(e,t)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props;e&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.formatMessage=(e,o)=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},R),t.defaultMessages)[e]},o),this.editStatus=(e,o)=>{const{dispatch:i,id:s}=this.props;i(t.appActions.widgetStatePropChange(s,e,o))},this.editWidgetConfig=e=>{if(!window.jimuConfig.isInBuilder)return;this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.isEditing=()=>{const{appMode:e,config:o,selectionIsSelf:i,selectionIsInSelf:s}=this.props;return!!window.jimuConfig.isInBuilder&&((i||s)&&window.jimuConfig.isInBuilder&&e===t.AppMode.Design&&o.isItemStyleConfirm)},this.checkIsShowMask=()=>{const{appMode:e,config:o}=this.props;return!!window.jimuConfig.isInBuilder&&!(window.jimuConfig.isInBuilder&&e===t.AppMode.Design&&o.isItemStyleConfirm)},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.getAppConfig=()=>(0,t.getAppStore)().getState().appConfig,this.getStyle=e=>{const{id:o}=this.props;return t.css`
      ${"&.card-widget-"+o} {
        overflow: visible;
        background-color: transparent;
        border: ${t.polished.rem(0)} solid
          ${t.polished.rgba(e.ref.palette.black,window.jimuConfig.isInBuilder&&this.isEditing()?.2:0)};
        width: 100%;
        height: 100%;
      }
    `},this.getCardProps=()=>{const{config:e,selectionIsInSelf:o,selectionIsSelf:i,builderStatus:s,appMode:n,queryObject:l}=this.props,a=window.jimuConfig.isInBuilder&&n===t.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:i,selectionIsInCard:o,isEditing:this.isEditing(),isShowMask:this.checkIsShowMask(),builderStatus:s,selectSelf:this.selectSelf}:{linkParam:e.linkParam,queryObject:l};return Object.assign(Object.assign({},this.getOtherProps()),a)},this.getOtherProps=()=>{const{config:e,theme:t,id:o,appMode:i,builderSupportModules:s,layouts:n,browserSizeMode:l,dispatch:a,isRTL:r,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:l,isRTL:r,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:a,widgetId:o,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:i,theme:t,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:e,isHeightAuto:d,isWidthAuto:u,cardLayout:null==e?void 0:e.cardLayout}},this.cardRender=()=>{const e=this.getCardProps(),{appMode:o}=this.props,i=window.jimuConfig.isInBuilder&&o===t.AppMode.Design?C:O;return(0,t.jsx)(i,Object.assign({},e))},this.selectSelf=()=>{if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:e,layoutItemId:o}=this.props,i={layoutId:e,layoutItemId:o};this.props.dispatch(t.appActions.selectionChanged(i))};const o={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?o.LayoutEntry=this.props.builderSupportModules.LayoutEntry:o.LayoutEntry=d.LayoutEntry,this.state=o,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=t.lodash.debounce(((e,t)=>{this.onResize(e,t)}),200)}componentDidUpdate(e,o){var i;const{appMode:n,selectionStatus:l,builderStatus:a,left:r,top:d}=this.props;n===t.AppMode.Design&&l!==a&&l&&this.editBuilderAndSettingStatus(l),e.appMode!==n&&n!==t.AppMode.Design&&this.editBuilderAndSettingStatus(s.Default),(null==e?void 0:e.selectionIsInSelf)!==(null===(i=this.props)||void 0===i?void 0:i.selectionIsInSelf)&&this.setSelectionStatus(),d===e.top&&r===e.left||this.updateCardToolPosition(),this.setSettingLayout(),this.setListParentSizeInWidgetState()}render(){const{config:e,id:i}=this.props,s=(0,t.classNames)("jimu-widget","widget-card","card-widget-"+i);return e.itemStyle?(0,t.jsx)("div",{className:s,css:this.getStyle(this.props.theme)},this.cardRender(),(0,t.jsx)(t.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})):(0,t.jsx)(o.WidgetPlaceholder,{widgetId:this.props.id,icon:n(86800),message:this.formatMessage("placeHolderTip")})}}P.mapExtraStateProps=(e,t)=>{var o,i,n,l,a,r,u,c,p,h,v,g,y,f,m;const I=e&&e.appConfig,{layouts:S,layoutId:b,layoutItemId:w,builderSupportModules:C,id:x}=t,L=null==e?void 0:e.browserSizeMode,j=(null==e?void 0:e.widgetsState[t.id])&&(null===(o=null==e?void 0:e.widgetsState[t.id])||void 0===o?void 0:o.builderStatus)||s.Default,T=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,k=T&&C&&C.widgetModules&&C.widgetModules.selectionInCard(T,x,I,!1);let M;k&&(M=Object.keys(S).find((e=>d.searchUtils.findLayoutId(S[e],L,I.mainSizeMode)===T.layoutId)));const A=null===(i=I.layouts)||void 0===i?void 0:i[b],O=null===(l=null===(n=null==A?void 0:A.content)||void 0===n?void 0:n[w])||void 0===l?void 0:l.setting,R=(null===(a=null==O?void 0:O.autoProps)||void 0===a?void 0:a.height)===d.LayoutItemSizeModes.Auto||!0===(null===(r=null==O?void 0:O.autoProps)||void 0===r?void 0:r.height),P=(null===(u=null==O?void 0:O.autoProps)||void 0===u?void 0:u.width)===d.LayoutItemSizeModes.Auto||!0===(null===(c=null==O?void 0:O.autoProps)||void 0===c?void 0:c.width);let E;if(window.jimuConfig.isInBuilder){const e=null===(g=null===(v=null===(h=null===(p=I.layouts)||void 0===p?void 0:p[b])||void 0===h?void 0:h.content)||void 0===v?void 0:v[w])||void 0===g?void 0:g.bbox;E=e&&{left:e.left,top:e.top}}return{selectionIsSelf:(null==T?void 0:T.layoutId)===b&&(null==T?void 0:T.layoutItemId)===w,selectionIsInSelf:k,selectionStatus:M,appMode:null===(y=null==e?void 0:e.appRuntimeInfo)||void 0===y?void 0:y.appMode,browserSizeMode:null==e?void 0:e.browserSizeMode,builderStatus:j,isRTL:null===(f=null==e?void 0:e.appContext)||void 0===f?void 0:f.isRTL,left:E&&E.left,top:E&&E.top,isHeightAuto:R,isWidthAuto:P,queryObject:e.queryObject,parentSize:(null===(m=e.widgetsState[t.id])||void 0===m?void 0:m.parentSize)||null}};const E=P;function H(e){n.p=e}})(),l})())}}}));