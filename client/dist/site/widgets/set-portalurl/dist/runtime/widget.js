System.register(["jimu-core","jimu-theme","jimu-ui"],(function(t,e){var o={},s={},l={};return{setters:[function(t){o.React=t.React,o.SessionManager=t.SessionManager,o.UrlProtocol=t.UrlProtocol,o.css=t.css,o.esri=t.esri,o.jsx=t.jsx,o.portalUrlUtils=t.portalUrlUtils,o.urlUtils=t.urlUtils},function(t){s.styled=t.styled},function(t){l.Button=t.Button,l.ButtonGroup=t.ButtonGroup,l.Dropdown=t.Dropdown,l.DropdownButton=t.DropdownButton,l.DropdownItem=t.DropdownItem,l.DropdownMenu=t.DropdownMenu,l.FormFeedback=t.FormFeedback,l.FormGroup=t.FormGroup,l.InputGroup=t.InputGroup,l.Label=t.Label,l.TextInput=t.TextInput}],execute:function(){t((()=>{var t={348:function(t,e){var o,s,l;s=[e,t],o=function(t,e){"use strict";var o={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function s(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function l(t){try{delete window[t]}catch(e){window[t]=void 0}}function n(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}function a(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=t,r=e.timeout||o.timeout,i=e.jsonpCallback||o.jsonpCallback,d=void 0;return new Promise((function(o,c){var u=e.jsonpCallbackFunction||s(),p=i+"_"+u;window[u]=function(t){o({ok:!0,json:function(){return Promise.resolve(t)}}),d&&clearTimeout(d),n(p),l(u)},a+=-1===a.indexOf("?")?"?":"&";var h=document.createElement("script");h.setAttribute("src",""+a+i+"="+u),e.charset&&h.setAttribute("charset",e.charset),e.nonce&&h.setAttribute("nonce",e.nonce),e.referrerPolicy&&h.setAttribute("referrerPolicy",e.referrerPolicy),e.crossorigin&&h.setAttribute("crossorigin","true"),h.id=p,document.getElementsByTagName("head")[0].appendChild(h),d=setTimeout((function(){c(new Error("JSONP request to "+t+" timed out")),l(u),n(p),window[u]=function(){l(u)}}),r),h.onerror=function(){c(new Error("JSONP request to "+t+" failed")),l(u),n(p),d&&clearTimeout(d)}}))}e.exports=a},void 0===(l="function"==typeof o?o.apply(e,s):o)||(t.exports=l)},244:t=>{"use strict";t.exports=o},888:t=>{"use strict";t.exports=s},321:t=>{"use strict";t.exports=l}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var l=e[o]={exports:{}};return t[o].call(l.exports,l,l.exports,n),l.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{LoadStatus:()=>I,__set_webpack_public_path__:()=>j,default:()=>w});var t=n(244),e=n(321);const o="Sign in",s="Portal URL",l="Client ID",r="Specify the URL to your ArcGIS Online organization or ArcGIS Enterprise",i="Provide the Client ID for Experience Builder registered in the organization you specify above",d="Please enter the full URL of your ArcGIS Online organization or ArcGIS Enterprise, for example,",c="Unable to access",u="Your application domain is not allowed via Cross-Origin Resource Sharing (CORS) to access",p="A server with the specified hostname could not be found.";var h,f=n(348);!function(t){t.InvalidPortalUrl="InvalidPortalUrl",t.UnableToCorsAccess="UnableToCorsAccess",t.UnableToAccess="UnableToAccess"}(h||(h={}));class g{constructor(){this.validPortalInfos=[]}getDefaultProtalInfo(t){return{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:{token:null,expires:null,ssl:!1,server:"",userId:""},url:this.getStandardPortalUrl(t),clientId:void 0}}getValidPortalInfo(e){let o=null;return this.validPortalInfos.some((s=>!!t.portalUrlUtils.isSamePortalUrl(e,s.url)&&(o=s,!0))),o}getStandardPortalUrl(e){if(!e)return"";const o=0===e.toLowerCase().indexOf("http://"),s=0===e.toLowerCase().indexOf("https://");return o||s||(e=t.urlUtils.setProtocol(e,t.UrlProtocol.Https)),e=t.portalUrlUtils.getStandardPortalUrl(e),e=t.urlUtils.setProtocol(e,t.UrlProtocol.Https)}validatePortalUrl(t){const e=this.getDefaultProtalInfo(t);return/www\.arcgis\.com/gi.test(t)?(e.isValid=!1,e.invalidMessage=h.InvalidPortalUrl):e.isValid=!0,e}fetcher(t,e){return fetch(t,e)}generateToken(e){const o=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}generateToken?f=json`,t.UrlProtocol.Https);return this.fetcher(o,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t),(t=>null))}getPortalSelfInfo(e){const o=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}portals/self?f=json`,t.UrlProtocol.Https);return this.fetcher(o,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t)).catch((t=>f(o,{jsonpCallback:"callback",timeout:3e3}).then((t=>({invalidPortalSelf:!0,invalidMessage:h.UnableToCorsAccess}))).catch((t=>({invalidPortalSelf:!0,invalidMessage:h.UnableToAccess})))))}getPortalInfo(e){const o=this.getDefaultProtalInfo(e);return this.getPortalSelfInfo(e).then((t=>{if(t&&!t.invalidPortalSelf&&(t.isPortal||t.urlKey))return o.isValid=!0,o.supportsOAuth=t.supportsOAuth,o.tokenInfo.userId=t.user?t.user.username:"",this.validPortalInfos.push(o),this.generateToken(e);o.isValid=!1,o.invalidMessage=(null==t?void 0:t.invalidMessage)||h.UnableToAccess})).then((s=>(s&&s.token&&(o.tokenInfo.token=s.token,o.tokenInfo.expires=s.expires,o.tokenInfo.ssl=s.ssl,o.tokenInfo.server=t.portalUrlUtils.getPortalRestUrl(e),o.isWebTier=!0,o.supportsOAuth=!1),o)))}validatePortal(t){if(!t)return Promise.reject("Portal URL is empty.");let e;const o=this.getStandardPortalUrl(t);let s=this.getValidPortalInfo(o);return s?e=Promise.resolve(s):(s=this.validatePortalUrl(o),e=s.isValid?this.getPortalInfo(o):Promise.resolve(s)),e}}var I,m=n(888),P=function(t,e,o,s){return new(o||(o=Promise))((function(l,n){function a(t){try{i(s.next(t))}catch(t){n(t)}}function r(t){try{i(s.throw(t))}catch(t){n(t)}}function i(t){var e;t.done?l(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,r)}i((s=s.apply(t,e||[])).next())}))};!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(I||(I={}));const v="https://myorg.maps.arcgis.com",U="https://myportal.company.com/arcgis";class x extends t.React.PureComponent{constructor(e){super(e),this.onPortalUrlInputChange=t=>{var e,o;const s=this.portalValidator.getDefaultProtalInfo(null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value);s.url=null===(o=null==t?void 0:t.target)||void 0===o?void 0:o.value,this.setState({selectedPortalInfo:s})},this.onClientIdInputChange=t=>{var e;this.setState({selectedPortalInfo:Object.assign(Object.assign({},this.state.selectedPortalInfo),{clientId:null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value})})},this.checkPortalUrlOnAccept=t=>P(this,void 0,void 0,(function*(){try{let e;return t?(this.setState({loadStatus:I.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),e=yield this.portalValidator.validatePortal(t)):e=this.portalValidator.getDefaultProtalInfo(),this.setState({selectedPortalInfo:e,loadStatus:I.Fulfilled}),!e||e.invalidMessage?{valid:!1}:{valid:!0}}catch(t){return this.setState({loadStatus:I.Rejected}),{valid:!1}}})),this.onSignInBtnClick=()=>{if(!this.state.selectedPortalInfo.isValid)return;const t={portalUrl:this.state.selectedPortalInfo.url,clientId:this.clientIdInput.current.value,supportsOAuth:this.state.selectedPortalInfo.supportsOAuth,isWebTier:this.state.selectedPortalInfo.isWebTier};this.addSigninInfo(t).then((()=>{this.signIn(t)}))},this.onUrlListBtnClick=()=>{this.setState({showUrlList:!this.state.showUrlList})},this.onUrlListItemClick=t=>{this.selectPortalUrl(t)},this.portalValidator=new g,this.state={signinInfos:[],showUrlList:!1,loadStatus:I.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo()},this.urlInput=t.React.createRef(),this.clientIdInput=t.React.createRef()}componentDidMount(){this.fetchSigninInfo()}getDefaultPortalUrl(e){const o=window.jimuConfig.hostEnv||"dev",s=`${t.urlUtils.getFixedRootPath()}builder/setting.json`;return window.fetch(s).then((t=>t.json())).then((t=>{const s=(window.jimuConfig.isDevEdition?t.devEnv:t.env)[o];return s&&s.portalUrl||e[0]&&e[0].portalUrl||""}))}fetchSigninInfo(){const t=`${window.location.protocol}//${window.location.host}/signininfo`;return window.fetch(t,{cache:"no-cache"}).then((t=>t.json())).then((t=>(this.setState({signinInfos:t}),this.getDefaultPortalUrl(t).then((t=>{this.selectPortalUrl(t)})),t))).catch((t=>(console.error(t),t)))}addSigninInfo(t){const e=`${window.location.protocol}//${window.location.host}/signinInfo`;return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((t=>t.json())).catch((t=>{console.error(t)}))}getSigninInfo(e){let o=null;return this.state.signinInfos.some((s=>!!t.portalUrlUtils.isSamePortalUrl(s.portalUrl,e)&&(o=s,!0))),o}OAuthSignIn(e){const o=e.portalUrl+"/sharing/rest/";t.SessionManager.getInstance().signIn({desUrl:o,clientId:e.clientId,popup:!1})}webTierSignIn(){const e=this.state.selectedPortalInfo.tokenInfo,o=t.esri.restRequest.ArcGISIdentityManager.fromCredential(e,{hasPortal:!1,hasServer:!1,server:""});t.SessionManager.getInstance().writeAuthInfo(o),window.location.href="/"}signIn(t){t.supportsOAuth?this.OAuthSignIn(t):this.state.selectedPortalInfo.isWebTier&&this.webTierSignIn()}validatePortal(t){return this.portalValidator.validatePortal(t)}selectPortalUrl(t,e){t?(this.setState({loadStatus:I.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),this.validatePortal(t).then((t=>{this.setState(Object.assign({selectedPortalInfo:t,loadStatus:I.Fulfilled},e))})).catch((()=>{this.setState({loadStatus:I.Rejected})}))):this.setState({selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(),loadStatus:I.Fulfilled})}render(){const n=(0,m.styled)(e.Button)`
      display: block;
      margin: 0 auto;
    `,a=this.state.signinInfos.map(((o,s)=>(0,t.jsx)(e.DropdownItem,{key:s,active:!!t.portalUrlUtils.isSamePortalUrl(o.portalUrl,this.state.selectedPortalInfo.url),onClick:()=>{this.onUrlListItemClick(o.portalUrl)}},o.portalUrl))),f=this.getSigninInfo(this.state.selectedPortalInfo.url);let g,P,x;if(g=void 0!==this.state.selectedPortalInfo.clientId?this.state.selectedPortalInfo.clientId:f&&f.clientId||"",this.state.selectedPortalInfo.url||this.state.loadStatus===I.Pending||(P=(0,t.jsx)("div",null,(0,t.jsx)("div",null,v),(0,t.jsx)("div",null,U))),this.state.selectedPortalInfo&&this.state.selectedPortalInfo.invalidMessage&&this.state.loadStatus!==I.Pending)if(this.state.selectedPortalInfo.invalidMessage===h.InvalidPortalUrl)x=(0,t.jsx)("div",null,(0,t.jsx)("div",null,this.props.intl.formatMessage({id:"invalidPortalUrlMessage",defaultMessage:d})),(0,t.jsx)("div",{className:"sample-url"},v),(0,t.jsx)("div",{className:"sample-url"},U));else if(this.state.selectedPortalInfo.invalidMessage===h.UnableToCorsAccess){const e=this.props.intl.formatMessage({id:"unableToCorsAccessMessage",defaultMessage:u});x=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`))}else{const e=this.props.intl.formatMessage({id:"unableToAccessMessage",defaultMessage:c}),o=this.props.intl.formatMessage({id:"invalidHostNameMessage",defaultMessage:p});x=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`),(0,t.jsx)("div",null,o))}const w=this.state.selectedPortalInfo&&this.state.selectedPortalInfo.supportsOAuth?"displayed":"hidden";let j="hidden",b=!1;this.state.loadStatus===I.Pending&&(b=!0,j="displayed");const S=!this.state.selectedPortalInfo.isValid;return(0,t.jsx)("div",{css:(y=this.props.theme,this.props.isRTL,t.css`
    max-width: 700px;
    margin: 0 auto;
    .portal-url-input{
      margin-right: 1px;
    }
    .portal-clientId.hidden{
      display: none;
    }
    .portal-clientId .jimu-input {
      input:-webkit-autofill,
      input:-webkit-autofill:focus {
        transition: background-color 0s 600000s, color 0s 600000s !important;
      }
    }
    .loading-panel {
      position: absolute;
      width: 15px;
      background-color: ${y.ref.palette.neutral[200]};

      .jimu-secondary-loading {
        left: 2px;
        top: 12px;
      }

      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {
        width: 2px;
        height: 5px;
        left: -27px;
      }
      .jimu-secondary-loading:before {
        left: -5px;
      }
      .jimu-secondary-loading:after {
        left: 5px;
      }
    }

    .loading-panel.hidden {
      display: none;
    }

    .dropdown-menu {
      width: 700px;
    }

    .description, .message {
      color: ${y.ref.palette.neutral[1e3]};
      width: auto;
    }

    .invalid-message {
      .sample-url {
        color: ${y.ref.palette.primary[600]};
      }
    }
    .loading-con {
      margin-left: -1px;
    }
  `),className:"widget-set-portalurl"},(0,t.jsx)("div",{className:"mt-6 mb-2"},(0,t.jsx)(e.Label,{id:"portalUrlLabel",className:"description"}," ",this.props.intl.formatMessage({id:"portalUrlDescription",defaultMessage:r})," "),(0,t.jsx)(e.ButtonGroup,{className:"w-100"},(0,t.jsx)(e.InputGroup,null,(0,t.jsx)(e.TextInput,{"aria-describedby":"portalUrlMessage1 portalUrlMessage2","aria-labelledby":"portalUrlLabel",className:"portal-url-input",disabled:b,size:"lg",placeholder:this.props.intl.formatMessage({id:"portalUrl",defaultMessage:s}),min:0,max:100,type:"text",checkValidityOnAccept:this.checkPortalUrlOnAccept,value:this.state.selectedPortalInfo.url||"",onChange:this.onPortalUrlInputChange,ref:this.urlInput}),(0,t.jsx)("div",{className:"d-flex loading-con"},(0,t.jsx)("div",{className:`loading-panel ${j}`},(0,t.jsx)("div",{className:"jimu-secondary-loading"})))),(0,t.jsx)(e.Dropdown,{activeIcon:!0,className:"dropdown",isOpen:this.state.showUrlList,toggle:this.onUrlListBtnClick},(0,t.jsx)(e.DropdownButton,{style:{width:"auto"},icon:!0}),(0,t.jsx)(e.DropdownMenu,{className:"dropdown-menu",zIndex:"55",style:{width:"700px"},alignment:"end"},a)))),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage1",className:"message mx-2",valid:!0}," ",P," "),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage2",className:"message invalid-message mx-2",valid:!0}," ",x," "),(0,t.jsx)(e.FormGroup,{className:`portal-clientId mt-6 ${w}`},(0,t.jsx)(e.Label,{className:"description",for:"clientIdText"}," ",this.props.intl.formatMessage({id:"clientIdDescription",defaultMessage:i})," "),(0,t.jsx)(e.TextInput,{disabled:b,size:"lg",type:"password",name:"text",id:"clientIdText",placeholder:this.props.intl.formatMessage({id:"clientId",defaultMessage:l}),value:g,ref:this.clientIdInput,onChange:this.onClientIdInputChange})),(0,t.jsx)(n,{disabled:b||S,size:"lg",onClick:()=>{this.onSignInBtnClick()}},this.props.intl.formatMessage({id:"portalUrlSignIn",defaultMessage:o})));var y}}x.mapExtraStateProps=t=>({isRTL:t.appContext.isRTL});const w=x;function j(t){n.p=t}})(),a})())}}}));